\doxysection{bench\+\_\+impl.\+h}
\label{ellswift_2bench__impl_8h_source}\index{src/secp256k1/src/modules/ellswift/bench\_impl.h@{src/secp256k1/src/modules/ellswift/bench\_impl.h}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/***********************************************************************}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *\ Distributed\ under\ the\ MIT\ software\ license,\ see\ the\ accompanying\ \ \ \ *}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *\ file\ COPYING\ or\ https://www.opensource.org/licenses/mit-\/license.php.*}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ ***********************************************************************/}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#ifndef\ SECP256K1\_MODULE\_ELLSWIFT\_BENCH\_H}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#define\ SECP256K1\_MODULE\_ELLSWIFT\_BENCH\_H}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}../../../include/secp256k1\_ellswift.h"{}}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{00012\ \ \ \ \ secp256k1\_context\ *ctx;}
\DoxyCodeLine{00013\ \ \ \ \ secp256k1\_pubkey\ point[256];}
\DoxyCodeLine{00014\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ rnd64[64];}
\DoxyCodeLine{00015\ \}\ bench\_ellswift\_data;}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ bench\_ellswift\_setup(\textcolor{keywordtype}{void}\ *arg)\ \{}
\DoxyCodeLine{00018\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00019\ \ \ \ \ bench\_ellswift\_data\ *data\ =\ (bench\_ellswift\_data*)arg;}
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ init[64]\ =\ \{}
\DoxyCodeLine{00021\ \ \ \ \ \ \ \ \ 0x78,\ 0x1f,\ 0xb7,\ 0xd4,\ 0x67,\ 0x7f,\ 0x08,\ 0x68,}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ 0xdb,\ 0xe3,\ 0x1d,\ 0x7f,\ 0x1b,\ 0xb0,\ 0xf6,\ 0x9e,}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ 0x0a,\ 0x64,\ 0xca,\ 0x32,\ 0x9e,\ 0xc6,\ 0x20,\ 0x79,}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ 0x03,\ 0xf3,\ 0xd0,\ 0x46,\ 0x7a,\ 0x0f,\ 0xd2,\ 0x21,}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ 0xb0,\ 0x2c,\ 0x46,\ 0xd8,\ 0xba,\ 0xca,\ 0x26,\ 0x4f,}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ 0x8f,\ 0x8c,\ 0xd4,\ 0xdd,\ 0x2d,\ 0x04,\ 0xbe,\ 0x30,}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ 0x48,\ 0x51,\ 0x1e,\ 0xd4,\ 0x16,\ 0xfd,\ 0x42,\ 0x85,}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ 0x62,\ 0xc9,\ 0x02,\ 0xf9,\ 0x89,\ 0x84,\ 0xff,\ 0xdc}
\DoxyCodeLine{00029\ \ \ \ \ \};}
\DoxyCodeLine{00030\ \ \ \ \ memcpy(data-\/>rnd64,\ init,\ 64);}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ 256;\ ++i)\ \{}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ j;}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ CHECK(secp256k1\_ellswift\_decode(data-\/>ctx,\ \&data-\/>point[i],\ data-\/>rnd64));}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (j\ =\ 0;\ j\ <\ 64;\ ++j)\ \{}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ data-\/>rnd64[j]\ +=\ 1;}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00037\ \ \ \ \ \}}
\DoxyCodeLine{00038\ \ \ \ \ CHECK(secp256k1\_ellswift\_encode(data-\/>ctx,\ data-\/>rnd64,\ \&data-\/>point[255],\ init\ +\ 16));}
\DoxyCodeLine{00039\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ bench\_ellswift\_encode(\textcolor{keywordtype}{void}\ *arg,\ \textcolor{keywordtype}{int}\ iters)\ \{}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00043\ \ \ \ \ bench\_ellswift\_data\ *data\ =\ (bench\_ellswift\_data*)arg;}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ iters;\ i++)\ \{}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ CHECK(secp256k1\_ellswift\_encode(data-\/>ctx,\ data-\/>rnd64,\ \&data-\/>point[i\ \&\ 255],\ data-\/>rnd64\ +\ 16));}
\DoxyCodeLine{00047\ \ \ \ \ \}}
\DoxyCodeLine{00048\ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ bench\_ellswift\_create(\textcolor{keywordtype}{void}\ *arg,\ \textcolor{keywordtype}{int}\ iters)\ \{}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00052\ \ \ \ \ bench\_ellswift\_data\ *data\ =\ (bench\_ellswift\_data*)arg;}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ iters;\ i++)\ \{}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ buf[64];}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ CHECK(secp256k1\_ellswift\_create(data-\/>ctx,\ buf,\ data-\/>rnd64,\ data-\/>rnd64\ +\ 32));}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ memcpy(data-\/>rnd64,\ buf,\ 64);}
\DoxyCodeLine{00058\ \ \ \ \ \}}
\DoxyCodeLine{00059\ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ bench\_ellswift\_decode(\textcolor{keywordtype}{void}\ *arg,\ \textcolor{keywordtype}{int}\ iters)\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00063\ \ \ \ \ secp256k1\_pubkey\ out;}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ len;}
\DoxyCodeLine{00065\ \ \ \ \ bench\_ellswift\_data\ *data\ =\ (bench\_ellswift\_data*)arg;}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ iters;\ i++)\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ CHECK(secp256k1\_ellswift\_decode(data-\/>ctx,\ \&out,\ data-\/>rnd64)\ ==\ 1);}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ len\ =\ 33;}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ CHECK(secp256k1\_ec\_pubkey\_serialize(data-\/>ctx,\ data-\/>rnd64\ +\ (i\ \%\ 32),\ \&len,\ \&out,\ SECP256K1\_EC\_COMPRESSED));}
\DoxyCodeLine{00071\ \ \ \ \ \}}
\DoxyCodeLine{00072\ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ bench\_ellswift\_xdh(\textcolor{keywordtype}{void}\ *arg,\ \textcolor{keywordtype}{int}\ iters)\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00076\ \ \ \ \ bench\_ellswift\_data\ *data\ =\ (bench\_ellswift\_data*)arg;}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ iters;\ i++)\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ party\ =\ i\ \&\ 1;}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ CHECK(secp256k1\_ellswift\_xdh(data-\/>ctx,}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data-\/>rnd64\ +\ (i\ \%\ 33),}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data-\/>rnd64,}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data-\/>rnd64,}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data-\/>rnd64\ +\ ((i\ +\ 16)\ \%\ 33),}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ party,}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_ellswift\_xdh\_hash\_function\_bip324,}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NULL)\ ==\ 1);}
\DoxyCodeLine{00088\ \ \ \ \ \}}
\DoxyCodeLine{00089\ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \textcolor{keywordtype}{void}\ run\_ellswift\_bench(\textcolor{keywordtype}{int}\ iters,\ \textcolor{keywordtype}{int}\ argc,\ \textcolor{keywordtype}{char}\ **argv)\ \{}
\DoxyCodeLine{00092\ \ \ \ \ bench\_ellswift\_data\ data;}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordtype}{int}\ d\ =\ argc\ ==\ 1;}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{comment}{/*\ create\ a\ context\ with\ signing\ capabilities\ */}}
\DoxyCodeLine{00096\ \ \ \ \ data.ctx\ =\ secp256k1\_context\_create(SECP256K1\_CONTEXT\_NONE);}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordflow}{if}\ (d\ ||\ have\_flag(argc,\ argv,\ \textcolor{stringliteral}{"{}ellswift"{}})\ ||\ have\_flag(argc,\ argv,\ \textcolor{stringliteral}{"{}encode"{}})\ ||\ have\_flag(argc,\ argv,\ \textcolor{stringliteral}{"{}ellswift\_encode"{}}))\ run\_benchmark(\textcolor{stringliteral}{"{}ellswift\_encode"{}},\ bench\_ellswift\_encode,\ bench\_ellswift\_setup,\ NULL,\ \&data,\ 10,\ iters);}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordflow}{if}\ (d\ ||\ have\_flag(argc,\ argv,\ \textcolor{stringliteral}{"{}ellswift"{}})\ ||\ have\_flag(argc,\ argv,\ \textcolor{stringliteral}{"{}decode"{}})\ ||\ have\_flag(argc,\ argv,\ \textcolor{stringliteral}{"{}ellswift\_decode"{}}))\ run\_benchmark(\textcolor{stringliteral}{"{}ellswift\_decode"{}},\ bench\_ellswift\_decode,\ bench\_ellswift\_setup,\ NULL,\ \&data,\ 10,\ iters);}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keywordflow}{if}\ (d\ ||\ have\_flag(argc,\ argv,\ \textcolor{stringliteral}{"{}ellswift"{}})\ ||\ have\_flag(argc,\ argv,\ \textcolor{stringliteral}{"{}keygen"{}})\ ||\ have\_flag(argc,\ argv,\ \textcolor{stringliteral}{"{}ellswift\_keygen"{}}))\ run\_benchmark(\textcolor{stringliteral}{"{}ellswift\_keygen"{}},\ bench\_ellswift\_create,\ bench\_ellswift\_setup,\ NULL,\ \&data,\ 10,\ iters);}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordflow}{if}\ (d\ ||\ have\_flag(argc,\ argv,\ \textcolor{stringliteral}{"{}ellswift"{}})\ ||\ have\_flag(argc,\ argv,\ \textcolor{stringliteral}{"{}ecdh"{}})\ ||\ have\_flag(argc,\ argv,\ \textcolor{stringliteral}{"{}ellswift\_ecdh"{}}))\ run\_benchmark(\textcolor{stringliteral}{"{}ellswift\_ecdh"{}},\ bench\_ellswift\_xdh,\ bench\_ellswift\_setup,\ NULL,\ \&data,\ 10,\ iters);}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ secp256k1\_context\_destroy(data.ctx);}
\DoxyCodeLine{00104\ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
