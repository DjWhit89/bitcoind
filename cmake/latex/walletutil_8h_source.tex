\doxysection{walletutil.\+h}
\label{walletutil_8h_source}\index{src/wallet/walletutil.h@{src/wallet/walletutil.h}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (c)\ 2017-\/present\ The\ Bitcoin\ Core\ developers}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Distributed\ under\ the\ MIT\ software\ license,\ see\ the\ accompanying}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ file\ COPYING\ or\ http://www.opensource.org/licenses/mit-\/license.php.}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#ifndef\ BITCOIN\_WALLET\_WALLETUTIL\_H}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#define\ BITCOIN\_WALLET\_WALLETUTIL\_H}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <script/descriptor.h>}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <util/fs.h>}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{keyword}{namespace\ }wallet\ \{}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{keyword}{enum}\ WalletFlags\ :\ uint64\_t\ \{}
\DoxyCodeLine{00016\ \ \ \ \ \textcolor{comment}{//\ wallet\ flags\ in\ the\ upper\ section\ (>\ 1\ <<\ 31)\ will\ lead\ to\ not\ opening\ the\ wallet\ if\ flag\ is\ unknown}}
\DoxyCodeLine{00017\ \ \ \ \ \textcolor{comment}{//\ unknown\ wallet\ flags\ in\ the\ lower\ section\ <=\ (1\ <<\ 31)\ will\ be\ tolerated}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \ \ \ \ \textcolor{comment}{//\ will\ categorize\ coins\ as\ clean\ (not\ reused)\ and\ dirty\ (reused),\ and\ handle}}
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{comment}{//\ them\ with\ privacy\ considerations\ in\ mind}}
\DoxyCodeLine{00021\ \ \ \ \ WALLET\_FLAG\_AVOID\_REUSE\ =\ (1ULL\ <<\ 0),}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{comment}{//\ Indicates\ that\ the\ metadata\ has\ already\ been\ upgraded\ to\ contain\ key\ origins}}
\DoxyCodeLine{00024\ \ \ \ \ WALLET\_FLAG\_KEY\_ORIGIN\_METADATA\ =\ (1ULL\ <<\ 1),}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{comment}{//\ Indicates\ that\ the\ descriptor\ cache\ has\ been\ upgraded\ to\ cache\ last\ hardened\ xpubs}}
\DoxyCodeLine{00027\ \ \ \ \ WALLET\_FLAG\_LAST\_HARDENED\_XPUB\_CACHED\ =\ (1ULL\ <<\ 2),}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{comment}{//\ will\ enforce\ the\ rule\ that\ the\ wallet\ can't\ contain\ any\ private\ keys\ (only\ watch-\/only/pubkeys)}}
\DoxyCodeLine{00030\ \ \ \ \ WALLET\_FLAG\_DISABLE\_PRIVATE\_KEYS\ =\ (1ULL\ <<\ 32),}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00050\ \ \ \ \ WALLET\_FLAG\_BLANK\_WALLET\ =\ (1ULL\ <<\ 33),}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00053\ \ \ \ \ WALLET\_FLAG\_DESCRIPTORS\ =\ (1ULL\ <<\ 34),}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00056\ \ \ \ \ WALLET\_FLAG\_EXTERNAL\_SIGNER\ =\ (1ULL\ <<\ 35),}
\DoxyCodeLine{00057\ \};}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00060\ fs::path\ GetWalletDir();}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00063\ \textcolor{keyword}{class\ }WalletDescriptor}
\DoxyCodeLine{00064\ \{}
\DoxyCodeLine{00065\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00066\ \ \ \ \ std::shared\_ptr<Descriptor>\ descriptor;}
\DoxyCodeLine{00067\ \ \ \ \ uint256\ id;\ \textcolor{comment}{//\ Descriptor\ ID\ (calculated\ once\ at\ descriptor\ initialization/deserialization)}}
\DoxyCodeLine{00068\ \ \ \ \ uint64\_t\ creation\_time\ =\ 0;}
\DoxyCodeLine{00069\ \ \ \ \ int32\_t\ range\_start\ =\ 0;\ \textcolor{comment}{//\ First\ item\ in\ range;\ start\ of\ range,\ inclusive,\ i.e.\ [range\_start,\ range\_end).\ This\ never\ changes.}}
\DoxyCodeLine{00070\ \ \ \ \ int32\_t\ range\_end\ =\ 0;\ \textcolor{comment}{//\ Item\ after\ the\ last;\ end\ of\ range,\ exclusive,\ i.e.\ [range\_start,\ range\_end).\ This\ will\ increment\ with\ each\ TopUp()}}
\DoxyCodeLine{00071\ \ \ \ \ int32\_t\ next\_index\ =\ 0;\ \textcolor{comment}{//\ Position\ of\ the\ next\ item\ to\ generate}}
\DoxyCodeLine{00072\ \ \ \ \ DescriptorCache\ cache;}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordtype}{void}\ DeserializeDescriptor(\textcolor{keyword}{const}\ std::string\&\ str)}
\DoxyCodeLine{00075\ \ \ \ \ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ std::string\ error;}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ FlatSigningProvider\ keys;}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ descs\ =\ Parse(str,\ keys,\ error,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (descs.empty())\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::ios\_base::failure(\textcolor{stringliteral}{"{}Invalid\ descriptor:\ "{}}\ +\ error);}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (descs.size()\ >\ 1)\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::ios\_base::failure(\textcolor{stringliteral}{"{}Can't\ load\ a\ multipath\ descriptor\ from\ databases"{}});}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ descriptor\ =\ std::move(descs.at(0));}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{id}\ =\ DescriptorID(*descriptor);}
\DoxyCodeLine{00087\ \ \ \ \ \}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ SERIALIZE\_METHODS(WalletDescriptor,\ obj)}
\DoxyCodeLine{00090\ \ \ \ \ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ std::string\ descriptor\_str;}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ SER\_WRITE(obj,\ descriptor\_str\ =\ obj.descriptor-\/>ToString());}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ READWRITE(descriptor\_str,\ obj.creation\_time,\ obj.next\_index,\ obj.range\_start,\ obj.range\_end);}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ SER\_READ(obj,\ obj.DeserializeDescriptor(descriptor\_str));}
\DoxyCodeLine{00095\ \ \ \ \ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \ \ WalletDescriptor()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00098\ \ \ \ \ WalletDescriptor(std::shared\_ptr<Descriptor>\ descriptor,\ uint64\_t\ creation\_time,\ int32\_t\ range\_start,\ int32\_t\ range\_end,\ int32\_t\ next\_index)\ :\ descriptor(descriptor),\ id(DescriptorID(*descriptor)),\ creation\_time(creation\_time),\ range\_start(range\_start),\ range\_end(range\_end),\ next\_index(next\_index)\ \{\ \}}
\DoxyCodeLine{00099\ \};}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ WalletDescriptor\ GenerateWalletDescriptor(\textcolor{keyword}{const}\ CExtPubKey\&\ master\_key,\ \textcolor{keyword}{const}\ OutputType\&\ output\_type,\ \textcolor{keywordtype}{bool}\ internal);}
\DoxyCodeLine{00102\ \}\ \textcolor{comment}{//\ namespace\ wallet}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ BITCOIN\_WALLET\_WALLETUTIL\_H}}

\end{DoxyCode}
