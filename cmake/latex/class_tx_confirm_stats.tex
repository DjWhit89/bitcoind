\doxysection{Tx\+Confirm\+Stats Class Reference}
\label{class_tx_confirm_stats}\index{TxConfirmStats@{TxConfirmStats}}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\textbf{ Tx\+Confirm\+Stats} (const std\+::vector$<$ double $>$ \&default\+Buckets, const std\+::map$<$ double, unsigned int $>$ \&default\+Bucket\+Map, unsigned int max\+Periods, double decay, unsigned int scale)
\item 
void \textbf{ Clear\+Current} (unsigned int n\+Block\+Height)
\item 
void \textbf{ Record} (int blocks\+To\+Confirm, double val)
\item 
unsigned int \textbf{ New\+Tx} (unsigned int n\+Block\+Height, double val)
\item 
void \textbf{ remove\+Tx} (unsigned int entry\+Height, unsigned int n\+Best\+Seen\+Height, unsigned int bucket\+Index, bool in\+Block)
\item 
void \textbf{ Update\+Moving\+Averages} ()
\item 
double \textbf{ Estimate\+Median\+Val} (int conf\+Target, double sufficient\+Tx\+Val, double min\+Success, unsigned int n\+Block\+Height, \textbf{ Estimation\+Result} $\ast$result=nullptr) const
\item 
unsigned int \textbf{ Get\+Max\+Confirms} () const
\item 
void \textbf{ Write} (\textbf{ Auto\+File} \&fileout) const
\item 
void \textbf{ Read} (\textbf{ Auto\+File} \&filein, size\+\_\+t num\+Buckets)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
We will instantiate an instance of this class to track transactions that were included in a block. We will lump transactions into a bucket according to their approximate feerate and then track how long it took for those txs to be included in a block

The tracking of unconfirmed (mempool) transactions is completely independent of the historical tracking of transactions that have been confirmed in a block. 

\label{doc-constructors}
\doxysubsection{Constructor \& Destructor Documentation}
\index{TxConfirmStats@{TxConfirmStats}!TxConfirmStats@{TxConfirmStats}}
\index{TxConfirmStats@{TxConfirmStats}!TxConfirmStats@{TxConfirmStats}}
\doxysubsubsection{TxConfirmStats()}
{\footnotesize\ttfamily \label{class_tx_confirm_stats_ac7b4481c4965b9c4c17c8cf0990331c4} 
\textbf{ Tx\+Confirm\+Stats} (\begin{DoxyParamCaption}\item[{const std\+::vector$<$ double $>$ \&}]{default\+Buckets}{, }\item[{const std\+::map$<$ double, unsigned int $>$ \&}]{default\+Bucket\+Map}{, }\item[{unsigned int}]{max\+Periods}{, }\item[{double}]{decay}{, }\item[{unsigned int}]{scale}{}\end{DoxyParamCaption})}

Create new \doxyref{Tx\+Confirm\+Stats}{p.}{class_tx_confirm_stats}. This is called by Block\+Policy\+Estimator\textquotesingle{}s constructor with default values. 
\begin{DoxyParams}{Parameters}
{\em default\+Buckets} & contains the upper limits for the bucket boundaries \\
\hline
{\em max\+Periods} & max number of periods to track \\
\hline
{\em decay} & how much to decay the historical moving average per block \\
\hline
\end{DoxyParams}


\label{doc-func-members}
\doxysubsection{Member Function Documentation}
\index{TxConfirmStats@{TxConfirmStats}!ClearCurrent@{ClearCurrent}}
\index{ClearCurrent@{ClearCurrent}!TxConfirmStats@{TxConfirmStats}}
\doxysubsubsection{ClearCurrent()}
{\footnotesize\ttfamily \label{class_tx_confirm_stats_aa4969591ef8e28d6dbfebfe354b22739} 
void Clear\+Current (\begin{DoxyParamCaption}\item[{unsigned int}]{n\+Block\+Height}{}\end{DoxyParamCaption})}

Roll the circular buffer for unconfirmed txs \index{TxConfirmStats@{TxConfirmStats}!EstimateMedianVal@{EstimateMedianVal}}
\index{EstimateMedianVal@{EstimateMedianVal}!TxConfirmStats@{TxConfirmStats}}
\doxysubsubsection{EstimateMedianVal()}
{\footnotesize\ttfamily \label{class_tx_confirm_stats_a3f3b2a3c3e9038522985c4e70d2cee5c} 
double Estimate\+Median\+Val (\begin{DoxyParamCaption}\item[{int}]{conf\+Target}{, }\item[{double}]{sufficient\+Tx\+Val}{, }\item[{double}]{min\+Success}{, }\item[{unsigned int}]{n\+Block\+Height}{, }\item[{\textbf{ Estimation\+Result} $\ast$}]{result}{ = {\ttfamily nullptr}}\end{DoxyParamCaption}) const}

Calculate a feerate estimate. Find the lowest value bucket (or range of buckets to make sure we have enough data points) whose transactions still have sufficient likelihood of being confirmed within the target number of confirmations 
\begin{DoxyParams}{Parameters}
{\em conf\+Target} & target number of confirmations \\
\hline
{\em sufficient\+Tx\+Val} & required average number of transactions per block in a bucket range \\
\hline
{\em min\+Success} & the success probability we require \\
\hline
{\em n\+Block\+Height} & the current block height \\
\hline
\end{DoxyParams}
\index{TxConfirmStats@{TxConfirmStats}!GetMaxConfirms@{GetMaxConfirms}}
\index{GetMaxConfirms@{GetMaxConfirms}!TxConfirmStats@{TxConfirmStats}}
\doxysubsubsection{GetMaxConfirms()}
{\footnotesize\ttfamily \label{class_tx_confirm_stats_a1780f7ece2fba74410d5f132f2c07e1b} 
unsigned int Get\+Max\+Confirms (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}

Return the max number of confirms we\textquotesingle{}re tracking \index{TxConfirmStats@{TxConfirmStats}!NewTx@{NewTx}}
\index{NewTx@{NewTx}!TxConfirmStats@{TxConfirmStats}}
\doxysubsubsection{NewTx()}
{\footnotesize\ttfamily \label{class_tx_confirm_stats_a216f28be9a9cb676ad34f883130e723a} 
unsigned int New\+Tx (\begin{DoxyParamCaption}\item[{unsigned int}]{n\+Block\+Height}{, }\item[{double}]{val}{}\end{DoxyParamCaption})}

Record a new transaction entering the mempool \index{TxConfirmStats@{TxConfirmStats}!Read@{Read}}
\index{Read@{Read}!TxConfirmStats@{TxConfirmStats}}
\doxysubsubsection{Read()}
{\footnotesize\ttfamily \label{class_tx_confirm_stats_af5ea5b73531ffb775c4f9fe157feeaaf} 
void Read (\begin{DoxyParamCaption}\item[{\textbf{ Auto\+File} \&}]{filein}{, }\item[{size\+\_\+t}]{num\+Buckets}{}\end{DoxyParamCaption})}

Read saved state of estimation data from a file and replace all internal data structures and variables with this state. \index{TxConfirmStats@{TxConfirmStats}!Record@{Record}}
\index{Record@{Record}!TxConfirmStats@{TxConfirmStats}}
\doxysubsubsection{Record()}
{\footnotesize\ttfamily \label{class_tx_confirm_stats_ac3150d4b839c8e61aff5c75e512b2fbe} 
void Record (\begin{DoxyParamCaption}\item[{int}]{blocks\+To\+Confirm}{, }\item[{double}]{val}{}\end{DoxyParamCaption})}

Record a new transaction data point in the current block stats 
\begin{DoxyParams}{Parameters}
{\em blocks\+To\+Confirm} & the number of blocks it took this transaction to confirm \\
\hline
{\em val} & the feerate of the transaction \\
\hline
\end{DoxyParams}
\begin{DoxyWarning}{Warning}
blocks\+To\+Confirm is 1-\/based and has to be $>$= 1 
\end{DoxyWarning}
\index{TxConfirmStats@{TxConfirmStats}!removeTx@{removeTx}}
\index{removeTx@{removeTx}!TxConfirmStats@{TxConfirmStats}}
\doxysubsubsection{removeTx()}
{\footnotesize\ttfamily \label{class_tx_confirm_stats_a9071ab202d08ede3278412045288f14a} 
void remove\+Tx (\begin{DoxyParamCaption}\item[{unsigned int}]{entry\+Height}{, }\item[{unsigned int}]{n\+Best\+Seen\+Height}{, }\item[{unsigned int}]{bucket\+Index}{, }\item[{bool}]{in\+Block}{}\end{DoxyParamCaption})}

Remove a transaction from mempool tracking stats \index{TxConfirmStats@{TxConfirmStats}!UpdateMovingAverages@{UpdateMovingAverages}}
\index{UpdateMovingAverages@{UpdateMovingAverages}!TxConfirmStats@{TxConfirmStats}}
\doxysubsubsection{UpdateMovingAverages()}
{\footnotesize\ttfamily \label{class_tx_confirm_stats_a544feb81331431764ca22fed70c0c594} 
void Update\+Moving\+Averages (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

Update our estimates by decaying our historical moving average and updating with the data gathered from the current block \index{TxConfirmStats@{TxConfirmStats}!Write@{Write}}
\index{Write@{Write}!TxConfirmStats@{TxConfirmStats}}
\doxysubsubsection{Write()}
{\footnotesize\ttfamily \label{class_tx_confirm_stats_a2b650cb03a6aa607e58d9236b617106e} 
void Write (\begin{DoxyParamCaption}\item[{\textbf{ Auto\+File} \&}]{fileout}{}\end{DoxyParamCaption}) const}

Write state of estimation data to a file 

The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
src/policy/fees/\textbf{ block\+\_\+policy\+\_\+estimator.\+cpp}\end{DoxyCompactItemize}
