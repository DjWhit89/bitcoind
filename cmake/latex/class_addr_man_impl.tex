\doxysection{Addr\+Man\+Impl Class Reference}
\label{class_addr_man_impl}\index{AddrManImpl@{AddrManImpl}}


{\ttfamily \#include $<$addrman\+\_\+impl.\+h$>$}

\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\textbf{ Addr\+Man\+Impl} (const \textbf{ Net\+Group\+Manager} \&netgroupman, bool deterministic, int32\+\_\+t consistency\+\_\+check\+\_\+ratio)
\item 
\textbf{ $\sim$\+Addr\+Man\+Impl} ()
\item 
{\footnotesize template$<$typename Stream$>$ }\\void \textbf{ Serialize} (Stream \&s\+\_\+) const \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(!\textbf{ cs})
\item 
{\footnotesize template$<$typename Stream$>$ }\\void \textbf{ Unserialize} (Stream \&s\+\_\+) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(!\textbf{ cs})
\item 
size\+\_\+t \textbf{ Size} (std\+::optional$<$ \textbf{ Network} $>$ net, std\+::optional$<$ bool $>$ in\+\_\+new) const \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(!\textbf{ cs})
\item 
bool \textbf{ Add} (const std\+::vector$<$ \textbf{ CAddress} $>$ \&v\+Addr, const \textbf{ CNet\+Addr} \&source, std\+::chrono\+::seconds time\+\_\+penalty) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(!\textbf{ cs})
\item 
bool \textbf{ Good} (const \textbf{ CService} \&addr, \textbf{ Node\+Seconds} time) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(!\textbf{ cs})
\item 
void \textbf{ Attempt} (const \textbf{ CService} \&addr, bool f\+Count\+Failure, \textbf{ Node\+Seconds} time) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(!\textbf{ cs})
\item 
void \textbf{ Resolve\+Collisions} () \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(!\textbf{ cs})
\item 
std\+::pair$<$ \textbf{ CAddress}, \textbf{ Node\+Seconds} $>$ \textbf{ Select\+Tried\+Collision} () \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(!\textbf{ cs})
\item 
std\+::pair$<$ \textbf{ CAddress}, \textbf{ Node\+Seconds} $>$ \textbf{ Select} (bool new\+\_\+only, const std\+::unordered\+\_\+set$<$ \textbf{ Network} $>$ \&networks) const \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(!\textbf{ cs})
\item 
std\+::vector$<$ \textbf{ CAddress} $>$ \textbf{ Get\+Addr} (size\+\_\+t max\+\_\+addresses, size\+\_\+t max\+\_\+pct, std\+::optional$<$ \textbf{ Network} $>$ network, const bool filtered=true) const \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(!\textbf{ cs})
\item 
std\+::vector$<$ std\+::pair$<$ \textbf{ Addr\+Info}, \textbf{ Address\+Position} $>$ $>$ \textbf{ Get\+Entries} (bool from\+\_\+tried) const \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(!\textbf{ cs})
\item 
void \textbf{ Connected} (const \textbf{ CService} \&addr, \textbf{ Node\+Seconds} time) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(!\textbf{ cs})
\item 
void \textbf{ Set\+Services} (const \textbf{ CService} \&addr, \textbf{ Service\+Flags} n\+Services) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(!\textbf{ cs})
\item 
std\+::optional$<$ \textbf{ Address\+Position} $>$ \textbf{ Find\+Address\+Entry} (const \textbf{ CAddress} \&addr) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(!\textbf{ cs})
\end{DoxyCompactItemize}
\doxysubsubsection*{Friends}
\begin{DoxyCompactItemize}
\item 
class \textbf{ Addr\+Man\+Deterministic}
\end{DoxyCompactItemize}


\label{doc-constructors}
\doxysubsection{Constructor \& Destructor Documentation}
\index{AddrManImpl@{AddrManImpl}!AddrManImpl@{AddrManImpl}}
\index{AddrManImpl@{AddrManImpl}!AddrManImpl@{AddrManImpl}}
\doxysubsubsection{AddrManImpl()}
{\footnotesize\ttfamily \label{class_addr_man_impl_ae981de274b571f582034a35046fcccf4} 
\textbf{ Addr\+Man\+Impl} (\begin{DoxyParamCaption}\item[{const \textbf{ Net\+Group\+Manager} \&}]{netgroupman}{, }\item[{bool}]{deterministic}{, }\item[{int32\+\_\+t}]{consistency\+\_\+check\+\_\+ratio}{}\end{DoxyParamCaption})}

\index{AddrManImpl@{AddrManImpl}!````~AddrManImpl@{$\sim$AddrManImpl}}
\index{````~AddrManImpl@{$\sim$AddrManImpl}!AddrManImpl@{AddrManImpl}}
\doxysubsubsection{$\sim$AddrManImpl()}
{\footnotesize\ttfamily \label{class_addr_man_impl_abbe49778d10d4859a1225978a7b590fc} 
$\sim$\textbf{ Addr\+Man\+Impl} (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



\label{doc-func-members}
\doxysubsection{Member Function Documentation}
\index{AddrManImpl@{AddrManImpl}!Add@{Add}}
\index{Add@{Add}!AddrManImpl@{AddrManImpl}}
\doxysubsubsection{Add()}
{\footnotesize\ttfamily \label{class_addr_man_impl_a4653c9496843315c1670635768e0f7ce} 
bool Add (\begin{DoxyParamCaption}\item[{const std\+::vector$<$ \textbf{ CAddress} $>$ \&}]{v\+Addr}{, }\item[{const \textbf{ CNet\+Addr} \&}]{source}{, }\item[{std\+::chrono\+::seconds}]{time\+\_\+penalty}{}\end{DoxyParamCaption})}

\index{AddrManImpl@{AddrManImpl}!Attempt@{Attempt}}
\index{Attempt@{Attempt}!AddrManImpl@{AddrManImpl}}
\doxysubsubsection{Attempt()}
{\footnotesize\ttfamily \label{class_addr_man_impl_a5a2a9c5a54df871e3fa2f92566539966} 
void Attempt (\begin{DoxyParamCaption}\item[{const \textbf{ CService} \&}]{addr}{, }\item[{bool}]{f\+Count\+Failure}{, }\item[{\textbf{ Node\+Seconds}}]{time}{}\end{DoxyParamCaption})}

\index{AddrManImpl@{AddrManImpl}!Connected@{Connected}}
\index{Connected@{Connected}!AddrManImpl@{AddrManImpl}}
\doxysubsubsection{Connected()}
{\footnotesize\ttfamily \label{class_addr_man_impl_ad08532d27f1be61e3db2fa71cacf1ac5} 
void Connected (\begin{DoxyParamCaption}\item[{const \textbf{ CService} \&}]{addr}{, }\item[{\textbf{ Node\+Seconds}}]{time}{}\end{DoxyParamCaption})}

\index{AddrManImpl@{AddrManImpl}!FindAddressEntry@{FindAddressEntry}}
\index{FindAddressEntry@{FindAddressEntry}!AddrManImpl@{AddrManImpl}}
\doxysubsubsection{FindAddressEntry()}
{\footnotesize\ttfamily \label{class_addr_man_impl_a7dd4896af86af1cc8a8ba9b3f1d54574} 
std\+::optional$<$ \textbf{ Address\+Position} $>$ Find\+Address\+Entry (\begin{DoxyParamCaption}\item[{const \textbf{ CAddress} \&}]{addr}{}\end{DoxyParamCaption})}

\index{AddrManImpl@{AddrManImpl}!GetAddr@{GetAddr}}
\index{GetAddr@{GetAddr}!AddrManImpl@{AddrManImpl}}
\doxysubsubsection{GetAddr()}
{\footnotesize\ttfamily \label{class_addr_man_impl_a519df0d13a30b36cb2aaf4df76a39552} 
std\+::vector$<$ \textbf{ CAddress} $>$ Get\+Addr (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{max\+\_\+addresses}{, }\item[{size\+\_\+t}]{max\+\_\+pct}{, }\item[{std\+::optional$<$ \textbf{ Network} $>$}]{network}{, }\item[{const bool}]{filtered}{ = {\ttfamily true}}\end{DoxyParamCaption}) const}

\index{AddrManImpl@{AddrManImpl}!GetEntries@{GetEntries}}
\index{GetEntries@{GetEntries}!AddrManImpl@{AddrManImpl}}
\doxysubsubsection{GetEntries()}
{\footnotesize\ttfamily \label{class_addr_man_impl_a4345dd4d139b751bc3e30f0f51d7b2d6} 
std\+::vector$<$ std\+::pair$<$ \textbf{ Addr\+Info}, \textbf{ Address\+Position} $>$ $>$ Get\+Entries (\begin{DoxyParamCaption}\item[{bool}]{from\+\_\+tried}{}\end{DoxyParamCaption}) const}

\index{AddrManImpl@{AddrManImpl}!Good@{Good}}
\index{Good@{Good}!AddrManImpl@{AddrManImpl}}
\doxysubsubsection{Good()}
{\footnotesize\ttfamily \label{class_addr_man_impl_abcfa5f1d344384a930b173a4bedb4566} 
bool Good (\begin{DoxyParamCaption}\item[{const \textbf{ CService} \&}]{addr}{, }\item[{\textbf{ Node\+Seconds}}]{time}{}\end{DoxyParamCaption})}

\index{AddrManImpl@{AddrManImpl}!ResolveCollisions@{ResolveCollisions}}
\index{ResolveCollisions@{ResolveCollisions}!AddrManImpl@{AddrManImpl}}
\doxysubsubsection{ResolveCollisions()}
{\footnotesize\ttfamily \label{class_addr_man_impl_a6ef14775492514185143511422f84819} 
void Resolve\+Collisions (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

\index{AddrManImpl@{AddrManImpl}!Select@{Select}}
\index{Select@{Select}!AddrManImpl@{AddrManImpl}}
\doxysubsubsection{Select()}
{\footnotesize\ttfamily \label{class_addr_man_impl_ac5afc4d567db957b555f87fa4ab9ee78} 
std\+::pair$<$ \textbf{ CAddress}, \textbf{ Node\+Seconds} $>$ Select (\begin{DoxyParamCaption}\item[{bool}]{new\+\_\+only}{, }\item[{const std\+::unordered\+\_\+set$<$ \textbf{ Network} $>$ \&}]{networks}{}\end{DoxyParamCaption}) const}

\index{AddrManImpl@{AddrManImpl}!SelectTriedCollision@{SelectTriedCollision}}
\index{SelectTriedCollision@{SelectTriedCollision}!AddrManImpl@{AddrManImpl}}
\doxysubsubsection{SelectTriedCollision()}
{\footnotesize\ttfamily \label{class_addr_man_impl_a5570a021bc7c06cea2a018536571d140} 
std\+::pair$<$ \textbf{ CAddress}, \textbf{ Node\+Seconds} $>$ Select\+Tried\+Collision (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

\index{AddrManImpl@{AddrManImpl}!Serialize@{Serialize}}
\index{Serialize@{Serialize}!AddrManImpl@{AddrManImpl}}
\doxysubsubsection{Serialize()}
{\footnotesize\ttfamily \label{class_addr_man_impl_a838183b442e73b18a6a855e456e79efe} 
template$<$typename Stream$>$ \\
void Serialize (\begin{DoxyParamCaption}\item[{Stream \&}]{s\+\_\+}{}\end{DoxyParamCaption}) const}

Serialized format.
\begin{DoxyItemize}
\item format version byte (\begin{DoxySeeAlso}{See also}
{\ttfamily \doxyref{Format}{p.}{struct_format}})
\end{DoxySeeAlso}

\item lowest compatible format version byte. This is used to help old software decide whether to parse the file. For example\+:
\begin{DoxyItemize}
\item Bitcoin Core version N knows how to parse up to format=3. If a new format=4 is introduced in version N+1 that is compatible with format=3 and it is known that version N will be able to parse it, then version N+1 will write (format=4, lowest\+\_\+compatible=3) in the first two bytes of the file, and so version N will still try to parse it.
\item Bitcoin Core version N+2 introduces a new incompatible format=5. It will write (format=5, lowest\+\_\+compatible=5) and so any versions that do not know how to parse format=5 will not try to read the file.
\end{DoxyItemize}
\item n\+Key
\item n\+New
\item n\+Tried
\item number of "{}new"{} buckets XOR 2$\ast$$\ast$30
\item all new addresses (total count\+: n\+New)
\item all tried addresses (total count\+: n\+Tried)
\item for each new bucket\+:
\begin{DoxyItemize}
\item number of elements
\item for each element\+: index in the serialized "{}all new addresses"{}
\end{DoxyItemize}
\item asmap checksum
\end{DoxyItemize}

2$\ast$$\ast$30 is xorred with the number of buckets to make addrman deserializer v0 detect it as incompatible. This is necessary because it did not check the version number on deserialization.

vv\+New, vv\+Tried, map\+Info, map\+Addr and v\+Random are never encoded explicitly; they are instead reconstructed from the other information.

This format is more complex, but significantly smaller (at most 1.\+5 MiB), and supports changes to the ADDRMAN\+\_\+ parameters without breaking the on-\/disk structure.

We don\textquotesingle{}t use SERIALIZE\+\_\+\+METHODS since the serialization and deserialization code has very little in common.\index{AddrManImpl@{AddrManImpl}!SetServices@{SetServices}}
\index{SetServices@{SetServices}!AddrManImpl@{AddrManImpl}}
\doxysubsubsection{SetServices()}
{\footnotesize\ttfamily \label{class_addr_man_impl_abbdc9822d1960b2ac42dce4b74f4caa7} 
void Set\+Services (\begin{DoxyParamCaption}\item[{const \textbf{ CService} \&}]{addr}{, }\item[{\textbf{ Service\+Flags}}]{n\+Services}{}\end{DoxyParamCaption})}

\index{AddrManImpl@{AddrManImpl}!Size@{Size}}
\index{Size@{Size}!AddrManImpl@{AddrManImpl}}
\doxysubsubsection{Size()}
{\footnotesize\ttfamily \label{class_addr_man_impl_ac5482e93366310eeb3e62268ed6e7ea8} 
size\+\_\+t Size (\begin{DoxyParamCaption}\item[{std\+::optional$<$ \textbf{ Network} $>$}]{net}{, }\item[{std\+::optional$<$ bool $>$}]{in\+\_\+new}{}\end{DoxyParamCaption}) const}

\index{AddrManImpl@{AddrManImpl}!Unserialize@{Unserialize}}
\index{Unserialize@{Unserialize}!AddrManImpl@{AddrManImpl}}
\doxysubsubsection{Unserialize()}
{\footnotesize\ttfamily \label{class_addr_man_impl_a5f6200bcf60851037312de557d74ce01} 
template$<$typename Stream$>$ \\
void Unserialize (\begin{DoxyParamCaption}\item[{Stream \&}]{s\+\_\+}{}\end{DoxyParamCaption})}



\label{doc-related-members}
\doxysubsection{Friends And Related Symbol Documentation}
\index{AddrManImpl@{AddrManImpl}!AddrManDeterministic@{AddrManDeterministic}}
\index{AddrManDeterministic@{AddrManDeterministic}!AddrManImpl@{AddrManImpl}}
\doxysubsubsection{AddrManDeterministic}
{\footnotesize\ttfamily \label{class_addr_man_impl_a6c4ab126dd4e8c67ff43bf333d6b1228} 
friend class \textbf{ Addr\+Man\+Deterministic}\hspace{0.3cm}{\ttfamily [friend]}}



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
src/\textbf{ addrman\+\_\+impl.\+h}\item 
src/\textbf{ addrman.\+cpp}\end{DoxyCompactItemize}
