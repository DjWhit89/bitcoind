\doxysection{src/net.cpp File Reference}
\label{net_8cpp}\index{src/net.cpp@{src/net.cpp}}
{\ttfamily \#include $<$bitcoin-\/build-\/config.\+h$>$}\newline
{\ttfamily \#include $<$net.\+h$>$}\newline
{\ttfamily \#include $<$addrdb.\+h$>$}\newline
{\ttfamily \#include $<$addrman.\+h$>$}\newline
{\ttfamily \#include $<$banman.\+h$>$}\newline
{\ttfamily \#include $<$clientversion.\+h$>$}\newline
{\ttfamily \#include $<$common/args.\+h$>$}\newline
{\ttfamily \#include $<$common/netif.\+h$>$}\newline
{\ttfamily \#include $<$compat/compat.\+h$>$}\newline
{\ttfamily \#include $<$consensus/consensus.\+h$>$}\newline
{\ttfamily \#include $<$crypto/sha256.\+h$>$}\newline
{\ttfamily \#include $<$i2p.\+h$>$}\newline
{\ttfamily \#include $<$key.\+h$>$}\newline
{\ttfamily \#include $<$logging.\+h$>$}\newline
{\ttfamily \#include $<$memusage.\+h$>$}\newline
{\ttfamily \#include $<$net\+\_\+permissions.\+h$>$}\newline
{\ttfamily \#include $<$netaddress.\+h$>$}\newline
{\ttfamily \#include $<$netbase.\+h$>$}\newline
{\ttfamily \#include $<$node/eviction.\+h$>$}\newline
{\ttfamily \#include $<$node/interface\+\_\+ui.\+h$>$}\newline
{\ttfamily \#include $<$protocol.\+h$>$}\newline
{\ttfamily \#include $<$random.\+h$>$}\newline
{\ttfamily \#include $<$scheduler.\+h$>$}\newline
{\ttfamily \#include $<$util/fs.\+h$>$}\newline
{\ttfamily \#include $<$util/sock.\+h$>$}\newline
{\ttfamily \#include $<$util/strencodings.\+h$>$}\newline
{\ttfamily \#include $<$util/thread.\+h$>$}\newline
{\ttfamily \#include $<$util/threadinterrupt.\+h$>$}\newline
{\ttfamily \#include $<$util/trace.\+h$>$}\newline
{\ttfamily \#include $<$util/translation.\+h$>$}\newline
{\ttfamily \#include $<$util/vector.\+h$>$}\newline
{\ttfamily \#include $<$algorithm$>$}\newline
{\ttfamily \#include $<$array$>$}\newline
{\ttfamily \#include $<$cmath$>$}\newline
{\ttfamily \#include $<$cstdint$>$}\newline
{\ttfamily \#include $<$cstring$>$}\newline
{\ttfamily \#include $<$functional$>$}\newline
{\ttfamily \#include $<$optional$>$}\newline
{\ttfamily \#include $<$string\+\_\+view$>$}\newline
{\ttfamily \#include $<$unordered\+\_\+map$>$}\newline
\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
class \textbf{ CNet\+Cleanup}
\end{DoxyCompactItemize}
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \textbf{ X}(\textbf{ name})
\end{DoxyCompactItemize}
\doxysubsubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \textbf{ Bind\+Flags} \{ \textbf{ BF\+\_\+\+NONE} = 0
, \textbf{ BF\+\_\+\+REPORT\+\_\+\+ERROR} = (1U $<$$<$ 0)
, \textbf{ BF\+\_\+\+DONT\+\_\+\+ADVERTISE} = (1U $<$$<$ 1)
 \}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\textbf{ TRACEPOINT\+\_\+\+SEMAPHORE} (net, closed\+\_\+connection)
\item 
\textbf{ TRACEPOINT\+\_\+\+SEMAPHORE} (net, evicted\+\_\+inbound\+\_\+connection)
\item 
\textbf{ TRACEPOINT\+\_\+\+SEMAPHORE} (net, inbound\+\_\+connection)
\item 
\textbf{ TRACEPOINT\+\_\+\+SEMAPHORE} (net, outbound\+\_\+connection)
\item 
\textbf{ TRACEPOINT\+\_\+\+SEMAPHORE} (net, outbound\+\_\+message)
\item 
std\+::map$<$ \textbf{ CNet\+Addr}, \textbf{ Local\+Service\+Info} $>$ map\+Local\+Host \textbf{ GUARDED\+\_\+\+BY} (\textbf{ g\+\_\+maplocalhost\+\_\+mutex})
\item 
uint16\+\_\+t \textbf{ Get\+Listen\+Port} ()
\item 
\textbf{ CService} \textbf{ Get\+Local\+Address} (const \textbf{ CNode} \&peer)
\item 
std\+::optional$<$ \textbf{ CService} $>$ \textbf{ Get\+Local\+Addr\+For\+Peer} (\textbf{ CNode} \&\textbf{ node})
\item 
void \textbf{ Clear\+Local} ()
\item 
bool \textbf{ Add\+Local} (const \textbf{ CService} \&addr\+\_\+, int n\+Score)
\item 
bool \textbf{ Add\+Local} (const \textbf{ CNet\+Addr} \&addr, int n\+Score)
\item 
void \textbf{ Remove\+Local} (const \textbf{ CService} \&addr)
\item 
bool \textbf{ Seen\+Local} (const \textbf{ CService} \&addr)
\item 
bool \textbf{ Is\+Local} (const \textbf{ CService} \&addr)
\item 
void \textbf{ Discover} ()
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const char $\ast$const \textbf{ ANCHORS\+\_\+\+DATABASE\+\_\+\+FILENAME} = "{}anchors.\+dat"{}
\item 
const std\+::string \textbf{ NET\+\_\+\+MESSAGE\+\_\+\+TYPE\+\_\+\+OTHER} = "{}$\ast$other$\ast$"{}
\item 
bool \textbf{ f\+Discover} = true
\item 
bool \textbf{ f\+Listen} = true
\item 
\textbf{ Global\+Mutex} \textbf{ g\+\_\+maplocalhost\+\_\+mutex}
\item 
std\+::string \textbf{ str\+Sub\+Version}
\item 
std\+::function$<$ void(const \textbf{ CAddress} \&addr, const std\+::string \&msg\+\_\+type, std\+::span$<$ const unsigned char $>$ data, bool is\+\_\+incoming)$>$ \textbf{ Capture\+Message} = Capture\+Message\+To\+File
\end{DoxyCompactItemize}


\label{doc-define-members}
\doxysubsection{Macro Definition Documentation}
\index{net.cpp@{net.cpp}!X@{X}}
\index{X@{X}!net.cpp@{net.cpp}}
\doxysubsubsection{X}
{\footnotesize\ttfamily \label{net_8cpp_a826edd40636cbaa44266b97c8c6a4fa3} 
\#define X(\begin{DoxyParamCaption}\item[{}]{\textbf{ name}}{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{stats.name\ =\ name}

\end{DoxyCode}


\label{doc-enum-members}
\doxysubsection{Enumeration Type Documentation}
\index{net.cpp@{net.cpp}!BindFlags@{BindFlags}}
\index{BindFlags@{BindFlags}!net.cpp@{net.cpp}}
\doxysubsubsection{BindFlags}
{\footnotesize\ttfamily \label{net_8cpp_a3517133609e0c817dd6f9bb02709d55b} 
enum \textbf{ Bind\+Flags}}

Used to pass flags to the Bind() function \begin{DoxyEnumFields}[2]{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{BF\_NONE@{BF\_NONE}!net.cpp@{net.cpp}}\index{net.cpp@{net.cpp}!BF\_NONE@{BF\_NONE}}}\label{net_8cpp_a3517133609e0c817dd6f9bb02709d55ba56bcbe6f723de8f81d35d38964aab421} 
BF\+\_\+\+NONE&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{BF\_REPORT\_ERROR@{BF\_REPORT\_ERROR}!net.cpp@{net.cpp}}\index{net.cpp@{net.cpp}!BF\_REPORT\_ERROR@{BF\_REPORT\_ERROR}}}\label{net_8cpp_a3517133609e0c817dd6f9bb02709d55ba28a641df14737c21a9fd1f4bdd2458be} 
BF\+\_\+\+REPORT\+\_\+\+ERROR&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{BF\_DONT\_ADVERTISE@{BF\_DONT\_ADVERTISE}!net.cpp@{net.cpp}}\index{net.cpp@{net.cpp}!BF\_DONT\_ADVERTISE@{BF\_DONT\_ADVERTISE}}}\label{net_8cpp_a3517133609e0c817dd6f9bb02709d55bab22f398353baf6307b3ce828ec49189b} 
BF\+\_\+\+DONT\+\_\+\+ADVERTISE&Do not call \doxyref{Add\+Local()}{p.}{net_8cpp_a4f6e53907e84dcb0c8ad532a0438d8e2} for our special addresses, e.\+g., for incoming Tor connections, to prevent gossiping them over the network. \\
\hline

\end{DoxyEnumFields}


\label{doc-func-members}
\doxysubsection{Function Documentation}
\index{net.cpp@{net.cpp}!AddLocal@{AddLocal}}
\index{AddLocal@{AddLocal}!net.cpp@{net.cpp}}
\doxysubsubsection{AddLocal()\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \label{net_8cpp_a5a95db59a5d1a78e0d8694ae48d205cd} 
bool Add\+Local (\begin{DoxyParamCaption}\item[{const \textbf{ CNet\+Addr} \&}]{addr}{, }\item[{int}]{n\+Score}{}\end{DoxyParamCaption})}

\index{net.cpp@{net.cpp}!AddLocal@{AddLocal}}
\index{AddLocal@{AddLocal}!net.cpp@{net.cpp}}
\doxysubsubsection{AddLocal()\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \label{net_8cpp_a4f6e53907e84dcb0c8ad532a0438d8e2} 
bool Add\+Local (\begin{DoxyParamCaption}\item[{const \textbf{ CService} \&}]{addr\+\_\+}{, }\item[{int}]{n\+Score}{}\end{DoxyParamCaption})}

\index{net.cpp@{net.cpp}!ClearLocal@{ClearLocal}}
\index{ClearLocal@{ClearLocal}!net.cpp@{net.cpp}}
\doxysubsubsection{ClearLocal()}
{\footnotesize\ttfamily \label{net_8cpp_a47f478eddfe8533597b15bd24f879bd0} 
void Clear\+Local (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

\index{net.cpp@{net.cpp}!Discover@{Discover}}
\index{Discover@{Discover}!net.cpp@{net.cpp}}
\doxysubsubsection{Discover()}
{\footnotesize\ttfamily \label{net_8cpp_af69db74c5fca7ac2e39ab3c412de3dd4} 
void Discover (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

Look up IP addresses from all interfaces on the machine and add them to the list of local addresses to self-\/advertise. The loopback interface is skipped. \index{net.cpp@{net.cpp}!GetListenPort@{GetListenPort}}
\index{GetListenPort@{GetListenPort}!net.cpp@{net.cpp}}
\doxysubsubsection{GetListenPort()}
{\footnotesize\ttfamily \label{net_8cpp_a0b987d6723d8ce3ee02e68a29f4c9905} 
uint16\+\_\+t Get\+Listen\+Port (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

\index{net.cpp@{net.cpp}!GetLocalAddress@{GetLocalAddress}}
\index{GetLocalAddress@{GetLocalAddress}!net.cpp@{net.cpp}}
\doxysubsubsection{GetLocalAddress()}
{\footnotesize\ttfamily \label{net_8cpp_ab4069dda423216abc1d08df70769d5a6} 
\textbf{ CService} Get\+Local\+Address (\begin{DoxyParamCaption}\item[{const \textbf{ CNode} \&}]{peer}{}\end{DoxyParamCaption})}

\index{net.cpp@{net.cpp}!GetLocalAddrForPeer@{GetLocalAddrForPeer}}
\index{GetLocalAddrForPeer@{GetLocalAddrForPeer}!net.cpp@{net.cpp}}
\doxysubsubsection{GetLocalAddrForPeer()}
{\footnotesize\ttfamily \label{net_8cpp_a72e179fd909099452d43c48470ed4eaa} 
std\+::optional$<$ \textbf{ CService} $>$ Get\+Local\+Addr\+For\+Peer (\begin{DoxyParamCaption}\item[{\textbf{ CNode} \&}]{node}{}\end{DoxyParamCaption})}

Returns a local address that we should advertise to this peer. \index{net.cpp@{net.cpp}!GUARDED\_BY@{GUARDED\_BY}}
\index{GUARDED\_BY@{GUARDED\_BY}!net.cpp@{net.cpp}}
\doxysubsubsection{GUARDED\_BY()}
{\footnotesize\ttfamily \label{net_8cpp_ab83e5bc27017a7a4693ab967bab2029a} 
std\+::map$<$ \textbf{ CNet\+Addr}, \textbf{ Local\+Service\+Info} $>$ map\+Local\+Host GUARDED\+\_\+\+BY (\begin{DoxyParamCaption}\item[{\textbf{ g\+\_\+maplocalhost\+\_\+mutex}}]{}{}\end{DoxyParamCaption})}

\index{net.cpp@{net.cpp}!IsLocal@{IsLocal}}
\index{IsLocal@{IsLocal}!net.cpp@{net.cpp}}
\doxysubsubsection{IsLocal()}
{\footnotesize\ttfamily \label{net_8cpp_a16fa1bd4d34c4c29c90903fc3cdf7517} 
bool Is\+Local (\begin{DoxyParamCaption}\item[{const \textbf{ CService} \&}]{addr}{}\end{DoxyParamCaption})}

check whether a given address is potentially local \index{net.cpp@{net.cpp}!RemoveLocal@{RemoveLocal}}
\index{RemoveLocal@{RemoveLocal}!net.cpp@{net.cpp}}
\doxysubsubsection{RemoveLocal()}
{\footnotesize\ttfamily \label{net_8cpp_a298d283732067adcbd421b66327413f8} 
void Remove\+Local (\begin{DoxyParamCaption}\item[{const \textbf{ CService} \&}]{addr}{}\end{DoxyParamCaption})}

\index{net.cpp@{net.cpp}!SeenLocal@{SeenLocal}}
\index{SeenLocal@{SeenLocal}!net.cpp@{net.cpp}}
\doxysubsubsection{SeenLocal()}
{\footnotesize\ttfamily \label{net_8cpp_af7487aacfc9d708b3db40c255ec070a8} 
bool Seen\+Local (\begin{DoxyParamCaption}\item[{const \textbf{ CService} \&}]{addr}{}\end{DoxyParamCaption})}

vote for a local address \index{net.cpp@{net.cpp}!TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}}
\index{TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}!net.cpp@{net.cpp}}
\doxysubsubsection{TRACEPOINT\_SEMAPHORE()\hspace{0.1cm}{\footnotesize\ttfamily [1/5]}}
{\footnotesize\ttfamily \label{net_8cpp_a7f2b101ec417cf7f4064127de2941443} 
TRACEPOINT\+\_\+\+SEMAPHORE (\begin{DoxyParamCaption}\item[{net}]{}{, }\item[{closed\+\_\+connection}]{}{}\end{DoxyParamCaption})}

\index{net.cpp@{net.cpp}!TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}}
\index{TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}!net.cpp@{net.cpp}}
\doxysubsubsection{TRACEPOINT\_SEMAPHORE()\hspace{0.1cm}{\footnotesize\ttfamily [2/5]}}
{\footnotesize\ttfamily \label{net_8cpp_ad363714c1e3e1f28fffbd07042bc21ec} 
TRACEPOINT\+\_\+\+SEMAPHORE (\begin{DoxyParamCaption}\item[{net}]{}{, }\item[{evicted\+\_\+inbound\+\_\+connection}]{}{}\end{DoxyParamCaption})}

\index{net.cpp@{net.cpp}!TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}}
\index{TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}!net.cpp@{net.cpp}}
\doxysubsubsection{TRACEPOINT\_SEMAPHORE()\hspace{0.1cm}{\footnotesize\ttfamily [3/5]}}
{\footnotesize\ttfamily \label{net_8cpp_a73a99d3471616ce28e7cef6b75792a3e} 
TRACEPOINT\+\_\+\+SEMAPHORE (\begin{DoxyParamCaption}\item[{net}]{}{, }\item[{inbound\+\_\+connection}]{}{}\end{DoxyParamCaption})}

\index{net.cpp@{net.cpp}!TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}}
\index{TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}!net.cpp@{net.cpp}}
\doxysubsubsection{TRACEPOINT\_SEMAPHORE()\hspace{0.1cm}{\footnotesize\ttfamily [4/5]}}
{\footnotesize\ttfamily \label{net_8cpp_a2c547403e74c5649bf9de57fb9966b40} 
TRACEPOINT\+\_\+\+SEMAPHORE (\begin{DoxyParamCaption}\item[{net}]{}{, }\item[{outbound\+\_\+connection}]{}{}\end{DoxyParamCaption})}

\index{net.cpp@{net.cpp}!TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}}
\index{TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}!net.cpp@{net.cpp}}
\doxysubsubsection{TRACEPOINT\_SEMAPHORE()\hspace{0.1cm}{\footnotesize\ttfamily [5/5]}}
{\footnotesize\ttfamily \label{net_8cpp_a3e55456beeb7dd157e96e879dccf7f30} 
TRACEPOINT\+\_\+\+SEMAPHORE (\begin{DoxyParamCaption}\item[{net}]{}{, }\item[{outbound\+\_\+message}]{}{}\end{DoxyParamCaption})}



\label{doc-var-members}
\doxysubsection{Variable Documentation}
\index{net.cpp@{net.cpp}!ANCHORS\_DATABASE\_FILENAME@{ANCHORS\_DATABASE\_FILENAME}}
\index{ANCHORS\_DATABASE\_FILENAME@{ANCHORS\_DATABASE\_FILENAME}!net.cpp@{net.cpp}}
\doxysubsubsection{ANCHORS\_DATABASE\_FILENAME}
{\footnotesize\ttfamily \label{net_8cpp_a9f202f1f0c861ddc4bfabeb54a06379d} 
const char$\ast$ const ANCHORS\+\_\+\+DATABASE\+\_\+\+FILENAME = "{}anchors.\+dat"{}}

Anchor IP address database file name \index{net.cpp@{net.cpp}!CaptureMessage@{CaptureMessage}}
\index{CaptureMessage@{CaptureMessage}!net.cpp@{net.cpp}}
\doxysubsubsection{CaptureMessage}
{\footnotesize\ttfamily \label{net_8cpp_ac834a0d98a1e73e434c6ab4e88c7de25} 
std\+::function$<$void(const \textbf{ CAddress}\& addr, const std\+::string\& msg\+\_\+type, std\+::span$<$const unsigned char$>$ data, bool is\+\_\+incoming)$>$ Capture\+Message = Capture\+Message\+To\+File}

Defaults to {\ttfamily Capture\+Message\+To\+File()}, but can be overridden by unit tests. \index{net.cpp@{net.cpp}!fDiscover@{fDiscover}}
\index{fDiscover@{fDiscover}!net.cpp@{net.cpp}}
\doxysubsubsection{fDiscover}
{\footnotesize\ttfamily \label{net_8cpp_a37089835ec27ad8bf945a458708165b9} 
bool f\+Discover = true}

\index{net.cpp@{net.cpp}!fListen@{fListen}}
\index{fListen@{fListen}!net.cpp@{net.cpp}}
\doxysubsubsection{fListen}
{\footnotesize\ttfamily \label{net_8cpp_a5067f8b9215406011fa3461be92d819c} 
bool f\+Listen = true}

\index{net.cpp@{net.cpp}!g\_maplocalhost\_mutex@{g\_maplocalhost\_mutex}}
\index{g\_maplocalhost\_mutex@{g\_maplocalhost\_mutex}!net.cpp@{net.cpp}}
\doxysubsubsection{g\_maplocalhost\_mutex}
{\footnotesize\ttfamily \label{net_8cpp_ab4289e3ed988501ac1f9e965dca566b1} 
\textbf{ Global\+Mutex} g\+\_\+maplocalhost\+\_\+mutex}

\index{net.cpp@{net.cpp}!NET\_MESSAGE\_TYPE\_OTHER@{NET\_MESSAGE\_TYPE\_OTHER}}
\index{NET\_MESSAGE\_TYPE\_OTHER@{NET\_MESSAGE\_TYPE\_OTHER}!net.cpp@{net.cpp}}
\doxysubsubsection{NET\_MESSAGE\_TYPE\_OTHER}
{\footnotesize\ttfamily \label{net_8cpp_a7ba8efed412aaa6e338b09cd2deb0796} 
const std\+::string NET\+\_\+\+MESSAGE\+\_\+\+TYPE\+\_\+\+OTHER = "{}$\ast$other$\ast$"{}}

\index{net.cpp@{net.cpp}!strSubVersion@{strSubVersion}}
\index{strSubVersion@{strSubVersion}!net.cpp@{net.cpp}}
\doxysubsubsection{strSubVersion}
{\footnotesize\ttfamily \label{net_8cpp_a6c58f8ccc4c93105a44caf588562d609} 
std\+::string str\+Sub\+Version}

Subversion as sent to the P2P network in {\ttfamily version} messages 