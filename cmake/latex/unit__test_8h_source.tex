\doxysection{unit\+\_\+test.\+h}
\label{unit__test_8h_source}\index{src/secp256k1/src/unit\_test.h@{src/secp256k1/src/unit\_test.h}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/***********************************************************************}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *\ Distributed\ under\ the\ MIT\ software\ license,\ see\ the\ accompanying\ \ \ \ *}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *\ file\ COPYING\ or\ https://www.opensource.org/licenses/mit-\/license.php.*}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ ***********************************************************************/}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#ifndef\ SECP256K1\_UNIT\_TEST\_H}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#define\ SECP256K1\_UNIT\_TEST\_H}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{00010\ \textcolor{comment}{/*\ Configurable\ constants\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00011\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{comment}{/*\ Maximum\ number\ of\ command-\/line\ arguments.}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ *\ Must\ be\ at\ least\ as\ large\ as\ the\ total\ number\ of\ tests}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ *\ to\ allow\ specifying\ all\ tests\ individually.\ */}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#define\ MAX\_ARGS\ 150}}
\DoxyCodeLine{00017\ \textcolor{comment}{/*\ Maximum\ number\ of\ parallel\ jobs\ */}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#define\ MAX\_SUBPROCESSES\ 16}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{00021\ \textcolor{comment}{/*\ Test\ Framework\ Registry\ Macros\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00022\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#define\ CASE(name)\ \{\ \#name,\ run\_\#\#name\ \}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#define\ CASE1(name)\ \{\ \#name,\ name\ \}}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#define\ MAKE\_TEST\_MODULE(name)\ \{\ \(\backslash\)}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\ \ \ \ \#name,\ \(\backslash\)}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\ \ \ \ tests\_\#\#name,\ \(\backslash\)}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\ \ \ \ sizeof(tests\_\#\#name)\ /\ sizeof(tests\_\#\#name[0])\ \(\backslash\)}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\}}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{comment}{/*\ Macro\ to\ wrap\ a\ test\ internal\ function\ with\ a\ COUNT\ loop\ (iterations\ number)\ */}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#define\ REPEAT\_TEST(fn)\ REPEAT\_TEST\_MULT(fn,\ 1)}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#define\ REPEAT\_TEST\_MULT(fn,\ multiplier)\ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\ \ \ \ static\ void\ fn(void)\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ int\ i;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ int\ repeat\ =\ COUNT\ *\ (multiplier);\ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ for\ (i\ =\ 0;\ i\ <\ repeat;\ i++)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ fn\#\#\_internal();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\ \ \ \ \}}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{00046\ \textcolor{comment}{/*\ Test\ Framework\ API\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00047\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \textcolor{keyword}{typedef}\ void\ (*test\_fn)(void);}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \textcolor{keyword}{struct\ }tf\_test\_entry\ \{}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ name;}
\DoxyCodeLine{00053\ \ \ \ \ test\_fn\ func;}
\DoxyCodeLine{00054\ \};}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \textcolor{keyword}{struct\ }tf\_test\_module\ \{}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ name;}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{struct\ }tf\_test\_entry*\ data;}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordtype}{int}\ size;}
\DoxyCodeLine{00060\ \};}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \textcolor{keyword}{typedef}\ int\ (*setup\_ctx\_fn)(void);}
\DoxyCodeLine{00063\ \textcolor{keyword}{typedef}\ int\ (*teardown\_fn)(void);}
\DoxyCodeLine{00064\ \textcolor{keyword}{typedef}\ void\ (*run\_test\_fn)(\textcolor{keyword}{const}\ \textcolor{keyword}{struct\ }tf\_test\_entry*);}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \textcolor{keyword}{struct\ }tf\_targets\ \{}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{comment}{/*\ Target\ tests\ indexes\ */}}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{struct\ }tf\_test\_entry*\ slots[MAX\_ARGS];}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{comment}{/*\ Next\ available\ slot\ */}}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keywordtype}{int}\ size;}
\DoxyCodeLine{00071\ \};}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \textcolor{comment}{/*\ -\/-\/-\/\ Command-\/line\ args\ -\/-\/-\/\ */}}
\DoxyCodeLine{00074\ \textcolor{keyword}{struct\ }tf\_args\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{comment}{/*\ 0\ =>\ sequential;\ 1..MAX\_SUBPROCESSES\ =>\ parallel\ workers\ */}}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_processes;}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{comment}{/*\ Specific\ RNG\ seed\ */}}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ custom\_seed;}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{comment}{/*\ Whether\ to\ print\ the\ help\ msg\ */}}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keywordtype}{int}\ help;}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{comment}{/*\ Whether\ to\ print\ the\ tests\ list\ msg\ */}}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordtype}{int}\ list\_tests;}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{comment}{/*\ Target\ tests\ indexes\ */}}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keyword}{struct\ }tf\_targets\ targets;}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{/*\ Enable\ test\ execution\ logging\ */}}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keywordtype}{int}\ logging;}
\DoxyCodeLine{00087\ \};}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{00090\ \textcolor{comment}{/*\ Public\ API\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00091\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \textcolor{keyword}{struct\ }tf\_framework\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{comment}{/*\ Command-\/line\ args\ */}}
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keyword}{struct\ }tf\_args\ args;}
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{comment}{/*\ Test\ modules\ registry\ */}}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{struct\ }tf\_test\_module*\ registry\_modules;}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{comment}{/*\ Num\ of\ modules\ */}}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_modules;}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{comment}{/*\ Registry\ for\ tests\ that\ require\ no\ RNG\ init\ */}}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{struct\ }tf\_test\_module*\ registry\_no\_rng;}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{comment}{/*\ Specific\ context\ setup\ and\ teardown\ functions\ */}}
\DoxyCodeLine{00103\ \ \ \ \ setup\_ctx\_fn\ fn\_setup;}
\DoxyCodeLine{00104\ \ \ \ \ teardown\_fn\ fn\_teardown;}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{comment}{/*\ Test\ runner\ function\ (can\ be\ customized)\ */}}
\DoxyCodeLine{00106\ \ \ \ \ run\_test\_fn\ fn\_run\_test;}
\DoxyCodeLine{00107\ \};}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \textcolor{comment}{/*}}
\DoxyCodeLine{00110\ \textcolor{comment}{\ *\ Initialize\ the\ test\ framework.}}
\DoxyCodeLine{00111\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00112\ \textcolor{comment}{\ *\ Must\ be\ called\ before\ tf\_run()\ and\ before\ any\ output\ is\ performed\ to}}
\DoxyCodeLine{00113\ \textcolor{comment}{\ *\ stdout\ or\ stderr,\ because\ this\ function\ disables\ buffering\ on\ both}}
\DoxyCodeLine{00114\ \textcolor{comment}{\ *\ streams\ to\ ensure\ reliable\ diagnostic\ output.}}
\DoxyCodeLine{00115\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00116\ \textcolor{comment}{\ *\ Parses\ command-\/line\ arguments\ and\ configures\ the\ framework\ context.}}
\DoxyCodeLine{00117\ \textcolor{comment}{\ *\ The\ caller\ must\ initialize\ the\ following\ members\ of\ 'tf'\ before\ calling:}}
\DoxyCodeLine{00118\ \textcolor{comment}{\ *\ \ \ -\/\ tf-\/>registry\_modules}}
\DoxyCodeLine{00119\ \textcolor{comment}{\ *\ \ \ -\/\ tf-\/>num\_modules}}
\DoxyCodeLine{00120\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00121\ \textcolor{comment}{\ *\ Side\ effects:}}
\DoxyCodeLine{00122\ \textcolor{comment}{\ *\ \ \ -\/\ stdout\ and\ stderr\ are\ set\ to\ unbuffered\ mode\ via\ setbuf().}}
\DoxyCodeLine{00123\ \textcolor{comment}{\ *\ \ \ \ \ This\ allows\ immediate\ flushing\ of\ diagnostic\ messages\ but\ may}}
\DoxyCodeLine{00124\ \textcolor{comment}{\ *\ \ \ \ \ affect\ performance\ for\ other\ output\ operations.}}
\DoxyCodeLine{00125\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00126\ \textcolor{comment}{\ *\ Returns:}}
\DoxyCodeLine{00127\ \textcolor{comment}{\ *\ \ \ EXIT\_SUCCESS\ (0)\ on\ success,}}
\DoxyCodeLine{00128\ \textcolor{comment}{\ *\ \ \ EXIT\_FAILURE\ (non-\/zero)\ on\ error.}}
\DoxyCodeLine{00129\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00130\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ tf\_init(\textcolor{keyword}{struct}\ tf\_framework*\ tf,\ \textcolor{keywordtype}{int}\ argc,\ \textcolor{keywordtype}{char}**\ argv);}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \textcolor{comment}{/*}}
\DoxyCodeLine{00133\ \textcolor{comment}{\ *\ Run\ tests\ based\ on\ the\ provided\ test\ framework\ context.}}
\DoxyCodeLine{00134\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00135\ \textcolor{comment}{\ *\ This\ function\ uses\ the\ configuration\ stored\ in\ the\ tf\_framework}}
\DoxyCodeLine{00136\ \textcolor{comment}{\ *\ (targets,\ number\ of\ processes,\ iteration\ count,\ etc.)\ to\ determine}}
\DoxyCodeLine{00137\ \textcolor{comment}{\ *\ which\ tests\ to\ execute\ and\ how\ to\ execute\ them.}}
\DoxyCodeLine{00138\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00139\ \textcolor{comment}{\ *\ Returns:}}
\DoxyCodeLine{00140\ \textcolor{comment}{\ *\ \ \ EXIT\_SUCCESS\ (0)\ if\ all\ tests\ passed,}}
\DoxyCodeLine{00141\ \textcolor{comment}{\ *\ \ \ EXIT\_FAILURE\ (non-\/zero)\ otherwise.}}
\DoxyCodeLine{00142\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00143\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ tf\_run(\textcolor{keyword}{struct}\ tf\_framework*\ tf);}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ SECP256K1\_UNIT\_TEST\_H\ */}\textcolor{preprocessor}{}}

\end{DoxyCode}
