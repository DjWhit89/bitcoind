\doxysection{Base\+Index Class Reference}
\label{class_base_index}\index{BaseIndex@{BaseIndex}}


{\ttfamily \#include $<$base.\+h$>$}

Inheritance diagram for Base\+Index\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{class_base_index}
\end{center}
\end{figure}
\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
class \textbf{ DB}
\end{DoxyCompactItemize}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\textbf{ Base\+Index} (std\+::unique\+\_\+ptr$<$ \textbf{ interfaces\+::\+Chain} $>$ chain, std\+::string \textbf{ name})
\item 
virtual \textbf{ $\sim$\+Base\+Index} ()
\begin{DoxyCompactList}\small\item\em Destructor interrupts sync thread if running and blocks until it exits. \end{DoxyCompactList}\item 
const std\+::string \& \textbf{ Get\+Name} () const \textbf{ LIFETIMEBOUND}
\begin{DoxyCompactList}\small\item\em Get the name of the index for display in logs. \end{DoxyCompactList}\item 
bool Block\+Until\+Synced\+To\+Current\+Chain() const \textbf{ LOCKS\+\_\+\+EXCLUDED}(void \textbf{ Interrupt} ()
\item 
bool \textbf{ Init} ()
\item 
bool \textbf{ Start\+Background\+Sync} ()
\begin{DoxyCompactList}\small\item\em Starts the initial sync process on a background thread. \end{DoxyCompactList}\item 
void \textbf{ Sync} ()
\item 
void \textbf{ Stop} ()
\begin{DoxyCompactList}\small\item\em Stops the instance from staying in sync with blockchain updates. \end{DoxyCompactList}\item 
\textbf{ Index\+Summary} \textbf{ Get\+Summary} () const
\begin{DoxyCompactList}\small\item\em Get a summary of the index and its state. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
void \textbf{ Block\+Connected} (const \textbf{ kernel\+::\+Chainstate\+Role} \&role, const std\+::shared\+\_\+ptr$<$ const \textbf{ CBlock} $>$ \&block, const \textbf{ CBlock\+Index} $\ast$pindex) override
\item 
void \textbf{ Chain\+State\+Flushed} (const \textbf{ kernel\+::\+Chainstate\+Role} \&role, const \textbf{ CBlock\+Locator} \&locator) override
\item 
virtual \textbf{ interfaces\+::\+Chain\+::\+Notify\+Options} \textbf{ Custom\+Options} ()
\begin{DoxyCompactList}\small\item\em Return custom notification options for index. \end{DoxyCompactList}\item 
virtual bool \textbf{ Custom\+Init} (const std\+::optional$<$ \textbf{ interfaces\+::\+Block\+Ref} $>$ \&block)
\begin{DoxyCompactList}\small\item\em Initialize internal state from the database and block index. \end{DoxyCompactList}\item 
virtual bool \textbf{ Custom\+Append} (const \textbf{ interfaces\+::\+Block\+Info} \&block)
\begin{DoxyCompactList}\small\item\em Write update index entries for a newly connected block. \end{DoxyCompactList}\item 
virtual bool \textbf{ Custom\+Commit} (\textbf{ CDBBatch} \&batch)
\item 
virtual bool \textbf{ Custom\+Remove} (const \textbf{ interfaces\+::\+Block\+Info} \&block)
\begin{DoxyCompactList}\small\item\em Rewind index by one block during a chain reorg. \end{DoxyCompactList}\item 
virtual \textbf{ DB} \& \textbf{ Get\+DB} () const =0
\item 
void \textbf{ Set\+Best\+Block\+Index} (const \textbf{ CBlock\+Index} $\ast$block)
\begin{DoxyCompactList}\small\item\em Update the internal best block index as well as the prune lock. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Protected Member Functions inherited from \textbf{ CValidation\+Interface}}
\begin{DoxyCompactItemize}
\item 
\textbf{ $\sim$\+CValidation\+Interface} ()=default
\item 
virtual void \textbf{ Updated\+Block\+Tip} (const \textbf{ CBlock\+Index} $\ast$pindex\+New, const \textbf{ CBlock\+Index} $\ast$pindex\+Fork, bool f\+Initial\+Download)
\item 
virtual void \textbf{ Active\+Tip\+Change} (const \textbf{ CBlock\+Index} \&new\+\_\+tip, bool is\+\_\+ibd)
\item 
virtual void \textbf{ Transaction\+Added\+To\+Mempool} (const \textbf{ New\+Mempool\+Transaction\+Info} \&tx, uint64\+\_\+t mempool\+\_\+sequence)
\item 
virtual void \textbf{ Transaction\+Removed\+From\+Mempool} (const \textbf{ CTransaction\+Ref} \&tx, \textbf{ Mem\+Pool\+Removal\+Reason} reason, uint64\+\_\+t mempool\+\_\+sequence)
\item 
virtual void \textbf{ Mempool\+Transactions\+Removed\+For\+Block} (const std\+::vector$<$ \textbf{ Removed\+Mempool\+Transaction\+Info} $>$ \&txs\+\_\+removed\+\_\+for\+\_\+block, unsigned int n\+Block\+Height)
\item 
virtual void \textbf{ Block\+Disconnected} (const std\+::shared\+\_\+ptr$<$ const \textbf{ CBlock} $>$ \&block, const \textbf{ CBlock\+Index} $\ast$pindex)
\item 
virtual void \textbf{ Block\+Checked} (const std\+::shared\+\_\+ptr$<$ const \textbf{ CBlock} $>$ \&, const \textbf{ Block\+Validation\+State} \&)
\item 
virtual void \textbf{ New\+Po\+WValid\+Block} (const \textbf{ CBlock\+Index} $\ast$pindex, const std\+::shared\+\_\+ptr$<$ const \textbf{ CBlock} $>$ \&block)
\end{DoxyCompactItemize}
\doxysubsubsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
std\+::unique\+\_\+ptr$<$ \textbf{ interfaces\+::\+Chain} $>$ \textbf{ m\+\_\+chain}
\item 
\textbf{ Chainstate} $\ast$ \textbf{ m\+\_\+chainstate} \{nullptr\}
\item 
const std\+::string \textbf{ m\+\_\+name}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\doxyref{Base}{p.}{class_base} class for indices of blockchain data. This implements \doxyref{CValidation\+Interface}{p.}{class_c_validation_interface} and ensures blocks are indexed sequentially according to their position in the active chain.

In the presence of multiple chainstates (i.\+e. if a UTXO snapshot is loaded), only the background "{}\+IBD"{} chainstate will be indexed to avoid building the index out of order. When the background chainstate completes validation, the index will be reinitialized and indexing will continue. 

\label{doc-constructors}
\doxysubsection{Constructor \& Destructor Documentation}
\index{BaseIndex@{BaseIndex}!BaseIndex@{BaseIndex}}
\index{BaseIndex@{BaseIndex}!BaseIndex@{BaseIndex}}
\doxysubsubsection{BaseIndex()}
{\footnotesize\ttfamily \label{class_base_index_a63beabbb38db65baa89d4c4b9e06514e} 
\textbf{ Base\+Index} (\begin{DoxyParamCaption}\item[{std\+::unique\+\_\+ptr$<$ \textbf{ interfaces\+::\+Chain} $>$}]{chain}{, }\item[{std\+::string}]{name}{}\end{DoxyParamCaption})}

\index{BaseIndex@{BaseIndex}!````~BaseIndex@{$\sim$BaseIndex}}
\index{````~BaseIndex@{$\sim$BaseIndex}!BaseIndex@{BaseIndex}}
\doxysubsubsection{$\sim$BaseIndex()}
{\footnotesize\ttfamily \label{class_base_index_accf3b06455dfd943a08c7b72eca0486e} 
$\sim$\textbf{ Base\+Index} (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Destructor interrupts sync thread if running and blocks until it exits. 



\label{doc-func-members}
\doxysubsection{Member Function Documentation}
\index{BaseIndex@{BaseIndex}!BlockConnected@{BlockConnected}}
\index{BlockConnected@{BlockConnected}!BaseIndex@{BaseIndex}}
\doxysubsubsection{BlockConnected()}
{\footnotesize\ttfamily \label{class_base_index_a374fdc06bda6ff3ddaa2bda1e6fbd21e} 
void Block\+Connected (\begin{DoxyParamCaption}\item[{const \textbf{ kernel\+::\+Chainstate\+Role} \&}]{role}{, }\item[{const std\+::shared\+\_\+ptr$<$ const \textbf{ CBlock} $>$ \&}]{block}{, }\item[{const \textbf{ CBlock\+Index} $\ast$}]{pindex}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}, {\ttfamily [virtual]}}

Notifies listeners of a block being connected.

Called on a background thread. 

Reimplemented from \textbf{ CValidation\+Interface} \doxyref{}{p.}{class_c_validation_interface_a41401b83726759ddd692bbfe627e09d1}.

\index{BaseIndex@{BaseIndex}!ChainStateFlushed@{ChainStateFlushed}}
\index{ChainStateFlushed@{ChainStateFlushed}!BaseIndex@{BaseIndex}}
\doxysubsubsection{ChainStateFlushed()}
{\footnotesize\ttfamily \label{class_base_index_ab31cc4fb16d172da433dcef5601a43b7} 
void Chain\+State\+Flushed (\begin{DoxyParamCaption}\item[{const \textbf{ kernel\+::\+Chainstate\+Role} \&}]{role}{, }\item[{const \textbf{ CBlock\+Locator} \&}]{locator}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}, {\ttfamily [virtual]}}

Notifies listeners of the new active block chain on-\/disk.

Prior to this callback, any updates are not guaranteed to persist on disk (ie clients need to handle shutdown/restart safety by being able to understand when some updates were lost due to unclean shutdown).

When this callback is invoked, the validation changes done by any prior callback are guaranteed to exist on disk and survive a restart, including an unclean shutdown.

Provides a locator describing the best chain, which is likely useful for storing current state on disk in client DBs.

Called on a background thread. 

Reimplemented from \textbf{ CValidation\+Interface} \doxyref{}{p.}{class_c_validation_interface_a462316941d99f23c26c9217297762d52}.

\index{BaseIndex@{BaseIndex}!CustomAppend@{CustomAppend}}
\index{CustomAppend@{CustomAppend}!BaseIndex@{BaseIndex}}
\doxysubsubsection{CustomAppend()}
{\footnotesize\ttfamily \label{class_base_index_a080cb86acb291b55063a4962ada7be55} 
virtual bool Custom\+Append (\begin{DoxyParamCaption}\item[{const \textbf{ interfaces\+::\+Block\+Info} \&}]{block}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [nodiscard]}, {\ttfamily [protected]}, {\ttfamily [virtual]}}



Write update index entries for a newly connected block. 



Reimplemented in \textbf{ Block\+Filter\+Index} \doxyref{}{p.}{class_block_filter_index_a2866130d78abde86682621008c9b0ca3}, \textbf{ Coin\+Stats\+Index} \doxyref{}{p.}{class_coin_stats_index_a2866130d78abde86682621008c9b0ca3}, \textbf{ Index\+Reorg\+Crash} \doxyref{}{p.}{class_index_reorg_crash_a2866130d78abde86682621008c9b0ca3}, and \textbf{ Tx\+Index} \doxyref{}{p.}{class_tx_index_a2866130d78abde86682621008c9b0ca3}.

\index{BaseIndex@{BaseIndex}!CustomCommit@{CustomCommit}}
\index{CustomCommit@{CustomCommit}!BaseIndex@{BaseIndex}}
\doxysubsubsection{CustomCommit()}
{\footnotesize\ttfamily \label{class_base_index_aafedd85ce46122ac8066fc9fac0490a1} 
virtual bool Custom\+Commit (\begin{DoxyParamCaption}\item[{\textbf{ CDBBatch} \&}]{batch}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [protected]}, {\ttfamily [virtual]}}

Virtual method called internally by Commit that can be overridden to atomically commit more index state. 

Reimplemented in \textbf{ Block\+Filter\+Index} \doxyref{}{p.}{class_block_filter_index_ad0cef080d295f0162f68530a8e44575e}, and \textbf{ Coin\+Stats\+Index} \doxyref{}{p.}{class_coin_stats_index_ad0cef080d295f0162f68530a8e44575e}.

\index{BaseIndex@{BaseIndex}!CustomInit@{CustomInit}}
\index{CustomInit@{CustomInit}!BaseIndex@{BaseIndex}}
\doxysubsubsection{CustomInit()}
{\footnotesize\ttfamily \label{class_base_index_a5a941e190accdafcf7918f1b93be62e7} 
virtual bool Custom\+Init (\begin{DoxyParamCaption}\item[{const std\+::optional$<$ \textbf{ interfaces\+::\+Block\+Ref} $>$ \&}]{block}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [nodiscard]}, {\ttfamily [protected]}, {\ttfamily [virtual]}}



Initialize internal state from the database and block index. 



Reimplemented in \textbf{ Block\+Filter\+Index} \doxyref{}{p.}{class_block_filter_index_a152681603ac9fb8c0ccbf84efaa56da9}, and \textbf{ Coin\+Stats\+Index} \doxyref{}{p.}{class_coin_stats_index_a152681603ac9fb8c0ccbf84efaa56da9}.

\index{BaseIndex@{BaseIndex}!CustomOptions@{CustomOptions}}
\index{CustomOptions@{CustomOptions}!BaseIndex@{BaseIndex}}
\doxysubsubsection{CustomOptions()}
{\footnotesize\ttfamily \label{class_base_index_a3ae41719a350d90748ea10646827fe4d} 
virtual \textbf{ interfaces\+::\+Chain\+::\+Notify\+Options} Custom\+Options (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [nodiscard]}, {\ttfamily [protected]}, {\ttfamily [virtual]}}



Return custom notification options for index. 



Reimplemented in \textbf{ Block\+Filter\+Index} \doxyref{}{p.}{class_block_filter_index_a51d997d6ac9091245a102cfad7db925d}, and \textbf{ Coin\+Stats\+Index} \doxyref{}{p.}{class_coin_stats_index_a51d997d6ac9091245a102cfad7db925d}.

\index{BaseIndex@{BaseIndex}!CustomRemove@{CustomRemove}}
\index{CustomRemove@{CustomRemove}!BaseIndex@{BaseIndex}}
\doxysubsubsection{CustomRemove()}
{\footnotesize\ttfamily \label{class_base_index_af602dc17e45d607b921ed0162568062e} 
virtual bool Custom\+Remove (\begin{DoxyParamCaption}\item[{const \textbf{ interfaces\+::\+Block\+Info} \&}]{block}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [nodiscard]}, {\ttfamily [protected]}, {\ttfamily [virtual]}}



Rewind index by one block during a chain reorg. 



Reimplemented in \textbf{ Block\+Filter\+Index} \doxyref{}{p.}{class_block_filter_index_aa40d547c510f155772c2748cfb675765}, and \textbf{ Coin\+Stats\+Index} \doxyref{}{p.}{class_coin_stats_index_aa40d547c510f155772c2748cfb675765}.

\index{BaseIndex@{BaseIndex}!GetDB@{GetDB}}
\index{GetDB@{GetDB}!BaseIndex@{BaseIndex}}
\doxysubsubsection{GetDB()}
{\footnotesize\ttfamily \label{class_base_index_aa8e4007464e2ab64d3559b721f3fc71b} 
virtual \textbf{ DB} \& Get\+DB (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [pure virtual]}}



Implemented in \textbf{ Block\+Filter\+Index} \doxyref{}{p.}{class_block_filter_index_a08f644c9774cc50263e2a5c60c8a1c5b}, \textbf{ Coin\+Stats\+Index} \doxyref{}{p.}{class_coin_stats_index_a306d7e0e7cc4dfa4c78dcd837531edeb}, \textbf{ Index\+Reorg\+Crash} \doxyref{}{p.}{class_index_reorg_crash_a306d7e0e7cc4dfa4c78dcd837531edeb}, and \textbf{ Tx\+Index} \doxyref{}{p.}{class_tx_index_a306d7e0e7cc4dfa4c78dcd837531edeb}.

\index{BaseIndex@{BaseIndex}!GetName@{GetName}}
\index{GetName@{GetName}!BaseIndex@{BaseIndex}}
\doxysubsubsection{GetName()}
{\footnotesize\ttfamily \label{class_base_index_aec8db65d32e78ef5da30521b3ad29cab} 
const std\+::string \& Get\+Name (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Get the name of the index for display in logs. 

\index{BaseIndex@{BaseIndex}!GetSummary@{GetSummary}}
\index{GetSummary@{GetSummary}!BaseIndex@{BaseIndex}}
\doxysubsubsection{GetSummary()}
{\footnotesize\ttfamily \label{class_base_index_ace62e27c3bf353a65d8112cf93858367} 
\textbf{ Index\+Summary} Get\+Summary (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption}) const}



Get a summary of the index and its state. 

\index{BaseIndex@{BaseIndex}!Init@{Init}}
\index{Init@{Init}!BaseIndex@{BaseIndex}}
\doxysubsubsection{Init()}
{\footnotesize\ttfamily \label{class_base_index_ad19abaacb073bdef7940926f64b2aace} 
bool \textbf{ Init} (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [nodiscard]}}

Initializes the sync state and registers the instance to the validation interface so that it stays in sync with blockchain updates. \index{BaseIndex@{BaseIndex}!Interrupt@{Interrupt}}
\index{Interrupt@{Interrupt}!BaseIndex@{BaseIndex}}
\doxysubsubsection{Interrupt()}
{\footnotesize\ttfamily \label{class_base_index_ac1c30a63fcff78de5e4924f7ee2b822e} 
void Interrupt (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

Blocks the current thread until the index is caught up to the current state of the block chain. This only blocks if the index has gotten in sync once and only needs to process blocks in the Validation\+Interface queue. If the index is catching up from far behind, this method does not block and immediately returns false. \index{BaseIndex@{BaseIndex}!SetBestBlockIndex@{SetBestBlockIndex}}
\index{SetBestBlockIndex@{SetBestBlockIndex}!BaseIndex@{BaseIndex}}
\doxysubsubsection{SetBestBlockIndex()}
{\footnotesize\ttfamily \label{class_base_index_a8ae67b0874c5da1fb522aff8a5baff34} 
void Set\+Best\+Block\+Index (\begin{DoxyParamCaption}\item[{const \textbf{ CBlock\+Index} $\ast$}]{block}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Update the internal best block index as well as the prune lock. 

\index{BaseIndex@{BaseIndex}!StartBackgroundSync@{StartBackgroundSync}}
\index{StartBackgroundSync@{StartBackgroundSync}!BaseIndex@{BaseIndex}}
\doxysubsubsection{StartBackgroundSync()}
{\footnotesize\ttfamily \label{class_base_index_acb89fae849e21ab497da0e48e6f44611} 
bool Start\+Background\+Sync (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [nodiscard]}}



Starts the initial sync process on a background thread. 

\index{BaseIndex@{BaseIndex}!Stop@{Stop}}
\index{Stop@{Stop}!BaseIndex@{BaseIndex}}
\doxysubsubsection{Stop()}
{\footnotesize\ttfamily \label{class_base_index_a17a237457e57625296e6b24feb19c60a} 
void Stop (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Stops the instance from staying in sync with blockchain updates. 

\index{BaseIndex@{BaseIndex}!Sync@{Sync}}
\index{Sync@{Sync}!BaseIndex@{BaseIndex}}
\doxysubsubsection{Sync()}
{\footnotesize\ttfamily \label{class_base_index_a93098eecf20d66124bd7bc8370ebe52e} 
void Sync (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

Sync the index with the block index starting from the current best block. Intended to be run in its own thread, m\+\_\+thread\+\_\+sync, and can be interrupted with m\+\_\+interrupt. Once the index gets in sync, the m\+\_\+synced flag is set and the Block\+Connected Validation\+Interface callback takes over and the sync thread exits. 

\label{doc-variable-members}
\doxysubsection{Field Documentation}
\index{BaseIndex@{BaseIndex}!m\_chain@{m\_chain}}
\index{m\_chain@{m\_chain}!BaseIndex@{BaseIndex}}
\doxysubsubsection{m\_chain}
{\footnotesize\ttfamily \label{class_base_index_af03e5fc92dc3d7cbbd33725f126ce68b} 
std\+::unique\+\_\+ptr$<$\textbf{ interfaces\+::\+Chain}$>$ m\+\_\+chain\hspace{0.3cm}{\ttfamily [protected]}}

\index{BaseIndex@{BaseIndex}!m\_chainstate@{m\_chainstate}}
\index{m\_chainstate@{m\_chainstate}!BaseIndex@{BaseIndex}}
\doxysubsubsection{m\_chainstate}
{\footnotesize\ttfamily \label{class_base_index_a73c45023c4dfe5344314df701806b85a} 
\textbf{ Chainstate}$\ast$ m\+\_\+chainstate \{nullptr\}\hspace{0.3cm}{\ttfamily [protected]}}

\index{BaseIndex@{BaseIndex}!m\_name@{m\_name}}
\index{m\_name@{m\_name}!BaseIndex@{BaseIndex}}
\doxysubsubsection{m\_name}
{\footnotesize\ttfamily \label{class_base_index_a6f9e296fcf5c68222c08850e8279025e} 
const std\+::string m\+\_\+name\hspace{0.3cm}{\ttfamily [protected]}}



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
src/index/\textbf{ base.\+h}\item 
src/index/\textbf{ base.\+cpp}\end{DoxyCompactItemize}
