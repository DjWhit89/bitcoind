\doxysection{merkleblock.\+h}
\label{merkleblock_8h_source}\index{src/merkleblock.h@{src/merkleblock.h}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (c)\ 2009-\/2010\ Satoshi\ Nakamoto}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Copyright\ (c)\ 2009-\/present\ The\ Bitcoin\ Core\ developers}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ Distributed\ under\ the\ MIT\ software\ license,\ see\ the\ accompanying}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ file\ COPYING\ or\ http://www.opensource.org/licenses/mit-\/license.php.}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#ifndef\ BITCOIN\_MERKLEBLOCK\_H}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#define\ BITCOIN\_MERKLEBLOCK\_H}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <common/bloom.h>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <primitives/block.h>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <primitives/transaction\_identifier.h>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <serialize.h>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <uint256.h>}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <set>}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{comment}{//\ Helper\ functions\ for\ serialization.}}
\DoxyCodeLine{00019\ std::vector<unsigned\ char>\ BitsToBytes(\textcolor{keyword}{const}\ std::vector<bool>\&\ bits);}
\DoxyCodeLine{00020\ std::vector<bool>\ BytesToBits(\textcolor{keyword}{const}\ std::vector<unsigned\ char>\&\ bytes);}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00056\ \textcolor{keyword}{class\ }CPartialMerkleTree}
\DoxyCodeLine{00057\ \{}
\DoxyCodeLine{00058\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nTransactions;}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00063\ \ \ \ \ std::vector<bool>\ vBits;}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00066\ \ \ \ \ std::vector<uint256>\ vHash;}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordtype}{bool}\ fBad;}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ CalcTreeWidth(\textcolor{keywordtype}{int}\ height)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (nTransactions+(1\ <<\ height)-\/1)\ >>\ height;}
\DoxyCodeLine{00074\ \ \ \ \ \}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00077\ \ \ \ \ uint256\ CalcHash(\textcolor{keywordtype}{int}\ height,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ pos,\ \textcolor{keyword}{const}\ std::vector<Txid>\ \&vTxid);}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keywordtype}{void}\ TraverseAndBuild(\textcolor{keywordtype}{int}\ height,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ pos,\ \textcolor{keyword}{const}\ std::vector<Txid>\ \&vTxid,\ \textcolor{keyword}{const}\ std::vector<bool>\ \&vMatch);}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00086\ \ \ \ \ uint256\ TraverseAndExtract(\textcolor{keywordtype}{int}\ height,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ pos,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \&nBitsUsed,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \&nHashUsed,\ std::vector<Txid>\ \&vMatch,\ std::vector<unsigned\ int>\ \&vnIndex);}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \ \ SERIALIZE\_METHODS(CPartialMerkleTree,\ obj)}
\DoxyCodeLine{00091\ \ \ \ \ \{}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ READWRITE(obj.nTransactions,\ obj.vHash);}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ std::vector<unsigned\ char>\ bytes;}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ SER\_WRITE(obj,\ bytes\ =\ BitsToBytes(obj.vBits));}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ READWRITE(bytes);}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ SER\_READ(obj,\ obj.vBits\ =\ BytesToBits(bytes));}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ SER\_READ(obj,\ obj.fBad\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00098\ \ \ \ \ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00101\ \ \ \ \ CPartialMerkleTree(\textcolor{keyword}{const}\ std::vector<Txid>\ \&vTxid,\ \textcolor{keyword}{const}\ std::vector<bool>\ \&vMatch);}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ CPartialMerkleTree();}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00110\ \ \ \ \ uint256\ ExtractMatches(std::vector<Txid>\ \&vMatch,\ std::vector<unsigned\ int>\ \&vnIndex);}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ GetNumTransactions()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ nTransactions;\ \};}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \};}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00126\ \textcolor{keyword}{class\ }CMerkleBlock}
\DoxyCodeLine{00127\ \{}
\DoxyCodeLine{00128\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00130\ \ \ \ \ CBlockHeader\ header;}
\DoxyCodeLine{00131\ \ \ \ \ CPartialMerkleTree\ txn;}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00139\ \ \ \ \ std::vector<std::pair<unsigned\ int,\ Txid>\ >\ vMatchedTxn;}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00146\ \ \ \ \ CMerkleBlock(\textcolor{keyword}{const}\ CBlock\&\ block,\ CBloomFilter\&\ filter)\ :\ CMerkleBlock(block,\ \&filter,\ nullptr)\ \{\ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{comment}{//\ Create\ from\ a\ CBlock,\ matching\ the\ txids\ in\ the\ set}}
\DoxyCodeLine{00149\ \ \ \ \ CMerkleBlock(\textcolor{keyword}{const}\ CBlock\&\ block,\ \textcolor{keyword}{const}\ std::set<Txid>\&\ txids)\ :\ CMerkleBlock\{block,\ nullptr,\ \&txids\}\ \{\}}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \ \ CMerkleBlock()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ SERIALIZE\_METHODS(CMerkleBlock,\ obj)\ \{\ READWRITE(obj.header,\ obj.txn);\ \}}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{comment}{//\ Combined\ constructor\ to\ consolidate\ code}}
\DoxyCodeLine{00157\ \ \ \ \ CMerkleBlock(\textcolor{keyword}{const}\ CBlock\&\ block,\ CBloomFilter*\ filter,\ \textcolor{keyword}{const}\ std::set<Txid>*\ txids);}
\DoxyCodeLine{00158\ \};}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ BITCOIN\_MERKLEBLOCK\_H}}

\end{DoxyCode}
