\doxysection{Tx\+Reconciliation\+Tracker Class Reference}
\label{class_tx_reconciliation_tracker}\index{TxReconciliationTracker@{TxReconciliationTracker}}


{\ttfamily \#include $<$txreconciliation.\+h$>$}

\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
class \textbf{ Impl}
\end{DoxyCompactItemize}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\textbf{ Tx\+Reconciliation\+Tracker} (uint32\+\_\+t recon\+\_\+version)
\item 
\textbf{ $\sim$\+Tx\+Reconciliation\+Tracker} ()
\item 
uint64\+\_\+t \textbf{ Pre\+Register\+Peer} (\textbf{ Node\+Id} peer\+\_\+id)
\item 
\textbf{ Reconciliation\+Register\+Result} \textbf{ Register\+Peer} (\textbf{ Node\+Id} peer\+\_\+id, bool is\+\_\+peer\+\_\+inbound, uint32\+\_\+t peer\+\_\+recon\+\_\+version, uint64\+\_\+t remote\+\_\+salt)
\item 
void \textbf{ Forget\+Peer} (\textbf{ Node\+Id} peer\+\_\+id)
\item 
bool \textbf{ Is\+Peer\+Registered} (\textbf{ Node\+Id} peer\+\_\+id) const
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Transaction reconciliation is a way for nodes to efficiently announce transactions. This object keeps track of all txreconciliation-\/related communications with the peers. The high-\/level protocol is\+:
\begin{DoxyEnumerate}
\item Txreconciliation protocol handshake.
\item Once we receive a new transaction, add it to the set instead of announcing immediately.
\item At regular intervals, a txreconciliation initiator requests a sketch from a peer, where a sketch is a compressed representation of short form IDs of the transactions in their set.
\item Once the initiator received a sketch from the peer, the initiator computes a local sketch, and combines the two sketches to attempt finding the difference in {\itshape sets}. 4a. If the difference was not larger than estimated, see SUCCESS below. 4b. If the difference was larger than estimated, initial txreconciliation fails. The initiator requests a larger sketch via an extension round (allowed only once).
\begin{DoxyItemize}
\item If extension succeeds (a larger sketch is sufficient), see SUCCESS below.
\item If extension fails (a larger sketch is insufficient), see FAILURE below.
\end{DoxyItemize}
\end{DoxyEnumerate}

SUCCESS. The initiator knows full symmetrical difference and can request what the initiator is missing and announce to the peer what the peer is missing.

FAILURE. The initiator notifies the peer about the failure and announces all transactions from the corresponding set. Once the peer received the failure notification, the peer announces all transactions from their set.

This is a modification of the Erlay protocol ({\texttt{https\+://arxiv.\+org/abs/1905.\+10518}}) with two changes (sketch extensions instead of bisections, and an extra INV exchange round), both are motivated in BIP-\/330. 

\label{doc-constructors}
\doxysubsection{Constructor \& Destructor Documentation}
\index{TxReconciliationTracker@{TxReconciliationTracker}!TxReconciliationTracker@{TxReconciliationTracker}}
\index{TxReconciliationTracker@{TxReconciliationTracker}!TxReconciliationTracker@{TxReconciliationTracker}}
\doxysubsubsection{TxReconciliationTracker()}
{\footnotesize\ttfamily \label{class_tx_reconciliation_tracker_aed6be0343a8cc41fc91f3b8f7317724c} 
\textbf{ Tx\+Reconciliation\+Tracker} (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{recon\+\_\+version}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [explicit]}}

\index{TxReconciliationTracker@{TxReconciliationTracker}!````~TxReconciliationTracker@{$\sim$TxReconciliationTracker}}
\index{````~TxReconciliationTracker@{$\sim$TxReconciliationTracker}!TxReconciliationTracker@{TxReconciliationTracker}}
\doxysubsubsection{$\sim$TxReconciliationTracker()}
{\footnotesize\ttfamily \label{class_tx_reconciliation_tracker_a8b01adf9ae2ffdbb4879f1bd44b11ecd} 
$\sim$\textbf{ Tx\+Reconciliation\+Tracker} (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [default]}}



\label{doc-func-members}
\doxysubsection{Member Function Documentation}
\index{TxReconciliationTracker@{TxReconciliationTracker}!ForgetPeer@{ForgetPeer}}
\index{ForgetPeer@{ForgetPeer}!TxReconciliationTracker@{TxReconciliationTracker}}
\doxysubsubsection{ForgetPeer()}
{\footnotesize\ttfamily \label{class_tx_reconciliation_tracker_adb141a7aed273b229b773c503e5cc075} 
void Forget\+Peer (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{peer\+\_\+id}{}\end{DoxyParamCaption})}

Attempts to forget txreconciliation-\/related state of the peer (if we previously stored any). After this, we won\textquotesingle{}t be able to reconcile transactions with the peer. \index{TxReconciliationTracker@{TxReconciliationTracker}!IsPeerRegistered@{IsPeerRegistered}}
\index{IsPeerRegistered@{IsPeerRegistered}!TxReconciliationTracker@{TxReconciliationTracker}}
\doxysubsubsection{IsPeerRegistered()}
{\footnotesize\ttfamily \label{class_tx_reconciliation_tracker_aae67cea096486b6432b3ef0f74d01fbb} 
bool Is\+Peer\+Registered (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{peer\+\_\+id}{}\end{DoxyParamCaption}) const}

Check if a peer is registered to reconcile transactions with us. \index{TxReconciliationTracker@{TxReconciliationTracker}!PreRegisterPeer@{PreRegisterPeer}}
\index{PreRegisterPeer@{PreRegisterPeer}!TxReconciliationTracker@{TxReconciliationTracker}}
\doxysubsubsection{PreRegisterPeer()}
{\footnotesize\ttfamily \label{class_tx_reconciliation_tracker_a553439bc6667ec9053705f586818847c} 
uint64\+\_\+t Pre\+Register\+Peer (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{peer\+\_\+id}{}\end{DoxyParamCaption})}

Step 0. Generates initial part of the state (salt) required to reconcile txs with the peer. The salt is used for short ID computation required for txreconciliation. The function returns the salt. A peer can\textquotesingle{}t participate in future txreconciliations without this call. This function must be called only once per peer. \index{TxReconciliationTracker@{TxReconciliationTracker}!RegisterPeer@{RegisterPeer}}
\index{RegisterPeer@{RegisterPeer}!TxReconciliationTracker@{TxReconciliationTracker}}
\doxysubsubsection{RegisterPeer()}
{\footnotesize\ttfamily \label{class_tx_reconciliation_tracker_acb6f9d93f04205571b7f528ca6fd11ee} 
\textbf{ Reconciliation\+Register\+Result} Register\+Peer (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{peer\+\_\+id}{, }\item[{bool}]{is\+\_\+peer\+\_\+inbound}{, }\item[{uint32\+\_\+t}]{peer\+\_\+recon\+\_\+version}{, }\item[{uint64\+\_\+t}]{remote\+\_\+salt}{}\end{DoxyParamCaption})}

Step 0. Once the peer agreed to reconcile txs with us, generate the state required to track ongoing reconciliations. Must be called only after pre-\/registering the peer and only once. 

The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
src/node/\textbf{ txreconciliation.\+h}\item 
src/node/\textbf{ txreconciliation.\+cpp}\end{DoxyCompactItemize}
