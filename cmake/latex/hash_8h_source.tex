\doxysection{hash.\+h}
\label{hash_8h_source}\index{src/hash.h@{src/hash.h}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (c)\ 2009-\/2010\ Satoshi\ Nakamoto}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Copyright\ (c)\ 2009-\/present\ The\ Bitcoin\ Core\ developers}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ Distributed\ under\ the\ MIT\ software\ license,\ see\ the\ accompanying}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ file\ COPYING\ or\ http://www.opensource.org/licenses/mit-\/license.php.}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#ifndef\ BITCOIN\_HASH\_H}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#define\ BITCOIN\_HASH\_H}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <attributes.h>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <crypto/common.h>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <crypto/ripemd160.h>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <crypto/sha256.h>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <prevector.h>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <serialize.h>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <span.h>}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <uint256.h>}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{keyword}{typedef}\ uint256\ ChainCode;}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00024\ \textcolor{keyword}{class\ }CHash256\ \{}
\DoxyCodeLine{00025\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00026\ \ \ \ \ CSHA256\ sha;}
\DoxyCodeLine{00027\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ OUTPUT\_SIZE\ =\ CSHA256::OUTPUT\_SIZE;}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{keywordtype}{void}\ Finalize(std::span<unsigned\ char>\ output)\ \{}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ assert(output.size()\ ==\ OUTPUT\_SIZE);}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ buf[CSHA256::OUTPUT\_SIZE];}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ sha.Finalize(buf);}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ sha.Reset().Write(buf,\ CSHA256::OUTPUT\_SIZE).Finalize(output.data());}
\DoxyCodeLine{00035\ \ \ \ \ \}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \ \ CHash256\&\ Write(std::span<const\ unsigned\ char>\ input)\ \{}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ sha.Write(input.data(),\ input.size());}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00040\ \ \ \ \ \}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \ \ CHash256\&\ Reset()\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ sha.Reset();}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00045\ \ \ \ \ \}}
\DoxyCodeLine{00046\ \};}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00049\ \textcolor{keyword}{class\ }CHash160\ \{}
\DoxyCodeLine{00050\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00051\ \ \ \ \ CSHA256\ sha;}
\DoxyCodeLine{00052\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ OUTPUT\_SIZE\ =\ CRIPEMD160::OUTPUT\_SIZE;}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordtype}{void}\ Finalize(std::span<unsigned\ char>\ output)\ \{}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ assert(output.size()\ ==\ OUTPUT\_SIZE);}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ buf[CSHA256::OUTPUT\_SIZE];}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ sha.Finalize(buf);}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ CRIPEMD160().Write(buf,\ CSHA256::OUTPUT\_SIZE).Finalize(output.data());}
\DoxyCodeLine{00060\ \ \ \ \ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ CHash160\&\ Write(std::span<const\ unsigned\ char>\ input)\ \{}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ sha.Write(input.data(),\ input.size());}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00065\ \ \ \ \ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ CHash160\&\ Reset()\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ sha.Reset();}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00070\ \ \ \ \ \}}
\DoxyCodeLine{00071\ \};}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00074\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00075\ \textcolor{keyword}{inline}\ uint256\ Hash(\textcolor{keyword}{const}\ T\&\ in1)}
\DoxyCodeLine{00076\ \{}
\DoxyCodeLine{00077\ \ \ \ \ uint256\ result;}
\DoxyCodeLine{00078\ \ \ \ \ CHash256().Write(MakeUCharSpan(in1)).Finalize(result);}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00080\ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00083\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T1,\ \textcolor{keyword}{typename}\ T2>}
\DoxyCodeLine{00084\ \textcolor{keyword}{inline}\ uint256\ Hash(\textcolor{keyword}{const}\ T1\&\ in1,\ \textcolor{keyword}{const}\ T2\&\ in2)\ \{}
\DoxyCodeLine{00085\ \ \ \ \ uint256\ result;}
\DoxyCodeLine{00086\ \ \ \ \ CHash256().Write(MakeUCharSpan(in1)).Write(MakeUCharSpan(in2)).Finalize(result);}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00088\ \}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00091\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T1>}
\DoxyCodeLine{00092\ \textcolor{keyword}{inline}\ uint160\ Hash160(\textcolor{keyword}{const}\ T1\&\ in1)}
\DoxyCodeLine{00093\ \{}
\DoxyCodeLine{00094\ \ \ \ \ uint160\ result;}
\DoxyCodeLine{00095\ \ \ \ \ CHash160().Write(MakeUCharSpan(in1)).Finalize(result);}
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00097\ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00100\ \textcolor{keyword}{class\ }HashWriter}
\DoxyCodeLine{00101\ \{}
\DoxyCodeLine{00102\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00103\ \ \ \ \ CSHA256\ ctx;}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{keywordtype}{void}\ write(std::span<const\ std::byte>\ src)}
\DoxyCodeLine{00107\ \ \ \ \ \{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ ctx.Write(UCharCast(src.data()),\ src.size());}
\DoxyCodeLine{00109\ \ \ \ \ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00115\ \ \ \ \ uint256\ GetHash()\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ uint256\ result;}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ ctx.Finalize(result.begin());}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ ctx.Reset().Write(result.begin(),\ CSHA256::OUTPUT\_SIZE).Finalize(result.begin());}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00120\ \ \ \ \ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00126\ \ \ \ \ uint256\ GetSHA256()\ \{}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ uint256\ result;}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ ctx.Finalize(result.begin());}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00130\ \ \ \ \ \}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{keyword}{inline}\ uint64\_t\ GetCheapHash()\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ uint256\ result\ =\ GetHash();}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ReadLE64(result.begin());}
\DoxyCodeLine{00138\ \ \ \ \ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00141\ \ \ \ \ HashWriter\&\ operator<<(\textcolor{keyword}{const}\ T\&\ obj)}
\DoxyCodeLine{00142\ \ \ \ \ \{}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ ::Serialize(*\textcolor{keyword}{this},\ obj);}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00145\ \ \ \ \ \}}
\DoxyCodeLine{00146\ \};}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00149\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Source>}
\DoxyCodeLine{00150\ \textcolor{keyword}{class\ }HashVerifier\ :\ \textcolor{keyword}{public}\ HashWriter}
\DoxyCodeLine{00151\ \{}
\DoxyCodeLine{00152\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00153\ \ \ \ \ Source\&\ m\_source;}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keyword}{explicit}\ HashVerifier(Source\&\ source\ LIFETIMEBOUND)\ :\ m\_source\{source\}\ \{\}}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{keywordtype}{void}\ read(std::span<std::byte>\ dst)}
\DoxyCodeLine{00159\ \ \ \ \ \{}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ m\_source.read(dst);}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ this-\/>write(dst);}
\DoxyCodeLine{00162\ \ \ \ \ \}}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordtype}{void}\ ignore(\textcolor{keywordtype}{size\_t}\ num\_bytes)}
\DoxyCodeLine{00165\ \ \ \ \ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ std::byte\ data[1024];}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (num\_bytes\ >\ 0)\ \{}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ now\ =\ std::min<size\_t>(num\_bytes,\ 1024);}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ read(\{data,\ now\});}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ num\_bytes\ -\/=\ now;}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00172\ \ \ \ \ \}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00175\ \ \ \ \ HashVerifier<Source>\&\ operator>>(T\&\&\ obj)}
\DoxyCodeLine{00176\ \ \ \ \ \{}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ ::Unserialize(*\textcolor{keyword}{this},\ obj);}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00179\ \ \ \ \ \}}
\DoxyCodeLine{00180\ \};}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00183\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Source>}
\DoxyCodeLine{00184\ \textcolor{keyword}{class\ }HashedSourceWriter\ :\ \textcolor{keyword}{public}\ HashWriter}
\DoxyCodeLine{00185\ \{}
\DoxyCodeLine{00186\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00187\ \ \ \ \ Source\&\ m\_source;}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{keyword}{explicit}\ HashedSourceWriter(Source\&\ source\ LIFETIMEBOUND)\ :\ HashWriter\{\},\ m\_source\{source\}\ \{\}}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keywordtype}{void}\ write(std::span<const\ std::byte>\ src)}
\DoxyCodeLine{00193\ \ \ \ \ \{}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ m\_source.write(src);}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ HashWriter::write(src);}
\DoxyCodeLine{00196\ \ \ \ \ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00199\ \ \ \ \ HashedSourceWriter\&\ operator<<(\textcolor{keyword}{const}\ T\&\ obj)}
\DoxyCodeLine{00200\ \ \ \ \ \{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ ::Serialize(*\textcolor{keyword}{this},\ obj);}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00203\ \ \ \ \ \}}
\DoxyCodeLine{00204\ \};}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00207\ [[nodiscard]]\ uint256\ SHA256Uint256(\textcolor{keyword}{const}\ uint256\&\ input);}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00209\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ MurmurHash3(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nHashSeed,\ std::span<const\ unsigned\ char>\ vDataToHash);}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \textcolor{keywordtype}{void}\ BIP32Hash(\textcolor{keyword}{const}\ ChainCode\ \&chainCode,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nChild,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ header,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ data[32],\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ output[64]);}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00219\ HashWriter\ TaggedHash(\textcolor{keyword}{const}\ std::string\&\ tag);}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00222\ \textcolor{keyword}{inline}\ uint160\ RIPEMD160(std::span<const\ unsigned\ char>\ data)}
\DoxyCodeLine{00223\ \{}
\DoxyCodeLine{00224\ \ \ \ \ uint160\ result;}
\DoxyCodeLine{00225\ \ \ \ \ CRIPEMD160().Write(data.data(),\ data.size()).Finalize(result.begin());}
\DoxyCodeLine{00226\ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00227\ \}}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00229\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ BITCOIN\_HASH\_H}}

\end{DoxyCode}
