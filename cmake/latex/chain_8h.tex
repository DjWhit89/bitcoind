\doxysection{src/chain.h File Reference}
\label{chain_8h}\index{src/chain.h@{src/chain.h}}
{\ttfamily \#include $<$arith\+\_\+uint256.\+h$>$}\newline
{\ttfamily \#include $<$consensus/params.\+h$>$}\newline
{\ttfamily \#include $<$flatfile.\+h$>$}\newline
{\ttfamily \#include $<$kernel/cs\+\_\+main.\+h$>$}\newline
{\ttfamily \#include $<$primitives/block.\+h$>$}\newline
{\ttfamily \#include $<$serialize.\+h$>$}\newline
{\ttfamily \#include $<$sync.\+h$>$}\newline
{\ttfamily \#include $<$uint256.\+h$>$}\newline
{\ttfamily \#include $<$util/time.\+h$>$}\newline
{\ttfamily \#include $<$algorithm$>$}\newline
{\ttfamily \#include $<$cassert$>$}\newline
{\ttfamily \#include $<$cstdint$>$}\newline
{\ttfamily \#include $<$string$>$}\newline
{\ttfamily \#include $<$vector$>$}\newline
\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
class \textbf{ CBlock\+Index}
\item 
class \textbf{ CDisk\+Block\+Index}
\item 
class \textbf{ CChain}
\end{DoxyCompactItemize}
\doxysubsubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \textbf{ Block\+Status} \+: uint32\+\_\+t \{ \newline
\textbf{ BLOCK\+\_\+\+VALID\+\_\+\+UNKNOWN} = 0
, \textbf{ BLOCK\+\_\+\+VALID\+\_\+\+RESERVED} = 1
, \textbf{ BLOCK\+\_\+\+VALID\+\_\+\+TREE} = 2
, \textbf{ BLOCK\+\_\+\+VALID\+\_\+\+TRANSACTIONS} = 3
, \newline
\textbf{ BLOCK\+\_\+\+VALID\+\_\+\+CHAIN} = 4
, \textbf{ BLOCK\+\_\+\+VALID\+\_\+\+SCRIPTS} = 5
, \textbf{ BLOCK\+\_\+\+VALID\+\_\+\+MASK}
, \textbf{ BLOCK\+\_\+\+HAVE\+\_\+\+DATA} = 8
, \newline
\textbf{ BLOCK\+\_\+\+HAVE\+\_\+\+UNDO} = 16
, \textbf{ BLOCK\+\_\+\+HAVE\+\_\+\+MASK} = BLOCK\+\_\+\+HAVE\+\_\+\+DATA $\vert$ BLOCK\+\_\+\+HAVE\+\_\+\+UNDO
, \textbf{ BLOCK\+\_\+\+FAILED\+\_\+\+VALID} = 32
, \textbf{ BLOCK\+\_\+\+FAILED\+\_\+\+CHILD} = 64
, \newline
\textbf{ BLOCK\+\_\+\+FAILED\+\_\+\+MASK} = BLOCK\+\_\+\+FAILED\+\_\+\+VALID $\vert$ BLOCK\+\_\+\+FAILED\+\_\+\+CHILD
, \textbf{ BLOCK\+\_\+\+OPT\+\_\+\+WITNESS} = 128
, \textbf{ BLOCK\+\_\+\+STATUS\+\_\+\+RESERVED} = 256
 \}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\textbf{ arith\+\_\+uint256} \textbf{ Get\+Block\+Proof} (const \textbf{ CBlock\+Index} \&block)
\item 
int64\+\_\+t \textbf{ Get\+Block\+Proof\+Equivalent\+Time} (const \textbf{ CBlock\+Index} \&to, const \textbf{ CBlock\+Index} \&from, const \textbf{ CBlock\+Index} \&tip, const \textbf{ Consensus\+::\+Params} \&)
\item 
const \textbf{ CBlock\+Index} $\ast$ \textbf{ Last\+Common\+Ancestor} (const \textbf{ CBlock\+Index} $\ast$pa, const \textbf{ CBlock\+Index} $\ast$pb)
\item 
\textbf{ CBlock\+Locator} \textbf{ Get\+Locator} (const \textbf{ CBlock\+Index} $\ast$index)
\item 
std\+::vector$<$ \textbf{ uint256} $>$ \textbf{ Locator\+Entries} (const \textbf{ CBlock\+Index} $\ast$index)
\end{DoxyCompactItemize}


\label{doc-enum-members}
\doxysubsection{Enumeration Type Documentation}
\index{chain.h@{chain.h}!BlockStatus@{BlockStatus}}
\index{BlockStatus@{BlockStatus}!chain.h@{chain.h}}
\doxysubsubsection{BlockStatus}
{\footnotesize\ttfamily \label{chain_8h_a0d8c285f70a59a32f4f6ab41b78f93ad} 
enum \textbf{ Block\+Status} \+: uint32\+\_\+t}

\begin{DoxyEnumFields}[2]{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{BLOCK\_VALID\_UNKNOWN@{BLOCK\_VALID\_UNKNOWN}!chain.h@{chain.h}}\index{chain.h@{chain.h}!BLOCK\_VALID\_UNKNOWN@{BLOCK\_VALID\_UNKNOWN}}}\label{chain_8h_a0d8c285f70a59a32f4f6ab41b78f93adaf5c7f1d4701444b3f7a0041c96bb4ab6} 
BLOCK\+\_\+\+VALID\+\_\+\+UNKNOWN&Unused. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{BLOCK\_VALID\_RESERVED@{BLOCK\_VALID\_RESERVED}!chain.h@{chain.h}}\index{chain.h@{chain.h}!BLOCK\_VALID\_RESERVED@{BLOCK\_VALID\_RESERVED}}}\label{chain_8h_a0d8c285f70a59a32f4f6ab41b78f93ada4bdb396019c7cf126745a70c513f901d} 
BLOCK\+\_\+\+VALID\+\_\+\+RESERVED&Reserved (was BLOCK\+\_\+\+VALID\+\_\+\+HEADER). \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{BLOCK\_VALID\_TREE@{BLOCK\_VALID\_TREE}!chain.h@{chain.h}}\index{chain.h@{chain.h}!BLOCK\_VALID\_TREE@{BLOCK\_VALID\_TREE}}}\label{chain_8h_a0d8c285f70a59a32f4f6ab41b78f93ada67f3a88eeb793cc62f427f87ae830573} 
BLOCK\+\_\+\+VALID\+\_\+\+TREE&All parent headers found, difficulty matches, timestamp $>$= median previous. Implies all parents are also at least TREE. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{BLOCK\_VALID\_TRANSACTIONS@{BLOCK\_VALID\_TRANSACTIONS}!chain.h@{chain.h}}\index{chain.h@{chain.h}!BLOCK\_VALID\_TRANSACTIONS@{BLOCK\_VALID\_TRANSACTIONS}}}\label{chain_8h_a0d8c285f70a59a32f4f6ab41b78f93ada3eef30f876594ac79b888b7d1ff6c66c} 
BLOCK\+\_\+\+VALID\+\_\+\+TRANSACTIONS&Only first tx is coinbase, 2 $<$= coinbase input script length $<$= 100, transactions valid, no duplicate txids, sigops, size, merkle root. Implies all parents are at least TREE but not necessarily TRANSACTIONS.

If a block\textquotesingle{}s validity is at least VALID\+\_\+\+TRANSACTIONS, \doxyref{CBlock\+Index\+::n\+Tx}{p.}{class_c_block_index_aee88ed2678dfb8c29dbb1ad986c87bf4} will be set. If a block and all previous blocks back to the genesis block or an assumeutxo snapshot block are at least VALID\+\_\+\+TRANSACTIONS, \doxyref{CBlock\+Index\+::m\+\_\+chain\+\_\+tx\+\_\+count}{p.}{class_c_block_index_adcda5b09f2e40d0ed8404453701a6ed4} will be set. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{BLOCK\_VALID\_CHAIN@{BLOCK\_VALID\_CHAIN}!chain.h@{chain.h}}\index{chain.h@{chain.h}!BLOCK\_VALID\_CHAIN@{BLOCK\_VALID\_CHAIN}}}\label{chain_8h_a0d8c285f70a59a32f4f6ab41b78f93ada00332fcf52dbd55990d8ff86b616bc65} 
BLOCK\+\_\+\+VALID\+\_\+\+CHAIN&Outputs do not overspend inputs, no double spends, coinbase output ok, no immature coinbase spends, BIP30. Implies all previous blocks back to the genesis block or an assumeutxo snapshot block are at least VALID\+\_\+\+CHAIN. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{BLOCK\_VALID\_SCRIPTS@{BLOCK\_VALID\_SCRIPTS}!chain.h@{chain.h}}\index{chain.h@{chain.h}!BLOCK\_VALID\_SCRIPTS@{BLOCK\_VALID\_SCRIPTS}}}\label{chain_8h_a0d8c285f70a59a32f4f6ab41b78f93ada47b28fca76b64d094ddca0a3aa8da230} 
BLOCK\+\_\+\+VALID\+\_\+\+SCRIPTS&Scripts \& signatures ok. Implies all previous blocks back to the genesis block or an assumeutxo snapshot block are at least VALID\+\_\+\+SCRIPTS. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{BLOCK\_VALID\_MASK@{BLOCK\_VALID\_MASK}!chain.h@{chain.h}}\index{chain.h@{chain.h}!BLOCK\_VALID\_MASK@{BLOCK\_VALID\_MASK}}}\label{chain_8h_a0d8c285f70a59a32f4f6ab41b78f93ada1223c736f6157ad915dd31f6a1577846} 
BLOCK\+\_\+\+VALID\+\_\+\+MASK&All validity bits. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{BLOCK\_HAVE\_DATA@{BLOCK\_HAVE\_DATA}!chain.h@{chain.h}}\index{chain.h@{chain.h}!BLOCK\_HAVE\_DATA@{BLOCK\_HAVE\_DATA}}}\label{chain_8h_a0d8c285f70a59a32f4f6ab41b78f93ada77d49f747f3df764efac2d3f4522bb15} 
BLOCK\+\_\+\+HAVE\+\_\+\+DATA&full block available in blk$\ast$.dat \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{BLOCK\_HAVE\_UNDO@{BLOCK\_HAVE\_UNDO}!chain.h@{chain.h}}\index{chain.h@{chain.h}!BLOCK\_HAVE\_UNDO@{BLOCK\_HAVE\_UNDO}}}\label{chain_8h_a0d8c285f70a59a32f4f6ab41b78f93ada722a05d892a13ada5ffd4fcbbef837cd} 
BLOCK\+\_\+\+HAVE\+\_\+\+UNDO&undo data available in rev$\ast$.dat \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{BLOCK\_HAVE\_MASK@{BLOCK\_HAVE\_MASK}!chain.h@{chain.h}}\index{chain.h@{chain.h}!BLOCK\_HAVE\_MASK@{BLOCK\_HAVE\_MASK}}}\label{chain_8h_a0d8c285f70a59a32f4f6ab41b78f93adacdae7e012d53f3bca66c098681f79d0c} 
BLOCK\+\_\+\+HAVE\+\_\+\+MASK&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{BLOCK\_FAILED\_VALID@{BLOCK\_FAILED\_VALID}!chain.h@{chain.h}}\index{chain.h@{chain.h}!BLOCK\_FAILED\_VALID@{BLOCK\_FAILED\_VALID}}}\label{chain_8h_a0d8c285f70a59a32f4f6ab41b78f93adab3f668fe41faf909922945b37b25ec2d} 
BLOCK\+\_\+\+FAILED\+\_\+\+VALID&stage after last reached validness failed \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{BLOCK\_FAILED\_CHILD@{BLOCK\_FAILED\_CHILD}!chain.h@{chain.h}}\index{chain.h@{chain.h}!BLOCK\_FAILED\_CHILD@{BLOCK\_FAILED\_CHILD}}}\label{chain_8h_a0d8c285f70a59a32f4f6ab41b78f93ada8653dc31c354a84e6fd0be105889262f} 
BLOCK\+\_\+\+FAILED\+\_\+\+CHILD&descends from failed block \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{BLOCK\_FAILED\_MASK@{BLOCK\_FAILED\_MASK}!chain.h@{chain.h}}\index{chain.h@{chain.h}!BLOCK\_FAILED\_MASK@{BLOCK\_FAILED\_MASK}}}\label{chain_8h_a0d8c285f70a59a32f4f6ab41b78f93ada88df51e92f2f675baff60e0a5bd170ef} 
BLOCK\+\_\+\+FAILED\+\_\+\+MASK&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{BLOCK\_OPT\_WITNESS@{BLOCK\_OPT\_WITNESS}!chain.h@{chain.h}}\index{chain.h@{chain.h}!BLOCK\_OPT\_WITNESS@{BLOCK\_OPT\_WITNESS}}}\label{chain_8h_a0d8c285f70a59a32f4f6ab41b78f93adabb5ecf540d50ee9d9f1846609d59caf5} 
BLOCK\+\_\+\+OPT\+\_\+\+WITNESS&block data in blk$\ast$.dat was received with a witness-\/enforcing client \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{BLOCK\_STATUS\_RESERVED@{BLOCK\_STATUS\_RESERVED}!chain.h@{chain.h}}\index{chain.h@{chain.h}!BLOCK\_STATUS\_RESERVED@{BLOCK\_STATUS\_RESERVED}}}\label{chain_8h_a0d8c285f70a59a32f4f6ab41b78f93ada64a3ba47e8dc951f9dab5dd8da4253a4} 
BLOCK\+\_\+\+STATUS\+\_\+\+RESERVED&Unused flag that was previously set on assumeutxo snapshot blocks and their ancestors before they were validated, and unset when they were validated. \\
\hline

\end{DoxyEnumFields}


\label{doc-func-members}
\doxysubsection{Function Documentation}
\index{chain.h@{chain.h}!GetBlockProof@{GetBlockProof}}
\index{GetBlockProof@{GetBlockProof}!chain.h@{chain.h}}
\doxysubsubsection{GetBlockProof()}
{\footnotesize\ttfamily \label{chain_8h_a334aa8015cc7185f7fdf484783e40f38} 
\textbf{ arith\+\_\+uint256} Get\+Block\+Proof (\begin{DoxyParamCaption}\item[{const \textbf{ CBlock\+Index} \&}]{block}{}\end{DoxyParamCaption})}

\index{chain.h@{chain.h}!GetBlockProofEquivalentTime@{GetBlockProofEquivalentTime}}
\index{GetBlockProofEquivalentTime@{GetBlockProofEquivalentTime}!chain.h@{chain.h}}
\doxysubsubsection{GetBlockProofEquivalentTime()}
{\footnotesize\ttfamily \label{chain_8h_a6f922f61b23b0fc46182f8ab457af736} 
int64\+\_\+t Get\+Block\+Proof\+Equivalent\+Time (\begin{DoxyParamCaption}\item[{const \textbf{ CBlock\+Index} \&}]{to}{, }\item[{const \textbf{ CBlock\+Index} \&}]{from}{, }\item[{const \textbf{ CBlock\+Index} \&}]{tip}{, }\item[{const \textbf{ Consensus\+::\+Params} \&}]{params}{}\end{DoxyParamCaption})}

Return the time it would take to redo the work difference between from and to, assuming the current hashrate corresponds to the difficulty at tip, in seconds. \index{chain.h@{chain.h}!GetLocator@{GetLocator}}
\index{GetLocator@{GetLocator}!chain.h@{chain.h}}
\doxysubsubsection{GetLocator()}
{\footnotesize\ttfamily \label{chain_8h_a6f7cb8de33a43e97b3dd7517998379bc} 
\textbf{ CBlock\+Locator} Get\+Locator (\begin{DoxyParamCaption}\item[{const \textbf{ CBlock\+Index} $\ast$}]{index}{}\end{DoxyParamCaption})}

Get a locator for a block index entry. \index{chain.h@{chain.h}!LastCommonAncestor@{LastCommonAncestor}}
\index{LastCommonAncestor@{LastCommonAncestor}!chain.h@{chain.h}}
\doxysubsubsection{LastCommonAncestor()}
{\footnotesize\ttfamily \label{chain_8h_add771d649e0005eaf353c1d04626df91} 
const \textbf{ CBlock\+Index} $\ast$ Last\+Common\+Ancestor (\begin{DoxyParamCaption}\item[{const \textbf{ CBlock\+Index} $\ast$}]{pa}{, }\item[{const \textbf{ CBlock\+Index} $\ast$}]{pb}{}\end{DoxyParamCaption})}

Find the forking point between two chain tips.

Find the last common ancestor two blocks have. Both pa and pb must be non-\/nullptr. \index{chain.h@{chain.h}!LocatorEntries@{LocatorEntries}}
\index{LocatorEntries@{LocatorEntries}!chain.h@{chain.h}}
\doxysubsubsection{LocatorEntries()}
{\footnotesize\ttfamily \label{chain_8h_a4d0d44b98412abca88a643e6c6019ac2} 
std\+::vector$<$ \textbf{ uint256} $>$ Locator\+Entries (\begin{DoxyParamCaption}\item[{const \textbf{ CBlock\+Index} $\ast$}]{index}{}\end{DoxyParamCaption})}

Construct a list of hash entries to put in a locator. 