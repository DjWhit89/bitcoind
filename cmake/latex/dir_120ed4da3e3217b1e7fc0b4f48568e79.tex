\doxysection{src/test Directory Reference}
\label{dir_120ed4da3e3217b1e7fc0b4f48568e79}\index{src/test Directory Reference@{src/test Directory Reference}}
\doxysubsubsection*{Directories}
\begin{DoxyCompactItemize}
\item 
directory \textbf{ data}
\item 
directory \textbf{ fuzz}
\item 
directory \textbf{ kernel}
\item 
directory \textbf{ util}
\end{DoxyCompactItemize}
\doxysubsubsection*{Files}
\begin{DoxyCompactItemize}
\item 
file \textbf{ addrman\+\_\+tests.\+cpp}
\item 
file \textbf{ allocator\+\_\+tests.\+cpp}
\item 
file \textbf{ amount\+\_\+tests.\+cpp}
\item 
file \textbf{ argsman\+\_\+tests.\+cpp}
\item 
file \textbf{ arith\+\_\+uint256\+\_\+tests.\+cpp}
\item 
file \textbf{ banman\+\_\+tests.\+cpp}
\item 
file \textbf{ base32\+\_\+tests.\+cpp}
\item 
file \textbf{ base58\+\_\+tests.\+cpp}
\item 
file \textbf{ base64\+\_\+tests.\+cpp}
\item 
file \textbf{ bech32\+\_\+tests.\+cpp}
\item 
file \textbf{ bip324\+\_\+tests.\+cpp}
\item 
file \textbf{ bip32\+\_\+tests.\+cpp}
\item 
file \textbf{ blockchain\+\_\+tests.\+cpp}
\item 
file \textbf{ blockencodings\+\_\+tests.\+cpp}
\item 
file \textbf{ blockfilter\+\_\+index\+\_\+tests.\+cpp}
\item 
file \textbf{ blockfilter\+\_\+tests.\+cpp}
\item 
file \textbf{ blockmanager\+\_\+tests.\+cpp}
\item 
file \textbf{ bloom\+\_\+tests.\+cpp}
\item 
file \textbf{ bswap\+\_\+tests.\+cpp}
\item 
file \textbf{ caches\+\_\+tests.\+cpp}
\item 
file \textbf{ chain\+\_\+tests.\+cpp}
\item 
file \textbf{ chainstate\+\_\+write\+\_\+tests.\+cpp}
\item 
file \textbf{ checkqueue\+\_\+tests.\+cpp}
\item 
file \textbf{ cluster\+\_\+linearize\+\_\+tests.\+cpp}
\item 
file \textbf{ coins\+\_\+tests.\+cpp}
\item 
file \textbf{ coinscachepair\+\_\+tests.\+cpp}
\item 
file \textbf{ coinstatsindex\+\_\+tests.\+cpp}
\item 
file \textbf{ common\+\_\+url\+\_\+tests.\+cpp}
\item 
file \textbf{ compress\+\_\+tests.\+cpp}
\item 
file \textbf{ crypto\+\_\+tests.\+cpp}
\item 
file \textbf{ cuckoocache\+\_\+tests.\+cpp}
\item 
file \textbf{ dbwrapper\+\_\+tests.\+cpp}
\item 
file \textbf{ denialofservice\+\_\+tests.\+cpp}
\item 
file \textbf{ descriptor\+\_\+tests.\+cpp}
\item 
file \textbf{ disconnected\+\_\+transactions.\+cpp}
\item 
file \textbf{ feefrac\+\_\+tests.\+cpp}
\item 
file \textbf{ feerounder\+\_\+tests.\+cpp}
\item 
file \textbf{ flatfile\+\_\+tests.\+cpp}
\item 
file \textbf{ fs\+\_\+tests.\+cpp}
\item 
file \textbf{ getarg\+\_\+tests.\+cpp}
\item 
file \textbf{ hash\+\_\+tests.\+cpp}
\item 
file \textbf{ headers\+\_\+sync\+\_\+chainwork\+\_\+tests.\+cpp}
\item 
file \textbf{ httpserver\+\_\+tests.\+cpp}
\item 
file \textbf{ i2p\+\_\+tests.\+cpp}
\item 
file \textbf{ interfaces\+\_\+tests.\+cpp}
\item 
file \textbf{ key\+\_\+io\+\_\+tests.\+cpp}
\item 
file \textbf{ key\+\_\+tests.\+cpp}
\item 
file \textbf{ logging\+\_\+tests.\+cpp}
\item 
file \textbf{ main.\+cpp}
\item 
file \textbf{ mempool\+\_\+tests.\+cpp}
\item 
file \textbf{ merkle\+\_\+tests.\+cpp}
\item 
file \textbf{ merkleblock\+\_\+tests.\+cpp}
\item 
file \textbf{ miner\+\_\+tests.\+cpp}
\item 
file \textbf{ miniminer\+\_\+tests.\+cpp}
\item 
file \textbf{ miniscript\+\_\+tests.\+cpp}
\item 
file \textbf{ minisketch\+\_\+tests.\+cpp}
\item 
file \textbf{ multisig\+\_\+tests.\+cpp}
\item 
file \textbf{ net\+\_\+peer\+\_\+connection\+\_\+tests.\+cpp}
\item 
file \textbf{ net\+\_\+peer\+\_\+eviction\+\_\+tests.\+cpp}
\item 
file \textbf{ net\+\_\+tests.\+cpp}
\item 
file \textbf{ netbase\+\_\+tests.\+cpp}
\item 
file \textbf{ node\+\_\+init\+\_\+tests.\+cpp}
\item 
file \textbf{ node\+\_\+warnings\+\_\+tests.\+cpp}
\item 
file \textbf{ orphanage\+\_\+tests.\+cpp}
\item 
file \textbf{ pcp\+\_\+tests.\+cpp}
\item 
file \textbf{ peerman\+\_\+tests.\+cpp}
\item 
file \textbf{ pmt\+\_\+tests.\+cpp}
\item 
file \textbf{ policyestimator\+\_\+tests.\+cpp}
\item 
file \textbf{ pool\+\_\+tests.\+cpp}
\item 
file \textbf{ pow\+\_\+tests.\+cpp}
\item 
file \textbf{ prevector\+\_\+tests.\+cpp}
\item 
file \textbf{ raii\+\_\+event\+\_\+tests.\+cpp}
\item 
file \textbf{ random\+\_\+tests.\+cpp}
\item 
file \textbf{ rbf\+\_\+tests.\+cpp}
\item 
file \textbf{ rest\+\_\+tests.\+cpp}
\item 
file \textbf{ result\+\_\+tests.\+cpp}
\item 
file \textbf{ reverselock\+\_\+tests.\+cpp}
\item 
file \textbf{ rpc\+\_\+tests.\+cpp}
\item 
file \textbf{ sanity\+\_\+tests.\+cpp}
\item 
file \textbf{ scheduler\+\_\+tests.\+cpp}
\item 
file \textbf{ script\+\_\+assets\+\_\+tests.\+cpp}
\item 
file \textbf{ script\+\_\+p2sh\+\_\+tests.\+cpp}
\item 
file \textbf{ script\+\_\+parse\+\_\+tests.\+cpp}
\item 
file \textbf{ script\+\_\+segwit\+\_\+tests.\+cpp}
\item 
file \textbf{ script\+\_\+standard\+\_\+tests.\+cpp}
\item 
file \textbf{ script\+\_\+tests.\+cpp}
\item 
file \textbf{ scriptnum10.\+h}
\item 
file \textbf{ scriptnum\+\_\+tests.\+cpp}
\item 
file \textbf{ serfloat\+\_\+tests.\+cpp}
\item 
file \textbf{ serialize\+\_\+tests.\+cpp}
\item 
file \textbf{ settings\+\_\+tests.\+cpp}
\item 
file \textbf{ sighash\+\_\+tests.\+cpp}
\item 
file \textbf{ sigopcount\+\_\+tests.\+cpp}
\item 
file \textbf{ skiplist\+\_\+tests.\+cpp}
\item 
file \textbf{ sock\+\_\+tests.\+cpp}
\item 
file \textbf{ span\+\_\+tests.\+cpp}
\item 
file \textbf{ streams\+\_\+tests.\+cpp}
\item 
file \textbf{ sync\+\_\+tests.\+cpp}
\item 
file \textbf{ system\+\_\+ram\+\_\+tests.\+cpp}
\item 
file \textbf{ system\+\_\+tests.\+cpp}
\item 
file \textbf{ testnet4\+\_\+miner\+\_\+tests.\+cpp}
\item 
file \textbf{ timeoffsets\+\_\+tests.\+cpp}
\item 
file \textbf{ torcontrol\+\_\+tests.\+cpp}
\item 
file \textbf{ transaction\+\_\+tests.\+cpp}
\item 
file \textbf{ translation\+\_\+tests.\+cpp}
\item 
file \textbf{ txdownload\+\_\+tests.\+cpp}
\item 
file \textbf{ txgraph\+\_\+tests.\+cpp}
\item 
file \textbf{ txindex\+\_\+tests.\+cpp}
\item 
file \textbf{ txpackage\+\_\+tests.\+cpp}
\item 
file \textbf{ txreconciliation\+\_\+tests.\+cpp}
\item 
file \textbf{ txrequest\+\_\+tests.\+cpp}
\item 
file \textbf{ txvalidation\+\_\+tests.\+cpp}
\item 
file \textbf{ txvalidationcache\+\_\+tests.\+cpp}
\item 
file \textbf{ uint256\+\_\+tests.\+cpp}
\item 
file \textbf{ util\+\_\+check\+\_\+tests.\+cpp}
\item 
file \textbf{ util\+\_\+expected\+\_\+tests.\+cpp}
\item 
file \textbf{ util\+\_\+string\+\_\+tests.\+cpp}
\item 
file \textbf{ util\+\_\+tests.\+cpp}
\item 
file \textbf{ util\+\_\+threadnames\+\_\+tests.\+cpp}
\item 
file \textbf{ util\+\_\+trace\+\_\+tests.\+cpp}
\item 
file \textbf{ validation\+\_\+block\+\_\+tests.\+cpp}
\item 
file \textbf{ validation\+\_\+chainstate\+\_\+tests.\+cpp}
\item 
file \textbf{ validation\+\_\+chainstatemanager\+\_\+tests.\+cpp}
\item 
file \textbf{ validation\+\_\+flush\+\_\+tests.\+cpp}
\item 
file \textbf{ validation\+\_\+tests.\+cpp}
\item 
file \textbf{ validationinterface\+\_\+tests.\+cpp}
\item 
file \textbf{ versionbits\+\_\+tests.\+cpp}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\doxysubsection{Unit tests}\label{dir_120ed4da3e3217b1e7fc0b4f48568e79_autotoc_md225}
The sources in this directory are unit test cases. Boost includes a unit testing framework, and since Bitcoin Core already uses Boost, it makes sense to simply use this framework rather than require developers to configure some other framework (we want as few impediments to creating unit tests as possible).

The build system is set up to compile an executable called {\ttfamily test\+\_\+bitcoin} that runs all of the unit tests. The main source file for the test library is found in {\ttfamily \doxyref{util/setup\+\_\+common.\+cpp}{p.}{setup__common_8cpp}}.

The examples in this document assume the build directory is named {\ttfamily build}. You\textquotesingle{}ll need to adapt them if you named it differently.\doxysubsubsection{Compiling/running unit tests}\label{dir_120ed4da3e3217b1e7fc0b4f48568e79_autotoc_md226}
Unit tests will be automatically compiled if dependencies were met during the generation of the Bitcoin Core build system and tests weren\textquotesingle{}t explicitly disabled.

The unit tests can be run with {\ttfamily ctest -\/-\/test-\/dir build}, which includes unit tests from subtrees.

Run {\ttfamily build/bin/test\+\_\+bitcoin -\/-\/list\+\_\+content} for the full list of tests.

To run the unit tests manually, launch {\ttfamily build/bin/test\+\_\+bitcoin}. To recompile after a test file was modified, run {\ttfamily cmake -\/-\/build build} and then run the test again. If you modify a non-\/test file, use {\ttfamily cmake -\/-\/build build -\/-\/target test\+\_\+bitcoin} to recompile only what\textquotesingle{}s needed to run the unit tests.

To add more unit tests, add {\ttfamily \doxyref{BOOST\+\_\+\+AUTO\+\_\+\+TEST\+\_\+\+CASE}{p.}{ipc__tests_8cpp_a0f1ce113eb128ddbcd289bcbcb711cc8}} functions to the existing .cpp files in the {\ttfamily test/} directory or add new .cpp files that implement new {\ttfamily BOOST\+\_\+\+AUTO\+\_\+\+TEST\+\_\+\+SUITE} sections.

To run the GUI unit tests manually, launch {\ttfamily build/bin/test\+\_\+bitcoin-\/qt}

To add more GUI unit tests, add them to the {\ttfamily src/qt/test/} directory and the {\ttfamily \doxyref{src/qt/test/test\+\_\+main.\+cpp}{p.}{test__main_8cpp}} file.\doxysubsubsection{Running individual tests}\label{dir_120ed4da3e3217b1e7fc0b4f48568e79_autotoc_md227}
The {\ttfamily test\+\_\+bitcoin} runner accepts command line arguments from the Boost framework. To see the list of arguments that may be passed, run\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{build/bin/test\_bitcoin\ -\/-\/help}

\end{DoxyCode}


For example, to run only the tests in the {\ttfamily getarg\+\_\+tests} file, with full logging\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{build/bin/test\_bitcoin\ -\/-\/log\_level=all\ -\/-\/run\_test=getarg\_tests}

\end{DoxyCode}


or


\begin{DoxyCode}{0}
\DoxyCodeLine{build/bin/test\_bitcoin\ -\/l\ all\ -\/t\ getarg\_tests}

\end{DoxyCode}


or to run only the doubledash test in {\ttfamily getarg\+\_\+tests}


\begin{DoxyCode}{0}
\DoxyCodeLine{build/bin/test\_bitcoin\ -\/-\/run\_test=getarg\_tests/doubledash}

\end{DoxyCode}


The {\ttfamily -\/-\/log\+\_\+level=} (or {\ttfamily -\/l}) argument controls the verbosity of the test output.

The {\ttfamily test\+\_\+bitcoin} runner also accepts some of the command line arguments accepted by {\ttfamily bitcoind}. Use {\ttfamily -\/-\/} to separate these sets of arguments\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{build/bin/test\_bitcoin\ -\/-\/log\_level=all\ -\/-\/run\_test=getarg\_tests\ -\/-\/\ -\/printtoconsole=1}

\end{DoxyCode}


The {\ttfamily -\/printtoconsole=1} after the two dashes sends debug logging, which normally goes only to {\ttfamily debug.\+log} within the data directory, to the standard terminal output as well.

Running {\ttfamily test\+\_\+bitcoin} creates a temporary working (data) directory with a randomly generated pathname within {\ttfamily test\+\_\+common bitcoin/}, which in turn is within the system\textquotesingle{}s temporary directory (see {\texttt{{\ttfamily temp\+\_\+directory\+\_\+path}}}). This data directory looks like a simplified form of the standard {\ttfamily bitcoind} data directory. Its content will vary depending on the test, but it will always have a {\ttfamily debug.\+log} file, for example.

The location of the temporary data directory can be specified with the {\ttfamily -\/testdatadir} option. This can make debugging easier. The directory path used is the argument path appended with {\ttfamily /test\+\_\+common bitcoin/$<$test-\/name$>$/datadir}. The directory path is created if necessary. Specifying this argument also causes the data directory not to be removed after the last test. This is useful for looking at what the test wrote to {\ttfamily debug.\+log} after it completes, for example. (The directory is removed at the start of the next test run, so no leftover state is used.)


\begin{DoxyCode}{0}
\DoxyCodeLine{\$\ build/bin/test\_bitcoin\ -\/-\/run\_test=getarg\_tests/doubledash\ -\/-\/\ -\/testdatadir=/somewhere/mydatadir}
\DoxyCodeLine{Test\ directory\ (will\ not\ be\ deleted):\ "{}/somewhere/mydatadir/test\_common\ bitcoin/getarg\_tests/doubledash/datadir"{}}
\DoxyCodeLine{Running\ 1\ test\ case...}
\DoxyCodeLine{}
\DoxyCodeLine{***\ No\ errors\ detected}
\DoxyCodeLine{\$\ ls\ -\/l\ '/somewhere/mydatadir/test\_common\ bitcoin/getarg\_tests/doubledash/datadir'}
\DoxyCodeLine{total\ 8}
\DoxyCodeLine{drwxrwxr-\/x\ 2\ admin\ admin\ 4096\ Nov\ 27\ 22:45\ blocks}
\DoxyCodeLine{-\/rw-\/rw-\/r-\/-\/\ 1\ admin\ admin\ 1003\ Nov\ 27\ 22:45\ debug.log}

\end{DoxyCode}


If you run an entire test suite, such as {\ttfamily -\/-\/run\+\_\+test=getarg\+\_\+tests}, or all the test suites (by not specifying {\ttfamily -\/-\/run\+\_\+test}), a separate directory will be created for each individual test.\doxysubsubsection{Adding test cases}\label{dir_120ed4da3e3217b1e7fc0b4f48568e79_autotoc_md228}
To add a new unit test file to our test suite, you need to add the file to either {\ttfamily src/test/\+CMake\+Lists.\+txt} or {\ttfamily src/wallet/test/\+CMake\+Lists.\+txt} for wallet-\/related tests. The pattern is to create one test file for each class or source file for which you want to create unit tests. The file naming convention is {\ttfamily $<$source\+\_\+filename$>$\+\_\+tests.\+cpp} and such files should wrap their tests in a test suite called {\ttfamily $<$source\+\_\+filename$>$\+\_\+tests}. For an example of this pattern, see {\ttfamily \doxyref{uint256\+\_\+tests.\+cpp}{p.}{uint256__tests_8cpp}}.\doxysubsubsection{Logging and debugging in unit tests}\label{dir_120ed4da3e3217b1e7fc0b4f48568e79_autotoc_md229}
{\ttfamily ctest -\/-\/test-\/dir build} will write to the log file {\ttfamily build/\+Testing/\+Temporary/\+Last\+Test.\+log}. You can additionally use the {\ttfamily -\/-\/output-\/on-\/failure} option to display logs of the failed tests automatically on failure. For running individual tests verbosely, refer to the section above.

To write to logs from unit tests you need to use specific message methods provided by Boost. The simplest is {\ttfamily BOOST\+\_\+\+TEST\+\_\+\+MESSAGE}.

For debugging you can launch the {\ttfamily test\+\_\+bitcoin} executable with {\ttfamily gdb} or {\ttfamily lldb} and start debugging, just like you would with any other program\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{gdb\ build/bin/test\_bitcoin}

\end{DoxyCode}
\doxysubsubsubsection{Segmentation faults}\label{dir_120ed4da3e3217b1e7fc0b4f48568e79_autotoc_md230}
If you hit a segmentation fault during a test run, you can diagnose where the fault is happening by running {\ttfamily gdb ./build/bin/test\+\_\+bitcoin} and then using the {\ttfamily bt} command within gdb.

Another tool that can be used to resolve segmentation faults is {\texttt{valgrind}}.

If for whatever reason you want to produce a core dump file for this fault, you can do that as well. By default, the boost test runner will intercept system errors and not produce a core file. To bypass this, add {\ttfamily -\/-\/catch\+\_\+system\+\_\+errors=no} to the {\ttfamily test\+\_\+bitcoin} arguments and ensure that your ulimits are set properly (e.\+g. {\ttfamily ulimit -\/c unlimited}).

Running the tests and hitting a segmentation fault should now produce a file called {\ttfamily core} (on Linux platforms, the file name will likely depend on the contents of {\ttfamily /proc/sys/kernel/core\+\_\+pattern}).

You can then explore the core dump using 
\begin{DoxyCode}{0}
\DoxyCodeLine{gdb\ build/bin/test\_bitcoin\ core}
\DoxyCodeLine{}
\DoxyCodeLine{(gdb)\ bt\ \ \#\ produce\ a\ backtrace\ for\ where\ a\ segfault\ occurred}

\end{DoxyCode}
 