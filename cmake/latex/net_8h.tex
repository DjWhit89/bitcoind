\doxysection{src/net.h File Reference}
\label{net_8h}\index{src/net.h@{src/net.h}}
{\ttfamily \#include $<$bip324.\+h$>$}\newline
{\ttfamily \#include $<$chainparams.\+h$>$}\newline
{\ttfamily \#include $<$common/bloom.\+h$>$}\newline
{\ttfamily \#include $<$compat/compat.\+h$>$}\newline
{\ttfamily \#include $<$consensus/amount.\+h$>$}\newline
{\ttfamily \#include $<$crypto/siphash.\+h$>$}\newline
{\ttfamily \#include $<$hash.\+h$>$}\newline
{\ttfamily \#include $<$i2p.\+h$>$}\newline
{\ttfamily \#include $<$kernel/messagestartchars.\+h$>$}\newline
{\ttfamily \#include $<$net\+\_\+permissions.\+h$>$}\newline
{\ttfamily \#include $<$netaddress.\+h$>$}\newline
{\ttfamily \#include $<$netbase.\+h$>$}\newline
{\ttfamily \#include $<$netgroup.\+h$>$}\newline
{\ttfamily \#include $<$node/connection\+\_\+types.\+h$>$}\newline
{\ttfamily \#include $<$node/protocol\+\_\+version.\+h$>$}\newline
{\ttfamily \#include $<$policy/feerate.\+h$>$}\newline
{\ttfamily \#include $<$protocol.\+h$>$}\newline
{\ttfamily \#include $<$random.\+h$>$}\newline
{\ttfamily \#include $<$semaphore\+\_\+grant.\+h$>$}\newline
{\ttfamily \#include $<$span.\+h$>$}\newline
{\ttfamily \#include $<$streams.\+h$>$}\newline
{\ttfamily \#include $<$sync.\+h$>$}\newline
{\ttfamily \#include $<$uint256.\+h$>$}\newline
{\ttfamily \#include $<$util/check.\+h$>$}\newline
{\ttfamily \#include $<$util/sock.\+h$>$}\newline
{\ttfamily \#include $<$util/threadinterrupt.\+h$>$}\newline
{\ttfamily \#include $<$atomic$>$}\newline
{\ttfamily \#include $<$condition\+\_\+variable$>$}\newline
{\ttfamily \#include $<$cstdint$>$}\newline
{\ttfamily \#include $<$deque$>$}\newline
{\ttfamily \#include $<$functional$>$}\newline
{\ttfamily \#include $<$list$>$}\newline
{\ttfamily \#include $<$map$>$}\newline
{\ttfamily \#include $<$memory$>$}\newline
{\ttfamily \#include $<$optional$>$}\newline
{\ttfamily \#include $<$queue$>$}\newline
{\ttfamily \#include $<$string\+\_\+view$>$}\newline
{\ttfamily \#include $<$thread$>$}\newline
{\ttfamily \#include $<$unordered\+\_\+set$>$}\newline
{\ttfamily \#include $<$vector$>$}\newline
\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \textbf{ Added\+Node\+Params}
\item 
struct \textbf{ Added\+Node\+Info}
\item 
struct \textbf{ CSerialized\+Net\+Msg}
\item 
struct \textbf{ Local\+Service\+Info}
\item 
class \textbf{ CNode\+Stats}
\item 
class \textbf{ CNet\+Message}
\item 
class \textbf{ Transport}
\item 
struct \textbf{ Transport\+::\+Info}
\item 
class \textbf{ V1\+Transport}
\item 
class \textbf{ V2\+Transport}
\item 
struct \textbf{ CNode\+Options}
\item 
class \textbf{ CNode}
\item 
class \textbf{ Net\+Events\+Interface}
\item 
class \textbf{ CConnman}
\item 
struct \textbf{ CConnman\+::\+Options}
\end{DoxyCompactItemize}
\doxysubsubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef int64\+\_\+t \textbf{ Node\+Id}
\item 
using \textbf{ map\+Msg\+Type\+Size} = std\+::map$<$ std\+::string, uint64\+\_\+t$>$
\end{DoxyCompactItemize}
\doxysubsubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \{ \newline
\textbf{ LOCAL\+\_\+\+NONE}
, \textbf{ LOCAL\+\_\+\+IF}
, \textbf{ LOCAL\+\_\+\+BIND}
, \textbf{ LOCAL\+\_\+\+MAPPED}
, \newline
\textbf{ LOCAL\+\_\+\+MANUAL}
, \textbf{ LOCAL\+\_\+\+MAX}
 \}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \textbf{ Discover} ()
\item 
uint16\+\_\+t \textbf{ Get\+Listen\+Port} ()
\item 
std\+::optional$<$ \textbf{ CService} $>$ \textbf{ Get\+Local\+Addr\+For\+Peer} (\textbf{ CNode} \&\textbf{ node})
\item 
void \textbf{ Clear\+Local} ()
\item 
bool \textbf{ Add\+Local} (const \textbf{ CService} \&addr, int n\+Score=\textbf{ LOCAL\+\_\+\+NONE})
\item 
bool \textbf{ Add\+Local} (const \textbf{ CNet\+Addr} \&addr, int n\+Score=\textbf{ LOCAL\+\_\+\+NONE})
\item 
void \textbf{ Remove\+Local} (const \textbf{ CService} \&addr)
\item 
bool \textbf{ Seen\+Local} (const \textbf{ CService} \&addr)
\item 
bool \textbf{ Is\+Local} (const \textbf{ CService} \&addr)
\item 
\textbf{ CService} \textbf{ Get\+Local\+Address} (const \textbf{ CNode} \&peer)
\item 
std\+::map$<$ \textbf{ CNet\+Addr}, \textbf{ Local\+Service\+Info} $>$ map\+Local\+Host \textbf{ GUARDED\+\_\+\+BY} (\textbf{ g\+\_\+maplocalhost\+\_\+mutex})
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
bool \textbf{ f\+Discover}
\item 
bool \textbf{ f\+Listen}
\item 
std\+::string \textbf{ str\+Sub\+Version}
\item 
\textbf{ Global\+Mutex} \textbf{ g\+\_\+maplocalhost\+\_\+mutex}
\item 
const std\+::string \textbf{ NET\+\_\+\+MESSAGE\+\_\+\+TYPE\+\_\+\+OTHER}
\item 
std\+::function$<$ void(const \textbf{ CAddress} \&addr, const std\+::string \&msg\+\_\+type, std\+::span$<$ const unsigned char $>$ data, bool is\+\_\+incoming)$>$ \textbf{ Capture\+Message}
\end{DoxyCompactItemize}


\label{doc-typedef-members}
\doxysubsection{Typedef Documentation}
\index{net.h@{net.h}!mapMsgTypeSize@{mapMsgTypeSize}}
\index{mapMsgTypeSize@{mapMsgTypeSize}!net.h@{net.h}}
\doxysubsubsection{mapMsgTypeSize}
{\footnotesize\ttfamily \label{net_8h_a7a478fc3c579111d262ac80e794e9291} 
using \textbf{ map\+Msg\+Type\+Size} = std\+::map$<$ std\+::string, uint64\+\_\+t$>$}

\index{net.h@{net.h}!NodeId@{NodeId}}
\index{NodeId@{NodeId}!net.h@{net.h}}
\doxysubsubsection{NodeId}
{\footnotesize\ttfamily \label{net_8h_aa637b11e18b77724b35db2229cd12788} 
typedef int64\+\_\+t \textbf{ Node\+Id}}



\label{doc-enum-members}
\doxysubsection{Enumeration Type Documentation}
\doxysubsubsection{anonymous enum}
{\footnotesize\ttfamily \label{net_8h_a5618e5a4c38d4d24df5679d193086564} 
anonymous enum}

\begin{DoxyEnumFields}[2]{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{LOCAL\_NONE@{LOCAL\_NONE}!net.h@{net.h}}\index{net.h@{net.h}!LOCAL\_NONE@{LOCAL\_NONE}}}\label{net_8h_a5618e5a4c38d4d24df5679d193086564a1d33b76bcbc0dbb757cc02bb2259775b} 
LOCAL\+\_\+\+NONE&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{LOCAL\_IF@{LOCAL\_IF}!net.h@{net.h}}\index{net.h@{net.h}!LOCAL\_IF@{LOCAL\_IF}}}\label{net_8h_a5618e5a4c38d4d24df5679d193086564afa44f0377f6449a82e1e6176acfe44f7} 
LOCAL\+\_\+\+IF&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{LOCAL\_BIND@{LOCAL\_BIND}!net.h@{net.h}}\index{net.h@{net.h}!LOCAL\_BIND@{LOCAL\_BIND}}}\label{net_8h_a5618e5a4c38d4d24df5679d193086564aad42caef30be428cb73f7d2753b5162e} 
LOCAL\+\_\+\+BIND&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{LOCAL\_MAPPED@{LOCAL\_MAPPED}!net.h@{net.h}}\index{net.h@{net.h}!LOCAL\_MAPPED@{LOCAL\_MAPPED}}}\label{net_8h_a5618e5a4c38d4d24df5679d193086564a68d866da9163e362caba73115f044ca3} 
LOCAL\+\_\+\+MAPPED&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{LOCAL\_MANUAL@{LOCAL\_MANUAL}!net.h@{net.h}}\index{net.h@{net.h}!LOCAL\_MANUAL@{LOCAL\_MANUAL}}}\label{net_8h_a5618e5a4c38d4d24df5679d193086564a85f937846a9820dce1ac928efee52a91} 
LOCAL\+\_\+\+MANUAL&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{LOCAL\_MAX@{LOCAL\_MAX}!net.h@{net.h}}\index{net.h@{net.h}!LOCAL\_MAX@{LOCAL\_MAX}}}\label{net_8h_a5618e5a4c38d4d24df5679d193086564a8f7a4de904e634f46aa0d9b8fbf1b67e} 
LOCAL\+\_\+\+MAX&\\
\hline

\end{DoxyEnumFields}


\label{doc-func-members}
\doxysubsection{Function Documentation}
\index{net.h@{net.h}!AddLocal@{AddLocal}}
\index{AddLocal@{AddLocal}!net.h@{net.h}}
\doxysubsubsection{AddLocal()\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \label{net_8h_abda4e8f87772f9a9d9d8f52a93791ffc} 
bool Add\+Local (\begin{DoxyParamCaption}\item[{const \textbf{ CNet\+Addr} \&}]{addr}{, }\item[{int}]{n\+Score}{ = {\ttfamily \textbf{ LOCAL\+\_\+\+NONE}}}\end{DoxyParamCaption})}

\index{net.h@{net.h}!AddLocal@{AddLocal}}
\index{AddLocal@{AddLocal}!net.h@{net.h}}
\doxysubsubsection{AddLocal()\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \label{net_8h_a337d6af198a6b0d75f830e56da9b91e9} 
bool Add\+Local (\begin{DoxyParamCaption}\item[{const \textbf{ CService} \&}]{addr}{, }\item[{int}]{n\+Score}{ = {\ttfamily \textbf{ LOCAL\+\_\+\+NONE}}}\end{DoxyParamCaption})}

\index{net.h@{net.h}!ClearLocal@{ClearLocal}}
\index{ClearLocal@{ClearLocal}!net.h@{net.h}}
\doxysubsubsection{ClearLocal()}
{\footnotesize\ttfamily \label{net_8h_a47f478eddfe8533597b15bd24f879bd0} 
void Clear\+Local (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

\index{net.h@{net.h}!Discover@{Discover}}
\index{Discover@{Discover}!net.h@{net.h}}
\doxysubsubsection{Discover()}
{\footnotesize\ttfamily \label{net_8h_af69db74c5fca7ac2e39ab3c412de3dd4} 
void Discover (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

Look up IP addresses from all interfaces on the machine and add them to the list of local addresses to self-\/advertise. The loopback interface is skipped. \index{net.h@{net.h}!GetListenPort@{GetListenPort}}
\index{GetListenPort@{GetListenPort}!net.h@{net.h}}
\doxysubsubsection{GetListenPort()}
{\footnotesize\ttfamily \label{net_8h_a0b987d6723d8ce3ee02e68a29f4c9905} 
uint16\+\_\+t Get\+Listen\+Port (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

\index{net.h@{net.h}!GetLocalAddress@{GetLocalAddress}}
\index{GetLocalAddress@{GetLocalAddress}!net.h@{net.h}}
\doxysubsubsection{GetLocalAddress()}
{\footnotesize\ttfamily \label{net_8h_ab4069dda423216abc1d08df70769d5a6} 
\textbf{ CService} Get\+Local\+Address (\begin{DoxyParamCaption}\item[{const \textbf{ CNode} \&}]{peer}{}\end{DoxyParamCaption})}

\index{net.h@{net.h}!GetLocalAddrForPeer@{GetLocalAddrForPeer}}
\index{GetLocalAddrForPeer@{GetLocalAddrForPeer}!net.h@{net.h}}
\doxysubsubsection{GetLocalAddrForPeer()}
{\footnotesize\ttfamily \label{net_8h_a72e179fd909099452d43c48470ed4eaa} 
std\+::optional$<$ \textbf{ CService} $>$ Get\+Local\+Addr\+For\+Peer (\begin{DoxyParamCaption}\item[{\textbf{ CNode} \&}]{node}{}\end{DoxyParamCaption})}

Returns a local address that we should advertise to this peer. \index{net.h@{net.h}!GUARDED\_BY@{GUARDED\_BY}}
\index{GUARDED\_BY@{GUARDED\_BY}!net.h@{net.h}}
\doxysubsubsection{GUARDED\_BY()}
{\footnotesize\ttfamily \label{net_8h_ab83e5bc27017a7a4693ab967bab2029a} 
std\+::map$<$ \textbf{ CNet\+Addr}, \textbf{ Local\+Service\+Info} $>$ map\+Local\+Host GUARDED\+\_\+\+BY (\begin{DoxyParamCaption}\item[{\textbf{ g\+\_\+maplocalhost\+\_\+mutex}}]{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [extern]}}

\index{net.h@{net.h}!IsLocal@{IsLocal}}
\index{IsLocal@{IsLocal}!net.h@{net.h}}
\doxysubsubsection{IsLocal()}
{\footnotesize\ttfamily \label{net_8h_a16fa1bd4d34c4c29c90903fc3cdf7517} 
bool Is\+Local (\begin{DoxyParamCaption}\item[{const \textbf{ CService} \&}]{addr}{}\end{DoxyParamCaption})}

check whether a given address is potentially local \index{net.h@{net.h}!RemoveLocal@{RemoveLocal}}
\index{RemoveLocal@{RemoveLocal}!net.h@{net.h}}
\doxysubsubsection{RemoveLocal()}
{\footnotesize\ttfamily \label{net_8h_a298d283732067adcbd421b66327413f8} 
void Remove\+Local (\begin{DoxyParamCaption}\item[{const \textbf{ CService} \&}]{addr}{}\end{DoxyParamCaption})}

\index{net.h@{net.h}!SeenLocal@{SeenLocal}}
\index{SeenLocal@{SeenLocal}!net.h@{net.h}}
\doxysubsubsection{SeenLocal()}
{\footnotesize\ttfamily \label{net_8h_af7487aacfc9d708b3db40c255ec070a8} 
bool Seen\+Local (\begin{DoxyParamCaption}\item[{const \textbf{ CService} \&}]{addr}{}\end{DoxyParamCaption})}

vote for a local address 

\label{doc-var-members}
\doxysubsection{Variable Documentation}
\index{net.h@{net.h}!CaptureMessage@{CaptureMessage}}
\index{CaptureMessage@{CaptureMessage}!net.h@{net.h}}
\doxysubsubsection{CaptureMessage}
{\footnotesize\ttfamily \label{net_8h_ac834a0d98a1e73e434c6ab4e88c7de25} 
std\+::function$<$void(const \textbf{ CAddress}\& addr, const std\+::string\& msg\+\_\+type, std\+::span$<$const unsigned char$>$ data, bool is\+\_\+incoming)$>$ Capture\+Message\hspace{0.3cm}{\ttfamily [extern]}}

Defaults to {\ttfamily Capture\+Message\+To\+File()}, but can be overridden by unit tests. \index{net.h@{net.h}!fDiscover@{fDiscover}}
\index{fDiscover@{fDiscover}!net.h@{net.h}}
\doxysubsubsection{fDiscover}
{\footnotesize\ttfamily \label{net_8h_a37089835ec27ad8bf945a458708165b9} 
bool f\+Discover\hspace{0.3cm}{\ttfamily [extern]}}

\index{net.h@{net.h}!fListen@{fListen}}
\index{fListen@{fListen}!net.h@{net.h}}
\doxysubsubsection{fListen}
{\footnotesize\ttfamily \label{net_8h_a5067f8b9215406011fa3461be92d819c} 
bool f\+Listen\hspace{0.3cm}{\ttfamily [extern]}}

\index{net.h@{net.h}!g\_maplocalhost\_mutex@{g\_maplocalhost\_mutex}}
\index{g\_maplocalhost\_mutex@{g\_maplocalhost\_mutex}!net.h@{net.h}}
\doxysubsubsection{g\_maplocalhost\_mutex}
{\footnotesize\ttfamily \label{net_8h_ab4289e3ed988501ac1f9e965dca566b1} 
\textbf{ Global\+Mutex} g\+\_\+maplocalhost\+\_\+mutex\hspace{0.3cm}{\ttfamily [extern]}}

\index{net.h@{net.h}!NET\_MESSAGE\_TYPE\_OTHER@{NET\_MESSAGE\_TYPE\_OTHER}}
\index{NET\_MESSAGE\_TYPE\_OTHER@{NET\_MESSAGE\_TYPE\_OTHER}!net.h@{net.h}}
\doxysubsubsection{NET\_MESSAGE\_TYPE\_OTHER}
{\footnotesize\ttfamily \label{net_8h_a7ba8efed412aaa6e338b09cd2deb0796} 
const std\+::string NET\+\_\+\+MESSAGE\+\_\+\+TYPE\+\_\+\+OTHER\hspace{0.3cm}{\ttfamily [extern]}}

\index{net.h@{net.h}!strSubVersion@{strSubVersion}}
\index{strSubVersion@{strSubVersion}!net.h@{net.h}}
\doxysubsubsection{strSubVersion}
{\footnotesize\ttfamily \label{net_8h_a6c58f8ccc4c93105a44caf588562d609} 
std\+::string str\+Sub\+Version\hspace{0.3cm}{\ttfamily [extern]}}

Subversion as sent to the P2P network in {\ttfamily version} messages 