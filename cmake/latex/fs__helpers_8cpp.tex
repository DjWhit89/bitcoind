\doxysection{src/util/fs\+\_\+helpers.cpp File Reference}
\label{fs__helpers_8cpp}\index{src/util/fs\_helpers.cpp@{src/util/fs\_helpers.cpp}}
{\ttfamily \#include $<$util/fs\+\_\+helpers.\+h$>$}\newline
{\ttfamily \#include $<$bitcoin-\/build-\/config.\+h$>$}\newline
{\ttfamily \#include $<$logging.\+h$>$}\newline
{\ttfamily \#include $<$sync.\+h$>$}\newline
{\ttfamily \#include $<$util/fs.\+h$>$}\newline
{\ttfamily \#include $<$util/syserror.\+h$>$}\newline
{\ttfamily \#include $<$cerrno$>$}\newline
{\ttfamily \#include $<$fstream$>$}\newline
{\ttfamily \#include $<$map$>$}\newline
{\ttfamily \#include $<$memory$>$}\newline
{\ttfamily \#include $<$optional$>$}\newline
{\ttfamily \#include $<$string$>$}\newline
{\ttfamily \#include $<$system\+\_\+error$>$}\newline
{\ttfamily \#include $<$utility$>$}\newline
{\ttfamily \#include $<$fcntl.\+h$>$}\newline
{\ttfamily \#include $<$sys/resource.\+h$>$}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
\doxysubsubsection*{Namespaces}
\begin{DoxyCompactItemize}
\item 
namespace \textbf{ util}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\textbf{ Lock\+Result} \textbf{ Lock\+Directory} (const \textbf{ fs\+::path} \&directory, const \textbf{ fs\+::path} \&lockfile\+\_\+name, bool probe\+\_\+only)
\item 
void \textbf{ Unlock\+Directory} (const \textbf{ fs\+::path} \&directory, const \textbf{ fs\+::path} \&lockfile\+\_\+name)
\item 
void \textbf{ Release\+Directory\+Locks} ()
\item 
bool \textbf{ Check\+Disk\+Space} (const \textbf{ fs\+::path} \&dir, uint64\+\_\+t additional\+\_\+bytes)
\item 
std\+::streampos \textbf{ Get\+File\+Size} (const char $\ast$path, std\+::streamsize max)
\item 
bool \textbf{ File\+Commit} (FILE $\ast$file)
\item 
void \textbf{ Directory\+Commit} (const \textbf{ fs\+::path} \&dirname)
\item 
bool \textbf{ Truncate\+File} (FILE $\ast$file, unsigned int length)
\item 
int \textbf{ Raise\+File\+Descriptor\+Limit} (int n\+Min\+FD)
\item 
void \textbf{ Allocate\+File\+Range} (FILE $\ast$file, unsigned int offset, unsigned int length)
\item 
bool \textbf{ Rename\+Over} (\textbf{ fs\+::path} src, \textbf{ fs\+::path} dest)
\item 
bool \textbf{ Try\+Create\+Directories} (const \textbf{ fs\+::path} \&p)
\item 
std\+::string \textbf{ Perms\+To\+Symbolic\+String} (fs\+::perms p)
\item 
std\+::optional$<$ fs\+::perms $>$ \textbf{ Interpret\+Perm\+String} (const std\+::string \&s)
\end{DoxyCompactItemize}


\label{doc-func-members}
\doxysubsection{Function Documentation}
\index{fs\_helpers.cpp@{fs\_helpers.cpp}!AllocateFileRange@{AllocateFileRange}}
\index{AllocateFileRange@{AllocateFileRange}!fs\_helpers.cpp@{fs\_helpers.cpp}}
\doxysubsubsection{AllocateFileRange()}
{\footnotesize\ttfamily \label{fs__helpers_8cpp_a91c763bffc49cf7ed8d45cc44870e55c} 
void Allocate\+File\+Range (\begin{DoxyParamCaption}\item[{FILE $\ast$}]{file}{, }\item[{unsigned int}]{offset}{, }\item[{unsigned int}]{length}{}\end{DoxyParamCaption})}

this function tries to make a particular range of a file allocated (corresponding to disk space) it is advisory, and the range specified in the arguments will never contain live data \index{fs\_helpers.cpp@{fs\_helpers.cpp}!CheckDiskSpace@{CheckDiskSpace}}
\index{CheckDiskSpace@{CheckDiskSpace}!fs\_helpers.cpp@{fs\_helpers.cpp}}
\doxysubsubsection{CheckDiskSpace()}
{\footnotesize\ttfamily \label{fs__helpers_8cpp_aafef764388e19a399584b65ef3d97b99} 
bool Check\+Disk\+Space (\begin{DoxyParamCaption}\item[{const \textbf{ fs\+::path} \&}]{dir}{, }\item[{uint64\+\_\+t}]{additional\+\_\+bytes}{}\end{DoxyParamCaption})}

\index{fs\_helpers.cpp@{fs\_helpers.cpp}!DirectoryCommit@{DirectoryCommit}}
\index{DirectoryCommit@{DirectoryCommit}!fs\_helpers.cpp@{fs\_helpers.cpp}}
\doxysubsubsection{DirectoryCommit()}
{\footnotesize\ttfamily \label{fs__helpers_8cpp_a7ec0a8f5e6d2d0f3f3358b3ee4fec5e0} 
void Directory\+Commit (\begin{DoxyParamCaption}\item[{const \textbf{ fs\+::path} \&}]{dirname}{}\end{DoxyParamCaption})}

Sync directory contents. This is required on some environments to ensure that newly created files are committed to disk. \index{fs\_helpers.cpp@{fs\_helpers.cpp}!FileCommit@{FileCommit}}
\index{FileCommit@{FileCommit}!fs\_helpers.cpp@{fs\_helpers.cpp}}
\doxysubsubsection{FileCommit()}
{\footnotesize\ttfamily \label{fs__helpers_8cpp_aedd7d9ab25c6cfb8c81a4aaa917b104e} 
bool File\+Commit (\begin{DoxyParamCaption}\item[{FILE $\ast$}]{file}{}\end{DoxyParamCaption})}

Ensure file contents are fully committed to disk, using a platform-\/specific feature analogous to fsync(). \index{fs\_helpers.cpp@{fs\_helpers.cpp}!GetFileSize@{GetFileSize}}
\index{GetFileSize@{GetFileSize}!fs\_helpers.cpp@{fs\_helpers.cpp}}
\doxysubsubsection{GetFileSize()}
{\footnotesize\ttfamily \label{fs__helpers_8cpp_a6396560e175adc5b89e6ebd7e335cf8a} 
std\+::streampos Get\+File\+Size (\begin{DoxyParamCaption}\item[{const char $\ast$}]{path}{, }\item[{std\+::streamsize}]{max}{ = {\ttfamily std\+:\+:numeric\+\_\+limits$<$~std\+:\+:streamsize~$>$\+:\+:max()}}\end{DoxyParamCaption})}

Get the size of a file by scanning it.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{in}}  & {\em path} & The file path \\
\hline
\mbox{\texttt{in}}  & {\em max} & Stop seeking beyond this limit \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The file size or max 
\end{DoxyReturn}
\index{fs\_helpers.cpp@{fs\_helpers.cpp}!InterpretPermString@{InterpretPermString}}
\index{InterpretPermString@{InterpretPermString}!fs\_helpers.cpp@{fs\_helpers.cpp}}
\doxysubsubsection{InterpretPermString()}
{\footnotesize\ttfamily \label{fs__helpers_8cpp_abc0b553e20da0fcce0c071a85a1ec1ea} 
std\+::optional$<$ fs\+::perms $>$ Interpret\+Perm\+String (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{s}{}\end{DoxyParamCaption})}

Interpret a custom permissions level string as fs\+::perms


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{in}}  & {\em s} & Permission level string \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Permissions as fs\+::perms 
\end{DoxyReturn}
\index{fs\_helpers.cpp@{fs\_helpers.cpp}!PermsToSymbolicString@{PermsToSymbolicString}}
\index{PermsToSymbolicString@{PermsToSymbolicString}!fs\_helpers.cpp@{fs\_helpers.cpp}}
\doxysubsubsection{PermsToSymbolicString()}
{\footnotesize\ttfamily \label{fs__helpers_8cpp_ae34526a9ca0bc46252b39f5f7bde63db} 
std\+::string Perms\+To\+Symbolic\+String (\begin{DoxyParamCaption}\item[{fs\+::perms}]{p}{}\end{DoxyParamCaption})}

Convert fs\+::perms to symbolic string of the form \textquotesingle{}rwxrwxrwx\textquotesingle{}


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{in}}  & {\em p} & the perms to be converted \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Symbolic permissions string 
\end{DoxyReturn}
\index{fs\_helpers.cpp@{fs\_helpers.cpp}!RaiseFileDescriptorLimit@{RaiseFileDescriptorLimit}}
\index{RaiseFileDescriptorLimit@{RaiseFileDescriptorLimit}!fs\_helpers.cpp@{fs\_helpers.cpp}}
\doxysubsubsection{RaiseFileDescriptorLimit()}
{\footnotesize\ttfamily \label{fs__helpers_8cpp_a756a5c49a4bb607d16d9842f8f3ede4f} 
int Raise\+File\+Descriptor\+Limit (\begin{DoxyParamCaption}\item[{int}]{n\+Min\+FD}{}\end{DoxyParamCaption})}

this function tries to raise the file descriptor limit to the requested number. It returns the actual file descriptor limit (which may be more or less than n\+Min\+FD) \index{fs\_helpers.cpp@{fs\_helpers.cpp}!ReleaseDirectoryLocks@{ReleaseDirectoryLocks}}
\index{ReleaseDirectoryLocks@{ReleaseDirectoryLocks}!fs\_helpers.cpp@{fs\_helpers.cpp}}
\doxysubsubsection{ReleaseDirectoryLocks()}
{\footnotesize\ttfamily \label{fs__helpers_8cpp_a851fa89def443bac9d04ddb908cb91bb} 
void Release\+Directory\+Locks (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

Release all directory locks. This is used for unit testing only, at runtime the global destructor will take care of the locks. \index{fs\_helpers.cpp@{fs\_helpers.cpp}!RenameOver@{RenameOver}}
\index{RenameOver@{RenameOver}!fs\_helpers.cpp@{fs\_helpers.cpp}}
\doxysubsubsection{RenameOver()}
{\footnotesize\ttfamily \label{fs__helpers_8cpp_a579657da2b55b131ecd453bf1b0d2314} 
bool Rename\+Over (\begin{DoxyParamCaption}\item[{\textbf{ fs\+::path}}]{src}{, }\item[{\textbf{ fs\+::path}}]{dest}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [nodiscard]}}

Rename src to dest. \begin{DoxyReturn}{Returns}
true if the rename was successful. 
\end{DoxyReturn}
\index{fs\_helpers.cpp@{fs\_helpers.cpp}!TruncateFile@{TruncateFile}}
\index{TruncateFile@{TruncateFile}!fs\_helpers.cpp@{fs\_helpers.cpp}}
\doxysubsubsection{TruncateFile()}
{\footnotesize\ttfamily \label{fs__helpers_8cpp_acb8d6b822bc1bfa609bf43bbac1a0d44} 
bool Truncate\+File (\begin{DoxyParamCaption}\item[{FILE $\ast$}]{file}{, }\item[{unsigned int}]{length}{}\end{DoxyParamCaption})}

\index{fs\_helpers.cpp@{fs\_helpers.cpp}!TryCreateDirectories@{TryCreateDirectories}}
\index{TryCreateDirectories@{TryCreateDirectories}!fs\_helpers.cpp@{fs\_helpers.cpp}}
\doxysubsubsection{TryCreateDirectories()}
{\footnotesize\ttfamily \label{fs__helpers_8cpp_a9042a919d837da9d97311a0c460c597c} 
bool Try\+Create\+Directories (\begin{DoxyParamCaption}\item[{const \textbf{ fs\+::path} \&}]{p}{}\end{DoxyParamCaption})}

Ignores exceptions thrown by create\+\_\+directories if the requested directory exists. Specifically handles case where path p exists, but it wasn\textquotesingle{}t possible for the user to write to the parent directory. \index{fs\_helpers.cpp@{fs\_helpers.cpp}!UnlockDirectory@{UnlockDirectory}}
\index{UnlockDirectory@{UnlockDirectory}!fs\_helpers.cpp@{fs\_helpers.cpp}}
\doxysubsubsection{UnlockDirectory()}
{\footnotesize\ttfamily \label{fs__helpers_8cpp_af40252a0b20b111179778c92b60f2f13} 
void Unlock\+Directory (\begin{DoxyParamCaption}\item[{const \textbf{ fs\+::path} \&}]{directory}{, }\item[{const \textbf{ fs\+::path} \&}]{lockfile\+\_\+name}{}\end{DoxyParamCaption})}

