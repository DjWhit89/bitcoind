\doxysection{group\+\_\+impl.\+h}
\label{group__impl_8h_source}\index{src/secp256k1/src/group\_impl.h@{src/secp256k1/src/group\_impl.h}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/***********************************************************************}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *\ Copyright\ (c)\ 2013,\ 2014\ Pieter\ Wuille\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *\ Distributed\ under\ the\ MIT\ software\ license,\ see\ the\ accompanying\ \ \ \ *}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *\ file\ COPYING\ or\ https://www.opensource.org/licenses/mit-\/license.php.*}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ ***********************************************************************/}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#ifndef\ SECP256K1\_GROUP\_IMPL\_H}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#define\ SECP256K1\_GROUP\_IMPL\_H}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <string.h>}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}field.h"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}group.h"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}util.h"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{comment}{/*\ Begin\ of\ section\ generated\ by\ sage/gen\_exhaustive\_groups.sage.\ */}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#define\ SECP256K1\_G\_ORDER\_7\ SECP256K1\_GE\_CONST(\(\backslash\)}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\ \ \ \ 0x66625d13,\ 0x317ffe44,\ 0x63d32cff,\ 0x1ca02b9b,\(\backslash\)}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\ \ \ \ 0xe5c6d070,\ 0x50b4b05e,\ 0x81cc30db,\ 0xf5166f0a,\(\backslash\)}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\ \ \ \ 0x1e60e897,\ 0xa7c00c7c,\ 0x2df53eb6,\ 0x98274ff4,\(\backslash\)}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\ \ \ \ 0x64252f42,\ 0x8ca44e17,\ 0x3b25418c,\ 0xff4ab0cf\(\backslash\)}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{)}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#define\ SECP256K1\_G\_ORDER\_13\ SECP256K1\_GE\_CONST(\(\backslash\)}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\ \ \ \ 0xa2482ff8,\ 0x4bf34edf,\ 0xa51262fd,\ 0xe57921db,\(\backslash\)}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\ \ \ \ 0xe0dd2cb7,\ 0xa5914790,\ 0xbc71631f,\ 0xc09704fb,\(\backslash\)}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\ \ \ \ 0x942536cb,\ 0xa3e49492,\ 0x3a701cc3,\ 0xee3e443f,\(\backslash\)}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\ \ \ \ 0xdf182aa9,\ 0x15b8aa6a,\ 0x166d3b19,\ 0xba84b045\(\backslash\)}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{)}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#define\ SECP256K1\_G\_ORDER\_199\ SECP256K1\_GE\_CONST(\(\backslash\)}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\ \ \ \ 0x7fb07b5c,\ 0xd07c3bda,\ 0x553902e2,\ 0x7a87ea2c,\(\backslash\)}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\ \ \ \ 0x35108a7f,\ 0x051f41e5,\ 0xb76abad5,\ 0x1f2703ad,\(\backslash\)}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\ \ \ \ 0x0a251539,\ 0x5b4c4438,\ 0x952a634f,\ 0xac10dd4d,\(\backslash\)}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\ \ \ \ 0x6d6f4745,\ 0x98990c27,\ 0x3a4f3116,\ 0xd32ff969\(\backslash\)}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{)}\textcolor{preprocessor}{}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#define\ SECP256K1\_G\ SECP256K1\_GE\_CONST(\(\backslash\)}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\ \ \ \ 0x79be667e,\ 0xf9dcbbac,\ 0x55a06295,\ 0xce870b07,\(\backslash\)}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\ \ \ \ 0x029bfcdb,\ 0x2dce28d9,\ 0x59f2815b,\ 0x16f81798,\(\backslash\)}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\ \ \ \ 0x483ada77,\ 0x26a3c465,\ 0x5da4fbfc,\ 0x0e1108a8,\(\backslash\)}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\ \ \ \ 0xfd17b448,\ 0xa6855419,\ 0x9c47d08f,\ 0xfb10d4b8\(\backslash\)}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{)}}
\DoxyCodeLine{00044\ \textcolor{comment}{/*\ These\ exhaustive\ group\ test\ orders\ and\ generators\ are\ chosen\ such\ that:}}
\DoxyCodeLine{00045\ \textcolor{comment}{\ *\ -\/\ The\ field\ size\ is\ equal\ to\ that\ of\ secp256k1,\ so\ field\ code\ is\ the\ same.}}
\DoxyCodeLine{00046\ \textcolor{comment}{\ *\ -\/\ The\ curve\ equation\ is\ of\ the\ form\ y\string^2=x\string^3+B\ for\ some\ small\ constant\ B.}}
\DoxyCodeLine{00047\ \textcolor{comment}{\ *\ -\/\ The\ subgroup\ has\ a\ generator\ 2*P,\ where\ P.x\ is\ as\ small\ as\ possible.}}
\DoxyCodeLine{00048\ \textcolor{comment}{\ *\ -\/\ The\ subgroup\ has\ size\ less\ than\ 1000\ to\ permit\ exhaustive\ testing.}}
\DoxyCodeLine{00049\ \textcolor{comment}{\ *\ -\/\ The\ subgroup\ admits\ an\ endomorphism\ of\ the\ form\ lambda*(x,y)\ ==\ (beta*x,y).}}
\DoxyCodeLine{00050\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00051\ \textcolor{preprocessor}{\#if\ defined(EXHAUSTIVE\_TEST\_ORDER)}}
\DoxyCodeLine{00052\ \textcolor{preprocessor}{\#\ \ if\ EXHAUSTIVE\_TEST\_ORDER\ ==\ 7}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ secp256k1\_ge\ secp256k1\_ge\_const\_g\ =\ SECP256K1\_G\_ORDER\_7;}
\DoxyCodeLine{00055\ \textcolor{preprocessor}{\#define\ SECP256K1\_B\ 6}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \textcolor{preprocessor}{\#\ \ elif\ EXHAUSTIVE\_TEST\_ORDER\ ==\ 13}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ secp256k1\_ge\ secp256k1\_ge\_const\_g\ =\ SECP256K1\_G\_ORDER\_13;}
\DoxyCodeLine{00060\ \textcolor{preprocessor}{\#define\ SECP256K1\_B\ 2}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \textcolor{preprocessor}{\#\ \ elif\ EXHAUSTIVE\_TEST\_ORDER\ ==\ 199}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ secp256k1\_ge\ secp256k1\_ge\_const\_g\ =\ SECP256K1\_G\_ORDER\_199;}
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#define\ SECP256K1\_B\ 4}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \textcolor{preprocessor}{\#\ \ else}}
\DoxyCodeLine{00068\ \textcolor{preprocessor}{\#\ \ \ \ error\ No\ known\ generator\ for\ the\ specified\ exhaustive\ test\ group\ order.}}
\DoxyCodeLine{00069\ \textcolor{preprocessor}{\#\ \ endif}}
\DoxyCodeLine{00070\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ secp256k1\_ge\ secp256k1\_ge\_const\_g\ =\ SECP256K1\_G;}
\DoxyCodeLine{00073\ \textcolor{preprocessor}{\#define\ SECP256K1\_B\ 7}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00076\ \textcolor{comment}{/*\ End\ of\ section\ generated\ by\ sage/gen\_exhaustive\_groups.sage.\ */}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_verify(\textcolor{keyword}{const}\ secp256k1\_ge\ *a)\ \{}
\DoxyCodeLine{00079\ \ \ \ \ SECP256K1\_FE\_VERIFY(\&a-\/>x);}
\DoxyCodeLine{00080\ \ \ \ \ SECP256K1\_FE\_VERIFY(\&a-\/>y);}
\DoxyCodeLine{00081\ \ \ \ \ SECP256K1\_FE\_VERIFY\_MAGNITUDE(\&a-\/>x,\ SECP256K1\_GE\_X\_MAGNITUDE\_MAX);}
\DoxyCodeLine{00082\ \ \ \ \ SECP256K1\_FE\_VERIFY\_MAGNITUDE(\&a-\/>y,\ SECP256K1\_GE\_Y\_MAGNITUDE\_MAX);}
\DoxyCodeLine{00083\ \ \ \ \ VERIFY\_CHECK(a-\/>infinity\ ==\ 0\ ||\ a-\/>infinity\ ==\ 1);}
\DoxyCodeLine{00084\ \ \ \ \ (void)a;}
\DoxyCodeLine{00085\ \}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_gej\_verify(\textcolor{keyword}{const}\ secp256k1\_gej\ *a)\ \{}
\DoxyCodeLine{00088\ \ \ \ \ SECP256K1\_FE\_VERIFY(\&a-\/>x);}
\DoxyCodeLine{00089\ \ \ \ \ SECP256K1\_FE\_VERIFY(\&a-\/>y);}
\DoxyCodeLine{00090\ \ \ \ \ SECP256K1\_FE\_VERIFY(\&a-\/>z);}
\DoxyCodeLine{00091\ \ \ \ \ SECP256K1\_FE\_VERIFY\_MAGNITUDE(\&a-\/>x,\ SECP256K1\_GEJ\_X\_MAGNITUDE\_MAX);}
\DoxyCodeLine{00092\ \ \ \ \ SECP256K1\_FE\_VERIFY\_MAGNITUDE(\&a-\/>y,\ SECP256K1\_GEJ\_Y\_MAGNITUDE\_MAX);}
\DoxyCodeLine{00093\ \ \ \ \ SECP256K1\_FE\_VERIFY\_MAGNITUDE(\&a-\/>z,\ SECP256K1\_GEJ\_Z\_MAGNITUDE\_MAX);}
\DoxyCodeLine{00094\ \ \ \ \ VERIFY\_CHECK(a-\/>infinity\ ==\ 0\ ||\ a-\/>infinity\ ==\ 1);}
\DoxyCodeLine{00095\ \ \ \ \ (void)a;}
\DoxyCodeLine{00096\ \}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \textcolor{comment}{/*\ Set\ r\ to\ the\ affine\ coordinates\ of\ Jacobian\ point\ (a.x,\ a.y,\ 1/zi).\ */}}
\DoxyCodeLine{00099\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_set\_gej\_zinv(secp256k1\_ge\ *r,\ \textcolor{keyword}{const}\ secp256k1\_gej\ *a,\ \textcolor{keyword}{const}\ secp256k1\_fe\ *zi)\ \{}
\DoxyCodeLine{00100\ \ \ \ \ secp256k1\_fe\ zi2;}
\DoxyCodeLine{00101\ \ \ \ \ secp256k1\_fe\ zi3;}
\DoxyCodeLine{00102\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(a);}
\DoxyCodeLine{00103\ \ \ \ \ SECP256K1\_FE\_VERIFY(zi);}
\DoxyCodeLine{00104\ \ \ \ \ VERIFY\_CHECK(!a-\/>infinity);}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ secp256k1\_fe\_sqr(\&zi2,\ zi);}
\DoxyCodeLine{00107\ \ \ \ \ secp256k1\_fe\_mul(\&zi3,\ \&zi2,\ zi);}
\DoxyCodeLine{00108\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>x,\ \&a-\/>x,\ \&zi2);}
\DoxyCodeLine{00109\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>y,\ \&a-\/>y,\ \&zi3);}
\DoxyCodeLine{00110\ \ \ \ \ r-\/>infinity\ =\ a-\/>infinity;}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \ \ SECP256K1\_GE\_VERIFY(r);}
\DoxyCodeLine{00113\ \}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \textcolor{comment}{/*\ Set\ r\ to\ the\ affine\ coordinates\ of\ Jacobian\ point\ (a.x,\ a.y,\ 1/zi).\ */}}
\DoxyCodeLine{00116\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_set\_ge\_zinv(secp256k1\_ge\ *r,\ \textcolor{keyword}{const}\ secp256k1\_ge\ *a,\ \textcolor{keyword}{const}\ secp256k1\_fe\ *zi)\ \{}
\DoxyCodeLine{00117\ \ \ \ \ secp256k1\_fe\ zi2;}
\DoxyCodeLine{00118\ \ \ \ \ secp256k1\_fe\ zi3;}
\DoxyCodeLine{00119\ \ \ \ \ SECP256K1\_GE\_VERIFY(a);}
\DoxyCodeLine{00120\ \ \ \ \ SECP256K1\_FE\_VERIFY(zi);}
\DoxyCodeLine{00121\ \ \ \ \ VERIFY\_CHECK(!a-\/>infinity);}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \ \ secp256k1\_fe\_sqr(\&zi2,\ zi);}
\DoxyCodeLine{00124\ \ \ \ \ secp256k1\_fe\_mul(\&zi3,\ \&zi2,\ zi);}
\DoxyCodeLine{00125\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>x,\ \&a-\/>x,\ \&zi2);}
\DoxyCodeLine{00126\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>y,\ \&a-\/>y,\ \&zi3);}
\DoxyCodeLine{00127\ \ \ \ \ r-\/>infinity\ =\ a-\/>infinity;}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ SECP256K1\_GE\_VERIFY(r);}
\DoxyCodeLine{00130\ \}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_set\_xy(secp256k1\_ge\ *r,\ \textcolor{keyword}{const}\ secp256k1\_fe\ *x,\ \textcolor{keyword}{const}\ secp256k1\_fe\ *y)\ \{}
\DoxyCodeLine{00133\ \ \ \ \ SECP256K1\_FE\_VERIFY(x);}
\DoxyCodeLine{00134\ \ \ \ \ SECP256K1\_FE\_VERIFY(y);}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \ \ r-\/>infinity\ =\ 0;}
\DoxyCodeLine{00137\ \ \ \ \ r-\/>x\ =\ *x;}
\DoxyCodeLine{00138\ \ \ \ \ r-\/>y\ =\ *y;}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ SECP256K1\_GE\_VERIFY(r);}
\DoxyCodeLine{00141\ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ secp256k1\_ge\_is\_infinity(\textcolor{keyword}{const}\ secp256k1\_ge\ *a)\ \{}
\DoxyCodeLine{00144\ \ \ \ \ SECP256K1\_GE\_VERIFY(a);}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordflow}{return}\ a-\/>infinity;}
\DoxyCodeLine{00147\ \}}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_neg(secp256k1\_ge\ *r,\ \textcolor{keyword}{const}\ secp256k1\_ge\ *a)\ \{}
\DoxyCodeLine{00150\ \ \ \ \ SECP256K1\_GE\_VERIFY(a);}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ \ \ *r\ =\ *a;}
\DoxyCodeLine{00153\ \ \ \ \ secp256k1\_fe\_normalize\_weak(\&r-\/>y);}
\DoxyCodeLine{00154\ \ \ \ \ secp256k1\_fe\_negate(\&r-\/>y,\ \&r-\/>y,\ 1);}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ SECP256K1\_GE\_VERIFY(r);}
\DoxyCodeLine{00157\ \}}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_set\_gej(secp256k1\_ge\ *r,\ secp256k1\_gej\ *a)\ \{}
\DoxyCodeLine{00160\ \ \ \ \ secp256k1\_fe\ z2,\ z3;}
\DoxyCodeLine{00161\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(a);}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ r-\/>infinity\ =\ a-\/>infinity;}
\DoxyCodeLine{00164\ \ \ \ \ secp256k1\_fe\_inv(\&a-\/>z,\ \&a-\/>z);}
\DoxyCodeLine{00165\ \ \ \ \ secp256k1\_fe\_sqr(\&z2,\ \&a-\/>z);}
\DoxyCodeLine{00166\ \ \ \ \ secp256k1\_fe\_mul(\&z3,\ \&a-\/>z,\ \&z2);}
\DoxyCodeLine{00167\ \ \ \ \ secp256k1\_fe\_mul(\&a-\/>x,\ \&a-\/>x,\ \&z2);}
\DoxyCodeLine{00168\ \ \ \ \ secp256k1\_fe\_mul(\&a-\/>y,\ \&a-\/>y,\ \&z3);}
\DoxyCodeLine{00169\ \ \ \ \ secp256k1\_fe\_set\_int(\&a-\/>z,\ 1);}
\DoxyCodeLine{00170\ \ \ \ \ r-\/>x\ =\ a-\/>x;}
\DoxyCodeLine{00171\ \ \ \ \ r-\/>y\ =\ a-\/>y;}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(a);}
\DoxyCodeLine{00174\ \ \ \ \ SECP256K1\_GE\_VERIFY(r);}
\DoxyCodeLine{00175\ \}}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_set\_gej\_var(secp256k1\_ge\ *r,\ secp256k1\_gej\ *a)\ \{}
\DoxyCodeLine{00178\ \ \ \ \ secp256k1\_fe\ z2,\ z3;}
\DoxyCodeLine{00179\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(a);}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{keywordflow}{if}\ (secp256k1\_gej\_is\_infinity(a))\ \{}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ secp256k1\_ge\_set\_infinity(r);}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00184\ \ \ \ \ \}}
\DoxyCodeLine{00185\ \ \ \ \ r-\/>infinity\ =\ 0;}
\DoxyCodeLine{00186\ \ \ \ \ secp256k1\_fe\_inv\_var(\&a-\/>z,\ \&a-\/>z);}
\DoxyCodeLine{00187\ \ \ \ \ secp256k1\_fe\_sqr(\&z2,\ \&a-\/>z);}
\DoxyCodeLine{00188\ \ \ \ \ secp256k1\_fe\_mul(\&z3,\ \&a-\/>z,\ \&z2);}
\DoxyCodeLine{00189\ \ \ \ \ secp256k1\_fe\_mul(\&a-\/>x,\ \&a-\/>x,\ \&z2);}
\DoxyCodeLine{00190\ \ \ \ \ secp256k1\_fe\_mul(\&a-\/>y,\ \&a-\/>y,\ \&z3);}
\DoxyCodeLine{00191\ \ \ \ \ secp256k1\_fe\_set\_int(\&a-\/>z,\ 1);}
\DoxyCodeLine{00192\ \ \ \ \ secp256k1\_ge\_set\_xy(r,\ \&a-\/>x,\ \&a-\/>y);}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(a);}
\DoxyCodeLine{00195\ \ \ \ \ SECP256K1\_GE\_VERIFY(r);}
\DoxyCodeLine{00196\ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_set\_all\_gej(secp256k1\_ge\ *r,\ \textcolor{keyword}{const}\ secp256k1\_gej\ *a,\ \textcolor{keywordtype}{size\_t}\ len)\ \{}
\DoxyCodeLine{00199\ \ \ \ \ secp256k1\_fe\ u;}
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ i;}
\DoxyCodeLine{00201\ \textcolor{preprocessor}{\#ifdef\ VERIFY}}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ len;\ i++)\ \{}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ SECP256K1\_GEJ\_VERIFY(\&a[i]);}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ VERIFY\_CHECK(!secp256k1\_gej\_is\_infinity(\&a[i]));}
\DoxyCodeLine{00205\ \ \ \ \ \}}
\DoxyCodeLine{00206\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{keywordflow}{if}\ (len\ ==\ 0)\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00210\ \ \ \ \ \}}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{comment}{/*\ Use\ destination's\ x\ coordinates\ as\ scratch\ space\ */}}
\DoxyCodeLine{00213\ \ \ \ \ r[0].x\ =\ a[0].z;}
\DoxyCodeLine{00214\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 1;\ i\ <\ len;\ i++)\ \{}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ secp256k1\_fe\_mul(\&r[i].x,\ \&r[i\ -\/\ 1].x,\ \&a[i].z);}
\DoxyCodeLine{00216\ \ \ \ \ \}}
\DoxyCodeLine{00217\ \ \ \ \ secp256k1\_fe\_inv(\&u,\ \&r[len\ -\/\ 1].x);}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ len\ -\/\ 1;\ i\ >\ 0;\ i-\/-\/)\ \{}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ secp256k1\_fe\_mul(\&r[i].x,\ \&r[i\ -\/\ 1].x,\ \&u);}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ secp256k1\_fe\_mul(\&u,\ \&u,\ \&a[i].z);}
\DoxyCodeLine{00222\ \ \ \ \ \}}
\DoxyCodeLine{00223\ \ \ \ \ r[0].x\ =\ u;}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ len;\ i++)\ \{}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ secp256k1\_ge\_set\_gej\_zinv(\&r[i],\ \&a[i],\ \&r[i].x);}
\DoxyCodeLine{00227\ \ \ \ \ \}}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00229\ \textcolor{preprocessor}{\#ifdef\ VERIFY}}
\DoxyCodeLine{00230\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ len;\ i++)\ \{}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ SECP256K1\_GE\_VERIFY(\&r[i]);}
\DoxyCodeLine{00232\ \ \ \ \ \}}
\DoxyCodeLine{00233\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00234\ \}}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_set\_all\_gej\_var(secp256k1\_ge\ *r,\ \textcolor{keyword}{const}\ secp256k1\_gej\ *a,\ \textcolor{keywordtype}{size\_t}\ len)\ \{}
\DoxyCodeLine{00237\ \ \ \ \ secp256k1\_fe\ u;}
\DoxyCodeLine{00238\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ i;}
\DoxyCodeLine{00239\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ last\_i\ =\ SIZE\_MAX;}
\DoxyCodeLine{00240\ \textcolor{preprocessor}{\#ifdef\ VERIFY}}
\DoxyCodeLine{00241\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ len;\ i++)\ \{}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ SECP256K1\_GEJ\_VERIFY(\&a[i]);}
\DoxyCodeLine{00243\ \ \ \ \ \}}
\DoxyCodeLine{00244\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ len;\ i++)\ \{}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (a[i].infinity)\ \{}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_ge\_set\_infinity(\&r[i]);}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Use\ destination's\ x\ coordinates\ as\ scratch\ space\ */}}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (last\_i\ ==\ SIZE\_MAX)\ \{}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ r[i].x\ =\ a[i].z;}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_fe\_mul(\&r[i].x,\ \&r[last\_i].x,\ \&a[i].z);}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ last\_i\ =\ i;}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00258\ \ \ \ \ \}}
\DoxyCodeLine{00259\ \ \ \ \ \textcolor{keywordflow}{if}\ (last\_i\ ==\ SIZE\_MAX)\ \{}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00261\ \ \ \ \ \}}
\DoxyCodeLine{00262\ \ \ \ \ secp256k1\_fe\_inv\_var(\&u,\ \&r[last\_i].x);}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \ \ i\ =\ last\_i;}
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{keywordflow}{while}\ (i\ >\ 0)\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ i-\/-\/;}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!a[i].infinity)\ \{}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_fe\_mul(\&r[last\_i].x,\ \&r[i].x,\ \&u);}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_fe\_mul(\&u,\ \&u,\ \&a[last\_i].z);}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ last\_i\ =\ i;}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00272\ \ \ \ \ \}}
\DoxyCodeLine{00273\ \ \ \ \ VERIFY\_CHECK(!a[last\_i].infinity);}
\DoxyCodeLine{00274\ \ \ \ \ r[last\_i].x\ =\ u;}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ len;\ i++)\ \{}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!a[i].infinity)\ \{}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_ge\_set\_gej\_zinv(\&r[i],\ \&a[i],\ \&r[i].x);}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00280\ \ \ \ \ \}}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \textcolor{preprocessor}{\#ifdef\ VERIFY}}
\DoxyCodeLine{00283\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ len;\ i++)\ \{}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ SECP256K1\_GE\_VERIFY(\&r[i]);}
\DoxyCodeLine{00285\ \ \ \ \ \}}
\DoxyCodeLine{00286\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00287\ \}}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00289\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_table\_set\_globalz(\textcolor{keywordtype}{size\_t}\ len,\ secp256k1\_ge\ *a,\ \textcolor{keyword}{const}\ secp256k1\_fe\ *zr)\ \{}
\DoxyCodeLine{00290\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ i;}
\DoxyCodeLine{00291\ \ \ \ \ secp256k1\_fe\ zs;}
\DoxyCodeLine{00292\ \textcolor{preprocessor}{\#ifdef\ VERIFY}}
\DoxyCodeLine{00293\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ len;\ i++)\ \{}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ SECP256K1\_GE\_VERIFY(\&a[i]);}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ SECP256K1\_FE\_VERIFY(\&zr[i]);}
\DoxyCodeLine{00296\ \ \ \ \ \}}
\DoxyCodeLine{00297\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00299\ \ \ \ \ \textcolor{keywordflow}{if}\ (len\ >\ 0)\ \{}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ i\ =\ len\ -\/\ 1;}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Ensure\ all\ y\ values\ are\ in\ weak\ normal\ form\ for\ fast\ negation\ of\ points\ */}}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ secp256k1\_fe\_normalize\_weak(\&a[i].y);}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ zs\ =\ zr[i];}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Work\ our\ way\ backwards,\ using\ the\ z-\/ratios\ to\ scale\ the\ x/y\ values.\ */}}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (i\ >\ 0)\ \{}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ !=\ len\ -\/\ 1)\ \{}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_fe\_mul(\&zs,\ \&zs,\ \&zr[i]);}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \ \ \ \ i-\/-\/;}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_ge\_set\_ge\_zinv(\&a[i],\ \&a[i],\ \&zs);}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00313\ \ \ \ \ \}}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \textcolor{preprocessor}{\#ifdef\ VERIFY}}
\DoxyCodeLine{00316\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ len;\ i++)\ \{}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ SECP256K1\_GE\_VERIFY(\&a[i]);}
\DoxyCodeLine{00318\ \ \ \ \ \}}
\DoxyCodeLine{00319\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00320\ \}}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_gej\_set\_infinity(secp256k1\_gej\ *r)\ \{}
\DoxyCodeLine{00323\ \ \ \ \ r-\/>infinity\ =\ 1;}
\DoxyCodeLine{00324\ \ \ \ \ secp256k1\_fe\_set\_int(\&r-\/>x,\ 0);}
\DoxyCodeLine{00325\ \ \ \ \ secp256k1\_fe\_set\_int(\&r-\/>y,\ 0);}
\DoxyCodeLine{00326\ \ \ \ \ secp256k1\_fe\_set\_int(\&r-\/>z,\ 0);}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00328\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(r);}
\DoxyCodeLine{00329\ \}}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_set\_infinity(secp256k1\_ge\ *r)\ \{}
\DoxyCodeLine{00332\ \ \ \ \ r-\/>infinity\ =\ 1;}
\DoxyCodeLine{00333\ \ \ \ \ secp256k1\_fe\_set\_int(\&r-\/>x,\ 0);}
\DoxyCodeLine{00334\ \ \ \ \ secp256k1\_fe\_set\_int(\&r-\/>y,\ 0);}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \ \ \ \ SECP256K1\_GE\_VERIFY(r);}
\DoxyCodeLine{00337\ \}}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_gej\_clear(secp256k1\_gej\ *r)\ \{}
\DoxyCodeLine{00340\ \ \ \ \ secp256k1\_memclear\_explicit(r,\ \textcolor{keyword}{sizeof}(secp256k1\_gej));}
\DoxyCodeLine{00341\ \}}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_clear(secp256k1\_ge\ *r)\ \{}
\DoxyCodeLine{00344\ \ \ \ \ secp256k1\_memclear\_explicit(r,\ \textcolor{keyword}{sizeof}(secp256k1\_ge));}
\DoxyCodeLine{00345\ \}}
\DoxyCodeLine{00346\ }
\DoxyCodeLine{00347\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ secp256k1\_ge\_set\_xo\_var(secp256k1\_ge\ *r,\ \textcolor{keyword}{const}\ secp256k1\_fe\ *x,\ \textcolor{keywordtype}{int}\ odd)\ \{}
\DoxyCodeLine{00348\ \ \ \ \ secp256k1\_fe\ x2,\ x3;}
\DoxyCodeLine{00349\ \ \ \ \ \textcolor{keywordtype}{int}\ ret;}
\DoxyCodeLine{00350\ \ \ \ \ SECP256K1\_FE\_VERIFY(x);}
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00352\ \ \ \ \ r-\/>x\ =\ *x;}
\DoxyCodeLine{00353\ \ \ \ \ secp256k1\_fe\_sqr(\&x2,\ x);}
\DoxyCodeLine{00354\ \ \ \ \ secp256k1\_fe\_mul(\&x3,\ x,\ \&x2);}
\DoxyCodeLine{00355\ \ \ \ \ r-\/>infinity\ =\ 0;}
\DoxyCodeLine{00356\ \ \ \ \ secp256k1\_fe\_add\_int(\&x3,\ SECP256K1\_B);}
\DoxyCodeLine{00357\ \ \ \ \ ret\ =\ secp256k1\_fe\_sqrt(\&r-\/>y,\ \&x3);}
\DoxyCodeLine{00358\ \ \ \ \ secp256k1\_fe\_normalize\_var(\&r-\/>y);}
\DoxyCodeLine{00359\ \ \ \ \ \textcolor{keywordflow}{if}\ (secp256k1\_fe\_is\_odd(\&r-\/>y)\ !=\ odd)\ \{}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ secp256k1\_fe\_negate(\&r-\/>y,\ \&r-\/>y,\ 1);}
\DoxyCodeLine{00361\ \ \ \ \ \}}
\DoxyCodeLine{00362\ }
\DoxyCodeLine{00363\ \ \ \ \ SECP256K1\_GE\_VERIFY(r);}
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{00365\ \}}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00367\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_gej\_set\_ge(secp256k1\_gej\ *r,\ \textcolor{keyword}{const}\ secp256k1\_ge\ *a)\ \{}
\DoxyCodeLine{00368\ \ \ \ SECP256K1\_GE\_VERIFY(a);}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \ r-\/>infinity\ =\ a-\/>infinity;}
\DoxyCodeLine{00371\ \ \ \ r-\/>x\ =\ a-\/>x;}
\DoxyCodeLine{00372\ \ \ \ r-\/>y\ =\ a-\/>y;}
\DoxyCodeLine{00373\ \ \ \ secp256k1\_fe\_set\_int(\&r-\/>z,\ 1);}
\DoxyCodeLine{00374\ }
\DoxyCodeLine{00375\ \ \ \ SECP256K1\_GEJ\_VERIFY(r);}
\DoxyCodeLine{00376\ \}}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00378\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ secp256k1\_gej\_eq\_var(\textcolor{keyword}{const}\ secp256k1\_gej\ *a,\ \textcolor{keyword}{const}\ secp256k1\_gej\ *b)\ \{}
\DoxyCodeLine{00379\ \ \ \ \ secp256k1\_gej\ tmp;}
\DoxyCodeLine{00380\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(b);}
\DoxyCodeLine{00381\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(a);}
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00383\ \ \ \ \ secp256k1\_gej\_neg(\&tmp,\ a);}
\DoxyCodeLine{00384\ \ \ \ \ secp256k1\_gej\_add\_var(\&tmp,\ \&tmp,\ b,\ NULL);}
\DoxyCodeLine{00385\ \ \ \ \ \textcolor{keywordflow}{return}\ secp256k1\_gej\_is\_infinity(\&tmp);}
\DoxyCodeLine{00386\ \}}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ secp256k1\_gej\_eq\_ge\_var(\textcolor{keyword}{const}\ secp256k1\_gej\ *a,\ \textcolor{keyword}{const}\ secp256k1\_ge\ *b)\ \{}
\DoxyCodeLine{00389\ \ \ \ \ secp256k1\_gej\ tmp;}
\DoxyCodeLine{00390\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(a);}
\DoxyCodeLine{00391\ \ \ \ \ SECP256K1\_GE\_VERIFY(b);}
\DoxyCodeLine{00392\ }
\DoxyCodeLine{00393\ \ \ \ \ secp256k1\_gej\_neg(\&tmp,\ a);}
\DoxyCodeLine{00394\ \ \ \ \ secp256k1\_gej\_add\_ge\_var(\&tmp,\ \&tmp,\ b,\ NULL);}
\DoxyCodeLine{00395\ \ \ \ \ \textcolor{keywordflow}{return}\ secp256k1\_gej\_is\_infinity(\&tmp);}
\DoxyCodeLine{00396\ \}}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00398\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ secp256k1\_ge\_eq\_var(\textcolor{keyword}{const}\ secp256k1\_ge\ *a,\ \textcolor{keyword}{const}\ secp256k1\_ge\ *b)\ \{}
\DoxyCodeLine{00399\ \ \ \ \ secp256k1\_fe\ tmp;}
\DoxyCodeLine{00400\ \ \ \ \ SECP256K1\_GE\_VERIFY(a);}
\DoxyCodeLine{00401\ \ \ \ \ SECP256K1\_GE\_VERIFY(b);}
\DoxyCodeLine{00402\ }
\DoxyCodeLine{00403\ \ \ \ \ \textcolor{keywordflow}{if}\ (a-\/>infinity\ !=\ b-\/>infinity)\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00404\ \ \ \ \ \textcolor{keywordflow}{if}\ (a-\/>infinity)\ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \ \ \ \ tmp\ =\ a-\/>x;}
\DoxyCodeLine{00407\ \ \ \ \ secp256k1\_fe\_normalize\_weak(\&tmp);}
\DoxyCodeLine{00408\ \ \ \ \ \textcolor{keywordflow}{if}\ (!secp256k1\_fe\_equal(\&tmp,\ \&b-\/>x))\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00409\ }
\DoxyCodeLine{00410\ \ \ \ \ tmp\ =\ a-\/>y;}
\DoxyCodeLine{00411\ \ \ \ \ secp256k1\_fe\_normalize\_weak(\&tmp);}
\DoxyCodeLine{00412\ \ \ \ \ \textcolor{keywordflow}{if}\ (!secp256k1\_fe\_equal(\&tmp,\ \&b-\/>y))\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00415\ \}}
\DoxyCodeLine{00416\ }
\DoxyCodeLine{00417\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ secp256k1\_gej\_eq\_x\_var(\textcolor{keyword}{const}\ secp256k1\_fe\ *x,\ \textcolor{keyword}{const}\ secp256k1\_gej\ *a)\ \{}
\DoxyCodeLine{00418\ \ \ \ \ secp256k1\_fe\ r;}
\DoxyCodeLine{00419\ \ \ \ \ SECP256K1\_FE\_VERIFY(x);}
\DoxyCodeLine{00420\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(a);}
\DoxyCodeLine{00421\ \ \ \ \ VERIFY\_CHECK(!a-\/>infinity);}
\DoxyCodeLine{00422\ }
\DoxyCodeLine{00423\ \ \ \ \ secp256k1\_fe\_sqr(\&r,\ \&a-\/>z);\ secp256k1\_fe\_mul(\&r,\ \&r,\ x);}
\DoxyCodeLine{00424\ \ \ \ \ \textcolor{keywordflow}{return}\ secp256k1\_fe\_equal(\&r,\ \&a-\/>x);}
\DoxyCodeLine{00425\ \}}
\DoxyCodeLine{00426\ }
\DoxyCodeLine{00427\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_gej\_neg(secp256k1\_gej\ *r,\ \textcolor{keyword}{const}\ secp256k1\_gej\ *a)\ \{}
\DoxyCodeLine{00428\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(a);}
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \ \ \ \ r-\/>infinity\ =\ a-\/>infinity;}
\DoxyCodeLine{00431\ \ \ \ \ r-\/>x\ =\ a-\/>x;}
\DoxyCodeLine{00432\ \ \ \ \ r-\/>y\ =\ a-\/>y;}
\DoxyCodeLine{00433\ \ \ \ \ r-\/>z\ =\ a-\/>z;}
\DoxyCodeLine{00434\ \ \ \ \ secp256k1\_fe\_normalize\_weak(\&r-\/>y);}
\DoxyCodeLine{00435\ \ \ \ \ secp256k1\_fe\_negate(\&r-\/>y,\ \&r-\/>y,\ 1);}
\DoxyCodeLine{00436\ }
\DoxyCodeLine{00437\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(r);}
\DoxyCodeLine{00438\ \}}
\DoxyCodeLine{00439\ }
\DoxyCodeLine{00440\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ secp256k1\_gej\_is\_infinity(\textcolor{keyword}{const}\ secp256k1\_gej\ *a)\ \{}
\DoxyCodeLine{00441\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(a);}
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00443\ \ \ \ \ \textcolor{keywordflow}{return}\ a-\/>infinity;}
\DoxyCodeLine{00444\ \}}
\DoxyCodeLine{00445\ }
\DoxyCodeLine{00446\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ secp256k1\_ge\_is\_valid\_var(\textcolor{keyword}{const}\ secp256k1\_ge\ *a)\ \{}
\DoxyCodeLine{00447\ \ \ \ \ secp256k1\_fe\ y2,\ x3;}
\DoxyCodeLine{00448\ \ \ \ \ SECP256K1\_GE\_VERIFY(a);}
\DoxyCodeLine{00449\ }
\DoxyCodeLine{00450\ \ \ \ \ \textcolor{keywordflow}{if}\ (a-\/>infinity)\ \{}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00452\ \ \ \ \ \}}
\DoxyCodeLine{00453\ \ \ \ \ \textcolor{comment}{/*\ y\string^2\ =\ x\string^3\ +\ 7\ */}}
\DoxyCodeLine{00454\ \ \ \ \ secp256k1\_fe\_sqr(\&y2,\ \&a-\/>y);}
\DoxyCodeLine{00455\ \ \ \ \ secp256k1\_fe\_sqr(\&x3,\ \&a-\/>x);\ secp256k1\_fe\_mul(\&x3,\ \&x3,\ \&a-\/>x);}
\DoxyCodeLine{00456\ \ \ \ \ secp256k1\_fe\_add\_int(\&x3,\ SECP256K1\_B);}
\DoxyCodeLine{00457\ \ \ \ \ \textcolor{keywordflow}{return}\ secp256k1\_fe\_equal(\&y2,\ \&x3);}
\DoxyCodeLine{00458\ \}}
\DoxyCodeLine{00459\ }
\DoxyCodeLine{00460\ \textcolor{keyword}{static}\ SECP256K1\_INLINE\ \textcolor{keywordtype}{void}\ secp256k1\_gej\_double(secp256k1\_gej\ *r,\ \textcolor{keyword}{const}\ secp256k1\_gej\ *a)\ \{}
\DoxyCodeLine{00461\ \ \ \ \ \textcolor{comment}{/*\ Operations:\ 3\ mul,\ 4\ sqr,\ 8\ add/half/mul\_int/negate\ */}}
\DoxyCodeLine{00462\ \ \ \ \ secp256k1\_fe\ l,\ s,\ t;}
\DoxyCodeLine{00463\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(a);}
\DoxyCodeLine{00464\ }
\DoxyCodeLine{00465\ \ \ \ \ r-\/>infinity\ =\ a-\/>infinity;}
\DoxyCodeLine{00466\ }
\DoxyCodeLine{00467\ \ \ \ \ \textcolor{comment}{/*\ Formula\ used:}}
\DoxyCodeLine{00468\ \textcolor{comment}{\ \ \ \ \ *\ L\ =\ (3/2)\ *\ X1\string^2}}
\DoxyCodeLine{00469\ \textcolor{comment}{\ \ \ \ \ *\ S\ =\ Y1\string^2}}
\DoxyCodeLine{00470\ \textcolor{comment}{\ \ \ \ \ *\ T\ =\ -\/X1*S}}
\DoxyCodeLine{00471\ \textcolor{comment}{\ \ \ \ \ *\ X3\ =\ L\string^2\ +\ 2*T}}
\DoxyCodeLine{00472\ \textcolor{comment}{\ \ \ \ \ *\ Y3\ =\ -\/(L*(X3\ +\ T)\ +\ S\string^2)}}
\DoxyCodeLine{00473\ \textcolor{comment}{\ \ \ \ \ *\ Z3\ =\ Y1*Z1}}
\DoxyCodeLine{00474\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00475\ }
\DoxyCodeLine{00476\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>z,\ \&a-\/>z,\ \&a-\/>y);\ \textcolor{comment}{/*\ Z3\ =\ Y1*Z1\ (1)\ */}}
\DoxyCodeLine{00477\ \ \ \ \ secp256k1\_fe\_sqr(\&s,\ \&a-\/>y);\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ S\ =\ Y1\string^2\ (1)\ */}}
\DoxyCodeLine{00478\ \ \ \ \ secp256k1\_fe\_sqr(\&l,\ \&a-\/>x);\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ L\ =\ X1\string^2\ (1)\ */}}
\DoxyCodeLine{00479\ \ \ \ \ secp256k1\_fe\_mul\_int(\&l,\ 3);\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ L\ =\ 3*X1\string^2\ (3)\ */}}
\DoxyCodeLine{00480\ \ \ \ \ secp256k1\_fe\_half(\&l);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ L\ =\ 3/2*X1\string^2\ (2)\ */}}
\DoxyCodeLine{00481\ \ \ \ \ secp256k1\_fe\_negate(\&t,\ \&s,\ 1);\ \ \ \ \ \ \ \ \textcolor{comment}{/*\ T\ =\ -\/S\ (2)\ */}}
\DoxyCodeLine{00482\ \ \ \ \ secp256k1\_fe\_mul(\&t,\ \&t,\ \&a-\/>x);\ \ \ \ \ \ \ \textcolor{comment}{/*\ T\ =\ -\/X1*S\ (1)\ */}}
\DoxyCodeLine{00483\ \ \ \ \ secp256k1\_fe\_sqr(\&r-\/>x,\ \&l);\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ X3\ =\ L\string^2\ (1)\ */}}
\DoxyCodeLine{00484\ \ \ \ \ secp256k1\_fe\_add(\&r-\/>x,\ \&t);\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ X3\ =\ L\string^2\ +\ T\ (2)\ */}}
\DoxyCodeLine{00485\ \ \ \ \ secp256k1\_fe\_add(\&r-\/>x,\ \&t);\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ X3\ =\ L\string^2\ +\ 2*T\ (3)\ */}}
\DoxyCodeLine{00486\ \ \ \ \ secp256k1\_fe\_sqr(\&s,\ \&s);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ S'\ =\ S\string^2\ (1)\ */}}
\DoxyCodeLine{00487\ \ \ \ \ secp256k1\_fe\_add(\&t,\ \&r-\/>x);\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ T'\ =\ X3\ +\ T\ (4)\ */}}
\DoxyCodeLine{00488\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>y,\ \&t,\ \&l);\ \ \ \ \ \ \ \textcolor{comment}{/*\ Y3\ =\ L*(X3\ +\ T)\ (1)\ */}}
\DoxyCodeLine{00489\ \ \ \ \ secp256k1\_fe\_add(\&r-\/>y,\ \&s);\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Y3\ =\ L*(X3\ +\ T)\ +\ S\string^2\ (2)\ */}}
\DoxyCodeLine{00490\ \ \ \ \ secp256k1\_fe\_negate(\&r-\/>y,\ \&r-\/>y,\ 2);\ \ \textcolor{comment}{/*\ Y3\ =\ -\/(L*(X3\ +\ T)\ +\ S\string^2)\ (3)\ */}}
\DoxyCodeLine{00491\ }
\DoxyCodeLine{00492\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(r);}
\DoxyCodeLine{00493\ \}}
\DoxyCodeLine{00494\ }
\DoxyCodeLine{00495\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_gej\_double\_var(secp256k1\_gej\ *r,\ \textcolor{keyword}{const}\ secp256k1\_gej\ *a,\ secp256k1\_fe\ *rzr)\ \{}
\DoxyCodeLine{00496\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(a);}
\DoxyCodeLine{00497\ }
\DoxyCodeLine{00508\ \ \ \ \ \textcolor{keywordflow}{if}\ (a-\/>infinity)\ \{}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ secp256k1\_gej\_set\_infinity(r);}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rzr\ !=\ NULL)\ \{}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_fe\_set\_int(rzr,\ 1);}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00514\ \ \ \ \ \}}
\DoxyCodeLine{00515\ }
\DoxyCodeLine{00516\ \ \ \ \ \textcolor{keywordflow}{if}\ (rzr\ !=\ NULL)\ \{}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ *rzr\ =\ a-\/>y;}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ secp256k1\_fe\_normalize\_weak(rzr);}
\DoxyCodeLine{00519\ \ \ \ \ \}}
\DoxyCodeLine{00520\ }
\DoxyCodeLine{00521\ \ \ \ \ secp256k1\_gej\_double(r,\ a);}
\DoxyCodeLine{00522\ }
\DoxyCodeLine{00523\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(r);}
\DoxyCodeLine{00524\ \}}
\DoxyCodeLine{00525\ }
\DoxyCodeLine{00526\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_gej\_add\_var(secp256k1\_gej\ *r,\ \textcolor{keyword}{const}\ secp256k1\_gej\ *a,\ \textcolor{keyword}{const}\ secp256k1\_gej\ *b,\ secp256k1\_fe\ *rzr)\ \{}
\DoxyCodeLine{00527\ \ \ \ \ \textcolor{comment}{/*\ 12\ mul,\ 4\ sqr,\ 11\ add/negate/normalizes\_to\_zero\ (ignoring\ special\ cases)\ */}}
\DoxyCodeLine{00528\ \ \ \ \ secp256k1\_fe\ z22,\ z12,\ u1,\ u2,\ s1,\ s2,\ h,\ i,\ h2,\ h3,\ t;}
\DoxyCodeLine{00529\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(a);}
\DoxyCodeLine{00530\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(b);}
\DoxyCodeLine{00531\ }
\DoxyCodeLine{00532\ \ \ \ \ \textcolor{keywordflow}{if}\ (a-\/>infinity)\ \{}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ VERIFY\_CHECK(rzr\ ==\ NULL);}
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ *r\ =\ *b;}
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00536\ \ \ \ \ \}}
\DoxyCodeLine{00537\ \ \ \ \ \textcolor{keywordflow}{if}\ (b-\/>infinity)\ \{}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rzr\ !=\ NULL)\ \{}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_fe\_set\_int(rzr,\ 1);}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ *r\ =\ *a;}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00543\ \ \ \ \ \}}
\DoxyCodeLine{00544\ }
\DoxyCodeLine{00545\ \ \ \ \ secp256k1\_fe\_sqr(\&z22,\ \&b-\/>z);}
\DoxyCodeLine{00546\ \ \ \ \ secp256k1\_fe\_sqr(\&z12,\ \&a-\/>z);}
\DoxyCodeLine{00547\ \ \ \ \ secp256k1\_fe\_mul(\&u1,\ \&a-\/>x,\ \&z22);}
\DoxyCodeLine{00548\ \ \ \ \ secp256k1\_fe\_mul(\&u2,\ \&b-\/>x,\ \&z12);}
\DoxyCodeLine{00549\ \ \ \ \ secp256k1\_fe\_mul(\&s1,\ \&a-\/>y,\ \&z22);\ secp256k1\_fe\_mul(\&s1,\ \&s1,\ \&b-\/>z);}
\DoxyCodeLine{00550\ \ \ \ \ secp256k1\_fe\_mul(\&s2,\ \&b-\/>y,\ \&z12);\ secp256k1\_fe\_mul(\&s2,\ \&s2,\ \&a-\/>z);}
\DoxyCodeLine{00551\ \ \ \ \ secp256k1\_fe\_negate(\&h,\ \&u1,\ 1);\ secp256k1\_fe\_add(\&h,\ \&u2);}
\DoxyCodeLine{00552\ \ \ \ \ secp256k1\_fe\_negate(\&i,\ \&s2,\ 1);\ secp256k1\_fe\_add(\&i,\ \&s1);}
\DoxyCodeLine{00553\ \ \ \ \ \textcolor{keywordflow}{if}\ (secp256k1\_fe\_normalizes\_to\_zero\_var(\&h))\ \{}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (secp256k1\_fe\_normalizes\_to\_zero\_var(\&i))\ \{}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_gej\_double\_var(r,\ a,\ rzr);}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rzr\ !=\ NULL)\ \{}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_fe\_set\_int(rzr,\ 0);}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_gej\_set\_infinity(r);}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00563\ \ \ \ \ \}}
\DoxyCodeLine{00564\ }
\DoxyCodeLine{00565\ \ \ \ \ r-\/>infinity\ =\ 0;}
\DoxyCodeLine{00566\ \ \ \ \ secp256k1\_fe\_mul(\&t,\ \&h,\ \&b-\/>z);}
\DoxyCodeLine{00567\ \ \ \ \ \textcolor{keywordflow}{if}\ (rzr\ !=\ NULL)\ \{}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ *rzr\ =\ t;}
\DoxyCodeLine{00569\ \ \ \ \ \}}
\DoxyCodeLine{00570\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>z,\ \&a-\/>z,\ \&t);}
\DoxyCodeLine{00571\ }
\DoxyCodeLine{00572\ \ \ \ \ secp256k1\_fe\_sqr(\&h2,\ \&h);}
\DoxyCodeLine{00573\ \ \ \ \ secp256k1\_fe\_negate(\&h2,\ \&h2,\ 1);}
\DoxyCodeLine{00574\ \ \ \ \ secp256k1\_fe\_mul(\&h3,\ \&h2,\ \&h);}
\DoxyCodeLine{00575\ \ \ \ \ secp256k1\_fe\_mul(\&t,\ \&u1,\ \&h2);}
\DoxyCodeLine{00576\ }
\DoxyCodeLine{00577\ \ \ \ \ secp256k1\_fe\_sqr(\&r-\/>x,\ \&i);}
\DoxyCodeLine{00578\ \ \ \ \ secp256k1\_fe\_add(\&r-\/>x,\ \&h3);}
\DoxyCodeLine{00579\ \ \ \ \ secp256k1\_fe\_add(\&r-\/>x,\ \&t);}
\DoxyCodeLine{00580\ \ \ \ \ secp256k1\_fe\_add(\&r-\/>x,\ \&t);}
\DoxyCodeLine{00581\ }
\DoxyCodeLine{00582\ \ \ \ \ secp256k1\_fe\_add(\&t,\ \&r-\/>x);}
\DoxyCodeLine{00583\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>y,\ \&t,\ \&i);}
\DoxyCodeLine{00584\ \ \ \ \ secp256k1\_fe\_mul(\&h3,\ \&h3,\ \&s1);}
\DoxyCodeLine{00585\ \ \ \ \ secp256k1\_fe\_add(\&r-\/>y,\ \&h3);}
\DoxyCodeLine{00586\ }
\DoxyCodeLine{00587\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(r);}
\DoxyCodeLine{00588\ \}}
\DoxyCodeLine{00589\ }
\DoxyCodeLine{00590\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_gej\_add\_ge\_var(secp256k1\_gej\ *r,\ \textcolor{keyword}{const}\ secp256k1\_gej\ *a,\ \textcolor{keyword}{const}\ secp256k1\_ge\ *b,\ secp256k1\_fe\ *rzr)\ \{}
\DoxyCodeLine{00591\ \ \ \ \ \textcolor{comment}{/*\ Operations:\ 8\ mul,\ 3\ sqr,\ 11\ add/negate/normalizes\_to\_zero\ (ignoring\ special\ cases)\ */}}
\DoxyCodeLine{00592\ \ \ \ \ secp256k1\_fe\ z12,\ u1,\ u2,\ s1,\ s2,\ h,\ i,\ h2,\ h3,\ t;}
\DoxyCodeLine{00593\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(a);}
\DoxyCodeLine{00594\ \ \ \ \ SECP256K1\_GE\_VERIFY(b);}
\DoxyCodeLine{00595\ }
\DoxyCodeLine{00596\ \ \ \ \ \textcolor{keywordflow}{if}\ (a-\/>infinity)\ \{}
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ VERIFY\_CHECK(rzr\ ==\ NULL);}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ secp256k1\_gej\_set\_ge(r,\ b);}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00600\ \ \ \ \ \}}
\DoxyCodeLine{00601\ \ \ \ \ \textcolor{keywordflow}{if}\ (b-\/>infinity)\ \{}
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rzr\ !=\ NULL)\ \{}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_fe\_set\_int(rzr,\ 1);}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ *r\ =\ *a;}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00607\ \ \ \ \ \}}
\DoxyCodeLine{00608\ }
\DoxyCodeLine{00609\ \ \ \ \ secp256k1\_fe\_sqr(\&z12,\ \&a-\/>z);}
\DoxyCodeLine{00610\ \ \ \ \ u1\ =\ a-\/>x;}
\DoxyCodeLine{00611\ \ \ \ \ secp256k1\_fe\_mul(\&u2,\ \&b-\/>x,\ \&z12);}
\DoxyCodeLine{00612\ \ \ \ \ s1\ =\ a-\/>y;}
\DoxyCodeLine{00613\ \ \ \ \ secp256k1\_fe\_mul(\&s2,\ \&b-\/>y,\ \&z12);\ secp256k1\_fe\_mul(\&s2,\ \&s2,\ \&a-\/>z);}
\DoxyCodeLine{00614\ \ \ \ \ secp256k1\_fe\_negate(\&h,\ \&u1,\ SECP256K1\_GEJ\_X\_MAGNITUDE\_MAX);\ secp256k1\_fe\_add(\&h,\ \&u2);}
\DoxyCodeLine{00615\ \ \ \ \ secp256k1\_fe\_negate(\&i,\ \&s2,\ 1);\ secp256k1\_fe\_add(\&i,\ \&s1);}
\DoxyCodeLine{00616\ \ \ \ \ \textcolor{keywordflow}{if}\ (secp256k1\_fe\_normalizes\_to\_zero\_var(\&h))\ \{}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (secp256k1\_fe\_normalizes\_to\_zero\_var(\&i))\ \{}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_gej\_double\_var(r,\ a,\ rzr);}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rzr\ !=\ NULL)\ \{}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_fe\_set\_int(rzr,\ 0);}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_gej\_set\_infinity(r);}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00626\ \ \ \ \ \}}
\DoxyCodeLine{00627\ }
\DoxyCodeLine{00628\ \ \ \ \ r-\/>infinity\ =\ 0;}
\DoxyCodeLine{00629\ \ \ \ \ \textcolor{keywordflow}{if}\ (rzr\ !=\ NULL)\ \{}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ *rzr\ =\ h;}
\DoxyCodeLine{00631\ \ \ \ \ \}}
\DoxyCodeLine{00632\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>z,\ \&a-\/>z,\ \&h);}
\DoxyCodeLine{00633\ }
\DoxyCodeLine{00634\ \ \ \ \ secp256k1\_fe\_sqr(\&h2,\ \&h);}
\DoxyCodeLine{00635\ \ \ \ \ secp256k1\_fe\_negate(\&h2,\ \&h2,\ 1);}
\DoxyCodeLine{00636\ \ \ \ \ secp256k1\_fe\_mul(\&h3,\ \&h2,\ \&h);}
\DoxyCodeLine{00637\ \ \ \ \ secp256k1\_fe\_mul(\&t,\ \&u1,\ \&h2);}
\DoxyCodeLine{00638\ }
\DoxyCodeLine{00639\ \ \ \ \ secp256k1\_fe\_sqr(\&r-\/>x,\ \&i);}
\DoxyCodeLine{00640\ \ \ \ \ secp256k1\_fe\_add(\&r-\/>x,\ \&h3);}
\DoxyCodeLine{00641\ \ \ \ \ secp256k1\_fe\_add(\&r-\/>x,\ \&t);}
\DoxyCodeLine{00642\ \ \ \ \ secp256k1\_fe\_add(\&r-\/>x,\ \&t);}
\DoxyCodeLine{00643\ }
\DoxyCodeLine{00644\ \ \ \ \ secp256k1\_fe\_add(\&t,\ \&r-\/>x);}
\DoxyCodeLine{00645\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>y,\ \&t,\ \&i);}
\DoxyCodeLine{00646\ \ \ \ \ secp256k1\_fe\_mul(\&h3,\ \&h3,\ \&s1);}
\DoxyCodeLine{00647\ \ \ \ \ secp256k1\_fe\_add(\&r-\/>y,\ \&h3);}
\DoxyCodeLine{00648\ }
\DoxyCodeLine{00649\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(r);}
\DoxyCodeLine{00650\ \ \ \ \ \textcolor{keywordflow}{if}\ (rzr\ !=\ NULL)\ SECP256K1\_FE\_VERIFY(rzr);}
\DoxyCodeLine{00651\ \}}
\DoxyCodeLine{00652\ }
\DoxyCodeLine{00653\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_gej\_add\_zinv\_var(secp256k1\_gej\ *r,\ \textcolor{keyword}{const}\ secp256k1\_gej\ *a,\ \textcolor{keyword}{const}\ secp256k1\_ge\ *b,\ \textcolor{keyword}{const}\ secp256k1\_fe\ *bzinv)\ \{}
\DoxyCodeLine{00654\ \ \ \ \ \textcolor{comment}{/*\ Operations:\ 9\ mul,\ 3\ sqr,\ 11\ add/negate/normalizes\_to\_zero\ (ignoring\ special\ cases)\ */}}
\DoxyCodeLine{00655\ \ \ \ \ secp256k1\_fe\ az,\ z12,\ u1,\ u2,\ s1,\ s2,\ h,\ i,\ h2,\ h3,\ t;}
\DoxyCodeLine{00656\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(a);}
\DoxyCodeLine{00657\ \ \ \ \ SECP256K1\_GE\_VERIFY(b);}
\DoxyCodeLine{00658\ \ \ \ \ SECP256K1\_FE\_VERIFY(bzinv);}
\DoxyCodeLine{00659\ }
\DoxyCodeLine{00660\ \ \ \ \ \textcolor{keywordflow}{if}\ (a-\/>infinity)\ \{}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ secp256k1\_fe\ bzinv2,\ bzinv3;}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ r-\/>infinity\ =\ b-\/>infinity;}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ secp256k1\_fe\_sqr(\&bzinv2,\ bzinv);}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \ \ secp256k1\_fe\_mul(\&bzinv3,\ \&bzinv2,\ bzinv);}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>x,\ \&b-\/>x,\ \&bzinv2);}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>y,\ \&b-\/>y,\ \&bzinv3);}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \ \ secp256k1\_fe\_set\_int(\&r-\/>z,\ 1);}
\DoxyCodeLine{00668\ \ \ \ \ \ \ \ \ SECP256K1\_GEJ\_VERIFY(r);}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00670\ \ \ \ \ \}}
\DoxyCodeLine{00671\ \ \ \ \ \textcolor{keywordflow}{if}\ (b-\/>infinity)\ \{}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ *r\ =\ *a;}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00674\ \ \ \ \ \}}
\DoxyCodeLine{00675\ }
\DoxyCodeLine{00684\ \ \ \ \ secp256k1\_fe\_mul(\&az,\ \&a-\/>z,\ bzinv);}
\DoxyCodeLine{00685\ }
\DoxyCodeLine{00686\ \ \ \ \ secp256k1\_fe\_sqr(\&z12,\ \&az);}
\DoxyCodeLine{00687\ \ \ \ \ u1\ =\ a-\/>x;}
\DoxyCodeLine{00688\ \ \ \ \ secp256k1\_fe\_mul(\&u2,\ \&b-\/>x,\ \&z12);}
\DoxyCodeLine{00689\ \ \ \ \ s1\ =\ a-\/>y;}
\DoxyCodeLine{00690\ \ \ \ \ secp256k1\_fe\_mul(\&s2,\ \&b-\/>y,\ \&z12);\ secp256k1\_fe\_mul(\&s2,\ \&s2,\ \&az);}
\DoxyCodeLine{00691\ \ \ \ \ secp256k1\_fe\_negate(\&h,\ \&u1,\ SECP256K1\_GEJ\_X\_MAGNITUDE\_MAX);\ secp256k1\_fe\_add(\&h,\ \&u2);}
\DoxyCodeLine{00692\ \ \ \ \ secp256k1\_fe\_negate(\&i,\ \&s2,\ 1);\ secp256k1\_fe\_add(\&i,\ \&s1);}
\DoxyCodeLine{00693\ \ \ \ \ \textcolor{keywordflow}{if}\ (secp256k1\_fe\_normalizes\_to\_zero\_var(\&h))\ \{}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (secp256k1\_fe\_normalizes\_to\_zero\_var(\&i))\ \{}
\DoxyCodeLine{00695\ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_gej\_double\_var(r,\ a,\ NULL);}
\DoxyCodeLine{00696\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_gej\_set\_infinity(r);}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00700\ \ \ \ \ \}}
\DoxyCodeLine{00701\ }
\DoxyCodeLine{00702\ \ \ \ \ r-\/>infinity\ =\ 0;}
\DoxyCodeLine{00703\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>z,\ \&a-\/>z,\ \&h);}
\DoxyCodeLine{00704\ }
\DoxyCodeLine{00705\ \ \ \ \ secp256k1\_fe\_sqr(\&h2,\ \&h);}
\DoxyCodeLine{00706\ \ \ \ \ secp256k1\_fe\_negate(\&h2,\ \&h2,\ 1);}
\DoxyCodeLine{00707\ \ \ \ \ secp256k1\_fe\_mul(\&h3,\ \&h2,\ \&h);}
\DoxyCodeLine{00708\ \ \ \ \ secp256k1\_fe\_mul(\&t,\ \&u1,\ \&h2);}
\DoxyCodeLine{00709\ }
\DoxyCodeLine{00710\ \ \ \ \ secp256k1\_fe\_sqr(\&r-\/>x,\ \&i);}
\DoxyCodeLine{00711\ \ \ \ \ secp256k1\_fe\_add(\&r-\/>x,\ \&h3);}
\DoxyCodeLine{00712\ \ \ \ \ secp256k1\_fe\_add(\&r-\/>x,\ \&t);}
\DoxyCodeLine{00713\ \ \ \ \ secp256k1\_fe\_add(\&r-\/>x,\ \&t);}
\DoxyCodeLine{00714\ }
\DoxyCodeLine{00715\ \ \ \ \ secp256k1\_fe\_add(\&t,\ \&r-\/>x);}
\DoxyCodeLine{00716\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>y,\ \&t,\ \&i);}
\DoxyCodeLine{00717\ \ \ \ \ secp256k1\_fe\_mul(\&h3,\ \&h3,\ \&s1);}
\DoxyCodeLine{00718\ \ \ \ \ secp256k1\_fe\_add(\&r-\/>y,\ \&h3);}
\DoxyCodeLine{00719\ }
\DoxyCodeLine{00720\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(r);}
\DoxyCodeLine{00721\ \}}
\DoxyCodeLine{00722\ }
\DoxyCodeLine{00723\ }
\DoxyCodeLine{00724\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_gej\_add\_ge(secp256k1\_gej\ *r,\ \textcolor{keyword}{const}\ secp256k1\_gej\ *a,\ \textcolor{keyword}{const}\ secp256k1\_ge\ *b)\ \{}
\DoxyCodeLine{00725\ \ \ \ \ \textcolor{comment}{/*\ Operations:\ 7\ mul,\ 5\ sqr,\ 21\ add/cmov/half/mul\_int/negate/normalizes\_to\_zero\ */}}
\DoxyCodeLine{00726\ \ \ \ \ secp256k1\_fe\ zz,\ u1,\ u2,\ s1,\ s2,\ t,\ tt,\ m,\ n,\ q,\ rr;}
\DoxyCodeLine{00727\ \ \ \ \ secp256k1\_fe\ m\_alt,\ rr\_alt;}
\DoxyCodeLine{00728\ \ \ \ \ \textcolor{keywordtype}{int}\ degenerate;}
\DoxyCodeLine{00729\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(a);}
\DoxyCodeLine{00730\ \ \ \ \ SECP256K1\_GE\_VERIFY(b);}
\DoxyCodeLine{00731\ \ \ \ \ VERIFY\_CHECK(!b-\/>infinity);}
\DoxyCodeLine{00732\ }
\DoxyCodeLine{00733\ \ \ \ \ \textcolor{comment}{/*\ \ In:}}
\DoxyCodeLine{00734\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ Eric\ Brier\ and\ Marc\ Joye,\ Weierstrass\ Elliptic\ Curves\ and\ Side-\/Channel\ Attacks.}}
\DoxyCodeLine{00735\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ In\ D.\ Naccache\ and\ P.\ Paillier,\ Eds.,\ Public\ Key\ Cryptography,\ vol.\ 2274\ of\ Lecture\ Notes\ in\ Computer\ Science,\ pages\ 335-\/345.\ Springer-\/Verlag,\ 2002.}}
\DoxyCodeLine{00736\ \textcolor{comment}{\ \ \ \ \ *\ \ we\ find\ as\ solution\ for\ a\ unified\ addition/doubling\ formula:}}
\DoxyCodeLine{00737\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ lambda\ =\ ((x1\ +\ x2)\string^2\ -\/\ x1\ *\ x2\ +\ a)\ /\ (y1\ +\ y2),\ with\ a\ =\ 0\ for\ secp256k1's\ curve\ equation.}}
\DoxyCodeLine{00738\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ x3\ =\ lambda\string^2\ -\/\ (x1\ +\ x2)}}
\DoxyCodeLine{00739\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ 2*y3\ =\ lambda\ *\ (x1\ +\ x2\ -\/\ 2\ *\ x3)\ -\/\ (y1\ +\ y2).}}
\DoxyCodeLine{00740\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00741\ \textcolor{comment}{\ \ \ \ \ *\ \ Substituting\ x\_i\ =\ Xi\ /\ Zi\string^2\ and\ yi\ =\ Yi\ /\ Zi\string^3,\ for\ i=1,2,3,\ gives:}}
\DoxyCodeLine{00742\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ U1\ =\ X1*Z2\string^2,\ U2\ =\ X2*Z1\string^2}}
\DoxyCodeLine{00743\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ S1\ =\ Y1*Z2\string^3,\ S2\ =\ Y2*Z1\string^3}}
\DoxyCodeLine{00744\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ Z\ =\ Z1*Z2}}
\DoxyCodeLine{00745\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ T\ =\ U1+U2}}
\DoxyCodeLine{00746\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ M\ =\ S1+S2}}
\DoxyCodeLine{00747\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ Q\ =\ -\/T*M\string^2}}
\DoxyCodeLine{00748\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ R\ =\ T\string^2-\/U1*U2}}
\DoxyCodeLine{00749\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ X3\ =\ R\string^2+Q}}
\DoxyCodeLine{00750\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ Y3\ =\ -\/(R*(2*X3+Q)+M\string^4)/2}}
\DoxyCodeLine{00751\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ Z3\ =\ M*Z}}
\DoxyCodeLine{00752\ \textcolor{comment}{\ \ \ \ \ *\ \ (Note\ that\ the\ paper\ uses\ xi\ =\ Xi\ /\ Zi\ and\ yi\ =\ Yi\ /\ Zi\ instead.)}}
\DoxyCodeLine{00753\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00754\ \textcolor{comment}{\ \ \ \ \ *\ \ This\ formula\ has\ the\ benefit\ of\ being\ the\ same\ for\ both\ addition}}
\DoxyCodeLine{00755\ \textcolor{comment}{\ \ \ \ \ *\ \ of\ distinct\ points\ and\ doubling.\ However,\ it\ breaks\ down\ in\ the}}
\DoxyCodeLine{00756\ \textcolor{comment}{\ \ \ \ \ *\ \ case\ that\ either\ point\ is\ infinity,\ or\ that\ y1\ =\ -\/y2.\ We\ handle}}
\DoxyCodeLine{00757\ \textcolor{comment}{\ \ \ \ \ *\ \ these\ cases\ in\ the\ following\ ways:}}
\DoxyCodeLine{00758\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00759\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ -\/\ If\ b\ is\ infinity\ we\ simply\ bail\ by\ means\ of\ a\ VERIFY\_CHECK.}}
\DoxyCodeLine{00760\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00761\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ -\/\ If\ a\ is\ infinity,\ we\ detect\ this,\ and\ at\ the\ end\ of\ the}}
\DoxyCodeLine{00762\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ computation\ replace\ the\ result\ (which\ will\ be\ meaningless,}}
\DoxyCodeLine{00763\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ but\ we\ compute\ to\ be\ constant-\/time)\ with\ b.x\ :\ b.y\ :\ 1.}}
\DoxyCodeLine{00764\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00765\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ -\/\ If\ a\ =\ -\/b,\ we\ have\ y1\ =\ -\/y2,\ which\ is\ a\ degenerate\ case.}}
\DoxyCodeLine{00766\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ But\ here\ the\ answer\ is\ infinity,\ so\ we\ simply\ set\ the}}
\DoxyCodeLine{00767\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ infinity\ flag\ of\ the\ result,\ overriding\ the\ computed\ values}}
\DoxyCodeLine{00768\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ without\ even\ needing\ to\ cmov.}}
\DoxyCodeLine{00769\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00770\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ -\/\ If\ y1\ =\ -\/y2\ but\ x1\ !=\ x2,\ which\ does\ occur\ thanks\ to\ certain}}
\DoxyCodeLine{00771\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ properties\ of\ our\ curve\ (specifically,\ 1\ has\ nontrivial\ cube}}
\DoxyCodeLine{00772\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ roots\ in\ our\ field,\ and\ the\ curve\ equation\ has\ no\ x\ coefficient)}}
\DoxyCodeLine{00773\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ then\ the\ answer\ is\ not\ infinity\ but\ also\ not\ given\ by\ the\ above}}
\DoxyCodeLine{00774\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ equation.\ In\ this\ case,\ we\ cmov\ in\ place\ an\ alternate\ expression}}
\DoxyCodeLine{00775\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ for\ lambda.\ Specifically\ (y1\ -\/\ y2)/(x1\ -\/\ x2).\ Where\ both\ these}}
\DoxyCodeLine{00776\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ expressions\ for\ lambda\ are\ defined,\ they\ are\ equal,\ and\ can\ be}}
\DoxyCodeLine{00777\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ obtained\ from\ each\ other\ by\ multiplication\ by\ (y1\ +\ y2)/(y1\ +\ y2)}}
\DoxyCodeLine{00778\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ then\ substitution\ of\ x\string^3\ +\ 7\ for\ y\string^2\ (using\ the\ curve\ equation).}}
\DoxyCodeLine{00779\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ For\ all\ pairs\ of\ nonzero\ points\ (a,\ b)\ at\ least\ one\ is\ defined,}}
\DoxyCodeLine{00780\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ so\ this\ covers\ everything.}}
\DoxyCodeLine{00781\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00782\ }
\DoxyCodeLine{00783\ \ \ \ \ secp256k1\_fe\_sqr(\&zz,\ \&a-\/>z);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ z\ =\ Z1\string^2\ */}}
\DoxyCodeLine{00784\ \ \ \ \ u1\ =\ a-\/>x;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ u1\ =\ U1\ =\ X1*Z2\string^2\ (GEJ\_X\_M)\ */}}
\DoxyCodeLine{00785\ \ \ \ \ secp256k1\_fe\_mul(\&u2,\ \&b-\/>x,\ \&zz);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ u2\ =\ U2\ =\ X2*Z1\string^2\ (1)\ */}}
\DoxyCodeLine{00786\ \ \ \ \ s1\ =\ a-\/>y;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ s1\ =\ S1\ =\ Y1*Z2\string^3\ (GEJ\_Y\_M)\ */}}
\DoxyCodeLine{00787\ \ \ \ \ secp256k1\_fe\_mul(\&s2,\ \&b-\/>y,\ \&zz);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ s2\ =\ Y2*Z1\string^2\ (1)\ */}}
\DoxyCodeLine{00788\ \ \ \ \ secp256k1\_fe\_mul(\&s2,\ \&s2,\ \&a-\/>z);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ s2\ =\ S2\ =\ Y2*Z1\string^3\ (1)\ */}}
\DoxyCodeLine{00789\ \ \ \ \ t\ =\ u1;\ secp256k1\_fe\_add(\&t,\ \&u2);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ t\ =\ T\ =\ U1+U2\ (GEJ\_X\_M+1)\ */}}
\DoxyCodeLine{00790\ \ \ \ \ m\ =\ s1;\ secp256k1\_fe\_add(\&m,\ \&s2);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ m\ =\ M\ =\ S1+S2\ (GEJ\_Y\_M+1)\ */}}
\DoxyCodeLine{00791\ \ \ \ \ secp256k1\_fe\_sqr(\&rr,\ \&t);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ rr\ =\ T\string^2\ (1)\ */}}
\DoxyCodeLine{00792\ \ \ \ \ secp256k1\_fe\_negate(\&m\_alt,\ \&u2,\ 1);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Malt\ =\ -\/X2*Z1\string^2\ (2)\ */}}
\DoxyCodeLine{00793\ \ \ \ \ secp256k1\_fe\_mul(\&tt,\ \&u1,\ \&m\_alt);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ tt\ =\ -\/U1*U2\ (1)\ */}}
\DoxyCodeLine{00794\ \ \ \ \ secp256k1\_fe\_add(\&rr,\ \&tt);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ rr\ =\ R\ =\ T\string^2-\/U1*U2\ (2)\ */}}
\DoxyCodeLine{00795\ \ \ \ \ \textcolor{comment}{/*\ If\ lambda\ =\ R/M\ =\ R/0\ we\ have\ a\ problem\ (except\ in\ the\ "{}trivial"{}}}
\DoxyCodeLine{00796\ \textcolor{comment}{\ \ \ \ \ *\ case\ that\ Z\ =\ z1z2\ =\ 0,\ and\ this\ is\ special-\/cased\ later\ on).\ */}}
\DoxyCodeLine{00797\ \ \ \ \ degenerate\ =\ secp256k1\_fe\_normalizes\_to\_zero(\&m);}
\DoxyCodeLine{00798\ \ \ \ \ \textcolor{comment}{/*\ This\ only\ occurs\ when\ y1\ ==\ -\/y2\ and\ x1\string^3\ ==\ x2\string^3,\ but\ x1\ !=\ x2.}}
\DoxyCodeLine{00799\ \textcolor{comment}{\ \ \ \ \ *\ This\ means\ either\ x1\ ==\ beta*x2\ or\ beta*x1\ ==\ x2,\ where\ beta\ is}}
\DoxyCodeLine{00800\ \textcolor{comment}{\ \ \ \ \ *\ a\ nontrivial\ cube\ root\ of\ one.\ In\ either\ case,\ an\ alternate}}
\DoxyCodeLine{00801\ \textcolor{comment}{\ \ \ \ \ *\ non-\/indeterminate\ expression\ for\ lambda\ is\ (y1\ -\/\ y2)/(x1\ -\/\ x2),}}
\DoxyCodeLine{00802\ \textcolor{comment}{\ \ \ \ \ *\ so\ we\ set\ R/M\ equal\ to\ this.\ */}}
\DoxyCodeLine{00803\ \ \ \ \ rr\_alt\ =\ s1;}
\DoxyCodeLine{00804\ \ \ \ \ secp256k1\_fe\_mul\_int(\&rr\_alt,\ 2);\ \ \ \ \ \ \ \textcolor{comment}{/*\ rr\_alt\ =\ Y1*Z2\string^3\ -\/\ Y2*Z1\string^3\ (GEJ\_Y\_M*2)\ */}}
\DoxyCodeLine{00805\ \ \ \ \ secp256k1\_fe\_add(\&m\_alt,\ \&u1);\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Malt\ =\ X1*Z2\string^2\ -\/\ X2*Z1\string^2\ (GEJ\_X\_M+2)\ */}}
\DoxyCodeLine{00806\ }
\DoxyCodeLine{00807\ \ \ \ \ secp256k1\_fe\_cmov(\&rr\_alt,\ \&rr,\ !degenerate);\ \ \ \ \ \ \ \textcolor{comment}{/*\ rr\_alt\ (GEJ\_Y\_M*2)\ */}}
\DoxyCodeLine{00808\ \ \ \ \ secp256k1\_fe\_cmov(\&m\_alt,\ \&m,\ !degenerate);\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ m\_alt\ (GEJ\_X\_M+2)\ */}}
\DoxyCodeLine{00809\ \ \ \ \ \textcolor{comment}{/*\ Now\ Ralt\ /\ Malt\ =\ lambda\ and\ is\ guaranteed\ not\ to\ be\ Ralt\ /\ 0.}}
\DoxyCodeLine{00810\ \textcolor{comment}{\ \ \ \ \ *\ From\ here\ on\ out\ Ralt\ and\ Malt\ represent\ the\ numerator}}
\DoxyCodeLine{00811\ \textcolor{comment}{\ \ \ \ \ *\ and\ denominator\ of\ lambda;\ R\ and\ M\ represent\ the\ explicit}}
\DoxyCodeLine{00812\ \textcolor{comment}{\ \ \ \ \ *\ expressions\ x1\string^2\ +\ x2\string^2\ +\ x1x2\ and\ y1\ +\ y2.\ */}}
\DoxyCodeLine{00813\ \ \ \ \ secp256k1\_fe\_sqr(\&n,\ \&m\_alt);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ n\ =\ Malt\string^2\ (1)\ */}}
\DoxyCodeLine{00814\ \ \ \ \ secp256k1\_fe\_negate(\&q,\ \&t,}
\DoxyCodeLine{00815\ \ \ \ \ \ \ \ \ SECP256K1\_GEJ\_X\_MAGNITUDE\_MAX\ +\ 1);\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ q\ =\ -\/T\ (GEJ\_X\_M+2)\ */}}
\DoxyCodeLine{00816\ \ \ \ \ secp256k1\_fe\_mul(\&q,\ \&q,\ \&n);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ q\ =\ Q\ =\ -\/T*Malt\string^2\ (1)\ */}}
\DoxyCodeLine{00817\ \ \ \ \ \textcolor{comment}{/*\ These\ two\ lines\ use\ the\ observation\ that\ either\ M\ ==\ Malt\ or\ M\ ==\ 0,}}
\DoxyCodeLine{00818\ \textcolor{comment}{\ \ \ \ \ *\ so\ M\string^3\ *\ Malt\ is\ either\ Malt\string^4\ (which\ is\ computed\ by\ squaring),\ or}}
\DoxyCodeLine{00819\ \textcolor{comment}{\ \ \ \ \ *\ zero\ (which\ is\ "{}computed"{}\ by\ cmov).\ So\ the\ cost\ is\ one\ squaring}}
\DoxyCodeLine{00820\ \textcolor{comment}{\ \ \ \ \ *\ versus\ two\ multiplications.\ */}}
\DoxyCodeLine{00821\ \ \ \ \ secp256k1\_fe\_sqr(\&n,\ \&n);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ n\ =\ Malt\string^4\ (1)\ */}}
\DoxyCodeLine{00822\ \ \ \ \ secp256k1\_fe\_cmov(\&n,\ \&m,\ degenerate);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ n\ =\ M\string^3\ *\ Malt\ (GEJ\_Y\_M+1)\ */}}
\DoxyCodeLine{00823\ \ \ \ \ secp256k1\_fe\_sqr(\&t,\ \&rr\_alt);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ t\ =\ Ralt\string^2\ (1)\ */}}
\DoxyCodeLine{00824\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>z,\ \&a-\/>z,\ \&m\_alt);\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ r-\/>z\ =\ Z3\ =\ Malt*Z\ (1)\ */}}
\DoxyCodeLine{00825\ \ \ \ \ secp256k1\_fe\_add(\&t,\ \&q);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ t\ =\ Ralt\string^2\ +\ Q\ (2)\ */}}
\DoxyCodeLine{00826\ \ \ \ \ r-\/>x\ =\ t;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ r-\/>x\ =\ X3\ =\ Ralt\string^2\ +\ Q\ (2)\ */}}
\DoxyCodeLine{00827\ \ \ \ \ secp256k1\_fe\_mul\_int(\&t,\ 2);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ t\ =\ 2*X3\ (4)\ */}}
\DoxyCodeLine{00828\ \ \ \ \ secp256k1\_fe\_add(\&t,\ \&q);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ t\ =\ 2*X3\ +\ Q\ (5)\ */}}
\DoxyCodeLine{00829\ \ \ \ \ secp256k1\_fe\_mul(\&t,\ \&t,\ \&rr\_alt);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ t\ =\ Ralt*(2*X3\ +\ Q)\ (1)\ */}}
\DoxyCodeLine{00830\ \ \ \ \ secp256k1\_fe\_add(\&t,\ \&n);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ t\ =\ Ralt*(2*X3\ +\ Q)\ +\ M\string^3*Malt\ (GEJ\_Y\_M+2)\ */}}
\DoxyCodeLine{00831\ \ \ \ \ secp256k1\_fe\_negate(\&r-\/>y,\ \&t,}
\DoxyCodeLine{00832\ \ \ \ \ \ \ \ \ SECP256K1\_GEJ\_Y\_MAGNITUDE\_MAX\ +\ 2);\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ r-\/>y\ =\ -\/(Ralt*(2*X3\ +\ Q)\ +\ M\string^3*Malt)\ (GEJ\_Y\_M+3)\ */}}
\DoxyCodeLine{00833\ \ \ \ \ secp256k1\_fe\_half(\&r-\/>y);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ r-\/>y\ =\ Y3\ =\ -\/(Ralt*(2*X3\ +\ Q)\ +\ M\string^3*Malt)/2\ ((GEJ\_Y\_M+3)/2\ +\ 1)\ */}}
\DoxyCodeLine{00834\ }
\DoxyCodeLine{00835\ \ \ \ \ \textcolor{comment}{/*\ In\ case\ a-\/>infinity\ ==\ 1,\ replace\ r\ with\ (b-\/>x,\ b-\/>y,\ 1).\ */}}
\DoxyCodeLine{00836\ \ \ \ \ secp256k1\_fe\_cmov(\&r-\/>x,\ \&b-\/>x,\ a-\/>infinity);}
\DoxyCodeLine{00837\ \ \ \ \ secp256k1\_fe\_cmov(\&r-\/>y,\ \&b-\/>y,\ a-\/>infinity);}
\DoxyCodeLine{00838\ \ \ \ \ secp256k1\_fe\_cmov(\&r-\/>z,\ \&secp256k1\_fe\_one,\ a-\/>infinity);}
\DoxyCodeLine{00839\ }
\DoxyCodeLine{00840\ \ \ \ \ \textcolor{comment}{/*\ Set\ r-\/>infinity\ if\ r-\/>z\ is\ 0.}}
\DoxyCodeLine{00841\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00842\ \textcolor{comment}{\ \ \ \ \ *\ If\ a-\/>infinity\ is\ set,\ then\ r-\/>infinity\ =\ (r-\/>z\ ==\ 0)\ =\ (1\ ==\ 0)\ =\ false,}}
\DoxyCodeLine{00843\ \textcolor{comment}{\ \ \ \ \ *\ which\ is\ correct\ because\ the\ function\ assumes\ that\ b\ is\ not\ infinity.}}
\DoxyCodeLine{00844\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00845\ \textcolor{comment}{\ \ \ \ \ *\ Now\ assume\ !a-\/>infinity.\ This\ implies\ Z\ =\ Z1\ !=\ 0.}}
\DoxyCodeLine{00846\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00847\ \textcolor{comment}{\ \ \ \ \ *\ Case\ y1\ =\ -\/y2:}}
\DoxyCodeLine{00848\ \textcolor{comment}{\ \ \ \ \ *\ In\ this\ case\ we\ could\ have\ a\ =\ -\/b,\ namely\ if\ x1\ =\ x2.}}
\DoxyCodeLine{00849\ \textcolor{comment}{\ \ \ \ \ *\ We\ have\ degenerate\ =\ true,\ r-\/>z\ =\ (x1\ -\/\ x2)\ *\ Z.}}
\DoxyCodeLine{00850\ \textcolor{comment}{\ \ \ \ \ *\ Then\ r-\/>infinity\ =\ ((x1\ -\/\ x2)Z\ ==\ 0)\ =\ (x1\ ==\ x2)\ =\ (a\ ==\ -\/b).}}
\DoxyCodeLine{00851\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00852\ \textcolor{comment}{\ \ \ \ \ *\ Case\ y1\ !=\ -\/y2:}}
\DoxyCodeLine{00853\ \textcolor{comment}{\ \ \ \ \ *\ In\ this\ case,\ we\ can't\ have\ a\ =\ -\/b.}}
\DoxyCodeLine{00854\ \textcolor{comment}{\ \ \ \ \ *\ We\ have\ degenerate\ =\ false,\ r-\/>z\ =\ (y1\ +\ y2)\ *\ Z.}}
\DoxyCodeLine{00855\ \textcolor{comment}{\ \ \ \ \ *\ Then\ r-\/>infinity\ =\ ((y1\ +\ y2)Z\ ==\ 0)\ =\ (y1\ ==\ -\/y2)\ =\ false.\ */}}
\DoxyCodeLine{00856\ \ \ \ \ r-\/>infinity\ =\ secp256k1\_fe\_normalizes\_to\_zero(\&r-\/>z);}
\DoxyCodeLine{00857\ }
\DoxyCodeLine{00858\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(r);}
\DoxyCodeLine{00859\ \}}
\DoxyCodeLine{00860\ }
\DoxyCodeLine{00861\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_gej\_rescale(secp256k1\_gej\ *r,\ \textcolor{keyword}{const}\ secp256k1\_fe\ *s)\ \{}
\DoxyCodeLine{00862\ \ \ \ \ \textcolor{comment}{/*\ Operations:\ 4\ mul,\ 1\ sqr\ */}}
\DoxyCodeLine{00863\ \ \ \ \ secp256k1\_fe\ zz;}
\DoxyCodeLine{00864\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(r);}
\DoxyCodeLine{00865\ \ \ \ \ SECP256K1\_FE\_VERIFY(s);}
\DoxyCodeLine{00866\ \ \ \ \ VERIFY\_CHECK(!secp256k1\_fe\_normalizes\_to\_zero\_var(s));}
\DoxyCodeLine{00867\ }
\DoxyCodeLine{00868\ \ \ \ \ secp256k1\_fe\_sqr(\&zz,\ s);}
\DoxyCodeLine{00869\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>x,\ \&r-\/>x,\ \&zz);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ r-\/>x\ *=\ s\string^2\ */}}
\DoxyCodeLine{00870\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>y,\ \&r-\/>y,\ \&zz);}
\DoxyCodeLine{00871\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>y,\ \&r-\/>y,\ s);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ r-\/>y\ *=\ s\string^3\ */}}
\DoxyCodeLine{00872\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>z,\ \&r-\/>z,\ s);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ r-\/>z\ *=\ s\ \ \ */}}
\DoxyCodeLine{00873\ }
\DoxyCodeLine{00874\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(r);}
\DoxyCodeLine{00875\ \}}
\DoxyCodeLine{00876\ }
\DoxyCodeLine{00877\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_to\_storage(secp256k1\_ge\_storage\ *r,\ \textcolor{keyword}{const}\ secp256k1\_ge\ *a)\ \{}
\DoxyCodeLine{00878\ \ \ \ \ secp256k1\_fe\ x,\ y;}
\DoxyCodeLine{00879\ \ \ \ \ SECP256K1\_GE\_VERIFY(a);}
\DoxyCodeLine{00880\ \ \ \ \ VERIFY\_CHECK(!a-\/>infinity);}
\DoxyCodeLine{00881\ }
\DoxyCodeLine{00882\ \ \ \ \ x\ =\ a-\/>x;}
\DoxyCodeLine{00883\ \ \ \ \ secp256k1\_fe\_normalize(\&x);}
\DoxyCodeLine{00884\ \ \ \ \ y\ =\ a-\/>y;}
\DoxyCodeLine{00885\ \ \ \ \ secp256k1\_fe\_normalize(\&y);}
\DoxyCodeLine{00886\ \ \ \ \ secp256k1\_fe\_to\_storage(\&r-\/>x,\ \&x);}
\DoxyCodeLine{00887\ \ \ \ \ secp256k1\_fe\_to\_storage(\&r-\/>y,\ \&y);}
\DoxyCodeLine{00888\ \}}
\DoxyCodeLine{00889\ }
\DoxyCodeLine{00890\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_from\_storage(secp256k1\_ge\ *r,\ \textcolor{keyword}{const}\ secp256k1\_ge\_storage\ *a)\ \{}
\DoxyCodeLine{00891\ \ \ \ \ secp256k1\_fe\_from\_storage(\&r-\/>x,\ \&a-\/>x);}
\DoxyCodeLine{00892\ \ \ \ \ secp256k1\_fe\_from\_storage(\&r-\/>y,\ \&a-\/>y);}
\DoxyCodeLine{00893\ \ \ \ \ r-\/>infinity\ =\ 0;}
\DoxyCodeLine{00894\ }
\DoxyCodeLine{00895\ \ \ \ \ SECP256K1\_GE\_VERIFY(r);}
\DoxyCodeLine{00896\ \}}
\DoxyCodeLine{00897\ }
\DoxyCodeLine{00898\ \textcolor{keyword}{static}\ SECP256K1\_INLINE\ \textcolor{keywordtype}{void}\ secp256k1\_gej\_cmov(secp256k1\_gej\ *r,\ \textcolor{keyword}{const}\ secp256k1\_gej\ *a,\ \textcolor{keywordtype}{int}\ flag)\ \{}
\DoxyCodeLine{00899\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(r);}
\DoxyCodeLine{00900\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(a);}
\DoxyCodeLine{00901\ }
\DoxyCodeLine{00902\ \ \ \ \ secp256k1\_fe\_cmov(\&r-\/>x,\ \&a-\/>x,\ flag);}
\DoxyCodeLine{00903\ \ \ \ \ secp256k1\_fe\_cmov(\&r-\/>y,\ \&a-\/>y,\ flag);}
\DoxyCodeLine{00904\ \ \ \ \ secp256k1\_fe\_cmov(\&r-\/>z,\ \&a-\/>z,\ flag);}
\DoxyCodeLine{00905\ \ \ \ \ r-\/>infinity\ \string^=\ (r-\/>infinity\ \string^\ a-\/>infinity)\ \&\ flag;}
\DoxyCodeLine{00906\ }
\DoxyCodeLine{00907\ \ \ \ \ SECP256K1\_GEJ\_VERIFY(r);}
\DoxyCodeLine{00908\ \}}
\DoxyCodeLine{00909\ }
\DoxyCodeLine{00910\ \textcolor{keyword}{static}\ SECP256K1\_INLINE\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_storage\_cmov(secp256k1\_ge\_storage\ *r,\ \textcolor{keyword}{const}\ secp256k1\_ge\_storage\ *a,\ \textcolor{keywordtype}{int}\ flag)\ \{}
\DoxyCodeLine{00911\ \ \ \ \ secp256k1\_fe\_storage\_cmov(\&r-\/>x,\ \&a-\/>x,\ flag);}
\DoxyCodeLine{00912\ \ \ \ \ secp256k1\_fe\_storage\_cmov(\&r-\/>y,\ \&a-\/>y,\ flag);}
\DoxyCodeLine{00913\ \}}
\DoxyCodeLine{00914\ }
\DoxyCodeLine{00915\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_mul\_lambda(secp256k1\_ge\ *r,\ \textcolor{keyword}{const}\ secp256k1\_ge\ *a)\ \{}
\DoxyCodeLine{00916\ \ \ \ \ SECP256K1\_GE\_VERIFY(a);}
\DoxyCodeLine{00917\ }
\DoxyCodeLine{00918\ \ \ \ \ *r\ =\ *a;}
\DoxyCodeLine{00919\ \ \ \ \ secp256k1\_fe\_mul(\&r-\/>x,\ \&r-\/>x,\ \&secp256k1\_const\_beta);}
\DoxyCodeLine{00920\ }
\DoxyCodeLine{00921\ \ \ \ \ SECP256K1\_GE\_VERIFY(r);}
\DoxyCodeLine{00922\ \}}
\DoxyCodeLine{00923\ }
\DoxyCodeLine{00924\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ secp256k1\_ge\_is\_in\_correct\_subgroup(\textcolor{keyword}{const}\ secp256k1\_ge*\ ge)\ \{}
\DoxyCodeLine{00925\ \textcolor{preprocessor}{\#ifdef\ EXHAUSTIVE\_TEST\_ORDER}}
\DoxyCodeLine{00926\ \ \ \ \ secp256k1\_gej\ out;}
\DoxyCodeLine{00927\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00928\ \ \ \ \ SECP256K1\_GE\_VERIFY(ge);}
\DoxyCodeLine{00929\ }
\DoxyCodeLine{00930\ \ \ \ \ \textcolor{comment}{/*\ A\ very\ simple\ EC\ multiplication\ ladder\ that\ avoids\ a\ dependency\ on\ ecmult.\ */}}
\DoxyCodeLine{00931\ \ \ \ \ secp256k1\_gej\_set\_infinity(\&out);}
\DoxyCodeLine{00932\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ 32;\ ++i)\ \{}
\DoxyCodeLine{00933\ \ \ \ \ \ \ \ \ secp256k1\_gej\_double\_var(\&out,\ \&out,\ NULL);}
\DoxyCodeLine{00934\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((((uint32\_t)EXHAUSTIVE\_TEST\_ORDER)\ >>\ (31\ -\/\ i))\ \&\ 1)\ \{}
\DoxyCodeLine{00935\ \ \ \ \ \ \ \ \ \ \ \ \ secp256k1\_gej\_add\_ge\_var(\&out,\ \&out,\ ge,\ NULL);}
\DoxyCodeLine{00936\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00937\ \ \ \ \ \}}
\DoxyCodeLine{00938\ \ \ \ \ \textcolor{keywordflow}{return}\ secp256k1\_gej\_is\_infinity(\&out);}
\DoxyCodeLine{00939\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00940\ \ \ \ \ SECP256K1\_GE\_VERIFY(ge);}
\DoxyCodeLine{00941\ }
\DoxyCodeLine{00942\ \ \ \ \ (void)ge;}
\DoxyCodeLine{00943\ \ \ \ \ \textcolor{comment}{/*\ The\ real\ secp256k1\ group\ has\ cofactor\ 1,\ so\ the\ subgroup\ is\ the\ entire\ curve.\ */}}
\DoxyCodeLine{00944\ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00945\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00946\ \}}
\DoxyCodeLine{00947\ }
\DoxyCodeLine{00948\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ secp256k1\_ge\_x\_on\_curve\_var(\textcolor{keyword}{const}\ secp256k1\_fe\ *x)\ \{}
\DoxyCodeLine{00949\ \ \ \ \ secp256k1\_fe\ c;}
\DoxyCodeLine{00950\ \ \ \ \ secp256k1\_fe\_sqr(\&c,\ x);}
\DoxyCodeLine{00951\ \ \ \ \ secp256k1\_fe\_mul(\&c,\ \&c,\ x);}
\DoxyCodeLine{00952\ \ \ \ \ secp256k1\_fe\_add\_int(\&c,\ SECP256K1\_B);}
\DoxyCodeLine{00953\ \ \ \ \ \textcolor{keywordflow}{return}\ secp256k1\_fe\_is\_square\_var(\&c);}
\DoxyCodeLine{00954\ \}}
\DoxyCodeLine{00955\ }
\DoxyCodeLine{00956\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ secp256k1\_ge\_x\_frac\_on\_curve\_var(\textcolor{keyword}{const}\ secp256k1\_fe\ *xn,\ \textcolor{keyword}{const}\ secp256k1\_fe\ *xd)\ \{}
\DoxyCodeLine{00957\ \ \ \ \ \textcolor{comment}{/*\ We\ want\ to\ determine\ whether\ (xn/xd)\ is\ on\ the\ curve.}}
\DoxyCodeLine{00958\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00959\ \textcolor{comment}{\ \ \ \ \ *\ (xn/xd)\string^3\ +\ 7\ is\ square\ <=>\ xd*xn\string^3\ +\ 7*xd\string^4\ is\ square\ (multiplying\ by\ xd\string^4,\ a\ square).}}
\DoxyCodeLine{00960\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00961\ \ \ \ \ \ secp256k1\_fe\ r,\ t;}
\DoxyCodeLine{00962\ \ \ \ \ \ VERIFY\_CHECK(!secp256k1\_fe\_normalizes\_to\_zero\_var(xd));}
\DoxyCodeLine{00963\ }
\DoxyCodeLine{00964\ \ \ \ \ \ secp256k1\_fe\_mul(\&r,\ xd,\ xn);\ \textcolor{comment}{/*\ r\ =\ xd*xn\ */}}
\DoxyCodeLine{00965\ \ \ \ \ \ secp256k1\_fe\_sqr(\&t,\ xn);\ \textcolor{comment}{/*\ t\ =\ xn\string^2\ */}}
\DoxyCodeLine{00966\ \ \ \ \ \ secp256k1\_fe\_mul(\&r,\ \&r,\ \&t);\ \textcolor{comment}{/*\ r\ =\ xd*xn\string^3\ */}}
\DoxyCodeLine{00967\ \ \ \ \ \ secp256k1\_fe\_sqr(\&t,\ xd);\ \textcolor{comment}{/*\ t\ =\ xd\string^2\ */}}
\DoxyCodeLine{00968\ \ \ \ \ \ secp256k1\_fe\_sqr(\&t,\ \&t);\ \textcolor{comment}{/*\ t\ =\ xd\string^4\ */}}
\DoxyCodeLine{00969\ \ \ \ \ \ VERIFY\_CHECK(SECP256K1\_B\ <=\ 31);}
\DoxyCodeLine{00970\ \ \ \ \ \ secp256k1\_fe\_mul\_int(\&t,\ SECP256K1\_B);\ \textcolor{comment}{/*\ t\ =\ 7*xd\string^4\ */}}
\DoxyCodeLine{00971\ \ \ \ \ \ secp256k1\_fe\_add(\&r,\ \&t);\ \textcolor{comment}{/*\ r\ =\ xd*xn\string^3\ +\ 7*xd\string^4\ */}}
\DoxyCodeLine{00972\ \ \ \ \ \ \textcolor{keywordflow}{return}\ secp256k1\_fe\_is\_square\_var(\&r);}
\DoxyCodeLine{00973\ \}}
\DoxyCodeLine{00974\ }
\DoxyCodeLine{00975\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_to\_bytes(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *buf,\ \textcolor{keyword}{const}\ secp256k1\_ge\ *a)\ \{}
\DoxyCodeLine{00976\ \ \ \ \ secp256k1\_ge\_storage\ s;}
\DoxyCodeLine{00977\ }
\DoxyCodeLine{00978\ \ \ \ \ \textcolor{comment}{/*\ We\ require\ that\ the\ secp256k1\_ge\_storage\ type\ is\ exactly\ 64\ bytes.}}
\DoxyCodeLine{00979\ \textcolor{comment}{\ \ \ \ \ *\ This\ is\ formally\ not\ guaranteed\ by\ the\ C\ standard,\ but\ should\ hold\ on\ any}}
\DoxyCodeLine{00980\ \textcolor{comment}{\ \ \ \ \ *\ sane\ compiler\ in\ the\ real\ world.\ */}}
\DoxyCodeLine{00981\ \ \ \ \ STATIC\_ASSERT(\textcolor{keyword}{sizeof}(secp256k1\_ge\_storage)\ ==\ 64);}
\DoxyCodeLine{00982\ \ \ \ \ VERIFY\_CHECK(!secp256k1\_ge\_is\_infinity(a));}
\DoxyCodeLine{00983\ \ \ \ \ secp256k1\_ge\_to\_storage(\&s,\ a);}
\DoxyCodeLine{00984\ \ \ \ \ memcpy(buf,\ \&s,\ 64);}
\DoxyCodeLine{00985\ \}}
\DoxyCodeLine{00986\ }
\DoxyCodeLine{00987\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_from\_bytes(secp256k1\_ge\ *r,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *buf)\ \{}
\DoxyCodeLine{00988\ \ \ \ \ secp256k1\_ge\_storage\ s;}
\DoxyCodeLine{00989\ }
\DoxyCodeLine{00990\ \ \ \ \ STATIC\_ASSERT(\textcolor{keyword}{sizeof}(secp256k1\_ge\_storage)\ ==\ 64);}
\DoxyCodeLine{00991\ \ \ \ \ memcpy(\&s,\ buf,\ 64);}
\DoxyCodeLine{00992\ \ \ \ \ secp256k1\_ge\_from\_storage(r,\ \&s);}
\DoxyCodeLine{00993\ \}}
\DoxyCodeLine{00994\ }
\DoxyCodeLine{00995\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_to\_bytes\_ext(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *data,\ \textcolor{keyword}{const}\ secp256k1\_ge\ *ge)\ \{}
\DoxyCodeLine{00996\ \ \ \ \ \textcolor{keywordflow}{if}\ (secp256k1\_ge\_is\_infinity(ge))\ \{}
\DoxyCodeLine{00997\ \ \ \ \ \ \ \ \ memset(data,\ 0,\ 64);}
\DoxyCodeLine{00998\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00999\ \ \ \ \ \ \ \ \ secp256k1\_ge\_to\_bytes(data,\ ge);}
\DoxyCodeLine{01000\ \ \ \ \ \}}
\DoxyCodeLine{01001\ \}}
\DoxyCodeLine{01002\ }
\DoxyCodeLine{01003\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ secp256k1\_ge\_from\_bytes\_ext(secp256k1\_ge\ *ge,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *data)\ \{}
\DoxyCodeLine{01004\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ zeros[64]\ =\ \{\ 0\ \};}
\DoxyCodeLine{01005\ \ \ \ \ \textcolor{keywordflow}{if}\ (secp256k1\_memcmp\_var(data,\ zeros,\ \textcolor{keyword}{sizeof}(zeros))\ ==\ 0)\ \{}
\DoxyCodeLine{01006\ \ \ \ \ \ \ \ \ secp256k1\_ge\_set\_infinity(ge);}
\DoxyCodeLine{01007\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01008\ \ \ \ \ \ \ \ \ secp256k1\_ge\_from\_bytes(ge,\ data);}
\DoxyCodeLine{01009\ \ \ \ \ \}}
\DoxyCodeLine{01010\ \}}
\DoxyCodeLine{01011\ }
\DoxyCodeLine{01012\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ SECP256K1\_GROUP\_IMPL\_H\ */}\textcolor{preprocessor}{}}

\end{DoxyCode}
