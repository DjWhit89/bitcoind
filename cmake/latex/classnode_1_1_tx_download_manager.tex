\doxysection{Tx\+Download\+Manager Class Reference}
\label{classnode_1_1_tx_download_manager}\index{TxDownloadManager@{TxDownloadManager}}


{\ttfamily \#include $<$txdownloadman.\+h$>$}

\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\textbf{ Tx\+Download\+Manager} (const \textbf{ Tx\+Download\+Options} \&options)
\item 
\textbf{ $\sim$\+Tx\+Download\+Manager} ()
\item 
void \textbf{ Active\+Tip\+Change} ()
\item 
void \textbf{ Block\+Connected} (const std\+::shared\+\_\+ptr$<$ const \textbf{ CBlock} $>$ \&pblock)
\item 
void \textbf{ Block\+Disconnected} ()
\item 
void \textbf{ Connected\+Peer} (\textbf{ Node\+Id} nodeid, const \textbf{ Tx\+Download\+Connection\+Info} \&info)
\item 
void \textbf{ Disconnected\+Peer} (\textbf{ Node\+Id} nodeid)
\item 
bool \textbf{ Add\+Tx\+Announcement} (\textbf{ Node\+Id} peer, const \textbf{ Gen\+Txid} \&gtxid, std\+::chrono\+::microseconds now)
\item 
std\+::vector$<$ \textbf{ Gen\+Txid} $>$ \textbf{ Get\+Requests\+To\+Send} (\textbf{ Node\+Id} nodeid, std\+::chrono\+::microseconds current\+\_\+time)
\item 
void \textbf{ Received\+Not\+Found} (\textbf{ Node\+Id} nodeid, const std\+::vector$<$ \textbf{ Gen\+Txid} $>$ \&gtxids)
\item 
void \textbf{ Mempool\+Accepted\+Tx} (const \textbf{ CTransaction\+Ref} \&tx)
\item 
\textbf{ Rejected\+Tx\+Todo} \textbf{ Mempool\+Rejected\+Tx} (const \textbf{ CTransaction\+Ref} \&ptx, const \textbf{ Tx\+Validation\+State} \&state, \textbf{ Node\+Id} nodeid, bool first\+\_\+time\+\_\+failure)
\item 
void \textbf{ Mempool\+Rejected\+Package} (const \textbf{ Package} \&package)
\item 
std\+::pair$<$ bool, std\+::optional$<$ \textbf{ Package\+To\+Validate} $>$ $>$ \textbf{ Received\+Tx} (\textbf{ Node\+Id} nodeid, const \textbf{ CTransaction\+Ref} \&ptx)
\item 
bool \textbf{ Have\+More\+Work} (\textbf{ Node\+Id} nodeid) const
\item 
\textbf{ CTransaction\+Ref} \textbf{ Get\+Tx\+To\+Reconsider} (\textbf{ Node\+Id} nodeid)
\item 
void \textbf{ Check\+Is\+Empty} () const
\item 
void \textbf{ Check\+Is\+Empty} (\textbf{ Node\+Id} nodeid) const
\item 
std\+::vector$<$ \textbf{ Tx\+Orphanage\+::\+Orphan\+Info} $>$ \textbf{ Get\+Orphan\+Transactions} () const
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Class responsible for deciding what transactions to request and, once downloaded, whether and how to validate them. It is also responsible for deciding what transaction packages to validate and how to resolve orphan transactions. Its data structures include \doxyref{Tx\+Request\+Tracker}{p.}{class_tx_request_tracker} for scheduling requests, rolling bloom filters for remembering transactions that have already been \{accepted, rejected, confirmed\}, an orphanage, and a registry of each peer\textquotesingle{}s transaction relay-\/related information.

Caller needs to interact with \doxyref{Tx\+Download\+Manager}{p.}{classnode_1_1_tx_download_manager}\+:
\begin{DoxyItemize}
\item Validation\+Interface callbacks.
\item When a potential transaction relay peer connects or disconnects.
\item When a transaction or package is accepted or rejected from mempool
\item When a inv, notfound, or tx message is received
\item To get instructions for which getdata messages to send
\end{DoxyItemize}

This class is not thread-\/safe. Access must be synchronized using an external mutex. 

\label{doc-constructors}
\doxysubsection{Constructor \& Destructor Documentation}
\index{TxDownloadManager@{TxDownloadManager}!TxDownloadManager@{TxDownloadManager}}
\index{TxDownloadManager@{TxDownloadManager}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{TxDownloadManager()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_ad745a2efabba7bcfbdac7623042e8ec6} 
Tx\+Download\+Manager (\begin{DoxyParamCaption}\item[{const \textbf{ Tx\+Download\+Options} \&}]{options}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [explicit]}}

\index{TxDownloadManager@{TxDownloadManager}!````~TxDownloadManager@{$\sim$TxDownloadManager}}
\index{````~TxDownloadManager@{$\sim$TxDownloadManager}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{$\sim$TxDownloadManager()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_ac0e249b0808680b80fcdbc58d2316221} 
$\sim$\textbf{ Tx\+Download\+Manager} (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [default]}}



\label{doc-func-members}
\doxysubsection{Member Function Documentation}
\index{TxDownloadManager@{TxDownloadManager}!ActiveTipChange@{ActiveTipChange}}
\index{ActiveTipChange@{ActiveTipChange}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{ActiveTipChange()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_aa5883445f27deba93c352358f9e290c1} 
void Active\+Tip\+Change (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

\index{TxDownloadManager@{TxDownloadManager}!AddTxAnnouncement@{AddTxAnnouncement}}
\index{AddTxAnnouncement@{AddTxAnnouncement}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{AddTxAnnouncement()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_a9ce1df5e1f2436871991def3e2a99198} 
bool Add\+Tx\+Announcement (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{peer}{, }\item[{const \textbf{ Gen\+Txid} \&}]{gtxid}{, }\item[{std\+::chrono\+::microseconds}]{now}{}\end{DoxyParamCaption})}

Consider adding this tx hash to txrequest. Should be called whenever a new inv has been received. Also called internally when a transaction is missing parents so that we can request them. Returns true if this was a dropped inv (p2p\+\_\+inv=true and we already have the tx), false otherwise. \index{TxDownloadManager@{TxDownloadManager}!BlockConnected@{BlockConnected}}
\index{BlockConnected@{BlockConnected}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{BlockConnected()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_a53d97beb21a0a0eab363e22fc04fa3d9} 
void Block\+Connected (\begin{DoxyParamCaption}\item[{const std\+::shared\+\_\+ptr$<$ const \textbf{ CBlock} $>$ \&}]{pblock}{}\end{DoxyParamCaption})}

\index{TxDownloadManager@{TxDownloadManager}!BlockDisconnected@{BlockDisconnected}}
\index{BlockDisconnected@{BlockDisconnected}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{BlockDisconnected()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_aa9c6b85e663bc605cdef5ea311b1565a} 
void Block\+Disconnected (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

\index{TxDownloadManager@{TxDownloadManager}!CheckIsEmpty@{CheckIsEmpty}}
\index{CheckIsEmpty@{CheckIsEmpty}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{CheckIsEmpty()\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_a3ec0a9f6ba5cb4e43267afdacfe63339} 
void Check\+Is\+Empty (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption}) const}

Check that all data structures are empty. \index{TxDownloadManager@{TxDownloadManager}!CheckIsEmpty@{CheckIsEmpty}}
\index{CheckIsEmpty@{CheckIsEmpty}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{CheckIsEmpty()\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_aa5bb13c4cca9ffa4188056202ccad785} 
void Check\+Is\+Empty (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{nodeid}{}\end{DoxyParamCaption}) const}

Check that all data structures that track per-\/peer information have nothing for this peer. \index{TxDownloadManager@{TxDownloadManager}!ConnectedPeer@{ConnectedPeer}}
\index{ConnectedPeer@{ConnectedPeer}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{ConnectedPeer()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_a44008c3f833e83f33a382c81a842ab7e} 
void Connected\+Peer (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{nodeid}{, }\item[{const \textbf{ Tx\+Download\+Connection\+Info} \&}]{info}{}\end{DoxyParamCaption})}

Creates a new Peer\+Info. Saves the connection info to calculate tx announcement delays later. \index{TxDownloadManager@{TxDownloadManager}!DisconnectedPeer@{DisconnectedPeer}}
\index{DisconnectedPeer@{DisconnectedPeer}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{DisconnectedPeer()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_a2ddb15d822dd91ef55c56326adf50e4f} 
void Disconnected\+Peer (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{nodeid}{}\end{DoxyParamCaption})}

Deletes all txrequest announcements and orphans for a given peer. \index{TxDownloadManager@{TxDownloadManager}!GetOrphanTransactions@{GetOrphanTransactions}}
\index{GetOrphanTransactions@{GetOrphanTransactions}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{GetOrphanTransactions()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_ad103bb6f849e8140f39f4aef19109b9c} 
std\+::vector$<$ \textbf{ Tx\+Orphanage\+::\+Orphan\+Info} $>$ Get\+Orphan\+Transactions (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption}) const}

\doxyref{Wrapper}{p.}{class_wrapper} for \doxyref{Tx\+Orphanage\+::\+Get\+Orphan\+Transactions}{p.}{classnode_1_1_tx_orphanage_af76a7ae7bb57b16ce8866fb918563fcc} \index{TxDownloadManager@{TxDownloadManager}!GetRequestsToSend@{GetRequestsToSend}}
\index{GetRequestsToSend@{GetRequestsToSend}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{GetRequestsToSend()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_a9657de34ab5c603f7a719005801f44ea} 
std\+::vector$<$ \textbf{ Gen\+Txid} $>$ Get\+Requests\+To\+Send (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{nodeid}{, }\item[{std\+::chrono\+::microseconds}]{current\+\_\+time}{}\end{DoxyParamCaption})}

Get getdata requests to send. \index{TxDownloadManager@{TxDownloadManager}!GetTxToReconsider@{GetTxToReconsider}}
\index{GetTxToReconsider@{GetTxToReconsider}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{GetTxToReconsider()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_a3069348e7801e72ca8ae455538ba0ee8} 
\textbf{ CTransaction\+Ref} Get\+Tx\+To\+Reconsider (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{nodeid}{}\end{DoxyParamCaption})}

Returns next orphan tx to consider, or nullptr if none exist. \index{TxDownloadManager@{TxDownloadManager}!HaveMoreWork@{HaveMoreWork}}
\index{HaveMoreWork@{HaveMoreWork}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{HaveMoreWork()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_ad360aa1d7499deee26b547de7f4e61e7} 
bool Have\+More\+Work (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{nodeid}{}\end{DoxyParamCaption}) const}

Whether there are any orphans to reconsider for this peer. \index{TxDownloadManager@{TxDownloadManager}!MempoolAcceptedTx@{MempoolAcceptedTx}}
\index{MempoolAcceptedTx@{MempoolAcceptedTx}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{MempoolAcceptedTx()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_ad066c94643d88d8e76932d19ccecb448} 
void Mempool\+Accepted\+Tx (\begin{DoxyParamCaption}\item[{const \textbf{ CTransaction\+Ref} \&}]{tx}{}\end{DoxyParamCaption})}

Respond to successful transaction submission to mempool \index{TxDownloadManager@{TxDownloadManager}!MempoolRejectedPackage@{MempoolRejectedPackage}}
\index{MempoolRejectedPackage@{MempoolRejectedPackage}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{MempoolRejectedPackage()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_a358fdee6fa1c7c99776f1f301baaeafc} 
void Mempool\+Rejected\+Package (\begin{DoxyParamCaption}\item[{const \textbf{ Package} \&}]{package}{}\end{DoxyParamCaption})}

Respond to package rejected from mempool \index{TxDownloadManager@{TxDownloadManager}!MempoolRejectedTx@{MempoolRejectedTx}}
\index{MempoolRejectedTx@{MempoolRejectedTx}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{MempoolRejectedTx()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_af57da0e97f1ed045176b41e02ce92311} 
\textbf{ Rejected\+Tx\+Todo} Mempool\+Rejected\+Tx (\begin{DoxyParamCaption}\item[{const \textbf{ CTransaction\+Ref} \&}]{ptx}{, }\item[{const \textbf{ Tx\+Validation\+State} \&}]{state}{, }\item[{\textbf{ Node\+Id}}]{nodeid}{, }\item[{bool}]{first\+\_\+time\+\_\+failure}{}\end{DoxyParamCaption})}

Respond to transaction rejected from mempool \index{TxDownloadManager@{TxDownloadManager}!ReceivedNotFound@{ReceivedNotFound}}
\index{ReceivedNotFound@{ReceivedNotFound}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{ReceivedNotFound()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_ac3697b6766b4729e5e405ec352a6b9d7} 
void Received\+Not\+Found (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{nodeid}{, }\item[{const std\+::vector$<$ \textbf{ Gen\+Txid} $>$ \&}]{gtxids}{}\end{DoxyParamCaption})}

Should be called when a notfound for a tx has been received. \index{TxDownloadManager@{TxDownloadManager}!ReceivedTx@{ReceivedTx}}
\index{ReceivedTx@{ReceivedTx}!TxDownloadManager@{TxDownloadManager}}
\doxysubsubsection{ReceivedTx()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_a46fe23e66164805fc7f8a3a7f4e29136} 
std\+::pair$<$ bool, std\+::optional$<$ \textbf{ Package\+To\+Validate} $>$ $>$ Received\+Tx (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{nodeid}{, }\item[{const \textbf{ CTransaction\+Ref} \&}]{ptx}{}\end{DoxyParamCaption})}

Marks a tx as Received\+Response in txrequest and checks whether Already\+Have\+Tx. Return a bool indicating whether this tx should be validated. If false, optionally, a \doxyref{Package\+To\+Validate}{p.}{structnode_1_1_package_to_validate}. 

The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
src/node/\textbf{ txdownloadman.\+h}\item 
src/node/\textbf{ txdownloadman\+\_\+impl.\+cpp}\end{DoxyCompactItemize}
