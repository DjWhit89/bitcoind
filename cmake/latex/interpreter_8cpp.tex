\doxysection{src/script/interpreter.cpp File Reference}
\label{interpreter_8cpp}\index{src/script/interpreter.cpp@{src/script/interpreter.cpp}}
{\ttfamily \#include $<$script/interpreter.\+h$>$}\newline
{\ttfamily \#include $<$crypto/ripemd160.\+h$>$}\newline
{\ttfamily \#include $<$crypto/sha1.\+h$>$}\newline
{\ttfamily \#include $<$crypto/sha256.\+h$>$}\newline
{\ttfamily \#include $<$pubkey.\+h$>$}\newline
{\ttfamily \#include $<$script/script.\+h$>$}\newline
{\ttfamily \#include $<$tinyformat.\+h$>$}\newline
{\ttfamily \#include $<$uint256.\+h$>$}\newline
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \textbf{ stacktop}(i)
\item 
\#define \textbf{ altstacktop}(i)
\item 
\#define \textbf{ FLAG\+\_\+\+NAME}(flag)
\end{DoxyCompactItemize}
\doxysubsubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef std\+::vector$<$ unsigned char $>$ \textbf{ valtype}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
bool \textbf{ Cast\+To\+Bool} (const \textbf{ valtype} \&vch)
\item 
bool \textbf{ Check\+Signature\+Encoding} (const std\+::vector$<$ unsigned char $>$ \&vch\+Sig, \textbf{ script\+\_\+verify\+\_\+flags} \textbf{ flags}, \textbf{ Script\+Error} $\ast$serror)
\item 
int \textbf{ Find\+And\+Delete} (\textbf{ CScript} \&\textbf{ script}, const \textbf{ CScript} \&b)
\item 
bool \textbf{ Eval\+Script} (std\+::vector$<$ std\+::vector$<$ unsigned char $>$ $>$ \&stack, const \textbf{ CScript} \&\textbf{ script}, \textbf{ script\+\_\+verify\+\_\+flags} \textbf{ flags}, const \textbf{ Base\+Signature\+Checker} \&checker, \textbf{ Sig\+Version} sigversion, \textbf{ Script\+Execution\+Data} \&execdata, \textbf{ Script\+Error} $\ast$serror)
\item 
bool \textbf{ Eval\+Script} (std\+::vector$<$ std\+::vector$<$ unsigned char $>$ $>$ \&stack, const \textbf{ CScript} \&\textbf{ script}, \textbf{ script\+\_\+verify\+\_\+flags} \textbf{ flags}, const \textbf{ Base\+Signature\+Checker} \&checker, \textbf{ Sig\+Version} sigversion, \textbf{ Script\+Error} $\ast$serror)
\item 
{\footnotesize template$<$typename \textbf{ T}$>$ }\\bool \textbf{ Signature\+Hash\+Schnorr} (\textbf{ uint256} \&hash\+\_\+out, \textbf{ Script\+Execution\+Data} \&execdata, const \textbf{ T} \&tx\+\_\+to, uint32\+\_\+t in\+\_\+pos, uint8\+\_\+t hash\+\_\+type, \textbf{ Sig\+Version} sigversion, const \textbf{ Precomputed\+Transaction\+Data} \&cache, \textbf{ Missing\+Data\+Behavior} mdb)
\item 
{\footnotesize template$<$class \textbf{ T}$>$ }\\\textbf{ uint256} \textbf{ Signature\+Hash} (const \textbf{ CScript} \&script\+Code, const \textbf{ T} \&tx\+To, unsigned int n\+In, int32\+\_\+t n\+Hash\+Type, const \textbf{ CAmount} \&amount, \textbf{ Sig\+Version} sigversion, const \textbf{ Precomputed\+Transaction\+Data} $\ast$cache, \textbf{ Sig\+Hash\+Cache} $\ast$sighash\+\_\+cache)
\item 
\textbf{ uint256} \textbf{ Compute\+Tapleaf\+Hash} (uint8\+\_\+t leaf\+\_\+version, std\+::span$<$ const unsigned char $>$ \textbf{ script})
\item 
\textbf{ uint256} \textbf{ Compute\+Tapbranch\+Hash} (std\+::span$<$ const unsigned char $>$ a, std\+::span$<$ const unsigned char $>$ b)
\item 
\textbf{ uint256} \textbf{ Compute\+Taproot\+Merkle\+Root} (std\+::span$<$ const unsigned char $>$ control, const \textbf{ uint256} \&tapleaf\+\_\+hash)
\item 
bool \textbf{ Verify\+Script} (const \textbf{ CScript} \&script\+Sig, const \textbf{ CScript} \&script\+Pub\+Key, const \textbf{ CScript\+Witness} $\ast$witness, \textbf{ script\+\_\+verify\+\_\+flags} \textbf{ flags}, const \textbf{ Base\+Signature\+Checker} \&checker, \textbf{ Script\+Error} $\ast$serror)
\item 
size\+\_\+t \textbf{ Count\+Witness\+Sig\+Ops} (const \textbf{ CScript} \&script\+Sig, const \textbf{ CScript} \&script\+Pub\+Key, const \textbf{ CScript\+Witness} \&witness, \textbf{ script\+\_\+verify\+\_\+flags} \textbf{ flags})
\item 
const std\+::map$<$ std\+::string, \textbf{ script\+\_\+verify\+\_\+flag\+\_\+name} $>$ \& \textbf{ Script\+Flag\+Names\+To\+Enum} ()
\item 
std\+::vector$<$ std\+::string $>$ \textbf{ Get\+Script\+Flag\+Names} (\textbf{ script\+\_\+verify\+\_\+flags} \textbf{ flags})
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const \textbf{ Hash\+Writer} \textbf{ HASHER\+\_\+\+TAPSIGHASH} \{\textbf{ Tagged\+Hash}("{}Tap\+Sighash"{})\}
\begin{DoxyCompactList}\small\item\em Hasher with tag "{}\+Tap\+Sighash"{} pre-\/fed to it. \end{DoxyCompactList}\item 
const \textbf{ Hash\+Writer} \textbf{ HASHER\+\_\+\+TAPLEAF} \{\textbf{ Tagged\+Hash}("{}Tap\+Leaf"{})\}
\begin{DoxyCompactList}\small\item\em Hasher with tag "{}\+Tap\+Leaf"{} pre-\/fed to it. \end{DoxyCompactList}\item 
const \textbf{ Hash\+Writer} \textbf{ HASHER\+\_\+\+TAPBRANCH} \{\textbf{ Tagged\+Hash}("{}Tap\+Branch"{})\}
\begin{DoxyCompactList}\small\item\em Hasher with tag "{}\+Tap\+Branch"{} pre-\/fed to it. \end{DoxyCompactList}\end{DoxyCompactItemize}


\label{doc-define-members}
\doxysubsection{Macro Definition Documentation}
\index{interpreter.cpp@{interpreter.cpp}!altstacktop@{altstacktop}}
\index{altstacktop@{altstacktop}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{altstacktop}
{\footnotesize\ttfamily \label{interpreter_8cpp_ab87a1e371e31c052501ad87f84ac36d7} 
\#define altstacktop(\begin{DoxyParamCaption}\item[{}]{i}{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{(altstack.at(\textcolor{keywordtype}{size\_t}(int64\_t(altstack.size())\ +\ int64\_t\{i\})))}

\end{DoxyCode}
\index{interpreter.cpp@{interpreter.cpp}!FLAG\_NAME@{FLAG\_NAME}}
\index{FLAG\_NAME@{FLAG\_NAME}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{FLAG\_NAME}
{\footnotesize\ttfamily \label{interpreter_8cpp_aca5f59d102949d954d8eabe7eaca0f38} 
\#define FLAG\+\_\+\+NAME(\begin{DoxyParamCaption}\item[{}]{flag}{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\{std::string(\#flag),\ SCRIPT\_VERIFY\_\#\#flag\}}

\end{DoxyCode}
\index{interpreter.cpp@{interpreter.cpp}!stacktop@{stacktop}}
\index{stacktop@{stacktop}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{stacktop}
{\footnotesize\ttfamily \label{interpreter_8cpp_aaf94de5290fb16fe0fc816330febe57e} 
\#define stacktop(\begin{DoxyParamCaption}\item[{}]{i}{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{(stack.at(\textcolor{keywordtype}{size\_t}(int64\_t(stack.size())\ +\ int64\_t\{i\})))}

\end{DoxyCode}
Script is a stack machine (like Forth) that evaluates a predicate returning a bool indicating valid or not. There are no loops. 

\label{doc-typedef-members}
\doxysubsection{Typedef Documentation}
\index{interpreter.cpp@{interpreter.cpp}!valtype@{valtype}}
\index{valtype@{valtype}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{valtype}
{\footnotesize\ttfamily \label{interpreter_8cpp_a893ae190c4461e89b01441657f8975ed} 
typedef std\+::vector$<$unsigned char$>$ \textbf{ valtype}}



\label{doc-func-members}
\doxysubsection{Function Documentation}
\index{interpreter.cpp@{interpreter.cpp}!CastToBool@{CastToBool}}
\index{CastToBool@{CastToBool}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{CastToBool()}
{\footnotesize\ttfamily \label{interpreter_8cpp_a43bc2157638b796f2e3144963e00db34} 
bool Cast\+To\+Bool (\begin{DoxyParamCaption}\item[{const \textbf{ valtype} \&}]{vch}{}\end{DoxyParamCaption})}

\index{interpreter.cpp@{interpreter.cpp}!CheckSignatureEncoding@{CheckSignatureEncoding}}
\index{CheckSignatureEncoding@{CheckSignatureEncoding}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{CheckSignatureEncoding()}
{\footnotesize\ttfamily \label{interpreter_8cpp_aa80d5c47b0851e68af76b77bc6764ace} 
bool Check\+Signature\+Encoding (\begin{DoxyParamCaption}\item[{const std\+::vector$<$ unsigned char $>$ \&}]{vch\+Sig}{, }\item[{\textbf{ script\+\_\+verify\+\_\+flags}}]{flags}{, }\item[{\textbf{ Script\+Error} $\ast$}]{serror}{}\end{DoxyParamCaption})}

\index{interpreter.cpp@{interpreter.cpp}!ComputeTapbranchHash@{ComputeTapbranchHash}}
\index{ComputeTapbranchHash@{ComputeTapbranchHash}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{ComputeTapbranchHash()}
{\footnotesize\ttfamily \label{interpreter_8cpp_a0a133ab260a1749db70107309bfb79b4} 
\textbf{ uint256} Compute\+Tapbranch\+Hash (\begin{DoxyParamCaption}\item[{std\+::span$<$ const unsigned char $>$}]{a}{, }\item[{std\+::span$<$ const unsigned char $>$}]{b}{}\end{DoxyParamCaption})}

Compute the BIP341 tapbranch hash from two branches. Spans must be 32 bytes each. \index{interpreter.cpp@{interpreter.cpp}!ComputeTapleafHash@{ComputeTapleafHash}}
\index{ComputeTapleafHash@{ComputeTapleafHash}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{ComputeTapleafHash()}
{\footnotesize\ttfamily \label{interpreter_8cpp_a5de681691157c99012b3328ef4ed5a53} 
\textbf{ uint256} Compute\+Tapleaf\+Hash (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{leaf\+\_\+version}{, }\item[{std\+::span$<$ const unsigned char $>$}]{script}{}\end{DoxyParamCaption})}

Compute the BIP341 tapleaf hash from leaf version \& script. \index{interpreter.cpp@{interpreter.cpp}!ComputeTaprootMerkleRoot@{ComputeTaprootMerkleRoot}}
\index{ComputeTaprootMerkleRoot@{ComputeTaprootMerkleRoot}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{ComputeTaprootMerkleRoot()}
{\footnotesize\ttfamily \label{interpreter_8cpp_a3d0251486c5a68fa11e04ae60ddd71d0} 
\textbf{ uint256} Compute\+Taproot\+Merkle\+Root (\begin{DoxyParamCaption}\item[{std\+::span$<$ const unsigned char $>$}]{control}{, }\item[{const \textbf{ uint256} \&}]{tapleaf\+\_\+hash}{}\end{DoxyParamCaption})}

Compute the BIP341 taproot script tree Merkle root from control block and leaf hash. Requires control block to have valid length (33 + k$\ast$32, with k in \{0,1,..,128\}). \index{interpreter.cpp@{interpreter.cpp}!CountWitnessSigOps@{CountWitnessSigOps}}
\index{CountWitnessSigOps@{CountWitnessSigOps}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{CountWitnessSigOps()}
{\footnotesize\ttfamily \label{interpreter_8cpp_a5d5bf87ebcbac564a5d22a3df5d7e9ac} 
size\+\_\+t Count\+Witness\+Sig\+Ops (\begin{DoxyParamCaption}\item[{const \textbf{ CScript} \&}]{script\+Sig}{, }\item[{const \textbf{ CScript} \&}]{script\+Pub\+Key}{, }\item[{const \textbf{ CScript\+Witness} \&}]{witness}{, }\item[{\textbf{ script\+\_\+verify\+\_\+flags}}]{flags}{}\end{DoxyParamCaption})}

\index{interpreter.cpp@{interpreter.cpp}!EvalScript@{EvalScript}}
\index{EvalScript@{EvalScript}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{EvalScript()\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \label{interpreter_8cpp_aa35db62157a4602ff89e8ac9988ee83b} 
bool Eval\+Script (\begin{DoxyParamCaption}\item[{std\+::vector$<$ std\+::vector$<$ unsigned char $>$ $>$ \&}]{stack}{, }\item[{const \textbf{ CScript} \&}]{script}{, }\item[{\textbf{ script\+\_\+verify\+\_\+flags}}]{flags}{, }\item[{const \textbf{ Base\+Signature\+Checker} \&}]{checker}{, }\item[{\textbf{ Sig\+Version}}]{sigversion}{, }\item[{\textbf{ Script\+Error} $\ast$}]{serror}{}\end{DoxyParamCaption})}

\index{interpreter.cpp@{interpreter.cpp}!EvalScript@{EvalScript}}
\index{EvalScript@{EvalScript}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{EvalScript()\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \label{interpreter_8cpp_a631b2ddc793b03b5914da1eac99bdd17} 
bool Eval\+Script (\begin{DoxyParamCaption}\item[{std\+::vector$<$ std\+::vector$<$ unsigned char $>$ $>$ \&}]{stack}{, }\item[{const \textbf{ CScript} \&}]{script}{, }\item[{\textbf{ script\+\_\+verify\+\_\+flags}}]{flags}{, }\item[{const \textbf{ Base\+Signature\+Checker} \&}]{checker}{, }\item[{\textbf{ Sig\+Version}}]{sigversion}{, }\item[{\textbf{ Script\+Execution\+Data} \&}]{execdata}{, }\item[{\textbf{ Script\+Error} $\ast$}]{serror}{}\end{DoxyParamCaption})}

\index{interpreter.cpp@{interpreter.cpp}!FindAndDelete@{FindAndDelete}}
\index{FindAndDelete@{FindAndDelete}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{FindAndDelete()}
{\footnotesize\ttfamily \label{interpreter_8cpp_a4bbdb5f5fcbbe292942cb74ee15ab3df} 
int Find\+And\+Delete (\begin{DoxyParamCaption}\item[{\textbf{ CScript} \&}]{script}{, }\item[{const \textbf{ CScript} \&}]{b}{}\end{DoxyParamCaption})}

\index{interpreter.cpp@{interpreter.cpp}!GetScriptFlagNames@{GetScriptFlagNames}}
\index{GetScriptFlagNames@{GetScriptFlagNames}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{GetScriptFlagNames()}
{\footnotesize\ttfamily \label{interpreter_8cpp_a9441a16c1b62f46ef726492157bf48ec} 
std\+::vector$<$ std\+::string $>$ Get\+Script\+Flag\+Names (\begin{DoxyParamCaption}\item[{\textbf{ script\+\_\+verify\+\_\+flags}}]{flags}{}\end{DoxyParamCaption})}

\index{interpreter.cpp@{interpreter.cpp}!ScriptFlagNamesToEnum@{ScriptFlagNamesToEnum}}
\index{ScriptFlagNamesToEnum@{ScriptFlagNamesToEnum}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{ScriptFlagNamesToEnum()}
{\footnotesize\ttfamily \label{interpreter_8cpp_a0ddb94c635fc3e1b47d5631ac557925f} 
const std\+::map$<$ std\+::string, \textbf{ script\+\_\+verify\+\_\+flag\+\_\+name} $>$ \& Script\+Flag\+Names\+To\+Enum (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

\index{interpreter.cpp@{interpreter.cpp}!SignatureHash@{SignatureHash}}
\index{SignatureHash@{SignatureHash}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{SignatureHash()}
{\footnotesize\ttfamily \label{interpreter_8cpp_a63c4884dd720c4d306603998b5d02b49} 
template$<$class \textbf{ T}$>$ \\
\textbf{ uint256} Signature\+Hash (\begin{DoxyParamCaption}\item[{const \textbf{ CScript} \&}]{script\+Code}{, }\item[{const \textbf{ T} \&}]{tx\+To}{, }\item[{unsigned int}]{n\+In}{, }\item[{int32\+\_\+t}]{n\+Hash\+Type}{, }\item[{const \textbf{ CAmount} \&}]{amount}{, }\item[{\textbf{ Sig\+Version}}]{sigversion}{, }\item[{const \textbf{ Precomputed\+Transaction\+Data} $\ast$}]{cache}{, }\item[{\textbf{ Sig\+Hash\+Cache} $\ast$}]{sighash\+\_\+cache}{}\end{DoxyParamCaption})}

\index{interpreter.cpp@{interpreter.cpp}!SignatureHashSchnorr@{SignatureHashSchnorr}}
\index{SignatureHashSchnorr@{SignatureHashSchnorr}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{SignatureHashSchnorr()}
{\footnotesize\ttfamily \label{interpreter_8cpp_a1820ab094aadaa6bc34ff9ef9ee54cb4} 
template$<$typename \textbf{ T}$>$ \\
bool Signature\+Hash\+Schnorr (\begin{DoxyParamCaption}\item[{\textbf{ uint256} \&}]{hash\+\_\+out}{, }\item[{\textbf{ Script\+Execution\+Data} \&}]{execdata}{, }\item[{const \textbf{ T} \&}]{tx\+\_\+to}{, }\item[{uint32\+\_\+t}]{in\+\_\+pos}{, }\item[{uint8\+\_\+t}]{hash\+\_\+type}{, }\item[{\textbf{ Sig\+Version}}]{sigversion}{, }\item[{const \textbf{ Precomputed\+Transaction\+Data} \&}]{cache}{, }\item[{\textbf{ Missing\+Data\+Behavior}}]{mdb}{}\end{DoxyParamCaption})}

\index{interpreter.cpp@{interpreter.cpp}!VerifyScript@{VerifyScript}}
\index{VerifyScript@{VerifyScript}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{VerifyScript()}
{\footnotesize\ttfamily \label{interpreter_8cpp_acdeac884f2fbcea533277458e8097e87} 
bool Verify\+Script (\begin{DoxyParamCaption}\item[{const \textbf{ CScript} \&}]{script\+Sig}{, }\item[{const \textbf{ CScript} \&}]{script\+Pub\+Key}{, }\item[{const \textbf{ CScript\+Witness} $\ast$}]{witness}{, }\item[{\textbf{ script\+\_\+verify\+\_\+flags}}]{flags}{, }\item[{const \textbf{ Base\+Signature\+Checker} \&}]{checker}{, }\item[{\textbf{ Script\+Error} $\ast$}]{serror}{}\end{DoxyParamCaption})}



\label{doc-var-members}
\doxysubsection{Variable Documentation}
\index{interpreter.cpp@{interpreter.cpp}!HASHER\_TAPBRANCH@{HASHER\_TAPBRANCH}}
\index{HASHER\_TAPBRANCH@{HASHER\_TAPBRANCH}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{HASHER\_TAPBRANCH}
{\footnotesize\ttfamily \label{interpreter_8cpp_a4bfefed0911b1550701fb2ceba3a7f14} 
const \textbf{ Hash\+Writer} HASHER\+\_\+\+TAPBRANCH \{\textbf{ Tagged\+Hash}("{}Tap\+Branch"{})\}}



Hasher with tag "{}\+Tap\+Branch"{} pre-\/fed to it. 

\index{interpreter.cpp@{interpreter.cpp}!HASHER\_TAPLEAF@{HASHER\_TAPLEAF}}
\index{HASHER\_TAPLEAF@{HASHER\_TAPLEAF}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{HASHER\_TAPLEAF}
{\footnotesize\ttfamily \label{interpreter_8cpp_ab013e94f9b90b53624381ca6c988bcd6} 
const \textbf{ Hash\+Writer} HASHER\+\_\+\+TAPLEAF \{\textbf{ Tagged\+Hash}("{}Tap\+Leaf"{})\}}



Hasher with tag "{}\+Tap\+Leaf"{} pre-\/fed to it. 

\index{interpreter.cpp@{interpreter.cpp}!HASHER\_TAPSIGHASH@{HASHER\_TAPSIGHASH}}
\index{HASHER\_TAPSIGHASH@{HASHER\_TAPSIGHASH}!interpreter.cpp@{interpreter.cpp}}
\doxysubsubsection{HASHER\_TAPSIGHASH}
{\footnotesize\ttfamily \label{interpreter_8cpp_afd30273018b78da94973828219048a5e} 
const \textbf{ Hash\+Writer} HASHER\+\_\+\+TAPSIGHASH \{\textbf{ Tagged\+Hash}("{}Tap\+Sighash"{})\}}



Hasher with tag "{}\+Tap\+Sighash"{} pre-\/fed to it. 

