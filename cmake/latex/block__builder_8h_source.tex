\doxysection{block\+\_\+builder.\+h}
\label{block__builder_8h_source}\index{src/leveldb/table/block\_builder.h@{src/leveldb/table/block\_builder.h}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (c)\ 2011\ The\ LevelDB\ Authors.\ All\ rights\ reserved.}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Use\ of\ this\ source\ code\ is\ governed\ by\ a\ BSD-\/style\ license\ that\ can\ be}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ found\ in\ the\ LICENSE\ file.\ See\ the\ AUTHORS\ file\ for\ names\ of\ contributors.}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#ifndef\ STORAGE\_LEVELDB\_TABLE\_BLOCK\_BUILDER\_H\_}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#define\ STORAGE\_LEVELDB\_TABLE\_BLOCK\_BUILDER\_H\_}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <stdint.h>}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}leveldb/slice.h"{}}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{keyword}{namespace\ }leveldb\ \{}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{keyword}{struct\ }Options;}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{class\ }BlockBuilder\ \{}
\DoxyCodeLine{00019\ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00020\ \ \ \textcolor{keyword}{explicit}\ BlockBuilder(\textcolor{keyword}{const}\ Options*\ options);}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \ \ BlockBuilder(\textcolor{keyword}{const}\ BlockBuilder\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00023\ \ \ BlockBuilder\&\ operator=(\textcolor{keyword}{const}\ BlockBuilder\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \ \ \textcolor{comment}{//\ Reset\ the\ contents\ as\ if\ the\ BlockBuilder\ was\ just\ constructed.}}
\DoxyCodeLine{00026\ \ \ \textcolor{keywordtype}{void}\ Reset();}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \textcolor{comment}{//\ REQUIRES:\ Finish()\ has\ not\ been\ called\ since\ the\ last\ call\ to\ Reset().}}
\DoxyCodeLine{00029\ \ \ \textcolor{comment}{//\ REQUIRES:\ key\ is\ larger\ than\ any\ previously\ added\ key}}
\DoxyCodeLine{00030\ \ \ \textcolor{keywordtype}{void}\ Add(\textcolor{keyword}{const}\ Slice\&\ key,\ \textcolor{keyword}{const}\ Slice\&\ value);}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \ \ \textcolor{comment}{//\ Finish\ building\ the\ block\ and\ return\ a\ slice\ that\ refers\ to\ the}}
\DoxyCodeLine{00033\ \ \ \textcolor{comment}{//\ block\ contents.\ \ The\ returned\ slice\ will\ remain\ valid\ for\ the}}
\DoxyCodeLine{00034\ \ \ \textcolor{comment}{//\ lifetime\ of\ this\ builder\ or\ until\ Reset()\ is\ called.}}
\DoxyCodeLine{00035\ \ \ Slice\ Finish();}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \textcolor{comment}{//\ Returns\ an\ estimate\ of\ the\ current\ (uncompressed)\ size\ of\ the\ block}}
\DoxyCodeLine{00038\ \ \ \textcolor{comment}{//\ we\ are\ building.}}
\DoxyCodeLine{00039\ \ \ \textcolor{keywordtype}{size\_t}\ CurrentSizeEstimate()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \textcolor{comment}{//\ Return\ true\ iff\ no\ entries\ have\ been\ added\ since\ the\ last\ Reset()}}
\DoxyCodeLine{00042\ \ \ \textcolor{keywordtype}{bool}\ empty()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ buffer\_.empty();\ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00045\ \ \ \textcolor{keyword}{const}\ Options*\ options\_;}
\DoxyCodeLine{00046\ \ \ std::string\ buffer\_;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Destination\ buffer}}
\DoxyCodeLine{00047\ \ \ std::vector<uint32\_t>\ restarts\_;\ \ \textcolor{comment}{//\ Restart\ points}}
\DoxyCodeLine{00048\ \ \ \textcolor{keywordtype}{int}\ counter\_;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Number\ of\ entries\ emitted\ since\ restart}}
\DoxyCodeLine{00049\ \ \ \textcolor{keywordtype}{bool}\ finished\_;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Has\ Finish()\ been\ called?}}
\DoxyCodeLine{00050\ \ \ std::string\ last\_key\_;}
\DoxyCodeLine{00051\ \};}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \}\ \ \textcolor{comment}{//\ namespace\ leveldb}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ STORAGE\_LEVELDB\_TABLE\_BLOCK\_BUILDER\_H\_}}

\end{DoxyCode}
