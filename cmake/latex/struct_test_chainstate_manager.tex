\doxysection{Test\+Chainstate\+Manager Struct Reference}
\label{struct_test_chainstate_manager}\index{TestChainstateManager@{TestChainstateManager}}


{\ttfamily \#include $<$validation.\+h$>$}

Inheritance diagram for Test\+Chainstate\+Manager\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{struct_test_chainstate_manager}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \textbf{ Disable\+Next\+Write} ()
\item 
void \textbf{ Reset\+Ibd} ()
\item 
void \textbf{ Jump\+Out\+Of\+Ibd} ()
\item 
void \textbf{ Invalid\+Block\+Found} (\textbf{ CBlock\+Index} $\ast$pindex, const \textbf{ Block\+Validation\+State} \&state) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ cs\+\_\+main})
\item 
void \textbf{ Invalid\+Chain\+Found} (\textbf{ CBlock\+Index} $\ast$pindex\+New) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ cs\+\_\+main})
\item 
\textbf{ CBlock\+Index} $\ast$ \textbf{ Find\+Most\+Work\+Chain} () \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ cs\+\_\+main})
\item 
void \textbf{ Reset\+Best\+Invalid} () \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ cs\+\_\+main})
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \textbf{ Chainstate\+Manager}}
\begin{DoxyCompactItemize}
\item 
\textbf{ Chainstate\+Manager} (const \textbf{ util\+::\+Signal\+Interrupt} \&interrupt, \textbf{ Options}\textbf{ Options} options, \textbf{ node\+::\+Block\+Manager\+::\+Options} blockman\+\_\+options)
\item 
const \textbf{ CChain\+Params} \& \textbf{ Get\+Params} () const
\item 
const \textbf{ Consensus\+::\+Params} \& \textbf{ Get\+Consensus} () const
\item 
bool \textbf{ Should\+Check\+Block\+Index} () const
\item 
const \textbf{ arith\+\_\+uint256} \& \textbf{ Minimum\+Chain\+Work} () const
\item 
const \textbf{ uint256} \& \textbf{ Assumed\+Valid\+Block} () const
\item 
\textbf{ kernel\+::\+Notifications} \& \textbf{ Get\+Notifications} () const
\item 
void \textbf{ Check\+Block\+Index} () const
\item 
\textbf{ Recursive\+Mutex} \& \textbf{ Get\+Mutex} () const \textbf{ LOCK\+\_\+\+RETURNED}(
\item 
int32\+\_\+t n\+Block\+Sequence\+Id \textbf{ GUARDED\+\_\+\+BY} (\textbf{ \+::cs\+\_\+main})
\item 
void \textbf{ Reset\+Block\+Sequence\+Counters} () \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(
\item 
\textbf{ CBlock\+Index} $\ast$m\+\_\+best\+\_\+header \textbf{ GUARDED\+\_\+\+BY} (\textbf{ \+::cs\+\_\+main})
\item 
\textbf{ Chainstate} $\ast$ \textbf{ Historical\+Chainstate} () const \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ Get\+Mutex}())
\begin{DoxyCompactList}\small\item\em Return historical chainstate targeting a specific block, if any. \end{DoxyCompactList}\item 
\textbf{ Chainstate} \& \textbf{ Validated\+Chainstate} () const \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ Get\+Mutex}())
\item 
std\+::unique\+\_\+ptr$<$ \textbf{ Chainstate} $>$ \textbf{ Remove\+Chainstate} (\textbf{ Chainstate} \&chainstate) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ Get\+Mutex}())
\begin{DoxyCompactList}\small\item\em Remove a chainstate. \end{DoxyCompactList}\item 
\textbf{ node\+::\+Block\+Map} \& \textbf{ Block\+Index} () \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(
\item 
bool \textbf{ Is\+Initial\+Block\+Download} () const
\item 
double \textbf{ Guess\+Verification\+Progress} (const \textbf{ CBlock\+Index} $\ast$pindex) const \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ Get\+Mutex}())
\item 
void \textbf{ Load\+External\+Block\+File} (\textbf{ Auto\+File} \&file\+\_\+in, \textbf{ Flat\+File\+Pos} $\ast$dbp=nullptr, std\+::multimap$<$ \textbf{ uint256}, \textbf{ Flat\+File\+Pos} $>$ $\ast$blocks\+\_\+with\+\_\+unknown\+\_\+parent=nullptr)
\item 
bool \textbf{ Process\+New\+Block} (const std\+::shared\+\_\+ptr$<$ const \textbf{ CBlock} $>$ \&block, bool force\+\_\+processing, bool min\+\_\+pow\+\_\+checked, bool $\ast$new\+\_\+block) \textbf{ LOCKS\+\_\+\+EXCLUDED}(\textbf{ cs\+\_\+main})
\item 
bool \textbf{ Process\+New\+Block\+Headers} (std\+::span$<$ const \textbf{ CBlock\+Header} $>$ headers, bool min\+\_\+pow\+\_\+checked, \textbf{ Block\+Validation\+State} \&state, const \textbf{ CBlock\+Index} $\ast$$\ast$ppindex=nullptr) \textbf{ LOCKS\+\_\+\+EXCLUDED}(\textbf{ cs\+\_\+main})
\item 
bool \textbf{ Accept\+Block} (const std\+::shared\+\_\+ptr$<$ const \textbf{ CBlock} $>$ \&pblock, \textbf{ Block\+Validation\+State} \&state, \textbf{ CBlock\+Index} $\ast$$\ast$ppindex, bool f\+Requested, const \textbf{ Flat\+File\+Pos} $\ast$dbp, bool $\ast$f\+New\+Block, bool min\+\_\+pow\+\_\+checked) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ cs\+\_\+main})
\item 
void \textbf{ Received\+Block\+Transactions} (const \textbf{ CBlock} \&block, \textbf{ CBlock\+Index} $\ast$pindex\+New, const \textbf{ Flat\+File\+Pos} \&pos) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ cs\+\_\+main})
\item 
\textbf{ Mempool\+Accept\+Result} \textbf{ Process\+Transaction} (const \textbf{ CTransaction\+Ref} \&tx, bool test\+\_\+accept=false) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ cs\+\_\+main})
\item 
bool \textbf{ Load\+Block\+Index} () \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ cs\+\_\+main})
\begin{DoxyCompactList}\small\item\em Load the block tree and coins database from disk, initializing state if we\textquotesingle{}re running with -\/reindex. \end{DoxyCompactList}\item 
void Maybe\+Rebalance\+Caches() \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(void \textbf{ Update\+Uncommitted\+Block\+Structures} (\textbf{ CBlock} \&block, const \textbf{ CBlock\+Index} $\ast$pindex\+Prev) const
\item 
std\+::vector$<$ unsigned char $>$ \textbf{ Generate\+Coinbase\+Commitment} (\textbf{ CBlock} \&block, const \textbf{ CBlock\+Index} $\ast$pindex\+Prev) const
\item 
void \textbf{ Report\+Headers\+Presync} (const \textbf{ arith\+\_\+uint256} \&work, int64\+\_\+t height, int64\+\_\+t timestamp)
\item 
\textbf{ $\sim$\+Chainstate\+Manager} ()
\item 
std\+::vector$<$ std\+::unique\+\_\+ptr$<$ \textbf{ Chainstate} $>$ $>$ m\+\_\+chainstates \textbf{ GUARDED\+\_\+\+BY} (\textbf{ \+::cs\+\_\+main})
\end{DoxyCompactItemize}
\begin{DoxyCompactItemize}
\item 
\textbf{ Chainstate} \& \textbf{ Active\+Chainstate} () const
\item 
\textbf{ CChain} \& \textbf{ Active\+Chain} () const \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ Get\+Mutex}())
\item 
int \textbf{ Active\+Height} () const \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ Get\+Mutex}())
\item 
\textbf{ CBlock\+Index} $\ast$ \textbf{ Active\+Tip} () const \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ Get\+Mutex}())
\end{DoxyCompactItemize}
\doxysubsubsection*{Additional Inherited Members}
\doxysubsection*{Public Types inherited from \textbf{ Chainstate\+Manager}}
\begin{DoxyCompactItemize}
\item 
using \textbf{ Options} = \textbf{ kernel\+::\+Chainstate\+Manager\+Opts}
\end{DoxyCompactItemize}
\doxysubsection*{Data Fields inherited from \textbf{ Chainstate\+Manager}}
\begin{DoxyCompactItemize}
\item 
std\+::function$<$ void()$>$ \textbf{ snapshot\+\_\+download\+\_\+completed} = std\+::function$<$void()$>$()
\item 
const \textbf{ util\+::\+Signal\+Interrupt} \& \textbf{ m\+\_\+interrupt}
\item 
const \textbf{ Options}\textbf{ Options} \textbf{ m\+\_\+options}
\item 
\textbf{ node\+::\+Block\+Manager} \textbf{ m\+\_\+blockman}
\item 
\textbf{ Validation\+Cache} \textbf{ m\+\_\+validation\+\_\+cache}
\item 
std\+::atomic$<$ bool $>$ \textbf{ m\+\_\+cached\+\_\+finished\+\_\+ibd} \{false\}
\item 
int32\+\_\+t \textbf{ n\+Block\+Reverse\+Sequence\+Id} = -\/1
\item 
\textbf{ arith\+\_\+uint256} \textbf{ n\+Last\+Precious\+Chainwork} = 0
\item 
size\+\_\+t \textbf{ m\+\_\+total\+\_\+coinstip\+\_\+cache} \{0\}
\item 
size\+\_\+t \textbf{ m\+\_\+total\+\_\+coinsdb\+\_\+cache} \{0\}
\item 
\textbf{ Chainstate} \&Initialize\+Chainstate(\textbf{ CTx\+Mem\+Pool} $\ast$mempool) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ util\+::\+Result}$<$ \textbf{ CBlock\+Index} $\ast$ \textbf{ Activate\+Snapshot} )(\textbf{ Auto\+File} \&coins\+\_\+file, const \textbf{ node\+::\+Snapshot\+Metadata} \&metadata, bool in\+\_\+memory)
\item 
\textbf{ Snapshot\+Completion\+Result} Maybe\+Validate\+Snapshot(\textbf{ Chainstate} \&validated\+\_\+cs, \textbf{ Chainstate} \&unvalidated\+\_\+cs) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ Chainstate} \textbf{ Current\+Chainstate} )() const \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ Get\+Mutex}())
\begin{DoxyCompactList}\small\item\em Return current chainstate targeting the most-\/work, network tip. \end{DoxyCompactList}\item 
\textbf{ Version\+Bits\+Cache} \textbf{ m\+\_\+versionbitscache}
\item 
\textbf{ Chainstate} $\ast$Load\+Assumeutxo\+Chainstate() \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ Chainstate} \&Add\+Chainstate(std\+::unique\+\_\+ptr$<$ \textbf{ Chainstate} $>$ chainstate) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(void Reset\+Chainstates() \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(bool Delete\+Chainstate(\textbf{ Chainstate} \&chainstate) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(bool Validated\+Snapshot\+Cleanup(\textbf{ Chainstate} \&validated\+\_\+cs, \textbf{ Chainstate} \&unvalidated\+\_\+cs) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(std\+::optional$<$ std\+::pair$<$ const \textbf{ CBlock\+Index} $\ast$, const \textbf{ CBlock\+Index} $\ast$ $>$ $>$ Get\+Historical\+Block\+Range() const \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ util\+::\+Result}$<$ void $>$ Activate\+Best\+Chains() \textbf{ LOCKS\+\_\+\+EXCLUDED}(void Recalculate\+Best\+Header() \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ CCheck\+Queue}$<$ \textbf{ CScript\+Check} $>$ \textbf{ Get\+Check\+Queue} )()
\begin{DoxyCompactList}\small\item\em Add new chainstate. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Protected Member Functions inherited from \textbf{ Chainstate\+Manager}}
\begin{DoxyCompactItemize}
\item 
\textbf{ CBlock\+Index} $\ast$m\+\_\+best\+\_\+invalid \textbf{ GUARDED\+\_\+\+BY} (\textbf{ \+::cs\+\_\+main})
\end{DoxyCompactItemize}


\label{doc-func-members}
\doxysubsection{Member Function Documentation}
\index{TestChainstateManager@{TestChainstateManager}!DisableNextWrite@{DisableNextWrite}}
\index{DisableNextWrite@{DisableNextWrite}!TestChainstateManager@{TestChainstateManager}}
\doxysubsubsection{DisableNextWrite()}
{\footnotesize\ttfamily \label{struct_test_chainstate_manager_afb2d8617c16a9709dafba590e8bc9bac} 
void Disable\+Next\+Write (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

Disable the next write of all chainstates \index{TestChainstateManager@{TestChainstateManager}!FindMostWorkChain@{FindMostWorkChain}}
\index{FindMostWorkChain@{FindMostWorkChain}!TestChainstateManager@{TestChainstateManager}}
\doxysubsubsection{FindMostWorkChain()}
{\footnotesize\ttfamily \label{struct_test_chainstate_manager_aa9ca3194eec690da7453dfb54549f554} 
\textbf{ CBlock\+Index} $\ast$ Find\+Most\+Work\+Chain (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

\index{TestChainstateManager@{TestChainstateManager}!InvalidBlockFound@{InvalidBlockFound}}
\index{InvalidBlockFound@{InvalidBlockFound}!TestChainstateManager@{TestChainstateManager}}
\doxysubsubsection{InvalidBlockFound()}
{\footnotesize\ttfamily \label{struct_test_chainstate_manager_a9c5078a4a04331cc35d986500a8b30b1} 
void Invalid\+Block\+Found (\begin{DoxyParamCaption}\item[{\textbf{ CBlock\+Index} $\ast$}]{pindex}{, }\item[{const \textbf{ Block\+Validation\+State} \&}]{state}{}\end{DoxyParamCaption})}

Wrappers that avoid making chainstatemanager internals public for tests \index{TestChainstateManager@{TestChainstateManager}!InvalidChainFound@{InvalidChainFound}}
\index{InvalidChainFound@{InvalidChainFound}!TestChainstateManager@{TestChainstateManager}}
\doxysubsubsection{InvalidChainFound()}
{\footnotesize\ttfamily \label{struct_test_chainstate_manager_acd1f6fc8d7b53d55405ed6107ef693ad} 
void Invalid\+Chain\+Found (\begin{DoxyParamCaption}\item[{\textbf{ CBlock\+Index} $\ast$}]{pindex\+New}{}\end{DoxyParamCaption})}

\index{TestChainstateManager@{TestChainstateManager}!JumpOutOfIbd@{JumpOutOfIbd}}
\index{JumpOutOfIbd@{JumpOutOfIbd}!TestChainstateManager@{TestChainstateManager}}
\doxysubsubsection{JumpOutOfIbd()}
{\footnotesize\ttfamily \label{struct_test_chainstate_manager_a3362b9586b4c8f610e54f9048c578a2e} 
void Jump\+Out\+Of\+Ibd (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

Toggle Is\+Initial\+Block\+Download from true to false \index{TestChainstateManager@{TestChainstateManager}!ResetBestInvalid@{ResetBestInvalid}}
\index{ResetBestInvalid@{ResetBestInvalid}!TestChainstateManager@{TestChainstateManager}}
\doxysubsubsection{ResetBestInvalid()}
{\footnotesize\ttfamily \label{struct_test_chainstate_manager_a945c69a8676d186e1e0d1cb5e4672dda} 
void Reset\+Best\+Invalid (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

\index{TestChainstateManager@{TestChainstateManager}!ResetIbd@{ResetIbd}}
\index{ResetIbd@{ResetIbd}!TestChainstateManager@{TestChainstateManager}}
\doxysubsubsection{ResetIbd()}
{\footnotesize\ttfamily \label{struct_test_chainstate_manager_a619e980f0c6959cfc22539b6b6d59780} 
void Reset\+Ibd (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

Reset the ibd cache to its initial state 

The documentation for this struct was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
src/test/util/\textbf{ validation.\+h}\item 
src/test/util/\textbf{ validation.\+cpp}\end{DoxyCompactItemize}
