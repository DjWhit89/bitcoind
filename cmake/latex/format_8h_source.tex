\doxysection{format.\+h}
\label{format_8h_source}\index{src/leveldb/table/format.h@{src/leveldb/table/format.h}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (c)\ 2011\ The\ LevelDB\ Authors.\ All\ rights\ reserved.}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Use\ of\ this\ source\ code\ is\ governed\ by\ a\ BSD-\/style\ license\ that\ can\ be}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ found\ in\ the\ LICENSE\ file.\ See\ the\ AUTHORS\ file\ for\ names\ of\ contributors.}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#ifndef\ STORAGE\_LEVELDB\_TABLE\_FORMAT\_H\_}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#define\ STORAGE\_LEVELDB\_TABLE\_FORMAT\_H\_}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <stdint.h>}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}leveldb/slice.h"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}leveldb/status.h"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}leveldb/table\_builder.h"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{keyword}{namespace\ }leveldb\ \{}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{class\ }Block;}
\DoxyCodeLine{00019\ \textcolor{keyword}{class\ }RandomAccessFile;}
\DoxyCodeLine{00020\ \textcolor{keyword}{struct\ }ReadOptions;}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{comment}{//\ BlockHandle\ is\ a\ pointer\ to\ the\ extent\ of\ a\ file\ that\ stores\ a\ data}}
\DoxyCodeLine{00023\ \textcolor{comment}{//\ block\ or\ a\ meta\ block.}}
\DoxyCodeLine{00024\ \textcolor{keyword}{class\ }BlockHandle\ \{}
\DoxyCodeLine{00025\ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00026\ \ \ \textcolor{comment}{//\ Maximum\ encoding\ length\ of\ a\ BlockHandle}}
\DoxyCodeLine{00027\ \ \ \textcolor{keyword}{enum}\ \{\ kMaxEncodedLength\ =\ 10\ +\ 10\ \};}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \ \ BlockHandle();}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \ \ \textcolor{comment}{//\ The\ offset\ of\ the\ block\ in\ the\ file.}}
\DoxyCodeLine{00032\ \ \ uint64\_t\ offset()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ offset\_;\ \}}
\DoxyCodeLine{00033\ \ \ \textcolor{keywordtype}{void}\ set\_offset(uint64\_t\ offset)\ \{\ offset\_\ =\ offset;\ \}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \ \ \textcolor{comment}{//\ The\ size\ of\ the\ stored\ block}}
\DoxyCodeLine{00036\ \ \ uint64\_t\ size()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ size\_;\ \}}
\DoxyCodeLine{00037\ \ \ \textcolor{keywordtype}{void}\ set\_size(uint64\_t\ size)\ \{\ size\_\ =\ size;\ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \textcolor{keywordtype}{void}\ EncodeTo(std::string*\ dst)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00040\ \ \ Status\ DecodeFrom(Slice*\ input);}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00043\ \ \ uint64\_t\ offset\_;}
\DoxyCodeLine{00044\ \ \ uint64\_t\ size\_;}
\DoxyCodeLine{00045\ \};}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \textcolor{comment}{//\ Footer\ encapsulates\ the\ fixed\ information\ stored\ at\ the\ tail}}
\DoxyCodeLine{00048\ \textcolor{comment}{//\ end\ of\ every\ table\ file.}}
\DoxyCodeLine{00049\ \textcolor{keyword}{class\ }Footer\ \{}
\DoxyCodeLine{00050\ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00051\ \ \ \textcolor{comment}{//\ Encoded\ length\ of\ a\ Footer.\ \ Note\ that\ the\ serialization\ of\ a}}
\DoxyCodeLine{00052\ \ \ \textcolor{comment}{//\ Footer\ will\ always\ occupy\ exactly\ this\ many\ bytes.\ \ It\ consists}}
\DoxyCodeLine{00053\ \ \ \textcolor{comment}{//\ of\ two\ block\ handles\ and\ a\ magic\ number.}}
\DoxyCodeLine{00054\ \ \ \textcolor{keyword}{enum}\ \{\ kEncodedLength\ =\ 2\ *\ BlockHandle::kMaxEncodedLength\ +\ 8\ \};}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ Footer()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \textcolor{comment}{//\ The\ block\ handle\ for\ the\ metaindex\ block\ of\ the\ table}}
\DoxyCodeLine{00059\ \ \ \textcolor{keyword}{const}\ BlockHandle\&\ metaindex\_handle()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ metaindex\_handle\_;\ \}}
\DoxyCodeLine{00060\ \ \ \textcolor{keywordtype}{void}\ set\_metaindex\_handle(\textcolor{keyword}{const}\ BlockHandle\&\ h)\ \{\ metaindex\_handle\_\ =\ h;\ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \textcolor{comment}{//\ The\ block\ handle\ for\ the\ index\ block\ of\ the\ table}}
\DoxyCodeLine{00063\ \ \ \textcolor{keyword}{const}\ BlockHandle\&\ index\_handle()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ index\_handle\_;\ \}}
\DoxyCodeLine{00064\ \ \ \textcolor{keywordtype}{void}\ set\_index\_handle(\textcolor{keyword}{const}\ BlockHandle\&\ h)\ \{\ index\_handle\_\ =\ h;\ \}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \textcolor{keywordtype}{void}\ EncodeTo(std::string*\ dst)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00067\ \ \ Status\ DecodeFrom(Slice*\ input);}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00070\ \ \ BlockHandle\ metaindex\_handle\_;}
\DoxyCodeLine{00071\ \ \ BlockHandle\ index\_handle\_;}
\DoxyCodeLine{00072\ \};}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \textcolor{comment}{//\ kTableMagicNumber\ was\ picked\ by\ running}}
\DoxyCodeLine{00075\ \textcolor{comment}{//\ \ \ \ echo\ http://code.google.com/p/leveldb/\ |\ sha1sum}}
\DoxyCodeLine{00076\ \textcolor{comment}{//\ and\ taking\ the\ leading\ 64\ bits.}}
\DoxyCodeLine{00077\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ uint64\_t\ kTableMagicNumber\ =\ 0xdb4775248b80fb57ull;}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \textcolor{comment}{//\ 1-\/byte\ type\ +\ 32-\/bit\ crc}}
\DoxyCodeLine{00080\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ kBlockTrailerSize\ =\ 5;}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \textcolor{keyword}{struct\ }BlockContents\ \{}
\DoxyCodeLine{00083\ \ \ Slice\ data;\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Actual\ contents\ of\ data}}
\DoxyCodeLine{00084\ \ \ \textcolor{keywordtype}{bool}\ cachable;\ \ \ \ \ \ \ \ \textcolor{comment}{//\ True\ iff\ data\ can\ be\ cached}}
\DoxyCodeLine{00085\ \ \ \textcolor{keywordtype}{bool}\ heap\_allocated;\ \ \textcolor{comment}{//\ True\ iff\ caller\ should\ delete[]\ data.data()}}
\DoxyCodeLine{00086\ \};}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \textcolor{comment}{//\ Read\ the\ block\ identified\ by\ "{}handle"{}\ from\ "{}file"{}.\ \ On\ failure}}
\DoxyCodeLine{00089\ \textcolor{comment}{//\ return\ non-\/OK.\ \ On\ success\ fill\ *result\ and\ return\ OK.}}
\DoxyCodeLine{00090\ Status\ ReadBlock(RandomAccessFile*\ file,\ \textcolor{keyword}{const}\ ReadOptions\&\ options,}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ BlockHandle\&\ handle,\ BlockContents*\ result);}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \textcolor{comment}{//\ Implementation\ details\ follow.\ \ Clients\ should\ ignore,}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \textcolor{keyword}{inline}\ BlockHandle::BlockHandle()}
\DoxyCodeLine{00096\ \ \ \ \ :\ offset\_(\string~static\_cast<uint64\_t>(0)),\ size\_(\string~static\_cast<uint64\_t>(0))\ \{\}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \}\ \ \textcolor{comment}{//\ namespace\ leveldb}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ STORAGE\_LEVELDB\_TABLE\_FORMAT\_H\_}}

\end{DoxyCode}
