\doxysection{src/policy/packages.h File Reference}
\label{packages_8h}\index{src/policy/packages.h@{src/policy/packages.h}}
{\ttfamily \#include $<$consensus/consensus.\+h$>$}\newline
{\ttfamily \#include $<$consensus/validation.\+h$>$}\newline
{\ttfamily \#include $<$policy/policy.\+h$>$}\newline
{\ttfamily \#include $<$primitives/transaction.\+h$>$}\newline
{\ttfamily \#include $<$util/hasher.\+h$>$}\newline
{\ttfamily \#include $<$cstdint$>$}\newline
{\ttfamily \#include $<$unordered\+\_\+set$>$}\newline
{\ttfamily \#include $<$vector$>$}\newline
\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
class \textbf{ Package\+Validation\+State}
\end{DoxyCompactItemize}
\doxysubsubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
using \textbf{ Package} = std\+::vector$<$\textbf{ CTransaction\+Ref}$>$
\end{DoxyCompactItemize}
\doxysubsubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum class \textbf{ Package\+Validation\+Result} \{ \textbf{ PCKG\+\_\+\+RESULT\+\_\+\+UNSET} = 0
, \textbf{ PCKG\+\_\+\+POLICY}
, \textbf{ PCKG\+\_\+\+TX}
, \textbf{ PCKG\+\_\+\+MEMPOOL\+\_\+\+ERROR}
 \}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
bool \textbf{ Is\+Topo\+Sorted\+Package} (const \textbf{ Package} \&txns)
\item 
bool \textbf{ Is\+Consistent\+Package} (const \textbf{ Package} \&txns)
\item 
bool \textbf{ Is\+Well\+Formed\+Package} (const \textbf{ Package} \&txns, \textbf{ Package\+Validation\+State} \&state, bool require\+\_\+sorted)
\item 
bool \textbf{ Is\+Child\+With\+Parents} (const \textbf{ Package} \&package)
\item 
bool \textbf{ Is\+Child\+With\+Parents\+Tree} (const \textbf{ Package} \&package)
\item 
\textbf{ uint256} \textbf{ Get\+Package\+Hash} (const std\+::vector$<$ \textbf{ CTransaction\+Ref} $>$ \&transactions)
\end{DoxyCompactItemize}


\label{doc-typedef-members}
\doxysubsection{Typedef Documentation}
\index{packages.h@{packages.h}!Package@{Package}}
\index{Package@{Package}!packages.h@{packages.h}}
\doxysubsubsection{Package}
{\footnotesize\ttfamily \label{packages_8h_a138b5dbe56c4869308e2bc7a28b51d9c} 
using \textbf{ Package} = std\+::vector$<$\textbf{ CTransaction\+Ref}$>$}

A package is an ordered list of transactions. The transactions cannot conflict with (spend the same inputs as) one another. 

\label{doc-enum-members}
\doxysubsection{Enumeration Type Documentation}
\index{packages.h@{packages.h}!PackageValidationResult@{PackageValidationResult}}
\index{PackageValidationResult@{PackageValidationResult}!packages.h@{packages.h}}
\doxysubsubsection{PackageValidationResult}
{\footnotesize\ttfamily \label{packages_8h_ae4232e3b34bac2d3729f3b4a7b274284} 
enum class \textbf{ Package\+Validation\+Result}\hspace{0.3cm}{\ttfamily [strong]}}

A "{}reason"{} why a package was invalid. It may be that one or more of the included transactions is invalid or the package itself violates our rules. We don\textquotesingle{}t distinguish between consensus and policy violations right now. \begin{DoxyEnumFields}[2]{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{PCKG\_RESULT\_UNSET@{PCKG\_RESULT\_UNSET}!packages.h@{packages.h}}\index{packages.h@{packages.h}!PCKG\_RESULT\_UNSET@{PCKG\_RESULT\_UNSET}}}\label{packages_8h_ae4232e3b34bac2d3729f3b4a7b274284ac04c3b2b4ef48d2fac20996e2ee75dbf} 
PCKG\+\_\+\+RESULT\+\_\+\+UNSET&Initial value. The package has not yet been rejected. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{PCKG\_POLICY@{PCKG\_POLICY}!packages.h@{packages.h}}\index{packages.h@{packages.h}!PCKG\_POLICY@{PCKG\_POLICY}}}\label{packages_8h_ae4232e3b34bac2d3729f3b4a7b274284a87a19a0e7858be85913a6cff1b1eab4e} 
PCKG\+\_\+\+POLICY&The package itself is invalid (e.\+g. too many transactions). \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{PCKG\_TX@{PCKG\_TX}!packages.h@{packages.h}}\index{packages.h@{packages.h}!PCKG\_TX@{PCKG\_TX}}}\label{packages_8h_ae4232e3b34bac2d3729f3b4a7b274284adeacea0c39c3a371628a2be46457c1e3} 
PCKG\+\_\+\+TX&At least one tx is invalid. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{PCKG\_MEMPOOL\_ERROR@{PCKG\_MEMPOOL\_ERROR}!packages.h@{packages.h}}\index{packages.h@{packages.h}!PCKG\_MEMPOOL\_ERROR@{PCKG\_MEMPOOL\_ERROR}}}\label{packages_8h_ae4232e3b34bac2d3729f3b4a7b274284acf51fdc18ab5c01c46605acc539f705b} 
PCKG\+\_\+\+MEMPOOL\+\_\+\+ERROR&Mempool logic error. \\
\hline

\end{DoxyEnumFields}


\label{doc-func-members}
\doxysubsection{Function Documentation}
\index{packages.h@{packages.h}!GetPackageHash@{GetPackageHash}}
\index{GetPackageHash@{GetPackageHash}!packages.h@{packages.h}}
\doxysubsubsection{GetPackageHash()}
{\footnotesize\ttfamily \label{packages_8h_ab2640b3a916f8801f16731e8d1f0798f} 
\textbf{ uint256} Get\+Package\+Hash (\begin{DoxyParamCaption}\item[{const std\+::vector$<$ \textbf{ CTransaction\+Ref} $>$ \&}]{transactions}{}\end{DoxyParamCaption})}

Get the hash of the concatenated wtxids of transactions, with wtxids treated as a little-\/endian numbers and sorted in ascending numeric order. \index{packages.h@{packages.h}!IsChildWithParents@{IsChildWithParents}}
\index{IsChildWithParents@{IsChildWithParents}!packages.h@{packages.h}}
\doxysubsubsection{IsChildWithParents()}
{\footnotesize\ttfamily \label{packages_8h_a0959b9a8f47d5ab16f0df8b80b0b488a} 
bool Is\+Child\+With\+Parents (\begin{DoxyParamCaption}\item[{const \textbf{ Package} \&}]{package}{}\end{DoxyParamCaption})}

Context-\/free check that a package is exactly one child and its parents; not all parents need to be present, but the package must not contain any transactions that are not the child\textquotesingle{}s parents. It is expected to be sorted, which means the last transaction must be the child. \index{packages.h@{packages.h}!IsChildWithParentsTree@{IsChildWithParentsTree}}
\index{IsChildWithParentsTree@{IsChildWithParentsTree}!packages.h@{packages.h}}
\doxysubsubsection{IsChildWithParentsTree()}
{\footnotesize\ttfamily \label{packages_8h_a7896d27359550efe70ad3a558cb6c6a3} 
bool Is\+Child\+With\+Parents\+Tree (\begin{DoxyParamCaption}\item[{const \textbf{ Package} \&}]{package}{}\end{DoxyParamCaption})}

Context-\/free check that a package \doxyref{Is\+Child\+With\+Parents()}{p.}{packages_8h_a0959b9a8f47d5ab16f0df8b80b0b488a} and none of the parents depend on each other (the package is a "{}tree"{}). \index{packages.h@{packages.h}!IsConsistentPackage@{IsConsistentPackage}}
\index{IsConsistentPackage@{IsConsistentPackage}!packages.h@{packages.h}}
\doxysubsubsection{IsConsistentPackage()}
{\footnotesize\ttfamily \label{packages_8h_a1dbc884090d3c8075d770bba50b02995} 
bool Is\+Consistent\+Package (\begin{DoxyParamCaption}\item[{const \textbf{ Package} \&}]{txns}{}\end{DoxyParamCaption})}

Checks that these transactions don\textquotesingle{}t conflict, i.\+e., spend the same prevout. This includes checking that there are no duplicate transactions. Since these checks require looking at the inputs of a transaction, returns false immediately if any transactions have empty vin.

Does not check consistency of a transaction with oneself; does not check if a transaction spends the same prevout multiple times (see bad-\/txns-\/inputs-\/duplicate in \doxyref{Check\+Transaction()}{p.}{tx__check_8cpp_ac015dec2b8cac7f01b1f53b78a80d854}).

\begin{DoxyReturn}{Returns}
true if there are no conflicts. False if any two transactions spend the same prevout. 
\end{DoxyReturn}
\index{packages.h@{packages.h}!IsTopoSortedPackage@{IsTopoSortedPackage}}
\index{IsTopoSortedPackage@{IsTopoSortedPackage}!packages.h@{packages.h}}
\doxysubsubsection{IsTopoSortedPackage()}
{\footnotesize\ttfamily \label{packages_8h_aed5aca63156deba997ae12650f2bf823} 
bool Is\+Topo\+Sorted\+Package (\begin{DoxyParamCaption}\item[{const \textbf{ Package} \&}]{txns}{}\end{DoxyParamCaption})}

If any direct dependencies exist between transactions (i.\+e. a child spending the output of a parent), checks that all parents appear somewhere in the list before their respective children. No other ordering is enforced. This function cannot detect indirect dependencies (e.\+g. a transaction\textquotesingle{}s grandparent if its parent is not present). \begin{DoxyReturn}{Returns}
true if sorted. False if any tx spends the output of a tx that appears later in txns. 
\end{DoxyReturn}
\index{packages.h@{packages.h}!IsWellFormedPackage@{IsWellFormedPackage}}
\index{IsWellFormedPackage@{IsWellFormedPackage}!packages.h@{packages.h}}
\doxysubsubsection{IsWellFormedPackage()}
{\footnotesize\ttfamily \label{packages_8h_a50f9cda6e16fa7ee7dff89e989948635} 
bool Is\+Well\+Formed\+Package (\begin{DoxyParamCaption}\item[{const \textbf{ Package} \&}]{txns}{, }\item[{\textbf{ Package\+Validation\+State} \&}]{state}{, }\item[{bool}]{require\+\_\+sorted}{}\end{DoxyParamCaption})}

Context-\/free package policy checks\+:
\begin{DoxyEnumerate}
\item The number of transactions cannot exceed MAX\+\_\+\+PACKAGE\+\_\+\+COUNT.
\item The total weight cannot exceed MAX\+\_\+\+PACKAGE\+\_\+\+WEIGHT.
\item If any dependencies exist between transactions, parents must appear before children.
\item Transactions cannot conflict, i.\+e., spend the same inputs. 
\end{DoxyEnumerate}