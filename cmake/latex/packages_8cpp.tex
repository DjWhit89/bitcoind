\doxysection{src/policy/packages.cpp File Reference}
\label{packages_8cpp}\index{src/policy/packages.cpp@{src/policy/packages.cpp}}
{\ttfamily \#include $<$policy/packages.\+h$>$}\newline
{\ttfamily \#include $<$policy/policy.\+h$>$}\newline
{\ttfamily \#include $<$primitives/transaction.\+h$>$}\newline
{\ttfamily \#include $<$uint256.\+h$>$}\newline
{\ttfamily \#include $<$util/check.\+h$>$}\newline
{\ttfamily \#include $<$algorithm$>$}\newline
{\ttfamily \#include $<$cassert$>$}\newline
{\ttfamily \#include $<$iterator$>$}\newline
{\ttfamily \#include $<$memory$>$}\newline
{\ttfamily \#include $<$numeric$>$}\newline
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
bool \textbf{ Is\+Topo\+Sorted\+Package} (const \textbf{ Package} \&txns, std\+::unordered\+\_\+set$<$ \textbf{ Txid}, \textbf{ Salted\+Txid\+Hasher} $>$ \&later\+\_\+txids)
\item 
bool \textbf{ Is\+Topo\+Sorted\+Package} (const \textbf{ Package} \&txns)
\item 
bool \textbf{ Is\+Consistent\+Package} (const \textbf{ Package} \&txns)
\item 
bool \textbf{ Is\+Well\+Formed\+Package} (const \textbf{ Package} \&txns, \textbf{ Package\+Validation\+State} \&state, bool require\+\_\+sorted)
\item 
bool \textbf{ Is\+Child\+With\+Parents} (const \textbf{ Package} \&package)
\item 
bool \textbf{ Is\+Child\+With\+Parents\+Tree} (const \textbf{ Package} \&package)
\item 
\textbf{ uint256} \textbf{ Get\+Package\+Hash} (const std\+::vector$<$ \textbf{ CTransaction\+Ref} $>$ \&transactions)
\end{DoxyCompactItemize}


\label{doc-func-members}
\doxysubsection{Function Documentation}
\index{packages.cpp@{packages.cpp}!GetPackageHash@{GetPackageHash}}
\index{GetPackageHash@{GetPackageHash}!packages.cpp@{packages.cpp}}
\doxysubsubsection{GetPackageHash()}
{\footnotesize\ttfamily \label{packages_8cpp_ab2640b3a916f8801f16731e8d1f0798f} 
\textbf{ uint256} Get\+Package\+Hash (\begin{DoxyParamCaption}\item[{const std\+::vector$<$ \textbf{ CTransaction\+Ref} $>$ \&}]{transactions}{}\end{DoxyParamCaption})}

Get the hash of the concatenated wtxids of transactions, with wtxids treated as a little-\/endian numbers and sorted in ascending numeric order. \index{packages.cpp@{packages.cpp}!IsChildWithParents@{IsChildWithParents}}
\index{IsChildWithParents@{IsChildWithParents}!packages.cpp@{packages.cpp}}
\doxysubsubsection{IsChildWithParents()}
{\footnotesize\ttfamily \label{packages_8cpp_a0959b9a8f47d5ab16f0df8b80b0b488a} 
bool Is\+Child\+With\+Parents (\begin{DoxyParamCaption}\item[{const \textbf{ Package} \&}]{package}{}\end{DoxyParamCaption})}

Context-\/free check that a package is exactly one child and its parents; not all parents need to be present, but the package must not contain any transactions that are not the child\textquotesingle{}s parents. It is expected to be sorted, which means the last transaction must be the child. \index{packages.cpp@{packages.cpp}!IsChildWithParentsTree@{IsChildWithParentsTree}}
\index{IsChildWithParentsTree@{IsChildWithParentsTree}!packages.cpp@{packages.cpp}}
\doxysubsubsection{IsChildWithParentsTree()}
{\footnotesize\ttfamily \label{packages_8cpp_a7896d27359550efe70ad3a558cb6c6a3} 
bool Is\+Child\+With\+Parents\+Tree (\begin{DoxyParamCaption}\item[{const \textbf{ Package} \&}]{package}{}\end{DoxyParamCaption})}

Context-\/free check that a package \doxyref{Is\+Child\+With\+Parents()}{p.}{packages_8h_a0959b9a8f47d5ab16f0df8b80b0b488a} and none of the parents depend on each other (the package is a "{}tree"{}). \index{packages.cpp@{packages.cpp}!IsConsistentPackage@{IsConsistentPackage}}
\index{IsConsistentPackage@{IsConsistentPackage}!packages.cpp@{packages.cpp}}
\doxysubsubsection{IsConsistentPackage()}
{\footnotesize\ttfamily \label{packages_8cpp_a1dbc884090d3c8075d770bba50b02995} 
bool Is\+Consistent\+Package (\begin{DoxyParamCaption}\item[{const \textbf{ Package} \&}]{txns}{}\end{DoxyParamCaption})}

Checks that these transactions don\textquotesingle{}t conflict, i.\+e., spend the same prevout. This includes checking that there are no duplicate transactions. Since these checks require looking at the inputs of a transaction, returns false immediately if any transactions have empty vin.

Does not check consistency of a transaction with oneself; does not check if a transaction spends the same prevout multiple times (see bad-\/txns-\/inputs-\/duplicate in \doxyref{Check\+Transaction()}{p.}{tx__check_8cpp_ac015dec2b8cac7f01b1f53b78a80d854}).

\begin{DoxyReturn}{Returns}
true if there are no conflicts. False if any two transactions spend the same prevout. 
\end{DoxyReturn}
\index{packages.cpp@{packages.cpp}!IsTopoSortedPackage@{IsTopoSortedPackage}}
\index{IsTopoSortedPackage@{IsTopoSortedPackage}!packages.cpp@{packages.cpp}}
\doxysubsubsection{IsTopoSortedPackage()\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \label{packages_8cpp_aed5aca63156deba997ae12650f2bf823} 
bool Is\+Topo\+Sorted\+Package (\begin{DoxyParamCaption}\item[{const \textbf{ Package} \&}]{txns}{}\end{DoxyParamCaption})}

If any direct dependencies exist between transactions (i.\+e. a child spending the output of a parent), checks that all parents appear somewhere in the list before their respective children. No other ordering is enforced. This function cannot detect indirect dependencies (e.\+g. a transaction\textquotesingle{}s grandparent if its parent is not present). \begin{DoxyReturn}{Returns}
true if sorted. False if any tx spends the output of a tx that appears later in txns. 
\end{DoxyReturn}
\index{packages.cpp@{packages.cpp}!IsTopoSortedPackage@{IsTopoSortedPackage}}
\index{IsTopoSortedPackage@{IsTopoSortedPackage}!packages.cpp@{packages.cpp}}
\doxysubsubsection{IsTopoSortedPackage()\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \label{packages_8cpp_a86cebe668567fe50dd364301eb97820a} 
bool Is\+Topo\+Sorted\+Package (\begin{DoxyParamCaption}\item[{const \textbf{ Package} \&}]{txns}{, }\item[{std\+::unordered\+\_\+set$<$ \textbf{ Txid}, \textbf{ Salted\+Txid\+Hasher} $>$ \&}]{later\+\_\+txids}{}\end{DoxyParamCaption})}

Is\+Topo\+Sorted\+Package where a set of txids has been pre-\/populated. The set is assumed to be correct and is mutated within this function (even if return value is false). \index{packages.cpp@{packages.cpp}!IsWellFormedPackage@{IsWellFormedPackage}}
\index{IsWellFormedPackage@{IsWellFormedPackage}!packages.cpp@{packages.cpp}}
\doxysubsubsection{IsWellFormedPackage()}
{\footnotesize\ttfamily \label{packages_8cpp_a50f9cda6e16fa7ee7dff89e989948635} 
bool Is\+Well\+Formed\+Package (\begin{DoxyParamCaption}\item[{const \textbf{ Package} \&}]{txns}{, }\item[{\textbf{ Package\+Validation\+State} \&}]{state}{, }\item[{bool}]{require\+\_\+sorted}{}\end{DoxyParamCaption})}

Context-\/free package policy checks\+:
\begin{DoxyEnumerate}
\item The number of transactions cannot exceed MAX\+\_\+\+PACKAGE\+\_\+\+COUNT.
\item The total weight cannot exceed MAX\+\_\+\+PACKAGE\+\_\+\+WEIGHT.
\item If any dependencies exist between transactions, parents must appear before children.
\item Transactions cannot conflict, i.\+e., spend the same inputs. 
\end{DoxyEnumerate}