\doxysection{validationinterface.\+h}
\label{validationinterface_8h_source}\index{src/validationinterface.h@{src/validationinterface.h}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (c)\ 2009-\/2010\ Satoshi\ Nakamoto}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Copyright\ (c)\ 2009-\/present\ The\ Bitcoin\ Core\ developers}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ Distributed\ under\ the\ MIT\ software\ license,\ see\ the\ accompanying}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ file\ COPYING\ or\ http://www.opensource.org/licenses/mit-\/license.php.}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#ifndef\ BITCOIN\_VALIDATIONINTERFACE\_H}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#define\ BITCOIN\_VALIDATIONINTERFACE\_H}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <kernel/cs\_main.h>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <primitives/transaction.h>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <sync.h>}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <cstddef>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <cstdint>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <functional>}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{keyword}{namespace\ }kernel\ \{}
\DoxyCodeLine{00020\ \textcolor{keyword}{struct\ }ChainstateRole;}
\DoxyCodeLine{00021\ \}\ \textcolor{comment}{//\ namespace\ kernel}}
\DoxyCodeLine{00022\ \textcolor{keyword}{namespace\ }util\ \{}
\DoxyCodeLine{00023\ \textcolor{keyword}{class\ }TaskRunnerInterface;}
\DoxyCodeLine{00024\ \}\ \textcolor{comment}{//\ namespace\ util}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{keyword}{class\ }BlockValidationState;}
\DoxyCodeLine{00027\ \textcolor{keyword}{class\ }CBlock;}
\DoxyCodeLine{00028\ \textcolor{keyword}{class\ }CBlockIndex;}
\DoxyCodeLine{00029\ \textcolor{keyword}{struct\ }CBlockLocator;}
\DoxyCodeLine{00030\ \textcolor{keyword}{enum\ class}\ MemPoolRemovalReason;}
\DoxyCodeLine{00031\ \textcolor{keyword}{struct\ }RemovedMempoolTransactionInfo;}
\DoxyCodeLine{00032\ \textcolor{keyword}{struct\ }NewMempoolTransactionInfo;}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00049\ \textcolor{keyword}{class\ }CValidationInterface\ \{}
\DoxyCodeLine{00050\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00055\ \ \ \ \ \string~CValidationInterface()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ UpdatedBlockTip(\textcolor{keyword}{const}\ CBlockIndex\ *pindexNew,\ \textcolor{keyword}{const}\ CBlockIndex\ *pindexFork,\ \textcolor{keywordtype}{bool}\ fInitialDownload)\ \{\}}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ ActiveTipChange(\textcolor{keyword}{const}\ CBlockIndex\&\ new\_tip,\ \textcolor{keywordtype}{bool}\ is\_ibd)\ \{\};}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ TransactionAddedToMempool(\textcolor{keyword}{const}\ NewMempoolTransactionInfo\&\ tx,\ uint64\_t\ mempool\_sequence)\ \{\}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ TransactionRemovedFromMempool(\textcolor{keyword}{const}\ CTransactionRef\&\ tx,\ MemPoolRemovalReason\ reason,\ uint64\_t\ mempool\_sequence)\ \{\}}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00111\ \textcolor{comment}{\ \ \ \ \ *\ Notifies\ listeners\ of\ transactions\ removed\ from\ the\ mempool\ as}}
\DoxyCodeLine{00112\ \textcolor{comment}{\ \ \ \ \ *\ as\ a\ result\ of\ new\ block\ being\ connected.}}
\DoxyCodeLine{00113\ \textcolor{comment}{\ \ \ \ \ *\ MempoolTransactionsRemovedForBlock\ will\ be\ fired\ before\ BlockConnected.}}
\DoxyCodeLine{00114\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00115\ \textcolor{comment}{\ \ \ \ \ *\ Called\ on\ a\ background\ thread.}}
\DoxyCodeLine{00116\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ MempoolTransactionsRemovedForBlock(\textcolor{keyword}{const}\ std::vector<RemovedMempoolTransactionInfo>\&\ txs\_removed\_for\_block,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nBlockHeight)\ \{\}}
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ BlockConnected(\textcolor{keyword}{const}\ kernel::ChainstateRole\&\ role,\ \textcolor{keyword}{const}\ std::shared\_ptr<const\ CBlock>\&\ block,\ \textcolor{keyword}{const}\ CBlockIndex*\ pindex)\ \{\}}
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ BlockDisconnected(\textcolor{keyword}{const}\ std::shared\_ptr<const\ CBlock>\ \&block,\ \textcolor{keyword}{const}\ CBlockIndex*\ pindex)\ \{\}}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ ChainStateFlushed(\textcolor{keyword}{const}\ kernel::ChainstateRole\&\ role,\ \textcolor{keyword}{const}\ CBlockLocator\&\ locator)\ \{\}}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ BlockChecked(\textcolor{keyword}{const}\ std::shared\_ptr<const\ CBlock>\&,\ \textcolor{keyword}{const}\ BlockValidationState\&)\ \{\}}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ NewPoWValidBlock(\textcolor{keyword}{const}\ CBlockIndex\ *pindex,\ \textcolor{keyword}{const}\ std::shared\_ptr<const\ CBlock>\&\ block)\ \{\};}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }ValidationSignals;}
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }ValidationInterfaceTest;}
\DoxyCodeLine{00163\ \};}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \textcolor{keyword}{class\ }ValidationSignalsImpl;}
\DoxyCodeLine{00166\ \textcolor{keyword}{class\ }ValidationSignals\ \{}
\DoxyCodeLine{00167\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00168\ \ \ \ \ std::unique\_ptr<ValidationSignalsImpl>\ m\_internals;}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{comment}{//\ The\ task\ runner\ will\ block\ validation\ if\ it\ calls\ its\ insert\ method's}}
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{comment}{//\ func\ argument\ synchronously.\ In\ this\ class\ func\ contains\ a\ loop\ that}}
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{comment}{//\ dispatches\ a\ single\ validation\ event\ to\ all\ subscribers\ sequentially.}}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keyword}{explicit}\ ValidationSignals(std::unique\_ptr<util::TaskRunnerInterface>\ task\_runner);}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \ \ \string~ValidationSignals();}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{keywordtype}{void}\ FlushBackgroundCallbacks();}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ CallbacksPending();}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordtype}{void}\ RegisterValidationInterface(CValidationInterface*\ callbacks);}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keywordtype}{void}\ UnregisterValidationInterface(CValidationInterface*\ callbacks);}
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{keywordtype}{void}\ UnregisterAllValidationInterfaces();}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{comment}{//\ Alternate\ registration\ functions\ that\ release\ a\ shared\_ptr\ after\ the\ last}}
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{comment}{//\ notification\ is\ sent.\ These\ are\ useful\ for\ race-\/free\ cleanup,\ since}}
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{comment}{//\ unregistration\ is\ nonblocking\ and\ can\ return\ before\ the\ last\ notification\ is}}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{comment}{//\ processed.}}
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{keywordtype}{void}\ RegisterSharedValidationInterface(std::shared\_ptr<CValidationInterface>\ callbacks);}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordtype}{void}\ UnregisterSharedValidationInterface(std::shared\_ptr<CValidationInterface>\ callbacks);}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{keywordtype}{void}\ CallFunctionInValidationInterfaceQueue(std::function<\textcolor{keywordtype}{void}\ ()>\ func);}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keywordtype}{void}\ SyncWithValidationInterfaceQueue()\ LOCKS\_EXCLUDED(cs\_main);}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keywordtype}{void}\ UpdatedBlockTip(const\ CBlockIndex\ *,\ const\ CBlockIndex\ *,\ \textcolor{keywordtype}{bool}\ fInitialDownload);}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{keywordtype}{void}\ ActiveTipChange(const\ CBlockIndex\&,\ \textcolor{keywordtype}{bool});}
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{keywordtype}{void}\ TransactionAddedToMempool(const\ NewMempoolTransactionInfo\&,\ uint64\_t\ mempool\_sequence);}
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{keywordtype}{void}\ TransactionRemovedFromMempool(const\ CTransactionRef\&,\ MemPoolRemovalReason,\ uint64\_t\ mempool\_sequence);}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{keywordtype}{void}\ MempoolTransactionsRemovedForBlock(const\ std::vector<RemovedMempoolTransactionInfo>\&,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nBlockHeight);}
\DoxyCodeLine{00226\ \ \ \ \ \textcolor{keywordtype}{void}\ BlockConnected(const\ kernel::ChainstateRole\&,\ const\ std::shared\_ptr<const\ CBlock>\&,\ const\ CBlockIndex*\ pindex);}
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{keywordtype}{void}\ BlockDisconnected(const\ std::shared\_ptr<const\ CBlock>\ \&,\ const\ CBlockIndex*\ pindex);}
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{keywordtype}{void}\ ChainStateFlushed(const\ kernel::ChainstateRole\&,\ const\ CBlockLocator\&);}
\DoxyCodeLine{00229\ \ \ \ \ \textcolor{keywordtype}{void}\ BlockChecked(const\ std::shared\_ptr<const\ CBlock>\&,\ const\ BlockValidationState\&);}
\DoxyCodeLine{00230\ \ \ \ \ \textcolor{keywordtype}{void}\ NewPoWValidBlock(const\ CBlockIndex\ *,\ const\ std::shared\_ptr<const\ CBlock>\&);}
\DoxyCodeLine{00231\ \};}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ BITCOIN\_VALIDATIONINTERFACE\_H}}

\end{DoxyCode}
