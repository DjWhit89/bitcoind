\doxysection{src/psbt.cpp File Reference}
\label{psbt_8cpp}\index{src/psbt.cpp@{src/psbt.cpp}}
{\ttfamily \#include $<$psbt.\+h$>$}\newline
{\ttfamily \#include $<$common/types.\+h$>$}\newline
{\ttfamily \#include $<$node/types.\+h$>$}\newline
{\ttfamily \#include $<$policy/policy.\+h$>$}\newline
{\ttfamily \#include $<$script/signingprovider.\+h$>$}\newline
{\ttfamily \#include $<$util/check.\+h$>$}\newline
{\ttfamily \#include $<$util/strencodings.\+h$>$}\newline
\doxysubsubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum class \textbf{ PSBTError} 
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
bool \textbf{ PSBTInput\+Signed} (const \textbf{ PSBTInput} \&input)
\item 
bool \textbf{ PSBTInput\+Signed\+And\+Verified} (const \textbf{ Partially\+Signed\+Transaction} psbt, unsigned int input\+\_\+index, const \textbf{ Precomputed\+Transaction\+Data} $\ast$txdata)
\item 
size\+\_\+t \textbf{ Count\+PSBTUnsigned\+Inputs} (const \textbf{ Partially\+Signed\+Transaction} \&psbt)
\item 
void \textbf{ Update\+PSBTOutput} (const \textbf{ Signing\+Provider} \&provider, \textbf{ Partially\+Signed\+Transaction} \&psbt, int index)
\item 
\textbf{ Precomputed\+Transaction\+Data} \textbf{ Precompute\+PSBTData} (const \textbf{ Partially\+Signed\+Transaction} \&psbt)
\item 
\textbf{ PSBTError} \textbf{ Sign\+PSBTInput} (const \textbf{ Signing\+Provider} \&provider, \textbf{ Partially\+Signed\+Transaction} \&psbt, int index, const \textbf{ Precomputed\+Transaction\+Data} $\ast$txdata, std\+::optional$<$ int $>$ sighash, \textbf{ Signature\+Data} $\ast$out\+\_\+sigdata, bool finalize)
\item 
void \textbf{ Remove\+Unnecessary\+Transactions} (\textbf{ Partially\+Signed\+Transaction} \&psbtx)
\item 
bool \textbf{ Finalize\+PSBT} (\textbf{ Partially\+Signed\+Transaction} \&psbtx)
\item 
bool \textbf{ Finalize\+And\+Extract\+PSBT} (\textbf{ Partially\+Signed\+Transaction} \&psbtx, \textbf{ CMutable\+Transaction} \&result)
\item 
bool \textbf{ Combine\+PSBTs} (\textbf{ Partially\+Signed\+Transaction} \&out, const std\+::vector$<$ \textbf{ Partially\+Signed\+Transaction} $>$ \&psbtxs)
\item 
std\+::string \textbf{ PSBTRole\+Name} (\textbf{ PSBTRole} role)
\item 
bool \textbf{ Decode\+Base64\+PSBT} (\textbf{ Partially\+Signed\+Transaction} \&psbt, const std\+::string \&base64\+\_\+tx, std\+::string \&error)
\begin{DoxyCompactList}\small\item\em Decode a base64ed PSBT into a \doxyref{Partially\+Signed\+Transaction}{p.}{struct_partially_signed_transaction}. \end{DoxyCompactList}\item 
bool \textbf{ Decode\+Raw\+PSBT} (\textbf{ Partially\+Signed\+Transaction} \&psbt, std\+::span$<$ const std\+::byte $>$ tx\+\_\+data, std\+::string \&error)
\begin{DoxyCompactList}\small\item\em Decode a raw (binary blob) PSBT into a \doxyref{Partially\+Signed\+Transaction}{p.}{struct_partially_signed_transaction}. \end{DoxyCompactList}\end{DoxyCompactItemize}


\label{doc-enum-members}
\doxysubsection{Enumeration Type Documentation}
\index{psbt.cpp@{psbt.cpp}!PSBTError@{PSBTError}}
\index{PSBTError@{PSBTError}!psbt.cpp@{psbt.cpp}}
\doxysubsubsection{PSBTError}
{\footnotesize\ttfamily \label{psbt_8cpp_a463d00d67d3e9d48d7a3dc0c6ee84d06} 
enum class \textbf{ PSBTError}\hspace{0.3cm}{\ttfamily [strong]}}



\label{doc-func-members}
\doxysubsection{Function Documentation}
\index{psbt.cpp@{psbt.cpp}!CombinePSBTs@{CombinePSBTs}}
\index{CombinePSBTs@{CombinePSBTs}!psbt.cpp@{psbt.cpp}}
\doxysubsubsection{CombinePSBTs()}
{\footnotesize\ttfamily \label{psbt_8cpp_a45fae24aba4e755880c1911baad57e9e} 
bool Combine\+PSBTs (\begin{DoxyParamCaption}\item[{\textbf{ Partially\+Signed\+Transaction} \&}]{out}{, }\item[{const std\+::vector$<$ \textbf{ Partially\+Signed\+Transaction} $>$ \&}]{psbtxs}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [nodiscard]}}

Combines PSBTs with the same underlying transaction, resulting in a single PSBT with all partial signatures from each input.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{out}}  & {\em out} & the combined PSBT, if successful \\
\hline
\mbox{\texttt{in}}  & {\em psbtxs} & the PSBTs to combine \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if we successfully combined the transactions, false if they were not compatible 
\end{DoxyReturn}
\index{psbt.cpp@{psbt.cpp}!CountPSBTUnsignedInputs@{CountPSBTUnsignedInputs}}
\index{CountPSBTUnsignedInputs@{CountPSBTUnsignedInputs}!psbt.cpp@{psbt.cpp}}
\doxysubsubsection{CountPSBTUnsignedInputs()}
{\footnotesize\ttfamily \label{psbt_8cpp_aa9d848247f5f2bdd331a619628a9b469} 
size\+\_\+t Count\+PSBTUnsigned\+Inputs (\begin{DoxyParamCaption}\item[{const \textbf{ Partially\+Signed\+Transaction} \&}]{psbt}{}\end{DoxyParamCaption})}

Counts the unsigned inputs of a PSBT. \index{psbt.cpp@{psbt.cpp}!DecodeBase64PSBT@{DecodeBase64PSBT}}
\index{DecodeBase64PSBT@{DecodeBase64PSBT}!psbt.cpp@{psbt.cpp}}
\doxysubsubsection{DecodeBase64PSBT()}
{\footnotesize\ttfamily \label{psbt_8cpp_a17e0c0d158233f8a584b3c209399ac95} 
bool Decode\+Base64\+PSBT (\begin{DoxyParamCaption}\item[{\textbf{ Partially\+Signed\+Transaction} \&}]{psbt}{, }\item[{const std\+::string \&}]{base64\+\_\+tx}{, }\item[{std\+::string \&}]{error}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [nodiscard]}}



Decode a base64ed PSBT into a \doxyref{Partially\+Signed\+Transaction}{p.}{struct_partially_signed_transaction}. 

\index{psbt.cpp@{psbt.cpp}!DecodeRawPSBT@{DecodeRawPSBT}}
\index{DecodeRawPSBT@{DecodeRawPSBT}!psbt.cpp@{psbt.cpp}}
\doxysubsubsection{DecodeRawPSBT()}
{\footnotesize\ttfamily \label{psbt_8cpp_a449ec94295612e0d8e7f5d95c2bd83ed} 
bool Decode\+Raw\+PSBT (\begin{DoxyParamCaption}\item[{\textbf{ Partially\+Signed\+Transaction} \&}]{psbt}{, }\item[{std\+::span$<$ const std\+::byte $>$}]{tx\+\_\+data}{, }\item[{std\+::string \&}]{error}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [nodiscard]}}



Decode a raw (binary blob) PSBT into a \doxyref{Partially\+Signed\+Transaction}{p.}{struct_partially_signed_transaction}. 

\index{psbt.cpp@{psbt.cpp}!FinalizeAndExtractPSBT@{FinalizeAndExtractPSBT}}
\index{FinalizeAndExtractPSBT@{FinalizeAndExtractPSBT}!psbt.cpp@{psbt.cpp}}
\doxysubsubsection{FinalizeAndExtractPSBT()}
{\footnotesize\ttfamily \label{psbt_8cpp_aab3ec9bcf6f951016a077dcfcbb3da0a} 
bool Finalize\+And\+Extract\+PSBT (\begin{DoxyParamCaption}\item[{\textbf{ Partially\+Signed\+Transaction} \&}]{psbtx}{, }\item[{\textbf{ CMutable\+Transaction} \&}]{result}{}\end{DoxyParamCaption})}

Finalizes a PSBT if possible, and extracts it to a \doxyref{CMutable\+Transaction}{p.}{struct_c_mutable_transaction} if it could be finalized.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{in}}  & {\em psbtx} & \doxyref{Partially\+Signed\+Transaction}{p.}{struct_partially_signed_transaction} \\
\hline
\mbox{\texttt{out}}  & {\em result} & \doxyref{CMutable\+Transaction}{p.}{struct_c_mutable_transaction} representing the complete transaction, if successful \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if we successfully extracted the transaction, false otherwise 
\end{DoxyReturn}
\index{psbt.cpp@{psbt.cpp}!FinalizePSBT@{FinalizePSBT}}
\index{FinalizePSBT@{FinalizePSBT}!psbt.cpp@{psbt.cpp}}
\doxysubsubsection{FinalizePSBT()}
{\footnotesize\ttfamily \label{psbt_8cpp_ae928e40974eb627033adb546395ae535} 
bool Finalize\+PSBT (\begin{DoxyParamCaption}\item[{\textbf{ Partially\+Signed\+Transaction} \&}]{psbtx}{}\end{DoxyParamCaption})}

Finalizes a PSBT if possible, combining partial signatures.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{in,out}}  & {\em psbtx} & \doxyref{Partially\+Signed\+Transaction}{p.}{struct_partially_signed_transaction} to finalize return True if the PSBT is now complete, false otherwise \\
\hline
\end{DoxyParams}
\index{psbt.cpp@{psbt.cpp}!PrecomputePSBTData@{PrecomputePSBTData}}
\index{PrecomputePSBTData@{PrecomputePSBTData}!psbt.cpp@{psbt.cpp}}
\doxysubsubsection{PrecomputePSBTData()}
{\footnotesize\ttfamily \label{psbt_8cpp_ae3b8a65af026fb8dbba801281a09d6ab} 
\textbf{ Precomputed\+Transaction\+Data} Precompute\+PSBTData (\begin{DoxyParamCaption}\item[{const \textbf{ Partially\+Signed\+Transaction} \&}]{psbt}{}\end{DoxyParamCaption})}

Compute a \doxyref{Precomputed\+Transaction\+Data}{p.}{struct_precomputed_transaction_data} object from a psbt. \index{psbt.cpp@{psbt.cpp}!PSBTInputSigned@{PSBTInputSigned}}
\index{PSBTInputSigned@{PSBTInputSigned}!psbt.cpp@{psbt.cpp}}
\doxysubsubsection{PSBTInputSigned()}
{\footnotesize\ttfamily \label{psbt_8cpp_adb45b4ff9d80ea5612fdfa22afb76fda} 
bool PSBTInput\+Signed (\begin{DoxyParamCaption}\item[{const \textbf{ PSBTInput} \&}]{input}{}\end{DoxyParamCaption})}

Checks whether a \doxyref{PSBTInput}{p.}{struct_p_s_b_t_input} is already signed by checking for non-\/null finalized fields. \index{psbt.cpp@{psbt.cpp}!PSBTInputSignedAndVerified@{PSBTInputSignedAndVerified}}
\index{PSBTInputSignedAndVerified@{PSBTInputSignedAndVerified}!psbt.cpp@{psbt.cpp}}
\doxysubsubsection{PSBTInputSignedAndVerified()}
{\footnotesize\ttfamily \label{psbt_8cpp_a256d9d3afe0d516d5a1064db63527f1f} 
bool PSBTInput\+Signed\+And\+Verified (\begin{DoxyParamCaption}\item[{const \textbf{ Partially\+Signed\+Transaction}}]{psbt}{, }\item[{unsigned int}]{input\+\_\+index}{, }\item[{const \textbf{ Precomputed\+Transaction\+Data} $\ast$}]{txdata}{}\end{DoxyParamCaption})}

Checks whether a \doxyref{PSBTInput}{p.}{struct_p_s_b_t_input} is already signed by doing script verification using final fields. \index{psbt.cpp@{psbt.cpp}!PSBTRoleName@{PSBTRoleName}}
\index{PSBTRoleName@{PSBTRoleName}!psbt.cpp@{psbt.cpp}}
\doxysubsubsection{PSBTRoleName()}
{\footnotesize\ttfamily \label{psbt_8cpp_a3a970aef1eb908d625f38a7f26d3096a} 
std\+::string PSBTRole\+Name (\begin{DoxyParamCaption}\item[{\textbf{ PSBTRole}}]{role}{}\end{DoxyParamCaption})}

\index{psbt.cpp@{psbt.cpp}!RemoveUnnecessaryTransactions@{RemoveUnnecessaryTransactions}}
\index{RemoveUnnecessaryTransactions@{RemoveUnnecessaryTransactions}!psbt.cpp@{psbt.cpp}}
\doxysubsubsection{RemoveUnnecessaryTransactions()}
{\footnotesize\ttfamily \label{psbt_8cpp_a661cf94272ebbe91e43510e9f254a1a2} 
void Remove\+Unnecessary\+Transactions (\begin{DoxyParamCaption}\item[{\textbf{ Partially\+Signed\+Transaction} \&}]{psbtx}{}\end{DoxyParamCaption})}

Reduces the size of the PSBT by dropping unnecessary {\ttfamily non\+\_\+witness\+\_\+utxos} (i.\+e. complete previous transactions) from a psbt when all inputs are segwit v1. \index{psbt.cpp@{psbt.cpp}!SignPSBTInput@{SignPSBTInput}}
\index{SignPSBTInput@{SignPSBTInput}!psbt.cpp@{psbt.cpp}}
\doxysubsubsection{SignPSBTInput()}
{\footnotesize\ttfamily \label{psbt_8cpp_aeb30ad68e6543946f7cb2f9b0b028126} 
\textbf{ PSBTError} Sign\+PSBTInput (\begin{DoxyParamCaption}\item[{const \textbf{ Signing\+Provider} \&}]{provider}{, }\item[{\textbf{ Partially\+Signed\+Transaction} \&}]{psbt}{, }\item[{int}]{index}{, }\item[{const \textbf{ Precomputed\+Transaction\+Data} $\ast$}]{txdata}{, }\item[{std\+::optional$<$ int $>$}]{sighash}{ = {\ttfamily std\+:\+:nullopt}, }\item[{\textbf{ Signature\+Data} $\ast$}]{out\+\_\+sigdata}{ = {\ttfamily nullptr}, }\item[{bool}]{finalize}{ = {\ttfamily true}}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [nodiscard]}}

Signs a \doxyref{PSBTInput}{p.}{struct_p_s_b_t_input}, verifying that all provided data matches what is being signed.

txdata should be the output of Precompute\+PSBTData (which can be shared across multiple Sign\+PSBTInput calls). If it is nullptr, a dummy signature will be created. \index{psbt.cpp@{psbt.cpp}!UpdatePSBTOutput@{UpdatePSBTOutput}}
\index{UpdatePSBTOutput@{UpdatePSBTOutput}!psbt.cpp@{psbt.cpp}}
\doxysubsubsection{UpdatePSBTOutput()}
{\footnotesize\ttfamily \label{psbt_8cpp_a1fbcc5412f6bced6bdbc803fa9b92bc6} 
void Update\+PSBTOutput (\begin{DoxyParamCaption}\item[{const \textbf{ Signing\+Provider} \&}]{provider}{, }\item[{\textbf{ Partially\+Signed\+Transaction} \&}]{psbt}{, }\item[{int}]{index}{}\end{DoxyParamCaption})}

Updates a \doxyref{PSBTOutput}{p.}{struct_p_s_b_t_output} with information from provider.

This fills in the redeem\+\_\+script, witness\+\_\+script, and hd\+\_\+keypaths where possible. 