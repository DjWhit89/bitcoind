\doxysection{src/logging.h File Reference}
\label{logging_8h}\index{src/logging.h@{src/logging.h}}
{\ttfamily \#include $<$crypto/siphash.\+h$>$}\newline
{\ttfamily \#include $<$threadsafety.\+h$>$}\newline
{\ttfamily \#include $<$tinyformat.\+h$>$}\newline
{\ttfamily \#include $<$util/check.\+h$>$}\newline
{\ttfamily \#include $<$util/fs.\+h$>$}\newline
{\ttfamily \#include $<$util/string.\+h$>$}\newline
{\ttfamily \#include $<$util/time.\+h$>$}\newline
{\ttfamily \#include $<$atomic$>$}\newline
{\ttfamily \#include $<$cstdint$>$}\newline
{\ttfamily \#include $<$cstring$>$}\newline
{\ttfamily \#include $<$functional$>$}\newline
{\ttfamily \#include $<$list$>$}\newline
{\ttfamily \#include $<$memory$>$}\newline
{\ttfamily \#include $<$mutex$>$}\newline
{\ttfamily \#include $<$source\+\_\+location$>$}\newline
{\ttfamily \#include $<$string$>$}\newline
{\ttfamily \#include $<$unordered\+\_\+map$>$}\newline
{\ttfamily \#include $<$unordered\+\_\+set$>$}\newline
{\ttfamily \#include $<$vector$>$}\newline
\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
class \textbf{ Source\+Location}
\begin{DoxyCompactList}\small\item\em Like std\+::source\+\_\+location, but allowing to override the function name. \end{DoxyCompactList}\item 
struct \textbf{ Source\+Location\+Equal}
\item 
struct \textbf{ Source\+Location\+Hasher}
\item 
struct \textbf{ Log\+Category}
\item 
class \textbf{ Log\+Rate\+Limiter}
\begin{DoxyCompactList}\small\item\em Fixed window rate limiter for logging. \end{DoxyCompactList}\item 
struct \textbf{ Log\+Rate\+Limiter\+::\+Stats}
\begin{DoxyCompactList}\small\item\em Keeps track of an individual source location and how many available bytes are left for logging from it. \end{DoxyCompactList}\item 
class \textbf{ Logger}
\item 
struct \textbf{ Logger\+::\+Buffered\+Log}
\end{DoxyCompactItemize}
\doxysubsubsection*{Namespaces}
\begin{DoxyCompactItemize}
\item 
namespace \textbf{ BCLog}
\end{DoxyCompactItemize}
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \textbf{ Log\+Print\+Level\+\_\+}(category,  level,  should\+\_\+ratelimit, ...)
\item 
\#define \textbf{ Log\+Info}(...)
\item 
\#define \textbf{ Log\+Warning}(...)
\item 
\#define \textbf{ Log\+Error}(...)
\item 
\#define \textbf{ detail\+\_\+\+Log\+If\+Category\+And\+Level\+Enabled}(category,  level, ...)
\item 
\#define \textbf{ Log\+Debug}(category, ...)
\item 
\#define \textbf{ Log\+Trace}(category, ...)
\end{DoxyCompactItemize}
\doxysubsubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
using \textbf{ Category\+Mask} = uint64\+\_\+t
\end{DoxyCompactItemize}
\doxysubsubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \textbf{ Log\+Flags} \+: Category\+Mask \{ \newline
\textbf{ NONE} = Category\+Mask\{0\}
, \textbf{ NET} = (Category\+Mask\{1\} $<$$<$ 0)
, \textbf{ TOR} = (Category\+Mask\{1\} $<$$<$ 1)
, \textbf{ MEMPOOL} = (Category\+Mask\{1\} $<$$<$ 2)
, \newline
\textbf{ HTTP} = (Category\+Mask\{1\} $<$$<$ 3)
, \textbf{ BENCH} = (Category\+Mask\{1\} $<$$<$ 4)
, \textbf{ ZMQ} = (Category\+Mask\{1\} $<$$<$ 5)
, \textbf{ WALLETDB} = (Category\+Mask\{1\} $<$$<$ 6)
, \newline
\textbf{ RPC} = (Category\+Mask\{1\} $<$$<$ 7)
, \textbf{ ESTIMATEFEE} = (Category\+Mask\{1\} $<$$<$ 8)
, \textbf{ ADDRMAN} = (Category\+Mask\{1\} $<$$<$ 9)
, \textbf{ SELECTCOINS} = (Category\+Mask\{1\} $<$$<$ 10)
, \newline
\textbf{ REINDEX} = (Category\+Mask\{1\} $<$$<$ 11)
, \textbf{ CMPCTBLOCK} = (Category\+Mask\{1\} $<$$<$ 12)
, \textbf{ RAND} = (Category\+Mask\{1\} $<$$<$ 13)
, \textbf{ PRUNE} = (Category\+Mask\{1\} $<$$<$ 14)
, \newline
\textbf{ PROXY} = (Category\+Mask\{1\} $<$$<$ 15)
, \textbf{ MEMPOOLREJ} = (Category\+Mask\{1\} $<$$<$ 16)
, \textbf{ LIBEVENT} = (Category\+Mask\{1\} $<$$<$ 17)
, \textbf{ COINDB} = (Category\+Mask\{1\} $<$$<$ 18)
, \newline
\textbf{ QT} = (Category\+Mask\{1\} $<$$<$ 19)
, \textbf{ LEVELDB} = (Category\+Mask\{1\} $<$$<$ 20)
, \textbf{ VALIDATION} = (Category\+Mask\{1\} $<$$<$ 21)
, \textbf{ I2P} = (Category\+Mask\{1\} $<$$<$ 22)
, \newline
\textbf{ IPC} = (Category\+Mask\{1\} $<$$<$ 23)
, \textbf{ BLOCKSTORAGE} = (Category\+Mask\{1\} $<$$<$ 25)
, \textbf{ TXRECONCILIATION} = (Category\+Mask\{1\} $<$$<$ 26)
, \textbf{ SCAN} = (Category\+Mask\{1\} $<$$<$ 27)
, \newline
\textbf{ TXPACKAGES} = (Category\+Mask\{1\} $<$$<$ 28)
, \textbf{ KERNEL} = (Category\+Mask\{1\} $<$$<$ 29)
, \textbf{ ALL} = $\sim$\+NONE
 \}
\item 
enum class \textbf{ Level} \{ \newline
\textbf{ Trace} = 0
, \textbf{ Debug}
, \textbf{ Info}
, \textbf{ Warning}
, \newline
\textbf{ Error}
 \}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\textbf{ BCLog\+::\+Logger} \& \textbf{ Log\+Instance} ()
\item 
bool \textbf{ Get\+Log\+Category} (\textbf{ BCLog\+::\+Log\+Flags} \&flag, std\+::string\+\_\+view str)
\item 
{\footnotesize template$<$typename... Args$>$ }\\void \textbf{ Log\+Print\+Format\+Internal} (\textbf{ Source\+Location} \&\&source\+\_\+loc, \textbf{ BCLog\+::\+Log\+Flags} flag, \textbf{ BCLog\+::\+Level} level, bool should\+\_\+ratelimit, \textbf{ util\+::\+Consteval\+Format\+String}$<$ sizeof...(Args)$>$ fmt, const Args \&... \textbf{ args})
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const char $\ast$const \textbf{ DEFAULT\+\_\+\+DEBUGLOGFILE}
\item 
bool \textbf{ f\+Log\+IPs}
\item 
constexpr auto \textbf{ DEFAULT\+\_\+\+LOG\+\_\+\+LEVEL} \{\textbf{ Level\+::\+Debug}\}
\item 
constexpr size\+\_\+t \textbf{ DEFAULT\+\_\+\+MAX\+\_\+\+LOG\+\_\+\+BUFFER} \{1\textquotesingle{}000\textquotesingle{}000\}
\item 
constexpr uint64\+\_\+t \textbf{ RATELIMIT\+\_\+\+MAX\+\_\+\+BYTES} \{1024 $\ast$ 1024\}
\item 
constexpr auto \textbf{ RATELIMIT\+\_\+\+WINDOW} \{1h\}
\item 
constexpr bool \textbf{ DEFAULT\+\_\+\+LOGRATELIMIT} \{true\}
\end{DoxyCompactItemize}


\label{doc-define-members}
\doxysubsection{Macro Definition Documentation}
\index{logging.h@{logging.h}!detail\_LogIfCategoryAndLevelEnabled@{detail\_LogIfCategoryAndLevelEnabled}}
\index{detail\_LogIfCategoryAndLevelEnabled@{detail\_LogIfCategoryAndLevelEnabled}!logging.h@{logging.h}}
\doxysubsubsection{detail\_LogIfCategoryAndLevelEnabled}
{\footnotesize\ttfamily \label{logging_8h_a38dfb53ecd66d6aa94055869a6cc58e7} 
\#define detail\+\_\+\+Log\+If\+Category\+And\+Level\+Enabled(\begin{DoxyParamCaption}\item[{}]{category}{, }\item[{}]{level}{, }\item[{}]{}...{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{do}\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ if\ (LogAcceptCategory((category),\ (level)))\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ rate\_limit\{level\ >=\ BCLog::Level::Info\};\ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ Assume(!rate\_limit);\textcolor{comment}{/*Only\ called\ with\ the\ levels\ below*/}\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ LogPrintLevel\_(category,\ level,\ rate\_limit,\ \_\_VA\_ARGS\_\_);\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \}\ \textcolor{keywordflow}{while}\ (0)}

\end{DoxyCode}
\index{logging.h@{logging.h}!LogDebug@{LogDebug}}
\index{LogDebug@{LogDebug}!logging.h@{logging.h}}
\doxysubsubsection{LogDebug}
{\footnotesize\ttfamily \label{logging_8h_adeb58140a1c97947ad5d0c641415f1fc} 
\#define Log\+Debug(\begin{DoxyParamCaption}\item[{}]{category}{, }\item[{}]{}...{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{detail\_LogIfCategoryAndLevelEnabled(category,\ BCLog::Level::Debug,\ \_\_VA\_ARGS\_\_)}

\end{DoxyCode}
\index{logging.h@{logging.h}!LogError@{LogError}}
\index{LogError@{LogError}!logging.h@{logging.h}}
\doxysubsubsection{LogError}
{\footnotesize\ttfamily \label{logging_8h_a611dbbfa5c2f148b7190b97a12835b5e} 
\#define Log\+Error(\begin{DoxyParamCaption}\item[{}]{}...{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{LogPrintLevel\_(BCLog::LogFlags::ALL,\ BCLog::Level::Error,\ \textcolor{comment}{/*should\_ratelimit=*/}\textcolor{keyword}{true},\ \_\_VA\_ARGS\_\_)}

\end{DoxyCode}
\index{logging.h@{logging.h}!LogInfo@{LogInfo}}
\index{LogInfo@{LogInfo}!logging.h@{logging.h}}
\doxysubsubsection{LogInfo}
{\footnotesize\ttfamily \label{logging_8h_a57eb3ffc98e6ad1bdbed0a980a54c484} 
\#define Log\+Info(\begin{DoxyParamCaption}\item[{}]{}...{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{LogPrintLevel\_(BCLog::LogFlags::ALL,\ BCLog::Level::Info,\ \textcolor{comment}{/*should\_ratelimit=*/}\textcolor{keyword}{true},\ \_\_VA\_ARGS\_\_)}

\end{DoxyCode}
\index{logging.h@{logging.h}!LogPrintLevel\_@{LogPrintLevel\_}}
\index{LogPrintLevel\_@{LogPrintLevel\_}!logging.h@{logging.h}}
\doxysubsubsection{LogPrintLevel\_}
{\footnotesize\ttfamily \label{logging_8h_a29339c6ed20edeb5fdde1f0a5c2c076b} 
\#define Log\+Print\+Level\+\_\+(\begin{DoxyParamCaption}\item[{}]{category}{, }\item[{}]{level}{, }\item[{}]{should\+\_\+ratelimit}{, }\item[{}]{}...{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{LogPrintFormatInternal(SourceLocation\{\_\_func\_\_\},\ category,\ level,\ should\_ratelimit,\ \_\_VA\_ARGS\_\_)}

\end{DoxyCode}
\index{logging.h@{logging.h}!LogTrace@{LogTrace}}
\index{LogTrace@{LogTrace}!logging.h@{logging.h}}
\doxysubsubsection{LogTrace}
{\footnotesize\ttfamily \label{logging_8h_abbd68a7aa3fd4605ad931e90712faaa8} 
\#define Log\+Trace(\begin{DoxyParamCaption}\item[{}]{category}{, }\item[{}]{}...{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{detail\_LogIfCategoryAndLevelEnabled(category,\ BCLog::Level::Trace,\ \_\_VA\_ARGS\_\_)}

\end{DoxyCode}
\index{logging.h@{logging.h}!LogWarning@{LogWarning}}
\index{LogWarning@{LogWarning}!logging.h@{logging.h}}
\doxysubsubsection{LogWarning}
{\footnotesize\ttfamily \label{logging_8h_a2c6c3e9c356e14fb4a7139acf4fa7b18} 
\#define Log\+Warning(\begin{DoxyParamCaption}\item[{}]{}...{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{LogPrintLevel\_(BCLog::LogFlags::ALL,\ BCLog::Level::Warning,\ \textcolor{comment}{/*should\_ratelimit=*/}\textcolor{keyword}{true},\ \_\_VA\_ARGS\_\_)}

\end{DoxyCode}


\label{doc-func-members}
\doxysubsection{Function Documentation}
\index{logging.h@{logging.h}!GetLogCategory@{GetLogCategory}}
\index{GetLogCategory@{GetLogCategory}!logging.h@{logging.h}}
\doxysubsubsection{GetLogCategory()}
{\footnotesize\ttfamily \label{logging_8h_a3f113564d44c9eba692f64b0f1194f4b} 
bool Get\+Log\+Category (\begin{DoxyParamCaption}\item[{\textbf{ BCLog\+::\+Log\+Flags} \&}]{flag}{, }\item[{std\+::string\+\_\+view}]{str}{}\end{DoxyParamCaption})}

Return true if str parses as a log category and set the flag \index{logging.h@{logging.h}!LogInstance@{LogInstance}}
\index{LogInstance@{LogInstance}!logging.h@{logging.h}}
\doxysubsubsection{LogInstance()}
{\footnotesize\ttfamily \label{logging_8h_a7ef55b61ba6d5bb4d828041cc1cd0f39} 
\textbf{ BCLog\+::\+Logger} \& Log\+Instance (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

NOTE\+: the logger instances is leaked on exit. This is ugly, but will be cleaned up by the OS/libc. Defining a logger as a global object doesn\textquotesingle{}t work since the order of destruction of static/global objects is undefined. Consider if the logger gets destroyed, and then some later destructor calls Log\+Info, maybe indirectly, and you get a core dump at shutdown trying to access the logger. When the shutdown sequence is fully audited and tested, explicit destruction of these objects can be implemented by changing this from a raw pointer to a std\+::unique\+\_\+ptr. Since the $\sim$\+Logger() destructor is never called, the \doxyref{Logger}{p.}{class_logger} class and all its subclasses must have implicitly-\/defined destructors.

This method of initialization was originally introduced in ee3374234c60aba2cc4c5cd5cac1c0aefc2d817c.\index{logging.h@{logging.h}!LogPrintFormatInternal@{LogPrintFormatInternal}}
\index{LogPrintFormatInternal@{LogPrintFormatInternal}!logging.h@{logging.h}}
\doxysubsubsection{LogPrintFormatInternal()}
{\footnotesize\ttfamily \label{logging_8h_a8f1626c38ccc114b957c22d10cd76084} 
template$<$typename... Args$>$ \\
void Log\+Print\+Format\+Internal (\begin{DoxyParamCaption}\item[{\textbf{ Source\+Location} \&\&}]{source\+\_\+loc}{, }\item[{\textbf{ BCLog\+::\+Log\+Flags}}]{flag}{, }\item[{\textbf{ BCLog\+::\+Level}}]{level}{, }\item[{bool}]{should\+\_\+ratelimit}{, }\item[{\textbf{ util\+::\+Consteval\+Format\+String}$<$ sizeof...(Args)$>$}]{fmt}{, }\item[{const Args \&...}]{args}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



\label{doc-var-members}
\doxysubsection{Variable Documentation}
\index{logging.h@{logging.h}!DEFAULT\_DEBUGLOGFILE@{DEFAULT\_DEBUGLOGFILE}}
\index{DEFAULT\_DEBUGLOGFILE@{DEFAULT\_DEBUGLOGFILE}!logging.h@{logging.h}}
\doxysubsubsection{DEFAULT\_DEBUGLOGFILE}
{\footnotesize\ttfamily \label{logging_8h_aa83b5532d9039198c491d090c1335583} 
const char$\ast$ const DEFAULT\+\_\+\+DEBUGLOGFILE\hspace{0.3cm}{\ttfamily [extern]}}

\index{logging.h@{logging.h}!fLogIPs@{fLogIPs}}
\index{fLogIPs@{fLogIPs}!logging.h@{logging.h}}
\doxysubsubsection{fLogIPs}
{\footnotesize\ttfamily \label{logging_8h_a8e02420c2f7c53579ccb90acf301ae75} 
bool f\+Log\+IPs\hspace{0.3cm}{\ttfamily [extern]}}

