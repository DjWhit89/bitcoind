\doxysection{src/node/eviction.cpp File Reference}
\label{eviction_8cpp}\index{src/node/eviction.cpp@{src/node/eviction.cpp}}
{\ttfamily \#include $<$node/eviction.\+h$>$}\newline
{\ttfamily \#include $<$algorithm$>$}\newline
{\ttfamily \#include $<$array$>$}\newline
{\ttfamily \#include $<$chrono$>$}\newline
{\ttfamily \#include $<$cstdint$>$}\newline
{\ttfamily \#include $<$functional$>$}\newline
{\ttfamily \#include $<$map$>$}\newline
{\ttfamily \#include $<$vector$>$}\newline
\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \textbf{ Compare\+Node\+Network\+Time}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \textbf{ Protect\+No\+Ban\+Connections} (std\+::vector$<$ \textbf{ Node\+Eviction\+Candidate} $>$ \&eviction\+\_\+candidates)
\item 
void \textbf{ Protect\+Outbound\+Connections} (std\+::vector$<$ \textbf{ Node\+Eviction\+Candidate} $>$ \&eviction\+\_\+candidates)
\item 
void \textbf{ Protect\+Eviction\+Candidates\+By\+Ratio} (std\+::vector$<$ \textbf{ Node\+Eviction\+Candidate} $>$ \&eviction\+\_\+candidates)
\item 
std\+::optional$<$ \textbf{ Node\+Id} $>$ \textbf{ Select\+Node\+To\+Evict} (std\+::vector$<$ \textbf{ Node\+Eviction\+Candidate} $>$ \&\&v\+Eviction\+Candidates)
\end{DoxyCompactItemize}


\label{doc-func-members}
\doxysubsection{Function Documentation}
\index{eviction.cpp@{eviction.cpp}!ProtectEvictionCandidatesByRatio@{ProtectEvictionCandidatesByRatio}}
\index{ProtectEvictionCandidatesByRatio@{ProtectEvictionCandidatesByRatio}!eviction.cpp@{eviction.cpp}}
\doxysubsubsection{ProtectEvictionCandidatesByRatio()}
{\footnotesize\ttfamily \label{eviction_8cpp_a6d7ad378024a7749d028e7e9f570b1e3} 
void Protect\+Eviction\+Candidates\+By\+Ratio (\begin{DoxyParamCaption}\item[{std\+::vector$<$ \textbf{ Node\+Eviction\+Candidate} $>$ \&}]{v\+Eviction\+Candidates}{}\end{DoxyParamCaption})}

Protect desirable or disadvantaged inbound peers from eviction by ratio.

This function protects half of the peers which have been connected the longest, to replicate the non-\/eviction implicit behavior and preclude attacks that start later.

Half of these protected spots (1/4 of the total) are reserved for the following categories of peers, sorted by longest uptime, even if they\textquotesingle{}re not longest uptime overall\+:


\begin{DoxyItemize}
\item onion peers connected via our tor control service
\item localhost peers, as manually configured hidden services not using {\ttfamily -\/bind=addr[\+:port]=onion} will not be detected as inbound onion connections
\item I2P peers
\item CJDNS peers
\end{DoxyItemize}

This helps protect these privacy network peers, which tend to be otherwise disadvantaged under our eviction criteria for their higher min ping times relative to IPv4/\+IPv6 peers, and favorise the diversity of peer connections. \index{eviction.cpp@{eviction.cpp}!ProtectNoBanConnections@{ProtectNoBanConnections}}
\index{ProtectNoBanConnections@{ProtectNoBanConnections}!eviction.cpp@{eviction.cpp}}
\doxysubsubsection{ProtectNoBanConnections()}
{\footnotesize\ttfamily \label{eviction_8cpp_a31eb14e9967af753ff75ef1e61520314} 
void Protect\+No\+Ban\+Connections (\begin{DoxyParamCaption}\item[{std\+::vector$<$ \textbf{ Node\+Eviction\+Candidate} $>$ \&}]{eviction\+\_\+candidates}{}\end{DoxyParamCaption})}

\index{eviction.cpp@{eviction.cpp}!ProtectOutboundConnections@{ProtectOutboundConnections}}
\index{ProtectOutboundConnections@{ProtectOutboundConnections}!eviction.cpp@{eviction.cpp}}
\doxysubsubsection{ProtectOutboundConnections()}
{\footnotesize\ttfamily \label{eviction_8cpp_ad5272b431f51c08dd3d65ed5d6c10be3} 
void Protect\+Outbound\+Connections (\begin{DoxyParamCaption}\item[{std\+::vector$<$ \textbf{ Node\+Eviction\+Candidate} $>$ \&}]{eviction\+\_\+candidates}{}\end{DoxyParamCaption})}

\index{eviction.cpp@{eviction.cpp}!SelectNodeToEvict@{SelectNodeToEvict}}
\index{SelectNodeToEvict@{SelectNodeToEvict}!eviction.cpp@{eviction.cpp}}
\doxysubsubsection{SelectNodeToEvict()}
{\footnotesize\ttfamily \label{eviction_8cpp_a799d58489ce4ea35e8bc556dd9ffb33c} 
std\+::optional$<$ \textbf{ Node\+Id} $>$ Select\+Node\+To\+Evict (\begin{DoxyParamCaption}\item[{std\+::vector$<$ \textbf{ Node\+Eviction\+Candidate} $>$ \&\&}]{v\+Eviction\+Candidates}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [nodiscard]}}

Select an inbound peer to evict after filtering out (protecting) peers having distinct, difficult-\/to-\/forge characteristics. The protection logic picks out fixed numbers of desirable peers per various criteria, followed by (mostly) ratios of desirable or disadvantaged peers. If any eviction candidates remain, the selection logic chooses a peer to evict. 