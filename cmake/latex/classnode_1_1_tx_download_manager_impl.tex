\doxysection{Tx\+Download\+Manager\+Impl Class Reference}
\label{classnode_1_1_tx_download_manager_impl}\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}}


{\ttfamily \#include $<$txdownloadman\+\_\+impl.\+h$>$}

\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \textbf{ Peer\+Info}
\end{DoxyCompactItemize}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\textbf{ CRolling\+Bloom\+Filter} \& \textbf{ Recent\+Rejects\+Filter} ()
\item 
\textbf{ CRolling\+Bloom\+Filter} \& \textbf{ Recent\+Rejects\+Reconsiderable\+Filter} ()
\item 
\textbf{ CRolling\+Bloom\+Filter} \& \textbf{ Recent\+Confirmed\+Transactions\+Filter} ()
\item 
\textbf{ Tx\+Download\+Manager\+Impl} (const \textbf{ Tx\+Download\+Options} \&options)
\item 
void \textbf{ Active\+Tip\+Change} ()
\item 
void \textbf{ Block\+Connected} (const std\+::shared\+\_\+ptr$<$ const \textbf{ CBlock} $>$ \&pblock)
\item 
void \textbf{ Block\+Disconnected} ()
\item 
bool \textbf{ Already\+Have\+Tx} (const \textbf{ Gen\+Txid} \&gtxid, bool include\+\_\+reconsiderable)
\item 
void \textbf{ Connected\+Peer} (\textbf{ Node\+Id} nodeid, const \textbf{ Tx\+Download\+Connection\+Info} \&info)
\item 
void \textbf{ Disconnected\+Peer} (\textbf{ Node\+Id} nodeid)
\item 
bool \textbf{ Add\+Tx\+Announcement} (\textbf{ Node\+Id} peer, const \textbf{ Gen\+Txid} \&gtxid, std\+::chrono\+::microseconds now)
\item 
std\+::vector$<$ \textbf{ Gen\+Txid} $>$ \textbf{ Get\+Requests\+To\+Send} (\textbf{ Node\+Id} nodeid, std\+::chrono\+::microseconds current\+\_\+time)
\item 
void \textbf{ Received\+Not\+Found} (\textbf{ Node\+Id} nodeid, const std\+::vector$<$ \textbf{ Gen\+Txid} $>$ \&gtxids)
\item 
std\+::optional$<$ \textbf{ Package\+To\+Validate} $>$ \textbf{ Find1\+P1\+CPackage} (const \textbf{ CTransaction\+Ref} \&ptx, \textbf{ Node\+Id} nodeid)
\item 
void \textbf{ Mempool\+Accepted\+Tx} (const \textbf{ CTransaction\+Ref} \&tx)
\item 
\textbf{ Rejected\+Tx\+Todo} \textbf{ Mempool\+Rejected\+Tx} (const \textbf{ CTransaction\+Ref} \&ptx, const \textbf{ Tx\+Validation\+State} \&state, \textbf{ Node\+Id} nodeid, bool first\+\_\+time\+\_\+failure)
\item 
void \textbf{ Mempool\+Rejected\+Package} (const \textbf{ Package} \&package)
\item 
std\+::pair$<$ bool, std\+::optional$<$ \textbf{ Package\+To\+Validate} $>$ $>$ \textbf{ Received\+Tx} (\textbf{ Node\+Id} nodeid, const \textbf{ CTransaction\+Ref} \&ptx)
\item 
bool \textbf{ Have\+More\+Work} (\textbf{ Node\+Id} nodeid)
\item 
\textbf{ CTransaction\+Ref} \textbf{ Get\+Tx\+To\+Reconsider} (\textbf{ Node\+Id} nodeid)
\item 
void \textbf{ Check\+Is\+Empty} ()
\item 
void \textbf{ Check\+Is\+Empty} (\textbf{ Node\+Id} nodeid)
\item 
std\+::vector$<$ \textbf{ Tx\+Orphanage\+::\+Orphan\+Info} $>$ \textbf{ Get\+Orphan\+Transactions} () const
\end{DoxyCompactItemize}
\doxysubsubsection*{Data Fields}
\begin{DoxyCompactItemize}
\item 
\textbf{ Tx\+Download\+Options} \textbf{ m\+\_\+opts}
\item 
std\+::unique\+\_\+ptr$<$ \textbf{ Tx\+Orphanage} $>$ \textbf{ m\+\_\+orphanage}
\item 
\textbf{ Tx\+Request\+Tracker} \textbf{ m\+\_\+txrequest}
\item 
std\+::unique\+\_\+ptr$<$ \textbf{ CRolling\+Bloom\+Filter} $>$ \textbf{ m\+\_\+lazy\+\_\+recent\+\_\+rejects} \{nullptr\}
\item 
std\+::unique\+\_\+ptr$<$ \textbf{ CRolling\+Bloom\+Filter} $>$ \textbf{ m\+\_\+lazy\+\_\+recent\+\_\+rejects\+\_\+reconsiderable} \{nullptr\}
\item 
std\+::unique\+\_\+ptr$<$ \textbf{ CRolling\+Bloom\+Filter} $>$ \textbf{ m\+\_\+lazy\+\_\+recent\+\_\+confirmed\+\_\+transactions} \{nullptr\}
\item 
std\+::map$<$ \textbf{ Node\+Id}, \textbf{ Peer\+Info} $>$ \textbf{ m\+\_\+peer\+\_\+info}
\item 
uint32\+\_\+t \textbf{ m\+\_\+num\+\_\+wtxid\+\_\+peers} \{0\}
\end{DoxyCompactItemize}
\doxysubsubsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
std\+::vector$<$ \textbf{ Txid} $>$ \textbf{ Get\+Unique\+Parents} (const \textbf{ CTransaction} \&tx)
\item 
bool \textbf{ Maybe\+Add\+Orphan\+Resolution\+Candidate} (const std\+::vector$<$ \textbf{ Txid} $>$ \&unique\+\_\+parents, const \textbf{ Wtxid} \&wtxid, \textbf{ Node\+Id} nodeid, std\+::chrono\+::microseconds now)
\end{DoxyCompactItemize}


\label{doc-constructors}
\doxysubsection{Constructor \& Destructor Documentation}
\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{TxDownloadManagerImpl()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a740819eb030c9929319a1dac25756fc2} 
Tx\+Download\+Manager\+Impl (\begin{DoxyParamCaption}\item[{const \textbf{ Tx\+Download\+Options} \&}]{options}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



\label{doc-func-members}
\doxysubsection{Member Function Documentation}
\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!ActiveTipChange@{ActiveTipChange}}
\index{ActiveTipChange@{ActiveTipChange}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{ActiveTipChange()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_aa5883445f27deba93c352358f9e290c1} 
void Active\+Tip\+Change (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!AddTxAnnouncement@{AddTxAnnouncement}}
\index{AddTxAnnouncement@{AddTxAnnouncement}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{AddTxAnnouncement()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a9ce1df5e1f2436871991def3e2a99198} 
bool Add\+Tx\+Announcement (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{peer}{, }\item[{const \textbf{ Gen\+Txid} \&}]{gtxid}{, }\item[{std\+::chrono\+::microseconds}]{now}{}\end{DoxyParamCaption})}

Consider adding this tx hash to txrequest. Should be called whenever a new inv has been received. Also called internally when a transaction is missing parents so that we can request them. \index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!AlreadyHaveTx@{AlreadyHaveTx}}
\index{AlreadyHaveTx@{AlreadyHaveTx}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{AlreadyHaveTx()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a8fb0f78dbf93fd6b09b794458c11b091} 
bool Already\+Have\+Tx (\begin{DoxyParamCaption}\item[{const \textbf{ Gen\+Txid} \&}]{gtxid}{, }\item[{bool}]{include\+\_\+reconsiderable}{}\end{DoxyParamCaption})}

Check whether we already have this gtxid in\+:
\begin{DoxyItemize}
\item mempool
\item orphanage
\item m\+\_\+recent\+\_\+rejects
\item m\+\_\+recent\+\_\+rejects\+\_\+reconsiderable (if include\+\_\+reconsiderable = true)
\item m\+\_\+recent\+\_\+confirmed\+\_\+transactions 
\end{DoxyItemize}\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!BlockConnected@{BlockConnected}}
\index{BlockConnected@{BlockConnected}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{BlockConnected()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a53d97beb21a0a0eab363e22fc04fa3d9} 
void Block\+Connected (\begin{DoxyParamCaption}\item[{const std\+::shared\+\_\+ptr$<$ const \textbf{ CBlock} $>$ \&}]{pblock}{}\end{DoxyParamCaption})}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!BlockDisconnected@{BlockDisconnected}}
\index{BlockDisconnected@{BlockDisconnected}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{BlockDisconnected()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_aa9c6b85e663bc605cdef5ea311b1565a} 
void Block\+Disconnected (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!CheckIsEmpty@{CheckIsEmpty}}
\index{CheckIsEmpty@{CheckIsEmpty}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{CheckIsEmpty()\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_aade988d15fe1d9963d4f6a9f868a4c8c} 
void Check\+Is\+Empty (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!CheckIsEmpty@{CheckIsEmpty}}
\index{CheckIsEmpty@{CheckIsEmpty}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{CheckIsEmpty()\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_aa31150b5c163649b0bedf9aa05cd43e3} 
void Check\+Is\+Empty (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{nodeid}{}\end{DoxyParamCaption})}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!ConnectedPeer@{ConnectedPeer}}
\index{ConnectedPeer@{ConnectedPeer}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{ConnectedPeer()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a44008c3f833e83f33a382c81a842ab7e} 
void Connected\+Peer (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{nodeid}{, }\item[{const \textbf{ Tx\+Download\+Connection\+Info} \&}]{info}{}\end{DoxyParamCaption})}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!DisconnectedPeer@{DisconnectedPeer}}
\index{DisconnectedPeer@{DisconnectedPeer}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{DisconnectedPeer()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a2ddb15d822dd91ef55c56326adf50e4f} 
void Disconnected\+Peer (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{nodeid}{}\end{DoxyParamCaption})}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!Find1P1CPackage@{Find1P1CPackage}}
\index{Find1P1CPackage@{Find1P1CPackage}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{Find1P1CPackage()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a6a9e5a25ac8428a4387aaac5fefdd153} 
std\+::optional$<$ \textbf{ Package\+To\+Validate} $>$ Find1\+P1\+CPackage (\begin{DoxyParamCaption}\item[{const \textbf{ CTransaction\+Ref} \&}]{ptx}{, }\item[{\textbf{ Node\+Id}}]{nodeid}{}\end{DoxyParamCaption})}

Look for a child of this transaction in the orphanage to form a 1-\/parent-\/1-\/child package, skipping any combinations that have already been tried. Return the resulting package along with the senders of its respective transactions, or std\+::nullopt if no package is found. \index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!GetOrphanTransactions@{GetOrphanTransactions}}
\index{GetOrphanTransactions@{GetOrphanTransactions}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{GetOrphanTransactions()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_ad103bb6f849e8140f39f4aef19109b9c} 
std\+::vector$<$ \textbf{ Tx\+Orphanage\+::\+Orphan\+Info} $>$ Get\+Orphan\+Transactions (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption}) const}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!GetRequestsToSend@{GetRequestsToSend}}
\index{GetRequestsToSend@{GetRequestsToSend}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{GetRequestsToSend()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a9657de34ab5c603f7a719005801f44ea} 
std\+::vector$<$ \textbf{ Gen\+Txid} $>$ Get\+Requests\+To\+Send (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{nodeid}{, }\item[{std\+::chrono\+::microseconds}]{current\+\_\+time}{}\end{DoxyParamCaption})}

Get getdata requests to send. \index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!GetTxToReconsider@{GetTxToReconsider}}
\index{GetTxToReconsider@{GetTxToReconsider}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{GetTxToReconsider()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a3069348e7801e72ca8ae455538ba0ee8} 
\textbf{ CTransaction\+Ref} Get\+Tx\+To\+Reconsider (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{nodeid}{}\end{DoxyParamCaption})}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!GetUniqueParents@{GetUniqueParents}}
\index{GetUniqueParents@{GetUniqueParents}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{GetUniqueParents()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_ad41038196b6d15e7a7aaf8d5daebac13} 
std\+::vector$<$ \textbf{ Txid} $>$ Get\+Unique\+Parents (\begin{DoxyParamCaption}\item[{const \textbf{ CTransaction} \&}]{tx}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Helper for getting deduplicated vector of Txids in vin. \index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!HaveMoreWork@{HaveMoreWork}}
\index{HaveMoreWork@{HaveMoreWork}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{HaveMoreWork()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a3e04e84648c35eae14be651290d993a3} 
bool Have\+More\+Work (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{nodeid}{}\end{DoxyParamCaption})}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!MaybeAddOrphanResolutionCandidate@{MaybeAddOrphanResolutionCandidate}}
\index{MaybeAddOrphanResolutionCandidate@{MaybeAddOrphanResolutionCandidate}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{MaybeAddOrphanResolutionCandidate()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_adbc437e354218c52b3dcec82e139af5a} 
bool Maybe\+Add\+Orphan\+Resolution\+Candidate (\begin{DoxyParamCaption}\item[{const std\+::vector$<$ \textbf{ Txid} $>$ \&}]{unique\+\_\+parents}{, }\item[{const \textbf{ Wtxid} \&}]{wtxid}{, }\item[{\textbf{ Node\+Id}}]{nodeid}{, }\item[{std\+::chrono\+::microseconds}]{now}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

If this peer is an orphan resolution candidate for this transaction, treat the unique\+\_\+parents as announced by this peer; add them as new invs to m\+\_\+txrequest. \begin{DoxyReturn}{Returns}
whether this transaction was a valid orphan resolution candidate. 
\end{DoxyReturn}
\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!MempoolAcceptedTx@{MempoolAcceptedTx}}
\index{MempoolAcceptedTx@{MempoolAcceptedTx}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{MempoolAcceptedTx()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_ad066c94643d88d8e76932d19ccecb448} 
void Mempool\+Accepted\+Tx (\begin{DoxyParamCaption}\item[{const \textbf{ CTransaction\+Ref} \&}]{tx}{}\end{DoxyParamCaption})}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!MempoolRejectedPackage@{MempoolRejectedPackage}}
\index{MempoolRejectedPackage@{MempoolRejectedPackage}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{MempoolRejectedPackage()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a358fdee6fa1c7c99776f1f301baaeafc} 
void Mempool\+Rejected\+Package (\begin{DoxyParamCaption}\item[{const \textbf{ Package} \&}]{package}{}\end{DoxyParamCaption})}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!MempoolRejectedTx@{MempoolRejectedTx}}
\index{MempoolRejectedTx@{MempoolRejectedTx}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{MempoolRejectedTx()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a78d4d8f410f01158cce4f39ae1951d98} 
\textbf{ node\+::\+Rejected\+Tx\+Todo} Mempool\+Rejected\+Tx (\begin{DoxyParamCaption}\item[{const \textbf{ CTransaction\+Ref} \&}]{ptx}{, }\item[{const \textbf{ Tx\+Validation\+State} \&}]{state}{, }\item[{\textbf{ Node\+Id}}]{nodeid}{, }\item[{bool}]{first\+\_\+time\+\_\+failure}{}\end{DoxyParamCaption})}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!ReceivedNotFound@{ReceivedNotFound}}
\index{ReceivedNotFound@{ReceivedNotFound}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{ReceivedNotFound()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_ac3697b6766b4729e5e405ec352a6b9d7} 
void Received\+Not\+Found (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{nodeid}{, }\item[{const std\+::vector$<$ \textbf{ Gen\+Txid} $>$ \&}]{gtxids}{}\end{DoxyParamCaption})}

Marks a tx as Received\+Response in txrequest. \index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!ReceivedTx@{ReceivedTx}}
\index{ReceivedTx@{ReceivedTx}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{ReceivedTx()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a46fe23e66164805fc7f8a3a7f4e29136} 
std\+::pair$<$ bool, std\+::optional$<$ \textbf{ Package\+To\+Validate} $>$ $>$ Received\+Tx (\begin{DoxyParamCaption}\item[{\textbf{ Node\+Id}}]{nodeid}{, }\item[{const \textbf{ CTransaction\+Ref} \&}]{ptx}{}\end{DoxyParamCaption})}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!RecentConfirmedTransactionsFilter@{RecentConfirmedTransactionsFilter}}
\index{RecentConfirmedTransactionsFilter@{RecentConfirmedTransactionsFilter}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{RecentConfirmedTransactionsFilter()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_adb5cc5fac71287d8729f708e155d8f28} 
\textbf{ CRolling\+Bloom\+Filter} \& Recent\+Confirmed\+Transactions\+Filter (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!RecentRejectsFilter@{RecentRejectsFilter}}
\index{RecentRejectsFilter@{RecentRejectsFilter}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{RecentRejectsFilter()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a1c3b7f5ea069908431408f80dda1266e} 
\textbf{ CRolling\+Bloom\+Filter} \& Recent\+Rejects\+Filter (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!RecentRejectsReconsiderableFilter@{RecentRejectsReconsiderableFilter}}
\index{RecentRejectsReconsiderableFilter@{RecentRejectsReconsiderableFilter}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{RecentRejectsReconsiderableFilter()}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a7d78f16e131478e38d834b5178bd04ba} 
\textbf{ CRolling\+Bloom\+Filter} \& Recent\+Rejects\+Reconsiderable\+Filter (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



\label{doc-variable-members}
\doxysubsection{Field Documentation}
\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!m\_lazy\_recent\_confirmed\_transactions@{m\_lazy\_recent\_confirmed\_transactions}}
\index{m\_lazy\_recent\_confirmed\_transactions@{m\_lazy\_recent\_confirmed\_transactions}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{m\_lazy\_recent\_confirmed\_transactions}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_af67e291420c6d126c3be685414cb16b1} 
std\+::unique\+\_\+ptr$<$\textbf{ CRolling\+Bloom\+Filter}$>$ m\+\_\+lazy\+\_\+recent\+\_\+confirmed\+\_\+transactions \{nullptr\}}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!m\_lazy\_recent\_rejects@{m\_lazy\_recent\_rejects}}
\index{m\_lazy\_recent\_rejects@{m\_lazy\_recent\_rejects}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{m\_lazy\_recent\_rejects}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a532482f80942aaf4558723a5e4f68c93} 
std\+::unique\+\_\+ptr$<$\textbf{ CRolling\+Bloom\+Filter}$>$ m\+\_\+lazy\+\_\+recent\+\_\+rejects \{nullptr\}}

Filter for transactions that were recently rejected by the mempool. These are not rerequested until the chain tip changes, at which point the entire filter is reset.

Without this filter we\textquotesingle{}d be re-\/requesting txs from each of our peers, increasing bandwidth consumption considerably. For instance, with 100 peers, half of which relay a tx we don\textquotesingle{}t accept, that might be a 50x bandwidth increase. A flooding attacker attempting to roll-\/over the filter using minimum-\/sized, 60byte, transactions might manage to send 1000/sec if we have fast peers, so we pick 120,000 to give our peers a two minute window to send invs to us.

Decreasing the false positive rate is fairly cheap, so we pick one in a million to make it highly unlikely for users to have issues with this filter.

We typically only add wtxids to this filter. For non-\/segwit transactions, the txid == wtxid, so this only prevents us from re-\/downloading non-\/segwit transactions when communicating with non-\/wtxidrelay peers -- which is important for avoiding malleation attacks that could otherwise interfere with transaction relay from non-\/wtxidrelay peers. For communicating with wtxidrelay peers, having the reject filter store wtxids is exactly what we want to avoid redownload of a rejected transaction.

In cases where we can tell that a segwit transaction will fail validation no matter the witness, we may add the txid of such transaction to the filter as well. This can be helpful when communicating with txid-\/relay peers or if we were to otherwise fetch a transaction via txid (eg in our orphan handling).

Memory used\+: 1.\+3 MB \index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!m\_lazy\_recent\_rejects\_reconsiderable@{m\_lazy\_recent\_rejects\_reconsiderable}}
\index{m\_lazy\_recent\_rejects\_reconsiderable@{m\_lazy\_recent\_rejects\_reconsiderable}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{m\_lazy\_recent\_rejects\_reconsiderable}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_aaf6506a7c8f18bc67c2bdab1ce146d6f} 
std\+::unique\+\_\+ptr$<$\textbf{ CRolling\+Bloom\+Filter}$>$ m\+\_\+lazy\+\_\+recent\+\_\+rejects\+\_\+reconsiderable \{nullptr\}}

Filter for\+: (1) wtxids of transactions that were recently rejected by the mempool but are eligible for reconsideration if submitted with other transactions. (2) packages (see Get\+Package\+Hash) we have already rejected before and should not retry.

Similar to m\+\_\+lazy\+\_\+recent\+\_\+rejects, this filter is used to save bandwidth when e.\+g. all of our peers have larger mempools and thus lower minimum feerates than us.

When a transaction\textquotesingle{}s error is \doxyref{Tx\+Validation\+Result\+::\+TX\+\_\+\+RECONSIDERABLE}{p.}{consensus_2validation_8h_af79c18cdf56a2455d281427abb70f89fada14c3503154c47fa98ac835983a5581} (in a package or by itself), add its wtxid to this filter. When a package fails for any reason, add the combined hash to this filter.

Upon receiving an announcement for a transaction, if it exists in this filter, do not download the txdata. When considering packages, if it exists in this filter, drop it.

Reset this filter when the chain tip changes.

Parameters are picked to be the same as m\+\_\+lazy\+\_\+recent\+\_\+rejects, with the same rationale. \index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!m\_num\_wtxid\_peers@{m\_num\_wtxid\_peers}}
\index{m\_num\_wtxid\_peers@{m\_num\_wtxid\_peers}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{m\_num\_wtxid\_peers}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a7ad5f7775d07e077c412cc8307fcb075} 
uint32\+\_\+t m\+\_\+num\+\_\+wtxid\+\_\+peers \{0\}}

Number of wtxid relay peers we have in m\+\_\+peer\+\_\+info. \index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!m\_opts@{m\_opts}}
\index{m\_opts@{m\_opts}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{m\_opts}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_afe061902d96917707c3ec8b4b2116123} 
\textbf{ Tx\+Download\+Options} m\+\_\+opts}

\index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!m\_orphanage@{m\_orphanage}}
\index{m\_orphanage@{m\_orphanage}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{m\_orphanage}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_a4552695318440d48aa4b06886c22a450} 
std\+::unique\+\_\+ptr$<$\textbf{ Tx\+Orphanage}$>$ m\+\_\+orphanage}

Manages unvalidated tx data (orphan transactions for which we are downloading ancestors). \index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!m\_peer\_info@{m\_peer\_info}}
\index{m\_peer\_info@{m\_peer\_info}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{m\_peer\_info}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_aa8b83773c77d370f7c0e3ce20d4419bb} 
std\+::map$<$\textbf{ Node\+Id}, \textbf{ Peer\+Info}$>$ m\+\_\+peer\+\_\+info}

Information for all of the peers we may download transactions from. This is not necessarily all peers we are connected to (no block-\/relay-\/only and temporary connections). \index{TxDownloadManagerImpl@{TxDownloadManagerImpl}!m\_txrequest@{m\_txrequest}}
\index{m\_txrequest@{m\_txrequest}!TxDownloadManagerImpl@{TxDownloadManagerImpl}}
\doxysubsubsection{m\_txrequest}
{\footnotesize\ttfamily \label{classnode_1_1_tx_download_manager_impl_af9270b96ba974173889698796fc09aee} 
\textbf{ Tx\+Request\+Tracker} m\+\_\+txrequest}

Tracks candidates for requesting and downloading transaction data. 

The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
src/node/\textbf{ txdownloadman\+\_\+impl.\+h}\item 
src/node/\textbf{ txdownloadman\+\_\+impl.\+cpp}\end{DoxyCompactItemize}
