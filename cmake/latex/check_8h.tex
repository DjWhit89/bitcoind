\doxysection{src/util/check.h File Reference}
\label{check_8h}\index{src/util/check.h@{src/util/check.h}}
{\ttfamily \#include $<$attributes.\+h$>$}\newline
{\ttfamily \#include $<$atomic$>$}\newline
{\ttfamily \#include $<$cassert$>$}\newline
{\ttfamily \#include $<$source\+\_\+location$>$}\newline
{\ttfamily \#include $<$stdexcept$>$}\newline
{\ttfamily \#include $<$string$>$}\newline
{\ttfamily \#include $<$string\+\_\+view$>$}\newline
{\ttfamily \#include $<$utility$>$}\newline
\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \textbf{ test\+\_\+only\+\_\+\+Check\+Failures\+Are\+Exceptions\+Not\+Aborts}
\item 
class \textbf{ Non\+Fatal\+Check\+Error}
\end{DoxyCompactItemize}
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \textbf{ STR\+\_\+\+INTERNAL\+\_\+\+BUG}(msg)
\item 
\#define \textbf{ CHECK\+\_\+\+NONFATAL}(condition)
\item 
\#define \textbf{ Assert}(val)
\item 
\#define \textbf{ Assume}(val)
\item 
\#define \textbf{ NONFATAL\+\_\+\+UNREACHABLE}()
\item 
\#define \textbf{ ASAN\+\_\+\+POISON\+\_\+\+MEMORY\+\_\+\+REGION}(addr,  size)
\item 
\#define \textbf{ ASAN\+\_\+\+UNPOISON\+\_\+\+MEMORY\+\_\+\+REGION}(addr,  size)
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
bool \textbf{ Enable\+Fuzz\+Determinism} ()
\item 
std\+::string \textbf{ Str\+Format\+Internal\+Bug} (std\+::string\+\_\+view msg, const std\+::source\+\_\+location \&loc)
\item 
void \textbf{ assertion\+\_\+fail} (const std\+::source\+\_\+location \&loc, std\+::string\+\_\+view assertion)
\item 
{\footnotesize template$<$typename \textbf{ T}$>$ }\\\textbf{ T} \&\& \textbf{ inline\+\_\+check\+\_\+non\+\_\+fatal} (\textbf{ LIFETIMEBOUND} \textbf{ T} \&\&val, const std\+::source\+\_\+location \&loc, std\+::string\+\_\+view assertion)
\item 
{\footnotesize template$<$bool IS\+\_\+\+ASSERT, typename \textbf{ T}$>$ }\\constexpr \textbf{ T} \&\& \textbf{ inline\+\_\+assertion\+\_\+check} (\textbf{ LIFETIMEBOUND} \textbf{ T} \&\&val, const std\+::source\+\_\+location \&loc, std\+::string\+\_\+view assertion)
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
constexpr bool \textbf{ G\+\_\+\+FUZZING\+\_\+\+BUILD}
\item 
constexpr bool \textbf{ G\+\_\+\+ABORT\+\_\+\+ON\+\_\+\+FAILED\+\_\+\+ASSUME}
\item 
std\+::atomic$<$ bool $>$ \textbf{ g\+\_\+enable\+\_\+dynamic\+\_\+fuzz\+\_\+determinism}
\item 
bool \textbf{ g\+\_\+detail\+\_\+test\+\_\+only\+\_\+\+Check\+Failures\+Are\+Exceptions\+Not\+Aborts}
\end{DoxyCompactItemize}


\label{doc-define-members}
\doxysubsection{Macro Definition Documentation}
\index{check.h@{check.h}!ASAN\_POISON\_MEMORY\_REGION@{ASAN\_POISON\_MEMORY\_REGION}}
\index{ASAN\_POISON\_MEMORY\_REGION@{ASAN\_POISON\_MEMORY\_REGION}!check.h@{check.h}}
\doxysubsubsection{ASAN\_POISON\_MEMORY\_REGION}
{\footnotesize\ttfamily \label{check_8h_a31fb61b6f8d57578ddd1ccd04c21f898} 
\#define ASAN\+\_\+\+POISON\+\_\+\+MEMORY\+\_\+\+REGION(\begin{DoxyParamCaption}\item[{}]{addr}{, }\item[{}]{size}{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{((void)(addr),\ (void)(size))}

\end{DoxyCode}
\index{check.h@{check.h}!ASAN\_UNPOISON\_MEMORY\_REGION@{ASAN\_UNPOISON\_MEMORY\_REGION}}
\index{ASAN\_UNPOISON\_MEMORY\_REGION@{ASAN\_UNPOISON\_MEMORY\_REGION}!check.h@{check.h}}
\doxysubsubsection{ASAN\_UNPOISON\_MEMORY\_REGION}
{\footnotesize\ttfamily \label{check_8h_a7a3f4306ff3c7076441d1aafd6c1c22c} 
\#define ASAN\+\_\+\+UNPOISON\+\_\+\+MEMORY\+\_\+\+REGION(\begin{DoxyParamCaption}\item[{}]{addr}{, }\item[{}]{size}{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{((void)(addr),\ (void)(size))}

\end{DoxyCode}
\index{check.h@{check.h}!Assert@{Assert}}
\index{Assert@{Assert}!check.h@{check.h}}
\doxysubsubsection{Assert}
{\footnotesize\ttfamily \label{check_8h_acbd5520ad7c4d365ede4ed94b421231b} 
\#define Assert(\begin{DoxyParamCaption}\item[{}]{val}{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{inline\_assertion\_check<true>(val,\ std::source\_location::current(),\ \#val)}

\end{DoxyCode}
Identity function. Abort if the value compares equal to zero \index{check.h@{check.h}!Assume@{Assume}}
\index{Assume@{Assume}!check.h@{check.h}}
\doxysubsubsection{Assume}
{\footnotesize\ttfamily \label{check_8h_adf63e17d34d997e5218a73ef20960ca9} 
\#define Assume(\begin{DoxyParamCaption}\item[{}]{val}{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{inline\_assertion\_check<false>(val,\ std::source\_location::current(),\ \#val)}

\end{DoxyCode}
Assume is the identity function.


\begin{DoxyItemize}
\item Should be used to run non-\/fatal checks. In debug builds it behaves like \doxyref{Assert()}{p.}{check_8h_acbd5520ad7c4d365ede4ed94b421231b}/assert() to notify developers and testers about non-\/fatal errors. In production it doesn\textquotesingle{}t warn or log anything.
\item For fatal errors, use \doxyref{Assert()}{p.}{check_8h_acbd5520ad7c4d365ede4ed94b421231b}.
\item For non-\/fatal errors in interactive sessions (e.\+g. RPC or command line interfaces), \doxyref{CHECK\+\_\+\+NONFATAL()}{p.}{check_8h_a46a3e27097aa5e94bbf62075bad7016f} might be more appropriate. 
\end{DoxyItemize}\index{check.h@{check.h}!CHECK\_NONFATAL@{CHECK\_NONFATAL}}
\index{CHECK\_NONFATAL@{CHECK\_NONFATAL}!check.h@{check.h}}
\doxysubsubsection{CHECK\_NONFATAL}
{\footnotesize\ttfamily \label{check_8h_a46a3e27097aa5e94bbf62075bad7016f} 
\#define CHECK\+\_\+\+NONFATAL(\begin{DoxyParamCaption}\item[{}]{condition}{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\ \ \ \ inline\_check\_non\_fatal(condition,\ std::source\_location::current(),\ \#condition)}

\end{DoxyCode}
Identity function. Throw a \doxyref{Non\+Fatal\+Check\+Error}{p.}{class_non_fatal_check_error} when the condition evaluates to false

This should only be used
\begin{DoxyItemize}
\item where the condition is assumed to be true, not for error handling or validating user input
\item where a failure to fulfill the condition is recoverable and does not abort the program
\end{DoxyItemize}

For example in RPC code, where it is undesirable to crash the whole program, this can be generally used to replace asserts or recoverable logic errors. A \doxyref{Non\+Fatal\+Check\+Error}{p.}{class_non_fatal_check_error} in RPC code is caught and passed as a string to the RPC caller, which can then report the issue to the developers. \index{check.h@{check.h}!NONFATAL\_UNREACHABLE@{NONFATAL\_UNREACHABLE}}
\index{NONFATAL\_UNREACHABLE@{NONFATAL\_UNREACHABLE}!check.h@{check.h}}
\doxysubsubsection{NONFATAL\_UNREACHABLE}
{\footnotesize\ttfamily \label{check_8h_ac579efce97842056131de240c39e86fc} 
\#define NONFATAL\+\_\+\+UNREACHABLE(\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{throw}\ NonFatalCheckError\ \{\ \textcolor{stringliteral}{"{}Unreachable\ code\ reached\ (non-\/fatal)"{}},\ std::source\_location::current()\ \}}

\end{DoxyCode}
\doxyref{NONFATAL\+\_\+\+UNREACHABLE()}{p.}{check_8h_ac579efce97842056131de240c39e86fc} is a macro that is used to mark unreachable code. It throws a \doxyref{Non\+Fatal\+Check\+Error}{p.}{class_non_fatal_check_error}. \index{check.h@{check.h}!STR\_INTERNAL\_BUG@{STR\_INTERNAL\_BUG}}
\index{STR\_INTERNAL\_BUG@{STR\_INTERNAL\_BUG}!check.h@{check.h}}
\doxysubsubsection{STR\_INTERNAL\_BUG}
{\footnotesize\ttfamily \label{check_8h_addf5dbcbeb39d6e72b103d4252a12267} 
\#define STR\+\_\+\+INTERNAL\+\_\+\+BUG(\begin{DoxyParamCaption}\item[{}]{msg}{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{StrFormatInternalBug((msg),\ std::source\_location::current())}

\end{DoxyCode}


\label{doc-func-members}
\doxysubsection{Function Documentation}
\index{check.h@{check.h}!assertion\_fail@{assertion\_fail}}
\index{assertion\_fail@{assertion\_fail}!check.h@{check.h}}
\doxysubsubsection{assertion\_fail()}
{\footnotesize\ttfamily \label{check_8h_ad47b74abee3cfe0801f683a22ef43f50} 
void assertion\+\_\+fail (\begin{DoxyParamCaption}\item[{const std\+::source\+\_\+location \&}]{loc}{, }\item[{std\+::string\+\_\+view}]{assertion}{}\end{DoxyParamCaption})}

Internal helper \index{check.h@{check.h}!EnableFuzzDeterminism@{EnableFuzzDeterminism}}
\index{EnableFuzzDeterminism@{EnableFuzzDeterminism}!check.h@{check.h}}
\doxysubsubsection{EnableFuzzDeterminism()}
{\footnotesize\ttfamily \label{check_8h_ac6565ed3fabd81b54e77fad1aa953257} 
bool Enable\+Fuzz\+Determinism (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

\index{check.h@{check.h}!inline\_assertion\_check@{inline\_assertion\_check}}
\index{inline\_assertion\_check@{inline\_assertion\_check}!check.h@{check.h}}
\doxysubsubsection{inline\_assertion\_check()}
{\footnotesize\ttfamily \label{check_8h_a8e38bcef29447a30cb74ffd4b527d993} 
template$<$bool IS\+\_\+\+ASSERT, typename \textbf{ T}$>$ \\
\textbf{ T} \&\& inline\+\_\+assertion\+\_\+check (\begin{DoxyParamCaption}\item[{\textbf{ LIFETIMEBOUND} \textbf{ T} \&\&}]{val}{, }\item[{const std\+::source\+\_\+location \&}]{loc}{, }\item[{std\+::string\+\_\+view}]{assertion}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [constexpr]}}

Helper for \doxyref{Assert()}{p.}{check_8h_acbd5520ad7c4d365ede4ed94b421231b}/\+Assume() \index{check.h@{check.h}!inline\_check\_non\_fatal@{inline\_check\_non\_fatal}}
\index{inline\_check\_non\_fatal@{inline\_check\_non\_fatal}!check.h@{check.h}}
\doxysubsubsection{inline\_check\_non\_fatal()}
{\footnotesize\ttfamily \label{check_8h_a9a5d77cbc85b4f0033ed3061284b91fd} 
template$<$typename \textbf{ T}$>$ \\
\textbf{ T} \&\& inline\+\_\+check\+\_\+non\+\_\+fatal (\begin{DoxyParamCaption}\item[{\textbf{ LIFETIMEBOUND} \textbf{ T} \&\&}]{val}{, }\item[{const std\+::source\+\_\+location \&}]{loc}{, }\item[{std\+::string\+\_\+view}]{assertion}{}\end{DoxyParamCaption})}

Helper for \doxyref{CHECK\+\_\+\+NONFATAL()}{p.}{check_8h_a46a3e27097aa5e94bbf62075bad7016f} \index{check.h@{check.h}!StrFormatInternalBug@{StrFormatInternalBug}}
\index{StrFormatInternalBug@{StrFormatInternalBug}!check.h@{check.h}}
\doxysubsubsection{StrFormatInternalBug()}
{\footnotesize\ttfamily \label{check_8h_ab15037d00eabcacf1c25572c5d311cf2} 
std\+::string Str\+Format\+Internal\+Bug (\begin{DoxyParamCaption}\item[{std\+::string\+\_\+view}]{msg}{, }\item[{const std\+::source\+\_\+location \&}]{loc}{}\end{DoxyParamCaption})}



\label{doc-var-members}
\doxysubsection{Variable Documentation}
\index{check.h@{check.h}!G\_ABORT\_ON\_FAILED\_ASSUME@{G\_ABORT\_ON\_FAILED\_ASSUME}}
\index{G\_ABORT\_ON\_FAILED\_ASSUME@{G\_ABORT\_ON\_FAILED\_ASSUME}!check.h@{check.h}}
\doxysubsubsection{G\_ABORT\_ON\_FAILED\_ASSUME}
{\footnotesize\ttfamily \label{check_8h_acbeb243c847c84986dd2006e693fecdc} 
bool G\+\_\+\+ABORT\+\_\+\+ON\+\_\+\+FAILED\+\_\+\+ASSUME\hspace{0.3cm}{\ttfamily [constexpr]}}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\{G\_FUZZING\_BUILD\ ||}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{false}}
\DoxyCodeLine{}
\DoxyCodeLine{\}}

\end{DoxyCode}
\index{check.h@{check.h}!g\_detail\_test\_only\_CheckFailuresAreExceptionsNotAborts@{g\_detail\_test\_only\_CheckFailuresAreExceptionsNotAborts}}
\index{g\_detail\_test\_only\_CheckFailuresAreExceptionsNotAborts@{g\_detail\_test\_only\_CheckFailuresAreExceptionsNotAborts}!check.h@{check.h}}
\doxysubsubsection{g\_detail\_test\_only\_CheckFailuresAreExceptionsNotAborts}
{\footnotesize\ttfamily \label{check_8h_a4c2174c7747e8afd2e88d4bf47c5b790} 
bool g\+\_\+detail\+\_\+test\+\_\+only\+\_\+\+Check\+Failures\+Are\+Exceptions\+Not\+Aborts\hspace{0.3cm}{\ttfamily [extern]}}

\index{check.h@{check.h}!g\_enable\_dynamic\_fuzz\_determinism@{g\_enable\_dynamic\_fuzz\_determinism}}
\index{g\_enable\_dynamic\_fuzz\_determinism@{g\_enable\_dynamic\_fuzz\_determinism}!check.h@{check.h}}
\doxysubsubsection{g\_enable\_dynamic\_fuzz\_determinism}
{\footnotesize\ttfamily \label{check_8h_aa9d5285dd4dfbbebae5d8b0a3793f0aa} 
std\+::atomic$<$bool$>$ g\+\_\+enable\+\_\+dynamic\+\_\+fuzz\+\_\+determinism\hspace{0.3cm}{\ttfamily [extern]}}

\index{check.h@{check.h}!G\_FUZZING\_BUILD@{G\_FUZZING\_BUILD}}
\index{G\_FUZZING\_BUILD@{G\_FUZZING\_BUILD}!check.h@{check.h}}
\doxysubsubsection{G\_FUZZING\_BUILD}
{\footnotesize\ttfamily \label{check_8h_ae6ffa7052026f89f47662a4c160a9b0c} 
bool G\+\_\+\+FUZZING\+\_\+\+BUILD\hspace{0.3cm}{\ttfamily [constexpr]}}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{false}}
\DoxyCodeLine{}
\DoxyCodeLine{\}}

\end{DoxyCode}
