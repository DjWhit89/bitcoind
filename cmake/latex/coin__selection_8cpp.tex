\doxysection{src/bench/coin\+\_\+selection.cpp File Reference}
\label{coin__selection_8cpp}\index{src/bench/coin\_selection.cpp@{src/bench/coin\_selection.cpp}}
{\ttfamily \#include $<$bench/bench.\+h$>$}\newline
{\ttfamily \#include $<$consensus/amount.\+h$>$}\newline
{\ttfamily \#include $<$interfaces/chain.\+h$>$}\newline
{\ttfamily \#include $<$node/context.\+h$>$}\newline
{\ttfamily \#include $<$outputtype.\+h$>$}\newline
{\ttfamily \#include $<$policy/feerate.\+h$>$}\newline
{\ttfamily \#include $<$policy/policy.\+h$>$}\newline
{\ttfamily \#include $<$primitives/transaction.\+h$>$}\newline
{\ttfamily \#include $<$random.\+h$>$}\newline
{\ttfamily \#include $<$sync.\+h$>$}\newline
{\ttfamily \#include $<$util/result.\+h$>$}\newline
{\ttfamily \#include $<$wallet/coinselection.\+h$>$}\newline
{\ttfamily \#include $<$wallet/spend.\+h$>$}\newline
{\ttfamily \#include $<$wallet/test/util.\+h$>$}\newline
{\ttfamily \#include $<$wallet/transaction.\+h$>$}\newline
{\ttfamily \#include $<$wallet/wallet.\+h$>$}\newline
{\ttfamily \#include $<$cassert$>$}\newline
{\ttfamily \#include $<$map$>$}\newline
{\ttfamily \#include $<$memory$>$}\newline
{\ttfamily \#include $<$set$>$}\newline
{\ttfamily \#include $<$utility$>$}\newline
{\ttfamily \#include $<$vector$>$}\newline
\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \textbf{ Node\+Context}
\item 
struct \textbf{ COutput}
\item 
class \textbf{ CWallet}
\item 
class \textbf{ CWallet\+Tx}
\item 
struct \textbf{ Coin\+Eligibility\+Filter}
\item 
struct \textbf{ Coin\+Selection\+Params}
\item 
struct \textbf{ Output\+Group}
\item 
struct \textbf{ Tx\+State\+Inactive}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\textbf{ BENCHMARK} (Coin\+Selection, \textbf{ benchmark\+::\+Priority\+Level\+::\+HIGH})
\item 
\textbf{ BENCHMARK} (Bn\+BExhaustion, \textbf{ benchmark\+::\+Priority\+Level\+::\+HIGH})
\item 
\textbf{ util\+::\+Result}$<$ Selection\+Result $>$ \textbf{ Attempt\+Selection} (\textbf{ interfaces\+::\+Chain} \&chain, const \textbf{ CAmount} \&n\+Target\+Value, Output\+Group\+Type\+Map \&groups, const \textbf{ Coin\+Selection\+Params} \&coin\+\_\+selection\+\_\+params, bool allow\+\_\+mixed\+\_\+output\+\_\+types)
\item 
std\+::unique\+\_\+ptr$<$ Wallet\+Database $>$ \textbf{ Create\+Mockable\+Wallet\+Database} (Mockable\+Data records)
\item 
\textbf{ util\+::\+Result}$<$ Selection\+Result $>$ \textbf{ Select\+Coins\+BnB} (std\+::vector$<$ \textbf{ Output\+Group} $>$ \&utxo\+\_\+pool, const \textbf{ CAmount} \&selection\+\_\+target, const \textbf{ CAmount} \&cost\+\_\+of\+\_\+change, int max\+\_\+selection\+\_\+weight)
\end{DoxyCompactItemize}


\label{doc-func-members}
\doxysubsection{Function Documentation}
\index{coin\_selection.cpp@{coin\_selection.cpp}!AttemptSelection@{AttemptSelection}}
\index{AttemptSelection@{AttemptSelection}!coin\_selection.cpp@{coin\_selection.cpp}}
\doxysubsubsection{AttemptSelection()}
{\footnotesize\ttfamily \label{coin__selection_8cpp_a195c27eace3852a39140c24fe7f7b13f} 
\textbf{ util\+::\+Result}$<$ Selection\+Result $>$ Attempt\+Selection (\begin{DoxyParamCaption}\item[{\textbf{ interfaces\+::\+Chain} \&}]{chain}{, }\item[{const \textbf{ CAmount} \&}]{n\+Target\+Value}{, }\item[{Output\+Group\+Type\+Map \&}]{groups}{, }\item[{const \textbf{ Coin\+Selection\+Params} \&}]{coin\+\_\+selection\+\_\+params}{, }\item[{bool}]{allow\+\_\+mixed\+\_\+output\+\_\+types}{}\end{DoxyParamCaption})}

Attempt to find a valid input set that preserves privacy by not mixing Output\+Types. {\ttfamily Choose\+Selection\+Result()} will be called on each \doxyref{Output\+Type}{p.}{outputtype_8h_a4e0517338e6c4a31a2addafc06d4f3a3} individually and the best the solution (according to the waste metric) will be chosen. If a valid input cannot be found from any single \doxyref{Output\+Type}{p.}{outputtype_8h_a4e0517338e6c4a31a2addafc06d4f3a3}, fallback to running {\ttfamily Choose\+Selection\+Result()} over all available coins.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{in}}  & {\em chain} & The chain interface to get information on bump fees for unconfirmed UTXOs \\
\hline
\mbox{\texttt{in}}  & {\em n\+Target\+Value} & The target value \\
\hline
\mbox{\texttt{in}}  & {\em groups} & The grouped outputs mapped by coin eligibility filters \\
\hline
\mbox{\texttt{in}}  & {\em coin\+\_\+selection\+\_\+params} & Parameters for the coin selection \\
\hline
\mbox{\texttt{in}}  & {\em allow\+\_\+mixed\+\_\+output\+\_\+types} & Relax restriction that Selection\+Results must be of the same \doxyref{Output\+Type}{p.}{outputtype_8h_a4e0517338e6c4a31a2addafc06d4f3a3} returns If successful, a Selection\+Result containing the input set If failed, returns (1) an empty error message if the target was not reached (general "{}\+Insufficient funds"{}) or (2) a specific error message if there was something particularly wrong (e.\+g. a selection result that surpassed the tx max weight size). \\
\hline
\end{DoxyParams}
\index{coin\_selection.cpp@{coin\_selection.cpp}!BENCHMARK@{BENCHMARK}}
\index{BENCHMARK@{BENCHMARK}!coin\_selection.cpp@{coin\_selection.cpp}}
\doxysubsubsection{BENCHMARK()\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \label{coin__selection_8cpp_a958f572860af8052b3df1e395785077a} 
BENCHMARK (\begin{DoxyParamCaption}\item[{Bn\+BExhaustion}]{}{, }\item[{\textbf{ benchmark\+::\+Priority\+Level\+::\+HIGH}}]{}{}\end{DoxyParamCaption})}

\index{coin\_selection.cpp@{coin\_selection.cpp}!BENCHMARK@{BENCHMARK}}
\index{BENCHMARK@{BENCHMARK}!coin\_selection.cpp@{coin\_selection.cpp}}
\doxysubsubsection{BENCHMARK()\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \label{coin__selection_8cpp_afe4de83517fd79851e138221fa3ad652} 
BENCHMARK (\begin{DoxyParamCaption}\item[{Coin\+Selection}]{}{, }\item[{\textbf{ benchmark\+::\+Priority\+Level\+::\+HIGH}}]{}{}\end{DoxyParamCaption})}

\index{coin\_selection.cpp@{coin\_selection.cpp}!CreateMockableWalletDatabase@{CreateMockableWalletDatabase}}
\index{CreateMockableWalletDatabase@{CreateMockableWalletDatabase}!coin\_selection.cpp@{coin\_selection.cpp}}
\doxysubsubsection{CreateMockableWalletDatabase()}
{\footnotesize\ttfamily \label{coin__selection_8cpp_afb149a6708bc72ecd7575756c8bbe376} 
std\+::unique\+\_\+ptr$<$ Wallet\+Database $>$ Create\+Mockable\+Wallet\+Database (\begin{DoxyParamCaption}\item[{Mockable\+Data}]{records}{ = {\ttfamily \{\}}}\end{DoxyParamCaption})}

\index{coin\_selection.cpp@{coin\_selection.cpp}!SelectCoinsBnB@{SelectCoinsBnB}}
\index{SelectCoinsBnB@{SelectCoinsBnB}!coin\_selection.cpp@{coin\_selection.cpp}}
\doxysubsubsection{SelectCoinsBnB()}
{\footnotesize\ttfamily \label{coin__selection_8cpp_ad1c35daf937f11a4748881d0cf0bde85} 
\textbf{ util\+::\+Result}$<$ Selection\+Result $>$ Select\+Coins\+BnB (\begin{DoxyParamCaption}\item[{std\+::vector$<$ \textbf{ Output\+Group} $>$ \&}]{utxo\+\_\+pool}{, }\item[{const \textbf{ CAmount} \&}]{selection\+\_\+target}{, }\item[{const \textbf{ CAmount} \&}]{cost\+\_\+of\+\_\+change}{, }\item[{int}]{max\+\_\+selection\+\_\+weight}{}\end{DoxyParamCaption})}

