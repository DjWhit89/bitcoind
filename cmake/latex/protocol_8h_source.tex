\doxysection{protocol.\+h}
\label{protocol_8h_source}\index{src/protocol.h@{src/protocol.h}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (c)\ 2009-\/2010\ Satoshi\ Nakamoto}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Copyright\ (c)\ 2009-\/present\ The\ Bitcoin\ Core\ developers}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ Distributed\ under\ the\ MIT\ software\ license,\ see\ the\ accompanying}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ file\ COPYING\ or\ http://www.opensource.org/licenses/mit-\/license.php.}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#ifndef\ BITCOIN\_PROTOCOL\_H}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#define\ BITCOIN\_PROTOCOL\_H}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <kernel/messagestartchars.h>}\ \textcolor{comment}{//\ IWYU\ pragma:\ export}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <netaddress.h>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <primitives/transaction.h>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <serialize.h>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <streams.h>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <uint256.h>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <util/time.h>}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <array>}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <cstdint>}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <limits>}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00028\ \textcolor{keyword}{class\ }CMessageHeader}
\DoxyCodeLine{00029\ \{}
\DoxyCodeLine{00030\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{size\_t}\ MESSAGE\_TYPE\_SIZE\ =\ 12;}
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{size\_t}\ MESSAGE\_SIZE\_SIZE\ =\ 4;}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{size\_t}\ CHECKSUM\_SIZE\ =\ 4;}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{size\_t}\ MESSAGE\_SIZE\_OFFSET\ =\ std::tuple\_size\_v<MessageStartChars>\ +\ MESSAGE\_TYPE\_SIZE;}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{size\_t}\ CHECKSUM\_OFFSET\ =\ MESSAGE\_SIZE\_OFFSET\ +\ MESSAGE\_SIZE\_SIZE;}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{size\_t}\ HEADER\_SIZE\ =\ std::tuple\_size\_v<MessageStartChars>\ +\ MESSAGE\_TYPE\_SIZE\ +\ MESSAGE\_SIZE\_SIZE\ +\ CHECKSUM\_SIZE;}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keyword}{explicit}\ CMessageHeader()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00043\ \ \ \ \ CMessageHeader(\textcolor{keyword}{const}\ MessageStartChars\&\ pchMessageStartIn,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ msg\_type,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nMessageSizeIn);}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ std::string\ GetMessageType()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordtype}{bool}\ IsMessageTypeValid()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ SERIALIZE\_METHODS(CMessageHeader,\ obj)\ \{\ READWRITE(obj.pchMessageStart,\ obj.m\_msg\_type,\ obj.nMessageSize,\ obj.pchChecksum);\ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ MessageStartChars\ pchMessageStart\{\};}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordtype}{char}\ m\_msg\_type[MESSAGE\_TYPE\_SIZE]\{\};}
\DoxyCodeLine{00052\ \ \ \ \ uint32\_t\ nMessageSize\{std::numeric\_limits<uint32\_t>::max()\};}
\DoxyCodeLine{00053\ \ \ \ \ uint8\_t\ pchChecksum[CHECKSUM\_SIZE]\{\};}
\DoxyCodeLine{00054\ \};}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00060\ \textcolor{keyword}{namespace\ }NetMsgType\ \{}
\DoxyCodeLine{00065\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ VERSION\{\textcolor{stringliteral}{"{}version"{}}\};}
\DoxyCodeLine{00070\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ VERACK\{\textcolor{stringliteral}{"{}verack"{}}\};}
\DoxyCodeLine{00075\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ ADDR\{\textcolor{stringliteral}{"{}addr"{}}\};}
\DoxyCodeLine{00081\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ ADDRV2\{\textcolor{stringliteral}{"{}addrv2"{}}\};}
\DoxyCodeLine{00087\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ SENDADDRV2\{\textcolor{stringliteral}{"{}sendaddrv2"{}}\};}
\DoxyCodeLine{00092\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ INV\{\textcolor{stringliteral}{"{}inv"{}}\};}
\DoxyCodeLine{00096\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ GETDATA\{\textcolor{stringliteral}{"{}getdata"{}}\};}
\DoxyCodeLine{00102\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ MERKLEBLOCK\{\textcolor{stringliteral}{"{}merkleblock"{}}\};}
\DoxyCodeLine{00107\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ GETBLOCKS\{\textcolor{stringliteral}{"{}getblocks"{}}\};}
\DoxyCodeLine{00113\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ GETHEADERS\{\textcolor{stringliteral}{"{}getheaders"{}}\};}
\DoxyCodeLine{00117\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ TX\{\textcolor{stringliteral}{"{}tx"{}}\};}
\DoxyCodeLine{00123\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ HEADERS\{\textcolor{stringliteral}{"{}headers"{}}\};}
\DoxyCodeLine{00127\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ BLOCK\{\textcolor{stringliteral}{"{}block"{}}\};}
\DoxyCodeLine{00132\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ GETADDR\{\textcolor{stringliteral}{"{}getaddr"{}}\};}
\DoxyCodeLine{00139\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ MEMPOOL\{\textcolor{stringliteral}{"{}mempool"{}}\};}
\DoxyCodeLine{00144\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ PING\{\textcolor{stringliteral}{"{}ping"{}}\};}
\DoxyCodeLine{00150\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ PONG\{\textcolor{stringliteral}{"{}pong"{}}\};}
\DoxyCodeLine{00156\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ NOTFOUND\{\textcolor{stringliteral}{"{}notfound"{}}\};}
\DoxyCodeLine{00164\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ FILTERLOAD\{\textcolor{stringliteral}{"{}filterload"{}}\};}
\DoxyCodeLine{00172\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ FILTERADD\{\textcolor{stringliteral}{"{}filteradd"{}}\};}
\DoxyCodeLine{00180\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ FILTERCLEAR\{\textcolor{stringliteral}{"{}filterclear"{}}\};}
\DoxyCodeLine{00186\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ SENDHEADERS\{\textcolor{stringliteral}{"{}sendheaders"{}}\};}
\DoxyCodeLine{00192\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ FEEFILTER\{\textcolor{stringliteral}{"{}feefilter"{}}\};}
\DoxyCodeLine{00200\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ SENDCMPCT\{\textcolor{stringliteral}{"{}sendcmpct"{}}\};}
\DoxyCodeLine{00206\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ CMPCTBLOCK\{\textcolor{stringliteral}{"{}cmpctblock"{}}\};}
\DoxyCodeLine{00212\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ GETBLOCKTXN\{\textcolor{stringliteral}{"{}getblocktxn"{}}\};}
\DoxyCodeLine{00218\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ BLOCKTXN\{\textcolor{stringliteral}{"{}blocktxn"{}}\};}
\DoxyCodeLine{00224\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ GETCFILTERS\{\textcolor{stringliteral}{"{}getcfilters"{}}\};}
\DoxyCodeLine{00229\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ CFILTER\{\textcolor{stringliteral}{"{}cfilter"{}}\};}
\DoxyCodeLine{00237\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ GETCFHEADERS\{\textcolor{stringliteral}{"{}getcfheaders"{}}\};}
\DoxyCodeLine{00242\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ CFHEADERS\{\textcolor{stringliteral}{"{}cfheaders"{}}\};}
\DoxyCodeLine{00249\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ GETCFCHECKPT\{\textcolor{stringliteral}{"{}getcfcheckpt"{}}\};}
\DoxyCodeLine{00254\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ CFCHECKPT\{\textcolor{stringliteral}{"{}cfcheckpt"{}}\};}
\DoxyCodeLine{00260\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ WTXIDRELAY\{\textcolor{stringliteral}{"{}wtxidrelay"{}}\};}
\DoxyCodeLine{00266\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ SENDTXRCNCL\{\textcolor{stringliteral}{"{}sendtxrcncl"{}}\};}
\DoxyCodeLine{00267\ \};\ \textcolor{comment}{//\ namespace\ NetMsgType}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00270\ \textcolor{keyword}{inline}\ \textcolor{keyword}{const}\ std::array\ ALL\_NET\_MESSAGE\_TYPES\{std::to\_array<std::string>(\{}
\DoxyCodeLine{00271\ \ \ \ \ NetMsgType::VERSION,}
\DoxyCodeLine{00272\ \ \ \ \ NetMsgType::VERACK,}
\DoxyCodeLine{00273\ \ \ \ \ NetMsgType::ADDR,}
\DoxyCodeLine{00274\ \ \ \ \ NetMsgType::ADDRV2,}
\DoxyCodeLine{00275\ \ \ \ \ NetMsgType::SENDADDRV2,}
\DoxyCodeLine{00276\ \ \ \ \ NetMsgType::INV,}
\DoxyCodeLine{00277\ \ \ \ \ NetMsgType::GETDATA,}
\DoxyCodeLine{00278\ \ \ \ \ NetMsgType::MERKLEBLOCK,}
\DoxyCodeLine{00279\ \ \ \ \ NetMsgType::GETBLOCKS,}
\DoxyCodeLine{00280\ \ \ \ \ NetMsgType::GETHEADERS,}
\DoxyCodeLine{00281\ \ \ \ \ NetMsgType::TX,}
\DoxyCodeLine{00282\ \ \ \ \ NetMsgType::HEADERS,}
\DoxyCodeLine{00283\ \ \ \ \ NetMsgType::BLOCK,}
\DoxyCodeLine{00284\ \ \ \ \ NetMsgType::GETADDR,}
\DoxyCodeLine{00285\ \ \ \ \ NetMsgType::MEMPOOL,}
\DoxyCodeLine{00286\ \ \ \ \ NetMsgType::PING,}
\DoxyCodeLine{00287\ \ \ \ \ NetMsgType::PONG,}
\DoxyCodeLine{00288\ \ \ \ \ NetMsgType::NOTFOUND,}
\DoxyCodeLine{00289\ \ \ \ \ NetMsgType::FILTERLOAD,}
\DoxyCodeLine{00290\ \ \ \ \ NetMsgType::FILTERADD,}
\DoxyCodeLine{00291\ \ \ \ \ NetMsgType::FILTERCLEAR,}
\DoxyCodeLine{00292\ \ \ \ \ NetMsgType::SENDHEADERS,}
\DoxyCodeLine{00293\ \ \ \ \ NetMsgType::FEEFILTER,}
\DoxyCodeLine{00294\ \ \ \ \ NetMsgType::SENDCMPCT,}
\DoxyCodeLine{00295\ \ \ \ \ NetMsgType::CMPCTBLOCK,}
\DoxyCodeLine{00296\ \ \ \ \ NetMsgType::GETBLOCKTXN,}
\DoxyCodeLine{00297\ \ \ \ \ NetMsgType::BLOCKTXN,}
\DoxyCodeLine{00298\ \ \ \ \ NetMsgType::GETCFILTERS,}
\DoxyCodeLine{00299\ \ \ \ \ NetMsgType::CFILTER,}
\DoxyCodeLine{00300\ \ \ \ \ NetMsgType::GETCFHEADERS,}
\DoxyCodeLine{00301\ \ \ \ \ NetMsgType::CFHEADERS,}
\DoxyCodeLine{00302\ \ \ \ \ NetMsgType::GETCFCHECKPT,}
\DoxyCodeLine{00303\ \ \ \ \ NetMsgType::CFCHECKPT,}
\DoxyCodeLine{00304\ \ \ \ \ NetMsgType::WTXIDRELAY,}
\DoxyCodeLine{00305\ \ \ \ \ NetMsgType::SENDTXRCNCL,}
\DoxyCodeLine{00306\ \})\};}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00309\ \textcolor{keyword}{enum}\ ServiceFlags\ :\ uint64\_t\ \{}
\DoxyCodeLine{00310\ \ \ \ \ \textcolor{comment}{//\ NOTE:\ When\ adding\ here,\ be\ sure\ to\ update\ serviceFlagToStr\ too}}
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{comment}{//\ Nothing}}
\DoxyCodeLine{00312\ \ \ \ \ NODE\_NONE\ =\ 0,}
\DoxyCodeLine{00313\ \ \ \ \ \textcolor{comment}{//\ NODE\_NETWORK\ means\ that\ the\ node\ is\ capable\ of\ serving\ the\ complete\ block\ chain.\ It\ is\ currently}}
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{comment}{//\ set\ by\ all\ Bitcoin\ Core\ non\ pruned\ nodes,\ and\ is\ unset\ by\ SPV\ clients\ or\ other\ light\ clients.}}
\DoxyCodeLine{00315\ \ \ \ \ NODE\_NETWORK\ =\ (1\ <<\ 0),}
\DoxyCodeLine{00316\ \ \ \ \ \textcolor{comment}{//\ NODE\_BLOOM\ means\ the\ node\ is\ capable\ and\ willing\ to\ handle\ bloom-\/filtered\ connections.}}
\DoxyCodeLine{00317\ \ \ \ \ NODE\_BLOOM\ =\ (1\ <<\ 2),}
\DoxyCodeLine{00318\ \ \ \ \ \textcolor{comment}{//\ NODE\_WITNESS\ indicates\ that\ a\ node\ can\ be\ asked\ for\ blocks\ and\ transactions\ including}}
\DoxyCodeLine{00319\ \ \ \ \ \textcolor{comment}{//\ witness\ data.}}
\DoxyCodeLine{00320\ \ \ \ \ NODE\_WITNESS\ =\ (1\ <<\ 3),}
\DoxyCodeLine{00321\ \ \ \ \ \textcolor{comment}{//\ NODE\_COMPACT\_FILTERS\ means\ the\ node\ will\ service\ basic\ block\ filter\ requests.}}
\DoxyCodeLine{00322\ \ \ \ \ \textcolor{comment}{//\ See\ BIP157\ and\ BIP158\ for\ details\ on\ how\ this\ is\ implemented.}}
\DoxyCodeLine{00323\ \ \ \ \ NODE\_COMPACT\_FILTERS\ =\ (1\ <<\ 6),}
\DoxyCodeLine{00324\ \ \ \ \ \textcolor{comment}{//\ NODE\_NETWORK\_LIMITED\ means\ the\ same\ as\ NODE\_NETWORK\ with\ the\ limitation\ of\ only}}
\DoxyCodeLine{00325\ \ \ \ \ \textcolor{comment}{//\ serving\ the\ last\ 288\ (2\ day)\ blocks}}
\DoxyCodeLine{00326\ \ \ \ \ \textcolor{comment}{//\ See\ BIP159\ for\ details\ on\ how\ this\ is\ implemented.}}
\DoxyCodeLine{00327\ \ \ \ \ NODE\_NETWORK\_LIMITED\ =\ (1\ <<\ 10),}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ \ \ \ \ \textcolor{comment}{//\ NODE\_P2P\_V2\ means\ the\ node\ supports\ BIP324\ transport}}
\DoxyCodeLine{00330\ \ \ \ \ NODE\_P2P\_V2\ =\ (1\ <<\ 11),}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ \ \ \ \ \textcolor{comment}{//\ Bits\ 24-\/31\ are\ reserved\ for\ temporary\ experiments.\ Just\ pick\ a\ bit\ that}}
\DoxyCodeLine{00333\ \ \ \ \ \textcolor{comment}{//\ isn't\ getting\ used,\ or\ one\ not\ being\ used\ much,\ and\ notify\ the}}
\DoxyCodeLine{00334\ \ \ \ \ \textcolor{comment}{//\ bitcoin-\/development\ mailing\ list.\ Remember\ that\ service\ bits\ are\ just}}
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{comment}{//\ unauthenticated\ advertisements,\ so\ your\ code\ must\ be\ robust\ against}}
\DoxyCodeLine{00336\ \ \ \ \ \textcolor{comment}{//\ collisions\ and\ other\ cases\ where\ nodes\ may\ be\ advertising\ a\ service\ they}}
\DoxyCodeLine{00337\ \ \ \ \ \textcolor{comment}{//\ do\ not\ actually\ support.\ Other\ service\ bits\ should\ be\ allocated\ via\ the}}
\DoxyCodeLine{00338\ \ \ \ \ \textcolor{comment}{//\ BIP\ process.}}
\DoxyCodeLine{00339\ \};}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00346\ std::vector<std::string>\ serviceFlagsToStr(uint64\_t\ flags);}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00354\ \textcolor{keyword}{constexpr}\ ServiceFlags\ SeedsServiceFlags()\ \{\ \textcolor{keywordflow}{return}\ ServiceFlags(NODE\_NETWORK\ |\ NODE\_WITNESS);\ \}}
\DoxyCodeLine{00355\ }
\DoxyCodeLine{00360\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ MayHaveUsefulAddressDB(ServiceFlags\ services)}
\DoxyCodeLine{00361\ \{}
\DoxyCodeLine{00362\ \ \ \ \ \textcolor{keywordflow}{return}\ (services\ \&\ NODE\_NETWORK)\ ||\ (services\ \&\ NODE\_NETWORK\_LIMITED);}
\DoxyCodeLine{00363\ \}}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00366\ \textcolor{keyword}{class\ }CAddress\ :\ \textcolor{keyword}{public}\ CService}
\DoxyCodeLine{00367\ \{}
\DoxyCodeLine{00368\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ std::chrono::seconds\ TIME\_INIT\{100000000\};}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00386\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ uint32\_t\ DISK\_VERSION\_INIT\{220000\};}
\DoxyCodeLine{00387\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ uint32\_t\ DISK\_VERSION\_IGNORE\_MASK\{0b00000000'00000111'11111111'11111111\};}
\DoxyCodeLine{00391\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ uint32\_t\ DISK\_VERSION\_ADDRV2\{1\ <<\ 29\};}
\DoxyCodeLine{00392\ \ \ \ \ \textcolor{keyword}{static\_assert}((DISK\_VERSION\_INIT\ \&\ \string~DISK\_VERSION\_IGNORE\_MASK)\ ==\ 0,\ \textcolor{stringliteral}{"{}DISK\_VERSION\_INIT\ must\ be\ covered\ by\ DISK\_VERSION\_IGNORE\_MASK"{}});}
\DoxyCodeLine{00393\ \ \ \ \ \textcolor{keyword}{static\_assert}((DISK\_VERSION\_ADDRV2\ \&\ DISK\_VERSION\_IGNORE\_MASK)\ ==\ 0,\ \textcolor{stringliteral}{"{}DISK\_VERSION\_ADDRV2\ must\ not\ be\ covered\ by\ DISK\_VERSION\_IGNORE\_MASK"{}});}
\DoxyCodeLine{00394\ }
\DoxyCodeLine{00395\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00396\ \ \ \ \ CAddress()\ :\ CService\{\}\ \{\};}
\DoxyCodeLine{00397\ \ \ \ \ CAddress(CService\ ipIn,\ ServiceFlags\ nServicesIn)\ :\ CService\{ipIn\},\ nServices\{nServicesIn\}\ \{\};}
\DoxyCodeLine{00398\ \ \ \ \ CAddress(CService\ ipIn,\ ServiceFlags\ nServicesIn,\ NodeSeconds\ time)\ :\ CService\{ipIn\},\ nTime\{time\},\ nServices\{nServicesIn\}\ \{\};}
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ \ \ \ \ \textcolor{keyword}{enum\ class}\ Format\ \{}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ Disk,}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ Network,}
\DoxyCodeLine{00403\ \ \ \ \ \};}
\DoxyCodeLine{00404\ \ \ \ \ \textcolor{keyword}{struct\ }SerParams\ :\ CNetAddr::SerParams\ \{}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Format\ fmt;}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ SER\_PARAMS\_OPFUNC}
\DoxyCodeLine{00407\ \ \ \ \ \};}
\DoxyCodeLine{00408\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ SerParams\ V1\_NETWORK\{\{CNetAddr::Encoding::V1\},\ Format::Network\};}
\DoxyCodeLine{00409\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ SerParams\ V2\_NETWORK\{\{CNetAddr::Encoding::V2\},\ Format::Network\};}
\DoxyCodeLine{00410\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ SerParams\ V1\_DISK\{\{CNetAddr::Encoding::V1\},\ Format::Disk\};}
\DoxyCodeLine{00411\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ SerParams\ V2\_DISK\{\{CNetAddr::Encoding::V2\},\ Format::Disk\};}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ \ \ \ \ SERIALIZE\_METHODS(CAddress,\ obj)}
\DoxyCodeLine{00414\ \ \ \ \ \{}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ use\_v2;}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ params\ =\ SER\_PARAMS(SerParams);}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (params.fmt\ ==\ Format::Disk)\ \{}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ In\ the\ disk\ serialization\ format,\ the\ encoding\ (v1\ or\ v2)\ is\ determined\ by\ a\ flag\ version}}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ that's\ part\ of\ the\ serialization\ itself.\ ADDRV2\_FORMAT\ in\ the\ stream\ version\ only\ determines}}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ whether\ V2\ is\ chosen/permitted\ at\ all.}}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ stored\_format\_version\ =\ DISK\_VERSION\_INIT;}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (params.enc\ ==\ Encoding::V2)\ stored\_format\_version\ |=\ DISK\_VERSION\_ADDRV2;}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \ \ READWRITE(stored\_format\_version);}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ \ \ stored\_format\_version\ \&=\ \string~DISK\_VERSION\_IGNORE\_MASK;\ \textcolor{comment}{//\ ignore\ low\ bits}}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (stored\_format\_version\ ==\ 0)\ \{}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ use\_v2\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (stored\_format\_version\ ==\ DISK\_VERSION\_ADDRV2\ \&\&\ params.enc\ ==\ Encoding::V2)\ \{}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ support\ v2\ deserialization\ if\ V2\ is\ set.}}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ use\_v2\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::ios\_base::failure(\textcolor{stringliteral}{"{}Unsupported\ CAddress\ disk\ format\ version"{}});}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \ \ \ \ assert(params.fmt\ ==\ Format::Network);}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ In\ the\ network\ serialization\ format,\ the\ encoding\ (v1\ or\ v2)\ is\ determined\ directly\ by}}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ value\ of\ enc\ in\ the\ stream\ params,\ as\ no\ explicitly\ encoded\ version}}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ exists\ in\ the\ stream.}}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \ \ \ use\_v2\ =\ params.enc\ ==\ Encoding::V2;}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00440\ }
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ READWRITE(Using<LossyChronoFormatter<uint32\_t>>(obj.nTime));}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ nServices\ is\ serialized\ as\ CompactSize\ in\ V2;\ as\ uint64\_t\ in\ V1.}}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (use\_v2)\ \{}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ services\_tmp;}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \ \ \ \ SER\_WRITE(obj,\ services\_tmp\ =\ obj.nServices);}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ \ \ \ \ READWRITE(Using<CompactSizeFormatter<false>>(services\_tmp));}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \ \ \ \ SER\_READ(obj,\ obj.nServices\ =\ \textcolor{keyword}{static\_cast<}ServiceFlags\textcolor{keyword}{>}(services\_tmp));}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ \ \ \ \ READWRITE(Using<CustomUintFormatter<8>>(obj.nServices));}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Invoke\ V1/V2\ serializer\ for\ CService\ parent\ object.}}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ ser\_params\{use\_v2\ ?\ CNetAddr::V2\ :\ CNetAddr::V1\};}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ READWRITE(ser\_params(AsBase<CService>(obj)));}
\DoxyCodeLine{00454\ \ \ \ \ \}}
\DoxyCodeLine{00455\ }
\DoxyCodeLine{00457\ \ \ \ \ NodeSeconds\ nTime\{TIME\_INIT\};}
\DoxyCodeLine{00459\ \ \ \ \ ServiceFlags\ nServices\{NODE\_NONE\};}
\DoxyCodeLine{00460\ }
\DoxyCodeLine{00461\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keywordtype}{bool}\ operator==(\textcolor{keyword}{const}\ CAddress\&\ a,\ \textcolor{keyword}{const}\ CAddress\&\ b)}
\DoxyCodeLine{00462\ \ \ \ \ \{}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ a.nTime\ ==\ b.nTime\ \&\&}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ a.nServices\ ==\ b.nServices\ \&\&}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }CService\&\textcolor{keyword}{>}(a)\ ==\ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }CService\&\textcolor{keyword}{>}(b);}
\DoxyCodeLine{00466\ \ \ \ \ \}}
\DoxyCodeLine{00467\ \};}
\DoxyCodeLine{00468\ }
\DoxyCodeLine{00470\ \textcolor{keyword}{const}\ uint32\_t\ MSG\_WITNESS\_FLAG\ =\ 1\ <<\ 30;}
\DoxyCodeLine{00471\ \textcolor{keyword}{const}\ uint32\_t\ MSG\_TYPE\_MASK\ =\ 0xffffffff\ >>\ 2;}
\DoxyCodeLine{00472\ }
\DoxyCodeLine{00477\ \textcolor{keyword}{enum}\ GetDataMsg\ :\ uint32\_t\ \{}
\DoxyCodeLine{00478\ \ \ \ \ UNDEFINED\ =\ 0,}
\DoxyCodeLine{00479\ \ \ \ \ MSG\_TX\ =\ 1,}
\DoxyCodeLine{00480\ \ \ \ \ MSG\_BLOCK\ =\ 2,}
\DoxyCodeLine{00481\ \ \ \ \ MSG\_WTX\ =\ 5,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00482\ \ \ \ \ \textcolor{comment}{//\ The\ following\ can\ only\ occur\ in\ getdata.\ Invs\ always\ use\ TX/WTX\ or\ BLOCK.}}
\DoxyCodeLine{00483\ \ \ \ \ MSG\_FILTERED\_BLOCK\ =\ 3,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00484\ \ \ \ \ MSG\_CMPCT\_BLOCK\ =\ 4,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00485\ \ \ \ \ MSG\_WITNESS\_BLOCK\ =\ MSG\_BLOCK\ |\ MSG\_WITNESS\_FLAG,\ }
\DoxyCodeLine{00486\ \ \ \ \ MSG\_WITNESS\_TX\ =\ MSG\_TX\ |\ MSG\_WITNESS\_FLAG,\ \ \ \ \ \ \ }
\DoxyCodeLine{00487\ \ \ \ \ \textcolor{comment}{//\ MSG\_FILTERED\_WITNESS\_BLOCK\ is\ defined\ in\ BIP144\ as\ reserved\ for\ future}}
\DoxyCodeLine{00488\ \ \ \ \ \textcolor{comment}{//\ use\ and\ remains\ unused.}}
\DoxyCodeLine{00489\ \ \ \ \ \textcolor{comment}{//\ MSG\_FILTERED\_WITNESS\_BLOCK\ =\ MSG\_FILTERED\_BLOCK\ |\ MSG\_WITNESS\_FLAG,}}
\DoxyCodeLine{00490\ \};}
\DoxyCodeLine{00491\ }
\DoxyCodeLine{00493\ \textcolor{keyword}{class\ }CInv}
\DoxyCodeLine{00494\ \{}
\DoxyCodeLine{00495\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00496\ \ \ \ \ CInv();}
\DoxyCodeLine{00497\ \ \ \ \ CInv(uint32\_t\ typeIn,\ \textcolor{keyword}{const}\ uint256\&\ hashIn);}
\DoxyCodeLine{00498\ }
\DoxyCodeLine{00499\ \ \ \ \ SERIALIZE\_METHODS(CInv,\ obj)\ \{\ READWRITE(obj.type,\ obj.hash);\ \}}
\DoxyCodeLine{00500\ }
\DoxyCodeLine{00501\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keywordtype}{bool}\ operator<(\textcolor{keyword}{const}\ CInv\&\ a,\ \textcolor{keyword}{const}\ CInv\&\ b);}
\DoxyCodeLine{00502\ }
\DoxyCodeLine{00503\ \ \ \ \ std::string\ GetMessageType()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00504\ \ \ \ \ std::string\ ToString()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00505\ }
\DoxyCodeLine{00506\ \ \ \ \ \textcolor{comment}{//\ Single-\/message\ helper\ methods}}
\DoxyCodeLine{00507\ \ \ \ \ \textcolor{keywordtype}{bool}\ IsMsgTx()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ type\ ==\ MSG\_TX;\ \}}
\DoxyCodeLine{00508\ \ \ \ \ \textcolor{keywordtype}{bool}\ IsMsgBlk()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ type\ ==\ MSG\_BLOCK;\ \}}
\DoxyCodeLine{00509\ \ \ \ \ \textcolor{keywordtype}{bool}\ IsMsgWtx()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ type\ ==\ MSG\_WTX;\ \}}
\DoxyCodeLine{00510\ \ \ \ \ \textcolor{keywordtype}{bool}\ IsMsgFilteredBlk()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ type\ ==\ MSG\_FILTERED\_BLOCK;\ \}}
\DoxyCodeLine{00511\ \ \ \ \ \textcolor{keywordtype}{bool}\ IsMsgCmpctBlk()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ type\ ==\ MSG\_CMPCT\_BLOCK;\ \}}
\DoxyCodeLine{00512\ \ \ \ \ \textcolor{keywordtype}{bool}\ IsMsgWitnessBlk()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ type\ ==\ MSG\_WITNESS\_BLOCK;\ \}}
\DoxyCodeLine{00513\ }
\DoxyCodeLine{00514\ \ \ \ \ \textcolor{comment}{//\ Combined-\/message\ helper\ methods}}
\DoxyCodeLine{00515\ \ \ \ \ \textcolor{keywordtype}{bool}\ IsGenTxMsg()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00516\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ type\ ==\ MSG\_TX\ ||\ type\ ==\ MSG\_WTX\ ||\ type\ ==\ MSG\_WITNESS\_TX;}
\DoxyCodeLine{00518\ \ \ \ \ \}}
\DoxyCodeLine{00519\ \ \ \ \ \textcolor{keywordtype}{bool}\ IsGenBlkMsg()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00520\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ type\ ==\ MSG\_BLOCK\ ||\ type\ ==\ MSG\_FILTERED\_BLOCK\ ||\ type\ ==\ MSG\_CMPCT\_BLOCK\ ||\ type\ ==\ MSG\_WITNESS\_BLOCK;}
\DoxyCodeLine{00522\ \ \ \ \ \}}
\DoxyCodeLine{00523\ }
\DoxyCodeLine{00524\ \ \ \ \ uint32\_t\ type;}
\DoxyCodeLine{00525\ \ \ \ \ uint256\ hash;}
\DoxyCodeLine{00526\ \};}
\DoxyCodeLine{00527\ }
\DoxyCodeLine{00529\ GenTxid\ ToGenTxid(\textcolor{keyword}{const}\ CInv\&\ inv);}
\DoxyCodeLine{00530\ }
\DoxyCodeLine{00531\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ BITCOIN\_PROTOCOL\_H}}

\end{DoxyCode}
