\doxysection{src/common/pcp.cpp File Reference}
\label{common_2pcp_8cpp}\index{src/common/pcp.cpp@{src/common/pcp.cpp}}
{\ttfamily \#include $<$common/pcp.\+h$>$}\newline
{\ttfamily \#include $<$common/netif.\+h$>$}\newline
{\ttfamily \#include $<$crypto/common.\+h$>$}\newline
{\ttfamily \#include $<$logging.\+h$>$}\newline
{\ttfamily \#include $<$netaddress.\+h$>$}\newline
{\ttfamily \#include $<$netbase.\+h$>$}\newline
{\ttfamily \#include $<$random.\+h$>$}\newline
{\ttfamily \#include $<$span.\+h$>$}\newline
{\ttfamily \#include $<$util/check.\+h$>$}\newline
{\ttfamily \#include $<$util/readwritefile.\+h$>$}\newline
{\ttfamily \#include $<$util/sock.\+h$>$}\newline
{\ttfamily \#include $<$util/strencodings.\+h$>$}\newline
{\ttfamily \#include $<$util/threadinterrupt.\+h$>$}\newline
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
std\+::variant$<$ \textbf{ Mapping\+Result}, \textbf{ Mapping\+Error} $>$ \textbf{ NATPMPRequest\+Port\+Map} (const \textbf{ CNet\+Addr} \&gateway, uint16\+\_\+t port, uint32\+\_\+t lifetime, \textbf{ CThread\+Interrupt} \&interrupt, int num\+\_\+tries, std\+::chrono\+::milliseconds timeout\+\_\+per\+\_\+try)
\item 
std\+::variant$<$ \textbf{ Mapping\+Result}, \textbf{ Mapping\+Error} $>$ \textbf{ PCPRequest\+Port\+Map} (const \textbf{ PCPMapping\+Nonce} \&\textbf{ nonce}, const \textbf{ CNet\+Addr} \&gateway, const \textbf{ CNet\+Addr} \&bind, uint16\+\_\+t port, uint32\+\_\+t lifetime, \textbf{ CThread\+Interrupt} \&interrupt, int num\+\_\+tries, std\+::chrono\+::milliseconds timeout\+\_\+per\+\_\+try)
\end{DoxyCompactItemize}


\label{doc-func-members}
\doxysubsection{Function Documentation}
\index{pcp.cpp@{pcp.cpp}!NATPMPRequestPortMap@{NATPMPRequestPortMap}}
\index{NATPMPRequestPortMap@{NATPMPRequestPortMap}!pcp.cpp@{pcp.cpp}}
\doxysubsubsection{NATPMPRequestPortMap()}
{\footnotesize\ttfamily \label{common_2pcp_8cpp_a862c9fc77990f48d908dd6f75932cb92} 
std\+::variant$<$ \textbf{ Mapping\+Result}, \textbf{ Mapping\+Error} $>$ NATPMPRequest\+Port\+Map (\begin{DoxyParamCaption}\item[{const \textbf{ CNet\+Addr} \&}]{gateway}{, }\item[{uint16\+\_\+t}]{port}{, }\item[{uint32\+\_\+t}]{lifetime}{, }\item[{\textbf{ CThread\+Interrupt} \&}]{interrupt}{, }\item[{int}]{num\+\_\+tries}{ = {\ttfamily 3}, }\item[{std\+::chrono\+::milliseconds}]{timeout\+\_\+per\+\_\+try}{ = {\ttfamily std\+:\+:chrono\+:\+:milliseconds(1000)}}\end{DoxyParamCaption})}

Try to open a port using RFC 6886 NAT-\/\+PMP. IPv4 only.


\begin{DoxyItemize}
\item gateway\+: Destination address for PCP requests (usually the default gateway).
\item port\+: Internal port, and desired external port.
\item lifetime\+: Requested lifetime in seconds for mapping. The server may assign as shorter or longer lifetime. A lifetime of 0 deletes the mapping.
\item num\+\_\+tries\+: Number of tries in case of no response.
\end{DoxyItemize}

Returns the external\+\_\+ip\+:external\+\_\+port of the mapping if successful, otherwise a \doxyref{Mapping\+Error}{p.}{pcp_8h_aa28e34b90cecaa1b5630d1c12b6c8b24}. \index{pcp.cpp@{pcp.cpp}!PCPRequestPortMap@{PCPRequestPortMap}}
\index{PCPRequestPortMap@{PCPRequestPortMap}!pcp.cpp@{pcp.cpp}}
\doxysubsubsection{PCPRequestPortMap()}
{\footnotesize\ttfamily \label{common_2pcp_8cpp_aca35c511d2afcb871e00ca441e3881c3} 
std\+::variant$<$ \textbf{ Mapping\+Result}, \textbf{ Mapping\+Error} $>$ PCPRequest\+Port\+Map (\begin{DoxyParamCaption}\item[{const \textbf{ PCPMapping\+Nonce} \&}]{nonce}{, }\item[{const \textbf{ CNet\+Addr} \&}]{gateway}{, }\item[{const \textbf{ CNet\+Addr} \&}]{bind}{, }\item[{uint16\+\_\+t}]{port}{, }\item[{uint32\+\_\+t}]{lifetime}{, }\item[{\textbf{ CThread\+Interrupt} \&}]{interrupt}{, }\item[{int}]{num\+\_\+tries}{ = {\ttfamily 3}, }\item[{std\+::chrono\+::milliseconds}]{timeout\+\_\+per\+\_\+try}{ = {\ttfamily std\+:\+:chrono\+:\+:milliseconds(1000)}}\end{DoxyParamCaption})}

Try to open a port using RFC 6887 Port Control Protocol (PCP). Handles IPv4 and IPv6.


\begin{DoxyItemize}
\item nonce\+: Mapping cookie. Keep this the same over renewals.
\item gateway\+: Destination address for PCP requests (usually the default gateway).
\item bind\+: Specific local bind address for IPv6 pinholing. Set this as INADDR\+\_\+\+ANY for IPv4.
\item port\+: Internal port, and desired external port.
\item lifetime\+: Requested lifetime in seconds for mapping. The server may assign as shorter or longer lifetime. A lifetime of 0 deletes the mapping.
\item num\+\_\+tries\+: Number of tries in case of no response.
\end{DoxyItemize}

Returns the external\+\_\+ip\+:external\+\_\+port of the mapping if successful, otherwise a \doxyref{Mapping\+Error}{p.}{pcp_8h_aa28e34b90cecaa1b5630d1c12b6c8b24}. 