\doxysection{events.\+h}
\label{events_8h_source}\index{src/support/events.h@{src/support/events.h}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (c)\ 2016-\/present\ The\ Bitcoin\ Core\ developers}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Distributed\ under\ the\ MIT\ software\ license,\ see\ the\ accompanying}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ file\ COPYING\ or\ http://www.opensource.org/licenses/mit-\/license.php.}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#ifndef\ BITCOIN\_SUPPORT\_EVENTS\_H}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#define\ BITCOIN\_SUPPORT\_EVENTS\_H}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <ios>}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <event2/event.h>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <event2/http.h>}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#define\ MAKE\_RAII(type)\ \(\backslash\)}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{}\textcolor{comment}{/*\ deleter\ */}\textcolor{preprocessor}{\(\backslash\)}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{struct\ type\#\#\_deleter\ \{\(\backslash\)}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\ \ \ \ void\ operator()(struct\ type*\ ob)\ \{\(\backslash\)}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ type\#\#\_free(ob);\(\backslash\)}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\ \ \ \ \}\(\backslash\)}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\};\(\backslash\)}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{}\textcolor{comment}{/*\ unique\ ptr\ typedef\ */}\textcolor{preprocessor}{\(\backslash\)}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{typedef\ std::unique\_ptr<struct\ type,\ type\#\#\_deleter>\ raii\_\#\#type}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ MAKE\_RAII(event\_base);}
\DoxyCodeLine{00025\ MAKE\_RAII(event);}
\DoxyCodeLine{00026\ MAKE\_RAII(evhttp);}
\DoxyCodeLine{00027\ MAKE\_RAII(evhttp\_request);}
\DoxyCodeLine{00028\ MAKE\_RAII(evhttp\_connection);}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{keyword}{inline}\ raii\_event\_base\ obtain\_event\_base()\ \{}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keyword}{auto}\ result\ =\ raii\_event\_base(event\_base\_new());}
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{keywordflow}{if}\ (!result.get())}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}cannot\ create\ event\_base"{}});}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00035\ \}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \textcolor{keyword}{inline}\ raii\_event\ obtain\_event(\textcolor{keyword}{struct}\ event\_base*\ base,\ evutil\_socket\_t\ s,\ \textcolor{keywordtype}{short}\ events,\ event\_callback\_fn\ cb,\ \textcolor{keywordtype}{void}*\ arg)\ \{}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keywordflow}{return}\ raii\_event(event\_new(base,\ s,\ events,\ cb,\ arg));}
\DoxyCodeLine{00039\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \textcolor{keyword}{inline}\ raii\_evhttp\ obtain\_evhttp(\textcolor{keyword}{struct}\ event\_base*\ base)\ \{}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordflow}{return}\ raii\_evhttp(evhttp\_new(base));}
\DoxyCodeLine{00043\ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \textcolor{keyword}{inline}\ raii\_evhttp\_request\ obtain\_evhttp\_request(\textcolor{keywordtype}{void}(*cb)(\textcolor{keyword}{struct}\ evhttp\_request\ *,\ \textcolor{keywordtype}{void}\ *),\ \textcolor{keywordtype}{void}\ *arg)\ \{}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordflow}{return}\ raii\_evhttp\_request(evhttp\_request\_new(cb,\ arg));}
\DoxyCodeLine{00047\ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \textcolor{keyword}{inline}\ raii\_evhttp\_connection\ obtain\_evhttp\_connection\_base(\textcolor{keyword}{struct}\ event\_base*\ base,\ std::string\ host,\ uint16\_t\ port)\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keyword}{auto}\ result\ =\ raii\_evhttp\_connection(evhttp\_connection\_base\_new(base,\ \textcolor{keyword}{nullptr},\ host.c\_str(),\ port));}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordflow}{if}\ (!result.get())}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}create\ connection\ failed"{}});}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00054\ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ BITCOIN\_SUPPORT\_EVENTS\_H}}

\end{DoxyCode}
