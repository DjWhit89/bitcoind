\doxysection{src/validation.cpp File Reference}
\label{validation_8cpp}\index{src/validation.cpp@{src/validation.cpp}}
{\ttfamily \#include $<$bitcoin-\/build-\/config.\+h$>$}\newline
{\ttfamily \#include $<$validation.\+h$>$}\newline
{\ttfamily \#include $<$arith\+\_\+uint256.\+h$>$}\newline
{\ttfamily \#include $<$chain.\+h$>$}\newline
{\ttfamily \#include $<$checkqueue.\+h$>$}\newline
{\ttfamily \#include $<$clientversion.\+h$>$}\newline
{\ttfamily \#include $<$consensus/amount.\+h$>$}\newline
{\ttfamily \#include $<$consensus/consensus.\+h$>$}\newline
{\ttfamily \#include $<$consensus/merkle.\+h$>$}\newline
{\ttfamily \#include $<$consensus/tx\+\_\+check.\+h$>$}\newline
{\ttfamily \#include $<$consensus/tx\+\_\+verify.\+h$>$}\newline
{\ttfamily \#include $<$consensus/validation.\+h$>$}\newline
{\ttfamily \#include $<$cuckoocache.\+h$>$}\newline
{\ttfamily \#include $<$flatfile.\+h$>$}\newline
{\ttfamily \#include $<$hash.\+h$>$}\newline
{\ttfamily \#include $<$kernel/chainparams.\+h$>$}\newline
{\ttfamily \#include $<$kernel/coinstats.\+h$>$}\newline
{\ttfamily \#include $<$kernel/disconnected\+\_\+transactions.\+h$>$}\newline
{\ttfamily \#include $<$kernel/mempool\+\_\+entry.\+h$>$}\newline
{\ttfamily \#include $<$kernel/messagestartchars.\+h$>$}\newline
{\ttfamily \#include $<$kernel/notifications\+\_\+interface.\+h$>$}\newline
{\ttfamily \#include $<$kernel/types.\+h$>$}\newline
{\ttfamily \#include $<$kernel/warning.\+h$>$}\newline
{\ttfamily \#include $<$logging.\+h$>$}\newline
{\ttfamily \#include $<$logging/timer.\+h$>$}\newline
{\ttfamily \#include $<$node/blockstorage.\+h$>$}\newline
{\ttfamily \#include $<$node/utxo\+\_\+snapshot.\+h$>$}\newline
{\ttfamily \#include $<$policy/ephemeral\+\_\+policy.\+h$>$}\newline
{\ttfamily \#include $<$policy/policy.\+h$>$}\newline
{\ttfamily \#include $<$policy/rbf.\+h$>$}\newline
{\ttfamily \#include $<$policy/settings.\+h$>$}\newline
{\ttfamily \#include $<$policy/truc\+\_\+policy.\+h$>$}\newline
{\ttfamily \#include $<$pow.\+h$>$}\newline
{\ttfamily \#include $<$primitives/block.\+h$>$}\newline
{\ttfamily \#include $<$primitives/transaction.\+h$>$}\newline
{\ttfamily \#include $<$random.\+h$>$}\newline
{\ttfamily \#include $<$script/script.\+h$>$}\newline
{\ttfamily \#include $<$script/sigcache.\+h$>$}\newline
{\ttfamily \#include $<$signet.\+h$>$}\newline
{\ttfamily \#include $<$tinyformat.\+h$>$}\newline
{\ttfamily \#include $<$txdb.\+h$>$}\newline
{\ttfamily \#include $<$txmempool.\+h$>$}\newline
{\ttfamily \#include $<$uint256.\+h$>$}\newline
{\ttfamily \#include $<$undo.\+h$>$}\newline
{\ttfamily \#include $<$util/check.\+h$>$}\newline
{\ttfamily \#include $<$util/fs.\+h$>$}\newline
{\ttfamily \#include $<$util/fs\+\_\+helpers.\+h$>$}\newline
{\ttfamily \#include $<$util/hasher.\+h$>$}\newline
{\ttfamily \#include $<$util/moneystr.\+h$>$}\newline
{\ttfamily \#include $<$util/rbf.\+h$>$}\newline
{\ttfamily \#include $<$util/result.\+h$>$}\newline
{\ttfamily \#include $<$util/signalinterrupt.\+h$>$}\newline
{\ttfamily \#include $<$util/strencodings.\+h$>$}\newline
{\ttfamily \#include $<$util/string.\+h$>$}\newline
{\ttfamily \#include $<$util/time.\+h$>$}\newline
{\ttfamily \#include $<$util/trace.\+h$>$}\newline
{\ttfamily \#include $<$util/translation.\+h$>$}\newline
{\ttfamily \#include $<$validationinterface.\+h$>$}\newline
{\ttfamily \#include $<$algorithm$>$}\newline
{\ttfamily \#include $<$cassert$>$}\newline
{\ttfamily \#include $<$chrono$>$}\newline
{\ttfamily \#include $<$deque$>$}\newline
{\ttfamily \#include $<$numeric$>$}\newline
{\ttfamily \#include $<$optional$>$}\newline
{\ttfamily \#include $<$ranges$>$}\newline
{\ttfamily \#include $<$span$>$}\newline
{\ttfamily \#include $<$string$>$}\newline
{\ttfamily \#include $<$tuple$>$}\newline
{\ttfamily \#include $<$utility$>$}\newline
\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \textbf{ Per\+Block\+Connect\+Trace}
\item 
class \textbf{ Connect\+Trace}
\item 
struct \textbf{ Stop\+Hashing\+Exception}
\item 
class \textbf{ Notifications}
\item 
struct \textbf{ CBlock\+Index\+Height\+Only\+Comparator}
\item 
struct \textbf{ CBlock\+Index\+Work\+Comparator}
\end{DoxyCompactItemize}
\doxysubsubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
using \textbf{ Fopen\+Fn}
\item 
using \textbf{ Block\+Map}
\end{DoxyCompactItemize}
\doxysubsubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum class \textbf{ Coin\+Stats\+Hash\+Type} 
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\textbf{ TRACEPOINT\+\_\+\+SEMAPHORE} (validation, block\+\_\+connected)
\item 
\textbf{ TRACEPOINT\+\_\+\+SEMAPHORE} (utxocache, flush)
\item 
\textbf{ TRACEPOINT\+\_\+\+SEMAPHORE} (mempool, replaced)
\item 
\textbf{ TRACEPOINT\+\_\+\+SEMAPHORE} (mempool, rejected)
\item 
bool \textbf{ Check\+Input\+Scripts} (const \textbf{ CTransaction} \&tx, \textbf{ Tx\+Validation\+State} \&state, const \textbf{ CCoins\+View\+Cache} \&inputs, \textbf{ script\+\_\+verify\+\_\+flags} \textbf{ flags}, bool cache\+Sig\+Store, bool cache\+Full\+Script\+Store, \textbf{ Precomputed\+Transaction\+Data} \&txdata, \textbf{ Validation\+Cache} \&validation\+\_\+cache, std\+::vector$<$ \textbf{ CScript\+Check} $>$ $\ast$pv\+Checks=nullptr) \textbf{ EXCLUSIVE\+\_\+\+LOCKS\+\_\+\+REQUIRED}(\textbf{ cs\+\_\+main})
\item 
bool \textbf{ Check\+Final\+Tx\+At\+Tip} (const \textbf{ CBlock\+Index} \&active\+\_\+chain\+\_\+tip, const \textbf{ CTransaction} \&tx)
\item 
std\+::optional$<$ \textbf{ Lock\+Points} $>$ \textbf{ Calculate\+Lock\+Points\+At\+Tip} (\textbf{ CBlock\+Index} $\ast$tip, const \textbf{ CCoins\+View} \&coins\+\_\+view, const \textbf{ CTransaction} \&tx)
\item 
bool \textbf{ Check\+Sequence\+Locks\+At\+Tip} (\textbf{ CBlock\+Index} $\ast$tip, const \textbf{ Lock\+Points} \&lock\+\_\+points)
\item 
\textbf{ Assert\+Lock\+Held} (\textbf{ pool.\+cs})
\item 
\textbf{ assert} (!tx.\+Is\+Coin\+Base())
\item 
\textbf{ for} (const \textbf{ CTx\+In} \&txin \+:tx.\+vin)
\item 
return \textbf{ Check\+Input\+Scripts} (tx, state, view, \textbf{ flags}, true, true, txdata, validation\+\_\+cache)
\item 
\textbf{ Mempool\+Accept\+Result} \textbf{ Accept\+To\+Memory\+Pool} (\textbf{ Chainstate} \&active\+\_\+chainstate, const \textbf{ CTransaction\+Ref} \&tx, int64\+\_\+t accept\+\_\+time, bool bypass\+\_\+limits, bool test\+\_\+accept)
\item 
\textbf{ Package\+Mempool\+Accept\+Result} \textbf{ Process\+New\+Package} (\textbf{ Chainstate} \&active\+\_\+chainstate, \textbf{ CTx\+Mem\+Pool} \&pool, const \textbf{ Package} \&package, bool test\+\_\+accept, const std\+::optional$<$ \textbf{ CFee\+Rate} $>$ \&client\+\_\+maxfeerate)
\item 
\textbf{ CAmount} \textbf{ Get\+Block\+Subsidy} (int \textbf{ n\+Height}, const \textbf{ Consensus\+::\+Params} \&consensus\+Params)
\item 
void \textbf{ Update\+Coins} (const \textbf{ CTransaction} \&tx, \textbf{ CCoins\+View\+Cache} \&inputs, \textbf{ CTx\+Undo} \&txundo, int \textbf{ n\+Height})
\item 
bool \textbf{ Fatal\+Error} (\textbf{ Notifications} \&notifications, \textbf{ Block\+Validation\+State} \&state, const \textbf{ bilingual\+\_\+str} \&message)
\item 
int \textbf{ Apply\+Tx\+In\+Undo} (\textbf{ Coin} \&\&undo, \textbf{ CCoins\+View\+Cache} \&view, const \textbf{ COut\+Point} \&out)
\item 
\textbf{ script\+\_\+verify\+\_\+flags} \textbf{ Get\+Block\+Script\+Flags} (const \textbf{ CBlock\+Index} \&block\+\_\+index, const \textbf{ Chainstate\+Manager} \&chainman)
\item 
bool \textbf{ Check\+Block} (const \textbf{ CBlock} \&block, \textbf{ Block\+Validation\+State} \&state, const \textbf{ Consensus\+::\+Params} \&consensus\+Params, bool f\+Check\+POW, bool f\+Check\+Merkle\+Root)
\item 
bool \textbf{ Has\+Valid\+Proof\+Of\+Work} (const std\+::vector$<$ \textbf{ CBlock\+Header} $>$ \&headers, const \textbf{ Consensus\+::\+Params} \&consensus\+Params)
\item 
bool \textbf{ Is\+Block\+Mutated} (const \textbf{ CBlock} \&block, bool check\+\_\+witness\+\_\+root)
\item 
\textbf{ arith\+\_\+uint256} \textbf{ Calculate\+Claimed\+Headers\+Work} (std\+::span$<$ const \textbf{ CBlock\+Header} $>$ headers)
\item 
\textbf{ Block\+Validation\+State} \textbf{ Test\+Block\+Validity} (\textbf{ Chainstate} \&chainstate, const \textbf{ CBlock} \&block, const bool check\+\_\+pow, const bool check\+\_\+merkle\+\_\+root)
\item 
void \textbf{ Prune\+Block\+Files\+Manual} (\textbf{ Chainstate} \&active\+\_\+chainstate, int n\+Manual\+Prune\+Height)
\item 
bool \textbf{ Is\+BIP30\+Repeat} (const \textbf{ CBlock\+Index} \&block\+\_\+index)
\item 
bool \textbf{ Is\+BIP30\+Unspendable} (const \textbf{ uint256} \&block\+\_\+hash, int block\+\_\+height)
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const std\+::vector$<$ std\+::string $>$ \textbf{ CHECKLEVEL\+\_\+\+DOC}
\item 
static bool pool \textbf{ cs}
\end{DoxyCompactItemize}


\label{doc-typedef-members}
\doxysubsection{Typedef Documentation}
\index{validation.cpp@{validation.cpp}!BlockMap@{BlockMap}}
\index{BlockMap@{BlockMap}!validation.cpp@{validation.cpp}}
\doxysubsubsection{BlockMap}
{\footnotesize\ttfamily \label{validation_8cpp_acee0086a0c833617dd1532caf93206a3} 
using \textbf{ Block\+Map}}

\index{validation.cpp@{validation.cpp}!FopenFn@{FopenFn}}
\index{FopenFn@{FopenFn}!validation.cpp@{validation.cpp}}
\doxysubsubsection{FopenFn}
{\footnotesize\ttfamily \label{validation_8cpp_a37b0fd82fe2a81c8cf4ecedc6f083cd5} 
using \textbf{ Fopen\+Fn}}



\label{doc-enum-members}
\doxysubsection{Enumeration Type Documentation}
\index{validation.cpp@{validation.cpp}!CoinStatsHashType@{CoinStatsHashType}}
\index{CoinStatsHashType@{CoinStatsHashType}!validation.cpp@{validation.cpp}}
\doxysubsubsection{CoinStatsHashType}
{\footnotesize\ttfamily \label{validation_8cpp_a77fe3880fe4048d786e97a070552eca7} 
enum class \textbf{ Coin\+Stats\+Hash\+Type}\hspace{0.3cm}{\ttfamily [strong]}}



\label{doc-func-members}
\doxysubsection{Function Documentation}
\index{validation.cpp@{validation.cpp}!AcceptToMemoryPool@{AcceptToMemoryPool}}
\index{AcceptToMemoryPool@{AcceptToMemoryPool}!validation.cpp@{validation.cpp}}
\doxysubsubsection{AcceptToMemoryPool()}
{\footnotesize\ttfamily \label{validation_8cpp_a400e902384ac40a640a3a2dd0dba312a} 
\textbf{ Mempool\+Accept\+Result} Accept\+To\+Memory\+Pool (\begin{DoxyParamCaption}\item[{\textbf{ Chainstate} \&}]{active\+\_\+chainstate}{, }\item[{const \textbf{ CTransaction\+Ref} \&}]{tx}{, }\item[{int64\+\_\+t}]{accept\+\_\+time}{, }\item[{bool}]{bypass\+\_\+limits}{, }\item[{bool}]{test\+\_\+accept}{}\end{DoxyParamCaption})}

Try to add a transaction to the mempool. This is an internal function and is exposed only for testing. Client code should use \doxyref{Chainstate\+Manager\+::\+Process\+Transaction()}{p.}{class_chainstate_manager_a9c7d6797a606a08696d722e7489b6d4d}


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{in}}  & {\em active\+\_\+chainstate} & Reference to the active chainstate. \\
\hline
\mbox{\texttt{in}}  & {\em tx} & The transaction to submit for mempool acceptance. \\
\hline
\mbox{\texttt{in}}  & {\em accept\+\_\+time} & The timestamp for adding the transaction to the mempool. It is also used to determine when the entry expires. \\
\hline
\mbox{\texttt{in}}  & {\em bypass\+\_\+limits} & When true, don\textquotesingle{}t enforce mempool fee and capacity limits, and set entry\+\_\+sequence to zero. \\
\hline
\mbox{\texttt{in}}  & {\em test\+\_\+accept} & When true, run validation checks but don\textquotesingle{}t submit to mempool.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
a \doxyref{Mempool\+Accept\+Result}{p.}{struct_mempool_accept_result} indicating whether the transaction was accepted/rejected with reason. 
\end{DoxyReturn}
\index{validation.cpp@{validation.cpp}!ApplyTxInUndo@{ApplyTxInUndo}}
\index{ApplyTxInUndo@{ApplyTxInUndo}!validation.cpp@{validation.cpp}}
\doxysubsubsection{ApplyTxInUndo()}
{\footnotesize\ttfamily \label{validation_8cpp_a492da8f7add38097a8e55f3445a9c83b} 
int Apply\+Tx\+In\+Undo (\begin{DoxyParamCaption}\item[{\textbf{ Coin} \&\&}]{undo}{, }\item[{\textbf{ CCoins\+View\+Cache} \&}]{view}{, }\item[{const \textbf{ COut\+Point} \&}]{out}{}\end{DoxyParamCaption})}

Restore the UTXO in a \doxyref{Coin}{p.}{class_coin} at a given \doxyref{COut\+Point}{p.}{class_c_out_point} 
\begin{DoxyParams}{Parameters}
{\em undo} & The \doxyref{Coin}{p.}{class_coin} to be restored. \\
\hline
{\em view} & The coins view to which to apply the changes. \\
\hline
{\em out} & The out point that corresponds to the tx input. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
A \doxyref{Disconnect\+Result}{p.}{validation_8h_aeaef80b01ee5387f474a63ed23c9cc50} as an int 
\end{DoxyReturn}
\index{validation.cpp@{validation.cpp}!assert@{assert}}
\index{assert@{assert}!validation.cpp@{validation.cpp}}
\doxysubsubsection{assert()}
{\footnotesize\ttfamily \label{validation_8cpp_afb7ea74ba028421697aa7f364741ee6c} 
assert (\begin{DoxyParamCaption}\item[{!tx.}]{Is\+Coin\+Base}{()}\end{DoxyParamCaption})}

\index{validation.cpp@{validation.cpp}!AssertLockHeld@{AssertLockHeld}}
\index{AssertLockHeld@{AssertLockHeld}!validation.cpp@{validation.cpp}}
\doxysubsubsection{AssertLockHeld()}
{\footnotesize\ttfamily \label{validation_8cpp_abee2920f50f82cc5721ae2cd3f1c4f95} 
Assert\+Lock\+Held (\begin{DoxyParamCaption}\item[{pool.}]{cs}{}\end{DoxyParamCaption})}

\index{validation.cpp@{validation.cpp}!CalculateClaimedHeadersWork@{CalculateClaimedHeadersWork}}
\index{CalculateClaimedHeadersWork@{CalculateClaimedHeadersWork}!validation.cpp@{validation.cpp}}
\doxysubsubsection{CalculateClaimedHeadersWork()}
{\footnotesize\ttfamily \label{validation_8cpp_a805faf00f329288736b407376d6edb7a} 
\textbf{ arith\+\_\+uint256} Calculate\+Claimed\+Headers\+Work (\begin{DoxyParamCaption}\item[{std\+::span$<$ const \textbf{ CBlock\+Header} $>$}]{headers}{}\end{DoxyParamCaption})}

Return the sum of the claimed work on a given set of headers. No verification of PoW is done. \index{validation.cpp@{validation.cpp}!CalculateLockPointsAtTip@{CalculateLockPointsAtTip}}
\index{CalculateLockPointsAtTip@{CalculateLockPointsAtTip}!validation.cpp@{validation.cpp}}
\doxysubsubsection{CalculateLockPointsAtTip()}
{\footnotesize\ttfamily \label{validation_8cpp_a245fe8ced32e74fc6d7b9f2c72ef3605} 
std\+::optional$<$ \textbf{ Lock\+Points} $>$ Calculate\+Lock\+Points\+At\+Tip (\begin{DoxyParamCaption}\item[{\textbf{ CBlock\+Index} $\ast$}]{tip}{, }\item[{const \textbf{ CCoins\+View} \&}]{coins\+\_\+view}{, }\item[{const \textbf{ CTransaction} \&}]{tx}{}\end{DoxyParamCaption})}

\index{validation.cpp@{validation.cpp}!CheckBlock@{CheckBlock}}
\index{CheckBlock@{CheckBlock}!validation.cpp@{validation.cpp}}
\doxysubsubsection{CheckBlock()}
{\footnotesize\ttfamily \label{validation_8cpp_aac26467a10843087935711c71e43e184} 
bool Check\+Block (\begin{DoxyParamCaption}\item[{const \textbf{ CBlock} \&}]{block}{, }\item[{\textbf{ Block\+Validation\+State} \&}]{state}{, }\item[{const \textbf{ Consensus\+::\+Params} \&}]{consensus\+Params}{, }\item[{bool}]{f\+Check\+POW}{ = {\ttfamily true}, }\item[{bool}]{f\+Check\+Merkle\+Root}{ = {\ttfamily true}}\end{DoxyParamCaption})}

Functions for validating blocks and updating the block tree Context-\/independent validity checks \index{validation.cpp@{validation.cpp}!CheckFinalTxAtTip@{CheckFinalTxAtTip}}
\index{CheckFinalTxAtTip@{CheckFinalTxAtTip}!validation.cpp@{validation.cpp}}
\doxysubsubsection{CheckFinalTxAtTip()}
{\footnotesize\ttfamily \label{validation_8cpp_a3b90ca0d639cfea2208c7c0aa5118aaa} 
bool Check\+Final\+Tx\+At\+Tip (\begin{DoxyParamCaption}\item[{const \textbf{ CBlock\+Index} \&}]{active\+\_\+chain\+\_\+tip}{, }\item[{const \textbf{ CTransaction} \&}]{tx}{}\end{DoxyParamCaption})}

\index{validation.cpp@{validation.cpp}!CheckInputScripts@{CheckInputScripts}}
\index{CheckInputScripts@{CheckInputScripts}!validation.cpp@{validation.cpp}}
\doxysubsubsection{CheckInputScripts()\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \label{validation_8cpp_af9f454ea56c86078990a64f3fe8e72e2} 
bool Check\+Input\+Scripts (\begin{DoxyParamCaption}\item[{const \textbf{ CTransaction} \&}]{tx}{, }\item[{\textbf{ Tx\+Validation\+State} \&}]{state}{, }\item[{const \textbf{ CCoins\+View\+Cache} \&}]{inputs}{, }\item[{\textbf{ script\+\_\+verify\+\_\+flags}}]{flags}{, }\item[{bool}]{cache\+Sig\+Store}{, }\item[{bool}]{cache\+Full\+Script\+Store}{, }\item[{\textbf{ Precomputed\+Transaction\+Data} \&}]{txdata}{, }\item[{\textbf{ Validation\+Cache} \&}]{validation\+\_\+cache}{, }\item[{std\+::vector$<$ \textbf{ CScript\+Check} $>$ $\ast$}]{pv\+Checks}{}\end{DoxyParamCaption})}

Check whether all of this transaction\textquotesingle{}s input scripts succeed.

This involves ECDSA signature checks so can be computationally intensive. This function should only be called after the cheap sanity checks in Check\+Tx\+Inputs passed.

If pv\+Checks is not nullptr, script checks are pushed onto it instead of being performed inline. Any script checks which are not necessary (eg due to script execution cache hits) are, obviously, not pushed onto pv\+Checks/run.

Setting cache\+Sig\+Store/cache\+Full\+Script\+Store to false will remove elements from the corresponding cache which are matched. This is useful for checking blocks where we will likely never need the cache entry again.

Note that we may set state.\+reason to NOT\+\_\+\+STANDARD for extra soft-\/fork flags in flags, block-\/checking callers should probably reset it to CONSENSUS in such cases.

Non-\/static (and redeclared) in \doxyref{src/test/txvalidationcache\+\_\+tests.\+cpp}{p.}{txvalidationcache__tests_8cpp} \index{validation.cpp@{validation.cpp}!CheckInputScripts@{CheckInputScripts}}
\index{CheckInputScripts@{CheckInputScripts}!validation.cpp@{validation.cpp}}
\doxysubsubsection{CheckInputScripts()\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \label{validation_8cpp_a731f477cdd04b22ecd6b2098b2b8f9a7} 
return Check\+Input\+Scripts (\begin{DoxyParamCaption}\item[{tx}]{}{, }\item[{state}]{}{, }\item[{view}]{}{, }\item[{\textbf{ flags}}]{}{, }\item[{true}]{}{, }\item[{true}]{}{, }\item[{txdata}]{}{, }\item[{validation\+\_\+cache}]{}{}\end{DoxyParamCaption})}

\index{validation.cpp@{validation.cpp}!CheckSequenceLocksAtTip@{CheckSequenceLocksAtTip}}
\index{CheckSequenceLocksAtTip@{CheckSequenceLocksAtTip}!validation.cpp@{validation.cpp}}
\doxysubsubsection{CheckSequenceLocksAtTip()}
{\footnotesize\ttfamily \label{validation_8cpp_a4bb60528a48d01c047a4b004e13136ff} 
bool Check\+Sequence\+Locks\+At\+Tip (\begin{DoxyParamCaption}\item[{\textbf{ CBlock\+Index} $\ast$}]{tip}{, }\item[{const \textbf{ Lock\+Points} \&}]{lock\+\_\+points}{}\end{DoxyParamCaption})}

Check if transaction will be BIP68 final in the next block to be created on top of tip. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{in}}  & {\em tip} & \doxyref{Chain}{p.}{class_chain} tip to check tx sequence locks against. For example, the tip of the current active chain. \\
\hline
\mbox{\texttt{in}}  & {\em lock\+\_\+points} & \doxyref{Lock\+Points}{p.}{struct_lock_points} containing the height and time at which this transaction is final. Simulates calling \doxyref{Sequence\+Locks()}{p.}{tx__verify_8cpp_ad5b7bf644ada0a55c6aac8cfa89ed14a} with data from the tip passed in. The \doxyref{Lock\+Points}{p.}{struct_lock_points} should not be considered valid if Check\+Sequence\+Locks\+At\+Tip returns false. \\
\hline
\end{DoxyParams}
\index{validation.cpp@{validation.cpp}!FatalError@{FatalError}}
\index{FatalError@{FatalError}!validation.cpp@{validation.cpp}}
\doxysubsubsection{FatalError()}
{\footnotesize\ttfamily \label{validation_8cpp_a497b8df01226639187a706653e88fe50} 
bool Fatal\+Error (\begin{DoxyParamCaption}\item[{\textbf{ Notifications} \&}]{notifications}{, }\item[{\textbf{ Block\+Validation\+State} \&}]{state}{, }\item[{const \textbf{ bilingual\+\_\+str} \&}]{message}{}\end{DoxyParamCaption})}

\index{validation.cpp@{validation.cpp}!for@{for}}
\index{for@{for}!validation.cpp@{validation.cpp}}
\doxysubsubsection{for()}
{\footnotesize\ttfamily \label{validation_8cpp_ab7c9794093e95d5e2d9c5942d2fb4d15} 
for (\begin{DoxyParamCaption}\item[{const \textbf{ CTx\+In} \&txin \+:tx.}]{vin}{}\end{DoxyParamCaption})}

\index{validation.cpp@{validation.cpp}!GetBlockScriptFlags@{GetBlockScriptFlags}}
\index{GetBlockScriptFlags@{GetBlockScriptFlags}!validation.cpp@{validation.cpp}}
\doxysubsubsection{GetBlockScriptFlags()}
{\footnotesize\ttfamily \label{validation_8cpp_a1c5c1cc0abaf193cde025de8c0827b50} 
\textbf{ script\+\_\+verify\+\_\+flags} Get\+Block\+Script\+Flags (\begin{DoxyParamCaption}\item[{const \textbf{ CBlock\+Index} \&}]{block\+\_\+index}{, }\item[{const \textbf{ Chainstate\+Manager} \&}]{chainman}{}\end{DoxyParamCaption})}

\index{validation.cpp@{validation.cpp}!GetBlockSubsidy@{GetBlockSubsidy}}
\index{GetBlockSubsidy@{GetBlockSubsidy}!validation.cpp@{validation.cpp}}
\doxysubsubsection{GetBlockSubsidy()}
{\footnotesize\ttfamily \label{validation_8cpp_a3e7cb06e156ad8400b9214479e946187} 
\textbf{ CAmount} Get\+Block\+Subsidy (\begin{DoxyParamCaption}\item[{int}]{n\+Height}{, }\item[{const \textbf{ Consensus\+::\+Params} \&}]{consensus\+Params}{}\end{DoxyParamCaption})}

\index{validation.cpp@{validation.cpp}!HasValidProofOfWork@{HasValidProofOfWork}}
\index{HasValidProofOfWork@{HasValidProofOfWork}!validation.cpp@{validation.cpp}}
\doxysubsubsection{HasValidProofOfWork()}
{\footnotesize\ttfamily \label{validation_8cpp_a600cde3b7d04dc488eec00d290931db7} 
bool Has\+Valid\+Proof\+Of\+Work (\begin{DoxyParamCaption}\item[{const std\+::vector$<$ \textbf{ CBlock\+Header} $>$ \&}]{headers}{, }\item[{const \textbf{ Consensus\+::\+Params} \&}]{consensus\+Params}{}\end{DoxyParamCaption})}

Check with the proof of work on each blockheader matches the value in n\+Bits \index{validation.cpp@{validation.cpp}!IsBIP30Repeat@{IsBIP30Repeat}}
\index{IsBIP30Repeat@{IsBIP30Repeat}!validation.cpp@{validation.cpp}}
\doxysubsubsection{IsBIP30Repeat()}
{\footnotesize\ttfamily \label{validation_8cpp_ad2cf17561482ed386ab70ddaa9b6b7a1} 
bool Is\+BIP30\+Repeat (\begin{DoxyParamCaption}\item[{const \textbf{ CBlock\+Index} \&}]{block\+\_\+index}{}\end{DoxyParamCaption})}

Identifies blocks that overwrote an existing coinbase output in the UTXO set (see BIP30) \index{validation.cpp@{validation.cpp}!IsBIP30Unspendable@{IsBIP30Unspendable}}
\index{IsBIP30Unspendable@{IsBIP30Unspendable}!validation.cpp@{validation.cpp}}
\doxysubsubsection{IsBIP30Unspendable()}
{\footnotesize\ttfamily \label{validation_8cpp_af3fd9113ad463595ffeac4bf813ceea4} 
bool Is\+BIP30\+Unspendable (\begin{DoxyParamCaption}\item[{const \textbf{ uint256} \&}]{block\+\_\+hash}{, }\item[{int}]{block\+\_\+height}{}\end{DoxyParamCaption})}

Identifies blocks which coinbase output was subsequently overwritten in the UTXO set (see BIP30) \index{validation.cpp@{validation.cpp}!IsBlockMutated@{IsBlockMutated}}
\index{IsBlockMutated@{IsBlockMutated}!validation.cpp@{validation.cpp}}
\doxysubsubsection{IsBlockMutated()}
{\footnotesize\ttfamily \label{validation_8cpp_a10bb051c7f669d2bea4c37e6b6d3ed5c} 
bool Is\+Block\+Mutated (\begin{DoxyParamCaption}\item[{const \textbf{ CBlock} \&}]{block}{, }\item[{bool}]{check\+\_\+witness\+\_\+root}{}\end{DoxyParamCaption})}

Check if a block has been mutated (with respect to its merkle root and witness commitments). \index{validation.cpp@{validation.cpp}!ProcessNewPackage@{ProcessNewPackage}}
\index{ProcessNewPackage@{ProcessNewPackage}!validation.cpp@{validation.cpp}}
\doxysubsubsection{ProcessNewPackage()}
{\footnotesize\ttfamily \label{validation_8cpp_a050f5f1343cc094282474bf0aff8e07f} 
\textbf{ Package\+Mempool\+Accept\+Result} Process\+New\+Package (\begin{DoxyParamCaption}\item[{\textbf{ Chainstate} \&}]{active\+\_\+chainstate}{, }\item[{\textbf{ CTx\+Mem\+Pool} \&}]{pool}{, }\item[{const \textbf{ Package} \&}]{txns}{, }\item[{bool}]{test\+\_\+accept}{, }\item[{const std\+::optional$<$ \textbf{ CFee\+Rate} $>$ \&}]{client\+\_\+maxfeerate}{}\end{DoxyParamCaption})}

Validate (and maybe submit) a package to the mempool. See doc/policy/packages.\+md for full details on package validation rules. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{in}}  & {\em test\+\_\+accept} & When true, run validation checks but don\textquotesingle{}t submit to mempool. \\
\hline
\mbox{\texttt{in}}  & {\em client\+\_\+maxfeerate} & If exceeded by an individual transaction, rest of (sub)package evaluation is aborted. Only for sanity checks against local submission of transactions. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
a \doxyref{Package\+Mempool\+Accept\+Result}{p.}{struct_package_mempool_accept_result} which includes a \doxyref{Mempool\+Accept\+Result}{p.}{struct_mempool_accept_result} for each transaction. If a transaction fails, validation will exit early and some results may be missing. It is also possible for the package to be partially submitted. 
\end{DoxyReturn}
\index{validation.cpp@{validation.cpp}!PruneBlockFilesManual@{PruneBlockFilesManual}}
\index{PruneBlockFilesManual@{PruneBlockFilesManual}!validation.cpp@{validation.cpp}}
\doxysubsubsection{PruneBlockFilesManual()}
{\footnotesize\ttfamily \label{validation_8cpp_ab256293c94a9e05d6d9a9ccb5d6b2c58} 
void Prune\+Block\+Files\+Manual (\begin{DoxyParamCaption}\item[{\textbf{ Chainstate} \&}]{active\+\_\+chainstate}{, }\item[{int}]{n\+Manual\+Prune\+Height}{}\end{DoxyParamCaption})}

Prune block files up to a given height \index{validation.cpp@{validation.cpp}!TestBlockValidity@{TestBlockValidity}}
\index{TestBlockValidity@{TestBlockValidity}!validation.cpp@{validation.cpp}}
\doxysubsubsection{TestBlockValidity()}
{\footnotesize\ttfamily \label{validation_8cpp_ac0610c85af2e020fe5284c21b47beb39} 
\textbf{ Block\+Validation\+State} Test\+Block\+Validity (\begin{DoxyParamCaption}\item[{\textbf{ Chainstate} \&}]{chainstate}{, }\item[{const \textbf{ CBlock} \&}]{block}{, }\item[{bool}]{check\+\_\+pow}{, }\item[{bool}]{check\+\_\+merkle\+\_\+root}{}\end{DoxyParamCaption})}

Verify a block, including transactions.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{in}}  & {\em block} & The block we want to process. Must connect to the current tip. \\
\hline
\mbox{\texttt{in}}  & {\em chainstate} & The chainstate to connect to. \\
\hline
\mbox{\texttt{in}}  & {\em check\+\_\+pow} & perform proof-\/of-\/work check, n\+Bits in the header is always checked \\
\hline
\mbox{\texttt{in}}  & {\em check\+\_\+merkle\+\_\+root} & check the merkle root\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Valid or Invalid state. This doesn\textquotesingle{}t currently return an Error state, and shouldn\textquotesingle{}t unless there is something wrong with the existing chainstate. (This is different from functions like Accept\+Block which can fail trying to save new data.)
\end{DoxyReturn}
For signets the challenge verification is skipped when check\+\_\+pow is false. At this point Process\+New\+Block would call Accept\+Block(), but we don\textquotesingle{}t want to store the block or its header. Run individual checks instead\+:
\begin{DoxyItemize}
\item skip Accept\+Block\+Header() because\+:
\begin{DoxyItemize}
\item we don\textquotesingle{}t want to update the block index
\item we do not care about duplicates
\item we already ran Check\+Block\+Header() via \doxyref{Check\+Block()}{p.}{validation_8cpp_aac26467a10843087935711c71e43e184}
\item we already checked for prev-\/blk-\/not-\/found
\item we know the tip is valid, so no need to check bad-\/prevblk
\end{DoxyItemize}
\item we already ran \doxyref{Check\+Block()}{p.}{validation_8cpp_aac26467a10843087935711c71e43e184}
\item do run Contextual\+Check\+Block\+Header()
\item do run Contextual\+Check\+Block()
\end{DoxyItemize}\index{validation.cpp@{validation.cpp}!TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}}
\index{TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}!validation.cpp@{validation.cpp}}
\doxysubsubsection{TRACEPOINT\_SEMAPHORE()\hspace{0.1cm}{\footnotesize\ttfamily [1/4]}}
{\footnotesize\ttfamily \label{validation_8cpp_af2678f331b1bf35b16d3b3df42230b85} 
TRACEPOINT\+\_\+\+SEMAPHORE (\begin{DoxyParamCaption}\item[{mempool}]{}{, }\item[{rejected}]{}{}\end{DoxyParamCaption})}

\index{validation.cpp@{validation.cpp}!TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}}
\index{TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}!validation.cpp@{validation.cpp}}
\doxysubsubsection{TRACEPOINT\_SEMAPHORE()\hspace{0.1cm}{\footnotesize\ttfamily [2/4]}}
{\footnotesize\ttfamily \label{validation_8cpp_ad55d6e305372171ae8b4b559b4840db5} 
TRACEPOINT\+\_\+\+SEMAPHORE (\begin{DoxyParamCaption}\item[{mempool}]{}{, }\item[{replaced}]{}{}\end{DoxyParamCaption})}

\index{validation.cpp@{validation.cpp}!TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}}
\index{TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}!validation.cpp@{validation.cpp}}
\doxysubsubsection{TRACEPOINT\_SEMAPHORE()\hspace{0.1cm}{\footnotesize\ttfamily [3/4]}}
{\footnotesize\ttfamily \label{validation_8cpp_ab3fb81a955a4a81d5d1810945c417656} 
TRACEPOINT\+\_\+\+SEMAPHORE (\begin{DoxyParamCaption}\item[{utxocache}]{}{, }\item[{flush}]{}{}\end{DoxyParamCaption})}

\index{validation.cpp@{validation.cpp}!TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}}
\index{TRACEPOINT\_SEMAPHORE@{TRACEPOINT\_SEMAPHORE}!validation.cpp@{validation.cpp}}
\doxysubsubsection{TRACEPOINT\_SEMAPHORE()\hspace{0.1cm}{\footnotesize\ttfamily [4/4]}}
{\footnotesize\ttfamily \label{validation_8cpp_af4f26ad2a7c3b4428d86f2800747941e} 
TRACEPOINT\+\_\+\+SEMAPHORE (\begin{DoxyParamCaption}\item[{validation}]{}{, }\item[{block\+\_\+connected}]{}{}\end{DoxyParamCaption})}

\index{validation.cpp@{validation.cpp}!UpdateCoins@{UpdateCoins}}
\index{UpdateCoins@{UpdateCoins}!validation.cpp@{validation.cpp}}
\doxysubsubsection{UpdateCoins()}
{\footnotesize\ttfamily \label{validation_8cpp_a76ffac026788c8c1e6d55fb1beae0962} 
void Update\+Coins (\begin{DoxyParamCaption}\item[{const \textbf{ CTransaction} \&}]{tx}{, }\item[{\textbf{ CCoins\+View\+Cache} \&}]{inputs}{, }\item[{\textbf{ CTx\+Undo} \&}]{txundo}{, }\item[{int}]{n\+Height}{}\end{DoxyParamCaption})}



\label{doc-var-members}
\doxysubsection{Variable Documentation}
\index{validation.cpp@{validation.cpp}!CHECKLEVEL\_DOC@{CHECKLEVEL\_DOC}}
\index{CHECKLEVEL\_DOC@{CHECKLEVEL\_DOC}!validation.cpp@{validation.cpp}}
\doxysubsubsection{CHECKLEVEL\_DOC}
{\footnotesize\ttfamily \label{validation_8cpp_aa6bf79aa2e37d5ce26771d5af135cf51} 
const std\+::vector$<$std\+::string$>$ CHECKLEVEL\+\_\+\+DOC}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}level\ 0\ reads\ the\ blocks\ from\ disk"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}level\ 1\ verifies\ block\ validity"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}level\ 2\ verifies\ undo\ data"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}level\ 3\ checks\ disconnection\ of\ tip\ blocks"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}level\ 4\ tries\ to\ reconnect\ the\ blocks"{}},}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}each\ level\ includes\ the\ checks\ of\ the\ previous\ levels"{}},}
\DoxyCodeLine{\}}

\end{DoxyCode}
Documentation for argument \textquotesingle{}checklevel\textquotesingle{}. \index{validation.cpp@{validation.cpp}!cs@{cs}}
\index{cs@{cs}!validation.cpp@{validation.cpp}}
\doxysubsubsection{cs}
{\footnotesize\ttfamily \label{validation_8cpp_a24f5ac7f44949e51d88ed714f978baa8} 
bool pool cs}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ AssertLockHeld(cs\_main)}

\end{DoxyCode}
