.TH "TxOrphanageImpl" 3 "Version 2.8" "bitcoind" \" -*- nroff -*-
.ad l
.nh
.SH NAME
TxOrphanageImpl
.SH SYNOPSIS
.br
.PP
.PP
Inherits \fBTxOrphanage\fP\&.
.SS "Public Member Functions"

.in +1c
.ti -1c
.RI "\fBTxOrphanageImpl\fP ()=default"
.br
.ti -1c
.RI "\fBTxOrphanageImpl\fP (\fBCount\fP max_global_latency_score, \fBUsage\fP reserved_peer_usage)"
.br
.ti -1c
.RI "\fB~TxOrphanageImpl\fP () noexcept override=default"
.br
.ti -1c
.RI "\fBTxOrphanage::Count\fP \fBCountAnnouncements\fP () const override"
.br
.ti -1c
.RI "\fBTxOrphanage::Count\fP \fBCountUniqueOrphans\fP () const override"
.br
.ti -1c
.RI "\fBTxOrphanage::Count\fP \fBAnnouncementsFromPeer\fP (\fBNodeId\fP peer) const override"
.br
.ti -1c
.RI "\fBTxOrphanage::Count\fP \fBLatencyScoreFromPeer\fP (\fBNodeId\fP peer) const override"
.br
.ti -1c
.RI "\fBTxOrphanage::Usage\fP \fBUsageByPeer\fP (\fBNodeId\fP peer) const override"
.br
.ti -1c
.RI "\fBTxOrphanage::Count\fP \fBMaxGlobalLatencyScore\fP () const override"
.br
.ti -1c
.RI "\fBTxOrphanage::Count\fP \fBTotalLatencyScore\fP () const override"
.br
.ti -1c
.RI "\fBTxOrphanage::Usage\fP \fBReservedPeerUsage\fP () const override"
.br
.ti -1c
.RI "\fBTxOrphanage::Count\fP \fBMaxPeerLatencyScore\fP () const override"
.br
.ti -1c
.RI "\fBTxOrphanage::Usage\fP \fBMaxGlobalUsage\fP () const override"
.br
.ti -1c
.RI "bool \fBAddTx\fP (const \fBCTransactionRef\fP &tx, \fBNodeId\fP peer) override"
.br
.ti -1c
.RI "bool \fBAddAnnouncer\fP (const \fBWtxid\fP &wtxid, \fBNodeId\fP peer) override"
.br
.ti -1c
.RI "\fBCTransactionRef\fP \fBGetTx\fP (const \fBWtxid\fP &wtxid) const override"
.br
.ti -1c
.RI "bool \fBHaveTx\fP (const \fBWtxid\fP &wtxid) const override"
.br
.ti -1c
.RI "bool \fBHaveTxFromPeer\fP (const \fBWtxid\fP &wtxid, \fBNodeId\fP peer) const override"
.br
.ti -1c
.RI "\fBCTransactionRef\fP \fBGetTxToReconsider\fP (\fBNodeId\fP peer) override"
.br
.ti -1c
.RI "bool \fBEraseTx\fP (const \fBWtxid\fP &wtxid) override"
.br
.ti -1c
.RI "void \fBEraseForPeer\fP (\fBNodeId\fP peer) override"
.br
.ti -1c
.RI "void \fBEraseForBlock\fP (const \fBCBlock\fP &block) override"
.br
.ti -1c
.RI "std::vector< std::pair< \fBWtxid\fP, \fBNodeId\fP > > \fBAddChildrenToWorkSet\fP (const \fBCTransaction\fP &tx, \fBFastRandomContext\fP &rng) override"
.br
.ti -1c
.RI "bool \fBHaveTxToReconsider\fP (\fBNodeId\fP peer) override"
.br
.ti -1c
.RI "std::vector< \fBCTransactionRef\fP > \fBGetChildrenFromSamePeer\fP (const \fBCTransactionRef\fP &parent, \fBNodeId\fP nodeid) const override"
.br
.ti -1c
.RI "std::vector< \fBOrphanInfo\fP > \fBGetOrphanTransactions\fP () const override"
.br
.ti -1c
.RI "\fBTxOrphanage::Usage\fP \fBTotalOrphanUsage\fP () const override"
.br
.ti -1c
.RI "void \fBSanityCheck\fP () const override"
.br
.in -1c

Public Member Functions inherited from \fBTxOrphanage\fP
.in +1c
.ti -1c
.RI "virtual \fB~TxOrphanage\fP ()=default"
.br
.in -1c
.SS "Additional Inherited Members"


Public Types inherited from \fBTxOrphanage\fP
.in +1c
.ti -1c
.RI "using \fBUsage\fP = int64_t"
.br
.ti -1c
.RI "using \fBCount\fP = unsigned int"
.br
.in -1c
.SH "Constructor & Destructor Documentation"
.PP 
.SS "TxOrphanageImpl ()\fR [default]\fP"

.SS "TxOrphanageImpl (\fBCount\fP max_global_latency_score, \fBUsage\fP reserved_peer_usage)\fR [inline]\fP"

.SS "~\fBTxOrphanageImpl\fP ()\fR [override]\fP, \fR [default]\fP, \fR [noexcept]\fP"

.SH "Member Function Documentation"
.PP 
.SS "bool AddAnnouncer (const \fBWtxid\fP & wtxid, \fBNodeId\fP peer)\fR [override]\fP, \fR [virtual]\fP"
Add an additional announcer to an orphan if it exists\&. Otherwise, do nothing\&. 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "std::vector< std::pair< \fBWtxid\fP, \fBNodeId\fP > > AddChildrenToWorkSet (const \fBCTransaction\fP & tx, \fBFastRandomContext\fP & rng)\fR [override]\fP, \fR [virtual]\fP"
Add any orphans that list a particular tx as a parent into the from peer's work set 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "bool AddTx (const \fBCTransactionRef\fP & tx, \fBNodeId\fP peer)\fR [override]\fP, \fR [virtual]\fP"
Add a new orphan transaction 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "\fBTxOrphanage::Count\fP AnnouncementsFromPeer (\fBNodeId\fP peer) const\fR [override]\fP, \fR [virtual]\fP"
Number of orphans stored from this peer\&. 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "\fBTxOrphanage::Count\fP CountAnnouncements () const\fR [override]\fP, \fR [virtual]\fP"
Number of announcements, i\&.e\&. total size of m_orphans\&. Ones for the same wtxid are not de-duplicated\&. Not the same as \fBTotalLatencyScore()\fP\&. 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "\fBTxOrphanage::Count\fP CountUniqueOrphans () const\fR [override]\fP, \fR [virtual]\fP"
Number of unique orphans (by wtxid)\&. 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "void EraseForBlock (const \fBCBlock\fP & block)\fR [override]\fP, \fR [virtual]\fP"
Erase all orphans included in or invalidated by a new block 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "void EraseForPeer (\fBNodeId\fP peer)\fR [override]\fP, \fR [virtual]\fP"
Erase all entries by this peer\&. 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "bool EraseTx (const \fBWtxid\fP & wtxid)\fR [override]\fP, \fR [virtual]\fP"
Erase an orphan by wtxid, including all announcements if there are multiple\&. Returns true if an orphan was erased, false if no tx with this wtxid exists\&. 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "std::vector< \fBCTransactionRef\fP > GetChildrenFromSamePeer (const \fBCTransactionRef\fP & parent, \fBNodeId\fP nodeid) const\fR [override]\fP, \fR [virtual]\fP"
Get all children that spend from this tx and were received from nodeid\&. Sorted reconsiderable before non-reconsiderable, then from most recent to least recent\&. 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "std::vector< \fBTxOrphanage::OrphanInfo\fP > GetOrphanTransactions () const\fR [override]\fP, \fR [virtual]\fP"
Get all orphan transactions 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "\fBCTransactionRef\fP GetTx (const \fBWtxid\fP & wtxid) const\fR [override]\fP, \fR [virtual]\fP"
Get a transaction by its witness txid 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "\fBCTransactionRef\fP GetTxToReconsider (\fBNodeId\fP peer)\fR [override]\fP, \fR [virtual]\fP"
If there is a tx that can be reconsidered, return it and set it back to non-reconsiderable\&. Otherwise, return a nullptr\&. 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "bool HaveTx (const \fBWtxid\fP & wtxid) const\fR [override]\fP, \fR [virtual]\fP"
Check if we already have an orphan transaction (by wtxid only) 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "bool HaveTxFromPeer (const \fBWtxid\fP & wtxid, \fBNodeId\fP peer) const\fR [override]\fP, \fR [virtual]\fP"
Check if a {tx, peer} exists in the orphanage\&. 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "bool HaveTxToReconsider (\fBNodeId\fP peer)\fR [override]\fP, \fR [virtual]\fP"
Return whether there is a tx that can be reconsidered\&. 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "\fBTxOrphanage::Count\fP LatencyScoreFromPeer (\fBNodeId\fP peer) const\fR [override]\fP, \fR [virtual]\fP"
Latency score of transactions announced by this peer\&. 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "\fBTxOrphanage::Count\fP MaxGlobalLatencyScore () const\fR [override]\fP, \fR [virtual]\fP"
Get the maximum global latency score allowed 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "\fBTxOrphanage::Usage\fP MaxGlobalUsage () const\fR [override]\fP, \fR [virtual]\fP"
Maximum allowed (deduplicated) memory usage for all transactions (see Announcement::GetMemUsage())\&. Dynamic based on number of peers\&. More peers means more allowed memory usage\&. The number of peers times \fBReservedPeerUsage()\fP adds up to \fBMaxGlobalUsage()\fP\&. As long as every peer's m_total_usage / \fBReservedPeerUsage()\fP < 1, \fBMaxGlobalUsage()\fP is not exceeded\&. 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "\fBTxOrphanage::Count\fP MaxPeerLatencyScore () const\fR [override]\fP, \fR [virtual]\fP"
Maximum allowed (deduplicated) latency score for all transactions (see Announcement::GetLatencyScore())\&. Dynamic based on number of peers\&. Each peer has an equal amount, but the global maximum latency score stays constant\&. The number of peers times \fBMaxPeerLatencyScore()\fP (rounded) adds up to \fBMaxGlobalLatencyScore()\fP\&. As long as every peer's m_total_latency_score / \fBMaxPeerLatencyScore()\fP < 1, \fBMaxGlobalLatencyScore()\fP is not exceeded\&. 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "\fBTxOrphanage::Usage\fP ReservedPeerUsage () const\fR [override]\fP, \fR [virtual]\fP"
Get the reserved usage per peer 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "void SanityCheck () const\fR [override]\fP, \fR [virtual]\fP"
Check consistency between PeerOrphanInfo and m_orphans\&. Recalculate counters and ensure they match what is cached\&. 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "\fBTxOrphanage::Count\fP TotalLatencyScore () const\fR [override]\fP, \fR [virtual]\fP"
Get the total latency score of all orphans 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "\fBTxOrphanage::Usage\fP TotalOrphanUsage () const\fR [override]\fP, \fR [virtual]\fP"
Get the total usage (weight) of all orphans\&. If an orphan has multiple announcers, its usage is only counted once within this total\&. 
.PP
Implements \fBTxOrphanage\fP\&.
.SS "\fBTxOrphanage::Usage\fP UsageByPeer (\fBNodeId\fP peer) const\fR [override]\fP, \fR [virtual]\fP"
Total usage (weight) of orphans for which this peer is an announcer\&. If an orphan has multiple announcers, its weight will be accounted for in each PeerOrphanInfo, so the total of all peers' \fBUsageByPeer()\fP may be larger than \fBTotalOrphanUsage()\fP\&. Similarly, \fBUsageByPeer()\fP may be far higher than \fBReservedPeerUsage()\fP, particularly if many peers have provided the same orphans\&. 
.PP
Implements \fBTxOrphanage\fP\&.

.SH "Author"
.PP 
Generated automatically by Doxygen for bitcoind from the source code\&.
