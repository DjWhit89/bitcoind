.TH "ScriptPubKeyMan" 3 "Version 2.8" "bitcoind" \" -*- nroff -*-
.ad l
.nh
.SH NAME
ScriptPubKeyMan
.SH SYNOPSIS
.br
.PP
.PP
\fR#include <scriptpubkeyman\&.h>\fP
.PP
Inherited by \fBDescriptorScriptPubKeyMan\fP, and \fBLegacyDataSPKM\fP\&.
.SS "Public Member Functions"

.in +1c
.ti -1c
.RI "\fBScriptPubKeyMan\fP (\fBWalletStorage\fP &storage)"
.br
.ti -1c
.RI "virtual \fB~ScriptPubKeyMan\fP ()=default"
.br
.ti -1c
.RI "virtual \fButil::Result\fP< \fBCTxDestination\fP > \fBGetNewDestination\fP (const \fBOutputType\fP type)"
.br
.ti -1c
.RI "virtual bool \fBIsMine\fP (const \fBCScript\fP &\fBscript\fP) const"
.br
.ti -1c
.RI "virtual bool \fBCheckDecryptionKey\fP (const \fBCKeyingMaterial\fP &master_key)"
.br
.RI "Check that the given decryption key is valid for this \fBScriptPubKeyMan\fP, i\&.e\&. it decrypts all of the keys handled by it\&. "
.ti -1c
.RI "virtual bool \fBEncrypt\fP (const \fBCKeyingMaterial\fP &master_key, \fBWalletBatch\fP *batch)"
.br
.ti -1c
.RI "virtual \fButil::Result\fP< \fBCTxDestination\fP > \fBGetReservedDestination\fP (const \fBOutputType\fP type, bool internal, int64_t &index)"
.br
.ti -1c
.RI "virtual void \fBKeepDestination\fP (int64_t index, const \fBOutputType\fP &type)"
.br
.ti -1c
.RI "virtual void \fBReturnDestination\fP (int64_t index, bool internal, const \fBCTxDestination\fP &addr)"
.br
.ti -1c
.RI "virtual bool \fBTopUp\fP (unsigned int size=0)"
.br
.ti -1c
.RI "virtual std::vector< \fBWalletDestination\fP > \fBMarkUnusedAddresses\fP (const \fBCScript\fP &\fBscript\fP)"
.br
.ti -1c
.RI "virtual bool \fBIsHDEnabled\fP () const"
.br
.ti -1c
.RI "virtual bool \fBCanGetAddresses\fP (bool internal=false) const"
.br
.ti -1c
.RI "virtual bool \fBHavePrivateKeys\fP () const"
.br
.ti -1c
.RI "virtual bool \fBHaveCryptedKeys\fP () const"
.br
.ti -1c
.RI "virtual void \fBRewriteDB\fP ()"
.br
.RI "The action to do when the \fBDB\fP needs rewrite\&. "
.ti -1c
.RI "virtual unsigned int \fBGetKeyPoolSize\fP () const"
.br
.ti -1c
.RI "virtual int64_t \fBGetTimeFirstKey\fP () const"
.br
.ti -1c
.RI "virtual std::unique_ptr< \fBCKeyMetadata\fP > \fBGetMetadata\fP (const \fBCTxDestination\fP &dest) const"
.br
.ti -1c
.RI "virtual std::unique_ptr< \fBSigningProvider\fP > \fBGetSolvingProvider\fP (const \fBCScript\fP &\fBscript\fP) const"
.br
.ti -1c
.RI "virtual bool \fBCanProvide\fP (const \fBCScript\fP &\fBscript\fP, \fBSignatureData\fP &sigdata)"
.br
.ti -1c
.RI "virtual bool \fBSignTransaction\fP (\fBCMutableTransaction\fP &tx, const std::map< \fBCOutPoint\fP, \fBCoin\fP > &coins, int sighash, std::map< int, \fBbilingual_str\fP > &input_errors) const"
.br
.ti -1c
.RI "virtual \fBSigningResult\fP \fBSignMessage\fP (const std::string &message, const \fBPKHash\fP &pkhash, std::string &str_sig) const"
.br
.ti -1c
.RI "virtual std::optional< \fBcommon::PSBTError\fP > \fBFillPSBT\fP (\fBPartiallySignedTransaction\fP &psbt, const \fBPrecomputedTransactionData\fP &txdata, std::optional< int > sighash_type=std::nullopt, bool sign=true, bool bip32derivs=false, int *n_signed=nullptr, bool finalize=true) const"
.br
.ti -1c
.RI "virtual \fBuint256\fP \fBGetID\fP () const"
.br
.ti -1c
.RI "virtual std::unordered_set< \fBCScript\fP, \fBSaltedSipHasher\fP > \fBGetScriptPubKeys\fP () const"
.br
.ti -1c
.RI "template<typename\&.\&.\&. Params> void \fBWalletLogPrintf\fP (\fButil::ConstevalFormatString\fP< sizeof\&.\&.\&.(\fBParams\fP)> wallet_fmt, const \fBParams\fP &\&.\&.\&. params) const"
.br
.in -1c
.SS "Data Fields"

.in +1c
.ti -1c
.RI "boost::signals2::signal< void()> \fBNotifyCanGetAddressesChanged\fP"
.br
.ti -1c
.RI "boost::signals2::signal< void(const \fBScriptPubKeyMan\fP *spkm, int64_t new_birth_time)> \fBNotifyFirstKeyTimeChanged\fP"
.br
.in -1c
.SS "Protected Attributes"

.in +1c
.ti -1c
.RI "\fBWalletStorage\fP & \fBm_storage\fP"
.br
.in -1c
.SH "Constructor & Destructor Documentation"
.PP 
.SS "ScriptPubKeyMan (\fBWalletStorage\fP & storage)\fR [inline]\fP, \fR [explicit]\fP"

.SS "virtual ~\fBScriptPubKeyMan\fP ()\fR [virtual]\fP, \fR [default]\fP"

.SH "Member Function Documentation"
.PP 
.SS "virtual bool CanGetAddresses (bool internal = \fRfalse\fP) const\fR [inline]\fP, \fR [virtual]\fP"

.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP\&.
.SS "virtual bool CanProvide (const \fBCScript\fP & script, \fBSignatureData\fP & sigdata)\fR [inline]\fP, \fR [virtual]\fP"
Whether this \fBScriptPubKeyMan\fP can provide a \fBSigningProvider\fP (via GetSolvingProvider) that, combined with sigdata, can produce solving data\&. 
.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP\&.
.SS "virtual bool CheckDecryptionKey (const \fBCKeyingMaterial\fP & master_key)\fR [inline]\fP, \fR [virtual]\fP"

.PP
Check that the given decryption key is valid for this \fBScriptPubKeyMan\fP, i\&.e\&. it decrypts all of the keys handled by it\&. 
.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP, and \fBLegacyDataSPKM\fP\&.
.SS "virtual bool Encrypt (const \fBCKeyingMaterial\fP & master_key, \fBWalletBatch\fP * batch)\fR [inline]\fP, \fR [virtual]\fP"

.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP\&.
.SS "virtual std::optional< \fBcommon::PSBTError\fP > FillPSBT (\fBPartiallySignedTransaction\fP & psbt, const \fBPrecomputedTransactionData\fP & txdata, std::optional< int > sighash_type = \fRstd::nullopt\fP, bool sign = \fRtrue\fP, bool bip32derivs = \fRfalse\fP, int * n_signed = \fRnullptr\fP, bool finalize = \fRtrue\fP) const\fR [inline]\fP, \fR [virtual]\fP"
Adds script and derivation path information to a PSBT, and optionally signs it\&. 
.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP, and \fBExternalSignerScriptPubKeyMan\fP\&.
.SS "virtual \fBuint256\fP GetID () const\fR [inline]\fP, \fR [virtual]\fP"

.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP, and \fBLegacyDataSPKM\fP\&.
.SS "virtual unsigned int GetKeyPoolSize () const\fR [inline]\fP, \fR [virtual]\fP"

.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP\&.
.SS "virtual std::unique_ptr< \fBCKeyMetadata\fP > GetMetadata (const \fBCTxDestination\fP & dest) const\fR [inline]\fP, \fR [virtual]\fP"

.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP\&.
.SS "virtual \fButil::Result\fP< \fBCTxDestination\fP > GetNewDestination (const \fBOutputType\fP type)\fR [inline]\fP, \fR [virtual]\fP"

.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP\&.
.SS "virtual \fButil::Result\fP< \fBCTxDestination\fP > GetReservedDestination (const \fBOutputType\fP type, bool internal, int64_t & index)\fR [inline]\fP, \fR [virtual]\fP"

.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP\&.
.SS "virtual std::unordered_set< \fBCScript\fP, \fBSaltedSipHasher\fP > GetScriptPubKeys () const\fR [inline]\fP, \fR [virtual]\fP"
Returns a set of all the scriptPubKeys that this \fBScriptPubKeyMan\fP watches 
.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP, and \fBLegacyDataSPKM\fP\&.
.SS "virtual std::unique_ptr< \fBSigningProvider\fP > GetSolvingProvider (const \fBCScript\fP & script) const\fR [inline]\fP, \fR [virtual]\fP"

.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP, and \fBLegacyDataSPKM\fP\&.
.SS "virtual int64_t GetTimeFirstKey () const\fR [inline]\fP, \fR [virtual]\fP"

.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP\&.
.SS "virtual bool HaveCryptedKeys () const\fR [inline]\fP, \fR [virtual]\fP"

.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP\&.
.SS "virtual bool HavePrivateKeys () const\fR [inline]\fP, \fR [virtual]\fP"

.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP\&.
.SS "virtual bool IsHDEnabled () const\fR [inline]\fP, \fR [virtual]\fP"

.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP\&.
.SS "virtual bool IsMine (const \fBCScript\fP & script) const\fR [inline]\fP, \fR [virtual]\fP"

.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP\&.
.SS "virtual void KeepDestination (int64_t index, const \fBOutputType\fP & type)\fR [inline]\fP, \fR [virtual]\fP"

.SS "virtual std::vector< \fBWalletDestination\fP > MarkUnusedAddresses (const \fBCScript\fP & script)\fR [inline]\fP, \fR [virtual]\fP"
Mark unused addresses as being used Affects all keys up to and including the one determined by provided script\&.

.PP
\fBParameters\fP
.RS 4
\fIscript\fP determines the last key to mark as used
.RE
.PP
\fBReturns\fP
.RS 4
All of the addresses affected 
.RE
.PP

.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP\&.
.SS "virtual void ReturnDestination (int64_t index, bool internal, const \fBCTxDestination\fP & addr)\fR [inline]\fP, \fR [virtual]\fP"

.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP\&.
.SS "virtual void RewriteDB ()\fR [inline]\fP, \fR [virtual]\fP"

.PP
The action to do when the \fBDB\fP needs rewrite\&. 
.SS "virtual \fBSigningResult\fP SignMessage (const std::string & message, const \fBPKHash\fP & pkhash, std::string & str_sig) const\fR [inline]\fP, \fR [virtual]\fP"
Sign a message with the given script 
.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP\&.
.SS "virtual bool SignTransaction (\fBCMutableTransaction\fP & tx, const std::map< \fBCOutPoint\fP, \fBCoin\fP > & coins, int sighash, std::map< int, \fBbilingual_str\fP > & input_errors) const\fR [inline]\fP, \fR [virtual]\fP"
Creates new signatures and adds them to the transaction\&. Returns whether all inputs were signed 
.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP\&.
.SS "virtual bool TopUp (unsigned int size = \fR0\fP)\fR [inline]\fP, \fR [virtual]\fP"
Fills internal address pool\&. Use within \fBScriptPubKeyMan\fP implementations should be used sparingly and only when something from the address pool is removed, excluding GetNewDestination and GetReservedDestination\&. External wallet code is primarily responsible for topping up prior to fetching new addresses 
.PP
Reimplemented in \fBDescriptorScriptPubKeyMan\fP\&.
.SS "template<typename\&.\&.\&. Params> void WalletLogPrintf (\fButil::ConstevalFormatString\fP< sizeof\&.\&.\&.(\fBParams\fP)> wallet_fmt, const \fBParams\fP &\&.\&.\&. params) const\fR [inline]\fP"
Prepends the wallet name in logging output to ease debugging in multi-wallet use cases 
.SH "Field Documentation"
.PP 
.SS "\fBWalletStorage\fP& m_storage\fR [protected]\fP"

.SS "boost::signals2::signal<void ()> NotifyCanGetAddressesChanged"
Keypool has new keys 
.SS "boost::signals2::signal<void (const \fBScriptPubKeyMan\fP* spkm, int64_t new_birth_time)> NotifyFirstKeyTimeChanged"
Birth time changed 

.SH "Author"
.PP 
Generated automatically by Doxygen for bitcoind from the source code\&.
