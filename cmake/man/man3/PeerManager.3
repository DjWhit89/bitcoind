.TH "PeerManager" 3 "Version 2.8" "bitcoind" \" -*- nroff -*-
.ad l
.nh
.SH NAME
PeerManager
.SH SYNOPSIS
.br
.PP
.PP
\fR#include <net_processing\&.h>\fP
.PP
Inherits \fBCValidationInterface\fP, and \fBNetEventsInterface\fP\&.
.SS "Data Structures"

.in +1c
.ti -1c
.RI "struct \fBOptions\fP"
.br
.in -1c
.SS "Public Member Functions"

.in +1c
.ti -1c
.RI "virtual \fB~PeerManager\fP ()=default"
.br
.ti -1c
.RI "virtual \fButil::Expected\fP< void, std::string > \fBFetchBlock\fP (\fBNodeId\fP peer_id, const \fBCBlockIndex\fP &block_index)=0"
.br
.ti -1c
.RI "virtual void \fBStartScheduledTasks\fP (\fBCScheduler\fP &scheduler)=0"
.br
.ti -1c
.RI "virtual bool \fBGetNodeStateStats\fP (\fBNodeId\fP nodeid, \fBCNodeStateStats\fP &stats) const =0"
.br
.ti -1c
.RI "virtual std::vector< \fBnode::TxOrphanage::OrphanInfo\fP > \fBGetOrphanTransactions\fP ()=0"
.br
.ti -1c
.RI "virtual \fBPeerManagerInfo\fP \fBGetInfo\fP () const =0"
.br
.ti -1c
.RI "virtual void \fBRelayTransaction\fP (const \fBTxid\fP &txid, const \fBWtxid\fP &wtxid)=0"
.br
.ti -1c
.RI "virtual void \fBSendPings\fP ()=0"
.br
.ti -1c
.RI "virtual void \fBSetBestBlock\fP (int height, std::chrono::seconds time)=0"
.br
.ti -1c
.RI "virtual void \fBUnitTestMisbehaving\fP (\fBNodeId\fP peer_id)=0"
.br
.ti -1c
.RI "virtual void \fBCheckForStaleTipAndEvictPeers\fP ()=0"
.br
.ti -1c
.RI "virtual void \fBProcessMessage\fP (\fBCNode\fP &pfrom, const std::string &msg_type, \fBDataStream\fP &vRecv, const std::chrono::microseconds time_received, const std::atomic< bool > &interruptMsgProc) \fBEXCLUSIVE_LOCKS_REQUIRED\fP(\fBg_msgproc_mutex\fP)=0"
.br
.ti -1c
.RI "virtual void \fBUpdateLastBlockAnnounceTime\fP (\fBNodeId\fP \fBnode\fP, int64_t time_in_seconds)=0"
.br
.ti -1c
.RI "virtual \fBServiceFlags\fP \fBGetDesirableServiceFlags\fP (\fBServiceFlags\fP services) const =0"
.br
.in -1c

Public Member Functions inherited from \fBNetEventsInterface\fP
.in +1c
.ti -1c
.RI "virtual void \fBInitializeNode\fP (const \fBCNode\fP &\fBnode\fP, \fBServiceFlags\fP our_services)=0"
.br
.ti -1c
.RI "virtual void \fBFinalizeNode\fP (const \fBCNode\fP &\fBnode\fP)=0"
.br
.ti -1c
.RI "virtual bool \fBHasAllDesirableServiceFlags\fP (\fBServiceFlags\fP services) const =0"
.br
.ti -1c
.RI "virtual bool \fBProcessMessages\fP (\fBCNode\fP *pnode, std::atomic< bool > &interrupt) \fBEXCLUSIVE_LOCKS_REQUIRED\fP(\fBg_msgproc_mutex\fP)=0"
.br
.ti -1c
.RI "virtual bool \fBSendMessages\fP (\fBCNode\fP *pnode) \fBEXCLUSIVE_LOCKS_REQUIRED\fP(\fBg_msgproc_mutex\fP)=0"
.br
.in -1c
.SS "Static Public Member Functions"

.in +1c
.ti -1c
.RI "static std::unique_ptr< \fBPeerManager\fP > \fBmake\fP (\fBCConnman\fP &connman, \fBAddrMan\fP &addrman, \fBBanMan\fP *banman, \fBChainstateManager\fP &chainman, \fBCTxMemPool\fP &pool, \fBnode::Warnings\fP &warnings, \fBOptions\fP opts)"
.br
.in -1c
.SS "Additional Inherited Members"


Static Public Attributes inherited from \fBNetEventsInterface\fP
.in +1c
.ti -1c
.RI "static \fBMutex\fP \fBg_msgproc_mutex\fP"
.br
.in -1c

Protected Member Functions inherited from \fBCValidationInterface\fP
.in +1c
.ti -1c
.RI "\fB~CValidationInterface\fP ()=default"
.br
.ti -1c
.RI "virtual void \fBUpdatedBlockTip\fP (const \fBCBlockIndex\fP *pindexNew, const \fBCBlockIndex\fP *pindexFork, bool fInitialDownload)"
.br
.ti -1c
.RI "virtual void \fBActiveTipChange\fP (const \fBCBlockIndex\fP &new_tip, bool is_ibd)"
.br
.ti -1c
.RI "virtual void \fBTransactionAddedToMempool\fP (const \fBNewMempoolTransactionInfo\fP &tx, uint64_t mempool_sequence)"
.br
.ti -1c
.RI "virtual void \fBTransactionRemovedFromMempool\fP (const \fBCTransactionRef\fP &tx, \fBMemPoolRemovalReason\fP reason, uint64_t mempool_sequence)"
.br
.ti -1c
.RI "virtual void \fBMempoolTransactionsRemovedForBlock\fP (const std::vector< \fBRemovedMempoolTransactionInfo\fP > &txs_removed_for_block, unsigned int nBlockHeight)"
.br
.ti -1c
.RI "virtual void \fBBlockConnected\fP (const \fBkernel::ChainstateRole\fP &role, const std::shared_ptr< const \fBCBlock\fP > &block, const \fBCBlockIndex\fP *pindex)"
.br
.ti -1c
.RI "virtual void \fBBlockDisconnected\fP (const std::shared_ptr< const \fBCBlock\fP > &block, const \fBCBlockIndex\fP *pindex)"
.br
.ti -1c
.RI "virtual void \fBChainStateFlushed\fP (const \fBkernel::ChainstateRole\fP &role, const \fBCBlockLocator\fP &locator)"
.br
.ti -1c
.RI "virtual void \fBBlockChecked\fP (const std::shared_ptr< const \fBCBlock\fP > &, const \fBBlockValidationState\fP &)"
.br
.ti -1c
.RI "virtual void \fBNewPoWValidBlock\fP (const \fBCBlockIndex\fP *pindex, const std::shared_ptr< const \fBCBlock\fP > &block)"
.br
.in -1c

Protected Member Functions inherited from \fBNetEventsInterface\fP
.in +1c
.ti -1c
.RI "\fB~NetEventsInterface\fP ()=default"
.br
.in -1c
.SH "Constructor & Destructor Documentation"
.PP 
.SS "virtual ~\fBPeerManager\fP ()\fR [virtual]\fP, \fR [default]\fP"

.SH "Member Function Documentation"
.PP 
.SS "virtual void CheckForStaleTipAndEvictPeers ()\fR [pure virtual]\fP"
Evict extra outbound peers\&. If we think our tip may be stale, connect to an extra outbound\&. Public for unit testing\&. 
.SS "virtual \fButil::Expected\fP< void, std::string > FetchBlock (\fBNodeId\fP peer_id, const \fBCBlockIndex\fP & block_index)\fR [pure virtual]\fP"
Attempt to manually fetch block from a given peer\&. We must already have the header\&.

.PP
\fBParameters\fP
.RS 4
\fIpeer_id\fP The peer id 
.br
\fIblock_index\fP The blockindex 
.RE
.PP

.SS "virtual \fBServiceFlags\fP GetDesirableServiceFlags (\fBServiceFlags\fP services) const\fR [pure virtual]\fP"
Gets the set of service flags which are "desirable" for a given peer\&.

.PP
These are the flags which are required for a peer to support for them to be "interesting" to us, ie for us to wish to use one of our few outbound connection slots for or for us to wish to prioritize keeping their connection around\&.

.PP
Relevant service flags may be peer- and state-specific in that the version of the peer may determine which flags are required (eg in the case of NODE_NETWORK_LIMITED where we seek out NODE_NETWORK peers unless they set NODE_NETWORK_LIMITED and we are out of IBD, in which case NODE_NETWORK_LIMITED suffices)\&.

.PP
Thus, generally, avoid calling with 'services' == NODE_NONE, unless state-specific flags must absolutely be avoided\&. When called with 'services' == NODE_NONE, the returned desirable service flags are guaranteed to not change dependent on state - ie they are suitable for use when describing peers which we know to be desirable, but for which we do not have a confirmed set of service flags\&. 
.SS "virtual \fBPeerManagerInfo\fP GetInfo () const\fR [pure virtual]\fP"
Get peer manager info\&. 
.SS "virtual bool GetNodeStateStats (\fBNodeId\fP nodeid, \fBCNodeStateStats\fP & stats) const\fR [pure virtual]\fP"
Get statistics from node state 
.SS "virtual std::vector< \fBnode::TxOrphanage::OrphanInfo\fP > GetOrphanTransactions ()\fR [pure virtual]\fP"

.SS "std::unique_ptr< \fBPeerManager\fP > make (\fBCConnman\fP & connman, \fBAddrMan\fP & addrman, \fBBanMan\fP * banman, \fBChainstateManager\fP & chainman, \fBCTxMemPool\fP & pool, \fBnode::Warnings\fP & warnings, \fBOptions\fP opts)\fR [static]\fP"

.SS "virtual void ProcessMessage (\fBCNode\fP & pfrom, const std::string & msg_type, \fBDataStream\fP & vRecv, const std::chrono::microseconds time_received, const std::atomic< bool > & interruptMsgProc)\fR [pure virtual]\fP"
Process a single message from a peer\&. Public for fuzz testing 
.SS "virtual void RelayTransaction (const \fBTxid\fP & txid, const \fBWtxid\fP & wtxid)\fR [pure virtual]\fP"
Relay transaction to all peers\&. 
.SS "virtual void SendPings ()\fR [pure virtual]\fP"
Send ping message to all peers 
.SS "virtual void SetBestBlock (int height, std::chrono::seconds time)\fR [pure virtual]\fP"
Set the height of the best block and its time (seconds since epoch)\&. 
.SS "virtual void StartScheduledTasks (\fBCScheduler\fP & scheduler)\fR [pure virtual]\fP"
Begin running background tasks, should only be called once 
.SS "virtual void UnitTestMisbehaving (\fBNodeId\fP peer_id)\fR [pure virtual]\fP"

.SS "virtual void UpdateLastBlockAnnounceTime (\fBNodeId\fP node, int64_t time_in_seconds)\fR [pure virtual]\fP"
This function is used for testing the stale tip eviction logic, see \fBdenialofservice_tests\&.cpp\fP 

.SH "Author"
.PP 
Generated automatically by Doxygen for bitcoind from the source code\&.
