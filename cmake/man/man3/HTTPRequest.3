.TH "HTTPRequest" 3 "Version 2.8" "bitcoind" \" -*- nroff -*-
.ad l
.nh
.SH NAME
HTTPRequest
.SH SYNOPSIS
.br
.PP
.PP
\fR#include <httpserver\&.h>\fP
.SS "Public Types"

.in +1c
.ti -1c
.RI "enum \fBRequestMethod\fP { \fBUNKNOWN\fP, \fBGET\fP, \fBPOST\fP, \fBHEAD\fP, \fBPUT\fP }"
.br
.in -1c
.SS "Public Member Functions"

.in +1c
.ti -1c
.RI "\fBHTTPRequest\fP (struct evhttp_request *req, const \fButil::SignalInterrupt\fP &interrupt, bool replySent=false)"
.br
.ti -1c
.RI "\fB~HTTPRequest\fP ()"
.br
.ti -1c
.RI "std::string \fBGetURI\fP () const"
.br
.ti -1c
.RI "\fBCService\fP \fBGetPeer\fP () const"
.br
.ti -1c
.RI "\fBRequestMethod\fP \fBGetRequestMethod\fP () const"
.br
.ti -1c
.RI "std::optional< std::string > \fBGetQueryParameter\fP (const std::string &key) const"
.br
.ti -1c
.RI "std::pair< bool, std::string > \fBGetHeader\fP (const std::string &hdr) const"
.br
.ti -1c
.RI "std::string \fBReadBody\fP ()"
.br
.ti -1c
.RI "void \fBWriteHeader\fP (const std::string &hdr, const std::string &value)"
.br
.ti -1c
.RI "void \fBWriteReply\fP (int nStatus, std::string_view reply='')"
.br
.ti -1c
.RI "void \fBWriteReply\fP (int nStatus, std::span< const std::byte > reply)"
.br
.in -1c
.SH "Detailed Description"
.PP 
In-flight HTTP request\&. Thin C++ wrapper around evhttp_request\&. 
.SH "Member Enumeration Documentation"
.PP 
.SS "enum \fBRequestMethod\fP"

.PP
\fBEnumerator\fP
.in +1c
.TP
\f(BIUNKNOWN \fP
.TP
\f(BIGET \fP
.TP
\f(BIPOST \fP
.TP
\f(BIHEAD \fP
.TP
\f(BIPUT \fP
.SH "Constructor & Destructor Documentation"
.PP 
.SS "\fBHTTPRequest\fP (struct evhttp_request * req, const \fButil::SignalInterrupt\fP & interrupt, bool replySent = \fRfalse\fP)\fR [explicit]\fP"

.SS "~\fBHTTPRequest\fP ()"

.SH "Member Function Documentation"
.PP 
.SS "std::pair< bool, std::string > GetHeader (const std::string & hdr) const"
Get the request header specified by hdr, or an empty string\&. Return a pair (isPresent,string)\&. 
.SS "\fBCService\fP GetPeer () const"
Get \fBCService\fP (address:ip) for the origin of the http request\&. 
.SS "std::optional< std::string > GetQueryParameter (const std::string & key) const"
Get the query parameter value from request uri for a specified key, or std::nullopt if the key is not found\&.

.PP
If the query string contains duplicate keys, the first value is returned\&. Many web frameworks would instead parse this as an array of values, but this is not (yet) implemented as it is currently not needed in any of the endpoints\&.

.PP
\fBParameters\fP
.RS 4
\fIkey\fP represents the query parameter of which the value is returned 
.RE
.PP

.SS "\fBHTTPRequest::RequestMethod\fP GetRequestMethod () const"
Get request method\&. 
.SS "std::string GetURI () const"
Get requested URI\&. 
.SS "std::string ReadBody ()"
Read request body\&.

.PP
\fBNote\fP
.RS 4
As this consumes the underlying buffer, call this only once\&. Repeated calls will return an empty string\&. 
.RE
.PP
Trivial implementation: if this is ever a performance bottleneck, internal copying can be avoided in multi-segment buffers by using evbuffer_peek and an awkward loop\&. Though in that case, it'd be even better to not copy into an intermediate string but use a stream abstraction to consume the evbuffer on the fly in the parsing algorithm\&.
.SS "void WriteHeader (const std::string & hdr, const std::string & value)"
Write output header\&.

.PP
\fBNote\fP
.RS 4
call this before calling WriteErrorReply or Reply\&. 
.RE
.PP

.SS "void WriteReply (int nStatus, std::span< const std::byte > reply)"
Closure sent to main thread to request a reply to be sent to a HTTP request\&. Replies must be sent in the main loop in the main http thread, this cannot be done from worker threads\&. 
.SS "void WriteReply (int nStatus, std::string_view reply = \fR''\fP)\fR [inline]\fP"
Write HTTP reply\&. nStatus is the HTTP status code to send\&. reply is the body of the reply\&. Keep it empty to send a standard message\&.

.PP
\fBNote\fP
.RS 4
Can be called only once\&. As this will give the request back to the main thread, do not call any other \fBHTTPRequest\fP methods after calling this\&. 
.RE
.PP


.SH "Author"
.PP 
Generated automatically by Doxygen for bitcoind from the source code\&.
