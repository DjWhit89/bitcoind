<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="blockfilterindex_8cpp" kind="file" language="C++">
    <compoundname>blockfilterindex.cpp</compoundname>
    <includes refid="blockfilterindex_8h" local="no">index/blockfilterindex.h</includes>
    <includes local="no">blockfilter.h</includes>
    <includes local="no">chain.h</includes>
    <includes refid="args_8h" local="no">common/args.h</includes>
    <includes refid="dbwrapper_8h" local="no">dbwrapper.h</includes>
    <includes refid="flatfile_8h" local="no">flatfile.h</includes>
    <includes local="no">hash.h</includes>
    <includes refid="base_8h" local="no">index/base.h</includes>
    <includes refid="interfaces_2chain_8h" local="no">interfaces/chain.h</includes>
    <includes refid="interfaces_2types_8h" local="no">interfaces/types.h</includes>
    <includes local="no">logging.h</includes>
    <includes refid="serialize_8h" local="no">serialize.h</includes>
    <includes refid="streams_8h" local="no">streams.h</includes>
    <includes refid="sync_8h" local="no">sync.h</includes>
    <includes refid="uint256_8h" local="no">uint256.h</includes>
    <includes refid="check_8h" local="no">util/check.h</includes>
    <includes refid="fs_8h" local="no">util/fs.h</includes>
    <includes refid="hasher_8h" local="no">util/hasher.h</includes>
    <includes refid="syserror_8h" local="no">util/syserror.h</includes>
    <includes local="no">cerrno</includes>
    <includes local="no">exception</includes>
    <includes local="no">ios</includes>
    <includes local="no">map</includes>
    <includes local="no">optional</includes>
    <includes local="no">span</includes>
    <includes local="no">stdexcept</includes>
    <includes local="no">string</includes>
    <includes local="no">tuple</includes>
    <includes local="no">utility</includes>
    <includes local="no">vector</includes>
    <incdepgraph>
      <node id="3">
        <label>attributes.h</label>
        <link refid="attributes_8h"/>
      </node>
      <node id="108">
        <label>common/args.h</label>
        <link refid="args_8h"/>
        <childnode refid="73" relation="include">
        </childnode>
        <childnode refid="109" relation="include">
        </childnode>
        <childnode refid="100" relation="include">
        </childnode>
        <childnode refid="122" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="123" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="86" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="73">
        <label>common/settings.h</label>
        <link refid="common_2settings_8h"/>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="7">
        <label>compat/assumptions.h</label>
        <link refid="compat_2assumptions_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
      </node>
      <node id="11">
        <label>compat/byteswap.h</label>
        <link refid="byteswap_8h"/>
        <childnode refid="12" relation="include">
        </childnode>
      </node>
      <node id="109">
        <label>compat/compat.h</label>
        <link refid="compat_8h"/>
        <childnode refid="110" relation="include">
        </childnode>
        <childnode refid="111" relation="include">
        </childnode>
        <childnode refid="112" relation="include">
        </childnode>
        <childnode refid="113" relation="include">
        </childnode>
        <childnode refid="114" relation="include">
        </childnode>
        <childnode refid="115" relation="include">
        </childnode>
        <childnode refid="116" relation="include">
        </childnode>
        <childnode refid="117" relation="include">
        </childnode>
        <childnode refid="118" relation="include">
        </childnode>
        <childnode refid="119" relation="include">
        </childnode>
        <childnode refid="120" relation="include">
        </childnode>
        <childnode refid="121" relation="include">
        </childnode>
      </node>
      <node id="10">
        <label>compat/endian.h</label>
        <link refid="endian_8h"/>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
      </node>
      <node id="76">
        <label>consensus/amount.h</label>
        <link refid="amount_8h"/>
        <childnode refid="12" relation="include">
        </childnode>
      </node>
      <node id="78">
        <label>consensus/consensus.h</label>
        <link refid="consensus_8h"/>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="82">
        <label>crypto/common.h</label>
        <link refid="crypto_2common_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
      </node>
      <node id="65">
        <label>crypto/hex_base.h</label>
        <link refid="hex__base_8h"/>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="49">
        <label>crypto/siphash.h</label>
        <link refid="siphash_8h"/>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="46">
        <label>dbwrapper.h</label>
        <link refid="dbwrapper_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="70" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>flatfile.h</label>
        <link refid="flatfile_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="45">
        <label>index/base.h</label>
        <link refid="base_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="71" relation="include">
        </childnode>
        <childnode refid="99" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="104" relation="include">
        </childnode>
        <childnode refid="105" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="103" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>src/index/blockfilterindex.cpp</label>
        <link refid="blockfilterindex_8cpp"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="72" relation="include">
        </childnode>
        <childnode refid="107" relation="include">
        </childnode>
        <childnode refid="108" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="91" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="71" relation="include">
        </childnode>
        <childnode refid="124" relation="include">
        </childnode>
        <childnode refid="125" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="100" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="106" relation="include">
        </childnode>
        <childnode refid="69" relation="include">
        </childnode>
        <childnode refid="121" relation="include">
        </childnode>
        <childnode refid="70" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="85" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>index/blockfilterindex.h</label>
        <link refid="blockfilterindex_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="71" relation="include">
        </childnode>
        <childnode refid="100" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="106" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="71">
        <label>interfaces/chain.h</label>
        <link refid="interfaces_2chain_8h"/>
        <childnode refid="72" relation="include">
        </childnode>
        <childnode refid="73" relation="include">
        </childnode>
        <childnode refid="74" relation="include">
        </childnode>
        <childnode refid="75" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="97" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="124">
        <label>interfaces/types.h</label>
        <link refid="interfaces_2types_8h"/>
        <childnode refid="81" relation="include">
        </childnode>
      </node>
      <node id="74">
        <label>kernel/chain.h</label>
        <link refid="kernel_2chain_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
      </node>
      <node id="99">
        <label>kernel/cs_main.h</label>
        <link refid="cs__main_8h"/>
        <childnode refid="100" relation="include">
        </childnode>
      </node>
      <node id="48">
        <label>logging.h</label>
        <link refid="logging_8h"/>
        <childnode refid="49" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="55" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="54" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="60" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="75">
        <label>node/types.h</label>
        <link refid="node_2types_8h"/>
        <childnode refid="76" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="77" relation="include">
        </childnode>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="96" relation="include">
        </childnode>
      </node>
      <node id="77">
        <label>policy/policy.h</label>
        <link refid="policy_8h"/>
        <childnode refid="76" relation="include">
        </childnode>
        <childnode refid="78" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="90" relation="include">
        </childnode>
        <childnode refid="94" relation="include">
        </childnode>
        <childnode refid="95" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="14">
        <label>prevector.h</label>
        <link refid="prevector_8h"/>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
      </node>
      <node id="79">
        <label>primitives/transaction.h</label>
        <link refid="primitives_2transaction_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="76" relation="include">
        </childnode>
        <childnode refid="80" relation="include">
        </childnode>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="89" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="85" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="80">
        <label>primitives/transaction_identifier.h</label>
        <link refid="transaction__identifier_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="83" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="85" relation="include">
        </childnode>
        <childnode refid="86" relation="include">
        </childnode>
      </node>
      <node id="90">
        <label>script/interpreter.h</label>
        <link refid="interpreter_8h"/>
        <childnode refid="76" relation="include">
        </childnode>
        <childnode refid="91" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="92" relation="include">
        </childnode>
        <childnode refid="93" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="87">
        <label>script/script.h</label>
        <link refid="script_2script_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="88" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="92">
        <label>script/script_error.h</label>
        <link refid="script__error_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="94">
        <label>script/solver.h</label>
        <link refid="solver_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="93">
        <label>script/verify_flags.h</label>
        <link refid="verify__flags_8h"/>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
      </node>
      <node id="6">
        <label>serialize.h</label>
        <link refid="serialize_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="22">
        <label>span.h</label>
        <link refid="span_8h"/>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
      </node>
      <node id="47">
        <label>streams.h</label>
        <link refid="streams_8h"/>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="68" relation="include">
        </childnode>
        <childnode refid="69" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="61">
        <label>support/allocators/zeroafterfree.h</label>
        <link refid="zeroafterfree_8h"/>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="62">
        <label>support/cleanse.h</label>
        <link refid="cleanse_8h"/>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="100">
        <label>sync.h</label>
        <link refid="sync_8h"/>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="101" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="102" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="103" relation="include">
        </childnode>
      </node>
      <node id="50">
        <label>threadsafety.h</label>
        <link refid="threadsafety_8h"/>
        <childnode refid="51" relation="include">
        </childnode>
      </node>
      <node id="31">
        <label>tinyformat.h</label>
        <link refid="tinyformat_8h"/>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="81">
        <label>uint256.h</label>
        <link refid="uint256_8h"/>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
      </node>
      <node id="122">
        <label>util/chaintype.h</label>
        <link refid="chaintype_8h"/>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="52">
        <label>util/check.h</label>
        <link refid="check_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="54" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
      </node>
      <node id="95">
        <label>util/feefrac.h</label>
        <link refid="feefrac_8h"/>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="30">
        <label>util/fs.h</label>
        <link refid="fs_8h"/>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
      </node>
      <node id="88">
        <label>util/hash_type.h</label>
        <link refid="hash__type_8h"/>
      </node>
      <node id="106">
        <label>util/hasher.h</label>
        <link refid="hasher_8h"/>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="49" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
      </node>
      <node id="101">
        <label>util/macros.h</label>
        <link refid="macros_8h"/>
      </node>
      <node id="63">
        <label>util/obfuscation.h</label>
        <link refid="obfuscation_8h"/>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="67" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
      </node>
      <node id="68">
        <label>util/overflow.h</label>
        <link refid="overflow_8h"/>
        <childnode refid="67" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
      </node>
      <node id="97">
        <label>util/result.h</label>
        <link refid="result_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="98" relation="include">
        </childnode>
        <childnode refid="86" relation="include">
        </childnode>
      </node>
      <node id="64">
        <label>util/strencodings.h</label>
        <link refid="strencodings_8h"/>
        <childnode refid="65" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="66" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="35">
        <label>util/string.h</label>
        <link refid="string_8h"/>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="69">
        <label>util/syserror.h</label>
        <link refid="syserror_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="55">
        <label>util/time.h</label>
        <link refid="util_2time_8h"/>
        <childnode refid="56" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
      </node>
      <node id="98">
        <label>util/translation.h</label>
        <link refid="translation_8h"/>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="83">
        <label>util/types.h</label>
        <link refid="util_2types_8h"/>
      </node>
      <node id="105">
        <label>validationinterface.h</label>
        <link refid="validationinterface_8h"/>
        <childnode refid="99" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="100" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="15">
        <label>algorithm</label>
      </node>
      <node id="110">
        <label>arpa/inet.h</label>
      </node>
      <node id="36">
        <label>array</label>
      </node>
      <node id="53">
        <label>atomic</label>
      </node>
      <node id="13">
        <label>bit</label>
      </node>
      <node id="72">
        <label>blockfilter.h</label>
      </node>
      <node id="16">
        <label>cassert</label>
      </node>
      <node id="121">
        <label>cerrno</label>
      </node>
      <node id="107">
        <label>chain.h</label>
      </node>
      <node id="66">
        <label>charconv</label>
      </node>
      <node id="56">
        <label>chrono</label>
      </node>
      <node id="67">
        <label>climits</label>
      </node>
      <node id="84">
        <label>compare</label>
      </node>
      <node id="24">
        <label>concepts</label>
      </node>
      <node id="102">
        <label>condition_variable</label>
      </node>
      <node id="8">
        <label>cstddef</label>
      </node>
      <node id="12">
        <label>cstdint</label>
      </node>
      <node id="39">
        <label>cstdio</label>
      </node>
      <node id="17">
        <label>cstdlib</label>
      </node>
      <node id="18">
        <label>cstring</label>
      </node>
      <node id="70">
        <label>exception</label>
      </node>
      <node id="111">
        <label>fcntl.h</label>
      </node>
      <node id="40">
        <label>filesystem</label>
      </node>
      <node id="41">
        <label>functional</label>
      </node>
      <node id="91">
        <label>hash.h</label>
      </node>
      <node id="42">
        <label>iomanip</label>
      </node>
      <node id="25">
        <label>ios</label>
      </node>
      <node id="123">
        <label>iosfwd</label>
      </node>
      <node id="32">
        <label>iostream</label>
      </node>
      <node id="19">
        <label>iterator</label>
      </node>
      <node id="9">
        <label>limits</label>
      </node>
      <node id="58">
        <label>list</label>
      </node>
      <node id="37">
        <label>locale</label>
      </node>
      <node id="125">
        <label>logging.h</label>
      </node>
      <node id="26">
        <label>map</label>
      </node>
      <node id="27">
        <label>memory</label>
      </node>
      <node id="51">
        <label>mutex</label>
      </node>
      <node id="112">
        <label>net/if.h</label>
      </node>
      <node id="113">
        <label>netdb.h</label>
      </node>
      <node id="114">
        <label>netinet/in.h</label>
      </node>
      <node id="115">
        <label>netinet/tcp.h</label>
      </node>
      <node id="89">
        <label>numeric</label>
      </node>
      <node id="57">
        <label>optional</label>
      </node>
      <node id="43">
        <label>ostream</label>
      </node>
      <node id="28">
        <label>set</label>
      </node>
      <node id="54">
        <label>source_location</label>
      </node>
      <node id="23">
        <label>span</label>
      </node>
      <node id="33">
        <label>sstream</label>
      </node>
      <node id="34">
        <label>stdexcept</label>
      </node>
      <node id="5">
        <label>string</label>
      </node>
      <node id="38">
        <label>string_view</label>
      </node>
      <node id="116">
        <label>sys/mman.h</label>
      </node>
      <node id="117">
        <label>sys/select.h</label>
      </node>
      <node id="118">
        <label>sys/socket.h</label>
      </node>
      <node id="119">
        <label>sys/types.h</label>
      </node>
      <node id="44">
        <label>system_error</label>
      </node>
      <node id="103">
        <label>thread</label>
      </node>
      <node id="85">
        <label>tuple</label>
      </node>
      <node id="20">
        <label>type_traits</label>
      </node>
      <node id="120">
        <label>unistd.h</label>
      </node>
      <node id="59">
        <label>unordered_map</label>
      </node>
      <node id="60">
        <label>unordered_set</label>
      </node>
      <node id="104">
        <label>util/threadinterrupt.h</label>
      </node>
      <node id="96">
        <label>util/time.h</label>
      </node>
      <node id="21">
        <label>utility</label>
      </node>
      <node id="86">
        <label>variant</label>
      </node>
      <node id="29">
        <label>vector</label>
      </node>
    </incdepgraph>
    <sectiondef kind="var">
      <memberdef kind="variable" id="blockfilterindex_8cpp_1aa35d80382f5cad0ca2d8081b37db0ea6" prot="public" static="no" constexpr="yes" mutable="no">
        <type>uint8_t</type>
        <definition>uint8_t DB_BLOCK_HASH</definition>
        <argsstring></argsstring>
        <name>DB_BLOCK_HASH</name>
        <initializer>{&apos;s&apos;}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/index/blockfilterindex.cpp" line="53" column="19" bodyfile="src/index/blockfilterindex.cpp" bodystart="53" bodyend="53"/>
      </memberdef>
      <memberdef kind="variable" id="blockfilterindex_8cpp_1ae0aa2e8634a01080040d4cd90cc0dcf8" prot="public" static="no" constexpr="yes" mutable="no">
        <type>uint8_t</type>
        <definition>uint8_t DB_BLOCK_HEIGHT</definition>
        <argsstring></argsstring>
        <name>DB_BLOCK_HEIGHT</name>
        <initializer>{&apos;t&apos;}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/index/blockfilterindex.cpp" line="54" column="19" bodyfile="src/index/blockfilterindex.cpp" bodystart="54" bodyend="54"/>
      </memberdef>
      <memberdef kind="variable" id="blockfilterindex_8cpp_1a7f512d8cf4c51f3a48d9700c42249333" prot="public" static="no" constexpr="yes" mutable="no">
        <type>uint8_t</type>
        <definition>uint8_t DB_FILTER_POS</definition>
        <argsstring></argsstring>
        <name>DB_FILTER_POS</name>
        <initializer>{&apos;P&apos;}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/index/blockfilterindex.cpp" line="55" column="19" bodyfile="src/index/blockfilterindex.cpp" bodystart="55" bodyend="55"/>
      </memberdef>
      <memberdef kind="variable" id="blockfilterindex_8cpp_1aa00aebf16bed05cda303598f0f1e1305" prot="public" static="no" constexpr="yes" mutable="no">
        <type>unsigned int</type>
        <definition>unsigned int MAX_FLTR_FILE_SIZE</definition>
        <argsstring></argsstring>
        <name>MAX_FLTR_FILE_SIZE</name>
        <initializer>= 0x1000000</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/index/blockfilterindex.cpp" line="57" column="24" bodyfile="src/index/blockfilterindex.cpp" bodystart="57" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="blockfilterindex_8cpp_1a29ffa311c98393be54cd19fa3e9eff81" prot="public" static="no" constexpr="yes" mutable="no">
        <type>unsigned int</type>
        <definition>unsigned int FLTR_FILE_CHUNK_SIZE</definition>
        <argsstring></argsstring>
        <name>FLTR_FILE_CHUNK_SIZE</name>
        <initializer>= 0x100000</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>The pre-allocation chunk size for fltr?????.dat files </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/index/blockfilterindex.cpp" line="59" column="24" bodyfile="src/index/blockfilterindex.cpp" bodystart="59" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="blockfilterindex_8cpp_1ab55a01b8db4071d26b5051b63298c6dd" prot="public" static="no" constexpr="yes" mutable="no">
        <type>size_t</type>
        <definition>size_t CF_HEADERS_CACHE_MAX_SZ</definition>
        <argsstring></argsstring>
        <name>CF_HEADERS_CACHE_MAX_SZ</name>
        <initializer>{2000}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Maximum size of the cfheaders cache We have a limit to prevent a bug in filling this cache potentially turning into an OOM. At 2000 entries, this cache is big enough for a 2,000,000 length block chain, which we should be enough until ~2047. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/index/blockfilterindex.cpp" line="65" column="18" bodyfile="src/index/blockfilterindex.cpp" bodystart="65" bodyend="65"/>
      </memberdef>
      <memberdef kind="variable" id="blockfilterindex_8cpp_1aeff2a029c1f04d70e823c78ed66d89f4" prot="public" static="yes" mutable="no">
        <type>std::map&lt; <ref refid="blockfilter_8h_1a530bf73ca0d532a142641644a1605250" kindref="member">BlockFilterType</ref>, <ref refid="class_block_filter_index" kindref="compound">BlockFilterIndex</ref> &gt;</type>
        <definition>std::map&lt;BlockFilterType, BlockFilterIndex&gt; g_filter_indexes</definition>
        <argsstring></argsstring>
        <name>g_filter_indexes</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/index/blockfilterindex.cpp" line="118" column="17" bodyfile="src/index/blockfilterindex.cpp" bodystart="118" bodyend="-1"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="func">
      <memberdef kind="function" id="blockfilterindex_8cpp_1ab045cbb6a78de09665691eae5089fa4a" prot="public" static="yes" nodiscard="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool CopyHeightIndexToHashIndex</definition>
        <argsstring>(CDBIterator &amp;db_it, CDBBatch &amp;batch, const std::string &amp;index_name, int height)</argsstring>
        <name>CopyHeightIndexToHashIndex</name>
        <param>
          <type><ref refid="class_c_d_b_iterator" kindref="compound">CDBIterator</ref> &amp;</type>
          <declname>db_it</declname>
        </param>
        <param>
          <type><ref refid="class_c_d_b_batch" kindref="compound">CDBBatch</ref> &amp;</type>
          <declname>batch</declname>
        </param>
        <param>
          <type>const std::string &amp;</type>
          <declname>index_name</declname>
        </param>
        <param>
          <type>int</type>
          <declname>height</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/index/blockfilterindex.cpp" line="320" column="14" bodyfile="src/index/blockfilterindex.cpp" bodystart="320" bodyend="341"/>
      </memberdef>
      <memberdef kind="function" id="blockfilterindex_8cpp_1a8058659fd317b841867db26df423fe5c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool LookupOne</definition>
        <argsstring>(const CDBWrapper &amp;db, const CBlockIndex *block_index, DBVal &amp;result)</argsstring>
        <name>LookupOne</name>
        <param>
          <type>const <ref refid="class_c_d_b_wrapper" kindref="compound">CDBWrapper</ref> &amp;</type>
          <declname>db</declname>
        </param>
        <param>
          <type>const <ref refid="class_c_block_index" kindref="compound">CBlockIndex</ref> *</type>
          <declname>block_index</declname>
        </param>
        <param>
          <type>DBVal &amp;</type>
          <declname>result</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/index/blockfilterindex.cpp" line="366" column="13" bodyfile="src/index/blockfilterindex.cpp" bodystart="366" bodyend="382"/>
      </memberdef>
      <memberdef kind="function" id="blockfilterindex_8cpp_1acdc51e566ff67f1e97a0279a92099a57" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool LookupRange</definition>
        <argsstring>(CDBWrapper &amp;db, const std::string &amp;index_name, int start_height, const CBlockIndex *stop_index, std::vector&lt; DBVal &gt; &amp;results)</argsstring>
        <name>LookupRange</name>
        <param>
          <type><ref refid="class_c_d_b_wrapper" kindref="compound">CDBWrapper</ref> &amp;</type>
          <declname>db</declname>
        </param>
        <param>
          <type>const std::string &amp;</type>
          <declname>index_name</declname>
        </param>
        <param>
          <type>int</type>
          <declname>start_height</declname>
        </param>
        <param>
          <type>const <ref refid="class_c_block_index" kindref="compound">CBlockIndex</ref> *</type>
          <declname>stop_index</declname>
        </param>
        <param>
          <type>std::vector&lt; DBVal &gt; &amp;</type>
          <declname>results</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/index/blockfilterindex.cpp" line="384" column="13" bodyfile="src/index/blockfilterindex.cpp" bodystart="384" bodyend="441"/>
      </memberdef>
      <memberdef kind="function" id="blockfilterindex_8cpp_1a7e5a7eafefd6511f8d95b2583bdb53b0" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="class_block_filter_index" kindref="compound">BlockFilterIndex</ref> *</type>
        <definition>BlockFilterIndex * GetBlockFilterIndex</definition>
        <argsstring>(BlockFilterType filter_type)</argsstring>
        <name>GetBlockFilterIndex</name>
        <param>
          <type><ref refid="blockfilter_8h_1a530bf73ca0d532a142641644a1605250" kindref="member">BlockFilterType</ref></type>
          <declname>filter_type</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Get a block filter index by type. Returns nullptr if index has not been initialized or was already destroyed. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/index/blockfilterindex.cpp" line="520" column="18" bodyfile="src/index/blockfilterindex.cpp" bodystart="520" bodyend="524"/>
      </memberdef>
      <memberdef kind="function" id="blockfilterindex_8cpp_1aa52651271de1e684295aedd1166ebf14" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void ForEachBlockFilterIndex</definition>
        <argsstring>(std::function&lt; void(BlockFilterIndex &amp;)&gt; fn)</argsstring>
        <name>ForEachBlockFilterIndex</name>
        <param>
          <type>std::function&lt; void(<ref refid="class_block_filter_index" kindref="compound">BlockFilterIndex</ref> &amp;)&gt;</type>
          <declname>fn</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Iterate over all running block filter indexes, invoking fn on each. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/index/blockfilterindex.cpp" line="526" column="6" bodyfile="src/index/blockfilterindex.cpp" bodystart="526" bodyend="529"/>
      </memberdef>
      <memberdef kind="function" id="blockfilterindex_8cpp_1aca74aaaf3cd2da07d55e1b9354952c15" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>bool InitBlockFilterIndex</definition>
        <argsstring>(std::function&lt; std::unique_ptr&lt; interfaces::Chain &gt;()&gt; make_chain, BlockFilterType filter_type, size_t n_cache_size, bool f_memory, bool f_wipe)</argsstring>
        <name>InitBlockFilterIndex</name>
        <param>
          <type>std::function&lt; std::unique_ptr&lt; <ref refid="classinterfaces_1_1_chain" kindref="compound">interfaces::Chain</ref> &gt;()&gt;</type>
          <declname>make_chain</declname>
        </param>
        <param>
          <type><ref refid="blockfilter_8h_1a530bf73ca0d532a142641644a1605250" kindref="member">BlockFilterType</ref></type>
          <declname>filter_type</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n_cache_size</declname>
        </param>
        <param>
          <type>bool</type>
          <declname>f_memory</declname>
          <defval>false</defval>
        </param>
        <param>
          <type>bool</type>
          <declname>f_wipe</declname>
          <defval>false</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Initialize a block filter index for the given type if one does not already exist. Returns true if a new index is created and false if one has already been initialized. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/index/blockfilterindex.cpp" line="531" column="6" bodyfile="src/index/blockfilterindex.cpp" bodystart="531" bodyend="539"/>
      </memberdef>
      <memberdef kind="function" id="blockfilterindex_8cpp_1a2b01ec52cf934f07ad0b840eb6f592ed" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>bool DestroyBlockFilterIndex</definition>
        <argsstring>(BlockFilterType filter_type)</argsstring>
        <name>DestroyBlockFilterIndex</name>
        <param>
          <type><ref refid="blockfilter_8h_1a530bf73ca0d532a142641644a1605250" kindref="member">BlockFilterType</ref></type>
          <declname>filter_type</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Destroy the block filter index with the given type. Returns false if no such index exists. This just releases the allocated memory and closes the database connection, it does not delete the index data. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/index/blockfilterindex.cpp" line="541" column="6" bodyfile="src/index/blockfilterindex.cpp" bodystart="541" bodyend="544"/>
      </memberdef>
      <memberdef kind="function" id="blockfilterindex_8cpp_1a5809c1c43a5b3c1d77f10e25a506a565" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void DestroyAllBlockFilterIndexes</definition>
        <argsstring>()</argsstring>
        <name>DestroyAllBlockFilterIndexes</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Destroy all open block filter indexes. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/index/blockfilterindex.cpp" line="546" column="6" bodyfile="src/index/blockfilterindex.cpp" bodystart="546" bodyend="549"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2018-present<sp/>The<sp/>Bitcoin<sp/>Core<sp/>developers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Distributed<sp/>under<sp/>the<sp/>MIT<sp/>software<sp/>license,<sp/>see<sp/>the<sp/>accompanying</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">//<sp/>file<sp/>COPYING<sp/>or<sp/>http://www.opensource.org/licenses/mit-license.php.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="blockfilterindex_8h" kindref="compound">index/blockfilterindex.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;blockfilter.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="kernel_2chain_8h" kindref="compound">chain.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="args_8h" kindref="compound">common/args.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="dbwrapper_8h" kindref="compound">dbwrapper.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="flatfile_8h" kindref="compound">flatfile.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;hash.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="base_8h" kindref="compound">index/base.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="interfaces_2chain_8h" kindref="compound">interfaces/chain.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="interfaces_2types_8h" kindref="compound">interfaces/types.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;logging.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="serialize_8h" kindref="compound">serialize.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="streams_8h" kindref="compound">streams.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="sync_8h" kindref="compound">sync.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="uint256_8h" kindref="compound">uint256.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="check_8h" kindref="compound">util/check.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="fs_8h" kindref="compound">util/fs.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="hasher_8h" kindref="compound">util/hasher.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="syserror_8h" kindref="compound">util/syserror.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;cerrno&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;exception&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;ios&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;map&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;optional&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;span&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdexcept&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;tuple&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;utility&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;vector&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>The<sp/>index<sp/>database<sp/>stores<sp/>three<sp/>items<sp/>for<sp/>each<sp/>block:<sp/>the<sp/>disk<sp/>location<sp/>of<sp/>the<sp/>encoded<sp/>filter,</highlight></codeline>
<codeline lineno="39"><highlight class="comment"><sp/>*<sp/>its<sp/>dSHA256<sp/>hash,<sp/>and<sp/>the<sp/>header.<sp/>Those<sp/>belonging<sp/>to<sp/>blocks<sp/>on<sp/>the<sp/>active<sp/>chain<sp/>are<sp/>indexed<sp/>by</highlight></codeline>
<codeline lineno="40"><highlight class="comment"><sp/>*<sp/>height,<sp/>and<sp/>those<sp/>belonging<sp/>to<sp/>blocks<sp/>that<sp/>have<sp/>been<sp/>reorganized<sp/>out<sp/>of<sp/>the<sp/>active<sp/>chain<sp/>are</highlight></codeline>
<codeline lineno="41"><highlight class="comment"><sp/>*<sp/>indexed<sp/>by<sp/>block<sp/>hash.<sp/>This<sp/>ensures<sp/>that<sp/>filter<sp/>data<sp/>for<sp/>any<sp/>block<sp/>that<sp/>becomes<sp/>part<sp/>of<sp/>the</highlight></codeline>
<codeline lineno="42"><highlight class="comment"><sp/>*<sp/>active<sp/>chain<sp/>can<sp/>always<sp/>be<sp/>retrieved,<sp/>alleviating<sp/>timing<sp/>concerns.</highlight></codeline>
<codeline lineno="43"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="44"><highlight class="comment"><sp/>*<sp/>The<sp/>filters<sp/>themselves<sp/>are<sp/>stored<sp/>in<sp/>flat<sp/>files<sp/>and<sp/>referenced<sp/>by<sp/>the<sp/>LevelDB<sp/>entries.<sp/>This</highlight></codeline>
<codeline lineno="45"><highlight class="comment"><sp/>*<sp/>minimizes<sp/>the<sp/>amount<sp/>of<sp/>data<sp/>written<sp/>to<sp/>LevelDB<sp/>and<sp/>keeps<sp/>the<sp/>database<sp/>values<sp/>constant<sp/>size.<sp/>The</highlight></codeline>
<codeline lineno="46"><highlight class="comment"><sp/>*<sp/>disk<sp/>location<sp/>of<sp/>the<sp/>next<sp/>block<sp/>filter<sp/>to<sp/>be<sp/>written<sp/>(represented<sp/>as<sp/>a<sp/>FlatFilePos)<sp/>is<sp/>stored</highlight></codeline>
<codeline lineno="47"><highlight class="comment"><sp/>*<sp/>under<sp/>the<sp/>DB_FILTER_POS<sp/>key.</highlight></codeline>
<codeline lineno="48"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="49"><highlight class="comment"><sp/>*<sp/>Keys<sp/>for<sp/>the<sp/>height<sp/>index<sp/>have<sp/>the<sp/>type<sp/>[DB_BLOCK_HEIGHT,<sp/>uint32<sp/>(BE)].<sp/>The<sp/>height<sp/>is<sp/>represented</highlight></codeline>
<codeline lineno="50"><highlight class="comment"><sp/>*<sp/>as<sp/>big-endian<sp/>so<sp/>that<sp/>sequential<sp/>reads<sp/>of<sp/>filters<sp/>by<sp/>height<sp/>are<sp/>fast.</highlight></codeline>
<codeline lineno="51"><highlight class="comment"><sp/>*<sp/>Keys<sp/>for<sp/>the<sp/>hash<sp/>index<sp/>have<sp/>the<sp/>type<sp/>[DB_BLOCK_HASH,<sp/>uint256].</highlight></codeline>
<codeline lineno="52"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/>uint8_t<sp/><ref refid="blockfilterindex_8cpp_1aa35d80382f5cad0ca2d8081b37db0ea6" kindref="member">DB_BLOCK_HASH</ref>{</highlight><highlight class="charliteral">&apos;s&apos;</highlight><highlight class="normal">};</highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/>uint8_t<sp/><ref refid="blockfilterindex_8cpp_1ae0aa2e8634a01080040d4cd90cc0dcf8" kindref="member">DB_BLOCK_HEIGHT</ref>{</highlight><highlight class="charliteral">&apos;t&apos;</highlight><highlight class="normal">};</highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/>uint8_t<sp/><ref refid="blockfilterindex_8cpp_1a7f512d8cf4c51f3a48d9700c42249333" kindref="member">DB_FILTER_POS</ref>{</highlight><highlight class="charliteral">&apos;P&apos;</highlight><highlight class="normal">};</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="blockfilterindex_8cpp_1aa00aebf16bed05cda303598f0f1e1305" kindref="member">MAX_FLTR_FILE_SIZE</ref><sp/>=<sp/>0x1000000;<sp/></highlight><highlight class="comment">//<sp/>16<sp/>MiB</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="blockfilterindex_8cpp_1a29ffa311c98393be54cd19fa3e9eff81" kindref="member">FLTR_FILE_CHUNK_SIZE</ref><sp/>=<sp/>0x100000;<sp/></highlight><highlight class="comment">//<sp/>1<sp/>MiB</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="blockfilterindex_8cpp_1ab55a01b8db4071d26b5051b63298c6dd" kindref="member">CF_HEADERS_CACHE_MAX_SZ</ref>{2000};</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight><highlight class="keyword">namespace<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">DBVal<sp/>{</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/>uint256<sp/>hash;</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/>uint256<sp/>header;</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/>FlatFilePos<sp/>pos;</highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="serialize_8h_1a3b83685b5040226533482614591c9b53" kindref="member">SERIALIZE_METHODS</ref>(DBVal,<sp/>obj)<sp/>{<sp/><ref refid="serialize_8h_1aef1db9a8777d0ff777f442d8284212f2" kindref="member">READWRITE</ref>(obj.hash,<sp/>obj.header,<sp/>obj.pos);<sp/>}</highlight></codeline>
<codeline lineno="75"><highlight class="normal">};</highlight></codeline>
<codeline lineno="76"><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">DBHeightKey<sp/>{</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>height;</highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">explicit</highlight><highlight class="normal"><sp/>DBHeightKey(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>height_in)<sp/>:<sp/>height(height_in)<sp/>{}</highlight></codeline>
<codeline lineno="81"><highlight class="normal"></highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>Stream&gt;</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="serialize_8h_1a02d3045fa4f224ffcb8a3f6779b9f5d0" kindref="member">Serialize</ref>(Stream&amp;<sp/>s)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="84"><highlight class="keyword"><sp/><sp/><sp/><sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="serialize_8h_1ab121fe5d3f3371e3c57b45235a8d7802" kindref="member">ser_writedata8</ref>(s,<sp/><ref refid="blockfilterindex_8cpp_1ae0aa2e8634a01080040d4cd90cc0dcf8" kindref="member">DB_BLOCK_HEIGHT</ref>);</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="serialize_8h_1a274e67f1285e8b58be54bbf1671151ce" kindref="member">ser_writedata32be</ref>(s,<sp/>height);</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="88"><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>Stream&gt;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="serialize_8h_1a6d40a7235b720c76676d5eacaa78971f" kindref="member">Unserialize</ref>(Stream&amp;<sp/>s)</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t<sp/><ref refid="rest_8cpp_1a5b41c5ae4505891e6c53e26df197e02b" kindref="member">prefix</ref>{<ref refid="serialize_8h_1a1d1f53d2d72386236484546b49409188" kindref="member">ser_readdata8</ref>(s)};</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="rest_8cpp_1a5b41c5ae4505891e6c53e26df197e02b" kindref="member">prefix</ref><sp/>!=<sp/><ref refid="blockfilterindex_8cpp_1ae0aa2e8634a01080040d4cd90cc0dcf8" kindref="member">DB_BLOCK_HEIGHT</ref>)<sp/>{</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/>std::ios_base::failure(</highlight><highlight class="stringliteral">&quot;Invalid<sp/>format<sp/>for<sp/>block<sp/>filter<sp/>index<sp/>DB<sp/>height<sp/>key&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>height<sp/>=<sp/><ref refid="serialize_8h_1aebdb1730926e0593658339e9fa305a85" kindref="member">ser_readdata32be</ref>(s);</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="98"><highlight class="normal">};</highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">DBHashKey<sp/>{</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/>uint256<sp/>hash;</highlight></codeline>
<codeline lineno="102"><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">explicit</highlight><highlight class="normal"><sp/>DBHashKey(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint256&amp;<sp/>hash_in)<sp/>:<sp/>hash(hash_in)<sp/>{}</highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="serialize_8h_1a3b83685b5040226533482614591c9b53" kindref="member">SERIALIZE_METHODS</ref>(DBHashKey,<sp/>obj)<sp/>{</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint8_t<sp/><ref refid="rest_8cpp_1a5b41c5ae4505891e6c53e26df197e02b" kindref="member">prefix</ref>{<ref refid="blockfilterindex_8cpp_1aa35d80382f5cad0ca2d8081b37db0ea6" kindref="member">DB_BLOCK_HASH</ref>};</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="serialize_8h_1aef1db9a8777d0ff777f442d8284212f2" kindref="member">READWRITE</ref>(<ref refid="rest_8cpp_1a5b41c5ae4505891e6c53e26df197e02b" kindref="member">prefix</ref>);</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="rest_8cpp_1a5b41c5ae4505891e6c53e26df197e02b" kindref="member">prefix</ref><sp/>!=<sp/><ref refid="blockfilterindex_8cpp_1aa35d80382f5cad0ca2d8081b37db0ea6" kindref="member">DB_BLOCK_HASH</ref>)<sp/>{</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/>std::ios_base::failure(</highlight><highlight class="stringliteral">&quot;Invalid<sp/>format<sp/>for<sp/>block<sp/>filter<sp/>index<sp/>DB<sp/>hash<sp/>key&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="111"><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="serialize_8h_1aef1db9a8777d0ff777f442d8284212f2" kindref="member">READWRITE</ref>(obj.hash);</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="114"><highlight class="normal">};</highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal">};<sp/></highlight><highlight class="comment">//<sp/>namespace</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>std::map&lt;BlockFilterType,<sp/>BlockFilterIndex&gt;<sp/>g_filter_indexes;</highlight></codeline>
<codeline lineno="119"><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"><ref refid="class_block_filter_index_1ac7c7ac878e8298c700887b76c1a73c69" kindref="member">BlockFilterIndex::BlockFilterIndex</ref>(std::unique_ptr&lt;interfaces::Chain&gt;<sp/>chain,<sp/><ref refid="blockfilter_8h_1a530bf73ca0d532a142641644a1605250" kindref="member">BlockFilterType</ref><sp/>filter_type,</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_cache_size,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>f_memory,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>f_wipe)</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/>:<sp/><ref refid="class_base_index" kindref="compound">BaseIndex</ref>(<ref refid="namespacestd" kindref="compound">std</ref>::move(chain),<sp/><ref refid="blockfilter_8cpp_1a75df3661184c3291fc4d612d4f99d3ad" kindref="member">BlockFilterTypeName</ref>(filter_type)<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;<sp/>block<sp/>filter<sp/>index&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/>,<sp/>m_filter_type(filter_type)</highlight></codeline>
<codeline lineno="124"><highlight class="normal">{</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>filter_name<sp/>=<sp/><ref refid="blockfilter_8cpp_1a75df3661184c3291fc4d612d4f99d3ad" kindref="member">BlockFilterTypeName</ref>(filter_type);</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(filter_name.empty())<sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/>std::invalid_argument(</highlight><highlight class="stringliteral">&quot;unknown<sp/>filter_type&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="127"><highlight class="normal"></highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/>fs::path<sp/>path<sp/>=<sp/><ref refid="args_8cpp_1a934b7735a5308149ab1bf3ca9fc4d694" kindref="member">gArgs</ref>.GetDataDirNet()<sp/>/<sp/></highlight><highlight class="stringliteral">&quot;indexes&quot;</highlight><highlight class="normal"><sp/>/<sp/></highlight><highlight class="stringliteral">&quot;blockfilter&quot;</highlight><highlight class="normal"><sp/>/<sp/>fs::u8path(filter_name);</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/>fs::create_directories(path);</highlight></codeline>
<codeline lineno="130"><highlight class="normal"></highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/>m_db<sp/>=<sp/>std::make_unique&lt;BaseIndex::DB&gt;(path<sp/>/<sp/></highlight><highlight class="stringliteral">&quot;db&quot;</highlight><highlight class="normal">,<sp/>n_cache_size,<sp/>f_memory,<sp/>f_wipe);</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/>m_filter_fileseq<sp/>=<sp/>std::make_unique&lt;FlatFileSeq&gt;(std::move(path),<sp/></highlight><highlight class="stringliteral">&quot;fltr&quot;</highlight><highlight class="normal">,<sp/><ref refid="blockfilterindex_8cpp_1a29ffa311c98393be54cd19fa3e9eff81" kindref="member">FLTR_FILE_CHUNK_SIZE</ref>);</highlight></codeline>
<codeline lineno="133"><highlight class="normal">}</highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><ref refid="structinterfaces_1_1_chain_1_1_notify_options" kindref="compound">interfaces::Chain::NotifyOptions</ref><sp/><ref refid="class_block_filter_index_1a51d997d6ac9091245a102cfad7db925d" kindref="member">BlockFilterIndex::CustomOptions</ref>()</highlight></codeline>
<codeline lineno="136"><highlight class="normal">{</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/>interfaces::Chain::NotifyOptions<sp/>options;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/>options.<ref refid="structinterfaces_1_1_chain_1_1_notify_options_1a31aa7a967cb61459b6fff299f988548e" kindref="member">connect_undo_data</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>options;</highlight></codeline>
<codeline lineno="140"><highlight class="normal">}</highlight></codeline>
<codeline lineno="141"><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_block_filter_index_1a152681603ac9fb8c0ccbf84efaa56da9" kindref="member">BlockFilterIndex::CustomInit</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::optional&lt;interfaces::BlockRef&gt;&amp;<sp/>block)</highlight></codeline>
<codeline lineno="143"><highlight class="normal">{</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!m_db-&gt;Read(<ref refid="blockfilterindex_8cpp_1a7f512d8cf4c51f3a48d9700c42249333" kindref="member">DB_FILTER_POS</ref>,<sp/>m_next_filter_pos))<sp/>{</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>the<sp/>cause<sp/>of<sp/>the<sp/>read<sp/>failure<sp/>is<sp/>that<sp/>the<sp/>key<sp/>does<sp/>not<sp/>exist.<sp/>Any<sp/>other<sp/>errors</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>indicate<sp/>database<sp/>corruption<sp/>or<sp/>a<sp/>disk<sp/>failure,<sp/>and<sp/>starting<sp/>the<sp/>index<sp/>would<sp/>cause</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>further<sp/>corruption.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(m_db-&gt;Exists(<ref refid="blockfilterindex_8cpp_1a7f512d8cf4c51f3a48d9700c42249333" kindref="member">DB_FILTER_POS</ref>))<sp/>{</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;Cannot<sp/>read<sp/>current<sp/>%s<sp/>state;<sp/>index<sp/>may<sp/>be<sp/>corrupted&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_base_index_1aec8db65d32e78ef5da30521b3ad29cab" kindref="member">GetName</ref>());</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="153"><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>DB_FILTER_POS<sp/>is<sp/>not<sp/>set,<sp/>then<sp/>initialize<sp/>to<sp/>the<sp/>first<sp/>location.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>m_next_filter_pos.nFile<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>m_next_filter_pos.nPos<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="158"><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(block)<sp/>{</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>op_last_header<sp/>=<sp/>ReadFilterHeader(block-&gt;height,<sp/>block-&gt;hash);</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!op_last_header)<sp/>{</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;Cannot<sp/>read<sp/>last<sp/>block<sp/>filter<sp/>header;<sp/>index<sp/>may<sp/>be<sp/>corrupted&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>m_last_header<sp/>=<sp/>*op_last_header;</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="167"><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="169"><highlight class="normal">}</highlight></codeline>
<codeline lineno="170"><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_block_filter_index_1ad0cef080d295f0162f68530a8e44575e" kindref="member">BlockFilterIndex::CustomCommit</ref>(<ref refid="class_c_d_b_batch" kindref="compound">CDBBatch</ref>&amp;<sp/>batch)</highlight></codeline>
<codeline lineno="172"><highlight class="normal">{</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>FlatFilePos&amp;<sp/>pos<sp/>=<sp/>m_next_filter_pos;</highlight></codeline>
<codeline lineno="174"><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Flush<sp/>current<sp/>filter<sp/>file<sp/>to<sp/>disk.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/>AutoFile<sp/>file{m_filter_fileseq-&gt;Open(pos)};</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(file.<ref refid="class_auto_file_1ac4d637a0dec45d546495c1660c9f6047" kindref="member">IsNull</ref>())<sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>open<sp/>filter<sp/>file<sp/>%d&quot;</highlight><highlight class="normal">,<sp/>pos.<ref refid="struct_flat_file_pos_1a2483833b586f09ac9ff431212bc85482" kindref="member">nFile</ref>);</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!file.<ref refid="class_auto_file_1a44c78e17dec2b3af95f850baaee2683a" kindref="member">Commit</ref>())<sp/>{</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>commit<sp/>filter<sp/>file<sp/>%d&quot;</highlight><highlight class="normal">,<sp/>pos.<ref refid="struct_flat_file_pos_1a2483833b586f09ac9ff431212bc85482" kindref="member">nFile</ref>);</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(void)file.<ref refid="class_auto_file_1a8b9c3a533b9c6429d63aa0a970fb214c" kindref="member">fclose</ref>();</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(file.<ref refid="class_auto_file_1a8b9c3a533b9c6429d63aa0a970fb214c" kindref="member">fclose</ref>()<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>close<sp/>filter<sp/>file<sp/>%d<sp/>after<sp/>commit:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>pos.<ref refid="struct_flat_file_pos_1a2483833b586f09ac9ff431212bc85482" kindref="member">nFile</ref>,<sp/><ref refid="syserror_8cpp_1aed54b21219b1bf6d2e7367bd5ece9482" kindref="member">SysErrorString</ref>(errno));</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="190"><highlight class="normal"></highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/>batch.<ref refid="class_c_d_b_batch_1afbbc71a9d0a717a7304ba0b2513232e1" kindref="member">Write</ref>(<ref refid="blockfilterindex_8cpp_1a7f512d8cf4c51f3a48d9700c42249333" kindref="member">DB_FILTER_POS</ref>,<sp/>pos);</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="193"><highlight class="normal">}</highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>BlockFilterIndex::ReadFilterFromDisk(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_flat_file_pos" kindref="compound">FlatFilePos</ref>&amp;<sp/>pos,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref>&amp;<sp/>hash,<sp/><ref refid="class_block_filter" kindref="compound">BlockFilter</ref>&amp;<sp/>filter)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="196"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/>AutoFile<sp/>filein{m_filter_fileseq-&gt;Open(pos,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">)};</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(filein.<ref refid="class_auto_file_1ac4d637a0dec45d546495c1660c9f6047" kindref="member">IsNull</ref>())<sp/>{</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>the<sp/>hash<sp/>of<sp/>the<sp/>encoded_filter<sp/>matches<sp/>the<sp/>one<sp/>stored<sp/>in<sp/>the<sp/>db.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/>uint256<sp/>block_hash;</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;uint8_t&gt;<sp/>encoded_filter;</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>filein<sp/>&gt;&gt;<sp/>block_hash<sp/>&gt;&gt;<sp/>encoded_filter;</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="hash_8h_1ac49a4a382d911138c745234f2fe7986d" kindref="member">Hash</ref>(encoded_filter)<sp/>!=<sp/>hash)<sp/>{</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;Checksum<sp/>mismatch<sp/>in<sp/>filter<sp/>decode.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>filter<sp/>=<sp/>BlockFilter(<ref refid="class_block_filter_index_1aa3b2667a0cc35eaf1ff4f024f92bdce3" kindref="member">GetFilterType</ref>(),<sp/>block_hash,<sp/>std::move(encoded_filter),<sp/></highlight><highlight class="comment">/*skip_decode_check=*/</highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::exception&amp;<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>deserialize<sp/>block<sp/>filter<sp/>from<sp/>disk:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>e.what());</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="219"><highlight class="normal">}</highlight></codeline>
<codeline lineno="220"><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>BlockFilterIndex::WriteFilterToDisk(<ref refid="struct_flat_file_pos" kindref="compound">FlatFilePos</ref>&amp;<sp/>pos,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_block_filter" kindref="compound">BlockFilter</ref>&amp;<sp/>filter)</highlight></codeline>
<codeline lineno="222"><highlight class="normal">{</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(filter.<ref refid="class_block_filter_1aa3b2667a0cc35eaf1ff4f024f92bdce3" kindref="member">GetFilterType</ref>()<sp/>==<sp/><ref refid="class_block_filter_index_1aa3b2667a0cc35eaf1ff4f024f92bdce3" kindref="member">GetFilterType</ref>());</highlight></codeline>
<codeline lineno="224"><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/>uint64_t<sp/>data_size{</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="serialize_8h_1ac0154eb0a74cc852efc55684de85b1f5" kindref="member">GetSerializeSize</ref>(filter.<ref refid="class_block_filter_1ab196479177fd7cdcddc5a40f51731483" kindref="member">GetBlockHash</ref>())<sp/>+</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="serialize_8h_1ac0154eb0a74cc852efc55684de85b1f5" kindref="member">GetSerializeSize</ref>(filter.<ref refid="class_block_filter_1ac16f28f44c3531143a8acd6449fbb1ce" kindref="member">GetEncodedFilter</ref>())};</highlight></codeline>
<codeline lineno="228"><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>writing<sp/>the<sp/>filter<sp/>would<sp/>overflow<sp/>the<sp/>file,<sp/>flush<sp/>and<sp/>move<sp/>to<sp/>the<sp/>next<sp/>one.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pos.<ref refid="struct_flat_file_pos_1abb880bcadb3846a397e2420c4ee27d39" kindref="member">nPos</ref><sp/>+<sp/>data_size<sp/>&gt;<sp/><ref refid="blockfilterindex_8cpp_1aa00aebf16bed05cda303598f0f1e1305" kindref="member">MAX_FLTR_FILE_SIZE</ref>)<sp/>{</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>AutoFile<sp/>last_file{m_filter_fileseq-&gt;Open(pos)};</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(last_file.<ref refid="class_auto_file_1ac4d637a0dec45d546495c1660c9f6047" kindref="member">IsNull</ref>())<sp/>{</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>open<sp/>filter<sp/>file<sp/>%d&quot;</highlight><highlight class="normal">,<sp/>pos.<ref refid="struct_flat_file_pos_1a2483833b586f09ac9ff431212bc85482" kindref="member">nFile</ref>);</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!last_file.<ref refid="class_auto_file_1a98e9b7b1b24494780aec892d21cd2531" kindref="member">Truncate</ref>(pos.<ref refid="struct_flat_file_pos_1abb880bcadb3846a397e2420c4ee27d39" kindref="member">nPos</ref>))<sp/>{</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>truncate<sp/>filter<sp/>file<sp/>%d&quot;</highlight><highlight class="normal">,<sp/>pos.<ref refid="struct_flat_file_pos_1a2483833b586f09ac9ff431212bc85482" kindref="member">nFile</ref>);</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!last_file.<ref refid="class_auto_file_1a44c78e17dec2b3af95f850baaee2683a" kindref="member">Commit</ref>())<sp/>{</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>commit<sp/>filter<sp/>file<sp/>%d&quot;</highlight><highlight class="normal">,<sp/>pos.<ref refid="struct_flat_file_pos_1a2483833b586f09ac9ff431212bc85482" kindref="member">nFile</ref>);</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(void)last_file.<ref refid="class_auto_file_1a8b9c3a533b9c6429d63aa0a970fb214c" kindref="member">fclose</ref>();</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(last_file.<ref refid="class_auto_file_1a8b9c3a533b9c6429d63aa0a970fb214c" kindref="member">fclose</ref>()<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>close<sp/>filter<sp/>file<sp/>%d<sp/>after<sp/>commit:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>pos.<ref refid="struct_flat_file_pos_1a2483833b586f09ac9ff431212bc85482" kindref="member">nFile</ref>,<sp/><ref refid="syserror_8cpp_1aed54b21219b1bf6d2e7367bd5ece9482" kindref="member">SysErrorString</ref>(errno));</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="249"><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pos.<ref refid="struct_flat_file_pos_1a2483833b586f09ac9ff431212bc85482" kindref="member">nFile</ref>++;</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pos.<ref refid="struct_flat_file_pos_1abb880bcadb3846a397e2420c4ee27d39" kindref="member">nPos</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="253"><highlight class="normal"></highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Pre-allocate<sp/>sufficient<sp/>space<sp/>for<sp/>filter<sp/>data.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>out_of_space;</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/>m_filter_fileseq-&gt;Allocate(pos,<sp/>data_size,<sp/>out_of_space);</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(out_of_space)<sp/>{</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;out<sp/>of<sp/>disk<sp/>space&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="261"><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/>AutoFile<sp/>fileout{m_filter_fileseq-&gt;Open(pos)};</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fileout.<ref refid="class_auto_file_1ac4d637a0dec45d546495c1660c9f6047" kindref="member">IsNull</ref>())<sp/>{</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>open<sp/>filter<sp/>file<sp/>%d&quot;</highlight><highlight class="normal">,<sp/>pos.<ref refid="struct_flat_file_pos_1a2483833b586f09ac9ff431212bc85482" kindref="member">nFile</ref>);</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="267"><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/>fileout<sp/>&lt;&lt;<sp/>filter.<ref refid="class_block_filter_1ab196479177fd7cdcddc5a40f51731483" kindref="member">GetBlockHash</ref>()<sp/>&lt;&lt;<sp/>filter.<ref refid="class_block_filter_1ac16f28f44c3531143a8acd6449fbb1ce" kindref="member">GetEncodedFilter</ref>();</highlight></codeline>
<codeline lineno="269"><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fileout.<ref refid="class_auto_file_1a8b9c3a533b9c6429d63aa0a970fb214c" kindref="member">fclose</ref>()<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>close<sp/>filter<sp/>file<sp/>%d:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>pos.<ref refid="struct_flat_file_pos_1a2483833b586f09ac9ff431212bc85482" kindref="member">nFile</ref>,<sp/><ref refid="syserror_8cpp_1aed54b21219b1bf6d2e7367bd5ece9482" kindref="member">SysErrorString</ref>(errno));</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="274"><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>data_size;</highlight></codeline>
<codeline lineno="276"><highlight class="normal">}</highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal">std::optional&lt;uint256&gt;<sp/>BlockFilterIndex::ReadFilterHeader(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>height,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref>&amp;<sp/>expected_block_hash)</highlight></codeline>
<codeline lineno="279"><highlight class="normal">{</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/>std::pair&lt;uint256,<sp/>DBVal&gt;<sp/>read_out;</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!m_db-&gt;Read(DBHeightKey(height),<sp/>read_out))<sp/>{</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="284"><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(read_out.first<sp/>!=<sp/>expected_block_hash)<sp/>{</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;previous<sp/>block<sp/>header<sp/>belongs<sp/>to<sp/>unexpected<sp/>block<sp/>%s;<sp/>expected<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>read_out.first.ToString(),<sp/>expected_block_hash.<ref refid="classbase__blob_1ab877381b343dbe2a2b32922da6951ed6" kindref="member">ToString</ref>());</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="290"><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>read_out.second.header;</highlight></codeline>
<codeline lineno="292"><highlight class="normal">}</highlight></codeline>
<codeline lineno="293"><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_block_filter_index_1a2866130d78abde86682621008c9b0ca3" kindref="member">BlockFilterIndex::CustomAppend</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structinterfaces_1_1_block_info" kindref="compound">interfaces::BlockInfo</ref>&amp;<sp/>block)</highlight></codeline>
<codeline lineno="295"><highlight class="normal">{</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/>BlockFilter<sp/>filter(m_filter_type,<sp/>*<ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(block.<ref refid="structinterfaces_1_1_block_info_1acca804612a5034cd04aa3d9e33918b2b" kindref="member">data</ref>),<sp/>*<ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(block.<ref refid="structinterfaces_1_1_block_info_1abdac6fdbd9f831d78e1cceabf8543f32" kindref="member">undo_data</ref>));</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint256&amp;<sp/>header<sp/>=<sp/>filter.<ref refid="class_block_filter_1a772072f42b2cea45089fd0336d91f9a4" kindref="member">ComputeHeader</ref>(m_last_header);</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>res<sp/>=<sp/>Write(filter,<sp/>block.<ref refid="structinterfaces_1_1_block_info_1ad12fc34ce789bce6c8a05d8a17138534" kindref="member">height</ref>,<sp/>header);</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(res)<sp/>m_last_header<sp/>=<sp/>header;<sp/></highlight><highlight class="comment">//<sp/>update<sp/>last<sp/>header</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>res;</highlight></codeline>
<codeline lineno="301"><highlight class="normal">}</highlight></codeline>
<codeline lineno="302"><highlight class="normal"></highlight></codeline>
<codeline lineno="303"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>BlockFilterIndex::Write(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_block_filter" kindref="compound">BlockFilter</ref>&amp;<sp/>filter,<sp/>uint32_t<sp/>block_height,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref>&amp;<sp/>filter_header)</highlight></codeline>
<codeline lineno="304"><highlight class="normal">{</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>bytes_written<sp/>=<sp/>WriteFilterToDisk(m_next_filter_pos,<sp/>filter);</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(bytes_written<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="307"><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/>std::pair&lt;uint256,<sp/>DBVal&gt;<sp/>value;</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/>value.first<sp/>=<sp/>filter.<ref refid="class_block_filter_1ab196479177fd7cdcddc5a40f51731483" kindref="member">GetBlockHash</ref>();</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/>value.second.hash<sp/>=<sp/>filter.<ref refid="class_block_filter_1a6df30b63c4634d52dfeaadb46d60d0f5" kindref="member">GetHash</ref>();</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/>value.second.header<sp/>=<sp/>filter_header;</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/>value.second.pos<sp/>=<sp/>m_next_filter_pos;</highlight></codeline>
<codeline lineno="313"><highlight class="normal"></highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/>m_db-&gt;Write(DBHeightKey(block_height),<sp/>value);</highlight></codeline>
<codeline lineno="315"><highlight class="normal"></highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/>m_next_filter_pos.nPos<sp/>+=<sp/>bytes_written;</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="318"><highlight class="normal">}</highlight></codeline>
<codeline lineno="319"><highlight class="normal"></highlight></codeline>
<codeline lineno="320"><highlight class="normal">[[nodiscard]]<sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>CopyHeightIndexToHashIndex(<ref refid="class_c_d_b_iterator" kindref="compound">CDBIterator</ref>&amp;<sp/>db_it,<sp/><ref refid="class_c_d_b_batch" kindref="compound">CDBBatch</ref>&amp;<sp/>batch,</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>index_name,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>height)</highlight></codeline>
<codeline lineno="322"><highlight class="normal">{</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/>DBHeightKey<sp/>key(height);</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/>db_it.<ref refid="class_c_d_b_iterator_1aaa87b740acb981aad337298c68b1c8cb" kindref="member">Seek</ref>(key);</highlight></codeline>
<codeline lineno="325"><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!db_it.<ref refid="class_c_d_b_iterator_1adedab0cd22727a2dd11d58b1aa3f9382" kindref="member">GetKey</ref>(key)<sp/>||<sp/>key.height<sp/>!=<sp/>height)<sp/>{</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;unexpected<sp/>key<sp/>in<sp/>%s:<sp/>expected<sp/>(%c,<sp/>%d)&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>index_name,<sp/><ref refid="blockfilterindex_8cpp_1ae0aa2e8634a01080040d4cd90cc0dcf8" kindref="member">DB_BLOCK_HEIGHT</ref>,<sp/>height);</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="331"><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/>std::pair&lt;uint256,<sp/>DBVal&gt;<sp/>value;</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!db_it.<ref refid="class_c_d_b_iterator_1a9059b53993484e42d48a03ba27696877" kindref="member">GetValue</ref>(value))<sp/>{</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;unable<sp/>to<sp/>read<sp/>value<sp/>in<sp/>%s<sp/>at<sp/>key<sp/>(%c,<sp/>%d)&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>index_name,<sp/><ref refid="blockfilterindex_8cpp_1ae0aa2e8634a01080040d4cd90cc0dcf8" kindref="member">DB_BLOCK_HEIGHT</ref>,<sp/>height);</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="338"><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/>batch.<ref refid="class_c_d_b_batch_1afbbc71a9d0a717a7304ba0b2513232e1" kindref="member">Write</ref>(DBHashKey(value.first),<sp/>std::move(value.second));</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="341"><highlight class="normal">}</highlight></codeline>
<codeline lineno="342"><highlight class="normal"></highlight></codeline>
<codeline lineno="343"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_block_filter_index_1aa40d547c510f155772c2748cfb675765" kindref="member">BlockFilterIndex::CustomRemove</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structinterfaces_1_1_block_info" kindref="compound">interfaces::BlockInfo</ref>&amp;<sp/>block)</highlight></codeline>
<codeline lineno="344"><highlight class="normal">{</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/>CDBBatch<sp/>batch(*m_db);</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/>std::unique_ptr&lt;CDBIterator&gt;<sp/>db_it(m_db-&gt;NewIterator());</highlight></codeline>
<codeline lineno="347"><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>During<sp/>a<sp/>reorg,<sp/>we<sp/>need<sp/>to<sp/>copy<sp/>block<sp/>filter<sp/>that<sp/>is<sp/>getting<sp/>disconnected<sp/>from<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>height<sp/>index<sp/>to<sp/>the<sp/>hash<sp/>index<sp/>so<sp/>we<sp/>can<sp/>still<sp/>find<sp/>it<sp/>when<sp/>the<sp/>height<sp/>index<sp/>entry</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>is<sp/>overwritten.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!CopyHeightIndexToHashIndex(*db_it,<sp/>batch,<sp/><ref refid="class_base_index_1a6f9e296fcf5c68222c08850e8279025e" kindref="member">m_name</ref>,<sp/>block.<ref refid="structinterfaces_1_1_block_info_1ad12fc34ce789bce6c8a05d8a17138534" kindref="member">height</ref>))<sp/>{</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="354"><highlight class="normal"></highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>latest<sp/>filter<sp/>position<sp/>gets<sp/>written<sp/>in<sp/>Commit<sp/>by<sp/>the<sp/>call<sp/>to<sp/>the<sp/>BaseIndex::Rewind.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>But<sp/>since<sp/>this<sp/>creates<sp/>new<sp/>references<sp/>to<sp/>the<sp/>filter,<sp/>the<sp/>position<sp/>should<sp/>get<sp/>updated<sp/>here</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>atomically<sp/>as<sp/>well<sp/>in<sp/>case<sp/>Commit<sp/>fails.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/>batch.<ref refid="class_c_d_b_batch_1afbbc71a9d0a717a7304ba0b2513232e1" kindref="member">Write</ref>(<ref refid="blockfilterindex_8cpp_1a7f512d8cf4c51f3a48d9700c42249333" kindref="member">DB_FILTER_POS</ref>,<sp/>m_next_filter_pos);</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/>m_db-&gt;WriteBatch(batch);</highlight></codeline>
<codeline lineno="360"><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Update<sp/>cached<sp/>header<sp/>to<sp/>the<sp/>previous<sp/>block<sp/>hash</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/>m_last_header<sp/>=<sp/>*<ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(ReadFilterHeader(block.<ref refid="structinterfaces_1_1_block_info_1ad12fc34ce789bce6c8a05d8a17138534" kindref="member">height</ref><sp/>-<sp/>1,<sp/>*<ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(block.<ref refid="structinterfaces_1_1_block_info_1ab8cd52594783fb23b621e41054d4c748" kindref="member">prev_hash</ref>)));</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="364"><highlight class="normal">}</highlight></codeline>
<codeline lineno="365"><highlight class="normal"></highlight></codeline>
<codeline lineno="366"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>LookupOne(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_d_b_wrapper" kindref="compound">CDBWrapper</ref>&amp;<sp/>db,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_block_index" kindref="compound">CBlockIndex</ref>*<sp/>block_index,<sp/>DBVal&amp;<sp/>result)</highlight></codeline>
<codeline lineno="367"><highlight class="normal">{</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>check<sp/>if<sp/>the<sp/>result<sp/>is<sp/>stored<sp/>under<sp/>the<sp/>height<sp/>index<sp/>and<sp/>the<sp/>value<sp/>there<sp/>matches<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>block<sp/>hash.<sp/>This<sp/>should<sp/>be<sp/>the<sp/>case<sp/>if<sp/>the<sp/>block<sp/>is<sp/>on<sp/>the<sp/>active<sp/>chain.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/>std::pair&lt;uint256,<sp/>DBVal&gt;<sp/>read_out;</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!db.<ref refid="class_c_d_b_wrapper_1a7ba430ec0761bb6a28e16395b4d7dbf5" kindref="member">Read</ref>(DBHeightKey(block_index-&gt;<ref refid="class_c_block_index_1a17d981419afeee27eb36a8b43183e49a" kindref="member">nHeight</ref>),<sp/>read_out))<sp/>{</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(read_out.first<sp/>==<sp/>block_index-&gt;<ref refid="class_c_block_index_1af6ec213819803936fd0806fb068965df" kindref="member">GetBlockHash</ref>())<sp/>{</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>result<sp/>=<sp/>std::move(read_out.second);</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="378"><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>value<sp/>at<sp/>the<sp/>height<sp/>index<sp/>corresponds<sp/>to<sp/>an<sp/>different<sp/>block,<sp/>the<sp/>result<sp/>will<sp/>be<sp/>stored<sp/>in</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>hash<sp/>index.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>db.<ref refid="class_c_d_b_wrapper_1a7ba430ec0761bb6a28e16395b4d7dbf5" kindref="member">Read</ref>(DBHashKey(block_index-&gt;<ref refid="class_c_block_index_1af6ec213819803936fd0806fb068965df" kindref="member">GetBlockHash</ref>()),<sp/>result);</highlight></codeline>
<codeline lineno="382"><highlight class="normal">}</highlight></codeline>
<codeline lineno="383"><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>LookupRange(<ref refid="class_c_d_b_wrapper" kindref="compound">CDBWrapper</ref>&amp;<sp/>db,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>index_name,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>start_height,</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_block_index" kindref="compound">CBlockIndex</ref>*<sp/>stop_index,<sp/>std::vector&lt;DBVal&gt;&amp;<sp/>results)</highlight></codeline>
<codeline lineno="386"><highlight class="normal">{</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(start_height<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;start<sp/>height<sp/>(%d)<sp/>is<sp/>negative&quot;</highlight><highlight class="normal">,<sp/>start_height);</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(start_height<sp/>&gt;<sp/>stop_index-&gt;<ref refid="class_c_block_index_1a17d981419afeee27eb36a8b43183e49a" kindref="member">nHeight</ref>)<sp/>{</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;start<sp/>height<sp/>(%d)<sp/>is<sp/>greater<sp/>than<sp/>stop<sp/>height<sp/>(%d)&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>start_height,<sp/>stop_index-&gt;<ref refid="class_c_block_index_1a17d981419afeee27eb36a8b43183e49a" kindref="member">nHeight</ref>);</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="396"><highlight class="normal"></highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>results_size<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="keywordtype">size_t</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(stop_index-&gt;<ref refid="class_c_block_index_1a17d981419afeee27eb36a8b43183e49a" kindref="member">nHeight</ref><sp/>-<sp/>start_height<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;std::pair&lt;uint256,<sp/>DBVal&gt;&gt;<sp/>values(results_size);</highlight></codeline>
<codeline lineno="399"><highlight class="normal"></highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/>DBHeightKey<sp/>key(start_height);</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/>std::unique_ptr&lt;CDBIterator&gt;<sp/>db_it(db.<ref refid="class_c_d_b_wrapper_1acec8abb133be8be3ded3a379310711f6" kindref="member">NewIterator</ref>());</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/>db_it-&gt;<ref refid="class_c_d_b_iterator_1aaa87b740acb981aad337298c68b1c8cb" kindref="member">Seek</ref>(DBHeightKey(start_height));</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>height<sp/>=<sp/>start_height;<sp/>height<sp/>&lt;=<sp/>stop_index-&gt;<ref refid="class_c_block_index_1a17d981419afeee27eb36a8b43183e49a" kindref="member">nHeight</ref>;<sp/>++height)<sp/>{</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!db_it-&gt;<ref refid="class_c_d_b_iterator_1a470438bf41ff0f2cc2fc41682c8f839e" kindref="member">Valid</ref>()<sp/>||<sp/>!db_it-&gt;<ref refid="class_c_d_b_iterator_1adedab0cd22727a2dd11d58b1aa3f9382" kindref="member">GetKey</ref>(key)<sp/>||<sp/>key.height<sp/>!=<sp/>height)<sp/>{</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="407"><highlight class="normal"></highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="keywordtype">size_t</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(height<sp/>-<sp/>start_height);</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!db_it-&gt;<ref refid="class_c_d_b_iterator_1a9059b53993484e42d48a03ba27696877" kindref="member">GetValue</ref>(values[i]))<sp/>{</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;unable<sp/>to<sp/>read<sp/>value<sp/>in<sp/>%s<sp/>at<sp/>key<sp/>(%c,<sp/>%d)&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>index_name,<sp/><ref refid="blockfilterindex_8cpp_1ae0aa2e8634a01080040d4cd90cc0dcf8" kindref="member">DB_BLOCK_HEIGHT</ref>,<sp/>height);</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="414"><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>db_it-&gt;<ref refid="class_c_d_b_iterator_1a659a293dd51073a1b9560bb80f687705" kindref="member">Next</ref>();</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="417"><highlight class="normal"></highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/>results.resize(results_size);</highlight></codeline>
<codeline lineno="419"><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>backwards<sp/>through<sp/>block<sp/>indexes<sp/>collecting<sp/>results<sp/>in<sp/>order<sp/>to<sp/>access<sp/>the<sp/>block<sp/>hash</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>of<sp/>each<sp/>entry<sp/>in<sp/>case<sp/>we<sp/>need<sp/>to<sp/>look<sp/>it<sp/>up<sp/>in<sp/>the<sp/>hash<sp/>index.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_block_index" kindref="compound">CBlockIndex</ref>*<sp/>block_index<sp/>=<sp/>stop_index;</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>block_index<sp/>&amp;&amp;<sp/>block_index-&gt;<ref refid="class_c_block_index_1a17d981419afeee27eb36a8b43183e49a" kindref="member">nHeight</ref><sp/>&gt;=<sp/>start_height;</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>block_index<sp/>=<sp/>block_index-&gt;<ref refid="class_c_block_index_1a0265c1d3d6cc413eb1e964b045f3f538" kindref="member">pprev</ref>)<sp/>{</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classuint256" kindref="compound">uint256</ref><sp/>block_hash<sp/>=<sp/>block_index-&gt;<ref refid="class_c_block_index_1af6ec213819803936fd0806fb068965df" kindref="member">GetBlockHash</ref>();</highlight></codeline>
<codeline lineno="426"><highlight class="normal"></highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="keywordtype">size_t</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(block_index-&gt;<ref refid="class_c_block_index_1a17d981419afeee27eb36a8b43183e49a" kindref="member">nHeight</ref><sp/>-<sp/>start_height);</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(block_hash<sp/>==<sp/>values[i].first)<sp/>{</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>results[i]<sp/>=<sp/>std::move(values[i].second);</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="432"><highlight class="normal"></highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!db.<ref refid="class_c_d_b_wrapper_1a7ba430ec0761bb6a28e16395b4d7dbf5" kindref="member">Read</ref>(DBHashKey(block_hash),<sp/>results[i]))<sp/>{</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;unable<sp/>to<sp/>read<sp/>value<sp/>in<sp/>%s<sp/>at<sp/>key<sp/>(%c,<sp/>%s)&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>index_name,<sp/><ref refid="blockfilterindex_8cpp_1aa35d80382f5cad0ca2d8081b37db0ea6" kindref="member">DB_BLOCK_HASH</ref>,<sp/>block_hash.<ref refid="classbase__blob_1ab877381b343dbe2a2b32922da6951ed6" kindref="member">ToString</ref>());</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="439"><highlight class="normal"></highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="441"><highlight class="normal">}</highlight></codeline>
<codeline lineno="442"><highlight class="normal"></highlight></codeline>
<codeline lineno="443"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_block_filter_index_1ad6c918d5e03b06dff7c3e98f4b5376d5" kindref="member">BlockFilterIndex::LookupFilter</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_block_index" kindref="compound">CBlockIndex</ref>*<sp/>block_index,<sp/><ref refid="class_block_filter" kindref="compound">BlockFilter</ref>&amp;<sp/>filter_out)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="444"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/>DBVal<sp/>entry;</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!LookupOne(*m_db,<sp/>block_index,<sp/>entry))<sp/>{</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="449"><highlight class="normal"></highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ReadFilterFromDisk(entry.pos,<sp/>entry.hash,<sp/>filter_out);</highlight></codeline>
<codeline lineno="451"><highlight class="normal">}</highlight></codeline>
<codeline lineno="452"><highlight class="normal"></highlight></codeline>
<codeline lineno="453"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_block_filter_index_1acfdddc9ce6b0ff5c2082815ca526977f" kindref="member">BlockFilterIndex::LookupFilterHeader</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_block_index" kindref="compound">CBlockIndex</ref>*<sp/>block_index,<sp/><ref refid="classuint256" kindref="compound">uint256</ref>&amp;<sp/>header_out)</highlight></codeline>
<codeline lineno="454"><highlight class="normal">{</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(m_cs_headers_cache);</highlight></codeline>
<codeline lineno="456"><highlight class="normal"></highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>is_checkpoint{block_index-&gt;<ref refid="class_c_block_index_1a17d981419afeee27eb36a8b43183e49a" kindref="member">nHeight</ref><sp/>%<sp/>CFCHECKPT_INTERVAL<sp/>==<sp/>0};</highlight></codeline>
<codeline lineno="458"><highlight class="normal"></highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_checkpoint)<sp/>{</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Try<sp/>to<sp/>find<sp/>the<sp/>block<sp/>in<sp/>the<sp/>headers<sp/>cache<sp/>if<sp/>this<sp/>is<sp/>a<sp/>checkpoint<sp/>height.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>header<sp/>=<sp/>m_headers_cache.find(block_index-&gt;<ref refid="class_c_block_index_1af6ec213819803936fd0806fb068965df" kindref="member">GetBlockHash</ref>());</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(header<sp/>!=<sp/>m_headers_cache.end())<sp/>{</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>header_out<sp/>=<sp/>header-&gt;second;</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="467"><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/>DBVal<sp/>entry;</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!LookupOne(*m_db,<sp/>block_index,<sp/>entry))<sp/>{</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="472"><highlight class="normal"></highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_checkpoint<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>m_headers_cache.size()<sp/>&lt;<sp/><ref refid="blockfilterindex_8cpp_1ab55a01b8db4071d26b5051b63298c6dd" kindref="member">CF_HEADERS_CACHE_MAX_SZ</ref>)<sp/>{</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>to<sp/>the<sp/>headers<sp/>cache<sp/>if<sp/>this<sp/>is<sp/>a<sp/>checkpoint<sp/>height.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>m_headers_cache.emplace(block_index-&gt;<ref refid="class_c_block_index_1af6ec213819803936fd0806fb068965df" kindref="member">GetBlockHash</ref>(),<sp/>entry.header);</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="478"><highlight class="normal"></highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/>header_out<sp/>=<sp/>entry.header;</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="481"><highlight class="normal">}</highlight></codeline>
<codeline lineno="482"><highlight class="normal"></highlight></codeline>
<codeline lineno="483"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_block_filter_index_1a3b76396ced514ecf4807816bc5900e53" kindref="member">BlockFilterIndex::LookupFilterRange</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>start_height,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_block_index" kindref="compound">CBlockIndex</ref>*<sp/>stop_index,</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;BlockFilter&gt;&amp;<sp/>filters_out)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="485"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;DBVal&gt;<sp/>entries;</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!LookupRange(*m_db,<sp/><ref refid="class_base_index_1a6f9e296fcf5c68222c08850e8279025e" kindref="member">m_name</ref>,<sp/>start_height,<sp/>stop_index,<sp/>entries))<sp/>{</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="490"><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/>filters_out.resize(entries.size());</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>filter_pos_it<sp/>=<sp/>filters_out.<ref refid="classbase__blob_1a899a629fc7846994a3bbd28ba2777243" kindref="member">begin</ref>();</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>entry<sp/>:<sp/>entries)<sp/>{</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!ReadFilterFromDisk(entry.pos,<sp/>entry.hash,<sp/>*filter_pos_it))<sp/>{</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>++filter_pos_it;</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="499"><highlight class="normal"></highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="501"><highlight class="normal">}</highlight></codeline>
<codeline lineno="502"><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_block_filter_index_1a5b477dbe22cb72cbff33c42a358b867b" kindref="member">BlockFilterIndex::LookupFilterHashRange</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>start_height,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_block_index" kindref="compound">CBlockIndex</ref>*<sp/>stop_index,</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;uint256&gt;&amp;<sp/>hashes_out)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="505"><highlight class="keyword"></highlight></codeline>
<codeline lineno="506"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;DBVal&gt;<sp/>entries;</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!LookupRange(*m_db,<sp/><ref refid="class_base_index_1a6f9e296fcf5c68222c08850e8279025e" kindref="member">m_name</ref>,<sp/>start_height,<sp/>stop_index,<sp/>entries))<sp/>{</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="511"><highlight class="normal"></highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/>hashes_out.clear();</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/>hashes_out.reserve(entries.size());</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>entry<sp/>:<sp/>entries)<sp/>{</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hashes_out.push_back(entry.hash);</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="518"><highlight class="normal">}</highlight></codeline>
<codeline lineno="519"><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><ref refid="class_block_filter_index" kindref="compound">BlockFilterIndex</ref>*<sp/><ref refid="blockfilterindex_8cpp_1a7e5a7eafefd6511f8d95b2583bdb53b0" kindref="member">GetBlockFilterIndex</ref>(<ref refid="blockfilter_8h_1a530bf73ca0d532a142641644a1605250" kindref="member">BlockFilterType</ref><sp/>filter_type)</highlight></codeline>
<codeline lineno="521"><highlight class="normal">{</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>it<sp/>=<sp/>g_filter_indexes.find(filter_type);</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>it<sp/>!=<sp/>g_filter_indexes.end()<sp/>?<sp/>&amp;it-&gt;second<sp/>:<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="524"><highlight class="normal">}</highlight></codeline>
<codeline lineno="525"><highlight class="normal"></highlight></codeline>
<codeline lineno="526"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="blockfilterindex_8cpp_1aa52651271de1e684295aedd1166ebf14" kindref="member">ForEachBlockFilterIndex</ref>(std::function&lt;</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>(<ref refid="class_block_filter_index" kindref="compound">BlockFilterIndex</ref>&amp;)&gt;<sp/>fn)</highlight></codeline>
<codeline lineno="527"><highlight class="normal">{</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>entry<sp/>:<sp/>g_filter_indexes)<sp/>fn(entry.second);</highlight></codeline>
<codeline lineno="529"><highlight class="normal">}</highlight></codeline>
<codeline lineno="530"><highlight class="normal"></highlight></codeline>
<codeline lineno="531"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="blockfilterindex_8cpp_1aca74aaaf3cd2da07d55e1b9354952c15" kindref="member">InitBlockFilterIndex</ref>(std::function&lt;std::unique_ptr&lt;interfaces::Chain&gt;()&gt;<sp/>make_chain,<sp/><ref refid="blockfilter_8h_1a530bf73ca0d532a142641644a1605250" kindref="member">BlockFilterType</ref><sp/>filter_type,</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_cache_size,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>f_memory,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>f_wipe)</highlight></codeline>
<codeline lineno="533"><highlight class="normal">{</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>result<sp/>=<sp/>g_filter_indexes.emplace(std::piecewise_construct,</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::forward_as_tuple(filter_type),</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::forward_as_tuple(make_chain(),<sp/>filter_type,</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n_cache_size,<sp/>f_memory,<sp/>f_wipe));</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result.second;</highlight></codeline>
<codeline lineno="539"><highlight class="normal">}</highlight></codeline>
<codeline lineno="540"><highlight class="normal"></highlight></codeline>
<codeline lineno="541"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="blockfilterindex_8cpp_1a2b01ec52cf934f07ad0b840eb6f592ed" kindref="member">DestroyBlockFilterIndex</ref>(<ref refid="blockfilter_8h_1a530bf73ca0d532a142641644a1605250" kindref="member">BlockFilterType</ref><sp/>filter_type)</highlight></codeline>
<codeline lineno="542"><highlight class="normal">{</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>g_filter_indexes.erase(filter_type);</highlight></codeline>
<codeline lineno="544"><highlight class="normal">}</highlight></codeline>
<codeline lineno="545"><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="blockfilterindex_8cpp_1a5809c1c43a5b3c1d77f10e25a506a565" kindref="member">DestroyAllBlockFilterIndexes</ref>()</highlight></codeline>
<codeline lineno="547"><highlight class="normal">{</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/>g_filter_indexes.clear();</highlight></codeline>
<codeline lineno="549"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="src/index/blockfilterindex.cpp"/>
  </compounddef>
</doxygen>
