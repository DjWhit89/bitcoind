<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="httpserver_8cpp" kind="file" language="C++">
    <compoundname>httpserver.cpp</compoundname>
    <includes refid="httpserver_8h" local="no">httpserver.h</includes>
    <includes refid="chainparamsbase_8h" local="no">chainparamsbase.h</includes>
    <includes refid="args_8h" local="no">common/args.h</includes>
    <includes refid="messages_8h" local="no">common/messages.h</includes>
    <includes refid="compat_8h" local="no">compat/compat.h</includes>
    <includes refid="logging_8h" local="no">logging.h</includes>
    <includes refid="netbase_8h" local="no">netbase.h</includes>
    <includes refid="interface__ui_8h" local="no">node/interface_ui.h</includes>
    <includes refid="rpc_2protocol_8h" local="no">rpc/protocol.h</includes>
    <includes refid="sync_8h" local="no">sync.h</includes>
    <includes refid="check_8h" local="no">util/check.h</includes>
    <includes refid="signalinterrupt_8h" local="no">util/signalinterrupt.h</includes>
    <includes refid="strencodings_8h" local="no">util/strencodings.h</includes>
    <includes refid="threadnames_8h" local="no">util/threadnames.h</includes>
    <includes refid="translation_8h" local="no">util/translation.h</includes>
    <includes local="no">condition_variable</includes>
    <includes local="no">cstdio</includes>
    <includes local="no">cstdlib</includes>
    <includes local="no">deque</includes>
    <includes local="no">memory</includes>
    <includes local="no">optional</includes>
    <includes local="no">span</includes>
    <includes local="no">string</includes>
    <includes local="no">thread</includes>
    <includes local="no">unordered_map</includes>
    <includes local="no">vector</includes>
    <includes local="no">sys/types.h</includes>
    <includes local="no">sys/stat.h</includes>
    <includes local="no">event2/buffer.h</includes>
    <includes local="no">event2/bufferevent.h</includes>
    <includes local="no">event2/http.h</includes>
    <includes local="no">event2/http_struct.h</includes>
    <includes local="no">event2/keyvalq_struct.h</includes>
    <includes local="no">event2/thread.h</includes>
    <includes local="no">event2/util.h</includes>
    <includes refid="events_8h" local="no">support/events.h</includes>
    <incdepgraph>
      <node id="16">
        <label>attributes.h</label>
        <link refid="attributes_8h"/>
      </node>
      <node id="7">
        <label>chainparamsbase.h</label>
        <link refid="chainparamsbase_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="11">
        <label>common/args.h</label>
        <link refid="args_8h"/>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="60" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="61">
        <label>common/messages.h</label>
        <link refid="messages_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="12">
        <label>common/settings.h</label>
        <link refid="common_2settings_8h"/>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="89">
        <label>compat/assumptions.h</label>
        <link refid="compat_2assumptions_8h"/>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="87" relation="include">
        </childnode>
      </node>
      <node id="80">
        <label>compat/byteswap.h</label>
        <link refid="byteswap_8h"/>
        <childnode refid="9" relation="include">
        </childnode>
      </node>
      <node id="38">
        <label>compat/compat.h</label>
        <link refid="compat_8h"/>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="49" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
      </node>
      <node id="79">
        <label>compat/endian.h</label>
        <link refid="endian_8h"/>
        <childnode refid="80" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
      </node>
      <node id="77">
        <label>crypto/chacha20.h</label>
        <link refid="chacha20_8h"/>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="75" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
      </node>
      <node id="78">
        <label>crypto/common.h</label>
        <link refid="crypto_2common_8h"/>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
      </node>
      <node id="85">
        <label>crypto/hex_base.h</label>
        <link refid="hex__base_8h"/>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="63">
        <label>crypto/siphash.h</label>
        <link refid="siphash_8h"/>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>src/httpserver.cpp</label>
        <link refid="httpserver_8cpp"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="71" relation="include">
        </childnode>
        <childnode refid="94" relation="include">
        </childnode>
        <childnode refid="95" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="96" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="98" relation="include">
        </childnode>
        <childnode refid="99" relation="include">
        </childnode>
        <childnode refid="55" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="74" relation="include">
        </childnode>
        <childnode refid="100" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="56" relation="include">
        </childnode>
        <childnode refid="69" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="101" relation="include">
        </childnode>
        <childnode refid="102" relation="include">
        </childnode>
        <childnode refid="103" relation="include">
        </childnode>
        <childnode refid="104" relation="include">
        </childnode>
        <childnode refid="105" relation="include">
        </childnode>
        <childnode refid="106" relation="include">
        </childnode>
        <childnode refid="107" relation="include">
        </childnode>
        <childnode refid="108" relation="include">
        </childnode>
        <childnode refid="109" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>httpserver.h</label>
        <link refid="httpserver_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="62">
        <label>logging.h</label>
        <link refid="logging_8h"/>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="67" relation="include">
        </childnode>
        <childnode refid="65" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
        <childnode refid="66" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="69" relation="include">
        </childnode>
        <childnode refid="70" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="72">
        <label>netaddress.h</label>
        <link refid="netaddress_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="73" relation="include">
        </childnode>
        <childnode refid="76" relation="include">
        </childnode>
        <childnode refid="88" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="71">
        <label>netbase.h</label>
        <link refid="netbase_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="72" relation="include">
        </childnode>
        <childnode refid="88" relation="include">
        </childnode>
        <childnode refid="90" relation="include">
        </childnode>
        <childnode refid="93" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="70" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="94">
        <label>node/interface_ui.h</label>
        <link refid="interface__ui_8h"/>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="73">
        <label>prevector.h</label>
        <link refid="prevector_8h"/>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="74" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="75" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
      </node>
      <node id="76">
        <label>random.h</label>
        <link refid="random_8h"/>
        <childnode refid="77" relation="include">
        </childnode>
        <childnode refid="78" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="83" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="68" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="95">
        <label>rpc/protocol.h</label>
        <link refid="rpc_2protocol_8h"/>
      </node>
      <node id="88">
        <label>serialize.h</label>
        <link refid="serialize_8h"/>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="89" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="73" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="21">
        <label>span.h</label>
        <link refid="span_8h"/>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
      </node>
      <node id="109">
        <label>support/events.h</label>
        <link refid="events_8h"/>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="110" relation="include">
        </childnode>
        <childnode refid="104" relation="include">
        </childnode>
      </node>
      <node id="51">
        <label>sync.h</label>
        <link refid="sync_8h"/>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="54" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="55" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="56" relation="include">
        </childnode>
      </node>
      <node id="52">
        <label>threadsafety.h</label>
        <link refid="threadsafety_8h"/>
        <childnode refid="53" relation="include">
        </childnode>
      </node>
      <node id="14">
        <label>tinyformat.h</label>
        <link refid="tinyformat_8h"/>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="83">
        <label>uint256.h</label>
        <link refid="uint256_8h"/>
        <childnode refid="78" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="8">
        <label>util/chaintype.h</label>
        <link refid="chaintype_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="64">
        <label>util/check.h</label>
        <link refid="check_8h"/>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="65" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="66" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
      </node>
      <node id="13">
        <label>util/fs.h</label>
        <link refid="fs_8h"/>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
      </node>
      <node id="54">
        <label>util/macros.h</label>
        <link refid="macros_8h"/>
      </node>
      <node id="96">
        <label>util/signalinterrupt.h</label>
        <link refid="signalinterrupt_8h"/>
        <childnode refid="97" relation="include">
        </childnode>
        <childnode refid="65" relation="include">
        </childnode>
        <childnode refid="74" relation="include">
        </childnode>
      </node>
      <node id="90">
        <label>util/sock.h</label>
        <link refid="sock_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="91" relation="include">
        </childnode>
        <childnode refid="92" relation="include">
        </childnode>
        <childnode refid="68" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="69" relation="include">
        </childnode>
      </node>
      <node id="84">
        <label>util/strencodings.h</label>
        <link refid="strencodings_8h"/>
        <childnode refid="85" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="86" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="20">
        <label>util/string.h</label>
        <link refid="string_8h"/>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="93">
        <label>util/threadinterrupt.h</label>
        <link refid="util_2threadinterrupt_8h"/>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="65" relation="include">
        </childnode>
        <childnode refid="68" relation="include">
        </childnode>
        <childnode refid="55" relation="include">
        </childnode>
      </node>
      <node id="98">
        <label>util/threadnames.h</label>
        <link refid="threadnames_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="67">
        <label>util/time.h</label>
        <link refid="util_2time_8h"/>
        <childnode refid="68" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="97">
        <label>util/tokenpipe.h</label>
        <link refid="tokenpipe_8h"/>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
      </node>
      <node id="99">
        <label>util/translation.h</label>
        <link refid="translation_8h"/>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="15">
        <label>algorithm</label>
      </node>
      <node id="39">
        <label>arpa/inet.h</label>
      </node>
      <node id="26">
        <label>array</label>
      </node>
      <node id="65">
        <label>atomic</label>
      </node>
      <node id="81">
        <label>bit</label>
      </node>
      <node id="22">
        <label>cassert</label>
      </node>
      <node id="50">
        <label>cerrno</label>
      </node>
      <node id="86">
        <label>charconv</label>
      </node>
      <node id="68">
        <label>chrono</label>
      </node>
      <node id="82">
        <label>concepts</label>
      </node>
      <node id="55">
        <label>condition_variable</label>
      </node>
      <node id="23">
        <label>cstddef</label>
      </node>
      <node id="9">
        <label>cstdint</label>
      </node>
      <node id="31">
        <label>cstdio</label>
      </node>
      <node id="74">
        <label>cstdlib</label>
      </node>
      <node id="27">
        <label>cstring</label>
      </node>
      <node id="100">
        <label>deque</label>
      </node>
      <node id="102">
        <label>event2/buffer.h</label>
      </node>
      <node id="103">
        <label>event2/bufferevent.h</label>
      </node>
      <node id="110">
        <label>event2/event.h</label>
      </node>
      <node id="104">
        <label>event2/http.h</label>
      </node>
      <node id="105">
        <label>event2/http_struct.h</label>
      </node>
      <node id="106">
        <label>event2/keyvalq_struct.h</label>
      </node>
      <node id="107">
        <label>event2/thread.h</label>
      </node>
      <node id="108">
        <label>event2/util.h</label>
      </node>
      <node id="40">
        <label>fcntl.h</label>
      </node>
      <node id="32">
        <label>filesystem</label>
      </node>
      <node id="3">
        <label>functional</label>
      </node>
      <node id="33">
        <label>iomanip</label>
      </node>
      <node id="34">
        <label>ios</label>
      </node>
      <node id="57">
        <label>iosfwd</label>
      </node>
      <node id="17">
        <label>iostream</label>
      </node>
      <node id="75">
        <label>iterator</label>
      </node>
      <node id="87">
        <label>limits</label>
      </node>
      <node id="58">
        <label>list</label>
      </node>
      <node id="28">
        <label>locale</label>
      </node>
      <node id="37">
        <label>map</label>
      </node>
      <node id="10">
        <label>memory</label>
      </node>
      <node id="53">
        <label>mutex</label>
      </node>
      <node id="41">
        <label>net/if.h</label>
      </node>
      <node id="42">
        <label>netdb.h</label>
      </node>
      <node id="43">
        <label>netinet/in.h</label>
      </node>
      <node id="44">
        <label>netinet/tcp.h</label>
      </node>
      <node id="4">
        <label>optional</label>
      </node>
      <node id="35">
        <label>ostream</label>
      </node>
      <node id="59">
        <label>set</label>
      </node>
      <node id="66">
        <label>source_location</label>
      </node>
      <node id="5">
        <label>span</label>
      </node>
      <node id="18">
        <label>sstream</label>
      </node>
      <node id="19">
        <label>stdexcept</label>
      </node>
      <node id="6">
        <label>string</label>
      </node>
      <node id="29">
        <label>string_view</label>
      </node>
      <node id="45">
        <label>sys/mman.h</label>
      </node>
      <node id="46">
        <label>sys/select.h</label>
      </node>
      <node id="47">
        <label>sys/socket.h</label>
      </node>
      <node id="101">
        <label>sys/stat.h</label>
      </node>
      <node id="48">
        <label>sys/types.h</label>
      </node>
      <node id="36">
        <label>system_error</label>
      </node>
      <node id="56">
        <label>thread</label>
      </node>
      <node id="24">
        <label>type_traits</label>
      </node>
      <node id="49">
        <label>unistd.h</label>
      </node>
      <node id="69">
        <label>unordered_map</label>
      </node>
      <node id="70">
        <label>unordered_set</label>
      </node>
      <node id="91">
        <label>util/threadinterrupt.h</label>
      </node>
      <node id="92">
        <label>util/time.h</label>
      </node>
      <node id="25">
        <label>utility</label>
      </node>
      <node id="60">
        <label>variant</label>
      </node>
      <node id="30">
        <label>vector</label>
      </node>
    </incdepgraph>
    <innerclass refid="class_h_t_t_p_work_item" prot="public">HTTPWorkItem</innerclass>
    <innerclass refid="class_work_queue" prot="public">WorkQueue</innerclass>
    <innerclass refid="struct_h_t_t_p_path_handler" prot="public">HTTPPathHandler</innerclass>
    <innerclass refid="class_h_t_t_p_request_tracker" prot="public">HTTPRequestTracker</innerclass>
    <sectiondef kind="var">
      <memberdef kind="variable" id="httpserver_8cpp_1ad7a8724de9862347e233e9989bb5d2d5" prot="public" static="yes" mutable="no">
        <type>const size_t</type>
        <definition>const size_t MAX_HEADERS_SIZE</definition>
        <argsstring></argsstring>
        <name>MAX_HEADERS_SIZE</name>
        <initializer>= 8192</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Maximum size of http request (request line + headers) </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="50" column="21" bodyfile="src/httpserver.cpp" bodystart="50" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="httpserver_8cpp_1a5522823075f10647b77372d0b060f2da" prot="public" static="yes" mutable="no">
        <type>struct event_base *</type>
        <definition>struct event_base* eventBase</definition>
        <argsstring></argsstring>
        <name>eventBase</name>
        <initializer>= nullptr</initializer>
        <briefdescription>
<para>libevent event loop </para>
        </briefdescription>
        <detaileddescription>
<para>HTTP module state </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="143" column="25" bodyfile="src/httpserver.cpp" bodystart="143" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="httpserver_8cpp_1a06877f3f79d254676c5a550708c915c2" prot="public" static="yes" mutable="no">
        <type>struct evhttp *</type>
        <definition>struct evhttp* eventHTTP</definition>
        <argsstring></argsstring>
        <name>eventHTTP</name>
        <initializer>= nullptr</initializer>
        <briefdescription>
<para>HTTP server. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="145" column="21" bodyfile="src/httpserver.cpp" bodystart="145" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="httpserver_8cpp_1ac95cd1cda418414ceb45f0adb40b7422" prot="public" static="yes" mutable="no">
        <type>std::vector&lt; <ref refid="class_c_sub_net" kindref="compound">CSubNet</ref> &gt;</type>
        <definition>std::vector&lt;CSubNet&gt; rpc_allow_subnets</definition>
        <argsstring></argsstring>
        <name>rpc_allow_subnets</name>
        <briefdescription>
<para>List of subnets to allow RPC connections from. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="147" column="20" bodyfile="src/httpserver.cpp" bodystart="147" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="httpserver_8cpp_1a66a9ce6349ff7300438e3abb62065b8b" prot="public" static="yes" mutable="no">
        <type>std::unique_ptr&lt; <ref refid="class_work_queue" kindref="compound">WorkQueue</ref>&lt; <ref refid="class_h_t_t_p_closure" kindref="compound">HTTPClosure</ref> &gt; &gt;</type>
        <definition>std::unique_ptr&lt;WorkQueue&lt;HTTPClosure&gt; &gt; g_work_queue</definition>
        <argsstring></argsstring>
        <name>g_work_queue</name>
        <initializer>{nullptr}</initializer>
        <briefdescription>
<para>Work queue for handling longer requests off the event loop thread. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="149" column="24" bodyfile="src/httpserver.cpp" bodystart="149" bodyend="149"/>
      </memberdef>
      <memberdef kind="variable" id="httpserver_8cpp_1af63457f35e4a20d8d42409ad2bd334ad" prot="public" static="yes" mutable="no">
        <type><ref refid="class_global_mutex" kindref="compound">GlobalMutex</ref></type>
        <definition>GlobalMutex g_httppathhandlers_mutex</definition>
        <argsstring></argsstring>
        <name>g_httppathhandlers_mutex</name>
        <briefdescription>
<para>Handlers for (sub)paths. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="151" column="20" bodyfile="src/httpserver.cpp" bodystart="151" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="httpserver_8cpp_1a41153da092439dd95528d2707da29c33" prot="public" static="yes" mutable="no">
        <type>std::vector&lt; evhttp_bound_socket * &gt;</type>
        <definition>std::vector&lt;evhttp_bound_socket *&gt; boundSockets</definition>
        <argsstring></argsstring>
        <name>boundSockets</name>
        <briefdescription>
<para>Bound listening sockets. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="154" column="20" bodyfile="src/httpserver.cpp" bodystart="154" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="httpserver_8cpp_1a85b458e10f65ee8bec0bda436537ba9c" prot="public" static="yes" mutable="no">
        <type><ref refid="class_h_t_t_p_request_tracker" kindref="compound">HTTPRequestTracker</ref></type>
        <definition>HTTPRequestTracker g_requests</definition>
        <argsstring></argsstring>
        <name>g_requests</name>
        <briefdescription>
<para>Track active requests. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="209" column="27" bodyfile="src/httpserver.cpp" bodystart="209" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="httpserver_8cpp_1a618d933fb2d895e78d41a6866adf9331" prot="public" static="yes" mutable="no">
        <type>std::thread</type>
        <definition>std::thread g_thread_http</definition>
        <argsstring></argsstring>
        <name>g_thread_http</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="496" column="20" bodyfile="src/httpserver.cpp" bodystart="496" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="httpserver_8cpp_1ae1a63374e18b9abd348eb74e4243ea34" prot="public" static="yes" mutable="no">
        <type>std::vector&lt; std::thread &gt;</type>
        <definition>std::vector&lt;std::thread&gt; g_thread_http_workers</definition>
        <argsstring></argsstring>
        <name>g_thread_http_workers</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="497" column="20" bodyfile="src/httpserver.cpp" bodystart="497" bodyend="-1"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="func">
      <memberdef kind="function" id="httpserver_8cpp_1aee2fd9d9635a49435b3cc5c972570753" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>std::vector&lt; <ref refid="struct_h_t_t_p_path_handler" kindref="compound">HTTPPathHandler</ref> &gt; pathHandlers</type>
        <definition>static std::vector&lt; HTTPPathHandler &gt; pathHandlers GUARDED_BY</definition>
        <argsstring>(g_httppathhandlers_mutex)</argsstring>
        <name>GUARDED_BY</name>
        <param>
          <type>g_httppathhandlers_mutex</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="152" column="33" declfile="src/httpserver.cpp" declline="152" declcolumn="33"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1aca09409a61fe2c1fd1d5f790d16c470f" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool ClientAllowed</definition>
        <argsstring>(const CNetAddr &amp;netaddr)</argsstring>
        <name>ClientAllowed</name>
        <param>
          <type>const <ref refid="class_c_net_addr" kindref="compound">CNetAddr</ref> &amp;</type>
          <declname>netaddr</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check if a network address is allowed to access the HTTP server </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="212" column="13" bodyfile="src/httpserver.cpp" bodystart="212" bodyend="220"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1aacd2d2cfef18c714ba497b03c398751f" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool InitHTTPAllowList</definition>
        <argsstring>()</argsstring>
        <name>InitHTTPAllowList</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Initialize ACL list for HTTP server </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="223" column="13" bodyfile="src/httpserver.cpp" bodystart="223" bodyend="243"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1a75af2ef31b82c402e19abb5b24d1368a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>std::string</type>
        <definition>std::string RequestMethodString</definition>
        <argsstring>(HTTPRequest::RequestMethod m)</argsstring>
        <name>RequestMethodString</name>
        <param>
          <type><ref refid="class_h_t_t_p_request_1a667255974fbff6d39bc2e840d46f47e1" kindref="member">HTTPRequest::RequestMethod</ref></type>
          <declname>m</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>HTTP request method as string - use for logging only </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="246" column="13" bodyfile="src/httpserver.cpp" bodystart="246" bodyend="261"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1a1b457f5c4b63d1a0f5b60116d81768af" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void http_request_cb</definition>
        <argsstring>(struct evhttp_request *req, void *arg)</argsstring>
        <name>http_request_cb</name>
        <param>
          <type>struct evhttp_request *</type>
          <declname>req</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>arg</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>HTTP request callback </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="264" column="13" bodyfile="src/httpserver.cpp" bodystart="264" bodyend="341"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1acb66dc77121923d7441b7ce325840895" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void http_reject_request_cb</definition>
        <argsstring>(struct evhttp_request *req, void *)</argsstring>
        <name>http_reject_request_cb</name>
        <param>
          <type>struct evhttp_request *</type>
          <declname>req</declname>
        </param>
        <param>
          <type>void *</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Callback to reject HTTP requests after shutdown. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="344" column="13" bodyfile="src/httpserver.cpp" bodystart="344" bodyend="348"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1adbf5194fce4a8bee2461f694ea9adcae" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void ThreadHTTP</definition>
        <argsstring>(struct event_base *base)</argsstring>
        <name>ThreadHTTP</name>
        <param>
          <type>struct event_base *</type>
          <declname>base</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Event dispatcher thread </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="351" column="13" bodyfile="src/httpserver.cpp" bodystart="351" bodyend="358"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1a33003026ae72aa806c85add6d8efcb4a" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool HTTPBindAddresses</definition>
        <argsstring>(struct evhttp *http)</argsstring>
        <name>HTTPBindAddresses</name>
        <param>
          <type>struct evhttp *</type>
          <declname>http</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Bind HTTP server to specified addresses </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="361" column="13" bodyfile="src/httpserver.cpp" bodystart="361" bodyend="413"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1aa6a7bc27265043bc0193220c5ae3a55f" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void HTTPWorkQueueRun</definition>
        <argsstring>(WorkQueue&lt; HTTPClosure &gt; *queue, int worker_num)</argsstring>
        <name>HTTPWorkQueueRun</name>
        <param>
          <type><ref refid="class_work_queue" kindref="compound">WorkQueue</ref>&lt; <ref refid="class_h_t_t_p_closure" kindref="compound">HTTPClosure</ref> &gt; *</type>
          <declname>queue</declname>
        </param>
        <param>
          <type>int</type>
          <declname>worker_num</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Simple wrapper to set thread name and run work queue </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="416" column="13" bodyfile="src/httpserver.cpp" bodystart="416" bodyend="420"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1ac1552258172bcee1047134108caaead4" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void libevent_log_cb</definition>
        <argsstring>(int severity, const char *msg)</argsstring>
        <name>libevent_log_cb</name>
        <param>
          <type>int</type>
          <declname>severity</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>msg</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>libevent event log callback </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="423" column="13" bodyfile="src/httpserver.cpp" bodystart="423" bodyend="439"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1aa5183260b12c1ce706dad5b454a44cec" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>bool InitHTTPServer</definition>
        <argsstring>(const util::SignalInterrupt &amp;interrupt)</argsstring>
        <name>InitHTTPServer</name>
        <param>
          <type>const <ref refid="classutil_1_1_signal_interrupt" kindref="compound">util::SignalInterrupt</ref> &amp;</type>
          <declname>interrupt</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Initialize HTTP server. Call this before RegisterHTTPHandler or <ref refid="httpserver_8h_1a678938523347079b4dd5fabc47efdbbc" kindref="member">EventBase()</ref>. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="441" column="6" bodyfile="src/httpserver.cpp" bodystart="441" bodyend="486"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1a5d061de02f52817cc3e5957046dbf766" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void UpdateHTTPServerLogging</definition>
        <argsstring>(bool enable)</argsstring>
        <name>UpdateHTTPServerLogging</name>
        <param>
          <type>bool</type>
          <declname>enable</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Change logging level for libevent. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="488" column="6" bodyfile="src/httpserver.cpp" bodystart="488" bodyend="494"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1a4fd74612426e28d4678557f401066d96" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void StartHTTPServer</definition>
        <argsstring>()</argsstring>
        <name>StartHTTPServer</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Start HTTP server. This is separate from InitHTTPServer to give users race-condition-free time to register their handlers between InitHTTPServer and StartHTTPServer. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="499" column="6" bodyfile="src/httpserver.cpp" bodystart="499" bodyend="508"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1a0a02b6576090c9fde2eed21b9aa7dc0c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void InterruptHTTPServer</definition>
        <argsstring>()</argsstring>
        <name>InterruptHTTPServer</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Interrupt HTTP server threads </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="510" column="6" bodyfile="src/httpserver.cpp" bodystart="510" bodyend="520"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1ad95d08d62c15b43d52fdba7b7ecaa0aa" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void StopHTTPServer</definition>
        <argsstring>()</argsstring>
        <name>StopHTTPServer</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Stop HTTP server </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="522" column="6" bodyfile="src/httpserver.cpp" bodystart="522" bodyend="561"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1a678938523347079b4dd5fabc47efdbbc" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>struct event_base *</type>
        <definition>struct event_base * EventBase</definition>
        <argsstring>()</argsstring>
        <name>EventBase</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Return evhttp event base. This can be used by submodules to queue timers or custom events. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="563" column="18" bodyfile="src/httpserver.cpp" bodystart="563" bodyend="566"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1a742caf2e32b30e73ba316f6f66356094" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void httpevent_callback_fn</definition>
        <argsstring>(evutil_socket_t, short, void *data)</argsstring>
        <name>httpevent_callback_fn</name>
        <param>
          <type>evutil_socket_t</type>
        </param>
        <param>
          <type>short</type>
        </param>
        <param>
          <type>void *</type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="568" column="13" bodyfile="src/httpserver.cpp" bodystart="568" bodyend="575"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1a4b96025548083ad61a3b0847621c7a74" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>std::optional&lt; std::string &gt;</type>
        <definition>std::optional&lt; std::string &gt; GetQueryParameterFromUri</definition>
        <argsstring>(const char *uri, const std::string &amp;key)</argsstring>
        <name>GetQueryParameterFromUri</name>
        <param>
          <type>const char *</type>
          <declname>uri</declname>
        </param>
        <param>
          <type>const std::string &amp;</type>
          <declname>key</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Get the query parameter value from request uri for a specified key, or std::nullopt if the key is not found.</para>
<para>If the query string contains duplicate keys, the first value is returned. Many web frameworks would instead parse this as an array of values, but this is not (yet) implemented as it is currently not needed in any of the endpoints.</para>
<para>Helper function for <ref refid="class_h_t_t_p_request_1a4c8d3ca82089f916e360d1d06cf09dbf" kindref="member">HTTPRequest::GetQueryParameter</ref>.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername direction="in">uri</parametername>
</parameternamelist>
<parameterdescription>
<para>is the entire request uri </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername direction="in">key</parametername>
</parameternamelist>
<parameterdescription>
<para>represents the query parameter of which the value is returned </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="730" column="15" bodyfile="src/httpserver.cpp" bodystart="730" bodyend="755"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1a43a4c24762a6af819e364b55820323ed" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void RegisterHTTPHandler</definition>
        <argsstring>(const std::string &amp;prefix, bool exactMatch, const HTTPRequestHandler &amp;handler)</argsstring>
        <name>RegisterHTTPHandler</name>
        <param>
          <type>const std::string &amp;</type>
          <declname>prefix</declname>
        </param>
        <param>
          <type>bool</type>
          <declname>exactMatch</declname>
        </param>
        <param>
          <type>const <ref refid="httpserver_8h_1ac21c51cfc9edce52ebe847dee0571a0a" kindref="member">HTTPRequestHandler</ref> &amp;</type>
          <declname>handler</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Register handler for prefix. If multiple handlers match a prefix, the first-registered one will be invoked. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="757" column="6" bodyfile="src/httpserver.cpp" bodystart="757" bodyend="762"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1a42d2567faa003c410a310a9c4e36ebdc" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void UnregisterHTTPHandler</definition>
        <argsstring>(const std::string &amp;prefix, bool exactMatch)</argsstring>
        <name>UnregisterHTTPHandler</name>
        <param>
          <type>const std::string &amp;</type>
          <declname>prefix</declname>
        </param>
        <param>
          <type>bool</type>
          <declname>exactMatch</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Unregister handler for prefix </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="764" column="6" bodyfile="src/httpserver.cpp" bodystart="764" bodyend="777"/>
      </memberdef>
      <memberdef kind="function" id="httpserver_8cpp_1aeb737684e2a2da0e1190fed1229d7990" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="structbilingual__str" kindref="compound">bilingual_str</ref></type>
        <definition>bilingual_str InvalidPortErrMsg</definition>
        <argsstring>(const std::string &amp;optname, const std::string &amp;invalid_value)</argsstring>
        <name>InvalidPortErrMsg</name>
        <param>
          <type>const std::string &amp;</type>
          <declname>optname</declname>
        </param>
        <param>
          <type>const std::string &amp;</type>
          <declname>invalid_value</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/httpserver.cpp" line="47" column="1" bodyfile="src/common/messages.cpp" bodystart="158" bodyend="161"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2015-present<sp/>The<sp/>Bitcoin<sp/>Core<sp/>developers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Distributed<sp/>under<sp/>the<sp/>MIT<sp/>software<sp/>license,<sp/>see<sp/>the<sp/>accompanying</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">//<sp/>file<sp/>COPYING<sp/>or<sp/>http://www.opensource.org/licenses/mit-license.php.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="httpserver_8h" kindref="compound">httpserver.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="chainparamsbase_8h" kindref="compound">chainparamsbase.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="args_8h" kindref="compound">common/args.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="messages_8h" kindref="compound">common/messages.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="compat_8h" kindref="compound">compat/compat.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="logging_8h" kindref="compound">logging.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="netbase_8h" kindref="compound">netbase.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="interface__ui_8h" kindref="compound">node/interface_ui.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="rpc_2protocol_8h" kindref="compound">rpc/protocol.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="sync_8h" kindref="compound">sync.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="check_8h" kindref="compound">util/check.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="signalinterrupt_8h" kindref="compound">util/signalinterrupt.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="strencodings_8h" kindref="compound">util/strencodings.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="threadnames_8h" kindref="compound">util/threadnames.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="translation_8h" kindref="compound">util/translation.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;condition_variable&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;cstdio&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;cstdlib&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;deque&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;memory&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;optional&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;span&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;thread&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;unordered_map&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;vector&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;sys/types.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;sys/stat.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;event2/buffer.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;event2/bufferevent.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;event2/http.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;event2/http_struct.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;event2/keyvalq_struct.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;event2/thread.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;event2/util.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="events_8h" kindref="compound">support/events.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight><highlight class="keyword">using<sp/></highlight><highlight class="normal"><ref refid="namespacecommon_1aeb737684e2a2da0e1190fed1229d7990" kindref="member">common::InvalidPortErrMsg</ref>;</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>MAX_HEADERS_SIZE<sp/>=<sp/>8192;</highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight></codeline>
<codeline lineno="53" refid="class_h_t_t_p_work_item" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="class_h_t_t_p_work_item_1a9bf10064d18a6a783e631986c4327a86" kindref="member">HTTPWorkItem</ref><sp/>final<sp/>:<sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_closure" kindref="compound">HTTPClosure</ref></highlight></codeline>
<codeline lineno="54"><highlight class="normal">{</highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_h_t_t_p_work_item_1a9bf10064d18a6a783e631986c4327a86" kindref="member">HTTPWorkItem</ref>(std::unique_ptr&lt;HTTPRequest&gt;<sp/>_req,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string<sp/>&amp;_path,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="httpserver_8h_1ac21c51cfc9edce52ebe847dee0571a0a" kindref="member">HTTPRequestHandler</ref>&amp;<sp/>_func):</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_h_t_t_p_work_item_1afc843eabf15568182c229a8bb0e91e8b" kindref="member">req</ref>(std::move(_req)),<sp/>path(_path),<sp/>func(_func)</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_work_item_1a3534c6556c7eb7aab2b704a8b0a8f117" kindref="member">operator()</ref>()</highlight><highlight class="keyword"><sp/>override</highlight></codeline>
<codeline lineno="61"><highlight class="keyword"><sp/><sp/><sp/><sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>func(<ref refid="class_h_t_t_p_work_item_1afc843eabf15568182c229a8bb0e91e8b" kindref="member">req</ref>.get(),<sp/>path);</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/>std::unique_ptr&lt;HTTPRequest&gt;<sp/><ref refid="class_h_t_t_p_work_item_1afc843eabf15568182c229a8bb0e91e8b" kindref="member">req</ref>;</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight><highlight class="keyword">private</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/>std::string<sp/>path;</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="httpserver_8h_1ac21c51cfc9edce52ebe847dee0571a0a" kindref="member">HTTPRequestHandler</ref><sp/>func;</highlight></codeline>
<codeline lineno="70"><highlight class="normal">};</highlight></codeline>
<codeline lineno="71"><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>WorkItem&gt;</highlight></codeline>
<codeline lineno="76" refid="class_work_queue" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="class_work_queue_1ac7e9bfaf4514346a37e73db1158325f8" kindref="member">WorkQueue</ref></highlight></codeline>
<codeline lineno="77"><highlight class="normal">{</highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight><highlight class="keyword">private</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a326d1d46ce05b5316d8ebe2694a10a6e" kindref="member">Mutex</ref><sp/>cs;</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>std::condition_variable<sp/>cond<sp/><ref refid="thread__annotations_8h_1a4bc26ad7e8bc853ad3f58a8a343c952e" kindref="member">GUARDED_BY</ref>(cs);</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/>std::deque&lt;std::unique_ptr&lt;WorkItem&gt;&gt;<sp/>queue<sp/><ref refid="thread__annotations_8h_1a4bc26ad7e8bc853ad3f58a8a343c952e" kindref="member">GUARDED_BY</ref>(cs);</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>running<sp/><ref refid="thread__annotations_8h_1a4bc26ad7e8bc853ad3f58a8a343c952e" kindref="member">GUARDED_BY</ref>(cs){</highlight><highlight class="keyword">true</highlight><highlight class="normal">};</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>maxDepth;</highlight></codeline>
<codeline lineno="84"><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">explicit</highlight><highlight class="normal"><sp/><ref refid="class_work_queue_1ac7e9bfaf4514346a37e73db1158325f8" kindref="member">WorkQueue</ref>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>_maxDepth)<sp/>:<sp/>maxDepth(_maxDepth)</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_work_queue_1ae41e3e0be7ea0f425ccc19d4e6a9addb" kindref="member">~WorkQueue</ref>()<sp/>=<sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_work_queue_1a3d4d54181f67b522379bddb141483b60" kindref="member">Enqueue</ref>(WorkItem*<sp/>item)<sp/><ref refid="thread__annotations_8h_1a0e2e86b0f11d9778240b0a0b263047b1" kindref="member">EXCLUSIVE_LOCKS_REQUIRED</ref>(!cs)</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(cs);</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!running<sp/>||<sp/>queue.size()<sp/>&gt;=<sp/>maxDepth)<sp/>{</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>queue.emplace_back(std::unique_ptr&lt;WorkItem&gt;(item));</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cond.notify_one();</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_work_queue_1ae3d2fdef167ad239725e54c012b89d81" kindref="member">Run</ref>()<sp/><ref refid="thread__annotations_8h_1a0e2e86b0f11d9778240b0a0b263047b1" kindref="member">EXCLUSIVE_LOCKS_REQUIRED</ref>(!cs)</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">true</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::unique_ptr&lt;WorkItem&gt;<sp/>i;</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a05166a687f0bfba57b8ea332c7dd57e0" kindref="member">WAIT_LOCK</ref>(cs,<sp/>lock);</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(running<sp/>&amp;&amp;<sp/>queue.empty())</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cond.wait(lock);</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!running<sp/>&amp;&amp;<sp/>queue.empty())</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i<sp/>=<sp/>std::move(queue.front());</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>queue.pop_front();</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(*i)();</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_work_queue_1ad5215dbc63ee7409c0942fad26764a2b" kindref="member">Interrupt</ref>()<sp/><ref refid="thread__annotations_8h_1a0e2e86b0f11d9778240b0a0b263047b1" kindref="member">EXCLUSIVE_LOCKS_REQUIRED</ref>(!cs)</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(cs);</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>running<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cond.notify_all();</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="127"><highlight class="normal">};</highlight></codeline>
<codeline lineno="128"><highlight class="normal"></highlight></codeline>
<codeline lineno="129" refid="struct_h_t_t_p_path_handler" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="struct_h_t_t_p_path_handler_1a1c15d0de7b2b9c6bfadf71d9d99ebec0" kindref="member">HTTPPathHandler</ref></highlight></codeline>
<codeline lineno="130"><highlight class="normal">{</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_h_t_t_p_path_handler_1a1c15d0de7b2b9c6bfadf71d9d99ebec0" kindref="member">HTTPPathHandler</ref>(std::string<sp/>_prefix,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>_exactMatch,<sp/><ref refid="httpserver_8h_1ac21c51cfc9edce52ebe847dee0571a0a" kindref="member">HTTPRequestHandler</ref><sp/>_handler):</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_h_t_t_p_path_handler_1a78fb15511f687fe7fdb8e3ba9613648b" kindref="member">prefix</ref>(_prefix),<sp/><ref refid="struct_h_t_t_p_path_handler_1aaf240b55c9f1be12b4bdf0146143890a" kindref="member">exactMatch</ref>(_exactMatch),<sp/><ref refid="struct_h_t_t_p_path_handler_1ad16e09cdfdb96ff6a7364980a3da9ac5" kindref="member">handler</ref>(_handler)</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/>std::string<sp/><ref refid="struct_h_t_t_p_path_handler_1a78fb15511f687fe7fdb8e3ba9613648b" kindref="member">prefix</ref>;</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="struct_h_t_t_p_path_handler_1aaf240b55c9f1be12b4bdf0146143890a" kindref="member">exactMatch</ref>;</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="httpserver_8h_1ac21c51cfc9edce52ebe847dee0571a0a" kindref="member">HTTPRequestHandler</ref><sp/><ref refid="struct_h_t_t_p_path_handler_1ad16e09cdfdb96ff6a7364980a3da9ac5" kindref="member">handler</ref>;</highlight></codeline>
<codeline lineno="138"><highlight class="normal">};</highlight></codeline>
<codeline lineno="139"><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">event_base*<sp/>eventBase<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">evhttp*<sp/>eventHTTP<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="147"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>std::vector&lt;CSubNet&gt;<sp/>rpc_allow_subnets;</highlight></codeline>
<codeline lineno="149"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>std::unique_ptr&lt;WorkQueue&lt;HTTPClosure&gt;&gt;<sp/>g_work_queue{</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">};</highlight></codeline>
<codeline lineno="151"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="class_global_mutex" kindref="compound">GlobalMutex</ref><sp/>g_httppathhandlers_mutex;</highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>std::vector&lt;HTTPPathHandler&gt;<sp/>pathHandlers<sp/><ref refid="thread__annotations_8h_1a4bc26ad7e8bc853ad3f58a8a343c952e" kindref="member">GUARDED_BY</ref>(g_httppathhandlers_mutex);</highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>std::vector&lt;evhttp_bound_socket<sp/>*&gt;<sp/>boundSockets;</highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight></codeline>
<codeline lineno="160" refid="class_h_t_t_p_request_tracker" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="class_h_t_t_p_request_tracker" kindref="compound">HTTPRequestTracker</ref></highlight></codeline>
<codeline lineno="161"><highlight class="normal">{</highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight><highlight class="keyword">private</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">mutable</highlight><highlight class="normal"><sp/><ref refid="sync_8h_1a326d1d46ce05b5316d8ebe2694a10a6e" kindref="member">Mutex</ref><sp/>m_mutex;</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">mutable</highlight><highlight class="normal"><sp/>std::condition_variable<sp/>m_cv;</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/>std::unordered_map&lt;const<sp/>evhttp_connection*,<sp/>size_t&gt;<sp/>m_tracker<sp/><ref refid="thread__annotations_8h_1a4bc26ad7e8bc853ad3f58a8a343c952e" kindref="member">GUARDED_BY</ref>(m_mutex);</highlight></codeline>
<codeline lineno="167"><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>RemoveConnectionInternal(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">decltype</highlight><highlight class="normal">(m_tracker)::iterator<sp/>it)<sp/><ref refid="thread__annotations_8h_1a0e2e86b0f11d9778240b0a0b263047b1" kindref="member">EXCLUSIVE_LOCKS_REQUIRED</ref>(m_mutex)</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>m_tracker.erase(it);</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(m_tracker.empty())<sp/>m_cv.notify_all();</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="173"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_tracker_1ad92a0cade1153fc7d9f4577b0060863c" kindref="member">AddRequest</ref>(evhttp_request*<sp/>req)<sp/><ref refid="thread__annotations_8h_1a0e2e86b0f11d9778240b0a0b263047b1" kindref="member">EXCLUSIVE_LOCKS_REQUIRED</ref>(!m_mutex)</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>evhttp_connection*<sp/>conn{<ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(evhttp_request_get_connection(<ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(req)))};</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sync_8h_1ab3029e545f54f330170cbf37f0819693" kindref="member">WITH_LOCK</ref>(m_mutex,<sp/>++m_tracker[conn]);</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_tracker_1abcf42adbcbe168fe166ad250b2e07330" kindref="member">RemoveRequest</ref>(evhttp_request*<sp/>req)<sp/><ref refid="thread__annotations_8h_1a0e2e86b0f11d9778240b0a0b263047b1" kindref="member">EXCLUSIVE_LOCKS_REQUIRED</ref>(!m_mutex)</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>evhttp_connection*<sp/>conn{<ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(evhttp_request_get_connection(<ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(req)))};</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(m_mutex);</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>it{m_tracker.find(conn)};</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(it<sp/>!=<sp/>m_tracker.end()<sp/>&amp;&amp;<sp/>it-&gt;second<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(--(it-&gt;second)<sp/>==<sp/>0)<sp/>RemoveConnectionInternal(it);</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_tracker_1a2fad9b53d1178d71758f9a77f48718df" kindref="member">RemoveConnection</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>evhttp_connection*<sp/>conn)<sp/><ref refid="thread__annotations_8h_1a0e2e86b0f11d9778240b0a0b263047b1" kindref="member">EXCLUSIVE_LOCKS_REQUIRED</ref>(!m_mutex)</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(m_mutex);</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>it{m_tracker.find(<ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(conn))};</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(it<sp/>!=<sp/>m_tracker.end())<sp/>RemoveConnectionInternal(it);</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_tracker_1a75d55b36557888f06a311d483d470606" kindref="member">CountActiveConnections</ref>()<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="thread__annotations_8h_1a0e2e86b0f11d9778240b0a0b263047b1" kindref="member">EXCLUSIVE_LOCKS_REQUIRED</ref>(!m_mutex)</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="sync_8h_1ab3029e545f54f330170cbf37f0819693" kindref="member">WITH_LOCK</ref>(m_mutex,<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>m_tracker.size());</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_tracker_1a24f654443629c4eb9f31f33ebe2dd06b" kindref="member">WaitUntilEmpty</ref>()<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="thread__annotations_8h_1a0e2e86b0f11d9778240b0a0b263047b1" kindref="member">EXCLUSIVE_LOCKS_REQUIRED</ref>(!m_mutex)</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a05166a687f0bfba57b8ea332c7dd57e0" kindref="member">WAIT_LOCK</ref>(m_mutex,<sp/>lock);</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>m_cv.wait(lock,<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">]()<sp/><ref refid="thread__annotations_8h_1a0e2e86b0f11d9778240b0a0b263047b1" kindref="member">EXCLUSIVE_LOCKS_REQUIRED</ref>(m_mutex)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>m_tracker.empty();<sp/>});</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="207"><highlight class="normal">};</highlight></codeline>
<codeline lineno="209"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_tracker" kindref="compound">HTTPRequestTracker</ref><sp/>g_requests;</highlight></codeline>
<codeline lineno="210"><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>ClientAllowed(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_net_addr" kindref="compound">CNetAddr</ref>&amp;<sp/>netaddr)</highlight></codeline>
<codeline lineno="213"><highlight class="normal">{</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!netaddr.<ref refid="class_c_net_addr_1ac532c4b500b1a85ea22217f2c65a70ed" kindref="member">IsValid</ref>())</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_sub_net" kindref="compound">CSubNet</ref>&amp;<sp/>subnet<sp/>:<sp/>rpc_allow_subnets)</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(subnet.Match(netaddr))</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="220"><highlight class="normal">}</highlight></codeline>
<codeline lineno="221"><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>InitHTTPAllowList()</highlight></codeline>
<codeline lineno="224"><highlight class="normal">{</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/>rpc_allow_subnets.clear();</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/>rpc_allow_subnets.emplace_back(<ref refid="netbase_8cpp_1a1ffa791c989b26b3f02b857bcd6bacc3" kindref="member">LookupHost</ref>(</highlight><highlight class="stringliteral">&quot;127.0.0.1&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">).value(),<sp/>8);<sp/><sp/></highlight><highlight class="comment">//<sp/>always<sp/>allow<sp/>IPv4<sp/>local<sp/>subnet</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/>rpc_allow_subnets.emplace_back(<ref refid="netbase_8cpp_1a1ffa791c989b26b3f02b857bcd6bacc3" kindref="member">LookupHost</ref>(</highlight><highlight class="stringliteral">&quot;::1&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">).value());<sp/><sp/></highlight><highlight class="comment">//<sp/>always<sp/>allow<sp/>IPv6<sp/>localhost</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>strAllow<sp/>:<sp/><ref refid="args_8cpp_1a934b7735a5308149ab1bf3ca9fc4d694" kindref="member">gArgs</ref>.GetArgs(</highlight><highlight class="stringliteral">&quot;-rpcallowip&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_sub_net" kindref="compound">CSubNet</ref><sp/>subnet{<ref refid="netbase_8cpp_1a01bb22997f9a177d963c329f552bcd3c" kindref="member">LookupSubNet</ref>(strAllow)};</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!subnet.<ref refid="class_c_sub_net_1ac532c4b500b1a85ea22217f2c65a70ed" kindref="member">IsValid</ref>())<sp/>{</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interface__ui_8cpp_1a4fe31b510fc1c2b95321cedb9f89e8de" kindref="member">uiInterface</ref>.ThreadSafeMessageBox(</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="translation_8h_1adff31aba0266455557bf721860f481b8" kindref="member">Untranslated</ref>(<ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;Invalid<sp/>-rpcallowip<sp/>subnet<sp/>specification:<sp/>%s.<sp/>Valid<sp/>values<sp/>are<sp/>a<sp/>single<sp/>IP<sp/>(e.g.<sp/>1.2.3.4),<sp/>a<sp/>network/netmask<sp/>(e.g.<sp/>1.2.3.4/255.255.255.0),<sp/>a<sp/>network/CIDR<sp/>(e.g.<sp/>1.2.3.4/24),<sp/>all<sp/>ipv4<sp/>(0.0.0.0/0),<sp/>or<sp/>all<sp/>ipv6<sp/>(::/0).<sp/>RFC4193<sp/>is<sp/>allowed<sp/>only<sp/>if<sp/>-cjdnsreachable=0.&quot;</highlight><highlight class="normal">,<sp/>strAllow)),</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">,<sp/><ref refid="class_c_client_u_i_interface_1ab18f2de7469825b7c2fb98cae515ebb8a28aec242413d6eab32c014fd1cecc4f0" kindref="member">CClientUIInterface::MSG_ERROR</ref>);</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rpc_allow_subnets.push_back(subnet);</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/>std::string<sp/>strAllowed;</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_sub_net" kindref="compound">CSubNet</ref>&amp;<sp/>subnet<sp/>:<sp/>rpc_allow_subnets)</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strAllowed<sp/>+=<sp/>subnet.<ref refid="class_c_sub_net_1a19c380b03cea21d7ac7325136a131ff0" kindref="member">ToString</ref>()<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;<sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395a67e044074f46e6cea22788527da5f02e" kindref="member">BCLog::HTTP</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Allowing<sp/>HTTP<sp/>connections<sp/>from:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>strAllowed);</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="243"><highlight class="normal">}</highlight></codeline>
<codeline lineno="244"><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal">std::string<sp/><ref refid="httpserver_8cpp_1a75af2ef31b82c402e19abb5b24d1368a" kindref="member">RequestMethodString</ref>(<ref refid="class_h_t_t_p_request_1a667255974fbff6d39bc2e840d46f47e1" kindref="member">HTTPRequest::RequestMethod</ref><sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>)</highlight></codeline>
<codeline lineno="247"><highlight class="normal">{</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>)<sp/>{</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_1a667255974fbff6d39bc2e840d46f47e1a12a8dcf59c16b5aadfda3a08ba67d529" kindref="member">HTTPRequest::GET</ref>:</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;GET&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_1a667255974fbff6d39bc2e840d46f47e1a368c5bc07109370b819193871352b926" kindref="member">HTTPRequest::POST</ref>:</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;POST&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_1a667255974fbff6d39bc2e840d46f47e1a0b0955668575b21eb0ab2272aef49f76" kindref="member">HTTPRequest::HEAD</ref>:</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;HEAD&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_1a667255974fbff6d39bc2e840d46f47e1afec39d40e8bc9e12afa614df5ddb9fa9" kindref="member">HTTPRequest::PUT</ref>:</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;PUT&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_1a667255974fbff6d39bc2e840d46f47e1a6ce26a62afab55d7606ad4e92428b30c" kindref="member">HTTPRequest::UNKNOWN</ref>:</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;unknown&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="comment">//<sp/>no<sp/>default<sp/>case,<sp/>so<sp/>the<sp/>compiler<sp/>can<sp/>warn<sp/>about<sp/>missing<sp/>cases</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(</highlight><highlight class="keyword">false</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="261"><highlight class="normal">}</highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>http_request_cb(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>evhttp_request*<sp/>req,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>arg)</highlight></codeline>
<codeline lineno="265"><highlight class="normal">{</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/>evhttp_connection*<sp/>conn{evhttp_request_get_connection(req)};</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Track<sp/>active<sp/>requests</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>g_requests.AddRequest(req);</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evhttp_request_set_on_complete_cb(req,<sp/>[](</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>evhttp_request*<sp/>req,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*)<sp/>{</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>g_requests.RemoveRequest(req);</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evhttp_connection_set_closecb(conn,<sp/>[](evhttp_connection*<sp/>conn,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>arg)<sp/>{</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>g_requests.RemoveConnection(conn);</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Disable<sp/>reading<sp/>to<sp/>work<sp/>around<sp/>a<sp/>libevent<sp/>bug,<sp/>fixed<sp/>in<sp/>2.1.9</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>See<sp/>https://github.com/libevent/libevent/commit/5ff8eb26371c4dc56f384b2de35bea2d87814779</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>https://github.com/bitcoin/bitcoin/pull/11593.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(event_get_version_number()<sp/>&gt;=<sp/>0x02010600<sp/>&amp;&amp;<sp/>event_get_version_number()<sp/>&lt;<sp/>0x02010900)<sp/>{</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(conn)<sp/>{</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bufferevent*<sp/>bev<sp/>=<sp/>evhttp_connection_get_bufferevent(conn);</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(bev)<sp/>{</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bufferevent_disable(bev,<sp/>EV_READ);</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>hreq{std::make_unique&lt;HTTPRequest&gt;(req,<sp/>*</highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="keyword">const<sp/></highlight><highlight class="normal"><ref refid="classutil_1_1_signal_interrupt" kindref="compound">util::SignalInterrupt</ref>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(arg))};</highlight></codeline>
<codeline lineno="290"><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Early<sp/>address-based<sp/>allow<sp/>check</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!ClientAllowed(hreq-&gt;GetPeer()))<sp/>{</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395a67e044074f46e6cea22788527da5f02e" kindref="member">BCLog::HTTP</ref>,<sp/></highlight><highlight class="stringliteral">&quot;HTTP<sp/>request<sp/>from<sp/>%s<sp/>rejected:<sp/>Client<sp/>network<sp/>is<sp/>not<sp/>allowed<sp/>RPC<sp/>access\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hreq-&gt;GetPeer().ToStringAddrPort());</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hreq-&gt;WriteReply(<ref refid="rpc_2protocol_8h_1ab0a9668b7d736b4d4d621ec010928a46a7aec6e8ecb79ff84830a69e52ff01d17" kindref="member">HTTP_FORBIDDEN</ref>);</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="298"><highlight class="normal"></highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Early<sp/>reject<sp/>unknown<sp/>HTTP<sp/>methods</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(hreq-&gt;GetRequestMethod()<sp/>==<sp/><ref refid="class_h_t_t_p_request_1a667255974fbff6d39bc2e840d46f47e1a6ce26a62afab55d7606ad4e92428b30c" kindref="member">HTTPRequest::UNKNOWN</ref>)<sp/>{</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395a67e044074f46e6cea22788527da5f02e" kindref="member">BCLog::HTTP</ref>,<sp/></highlight><highlight class="stringliteral">&quot;HTTP<sp/>request<sp/>from<sp/>%s<sp/>rejected:<sp/>Unknown<sp/>HTTP<sp/>request<sp/>method\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hreq-&gt;GetPeer().ToStringAddrPort());</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hreq-&gt;WriteReply(<ref refid="rpc_2protocol_8h_1ab0a9668b7d736b4d4d621ec010928a46a40d47a5f8adc6d74c1ec977528a36edf" kindref="member">HTTP_BAD_METHOD</ref>);</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="306"><highlight class="normal"></highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395a67e044074f46e6cea22788527da5f02e" kindref="member">BCLog::HTTP</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Received<sp/>a<sp/>%s<sp/>request<sp/>for<sp/>%s<sp/>from<sp/>%s\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="httpserver_8cpp_1a75af2ef31b82c402e19abb5b24d1368a" kindref="member">RequestMethodString</ref>(hreq-&gt;GetRequestMethod()),<sp/><ref refid="util_2strencodings_8cpp_1af661610872e92731fc31facae4d42361" kindref="member">SanitizeString</ref>(hreq-&gt;GetURI(),<sp/><ref refid="strencodings_8h_1aecdd292e3acadfcc5ffe4fabe452cfefa6e52157fa0f63fa949b8a3d79048b40b" kindref="member">SAFE_CHARS_URI</ref>).substr(0,<sp/>100),<sp/>hreq-&gt;GetPeer().ToStringAddrPort());</highlight></codeline>
<codeline lineno="309"><highlight class="normal"></highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Find<sp/>registered<sp/>handler<sp/>for<sp/>prefix</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/>std::string<sp/>strURI<sp/>=<sp/>hreq-&gt;GetURI();</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/>std::string<sp/>path;</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(g_httppathhandlers_mutex);</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;HTTPPathHandler&gt;::const_iterator<sp/>i<sp/>=<sp/>pathHandlers.begin();</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;HTTPPathHandler&gt;::const_iterator<sp/>iend<sp/>=<sp/>pathHandlers.end();</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(;<sp/>i<sp/>!=<sp/>iend;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>match<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(i-&gt;exactMatch)</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>match<sp/>=<sp/>(strURI<sp/>==<sp/>i-&gt;prefix);</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>match<sp/>=<sp/>strURI.starts_with(i-&gt;prefix);</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(match)<sp/>{</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>path<sp/>=<sp/>strURI.substr(i-&gt;prefix.size());</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="327"><highlight class="normal"></highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Dispatch<sp/>to<sp/>worker<sp/>thread</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(i<sp/>!=<sp/>iend)<sp/>{</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::unique_ptr&lt;HTTPWorkItem&gt;<sp/>item(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_work_item" kindref="compound">HTTPWorkItem</ref>(std::move(hreq),<sp/>path,<sp/>i-&gt;handler));</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(g_work_queue);</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_work_queue-&gt;Enqueue(item.get()))<sp/>{</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[[maybe_unused]]<sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/><ref refid="translation_8h_1a4f2d958035f4051a605124ebe248de38" kindref="member">_</ref>{item.release()};<sp/></highlight><highlight class="comment">/*<sp/>if<sp/>true,<sp/>queue<sp/>took<sp/>ownership<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a2c6c3e9c356e14fb4a7139acf4fa7b18" kindref="member">LogWarning</ref>(</highlight><highlight class="stringliteral">&quot;Request<sp/>rejected<sp/>because<sp/>http<sp/>work<sp/>queue<sp/>depth<sp/>exceeded,<sp/>it<sp/>can<sp/>be<sp/>increased<sp/>with<sp/>the<sp/>-rpcworkqueue=<sp/>setting&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>item-&gt;req-&gt;WriteReply(<ref refid="rpc_2protocol_8h_1ab0a9668b7d736b4d4d621ec010928a46a6251d4710923e5253b159943405a1a3a" kindref="member">HTTP_SERVICE_UNAVAILABLE</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Work<sp/>queue<sp/>depth<sp/>exceeded&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hreq-&gt;WriteReply(<ref refid="rpc_2protocol_8h_1ab0a9668b7d736b4d4d621ec010928a46a7a2f2a109c030ee9d2d5afe761232451" kindref="member">HTTP_NOT_FOUND</ref>);</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="341"><highlight class="normal">}</highlight></codeline>
<codeline lineno="342"><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>http_reject_request_cb(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>evhttp_request*<sp/>req,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*)</highlight></codeline>
<codeline lineno="345"><highlight class="normal">{</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395a67e044074f46e6cea22788527da5f02e" kindref="member">BCLog::HTTP</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Rejecting<sp/>request<sp/>while<sp/>shutting<sp/>down\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/>evhttp_send_error(req,<sp/>HTTP_SERVUNAVAIL,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="348"><highlight class="normal">}</highlight></codeline>
<codeline lineno="349"><highlight class="normal"></highlight></codeline>
<codeline lineno="351"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>ThreadHTTP(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>event_base*<sp/>base)</highlight></codeline>
<codeline lineno="352"><highlight class="normal">{</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceutil_1a0b501a2cc08ebe4c0d9073938a5a0731" kindref="member">util::ThreadRename</ref>(</highlight><highlight class="stringliteral">&quot;http&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395a67e044074f46e6cea22788527da5f02e" kindref="member">BCLog::HTTP</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Entering<sp/>http<sp/>event<sp/>loop\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/>event_base_dispatch(base);</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Event<sp/>loop<sp/>will<sp/>be<sp/>interrupted<sp/>by<sp/>InterruptHTTPServer()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395a67e044074f46e6cea22788527da5f02e" kindref="member">BCLog::HTTP</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Exited<sp/>http<sp/>event<sp/>loop\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="358"><highlight class="normal">}</highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>HTTPBindAddresses(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>evhttp*<sp/>http)</highlight></codeline>
<codeline lineno="362"><highlight class="normal">{</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/>uint16_t<sp/>http_port{</highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">uint16_t</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(<ref refid="args_8cpp_1a934b7735a5308149ab1bf3ca9fc4d694" kindref="member">gArgs</ref>.GetIntArg(</highlight><highlight class="stringliteral">&quot;-rpcport&quot;</highlight><highlight class="normal">,<sp/><ref refid="chainparamsbase_8cpp_1a06aa55e81a512bf827dd3b98ab55e1ec" kindref="member">BaseParams</ref>().RPCPort()))};</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;std::pair&lt;std::string,<sp/>uint16_t&gt;&gt;<sp/>endpoints;</highlight></codeline>
<codeline lineno="365"><highlight class="normal"></highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Determine<sp/>what<sp/>addresses<sp/>to<sp/>bind<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>To<sp/>prevent<sp/>misconfiguration<sp/>and<sp/>accidental<sp/>exposure<sp/>of<sp/>the<sp/>RPC</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>interface,<sp/>require<sp/>-rpcallowip<sp/>and<sp/>-rpcbind<sp/>to<sp/>both<sp/>be<sp/>specified</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>together.<sp/>If<sp/>either<sp/>is<sp/>missing,<sp/>ignore<sp/>both<sp/>values,<sp/>bind<sp/>to<sp/>localhost</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>instead,<sp/>and<sp/>log<sp/>warnings.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="args_8cpp_1a934b7735a5308149ab1bf3ca9fc4d694" kindref="member">gArgs</ref>.GetArgs(</highlight><highlight class="stringliteral">&quot;-rpcallowip&quot;</highlight><highlight class="normal">).empty()<sp/>||<sp/><ref refid="args_8cpp_1a934b7735a5308149ab1bf3ca9fc4d694" kindref="member">gArgs</ref>.GetArgs(</highlight><highlight class="stringliteral">&quot;-rpcbind&quot;</highlight><highlight class="normal">).empty())<sp/>{<sp/></highlight><highlight class="comment">//<sp/>Default<sp/>to<sp/>loopback<sp/>if<sp/>not<sp/>allowing<sp/>external<sp/>IPs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endpoints.emplace_back(</highlight><highlight class="stringliteral">&quot;::1&quot;</highlight><highlight class="normal">,<sp/>http_port);</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endpoints.emplace_back(</highlight><highlight class="stringliteral">&quot;127.0.0.1&quot;</highlight><highlight class="normal">,<sp/>http_port);</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="args_8cpp_1a934b7735a5308149ab1bf3ca9fc4d694" kindref="member">gArgs</ref>.GetArgs(</highlight><highlight class="stringliteral">&quot;-rpcallowip&quot;</highlight><highlight class="normal">).empty())<sp/>{</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a2c6c3e9c356e14fb4a7139acf4fa7b18" kindref="member">LogWarning</ref>(</highlight><highlight class="stringliteral">&quot;Option<sp/>-rpcallowip<sp/>was<sp/>specified<sp/>without<sp/>-rpcbind;<sp/>this<sp/>doesn&apos;t<sp/>usually<sp/>make<sp/>sense&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="args_8cpp_1a934b7735a5308149ab1bf3ca9fc4d694" kindref="member">gArgs</ref>.GetArgs(</highlight><highlight class="stringliteral">&quot;-rpcbind&quot;</highlight><highlight class="normal">).empty())<sp/>{</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a2c6c3e9c356e14fb4a7139acf4fa7b18" kindref="member">LogWarning</ref>(</highlight><highlight class="stringliteral">&quot;Option<sp/>-rpcbind<sp/>was<sp/>ignored<sp/>because<sp/>-rpcallowip<sp/>was<sp/>not<sp/>specified,<sp/>refusing<sp/>to<sp/>allow<sp/>everyone<sp/>to<sp/>connect&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{<sp/></highlight><highlight class="comment">//<sp/>Specific<sp/>bind<sp/>addresses</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>strRPCBind<sp/>:<sp/><ref refid="args_8cpp_1a934b7735a5308149ab1bf3ca9fc4d694" kindref="member">gArgs</ref>.GetArgs(</highlight><highlight class="stringliteral">&quot;-rpcbind&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint16_t<sp/>port{http_port};</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::string<sp/>host;</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="util_2strencodings_8cpp_1ad3dd865469a228a338af78c000859b4f" kindref="member">SplitHostPort</ref>(strRPCBind,<sp/>port,<sp/>host))<sp/>{</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;%s\n&quot;</highlight><highlight class="normal">,<sp/><ref refid="httpserver_8cpp_1aeb737684e2a2da0e1190fed1229d7990" kindref="member">InvalidPortErrMsg</ref>(</highlight><highlight class="stringliteral">&quot;-rpcbind&quot;</highlight><highlight class="normal">,<sp/>strRPCBind).original);</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>endpoints.emplace_back(host,<sp/>port);</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="391"><highlight class="normal"></highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Bind<sp/>addresses</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(std::vector&lt;std::pair&lt;std::string,<sp/>uint16_t&gt;<sp/>&gt;::iterator<sp/>i<sp/>=<sp/>endpoints.begin();<sp/>i<sp/>!=<sp/>endpoints.end();<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a57eb3ffc98e6ad1bdbed0a980a54c484" kindref="member">LogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Binding<sp/>RPC<sp/>on<sp/>address<sp/>%s<sp/>port<sp/>%i&quot;</highlight><highlight class="normal">,<sp/>i-&gt;first,<sp/>i-&gt;second);</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evhttp_bound_socket<sp/>*bind_handle<sp/>=<sp/>evhttp_bind_socket_with_handle(http,<sp/>i-&gt;first.empty()<sp/>?<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal"><sp/>:<sp/>i-&gt;first.c_str(),<sp/>i-&gt;second);</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(bind_handle)<sp/>{</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::optional&lt;CNetAddr&gt;<sp/>addr{<ref refid="netbase_8cpp_1a1ffa791c989b26b3f02b857bcd6bacc3" kindref="member">LookupHost</ref>(i-&gt;first,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">)};</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(i-&gt;first.empty()<sp/>||<sp/>(addr.has_value()<sp/>&amp;&amp;<sp/>addr-&gt;IsBindAny()))<sp/>{</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a2c6c3e9c356e14fb4a7139acf4fa7b18" kindref="member">LogWarning</ref>(</highlight><highlight class="stringliteral">&quot;The<sp/>RPC<sp/>server<sp/>is<sp/>not<sp/>safe<sp/>to<sp/>expose<sp/>to<sp/>untrusted<sp/>networks<sp/>such<sp/>as<sp/>the<sp/>public<sp/>internet&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>the<sp/>no-delay<sp/>option<sp/>(disable<sp/>Nagle&apos;s<sp/>algorithm)<sp/>on<sp/>the<sp/>TCP<sp/>socket.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evutil_socket_t<sp/>fd<sp/>=<sp/>evhttp_bound_socket_get_fd(bind_handle);</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>one<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(setsockopt(fd,<sp/>IPPROTO_TCP,<sp/>TCP_NODELAY,<sp/></highlight><highlight class="keyword">reinterpret_cast&lt;</highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(&amp;one),<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(one))<sp/>==<sp/><ref refid="compat_8h_1a633b0396ff93d336a088412a190a5072" kindref="member">SOCKET_ERROR</ref>)<sp/>{</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a57eb3ffc98e6ad1bdbed0a980a54c484" kindref="member">LogInfo</ref>(</highlight><highlight class="stringliteral">&quot;WARNING:<sp/>Unable<sp/>to<sp/>set<sp/>TCP_NODELAY<sp/>on<sp/>RPC<sp/>server<sp/>socket,<sp/>continuing<sp/>anyway\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>boundSockets.push_back(bind_handle);</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a2c6c3e9c356e14fb4a7139acf4fa7b18" kindref="member">LogWarning</ref>(</highlight><highlight class="stringliteral">&quot;Binding<sp/>RPC<sp/>on<sp/>address<sp/>%s<sp/>port<sp/>%i<sp/>failed.&quot;</highlight><highlight class="normal">,<sp/>i-&gt;first,<sp/>i-&gt;second);</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>!boundSockets.empty();</highlight></codeline>
<codeline lineno="413"><highlight class="normal">}</highlight></codeline>
<codeline lineno="414"><highlight class="normal"></highlight></codeline>
<codeline lineno="416"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>HTTPWorkQueueRun(<ref refid="class_work_queue" kindref="compound">WorkQueue&lt;HTTPClosure&gt;</ref>*<sp/>queue,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>worker_num)</highlight></codeline>
<codeline lineno="417"><highlight class="normal">{</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceutil_1a0b501a2cc08ebe4c0d9073938a5a0731" kindref="member">util::ThreadRename</ref>(<ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;httpworker.%i&quot;</highlight><highlight class="normal">,<sp/>worker_num));</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/>queue-&gt;<ref refid="class_work_queue_1ae3d2fdef167ad239725e54c012b89d81" kindref="member">Run</ref>();</highlight></codeline>
<codeline lineno="420"><highlight class="normal">}</highlight></codeline>
<codeline lineno="421"><highlight class="normal"></highlight></codeline>
<codeline lineno="423"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1adc86008faeaa267128da51599041a88b" kindref="member">libevent_log_cb</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>severity,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*msg)</highlight></codeline>
<codeline lineno="424"><highlight class="normal">{</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(severity)<sp/>{</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>EVENT_LOG_DEBUG:</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395aaa132022e014779cc9608a218e59dede" kindref="member">BCLog::LIBEVENT</ref>,<sp/></highlight><highlight class="stringliteral">&quot;%s&quot;</highlight><highlight class="normal">,<sp/>msg);</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>EVENT_LOG_MSG:</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a57eb3ffc98e6ad1bdbed0a980a54c484" kindref="member">LogInfo</ref>(</highlight><highlight class="stringliteral">&quot;libevent:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>msg);</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>EVENT_LOG_WARN:</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a2c6c3e9c356e14fb4a7139acf4fa7b18" kindref="member">LogWarning</ref>(</highlight><highlight class="stringliteral">&quot;libevent:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>msg);</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:<sp/></highlight><highlight class="comment">//<sp/>EVENT_LOG_ERR<sp/>and<sp/>others<sp/>are<sp/>mapped<sp/>to<sp/>error</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;libevent:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>msg);</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="439"><highlight class="normal">}</highlight></codeline>
<codeline lineno="440"><highlight class="normal"></highlight></codeline>
<codeline lineno="441"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="httpserver_8cpp_1aa5183260b12c1ce706dad5b454a44cec" kindref="member">InitHTTPServer</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classutil_1_1_signal_interrupt" kindref="compound">util::SignalInterrupt</ref>&amp;<sp/>interrupt)</highlight></codeline>
<codeline lineno="442"><highlight class="normal">{</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!InitHTTPAllowList())</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="445"><highlight class="normal"></highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Redirect<sp/>libevent&apos;s<sp/>logging<sp/>to<sp/>our<sp/>own<sp/>log</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/>event_set_log_callback(&amp;<ref refid="bitcoin-cli_8cpp_1adc86008faeaa267128da51599041a88b" kindref="member">libevent_log_cb</ref>);</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Update<sp/>libevent&apos;s<sp/>log<sp/>handling.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="httpserver_8cpp_1a5d061de02f52817cc3e5957046dbf766" kindref="member">UpdateHTTPServerLogging</ref>(<ref refid="logging_8cpp_1a7ef55b61ba6d5bb4d828041cc1cd0f39" kindref="member">LogInstance</ref>().WillLogCategory(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395aaa132022e014779cc9608a218e59dede" kindref="member">BCLog::LIBEVENT</ref>));</highlight></codeline>
<codeline lineno="450"><highlight class="normal"></highlight></codeline>
<codeline lineno="451"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>WIN32</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/>evthread_use_windows_threads();</highlight></codeline>
<codeline lineno="453"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/>evthread_use_pthreads();</highlight></codeline>
<codeline lineno="455"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="456"><highlight class="normal"></highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/>raii_event_base<sp/>base_ctr<sp/>=<sp/><ref refid="events_8h_1a823c359ddb0dce50f7dfaa233daaa9dc" kindref="member">obtain_event_base</ref>();</highlight></codeline>
<codeline lineno="458"><highlight class="normal"></highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Create<sp/>a<sp/>new<sp/>evhttp<sp/>object<sp/>to<sp/>handle<sp/>requests.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/>raii_evhttp<sp/>http_ctr<sp/>=<sp/><ref refid="events_8h_1a3b6f28cea3a0bf6bdad229bcdf096014" kindref="member">obtain_evhttp</ref>(base_ctr.get());</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">evhttp*<sp/>http<sp/>=<sp/>http_ctr.get();</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!http)<sp/>{</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;Couldn&apos;t<sp/>create<sp/>evhttp.<sp/>Exiting.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="466"><highlight class="normal"></highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/>evhttp_set_timeout(http,<sp/><ref refid="args_8cpp_1a934b7735a5308149ab1bf3ca9fc4d694" kindref="member">gArgs</ref>.GetIntArg(</highlight><highlight class="stringliteral">&quot;-rpcservertimeout&quot;</highlight><highlight class="normal">,<sp/>DEFAULT_HTTP_SERVER_TIMEOUT));</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/>evhttp_set_max_headers_size(http,<sp/>MAX_HEADERS_SIZE);</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/>evhttp_set_max_body_size(http,<sp/>MAX_SIZE);</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/>evhttp_set_gencb(http,<sp/>http_request_cb,<sp/>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*)&amp;interrupt);</highlight></codeline>
<codeline lineno="471"><highlight class="normal"></highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!HTTPBindAddresses(http))<sp/>{</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;Unable<sp/>to<sp/>bind<sp/>any<sp/>endpoint<sp/>for<sp/>RPC<sp/>server&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="476"><highlight class="normal"></highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395a67e044074f46e6cea22788527da5f02e" kindref="member">BCLog::HTTP</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Initialized<sp/>HTTP<sp/>server\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>workQueueDepth<sp/>=<sp/>std::max((</highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<ref refid="args_8cpp_1a934b7735a5308149ab1bf3ca9fc4d694" kindref="member">gArgs</ref>.GetIntArg(</highlight><highlight class="stringliteral">&quot;-rpcworkqueue&quot;</highlight><highlight class="normal">,<sp/>DEFAULT_HTTP_WORKQUEUE),<sp/>1L);</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395a67e044074f46e6cea22788527da5f02e" kindref="member">BCLog::HTTP</ref>,<sp/></highlight><highlight class="stringliteral">&quot;creating<sp/>work<sp/>queue<sp/>of<sp/>depth<sp/>%d\n&quot;</highlight><highlight class="normal">,<sp/>workQueueDepth);</highlight></codeline>
<codeline lineno="480"><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/>g_work_queue<sp/>=<sp/>std::make_unique&lt;WorkQueue&lt;HTTPClosure&gt;&gt;(workQueueDepth);</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>transfer<sp/>ownership<sp/>to<sp/>eventBase/HTTP<sp/>via<sp/>.release()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/>eventBase<sp/>=<sp/>base_ctr.release();</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/>eventHTTP<sp/>=<sp/>http_ctr.release();</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="486"><highlight class="normal">}</highlight></codeline>
<codeline lineno="487"><highlight class="normal"></highlight></codeline>
<codeline lineno="488"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="httpserver_8cpp_1a5d061de02f52817cc3e5957046dbf766" kindref="member">UpdateHTTPServerLogging</ref>(</highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>enable)<sp/>{</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(enable)<sp/>{</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>event_enable_debug_logging(EVENT_DBG_ALL);</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>event_enable_debug_logging(EVENT_DBG_NONE);</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="494"><highlight class="normal">}</highlight></codeline>
<codeline lineno="495"><highlight class="normal"></highlight></codeline>
<codeline lineno="496"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>std::thread<sp/>g_thread_http;</highlight></codeline>
<codeline lineno="497"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>std::vector&lt;std::thread&gt;<sp/>g_thread_http_workers;</highlight></codeline>
<codeline lineno="498"><highlight class="normal"></highlight></codeline>
<codeline lineno="499"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="httpserver_8cpp_1a4fd74612426e28d4678557f401066d96" kindref="member">StartHTTPServer</ref>()</highlight></codeline>
<codeline lineno="500"><highlight class="normal">{</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rpcThreads<sp/>=<sp/>std::max((</highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)<ref refid="args_8cpp_1a934b7735a5308149ab1bf3ca9fc4d694" kindref="member">gArgs</ref>.GetIntArg(</highlight><highlight class="stringliteral">&quot;-rpcthreads&quot;</highlight><highlight class="normal">,<sp/>DEFAULT_HTTP_THREADS),<sp/>1L);</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a57eb3ffc98e6ad1bdbed0a980a54c484" kindref="member">LogInfo</ref>(</highlight><highlight class="stringliteral">&quot;Starting<sp/>HTTP<sp/>server<sp/>with<sp/>%d<sp/>worker<sp/>threads\n&quot;</highlight><highlight class="normal">,<sp/>rpcThreads);</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/>g_thread_http<sp/>=<sp/>std::thread(ThreadHTTP,<sp/>eventBase);</highlight></codeline>
<codeline lineno="504"><highlight class="normal"></highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>rpcThreads;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>g_thread_http_workers.emplace_back(HTTPWorkQueueRun,<sp/>g_work_queue.get(),<sp/>i);</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="508"><highlight class="normal">}</highlight></codeline>
<codeline lineno="509"><highlight class="normal"></highlight></codeline>
<codeline lineno="510"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="httpserver_8cpp_1a0a02b6576090c9fde2eed21b9aa7dc0c" kindref="member">InterruptHTTPServer</ref>()</highlight></codeline>
<codeline lineno="511"><highlight class="normal">{</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395a67e044074f46e6cea22788527da5f02e" kindref="member">BCLog::HTTP</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Interrupting<sp/>HTTP<sp/>server\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(eventHTTP)<sp/>{</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Reject<sp/>requests<sp/>on<sp/>current<sp/>connections</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evhttp_set_gencb(eventHTTP,<sp/>http_reject_request_cb,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_work_queue)<sp/>{</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>g_work_queue-&gt;Interrupt();</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="520"><highlight class="normal">}</highlight></codeline>
<codeline lineno="521"><highlight class="normal"></highlight></codeline>
<codeline lineno="522"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="httpserver_8cpp_1ad95d08d62c15b43d52fdba7b7ecaa0aa" kindref="member">StopHTTPServer</ref>()</highlight></codeline>
<codeline lineno="523"><highlight class="normal">{</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395a67e044074f46e6cea22788527da5f02e" kindref="member">BCLog::HTTP</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Stopping<sp/>HTTP<sp/>server\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_work_queue)<sp/>{</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395a67e044074f46e6cea22788527da5f02e" kindref="member">BCLog::HTTP</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Waiting<sp/>for<sp/>HTTP<sp/>worker<sp/>threads<sp/>to<sp/>exit\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>thread<sp/>:<sp/>g_thread_http_workers)<sp/>{</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>thread.join();</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>g_thread_http_workers.clear();</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Unlisten<sp/>sockets,<sp/>these<sp/>are<sp/>what<sp/>make<sp/>the<sp/>event<sp/>loop<sp/>running,<sp/>which<sp/>means</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>that<sp/>after<sp/>this<sp/>and<sp/>all<sp/>connections<sp/>are<sp/>closed<sp/>the<sp/>event<sp/>loop<sp/>will<sp/>quit.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(evhttp_bound_socket<sp/>*socket<sp/>:<sp/>boundSockets)<sp/>{</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evhttp_del_accept_socket(eventHTTP,<sp/>socket);</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/>boundSockets.clear();</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>n_connections{g_requests.CountActiveConnections()};<sp/>n_connections<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395a67e044074f46e6cea22788527da5f02e" kindref="member">BCLog::HTTP</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Waiting<sp/>for<sp/>%d<sp/>connections<sp/>to<sp/>stop<sp/>HTTP<sp/>server\n&quot;</highlight><highlight class="normal">,<sp/>n_connections);</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>g_requests.WaitUntilEmpty();</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(eventHTTP)<sp/>{</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Schedule<sp/>a<sp/>callback<sp/>to<sp/>call<sp/>evhttp_free<sp/>in<sp/>the<sp/>event<sp/>base<sp/>thread,<sp/>so</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>that<sp/>evhttp_free<sp/>does<sp/>not<sp/>need<sp/>to<sp/>be<sp/>called<sp/>again<sp/>after<sp/>the<sp/>handling</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>of<sp/>unfinished<sp/>request<sp/>connections<sp/>that<sp/>follows.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>event_base_once(eventBase,<sp/>-1,<sp/>EV_TIMEOUT,<sp/>[](evutil_socket_t,<sp/></highlight><highlight class="keywordtype">short</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*)<sp/>{</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evhttp_free(eventHTTP);</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>eventHTTP<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(eventBase)<sp/>{</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395a67e044074f46e6cea22788527da5f02e" kindref="member">BCLog::HTTP</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Waiting<sp/>for<sp/>HTTP<sp/>event<sp/>thread<sp/>to<sp/>exit\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_thread_http.joinable())<sp/>g_thread_http.join();</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>event_base_free(eventBase);</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>eventBase<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/>g_work_queue.reset();</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395a67e044074f46e6cea22788527da5f02e" kindref="member">BCLog::HTTP</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Stopped<sp/>HTTP<sp/>server\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="561"><highlight class="normal">}</highlight></codeline>
<codeline lineno="562"><highlight class="normal"></highlight></codeline>
<codeline lineno="563"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">event_base*<sp/><ref refid="httpserver_8cpp_1a678938523347079b4dd5fabc47efdbbc" kindref="member">EventBase</ref>()</highlight></codeline>
<codeline lineno="564"><highlight class="normal">{</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>eventBase;</highlight></codeline>
<codeline lineno="566"><highlight class="normal">}</highlight></codeline>
<codeline lineno="567"><highlight class="normal"></highlight></codeline>
<codeline lineno="568"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>httpevent_callback_fn(evutil_socket_t,<sp/></highlight><highlight class="keywordtype">short</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>data)</highlight></codeline>
<codeline lineno="569"><highlight class="normal">{</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Static<sp/>handler:<sp/>simply<sp/>call<sp/>inner<sp/>handler</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_h_t_t_p_event" kindref="compound">HTTPEvent</ref><sp/>*self<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal"><ref refid="class_h_t_t_p_event" kindref="compound">HTTPEvent</ref>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(<ref refid="namespacetest__vectors__musig2__generate_1a511ae0b1c13f95e5f08f1a0dd3da3d93" kindref="member">data</ref>);</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/>self-&gt;<ref refid="class_h_t_t_p_event_1a1c8ae68ed35607285ff0ad335e122df7" kindref="member">handler</ref>();</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(self-&gt;<ref refid="class_h_t_t_p_event_1a299c642950b2e625a94f220ba8b8fbe5" kindref="member">deleteWhenTriggered</ref>)</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal"><sp/>self;</highlight></codeline>
<codeline lineno="575"><highlight class="normal">}</highlight></codeline>
<codeline lineno="576"><highlight class="normal"></highlight></codeline>
<codeline lineno="577"><highlight class="normal"><ref refid="class_h_t_t_p_event_1ae48c3a1b22e03e14ecf1a03f6f3e915b" kindref="member">HTTPEvent::HTTPEvent</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>event_base*<sp/>base,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>_deleteWhenTriggered,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::function&lt;</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">()&gt;&amp;<sp/>_handler):</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/>deleteWhenTriggered(_deleteWhenTriggered),<sp/><ref refid="rest_8cpp_1a69e29ff93cc45cfc17d3be13aa2e2182" kindref="member">handler</ref>(_handler)</highlight></codeline>
<codeline lineno="579"><highlight class="normal">{</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/>ev<sp/>=<sp/>event_new(base,<sp/>-1,<sp/>0,<sp/>httpevent_callback_fn,<sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(ev);</highlight></codeline>
<codeline lineno="582"><highlight class="normal">}</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><ref refid="class_h_t_t_p_event_1a8dd4fe1ae9499f5e8274415417d52b8f" kindref="member">HTTPEvent::~HTTPEvent</ref>()</highlight></codeline>
<codeline lineno="584"><highlight class="normal">{</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/>event_free(ev);</highlight></codeline>
<codeline lineno="586"><highlight class="normal">}</highlight></codeline>
<codeline lineno="587"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_event_1a8396615b042f37d591ff2fd8d2470c68" kindref="member">HTTPEvent::trigger</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>timeval*<sp/>tv)</highlight></codeline>
<codeline lineno="588"><highlight class="normal">{</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tv<sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>event_active(ev,<sp/>0,<sp/>0);<sp/></highlight><highlight class="comment">//<sp/>immediately<sp/>trigger<sp/>event<sp/>in<sp/>main<sp/>thread</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evtimer_add(ev,<sp/>tv);<sp/></highlight><highlight class="comment">//<sp/>trigger<sp/>after<sp/>timeval<sp/>passed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="593"><highlight class="normal">}</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><ref refid="class_h_t_t_p_request_1a695d4e0bd48770aed385799a1d3a43b0" kindref="member">HTTPRequest::HTTPRequest</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>evhttp_request*<sp/>_req,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classutil_1_1_signal_interrupt" kindref="compound">util::SignalInterrupt</ref>&amp;<sp/>interrupt,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>_replySent)</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/>:<sp/>req(_req),<sp/>m_interrupt(interrupt),<sp/>replySent(_replySent)</highlight></codeline>
<codeline lineno="596"><highlight class="normal">{</highlight></codeline>
<codeline lineno="597"><highlight class="normal">}</highlight></codeline>
<codeline lineno="598"><highlight class="normal"></highlight></codeline>
<codeline lineno="599"><highlight class="normal"><ref refid="class_h_t_t_p_request_1a2267d5cb0d2d7249ec706fab1039f515" kindref="member">HTTPRequest::~HTTPRequest</ref>()</highlight></codeline>
<codeline lineno="600"><highlight class="normal">{</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!replySent)<sp/>{</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Keep<sp/>track<sp/>of<sp/>whether<sp/>reply<sp/>was<sp/>sent<sp/>to<sp/>avoid<sp/>request<sp/>leaks</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a2c6c3e9c356e14fb4a7139acf4fa7b18" kindref="member">LogWarning</ref>(</highlight><highlight class="stringliteral">&quot;Unhandled<sp/>HTTP<sp/>request&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_h_t_t_p_request_1a4f1b66cf11060b823e7a3efa913ea89c" kindref="member">WriteReply</ref>(<ref refid="rpc_2protocol_8h_1ab0a9668b7d736b4d4d621ec010928a46ac7d2e49bfead01d65a890a2e80e5b3a6" kindref="member">HTTP_INTERNAL_SERVER_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Unhandled<sp/>request&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>evhttpd<sp/>cleans<sp/>up<sp/>the<sp/>request,<sp/>as<sp/>long<sp/>as<sp/>a<sp/>reply<sp/>was<sp/>sent.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="607"><highlight class="normal">}</highlight></codeline>
<codeline lineno="608"><highlight class="normal"></highlight></codeline>
<codeline lineno="609"><highlight class="normal">std::pair&lt;bool,<sp/>std::string&gt;<sp/><ref refid="class_h_t_t_p_request_1a9e1943c284613b342fb3e95d8f6358f9" kindref="member">HTTPRequest::GetHeader</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>hdr)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="610"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">evkeyvalq*<sp/>headers<sp/>=<sp/>evhttp_request_get_input_headers(req);</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(headers);</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>val<sp/>=<sp/>evhttp_find_header(headers,<sp/>hdr.c_str());</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(val)</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::make_pair(</highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>val);</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::make_pair(</highlight><highlight class="keyword">false</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="618"><highlight class="normal">}</highlight></codeline>
<codeline lineno="619"><highlight class="normal"></highlight></codeline>
<codeline lineno="620"><highlight class="normal">std::string<sp/><ref refid="class_h_t_t_p_request_1a9af24083ca63a8466df045fef1450fd4" kindref="member">HTTPRequest::ReadBody</ref>()</highlight></codeline>
<codeline lineno="621"><highlight class="normal">{</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">evbuffer*<sp/>buf<sp/>=<sp/>evhttp_request_get_input_buffer(req);</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!buf)</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>size<sp/>=<sp/>evbuffer_get_length(buf);</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/><ref refid="namespacetest__vectors__musig2__generate_1a511ae0b1c13f95e5f08f1a0dd3da3d93" kindref="member">data</ref><sp/>=<sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*)evbuffer_pullup(buf,<sp/>size);</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!data)<sp/></highlight><highlight class="comment">//<sp/>returns<sp/>nullptr<sp/>in<sp/>case<sp/>of<sp/>empty<sp/>buffer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/>std::string<sp/>rv(data,<sp/>size);</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/>evbuffer_drain(buf,<sp/>size);</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>rv;</highlight></codeline>
<codeline lineno="638"><highlight class="normal">}</highlight></codeline>
<codeline lineno="639"><highlight class="normal"></highlight></codeline>
<codeline lineno="640"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_1a5b0ce9b581c5594a105dc778d7e0d12e" kindref="member">HTTPRequest::WriteHeader</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>hdr,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>value)</highlight></codeline>
<codeline lineno="641"><highlight class="normal">{</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">evkeyvalq*<sp/>headers<sp/>=<sp/>evhttp_request_get_output_headers(req);</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(headers);</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/>evhttp_add_header(headers,<sp/>hdr.c_str(),<sp/>value.c_str());</highlight></codeline>
<codeline lineno="645"><highlight class="normal">}</highlight></codeline>
<codeline lineno="646"><highlight class="normal"></highlight></codeline>
<codeline lineno="652"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_1a4f1b66cf11060b823e7a3efa913ea89c" kindref="member">HTTPRequest::WriteReply</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nStatus,<sp/>std::span&lt;const<sp/>std::byte&gt;<sp/>reply)</highlight></codeline>
<codeline lineno="653"><highlight class="normal">{</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(!replySent<sp/>&amp;&amp;<sp/>req);</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(m_interrupt)<sp/>{</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_h_t_t_p_request_1a5b0ce9b581c5594a105dc778d7e0d12e" kindref="member">WriteHeader</ref>(</highlight><highlight class="stringliteral">&quot;Connection&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;close&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Send<sp/>event<sp/>to<sp/>main<sp/>http<sp/>thread<sp/>to<sp/>send<sp/>reply<sp/>message</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">evbuffer*<sp/>evb<sp/>=<sp/>evhttp_request_get_output_buffer(req);</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(evb);</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/>evbuffer_add(evb,<sp/>reply.data(),<sp/>reply.size());</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>req_copy<sp/>=<sp/>req;</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/>HTTPEvent*<sp/>ev<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>HTTPEvent(eventBase,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>[req_copy,<sp/>nStatus]{</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evhttp_send_reply(req_copy,<sp/>nStatus,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Re-enable<sp/>reading<sp/>from<sp/>the<sp/>socket.<sp/>This<sp/>is<sp/>the<sp/>second<sp/>part<sp/>of<sp/>the<sp/>libevent</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>workaround<sp/>above.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(event_get_version_number()<sp/>&gt;=<sp/>0x02010600<sp/>&amp;&amp;<sp/>event_get_version_number()<sp/>&lt;<sp/>0x02010900)<sp/>{</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evhttp_connection*<sp/>conn<sp/>=<sp/>evhttp_request_get_connection(req_copy);</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(conn)<sp/>{</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bufferevent*<sp/>bev<sp/>=<sp/>evhttp_connection_get_bufferevent(conn);</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(bev)<sp/>{</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bufferevent_enable(bev,<sp/>EV_READ<sp/>|<sp/>EV_WRITE);</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/>ev-&gt;<ref refid="class_h_t_t_p_event_1a8396615b042f37d591ff2fd8d2470c68" kindref="member">trigger</ref>(</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/>replySent<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/>req<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>transferred<sp/>back<sp/>to<sp/>main<sp/>thread</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="680"><highlight class="normal">}</highlight></codeline>
<codeline lineno="681"><highlight class="normal"></highlight></codeline>
<codeline lineno="682"><highlight class="normal"><ref refid="class_c_service" kindref="compound">CService</ref><sp/><ref refid="class_h_t_t_p_request_1a53e93f86754005bcf0b38aab4705cf33" kindref="member">HTTPRequest::GetPeer</ref>()</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="683"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/>evhttp_connection*<sp/>con<sp/>=<sp/>evhttp_request_get_connection(req);</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/>CService<sp/>peer;</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(con)<sp/>{</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>evhttp<sp/>retains<sp/>ownership<sp/>over<sp/>returned<sp/>address<sp/>string</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>address<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint16_t<sp/>port<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="690"><highlight class="normal"></highlight></codeline>
<codeline lineno="691"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>HAVE_EVHTTP_CONNECTION_GET_PEER_CONST_CHAR</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evhttp_connection_get_peer(con,<sp/>&amp;address,<sp/>&amp;port);</highlight></codeline>
<codeline lineno="693"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evhttp_connection_get_peer(con,<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal">**)&amp;address,<sp/>&amp;port);</highlight></codeline>
<codeline lineno="695"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/></highlight><highlight class="comment">//<sp/>HAVE_EVHTTP_CONNECTION_GET_PEER_CONST_CHAR</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="696"><highlight class="normal"></highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>peer<sp/>=<sp/><ref refid="netbase_8cpp_1aa0d388812dee65a6371a4bdff962dfa4" kindref="member">MaybeFlipIPv6toCJDNS</ref>(<ref refid="netbase_8cpp_1ae6fcf05041086b7dd0bb4c938b1cf92e" kindref="member">LookupNumeric</ref>(address,<sp/>port));</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>peer;</highlight></codeline>
<codeline lineno="700"><highlight class="normal">}</highlight></codeline>
<codeline lineno="701"><highlight class="normal"></highlight></codeline>
<codeline lineno="702"><highlight class="normal">std::string<sp/><ref refid="class_h_t_t_p_request_1a0e9ec0f515c6ada8362483c99ffccc50" kindref="member">HTTPRequest::GetURI</ref>()</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="703"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>evhttp_request_get_uri(req);</highlight></codeline>
<codeline lineno="705"><highlight class="normal">}</highlight></codeline>
<codeline lineno="706"><highlight class="normal"></highlight></codeline>
<codeline lineno="707"><highlight class="normal"><ref refid="class_h_t_t_p_request_1a667255974fbff6d39bc2e840d46f47e1" kindref="member">HTTPRequest::RequestMethod</ref><sp/><ref refid="class_h_t_t_p_request_1a4fd1a07ea7c4b01bf9f36ff4fef3a013" kindref="member">HTTPRequest::GetRequestMethod</ref>()</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="708"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(evhttp_request_get_command(req))<sp/>{</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>EVHTTP_REQ_GET:</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_1a667255974fbff6d39bc2e840d46f47e1a12a8dcf59c16b5aadfda3a08ba67d529" kindref="member">GET</ref>;</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>EVHTTP_REQ_POST:</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_1a667255974fbff6d39bc2e840d46f47e1a368c5bc07109370b819193871352b926" kindref="member">POST</ref>;</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>EVHTTP_REQ_HEAD:</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_1a667255974fbff6d39bc2e840d46f47e1a0b0955668575b21eb0ab2272aef49f76" kindref="member">HEAD</ref>;</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>EVHTTP_REQ_PUT:</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_1a667255974fbff6d39bc2e840d46f47e1afec39d40e8bc9e12afa614df5ddb9fa9" kindref="member">PUT</ref>;</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_h_t_t_p_request_1a667255974fbff6d39bc2e840d46f47e1a6ce26a62afab55d7606ad4e92428b30c" kindref="member">UNKNOWN</ref>;</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="721"><highlight class="normal">}</highlight></codeline>
<codeline lineno="722"><highlight class="normal"></highlight></codeline>
<codeline lineno="723"><highlight class="normal">std::optional&lt;std::string&gt;<sp/><ref refid="class_h_t_t_p_request_1a4c8d3ca82089f916e360d1d06cf09dbf" kindref="member">HTTPRequest::GetQueryParameter</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>key)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="724"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>uri{evhttp_request_get_uri(req)};</highlight></codeline>
<codeline lineno="726"><highlight class="normal"></highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="httpserver_8h_1a4b96025548083ad61a3b0847621c7a74" kindref="member">GetQueryParameterFromUri</ref>(uri,<sp/>key);</highlight></codeline>
<codeline lineno="728"><highlight class="normal">}</highlight></codeline>
<codeline lineno="729"><highlight class="normal"></highlight></codeline>
<codeline lineno="730"><highlight class="normal">std::optional&lt;std::string&gt;<sp/><ref refid="httpserver_8cpp_1a4b96025548083ad61a3b0847621c7a74" kindref="member">GetQueryParameterFromUri</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>uri,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>key)</highlight></codeline>
<codeline lineno="731"><highlight class="normal">{</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/>evhttp_uri*<sp/>uri_parsed{evhttp_uri_parse(uri)};</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!uri_parsed)<sp/>{</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/>std::runtime_error(</highlight><highlight class="stringliteral">&quot;URI<sp/>parsing<sp/>failed,<sp/>it<sp/>likely<sp/>contained<sp/>RFC<sp/>3986<sp/>invalid<sp/>characters&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>query{evhttp_uri_get_query(uri_parsed)};</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/>std::optional&lt;std::string&gt;<sp/>result;</highlight></codeline>
<codeline lineno="738"><highlight class="normal"></highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(query)<sp/>{</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Parse<sp/>the<sp/>query<sp/>string<sp/>into<sp/>a<sp/>key-value<sp/>queue<sp/>and<sp/>iterate<sp/>over<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">evkeyvalq<sp/>params_q;</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evhttp_parse_query_str(query,<sp/>&amp;params_q);</highlight></codeline>
<codeline lineno="743"><highlight class="normal"></highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>evkeyval*<sp/>param{params_q.tqh_first};<sp/>param<sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;<sp/>param<sp/>=<sp/>param-&gt;next.tqe_next)<sp/>{</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(param-&gt;key<sp/>==<sp/>key)<sp/>{</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>result<sp/>=<sp/>param-&gt;value;</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>evhttp_clear_headers(&amp;params_q);</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/>evhttp_uri_free(uri_parsed);</highlight></codeline>
<codeline lineno="753"><highlight class="normal"></highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="755"><highlight class="normal">}</highlight></codeline>
<codeline lineno="756"><highlight class="normal"></highlight></codeline>
<codeline lineno="757"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="httpserver_8cpp_1a43a4c24762a6af819e364b55820323ed" kindref="member">RegisterHTTPHandler</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string<sp/>&amp;<ref refid="rest_8cpp_1a5b41c5ae4505891e6c53e26df197e02b" kindref="member">prefix</ref>,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>exactMatch,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="httpserver_8h_1ac21c51cfc9edce52ebe847dee0571a0a" kindref="member">HTTPRequestHandler</ref><sp/>&amp;<ref refid="rest_8cpp_1a69e29ff93cc45cfc17d3be13aa2e2182" kindref="member">handler</ref>)</highlight></codeline>
<codeline lineno="758"><highlight class="normal">{</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395a67e044074f46e6cea22788527da5f02e" kindref="member">BCLog::HTTP</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Registering<sp/>HTTP<sp/>handler<sp/>for<sp/>%s<sp/>(exactmatch<sp/>%d)\n&quot;</highlight><highlight class="normal">,<sp/><ref refid="rest_8cpp_1a5b41c5ae4505891e6c53e26df197e02b" kindref="member">prefix</ref>,<sp/>exactMatch);</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(g_httppathhandlers_mutex);</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/>pathHandlers.emplace_back(<ref refid="rest_8cpp_1a5b41c5ae4505891e6c53e26df197e02b" kindref="member">prefix</ref>,<sp/>exactMatch,<sp/><ref refid="rest_8cpp_1a69e29ff93cc45cfc17d3be13aa2e2182" kindref="member">handler</ref>);</highlight></codeline>
<codeline lineno="762"><highlight class="normal">}</highlight></codeline>
<codeline lineno="763"><highlight class="normal"></highlight></codeline>
<codeline lineno="764"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="httpserver_8cpp_1a42d2567faa003c410a310a9c4e36ebdc" kindref="member">UnregisterHTTPHandler</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string<sp/>&amp;<ref refid="rest_8cpp_1a5b41c5ae4505891e6c53e26df197e02b" kindref="member">prefix</ref>,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>exactMatch)</highlight></codeline>
<codeline lineno="765"><highlight class="normal">{</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(g_httppathhandlers_mutex);</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;HTTPPathHandler&gt;::iterator<sp/>i<sp/>=<sp/>pathHandlers.begin();</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;HTTPPathHandler&gt;::iterator<sp/>iend<sp/>=<sp/>pathHandlers.end();</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(;<sp/>i<sp/>!=<sp/>iend;<sp/>++i)</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(i-&gt;prefix<sp/>==<sp/><ref refid="rest_8cpp_1a5b41c5ae4505891e6c53e26df197e02b" kindref="member">prefix</ref><sp/>&amp;&amp;<sp/>i-&gt;exactMatch<sp/>==<sp/>exactMatch)</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(i<sp/>!=<sp/>iend)</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1adeb58140a1c97947ad5d0c641415f1fc" kindref="member">LogDebug</ref>(<ref refid="namespace_b_c_log_1a2731eb4660a2a1b8dfab2a4f94ae7395a67e044074f46e6cea22788527da5f02e" kindref="member">BCLog::HTTP</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Unregistering<sp/>HTTP<sp/>handler<sp/>for<sp/>%s<sp/>(exactmatch<sp/>%d)\n&quot;</highlight><highlight class="normal">,<sp/><ref refid="rest_8cpp_1a5b41c5ae4505891e6c53e26df197e02b" kindref="member">prefix</ref>,<sp/>exactMatch);</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pathHandlers.erase(i);</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="777"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="src/httpserver.cpp"/>
  </compounddef>
</doxygen>
