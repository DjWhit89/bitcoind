<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="bech32_8cpp" kind="file" language="C++">
    <compoundname>bech32.cpp</compoundname>
    <includes refid="bech32_8h" local="no">bech32.h</includes>
    <includes refid="vector_8h" local="no">util/vector.h</includes>
    <includes local="no">array</includes>
    <includes local="no">cassert</includes>
    <includes local="no">numeric</includes>
    <includes local="no">optional</includes>
    <incdepgraph>
      <node id="1">
        <label>src/bech32.cpp</label>
        <link refid="bech32_8cpp"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>bech32.h</label>
        <link refid="bech32_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="6">
        <label>util/vector.h</label>
        <link refid="vector_8h"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="12">
        <label>array</label>
      </node>
      <node id="13">
        <label>cassert</label>
      </node>
      <node id="3">
        <label>cstdint</label>
      </node>
      <node id="7">
        <label>functional</label>
      </node>
      <node id="8">
        <label>initializer_list</label>
      </node>
      <node id="14">
        <label>numeric</label>
      </node>
      <node id="9">
        <label>optional</label>
      </node>
      <node id="4">
        <label>string</label>
      </node>
      <node id="10">
        <label>type_traits</label>
      </node>
      <node id="11">
        <label>utility</label>
      </node>
      <node id="5">
        <label>vector</label>
      </node>
    </incdepgraph>
    <innernamespace refid="namespacebech32">bech32</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2017,<sp/>2021<sp/>Pieter<sp/>Wuille</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2021-present<sp/>The<sp/>Bitcoin<sp/>Core<sp/>developers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Distributed<sp/>under<sp/>the<sp/>MIT<sp/>software<sp/>license,<sp/>see<sp/>the<sp/>accompanying</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="comment">//<sp/>file<sp/>COPYING<sp/>or<sp/>http://www.opensource.org/licenses/mit-license.php.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="bech32_8h" kindref="compound">bech32.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="vector_8h" kindref="compound">util/vector.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;array&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;cassert&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;numeric&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;optional&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight></codeline>
<codeline lineno="14" refid="namespacebech32" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">namespace<sp/></highlight><highlight class="normal"><ref refid="namespacebech32" kindref="compound">bech32</ref></highlight></codeline>
<codeline lineno="15"><highlight class="normal">{</highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="keyword">namespace</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal">{</highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/>std::vector&lt;uint8_t&gt;<sp/>data;</highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>CHARSET<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;qpzry9x8gf2tvdw0s3jn54khce6mua7l&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>int8_t<sp/>CHARSET_REV[128]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,</highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,</highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/>15,<sp/>-1,<sp/>10,<sp/>17,<sp/>21,<sp/>20,<sp/>26,<sp/>30,<sp/><sp/>7,<sp/><sp/>5,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/>-1,<sp/>29,<sp/>-1,<sp/>24,<sp/>13,<sp/>25,<sp/><sp/>9,<sp/><sp/>8,<sp/>23,<sp/>-1,<sp/>18,<sp/>22,<sp/>31,<sp/>27,<sp/>19,<sp/>-1,</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>1,<sp/><sp/>0,<sp/><sp/>3,<sp/>16,<sp/>11,<sp/>28,<sp/>12,<sp/>14,<sp/><sp/>6,<sp/><sp/>4,<sp/><sp/>2,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/>-1,<sp/>29,<sp/>-1,<sp/>24,<sp/>13,<sp/>25,<sp/><sp/>9,<sp/><sp/>8,<sp/>23,<sp/>-1,<sp/>18,<sp/>22,<sp/>31,<sp/>27,<sp/>19,<sp/>-1,</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>1,<sp/><sp/>0,<sp/><sp/>3,<sp/>16,<sp/>11,<sp/>28,<sp/>12,<sp/>14,<sp/><sp/>6,<sp/><sp/>4,<sp/><sp/>2,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1,<sp/>-1</highlight></codeline>
<codeline lineno="35"><highlight class="normal">};</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/>std::pair&lt;std::array&lt;int16_t,<sp/>1023&gt;,<sp/>std::array&lt;int16_t,<sp/>1024&gt;&gt;<sp/>GenerateGFTables()</highlight></codeline>
<codeline lineno="47"><highlight class="normal">{</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Build<sp/>table<sp/>for<sp/>GF(32).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>use<sp/>these<sp/>tables<sp/>to<sp/>perform<sp/>arithmetic<sp/>in<sp/>GF(32)<sp/>below,<sp/>when<sp/>constructing<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>tables<sp/>for<sp/>GF(1024).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/>std::array&lt;int8_t,<sp/>31&gt;<sp/>GF32_EXP{};</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/>std::array&lt;int8_t,<sp/>32&gt;<sp/>GF32_LOG{};</highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>fmod<sp/>encodes<sp/>the<sp/>defining<sp/>polynomial<sp/>of<sp/>GF(32)<sp/>over<sp/>GF(2),<sp/>x^5<sp/>+<sp/>x^3<sp/>+<sp/>1.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Because<sp/>coefficients<sp/>in<sp/>GF(2)<sp/>are<sp/>binary<sp/>digits,<sp/>the<sp/>coefficients<sp/>are<sp/>packed<sp/>as<sp/>101001.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fmod<sp/>=<sp/>41;</highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Elements<sp/>of<sp/>GF(32)<sp/>are<sp/>encoded<sp/>as<sp/>vectors<sp/>of<sp/>length<sp/>5<sp/>over<sp/>GF(2),<sp/>that<sp/>is,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>5<sp/>binary<sp/>digits.<sp/>Each<sp/>element<sp/>(b_4,<sp/>b_3,<sp/>b_2,<sp/>b_1,<sp/>b_0)<sp/>encodes<sp/>a<sp/>polynomial</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>b_4*x^4<sp/>+<sp/>b_3*x^3<sp/>+<sp/>b_2*x^2<sp/>+<sp/>b_1*x^1<sp/>+<sp/>b_0<sp/>(modulo<sp/>fmod).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>example,<sp/>00001<sp/>=<sp/>1<sp/>is<sp/>the<sp/>multiplicative<sp/>identity.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/>GF32_EXP[0]<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/>GF32_LOG[0]<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/>GF32_LOG[1]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>v<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>1;<sp/>i<sp/>&lt;<sp/>31;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Multiplication<sp/>by<sp/>x<sp/>is<sp/>the<sp/>same<sp/>as<sp/>shifting<sp/>left<sp/>by<sp/>1,<sp/>as</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>every<sp/>coefficient<sp/>of<sp/>the<sp/>polynomial<sp/>is<sp/>moved<sp/>up<sp/>one<sp/>place.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>v<sp/>=<sp/>v<sp/>&lt;&lt;<sp/>1;</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>polynomial<sp/>now<sp/>has<sp/>an<sp/>x^5<sp/>term,<sp/>we<sp/>subtract<sp/>fmod<sp/>from<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>remain<sp/>working<sp/>modulo<sp/>fmod.<sp/>Subtraction<sp/>is<sp/>the<sp/>same<sp/>as<sp/>XOR<sp/>in<sp/>characteristic</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>2<sp/>fields.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(v<sp/>&amp;<sp/>32)<sp/>v<sp/>^=<sp/>fmod;</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GF32_EXP[i]<sp/>=<sp/>v;</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GF32_LOG[v]<sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Build<sp/>table<sp/>for<sp/>GF(1024)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/>std::array&lt;int16_t,<sp/>1023&gt;<sp/>GF1024_EXP{};</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>std::array&lt;int16_t,<sp/>1024&gt;<sp/>GF1024_LOG{};</highlight></codeline>
<codeline lineno="81"><highlight class="normal"></highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/>GF1024_EXP[0]<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/>GF1024_LOG[0]<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/>GF1024_LOG[1]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="85"><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Each<sp/>element<sp/>v<sp/>of<sp/>GF(1024)<sp/>is<sp/>encoded<sp/>as<sp/>a<sp/>10<sp/>bit<sp/>integer<sp/>in<sp/>the<sp/>following<sp/>way:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>v<sp/>=<sp/>v1<sp/>||<sp/>v0<sp/>where<sp/>v0,<sp/>v1<sp/>are<sp/>5-bit<sp/>integers<sp/>(elements<sp/>of<sp/>GF(32)).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>element<sp/>(e)<sp/>is<sp/>encoded<sp/>as<sp/>1<sp/>||<sp/>0,<sp/>to<sp/>represent<sp/>1*(e)<sp/>+<sp/>0.<sp/>Every<sp/>other<sp/>element</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>a*(e)<sp/>+<sp/>b<sp/>is<sp/>represented<sp/>as<sp/>a<sp/>||<sp/>b<sp/>(a<sp/>and<sp/>b<sp/>are<sp/>both<sp/>GF(32)<sp/>elements).<sp/>Given<sp/>(v),</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>compute<sp/>(e)*(v)<sp/>by<sp/>multiplying<sp/>in<sp/>the<sp/>following<sp/>way:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>v0&apos;<sp/>=<sp/>23*v1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>v1&apos;<sp/>=<sp/>9*v1<sp/>+<sp/>v0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>e*v<sp/>=<sp/>v1&apos;<sp/>||<sp/>v0&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Where<sp/>23,<sp/>9<sp/>are<sp/>GF(32)<sp/>elements<sp/>encoded<sp/>as<sp/>described<sp/>above.<sp/>Multiplication<sp/>in<sp/>GF(32)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>is<sp/>done<sp/>using<sp/>the<sp/>log/exp<sp/>tables:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>e^x<sp/>*<sp/>e^y<sp/>=<sp/>e^(x<sp/>+<sp/>y)<sp/>so<sp/>a<sp/>*<sp/>b<sp/>=<sp/>EXP[<sp/>LOG[a]<sp/>+<sp/>LOG<sp/>[b]<sp/>]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>non-zero<sp/>a<sp/>and<sp/>b.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/>v<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>1;<sp/>i<sp/>&lt;<sp/>1023;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>v0<sp/>=<sp/>v<sp/>&amp;<sp/>31;</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>v1<sp/>=<sp/>v<sp/>&gt;&gt;<sp/>5;</highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>v0n<sp/>=<sp/>v1<sp/>?<sp/>GF32_EXP.at((GF32_LOG.at(v1)<sp/>+<sp/>GF32_LOG.at(23))<sp/>%<sp/>31)<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>v1n<sp/>=<sp/>(v1<sp/>?<sp/>GF32_EXP.at((GF32_LOG.at(v1)<sp/>+<sp/>GF32_LOG.at(9))<sp/>%<sp/>31)<sp/>:<sp/>0)<sp/>^<sp/>v0;</highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>v<sp/>=<sp/>v1n<sp/>&lt;&lt;<sp/>5<sp/>|<sp/>v0n;</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GF1024_EXP[i]<sp/>=<sp/>v;</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GF1024_LOG[v]<sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::make_pair(GF1024_EXP,<sp/>GF1024_LOG);</highlight></codeline>
<codeline lineno="115"><highlight class="normal">}</highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>tables<sp/>=<sp/>GenerateGFTables();</highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::array&lt;int16_t,<sp/>1023&gt;&amp;<sp/>GF1024_EXP<sp/>=<sp/>tables.first;</highlight></codeline>
<codeline lineno="119"><highlight class="normal"></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::array&lt;int16_t,<sp/>1024&gt;&amp;<sp/>GF1024_LOG<sp/>=<sp/>tables.second;</highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Determine<sp/>the<sp/>final<sp/>constant<sp/>to<sp/>use<sp/>for<sp/>the<sp/>specified<sp/>encoding.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal">uint32_t<sp/>EncodingConstant(<ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faa" kindref="member">Encoding</ref><sp/>encoding)<sp/>{</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(encoding<sp/>==<sp/><ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faaad4fd7223ebde09ed36b615658d29d7bc" kindref="member">Encoding::BECH32</ref><sp/>||<sp/>encoding<sp/>==<sp/><ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faaae5747421d490e83aa21f61eae1ae3778" kindref="member">Encoding::BECH32M</ref>);</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>encoding<sp/>==<sp/><ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faaad4fd7223ebde09ed36b615658d29d7bc" kindref="member">Encoding::BECH32</ref><sp/>?<sp/>1<sp/>:<sp/>0x2bc830a3;</highlight></codeline>
<codeline lineno="125"><highlight class="normal">}</highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal">uint32_t<sp/><ref refid="sketch__impl_8h_1a4f7b3f9a0c2bb6fc79c680fb2313008b" kindref="member">PolyMod</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>data&amp;<sp/>v)</highlight></codeline>
<codeline lineno="131"><highlight class="normal">{</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>input<sp/>is<sp/>interpreted<sp/>as<sp/>a<sp/>list<sp/>of<sp/>coefficients<sp/>of<sp/>a<sp/>polynomial<sp/>over<sp/>F<sp/>=<sp/>GF(32),<sp/>with<sp/>an</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>implicit<sp/>1<sp/>in<sp/>front.<sp/>If<sp/>the<sp/>input<sp/>is<sp/>[v0,v1,v2,v3,v4],<sp/>that<sp/>polynomial<sp/>is<sp/>v(x)<sp/>=</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>1*x^5<sp/>+<sp/>v0*x^4<sp/>+<sp/>v1*x^3<sp/>+<sp/>v2*x^2<sp/>+<sp/>v3*x<sp/>+<sp/>v4.<sp/>The<sp/>implicit<sp/>1<sp/>guarantees<sp/>that</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>[v0,v1,v2,...]<sp/>has<sp/>a<sp/>distinct<sp/>checksum<sp/>from<sp/>[0,v0,v1,v2,...].</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>output<sp/>is<sp/>a<sp/>30-bit<sp/>integer<sp/>whose<sp/>5-bit<sp/>groups<sp/>are<sp/>the<sp/>coefficients<sp/>of<sp/>the<sp/>remainder<sp/>of</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>v(x)<sp/>mod<sp/>g(x),<sp/>where<sp/>g(x)<sp/>is<sp/>the<sp/>Bech32<sp/>generator,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>x^6<sp/>+<sp/>{29}x^5<sp/>+<sp/>{22}x^4<sp/>+<sp/>{20}x^3<sp/>+<sp/>{21}x^2<sp/>+<sp/>{29}x<sp/>+<sp/>{18}.<sp/>g(x)<sp/>is<sp/>chosen<sp/>in<sp/>such<sp/>a<sp/>way</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>that<sp/>the<sp/>resulting<sp/>code<sp/>is<sp/>a<sp/>BCH<sp/>code,<sp/>guaranteeing<sp/>detection<sp/>of<sp/>up<sp/>to<sp/>3<sp/>errors<sp/>within<sp/>a</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>window<sp/>of<sp/>1023<sp/>characters.<sp/>Among<sp/>the<sp/>various<sp/>possible<sp/>BCH<sp/>codes,<sp/>one<sp/>was<sp/>selected<sp/>to<sp/>in</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>fact<sp/>guarantee<sp/>detection<sp/>of<sp/>up<sp/>to<sp/>4<sp/>errors<sp/>within<sp/>a<sp/>window<sp/>of<sp/>89<sp/>characters.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Note<sp/>that<sp/>the<sp/>coefficients<sp/>are<sp/>elements<sp/>of<sp/>GF(32),<sp/>here<sp/>represented<sp/>as<sp/>decimal<sp/>numbers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>between<sp/>{}.<sp/>In<sp/>this<sp/>finite<sp/>field,<sp/>addition<sp/>is<sp/>just<sp/>XOR<sp/>of<sp/>the<sp/>corresponding<sp/>numbers.<sp/>For</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>example,<sp/>{27}<sp/>+<sp/>{13}<sp/>=<sp/>{27<sp/>^<sp/>13}<sp/>=<sp/>{22}.<sp/>Multiplication<sp/>is<sp/>more<sp/>complicated,<sp/>and<sp/>requires</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>treating<sp/>the<sp/>bits<sp/>of<sp/>values<sp/>themselves<sp/>as<sp/>coefficients<sp/>of<sp/>a<sp/>polynomial<sp/>over<sp/>a<sp/>smaller<sp/>field,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>GF(2),<sp/>and<sp/>multiplying<sp/>those<sp/>polynomials<sp/>mod<sp/>a^5<sp/>+<sp/>a^3<sp/>+<sp/>1.<sp/>For<sp/>example,<sp/>{5}<sp/>*<sp/>{26}<sp/>=</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>(a^2<sp/>+<sp/>1)<sp/>*<sp/>(a^4<sp/>+<sp/>a^3<sp/>+<sp/>a)<sp/>=<sp/>(a^4<sp/>+<sp/>a^3<sp/>+<sp/>a)<sp/>*<sp/>a^2<sp/>+<sp/>(a^4<sp/>+<sp/>a^3<sp/>+<sp/>a)<sp/>=<sp/>a^6<sp/>+<sp/>a^5<sp/>+<sp/>a^4<sp/>+<sp/>a</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>=<sp/>a^3<sp/>+<sp/>1<sp/>(mod<sp/>a^5<sp/>+<sp/>a^3<sp/>+<sp/>1)<sp/>=<sp/>{9}.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>During<sp/>the<sp/>course<sp/>of<sp/>the<sp/>loop<sp/>below,<sp/>`c`<sp/>contains<sp/>the<sp/>bitpacked<sp/>coefficients<sp/>of<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>polynomial<sp/>constructed<sp/>from<sp/>just<sp/>the<sp/>values<sp/>of<sp/>v<sp/>that<sp/>were<sp/>processed<sp/>so<sp/>far,<sp/>mod<sp/>g(x).<sp/>In</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>above<sp/>example,<sp/>`c`<sp/>initially<sp/>corresponds<sp/>to<sp/>1<sp/>mod<sp/>g(x),<sp/>and<sp/>after<sp/>processing<sp/>2<sp/>inputs<sp/>of</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>v,<sp/>it<sp/>corresponds<sp/>to<sp/>x^2<sp/>+<sp/>v0*x<sp/>+<sp/>v1<sp/>mod<sp/>g(x).<sp/>As<sp/>1<sp/>mod<sp/>g(x)<sp/>=<sp/>1,<sp/>that<sp/>is<sp/>the<sp/>starting<sp/>value</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>`c`.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>following<sp/>Sage<sp/>code<sp/>constructs<sp/>the<sp/>generator<sp/>used:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>B<sp/>=<sp/>GF(2)<sp/>#<sp/>Binary<sp/>field</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>BP.&lt;b&gt;<sp/>=<sp/>B[]<sp/>#<sp/>Polynomials<sp/>over<sp/>the<sp/>binary<sp/>field</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>F_mod<sp/>=<sp/>b**5<sp/>+<sp/>b**3<sp/>+<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>F.&lt;f&gt;<sp/>=<sp/>GF(32,<sp/>modulus=F_mod,<sp/>repr=&apos;int&apos;)<sp/>#<sp/>GF(32)<sp/>definition</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>FP.&lt;x&gt;<sp/>=<sp/>F[]<sp/>#<sp/>Polynomials<sp/>over<sp/>GF(32)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>E_mod<sp/>=<sp/>x**2<sp/>+<sp/>F.fetch_int(9)*x<sp/>+<sp/>F.fetch_int(23)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>E.&lt;e&gt;<sp/>=<sp/>F.extension(E_mod)<sp/>#<sp/>GF(1024)<sp/>extension<sp/>field<sp/>definition</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>p<sp/>in<sp/>divisors(E.order()<sp/>-<sp/>1):<sp/>#<sp/>Verify<sp/>e<sp/>has<sp/>order<sp/>1023.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>assert((e**p<sp/>==<sp/>1)<sp/>==<sp/>(p<sp/>%<sp/>1023<sp/>==<sp/>0))</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>G<sp/>=<sp/>lcm([(e**i).minpoly()<sp/>for<sp/>i<sp/>in<sp/>range(997,1000)])</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>print(G)<sp/>#<sp/>Print<sp/>out<sp/>the<sp/>generator</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>It<sp/>demonstrates<sp/>that<sp/>g(x)<sp/>is<sp/>the<sp/>least<sp/>common<sp/>multiple<sp/>of<sp/>the<sp/>minimal<sp/>polynomials</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>of<sp/>3<sp/>consecutive<sp/>powers<sp/>(997,998,999)<sp/>of<sp/>a<sp/>primitive<sp/>element<sp/>(e)<sp/>of<sp/>GF(1024).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>That<sp/>guarantees<sp/>it<sp/>is,<sp/>in<sp/>fact,<sp/>the<sp/>generator<sp/>of<sp/>a<sp/>primitive<sp/>BCH<sp/>code<sp/>with<sp/>cycle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>length<sp/>1023<sp/>and<sp/>distance<sp/>4.<sp/>See<sp/>https://en.wikipedia.org/wiki/BCH_code<sp/>for<sp/>more<sp/>details.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>c<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>v_i<sp/>:<sp/>v)<sp/>{</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>want<sp/>to<sp/>update<sp/>`c`<sp/>to<sp/>correspond<sp/>to<sp/>a<sp/>polynomial<sp/>with<sp/>one<sp/>extra<sp/>term.<sp/>If<sp/>the<sp/>initial</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>value<sp/>of<sp/>`c`<sp/>consists<sp/>of<sp/>the<sp/>coefficients<sp/>of<sp/>c(x)<sp/>=<sp/>f(x)<sp/>mod<sp/>g(x),<sp/>we<sp/>modify<sp/>it<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>correspond<sp/>to<sp/>c&apos;(x)<sp/>=<sp/>(f(x)<sp/>*<sp/>x<sp/>+<sp/>v_i)<sp/>mod<sp/>g(x),<sp/>where<sp/>v_i<sp/>is<sp/>the<sp/>next<sp/>input<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>process.<sp/>Simplifying:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>c&apos;(x)<sp/>=<sp/>(f(x)<sp/>*<sp/>x<sp/>+<sp/>v_i)<sp/>mod<sp/>g(x)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>((f(x)<sp/>mod<sp/>g(x))<sp/>*<sp/>x<sp/>+<sp/>v_i)<sp/>mod<sp/>g(x)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(c(x)<sp/>*<sp/>x<sp/>+<sp/>v_i)<sp/>mod<sp/>g(x)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>c(x)<sp/>=<sp/>c0*x^5<sp/>+<sp/>c1*x^4<sp/>+<sp/>c2*x^3<sp/>+<sp/>c3*x^2<sp/>+<sp/>c4*x<sp/>+<sp/>c5,<sp/>we<sp/>want<sp/>to<sp/>compute</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>c&apos;(x)<sp/>=<sp/>(c0*x^5<sp/>+<sp/>c1*x^4<sp/>+<sp/>c2*x^3<sp/>+<sp/>c3*x^2<sp/>+<sp/>c4*x<sp/>+<sp/>c5)<sp/>*<sp/>x<sp/>+<sp/>v_i<sp/>mod<sp/>g(x)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>c0*x^6<sp/>+<sp/>c1*x^5<sp/>+<sp/>c2*x^4<sp/>+<sp/>c3*x^3<sp/>+<sp/>c4*x^2<sp/>+<sp/>c5*x<sp/>+<sp/>v_i<sp/>mod<sp/>g(x)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>c0*(x^6<sp/>mod<sp/>g(x))<sp/>+<sp/>c1*x^5<sp/>+<sp/>c2*x^4<sp/>+<sp/>c3*x^3<sp/>+<sp/>c4*x^2<sp/>+<sp/>c5*x<sp/>+<sp/>v_i</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>we<sp/>call<sp/>(x^6<sp/>mod<sp/>g(x))<sp/>=<sp/>k(x),<sp/>this<sp/>can<sp/>be<sp/>written<sp/>as</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>c&apos;(x)<sp/>=<sp/>(c1*x^5<sp/>+<sp/>c2*x^4<sp/>+<sp/>c3*x^3<sp/>+<sp/>c4*x^2<sp/>+<sp/>c5*x<sp/>+<sp/>v_i)<sp/>+<sp/>c0*k(x)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"></highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>First,<sp/>determine<sp/>the<sp/>value<sp/>of<sp/>c0:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint8_t<sp/>c0<sp/>=<sp/>c<sp/>&gt;&gt;<sp/>25;</highlight></codeline>
<codeline lineno="195"><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Then<sp/>compute<sp/>c1*x^5<sp/>+<sp/>c2*x^4<sp/>+<sp/>c3*x^3<sp/>+<sp/>c4*x^2<sp/>+<sp/>c5*x<sp/>+<sp/>v_i:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>c<sp/>=<sp/>((c<sp/>&amp;<sp/>0x1ffffff)<sp/>&lt;&lt;<sp/>5)<sp/>^<sp/>v_i;</highlight></codeline>
<codeline lineno="198"><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Finally,<sp/>for<sp/>each<sp/>set<sp/>bit<sp/>n<sp/>in<sp/>c0,<sp/>conditionally<sp/>add<sp/>{2^n}k(x).<sp/>These<sp/>constants<sp/>can<sp/>be</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>computed<sp/>using<sp/>the<sp/>following<sp/>Sage<sp/>code<sp/>(continuing<sp/>the<sp/>code<sp/>above):</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>i<sp/>in<sp/>[1,2,4,8,16]:<sp/>#<sp/>Print<sp/>out<sp/>{1,2,4,8,16}*(g(x)<sp/>mod<sp/>x^6),<sp/>packed<sp/>in<sp/>hex<sp/>integers.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>v<sp/>=<sp/>0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>for<sp/>coef<sp/>in<sp/>reversed((F.fetch_int(i)*(G<sp/>%<sp/>x**6)).coefficients(sparse=True)):</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>v<sp/>=<sp/>v*32<sp/>+<sp/>coef.integer_representation()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>print(&quot;0x%x&quot;<sp/>%<sp/>v)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c0<sp/>&amp;<sp/>1)<sp/><sp/>c<sp/>^=<sp/>0x3b6a57b2;<sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>k(x)<sp/>=<sp/>{29}x^5<sp/>+<sp/>{22}x^4<sp/>+<sp/>{20}x^3<sp/>+<sp/>{21}x^2<sp/>+<sp/>{29}x<sp/>+<sp/>{18}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c0<sp/>&amp;<sp/>2)<sp/><sp/>c<sp/>^=<sp/>0x26508e6d;<sp/></highlight><highlight class="comment">//<sp/><sp/>{2}k(x)<sp/>=<sp/>{19}x^5<sp/>+<sp/><sp/>{5}x^4<sp/>+<sp/><sp/><sp/><sp/><sp/>x^3<sp/>+<sp/><sp/>{3}x^2<sp/>+<sp/>{19}x<sp/>+<sp/>{13}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c0<sp/>&amp;<sp/>4)<sp/><sp/>c<sp/>^=<sp/>0x1ea119fa;<sp/></highlight><highlight class="comment">//<sp/><sp/>{4}k(x)<sp/>=<sp/>{15}x^5<sp/>+<sp/>{10}x^4<sp/>+<sp/><sp/>{2}x^3<sp/>+<sp/><sp/>{6}x^2<sp/>+<sp/>{15}x<sp/>+<sp/>{26}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c0<sp/>&amp;<sp/>8)<sp/><sp/>c<sp/>^=<sp/>0x3d4233dd;<sp/></highlight><highlight class="comment">//<sp/><sp/>{8}k(x)<sp/>=<sp/>{30}x^5<sp/>+<sp/>{20}x^4<sp/>+<sp/><sp/>{4}x^3<sp/>+<sp/>{12}x^2<sp/>+<sp/>{30}x<sp/>+<sp/>{29}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c0<sp/>&amp;<sp/>16)<sp/>c<sp/>^=<sp/>0x2a1462b3;<sp/></highlight><highlight class="comment">//<sp/>{16}k(x)<sp/>=<sp/>{21}x^5<sp/>+<sp/><sp/><sp/><sp/><sp/>x^4<sp/>+<sp/><sp/>{8}x^3<sp/>+<sp/>{24}x^2<sp/>+<sp/>{21}x<sp/>+<sp/>{19}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>c;</highlight></codeline>
<codeline lineno="216"><highlight class="normal">}</highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/>std::array&lt;uint32_t,<sp/>25&gt;<sp/>GenerateSyndromeConstants()<sp/>{</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/>std::array&lt;uint32_t,<sp/>25&gt;<sp/>SYNDROME_CONSTS{};</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref><sp/>=<sp/>1;<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref><sp/>&lt;<sp/>6;<sp/>++<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>)<sp/>{</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>shift<sp/>=<sp/>0;<sp/>shift<sp/>&lt;<sp/>5;<sp/>++shift)<sp/>{</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int16_t<sp/>b<sp/>=<sp/>GF1024_LOG.at(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">{1}<sp/>&lt;&lt;<sp/>shift);</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int16_t<sp/>c0<sp/>=<sp/>GF1024_EXP.at((997*<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref><sp/>+<sp/>b)<sp/>%<sp/>1023);</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int16_t<sp/>c1<sp/>=<sp/>GF1024_EXP.at((998*<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref><sp/>+<sp/>b)<sp/>%<sp/>1023);</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int16_t<sp/>c2<sp/>=<sp/>GF1024_EXP.at((999*<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref><sp/>+<sp/>b)<sp/>%<sp/>1023);</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>c<sp/>=<sp/>c2<sp/>&lt;&lt;<sp/>20<sp/>|<sp/>c1<sp/>&lt;&lt;<sp/>10<sp/>|<sp/>c0;</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ind<sp/>=<sp/>5*(<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>-1)<sp/>+<sp/>shift;</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SYNDROME_CONSTS[ind]<sp/>=<sp/>c;</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>SYNDROME_CONSTS;</highlight></codeline>
<codeline lineno="254"><highlight class="normal">}</highlight></codeline>
<codeline lineno="255"><highlight class="normal"></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/>std::array&lt;uint32_t,<sp/>25&gt;<sp/>SYNDROME_CONSTS<sp/>=<sp/>GenerateSyndromeConstants();</highlight></codeline>
<codeline lineno="256"><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal">uint32_t<sp/>Syndrome(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32_t<sp/>residue)<sp/>{</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>low<sp/>is<sp/>the<sp/>first<sp/>5<sp/>bits,<sp/>corresponding<sp/>to<sp/>the<sp/>r6<sp/>in<sp/>the<sp/>residue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>(the<sp/>constant<sp/>term<sp/>of<sp/>the<sp/>polynomial).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>low<sp/>=<sp/>residue<sp/>&amp;<sp/>0x1f;</highlight></codeline>
<codeline lineno="265"><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>begin<sp/>by<sp/>setting<sp/>s_j<sp/>=<sp/>low<sp/>=<sp/>r6<sp/>for<sp/>all<sp/>three<sp/>values<sp/>of<sp/>j,<sp/>because<sp/>these<sp/>are<sp/>unconditional.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>result<sp/>=<sp/>low<sp/>^<sp/>(low<sp/>&lt;&lt;<sp/>10)<sp/>^<sp/>(low<sp/>&lt;&lt;<sp/>20);</highlight></codeline>
<codeline lineno="268"><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Then<sp/>for<sp/>each<sp/>following<sp/>bit,<sp/>we<sp/>add<sp/>the<sp/>corresponding<sp/>precomputed<sp/>constant<sp/>if<sp/>the<sp/>bit<sp/>is<sp/>1.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>example,<sp/>0x31edd3c4<sp/>is<sp/>1100011110<sp/>1101110100<sp/>1111000100<sp/>when<sp/>unpacked<sp/>in<sp/>groups<sp/>of<sp/>10</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>bits,<sp/>corresponding<sp/>exactly<sp/>to<sp/>a^999<sp/>||<sp/>a^998<sp/>||<sp/>a^997<sp/>(matching<sp/>the<sp/>corresponding<sp/>values<sp/>in</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>GF1024_EXP<sp/>above).<sp/>In<sp/>this<sp/>way,<sp/>we<sp/>compute<sp/>all<sp/>three<sp/>values<sp/>of<sp/>s_j<sp/>for<sp/>j<sp/>in<sp/>(997,<sp/>998,<sp/>999)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>simultaneously.<sp/>Recall<sp/>that<sp/>XOR<sp/>corresponds<sp/>to<sp/>addition<sp/>in<sp/>a<sp/>characteristic<sp/>2<sp/>field.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>25;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>result<sp/>^=<sp/>((residue<sp/>&gt;&gt;<sp/>(5+i))<sp/>&amp;<sp/>1<sp/>?<sp/>SYNDROME_CONSTS.at(i)<sp/>:<sp/>0);</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="278"><highlight class="normal">}</highlight></codeline>
<codeline lineno="279"><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>LowerCase(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>c)</highlight></codeline>
<codeline lineno="282"><highlight class="normal">{</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(c<sp/>&gt;=<sp/></highlight><highlight class="charliteral">&apos;A&apos;</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>c<sp/>&lt;=<sp/></highlight><highlight class="charliteral">&apos;Z&apos;</highlight><highlight class="normal">)<sp/>?<sp/>(c<sp/>-<sp/></highlight><highlight class="charliteral">&apos;A&apos;</highlight><highlight class="normal">)<sp/>+<sp/></highlight><highlight class="charliteral">&apos;a&apos;</highlight><highlight class="normal"><sp/>:<sp/>c;</highlight></codeline>
<codeline lineno="284"><highlight class="normal">}</highlight></codeline>
<codeline lineno="285"><highlight class="normal"></highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>CheckCharacters(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>str,<sp/>std::vector&lt;int&gt;&amp;<sp/>errors)</highlight></codeline>
<codeline lineno="288"><highlight class="normal">{</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>lower<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">,<sp/>upper<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>str.size();<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>c{(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>char)(str[i])};</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>&gt;=<sp/></highlight><highlight class="charliteral">&apos;a&apos;</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>c<sp/>&lt;=<sp/></highlight><highlight class="charliteral">&apos;z&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(upper)<sp/>{</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>errors.push_back(i);</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lower<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>&gt;=<sp/></highlight><highlight class="charliteral">&apos;A&apos;</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>c<sp/>&lt;=<sp/></highlight><highlight class="charliteral">&apos;Z&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(lower)<sp/>{</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>errors.push_back(i);</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>upper<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>&lt;<sp/>33<sp/>||<sp/>c<sp/>&gt;<sp/>126)<sp/>{</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>errors.push_back(i);</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>errors.empty();</highlight></codeline>
<codeline lineno="309"><highlight class="normal">}</highlight></codeline>
<codeline lineno="310"><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal">std::vector&lt;unsigned<sp/>char&gt;<sp/>PreparePolynomialCoefficients(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>hrp,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>data&amp;<sp/>values)</highlight></codeline>
<codeline lineno="312"><highlight class="normal">{</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/>data<sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>.reserve(hrp.size()<sp/>+<sp/>1<sp/>+<sp/>hrp.size()<sp/>+<sp/>values.size()<sp/>+<sp/>CHECKSUM_SIZE);</highlight></codeline>
<codeline lineno="315"><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>hrp.size();<sp/>++i)<sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>.push_back(hrp[i]<sp/>&gt;&gt;<sp/>5);</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>.push_back(0);</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>hrp.size();<sp/>++i)<sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>.push_back(hrp[i]<sp/>&amp;<sp/>0x1f);</highlight></codeline>
<codeline lineno="320"><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>.insert(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>.end(),<sp/>values.begin(),<sp/>values.end());</highlight></codeline>
<codeline lineno="322"><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="324"><highlight class="normal">}</highlight></codeline>
<codeline lineno="325"><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"><ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faa" kindref="member">Encoding</ref><sp/>VerifyChecksum(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>hrp,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>data&amp;<sp/>values)</highlight></codeline>
<codeline lineno="328"><highlight class="normal">{</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>PolyMod<sp/>computes<sp/>what<sp/>value<sp/>to<sp/>xor<sp/>into<sp/>the<sp/>final<sp/>values<sp/>to<sp/>make<sp/>the<sp/>checksum<sp/>0.<sp/>However,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>we<sp/>required<sp/>that<sp/>the<sp/>checksum<sp/>was<sp/>0,<sp/>it<sp/>would<sp/>be<sp/>the<sp/>case<sp/>that<sp/>appending<sp/>a<sp/>0<sp/>to<sp/>a<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>list<sp/>of<sp/>values<sp/>would<sp/>result<sp/>in<sp/>a<sp/>new<sp/>valid<sp/>list.<sp/>For<sp/>that<sp/>reason,<sp/>Bech32<sp/>requires<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>resulting<sp/>checksum<sp/>to<sp/>be<sp/>1<sp/>instead.<sp/>In<sp/>Bech32m,<sp/>this<sp/>constant<sp/>was<sp/>amended.<sp/>See</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>https://gist.github.com/sipa/14c248c288c3880a3b191f978a34508e<sp/>for<sp/>details.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>enc<sp/>=<sp/>PreparePolynomialCoefficients(hrp,<sp/>values);</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32_t<sp/>check<sp/>=<sp/><ref refid="sketch__impl_8h_1a4f7b3f9a0c2bb6fc79c680fb2313008b" kindref="member">PolyMod</ref>(enc);</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(check<sp/>==<sp/>EncodingConstant(<ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faaad4fd7223ebde09ed36b615658d29d7bc" kindref="member">Encoding::BECH32</ref>))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faaad4fd7223ebde09ed36b615658d29d7bc" kindref="member">Encoding::BECH32</ref>;</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(check<sp/>==<sp/>EncodingConstant(<ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faaae5747421d490e83aa21f61eae1ae3778" kindref="member">Encoding::BECH32M</ref>))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faaae5747421d490e83aa21f61eae1ae3778" kindref="member">Encoding::BECH32M</ref>;</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faaaccc0377a8afbf50e7094f5c23a8af223" kindref="member">Encoding::INVALID</ref>;</highlight></codeline>
<codeline lineno="339"><highlight class="normal">}</highlight></codeline>
<codeline lineno="340"><highlight class="normal"></highlight></codeline>
<codeline lineno="342"><highlight class="normal">data<sp/>CreateChecksum(<ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faa" kindref="member">Encoding</ref><sp/>encoding,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>hrp,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>data&amp;<sp/>values)</highlight></codeline>
<codeline lineno="343"><highlight class="normal">{</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>enc<sp/>=<sp/>PreparePolynomialCoefficients(hrp,<sp/>values);</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/>enc.insert(enc.end(),<sp/>CHECKSUM_SIZE,<sp/>0x00);</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>mod<sp/>=<sp/><ref refid="sketch__impl_8h_1a4f7b3f9a0c2bb6fc79c680fb2313008b" kindref="member">PolyMod</ref>(enc)<sp/>^<sp/>EncodingConstant(encoding);<sp/></highlight><highlight class="comment">//<sp/>Determine<sp/>what<sp/>to<sp/>XOR<sp/>into<sp/>those<sp/>6<sp/>zeroes.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/>data<sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>(CHECKSUM_SIZE);</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>CHECKSUM_SIZE;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Convert<sp/>the<sp/>5-bit<sp/>groups<sp/>in<sp/>mod<sp/>to<sp/>checksum<sp/>values.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>[i]<sp/>=<sp/>(mod<sp/>&gt;&gt;<sp/>(5<sp/>*<sp/>(5<sp/>-<sp/>i)))<sp/>&amp;<sp/>31;</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="353"><highlight class="normal">}</highlight></codeline>
<codeline lineno="354"><highlight class="normal"></highlight></codeline>
<codeline lineno="355"><highlight class="normal">}<sp/></highlight><highlight class="comment">//<sp/>namespace</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal">std::string<sp/><ref refid="namespacebech32_1a6818280e985bfd7dab1440445cd111de" kindref="member">Encode</ref>(<ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faa" kindref="member">Encoding</ref><sp/>encoding,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>hrp,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>data&amp;<sp/>values)<sp/>{</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>ensure<sp/>that<sp/>the<sp/>HRP<sp/>is<sp/>all<sp/>lowercase.<sp/>BIP-173<sp/>and<sp/>BIP350<sp/>require<sp/>an<sp/>encoder</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>return<sp/>a<sp/>lowercase<sp/>Bech32/Bech32m<sp/>string,<sp/>but<sp/>if<sp/>given<sp/>an<sp/>uppercase<sp/>HRP,<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>result<sp/>will<sp/>always<sp/>be<sp/>invalid.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">&amp;<sp/>c<sp/>:<sp/>hrp)<sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(c<sp/>&lt;<sp/></highlight><highlight class="charliteral">&apos;A&apos;</highlight><highlight class="normal"><sp/>||<sp/>c<sp/>&gt;<sp/></highlight><highlight class="charliteral">&apos;Z&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="363"><highlight class="normal"></highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/>std::string<sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>.reserve(hrp.size()<sp/>+<sp/>1<sp/>+<sp/>values.size()<sp/>+<sp/>CHECKSUM_SIZE);</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>+=<sp/>hrp;</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>+=<sp/>SEPARATOR;</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t&amp;<sp/>i<sp/>:<sp/>values)<sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>+=<sp/>CHARSET[i];</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t&amp;<sp/>i<sp/>:<sp/>CreateChecksum(encoding,<sp/>hrp,<sp/>values))<sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>+=<sp/>CHARSET[i];</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="371"><highlight class="normal">}</highlight></codeline>
<codeline lineno="372"><highlight class="normal"></highlight></codeline>
<codeline lineno="374"><highlight class="normal"><ref refid="structbech32_1_1_decode_result" kindref="compound">DecodeResult</ref><sp/><ref refid="namespacebech32_1a550009b85f18ec84a997d97fd050bcfb" kindref="member">Decode</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>str,<sp/><ref refid="namespacebech32_1a9040836d7f805004b53cd3b2f0552f72" kindref="member">CharLimit</ref><sp/>limit)<sp/>{</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;int&gt;<sp/>errors;</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!CheckCharacters(str,<sp/>errors))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>pos<sp/>=<sp/>str.rfind(SEPARATOR);</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(str.size()<sp/>&gt;<sp/>limit)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pos<sp/>==<sp/>str.npos<sp/>||<sp/>pos<sp/>==<sp/>0<sp/>||<sp/>pos<sp/>+<sp/>CHECKSUM_SIZE<sp/>&gt;=<sp/>str.size())<sp/>{</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/>data<sp/>values(str.size()<sp/>-<sp/>1<sp/>-<sp/>pos);</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>str.size()<sp/>-<sp/>1<sp/>-<sp/>pos;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>c<sp/>=<sp/>str[i<sp/>+<sp/>pos<sp/>+<sp/>1];</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int8_t<sp/>rev<sp/>=<sp/>CHARSET_REV[c];</highlight></codeline>
<codeline lineno="386"><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rev<sp/>==<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>values[i]<sp/>=<sp/>rev;</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/>std::string<sp/>hrp;</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/>hrp.reserve(pos);</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>pos;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hrp<sp/>+=<sp/>LowerCase(str[i]);</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faa" kindref="member">Encoding</ref><sp/>result<sp/>=<sp/>VerifyChecksum(hrp,<sp/>values);</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(result<sp/>==<sp/><ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faaaccc0377a8afbf50e7094f5c23a8af223" kindref="member">Encoding::INVALID</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{result,<sp/>std::move(hrp),<sp/>data(values.begin(),<sp/>values.end()<sp/>-<sp/>CHECKSUM_SIZE)};</highlight></codeline>
<codeline lineno="400"><highlight class="normal">}</highlight></codeline>
<codeline lineno="401"><highlight class="normal"></highlight></codeline>
<codeline lineno="403"><highlight class="normal">std::pair&lt;std::string,<sp/>std::vector&lt;int&gt;&gt;<sp/><ref refid="namespacebech32_1acde21ed778864b3ec914bd49f5e31f4a" kindref="member">LocateErrors</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>str,<sp/><ref refid="namespacebech32_1a9040836d7f805004b53cd3b2f0552f72" kindref="member">CharLimit</ref><sp/>limit)<sp/>{</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;int&gt;<sp/>error_locations{};</highlight></codeline>
<codeline lineno="405"><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(str.size()<sp/>&gt;<sp/>limit)<sp/>{</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>error_locations.resize(str.size()<sp/>-<sp/>limit);</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::iota(error_locations.begin(),<sp/>error_locations.end(),<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="keywordtype">int</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(limit));</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::make_pair(</highlight><highlight class="stringliteral">&quot;Bech32<sp/>string<sp/>too<sp/>long&quot;</highlight><highlight class="normal">,<sp/>std::move(error_locations));</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="411"><highlight class="normal"></highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!CheckCharacters(str,<sp/>error_locations)){</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::make_pair(</highlight><highlight class="stringliteral">&quot;Invalid<sp/>character<sp/>or<sp/>mixed<sp/>case&quot;</highlight><highlight class="normal">,<sp/>std::move(error_locations));</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="415"><highlight class="normal"></highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>pos<sp/>=<sp/>str.rfind(SEPARATOR);</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pos<sp/>==<sp/>str.npos)<sp/>{</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::make_pair(</highlight><highlight class="stringliteral">&quot;Missing<sp/>separator&quot;</highlight><highlight class="normal">,<sp/>std::vector&lt;int&gt;{});</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pos<sp/>==<sp/>0<sp/>||<sp/>pos<sp/>+<sp/>CHECKSUM_SIZE<sp/>&gt;=<sp/>str.size())<sp/>{</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>error_locations.push_back(pos);</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::make_pair(</highlight><highlight class="stringliteral">&quot;Invalid<sp/>separator<sp/>position&quot;</highlight><highlight class="normal">,<sp/>std::move(error_locations));</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="424"><highlight class="normal"></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/>std::string<sp/>hrp;</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/>hrp.reserve(pos);</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>pos;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hrp<sp/>+=<sp/>LowerCase(str[i]);</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="430"><highlight class="normal"></highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>length<sp/>=<sp/>str.size()<sp/>-<sp/>1<sp/>-<sp/>pos;<sp/></highlight><highlight class="comment">//<sp/>length<sp/>of<sp/>data<sp/>part</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/>data<sp/>values(length);</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>pos<sp/>+<sp/>1;<sp/>i<sp/>&lt;<sp/>str.size();<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>c<sp/>=<sp/>str[i];</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int8_t<sp/>rev<sp/>=<sp/>CHARSET_REV[c];</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rev<sp/>==<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>error_locations.push_back(i);</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::make_pair(</highlight><highlight class="stringliteral">&quot;Invalid<sp/>Base<sp/>32<sp/>character&quot;</highlight><highlight class="normal">,<sp/>std::move(error_locations));</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>values[i<sp/>-<sp/>pos<sp/>-<sp/>1]<sp/>=<sp/>rev;</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="442"><highlight class="normal"></highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>attempt<sp/>error<sp/>detection<sp/>with<sp/>both<sp/>bech32<sp/>and<sp/>bech32m,<sp/>and<sp/>choose<sp/>the<sp/>one<sp/>with<sp/>the<sp/>fewest<sp/>errors</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>can&apos;t<sp/>simply<sp/>use<sp/>the<sp/>segwit<sp/>version,<sp/>because<sp/>that<sp/>may<sp/>be<sp/>one<sp/>of<sp/>the<sp/>errors</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/>std::optional&lt;Encoding&gt;<sp/>error_encoding;</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faa" kindref="member">Encoding</ref><sp/>encoding<sp/>:<sp/>{<ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faaad4fd7223ebde09ed36b615658d29d7bc" kindref="member">Encoding::BECH32</ref>,<sp/><ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faaae5747421d490e83aa21f61eae1ae3778" kindref="member">Encoding::BECH32M</ref>})<sp/>{</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;int&gt;<sp/>possible_errors;</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Recall<sp/>that<sp/>(expanded<sp/>hrp<sp/>+<sp/>values)<sp/>is<sp/>interpreted<sp/>as<sp/>a<sp/>list<sp/>of<sp/>coefficients<sp/>of<sp/>a<sp/>polynomial</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>over<sp/>GF(32).<sp/>PolyMod<sp/>computes<sp/>the<sp/>&quot;remainder&quot;<sp/>of<sp/>this<sp/>polynomial<sp/>modulo<sp/>the<sp/>generator<sp/>G(x).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>enc<sp/>=<sp/>PreparePolynomialCoefficients(hrp,<sp/>values);</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>residue<sp/>=<sp/><ref refid="sketch__impl_8h_1a4f7b3f9a0c2bb6fc79c680fb2313008b" kindref="member">PolyMod</ref>(enc)<sp/>^<sp/>EncodingConstant(encoding);</highlight></codeline>
<codeline lineno="452"><highlight class="normal"></highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>All<sp/>valid<sp/>codewords<sp/>should<sp/>be<sp/>multiples<sp/>of<sp/>G(x),<sp/>so<sp/>this<sp/>remainder<sp/>(after<sp/>XORing<sp/>with<sp/>the<sp/>encoding</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>constant)<sp/>should<sp/>be<sp/>0<sp/>-<sp/>hence<sp/>0<sp/>indicates<sp/>there<sp/>are<sp/>no<sp/>errors<sp/>present.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(residue<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>errors<sp/>are<sp/>present,<sp/>our<sp/>polynomial<sp/>must<sp/>be<sp/>of<sp/>the<sp/>form<sp/>C(x)<sp/>+<sp/>E(x)<sp/>where<sp/>C<sp/>is<sp/>the<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>codeword<sp/>(a<sp/>multiple<sp/>of<sp/>G(x)),<sp/>and<sp/>E<sp/>encodes<sp/>the<sp/>errors.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>syn<sp/>=<sp/>Syndrome(residue);</highlight></codeline>
<codeline lineno="459"><highlight class="normal"></highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Unpack<sp/>the<sp/>three<sp/>10-bit<sp/>syndrome<sp/>values</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>s0<sp/>=<sp/>syn<sp/>&amp;<sp/>0x3FF;</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>s1<sp/>=<sp/>(syn<sp/>&gt;&gt;<sp/>10)<sp/>&amp;<sp/>0x3FF;</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>s2<sp/>=<sp/>syn<sp/>&gt;&gt;<sp/>20;</highlight></codeline>
<codeline lineno="464"><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>discrete<sp/>logs<sp/>of<sp/>these<sp/>values<sp/>in<sp/>GF1024<sp/>for<sp/>more<sp/>efficient<sp/>computation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>l_s0<sp/>=<sp/>GF1024_LOG.at(s0);</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>l_s1<sp/>=<sp/>GF1024_LOG.at(s1);</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>l_s2<sp/>=<sp/>GF1024_LOG.at(s2);</highlight></codeline>
<codeline lineno="469"><highlight class="normal"></highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>First,<sp/>suppose<sp/>there<sp/>is<sp/>only<sp/>a<sp/>single<sp/>error.<sp/>Then<sp/>E(x)<sp/>=<sp/>e1*x^p1<sp/>for<sp/>some<sp/>position<sp/>p1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Then<sp/>s0<sp/>=<sp/>E((e)^997)<sp/>=<sp/>e1*(e)^(997*p1)<sp/>and<sp/>s1<sp/>=<sp/>E((e)^998)<sp/>=<sp/>e1*(e)^(998*p1)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Therefore<sp/>s1/s0<sp/>=<sp/>(e)^p1,<sp/>and<sp/>by<sp/>the<sp/>same<sp/>logic,<sp/>s2/s1<sp/>=<sp/>(e)^p1<sp/>too.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Hence,<sp/>s1^2<sp/>==<sp/>s0*s2,<sp/>which<sp/>is<sp/>exactly<sp/>the<sp/>condition<sp/>we<sp/>check<sp/>first:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(l_s0<sp/>!=<sp/>-1<sp/>&amp;&amp;<sp/>l_s1<sp/>!=<sp/>-1<sp/>&amp;&amp;<sp/>l_s2<sp/>!=<sp/>-1<sp/>&amp;&amp;<sp/>(2<sp/>*<sp/>l_s1<sp/>-<sp/>l_s2<sp/>-<sp/>l_s0<sp/>+<sp/>2046)<sp/>%<sp/>1023<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Compute<sp/>the<sp/>error<sp/>position<sp/>p1<sp/>as<sp/>l_s1<sp/>-<sp/>l_s0<sp/>=<sp/>p1<sp/>(mod<sp/>1023)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>p1<sp/>=<sp/>(l_s1<sp/>-<sp/>l_s0<sp/>+<sp/>1023)<sp/>%<sp/>1023;<sp/></highlight><highlight class="comment">//<sp/>the<sp/>+1023<sp/>ensures<sp/>it<sp/>is<sp/>positive</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>because<sp/>s0<sp/>=<sp/>e1*(e)^(997*p1),<sp/>we<sp/>get<sp/>e1<sp/>=<sp/>s0/((e)^(997*p1)).<sp/>Remember<sp/>that<sp/>(e)^1023<sp/>=<sp/>1,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>so<sp/>1/((e)^997)<sp/>=<sp/>(e)^(1023-997).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>l_e1<sp/>=<sp/>l_s0<sp/>+<sp/>(1023<sp/>-<sp/>997)<sp/>*<sp/>p1;</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Finally,<sp/>some<sp/>sanity<sp/>checks<sp/>on<sp/>the<sp/>result:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>-<sp/>The<sp/>error<sp/>position<sp/>should<sp/>be<sp/>within<sp/>the<sp/>length<sp/>of<sp/>the<sp/>data</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>-<sp/>e1<sp/>should<sp/>be<sp/>in<sp/>GF(32),<sp/>which<sp/>implies<sp/>that<sp/>e1<sp/>=<sp/>(e)^(33k)<sp/>for<sp/>some<sp/>k<sp/>(the<sp/>31<sp/>non-zero<sp/>elements</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>of<sp/>GF(32)<sp/>form<sp/>an<sp/>index<sp/>33<sp/>subgroup<sp/>of<sp/>the<sp/>1023<sp/>non-zero<sp/>elements<sp/>of<sp/>GF(1024)).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(p1<sp/>&lt;<sp/>length<sp/>&amp;&amp;<sp/>!(l_e1<sp/>%<sp/>33))<sp/>{</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Polynomials<sp/>run<sp/>from<sp/>highest<sp/>power<sp/>to<sp/>lowest,<sp/>so<sp/>the<sp/>index<sp/>p1<sp/>is<sp/>from<sp/>the<sp/>right.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>don&apos;t<sp/>return<sp/>e1<sp/>because<sp/>it<sp/>is<sp/>dangerous<sp/>to<sp/>suggest<sp/>corrections<sp/>to<sp/>the<sp/>user,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>user<sp/>should<sp/>check<sp/>the<sp/>address<sp/>themselves.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>possible_errors.push_back(str.size()<sp/>-<sp/>p1<sp/>-<sp/>1);</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Otherwise,<sp/>suppose<sp/>there<sp/>are<sp/>two<sp/>errors.<sp/>Then<sp/>E(x)<sp/>=<sp/>e1*x^p1<sp/>+<sp/>e2*x^p2.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>all<sp/>possible<sp/>first<sp/>error<sp/>positions<sp/>p1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>p1<sp/>=<sp/>0;<sp/>p1<sp/>&lt;<sp/>length;<sp/>++p1)<sp/>{</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>have<sp/>guessed<sp/>p1,<sp/>and<sp/>want<sp/>to<sp/>solve<sp/>for<sp/>p2.<sp/>Recall<sp/>that<sp/>E(x)<sp/>=<sp/>e1*x^p1<sp/>+<sp/>e2*x^p2,<sp/>so</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>s0<sp/>=<sp/>E((e)^997)<sp/>=<sp/>e1*(e)^(997^p1)<sp/>+<sp/>e2*(e)^(997*p2),<sp/>and<sp/>similar<sp/>for<sp/>s1<sp/>and<sp/>s2.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Consider<sp/>s2<sp/>+<sp/>s1*(e)^p1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>2e1*(e)^(999^p1)<sp/>+<sp/>e2*(e)^(999*p2)<sp/>+<sp/>e2*(e)^(998*p2)*(e)^p1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>e2*(e)^(999*p2)<sp/>+<sp/>e2*(e)^(998*p2)*(e)^p1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>(Because<sp/>we<sp/>are<sp/>working<sp/>in<sp/>characteristic<sp/>2.)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>e2*(e)^(998*p2)<sp/>((e)^p2<sp/>+<sp/>(e)^p1)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>s2_s1p1<sp/>=<sp/>s2<sp/>^<sp/>(s1<sp/>==<sp/>0<sp/>?<sp/>0<sp/>:<sp/>GF1024_EXP.at((l_s1<sp/>+<sp/>p1)<sp/>%<sp/>1023));</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(s2_s1p1<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>l_s2_s1p1<sp/>=<sp/>GF1024_LOG.at(s2_s1p1);</highlight></codeline>
<codeline lineno="506"><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Similarly,<sp/>s1<sp/>+<sp/>s0*(e)^p1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>e2*(e)^(997*p2)<sp/>((e)^p2<sp/>+<sp/>(e)^p1)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>s1_s0p1<sp/>=<sp/>s1<sp/>^<sp/>(s0<sp/>==<sp/>0<sp/>?<sp/>0<sp/>:<sp/>GF1024_EXP.at((l_s0<sp/>+<sp/>p1)<sp/>%<sp/>1023));</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(s1_s0p1<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>l_s1_s0p1<sp/>=<sp/>GF1024_LOG.at(s1_s0p1);</highlight></codeline>
<codeline lineno="512"><highlight class="normal"></highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>So,<sp/>putting<sp/>these<sp/>together,<sp/>we<sp/>can<sp/>compute<sp/>the<sp/>second<sp/>error<sp/>position<sp/>as</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>(e)^p2<sp/>=<sp/>(s2<sp/>+<sp/>s1^p1)/(s1<sp/>+<sp/>s0^p1)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>p2<sp/>=<sp/>log((e)^p2)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>p2<sp/>=<sp/>(l_s2_s1p1<sp/>-<sp/>l_s1_s0p1<sp/>+<sp/>1023)<sp/>%<sp/>1023;</highlight></codeline>
<codeline lineno="517"><highlight class="normal"></highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Sanity<sp/>checks<sp/>that<sp/>p2<sp/>is<sp/>a<sp/>valid<sp/>position<sp/>and<sp/>not<sp/>the<sp/>same<sp/>as<sp/>p1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(p2<sp/>&gt;=<sp/>length<sp/>||<sp/>p1<sp/>==<sp/>p2)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="520"><highlight class="normal"></highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>we<sp/>want<sp/>to<sp/>compute<sp/>the<sp/>error<sp/>values<sp/>e1<sp/>and<sp/>e2.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Similar<sp/>to<sp/>above,<sp/>we<sp/>compute<sp/>s1<sp/>+<sp/>s0*(e)^p2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>e1*(e)^(997*p1)<sp/>((e)^p1<sp/>+<sp/>(e)^p2)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>s1_s0p2<sp/>=<sp/>s1<sp/>^<sp/>(s0<sp/>==<sp/>0<sp/>?<sp/>0<sp/>:<sp/>GF1024_EXP.at((l_s0<sp/>+<sp/>p2)<sp/>%<sp/>1023));</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(s1_s0p2<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>l_s1_s0p2<sp/>=<sp/>GF1024_LOG.at(s1_s0p2);</highlight></codeline>
<codeline lineno="527"><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>And<sp/>compute<sp/>(the<sp/>log<sp/>of)<sp/>1/((e)^p1<sp/>+<sp/>(e)^p2))</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>inv_p1_p2<sp/>=<sp/>1023<sp/>-<sp/>GF1024_LOG.at(GF1024_EXP.at(p1)<sp/>^<sp/>GF1024_EXP.at(p2));</highlight></codeline>
<codeline lineno="530"><highlight class="normal"></highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Then<sp/>(s1<sp/>+<sp/>s0*(e)^p1)<sp/>*<sp/>(1/((e)^p1<sp/>+<sp/>(e)^p2)))</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>e2*(e)^(997*p2)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Then<sp/>recover<sp/>e2<sp/>by<sp/>dividing<sp/>by<sp/>(e)^(997*p2)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>l_e2<sp/>=<sp/>l_s1_s0p1<sp/>+<sp/>inv_p1_p2<sp/>+<sp/>(1023<sp/>-<sp/>997)<sp/>*<sp/>p2;</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>e2<sp/>is<sp/>in<sp/>GF(32)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(l_e2<sp/>%<sp/>33)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="537"><highlight class="normal"></highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>In<sp/>the<sp/>same<sp/>way,<sp/>(s1<sp/>+<sp/>s0*(e)^p2)<sp/>*<sp/>(1/((e)^p1<sp/>+<sp/>(e)^p2)))</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>e1*(e)^(997*p1)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>So<sp/>recover<sp/>e1<sp/>by<sp/>dividing<sp/>by<sp/>(e)^(997*p1)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>l_e1<sp/>=<sp/>l_s1_s0p2<sp/>+<sp/>inv_p1_p2<sp/>+<sp/>(1023<sp/>-<sp/>997)<sp/>*<sp/>p1;</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>e1<sp/>is<sp/>in<sp/>GF(32)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(l_e1<sp/>%<sp/>33)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="544"><highlight class="normal"></highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Again,<sp/>we<sp/>do<sp/>not<sp/>return<sp/>e1<sp/>or<sp/>e2<sp/>for<sp/>safety.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Order<sp/>the<sp/>error<sp/>positions<sp/>from<sp/>the<sp/>left<sp/>of<sp/>the<sp/>string<sp/>and<sp/>return<sp/>them</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(p1<sp/>&gt;<sp/>p2)<sp/>{</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>possible_errors.push_back(str.size()<sp/>-<sp/>p1<sp/>-<sp/>1);</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>possible_errors.push_back(str.size()<sp/>-<sp/>p2<sp/>-<sp/>1);</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>possible_errors.push_back(str.size()<sp/>-<sp/>p2<sp/>-<sp/>1);</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>possible_errors.push_back(str.size()<sp/>-<sp/>p1<sp/>-<sp/>1);</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>No<sp/>errors</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::make_pair(</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">,<sp/>std::vector&lt;int&gt;{});</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="561"><highlight class="normal"></highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(error_locations.empty()<sp/>||<sp/>(!possible_errors.empty()<sp/>&amp;&amp;<sp/>possible_errors.size()<sp/>&lt;<sp/>error_locations.size()))<sp/>{</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>error_locations<sp/>=<sp/>std::move(possible_errors);</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!error_locations.empty())<sp/>error_encoding<sp/>=<sp/>encoding;</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/>std::string<sp/>error_message<sp/>=<sp/>error_encoding<sp/>==<sp/><ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faaae5747421d490e83aa21f61eae1ae3778" kindref="member">Encoding::BECH32M</ref><sp/>?<sp/></highlight><highlight class="stringliteral">&quot;Invalid<sp/>Bech32m<sp/>checksum&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>error_encoding<sp/>==<sp/><ref refid="namespacebech32_1afb0564821f132bfe74508af8349a0faaad4fd7223ebde09ed36b615658d29d7bc" kindref="member">Encoding::BECH32</ref><sp/>?<sp/></highlight><highlight class="stringliteral">&quot;Invalid<sp/>Bech32<sp/>checksum&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;Invalid<sp/>checksum&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="570"><highlight class="normal"></highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::make_pair(error_message,<sp/>std::move(error_locations));</highlight></codeline>
<codeline lineno="572"><highlight class="normal">}</highlight></codeline>
<codeline lineno="573"><highlight class="normal"></highlight></codeline>
<codeline lineno="574"><highlight class="normal">}<sp/></highlight><highlight class="comment">//<sp/>namespace<sp/>bech32</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="src/bech32.cpp"/>
  </compounddef>
</doxygen>
