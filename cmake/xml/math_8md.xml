<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="math_8md" kind="file" language="Markdown">
    <compoundname>math.md</compoundname>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline><highlight class="normal">#<sp/>The<sp/>mathematics<sp/>of<sp/>Minisketch<sp/>sketches</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">This<sp/>is<sp/>an<sp/>unconventional<sp/>mathematical<sp/>overview<sp/>of<sp/>the<sp/>PinSketch<sp/>algorithm<sp/>without<sp/>references<sp/>to<sp/>coding<sp/>theory&lt;sup&gt;[[1]](#myfootnote1)&lt;/sup&gt;.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>Set<sp/>sketches</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">A<sp/>sketch,<sp/>for<sp/>the<sp/>purpose<sp/>of<sp/>this<sp/>description,<sp/>can<sp/>be<sp/>seen<sp/>as<sp/>a<sp/>&quot;set<sp/>checksum&quot;<sp/>with<sp/>two<sp/>peculiar<sp/>properties:</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">*<sp/>Sketches<sp/>have<sp/>a<sp/>predetermined<sp/>capacity,<sp/>and<sp/>when<sp/>the<sp/>number<sp/>of<sp/>elements<sp/>in<sp/>the<sp/>set<sp/>is<sp/>not<sp/>higher<sp/>than<sp/>the<sp/>capacity,<sp/>minisketch<sp/>will<sp/>always<sp/>recover<sp/>the<sp/>entire<sp/>set<sp/>from<sp/>the<sp/>sketch.<sp/>A<sp/>sketch<sp/>of<sp/>*b*-bit<sp/>elements<sp/>with<sp/>capacity<sp/>*c*<sp/>can<sp/>be<sp/>stored<sp/>in<sp/>*bc*<sp/>bits.</highlight></codeline>
<codeline><highlight class="normal">*<sp/>The<sp/>sketches<sp/>of<sp/>two<sp/>sets<sp/>can<sp/>be<sp/>combined<sp/>by<sp/>adding<sp/>them<sp/>(XOR)<sp/>to<sp/>obtain<sp/>a<sp/>sketch<sp/>of<sp/>the<sp/>[symmetric<sp/>difference](https://en.wikipedia.org/wiki/Symmetric_difference)<sp/>between<sp/>the<sp/>two<sp/>sets<sp/>(*i.e.*,<sp/>all<sp/>elements<sp/>that<sp/>occur<sp/>in<sp/>one<sp/>but<sp/>not<sp/>both<sp/>input<sp/>sets).</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">This<sp/>overview<sp/>explains<sp/>how<sp/>sets<sp/>can<sp/>be<sp/>converted<sp/>into<sp/>a<sp/>sketch<sp/>and<sp/>how<sp/>a<sp/>set<sp/>can<sp/>be<sp/>recovered<sp/>from<sp/>a<sp/>sketch.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>From<sp/>field<sp/>elements<sp/>to<sp/>sketches</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">**Data<sp/>entries<sp/>as<sp/>field<sp/>elements**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">Every<sp/>integer<sp/>in<sp/>the<sp/>range<sp/>*[1...2&lt;sup&gt;b&lt;/sup&gt;-1]*<sp/>(the<sp/>acceptable<sp/>data<sp/>elements<sp/>for<sp/>a<sp/>Minisketch<sp/>sketch<sp/>with<sp/>field<sp/>size<sp/>*b*)<sp/>can<sp/>be<sp/>mapped<sp/>to<sp/>a<sp/>nonzero<sp/>field<sp/>element<sp/>of<sp/>*GF(2&lt;sup&gt;b&lt;/sup&gt;)*.<sp/>In<sp/>this<sp/>[finite<sp/>field](https://en.wikipedia.org/wiki/Finite_field),<sp/>we<sp/>can<sp/>add<sp/>and<sp/>multiply<sp/>elements<sp/>together,<sp/>with<sp/>many<sp/>of<sp/>the<sp/>expected<sp/>properties<sp/>for<sp/>those<sp/>operations.<sp/>Addition<sp/>(and<sp/>subtraction!)<sp/>of<sp/>field<sp/>elements<sp/>corresponds<sp/>to<sp/>bitwise<sp/>XOR<sp/>of<sp/>the<sp/>integers<sp/>they<sp/>correspond<sp/>to,<sp/>though<sp/>multiplication<sp/>is<sp/>more<sp/>involved.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">**Sets<sp/>as<sp/>power<sp/>series**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">We<sp/>define<sp/>a<sp/>function<sp/>*S*<sp/>which<sp/>maps<sp/>field<sp/>elements<sp/>*m*<sp/>to<sp/>the<sp/>following<sp/>[formal<sp/>power<sp/>series](https://en.wikipedia.org/wiki/Formal_power_series)<sp/>(similar<sp/>to<sp/>a<sp/>polynomial,<sp/>except<sp/>there<sp/>can<sp/>be<sp/>an<sp/>infinite<sp/>number<sp/>of<sp/>terms,<sp/>and<sp/>we<sp/>don&apos;t<sp/>care<sp/>about<sp/>concepts<sp/>like<sp/>convergence<sp/>as<sp/>we&apos;re<sp/>never<sp/>going<sp/>to<sp/>actually<sp/>evaluate<sp/>it<sp/>for<sp/>a<sp/>specific<sp/>value<sp/>of<sp/>*x*):</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">*<sp/>*S(m)<sp/>=<sp/>1<sp/>+<sp/>mx<sp/>+<sp/>m&lt;sup&gt;2&lt;/sup&gt;x&lt;sup&gt;2&lt;/sup&gt;<sp/>+<sp/>m&lt;sup&gt;3&lt;/sup&gt;x&lt;sup&gt;3&lt;/sup&gt;<sp/>+<sp/>...*.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">We<sp/>then<sp/>extend<sp/>this<sp/>function<sp/>to<sp/>operate<sp/>on<sp/>sets<sp/>of<sp/>field<sp/>elements,<sp/>by<sp/>adding<sp/>together<sp/>the<sp/>images<sp/>of<sp/>every<sp/>set<sp/>element.<sp/>If<sp/>*M<sp/>=<sp/>{m&lt;sub&gt;1&lt;/sub&gt;,<sp/>m&lt;sub&gt;2&lt;/sub&gt;,<sp/>...<sp/>}*:</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">*<sp/>*S(M)<sp/>=<sp/>S({m&lt;sub&gt;1&lt;/sub&gt;,m&lt;sub&gt;2&lt;/sub&gt;,...})<sp/>=<sp/>S(m&lt;sub&gt;1&lt;/sub&gt;)<sp/>+<sp/>S(m&lt;sub&gt;2&lt;/sub&gt;)<sp/>+<sp/>...<sp/>=<sp/>(1<sp/>+<sp/>1<sp/>+<sp/>...)<sp/>+<sp/>(m&lt;sub&gt;1&lt;/sub&gt;<sp/>+<sp/>m&lt;sub&gt;2&lt;/sub&gt;<sp/>+<sp/>...)x<sp/>+<sp/>(m&lt;sub&gt;1&lt;/sub&gt;&lt;sup&gt;2&lt;/sup&gt;<sp/>+<sp/>m&lt;sub&gt;2&lt;/sub&gt;&lt;sup&gt;2&lt;/sup&gt;<sp/>+<sp/>...)x&lt;sup&gt;2&lt;/sup&gt;<sp/>+<sp/>(m&lt;sub&gt;1&lt;/sub&gt;&lt;sup&gt;3&lt;/sup&gt;<sp/>+<sp/>...*</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">Because<sp/>in<sp/>our<sp/>field<sp/>addition<sp/>corresponds<sp/>to<sp/>XOR<sp/>of<sp/>integers,<sp/>it<sp/>holds<sp/>for<sp/>every<sp/>*a*<sp/>that<sp/>*a<sp/>+<sp/>a<sp/>=<sp/>0*.<sp/>This<sp/>carries<sp/>over<sp/>to<sp/>the<sp/>*S*<sp/>function,<sp/>meaning<sp/>that<sp/>*S(a)<sp/>+<sp/>S(a)<sp/>=<sp/>0*<sp/>for<sp/>every<sp/>*a*.<sp/>This<sp/>means<sp/>that<sp/>the<sp/>coefficients<sp/>of<sp/>these<sp/>power<sp/>series<sp/>have<sp/>the<sp/>second<sp/>of<sp/>the<sp/>properties<sp/>we</highlight></codeline>
<codeline><highlight class="normal">desire<sp/>from<sp/>a<sp/>sketch,<sp/>namely<sp/>that<sp/>an<sp/>efficient<sp/>operation<sp/>exists<sp/>to</highlight></codeline>
<codeline><highlight class="normal">combine<sp/>two<sp/>sketches<sp/>such<sp/>that<sp/>the<sp/>result<sp/>is<sp/>a<sp/>sketch<sp/>of<sp/>the<sp/>symmetric</highlight></codeline>
<codeline><highlight class="normal">difference<sp/>of<sp/>the<sp/>sets.<sp/>It<sp/>holds<sp/>that</highlight></codeline>
<codeline><highlight class="normal">*S({m&lt;sub&gt;1&lt;/sub&gt;,m&lt;sub&gt;2&lt;/sub&gt;})<sp/>+<sp/>S({m&lt;sub&gt;2&lt;/sub&gt;,m&lt;sub&gt;3&lt;/sub&gt;})<sp/>=<sp/>S(m&lt;sub&gt;1&lt;/sub&gt;)<sp/>+<sp/>(S(m&lt;sub&gt;2&lt;/sub&gt;)<sp/>+<sp/>S(m&lt;sub&gt;2&lt;/sub&gt;))<sp/>+<sp/>S(m&lt;sub&gt;3&lt;/sub&gt;)<sp/>=<sp/>S(m&lt;sub&gt;1&lt;/sub&gt;)<sp/>+<sp/>S(m&lt;sub&gt;3&lt;/sub&gt;)<sp/>=<sp/>S({m&lt;sub&gt;1&lt;/sub&gt;,m&lt;sub&gt;3&lt;/sub&gt;})*.<sp/>The<sp/>question<sp/>is<sp/>whether<sp/>we<sp/>can<sp/>also<sp/>efficiently<sp/>recover<sp/>the<sp/>elements<sp/>from<sp/>their<sp/>power<sp/>series&apos;<sp/>coefficients.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">**An<sp/>infinity<sp/>of<sp/>coefficients<sp/>is<sp/>hard**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">To<sp/>make<sp/>reasoning<sp/>about<sp/>these<sp/>power<sp/>series<sp/>easier,<sp/>notice<sp/>that<sp/>the<sp/>series<sp/>for<sp/>a<sp/>single<sp/>element<sp/>is<sp/>in<sp/>fact<sp/>a<sp/>[geometric<sp/>series](https://en.wikipedia.org/wiki/Geometric_series).<sp/>If<sp/>we<sp/>were<sp/>working<sp/>over<sp/>real<sp/>numbers<sp/>rather<sp/>than<sp/>a<sp/>finite<sp/>field<sp/>and<sp/>*|mx|<sp/>&lt;<sp/>1*,<sp/>it<sp/>would<sp/>converge<sp/>to<sp/>*(1<sp/>-<sp/>mx)&lt;sup&gt;-1&lt;/sup&gt;*.<sp/>Convergence<sp/>has<sp/>no<sp/>meaning<sp/>in<sp/>formal<sp/>power<sp/>series,<sp/>however<sp/>it<sp/>is<sp/>still<sp/>the<sp/>case<sp/>that:</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">*<sp/>*(1<sp/>-<sp/>mx)<sp/>S(m)<sp/>=<sp/>1*</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">You<sp/>can<sp/>verify<sp/>this<sp/>by<sp/>seeing<sp/>that<sp/>every<sp/>coefficient<sp/>except<sp/>the<sp/>constant<sp/>one<sp/>gets<sp/>cancelled<sp/>out<sp/>by<sp/>the<sp/>multiplication.<sp/>This<sp/>can<sp/>be<sp/>generalized<sp/>to<sp/>the<sp/>series<sp/>for<sp/>multiple<sp/>set<sp/>elements.<sp/>For<sp/>two<sp/>elements<sp/>we<sp/>have:</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">*<sp/>*(1<sp/>-<sp/>m&lt;sub&gt;1&lt;/sub&gt;x)<sp/>(1<sp/>-<sp/>m&lt;sub&gt;2&lt;/sub&gt;x)<sp/>S({m&lt;sub&gt;1&lt;/sub&gt;,m&lt;sub&gt;2&lt;/sub&gt;})<sp/>=<sp/>(1<sp/>-<sp/>m&lt;sub&gt;1&lt;/sub&gt;x)<sp/>(1<sp/>-<sp/>m&lt;sub&gt;2&lt;/sub&gt;x)<sp/>(S(m&lt;sub&gt;1&lt;/sub&gt;)<sp/>+<sp/>S(m&lt;sub&gt;2&lt;/sub&gt;))<sp/>=<sp/>(1<sp/>-<sp/>m&lt;sub&gt;2&lt;/sub&gt;x)<sp/>+<sp/>(1<sp/>-<sp/>m&lt;sub&gt;1&lt;/sub&gt;x)*</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">And<sp/>for<sp/>three:</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">*<sp/>*(1<sp/>-<sp/>m&lt;sub&gt;1&lt;/sub&gt;x)<sp/>(1<sp/>-<sp/>m&lt;sub&gt;2&lt;/sub&gt;x)<sp/>(1<sp/>-<sp/>m&lt;sub&gt;3&lt;/sub&gt;x)<sp/>S({m&lt;sub&gt;1&lt;/sub&gt;,m&lt;sub&gt;2&lt;/sub&gt;,m&lt;sub&gt;3&lt;/sub&gt;})<sp/>=<sp/>(1<sp/>-<sp/>m&lt;sub&gt;1&lt;/sub&gt;x)<sp/>(1<sp/>-<sp/>m&lt;sub&gt;2&lt;/sub&gt;x)<sp/>(1<sp/>-<sp/>m&lt;sub&gt;3&lt;/sub&gt;x)<sp/>(S(m&lt;sub&gt;1&lt;/sub&gt;)<sp/>+<sp/>S(m&lt;sub&gt;2&lt;/sub&gt;)<sp/>+<sp/>S(m&lt;sub&gt;3&lt;/sub&gt;))<sp/>=<sp/>(1<sp/>-<sp/>m&lt;sub&gt;2&lt;/sub&gt;x)(1<sp/>-<sp/>m&lt;sub&gt;3&lt;/sub&gt;x)<sp/>+<sp/>(1<sp/>-<sp/>m&lt;sub&gt;1&lt;/sub&gt;x)(1<sp/>-<sp/>m&lt;sub&gt;3&lt;/sub&gt;x)<sp/>+<sp/>(1<sp/>-<sp/>m&lt;sub&gt;1&lt;/sub&gt;x)(1<sp/>-<sp/>m&lt;sub&gt;2&lt;/sub&gt;x)*</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">In<sp/>each<sp/>case,<sp/>we<sp/>notice<sp/>that<sp/>multiplying<sp/>*S(M)*<sp/>with<sp/>*(1<sp/>-<sp/>m&lt;sub&gt;i&lt;/sub&gt;x)*<sp/>for<sp/>each<sp/>element<sp/>*m&lt;sub&gt;i&lt;/sub&gt;<sp/>&amp;isin;<sp/>M*<sp/>results<sp/>in<sp/>a<sp/>polynomial<sp/>of<sp/>degree<sp/>*n-1*.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">**Solving<sp/>for<sp/>the<sp/>set<sp/>elements**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">The<sp/>above<sp/>insight<sp/>lets<sp/>us<sp/>build<sp/>a<sp/>solver<sp/>that<sp/>extracts<sp/>the<sp/>set<sp/>elements<sp/>from<sp/>the<sp/>coefficients<sp/>of<sp/>a<sp/>power<sp/>series.<sp/>If<sp/>we<sp/>can<sp/>find<sp/>a<sp/>polynomial<sp/>*L*<sp/>that<sp/>is<sp/>the<sp/>product<sp/>of<sp/>*n*<sp/>different<sp/>*(1<sp/>-<sp/>m&lt;sub&gt;i&lt;/sub&gt;x)*<sp/>factors<sp/>for<sp/>various<sp/>values<sp/>of<sp/>*m&lt;sub&gt;i&lt;/sub&gt;*,<sp/>such<sp/>that<sp/>*P<sp/>=<sp/>S(M)L*<sp/>is<sp/>an<sp/>*n-1*<sp/>degree<sp/>polynomial,<sp/>then<sp/>those<sp/>values<sp/>*m&lt;sub&gt;i&lt;/sub&gt;*<sp/>are<sp/>the<sp/>elements<sp/>of<sp/>*M*.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">The<sp/>coefficients<sp/>of<sp/>*P*<sp/>are<sp/>nontrivial<sp/>expressions<sp/>of<sp/>the<sp/>set<sp/>elements<sp/>themselves.<sp/>However,<sp/>we<sp/>can<sp/>just<sp/>focus<sp/>on<sp/>the<sp/>coefficients<sp/>of<sp/>degree<sp/>*n*<sp/>and<sp/>higher<sp/>in<sp/>*P*,<sp/>as<sp/>those<sp/>are<sp/>all<sp/>0.<sp/>Let<sp/>*s&lt;sub&gt;i&lt;/sub&gt;*<sp/>be<sp/>the<sp/>coefficients<sp/>of<sp/>*S(M)*,<sp/>and<sp/>*l&lt;sub&gt;i&lt;/sub&gt;*<sp/>the<sp/>coefficients<sp/>of<sp/>L.<sp/>In<sp/>other<sp/>words,<sp/>*S(M)<sp/>=<sp/>s&lt;sub&gt;0&lt;/sub&gt;<sp/>+<sp/>s&lt;sub&gt;1&lt;/sub&gt;x<sp/>+<sp/>s&lt;sub&gt;2&lt;/sub&gt;x&lt;sup&gt;2&lt;/sup&gt;<sp/>+<sp/>s&lt;sub&gt;3&lt;/sub&gt;x&lt;sup&gt;3&lt;/sup&gt;<sp/>+<sp/>...*<sp/>and<sp/>*L<sp/>=<sp/>l&lt;sub&gt;0&lt;/sub&gt;<sp/>+<sp/>l&lt;sub&gt;1&lt;/sub&gt;x<sp/>+<sp/>l&lt;sub&gt;2&lt;/sub&gt;x&lt;sup&gt;2&lt;/sup&gt;<sp/>+<sp/>l&lt;sub&gt;3&lt;/sub&gt;x&lt;sup&gt;3&lt;/sup&gt;<sp/>+<sp/>...<sp/>+<sp/>l&lt;sub&gt;n&lt;/sub&gt;x&lt;sup&gt;n&lt;/sup&gt;*.<sp/>Note<sp/>that<sp/>*l&lt;sub&gt;0&lt;/sub&gt;<sp/>=<sp/>1*,<sp/>as<sp/>it<sp/>is<sp/>the<sp/>product<sp/>of<sp/>all<sp/>the<sp/>*1*<sp/>terms<sp/>in<sp/>the<sp/>*(1<sp/>-<sp/>m&lt;sub&gt;i&lt;/sub&gt;x)*<sp/>factors.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">Here<sp/>are<sp/>the<sp/>equations<sp/>for<sp/>the<sp/>coefficients<sp/>of<sp/>*S(M)L*<sp/>of<sp/>degree<sp/>*n+1*<sp/>through<sp/>*2n*:</highlight></codeline>
<codeline><highlight class="normal">*<sp/>*s&lt;sub&gt;n+1&lt;/sub&gt;<sp/>+<sp/>s&lt;sub&gt;n+0&lt;/sub&gt;l&lt;sub&gt;1&lt;/sub&gt;<sp/>+<sp/>s&lt;sub&gt;n-1&lt;/sub&gt;l&lt;sub&gt;2&lt;/sub&gt;<sp/>+<sp/>s&lt;sub&gt;n-2&lt;/sub&gt;l&lt;sub&gt;3&lt;/sub&gt;<sp/>+<sp/>...<sp/>+<sp/>s&lt;sub&gt;1&lt;/sub&gt;l&lt;sub&gt;n&lt;/sub&gt;<sp/>=<sp/>0*</highlight></codeline>
<codeline><highlight class="normal">*<sp/>*s&lt;sub&gt;n+2&lt;/sub&gt;<sp/>+<sp/>s&lt;sub&gt;n+1&lt;/sub&gt;l&lt;sub&gt;1&lt;/sub&gt;<sp/>+<sp/>s&lt;sub&gt;n+0&lt;/sub&gt;l&lt;sub&gt;2&lt;/sub&gt;<sp/>+<sp/>s&lt;sub&gt;n-1&lt;/sub&gt;l&lt;sub&gt;3&lt;/sub&gt;<sp/>+<sp/>...<sp/>+<sp/>s&lt;sub&gt;2&lt;/sub&gt;l&lt;sub&gt;n&lt;/sub&gt;<sp/>=<sp/>0*</highlight></codeline>
<codeline><highlight class="normal">*<sp/>*s&lt;sub&gt;n+3&lt;/sub&gt;<sp/>+<sp/>s&lt;sub&gt;n+2&lt;/sub&gt;l&lt;sub&gt;1&lt;/sub&gt;<sp/>+<sp/>s&lt;sub&gt;n+1&lt;/sub&gt;l&lt;sub&gt;2&lt;/sub&gt;<sp/>+<sp/>s&lt;sub&gt;n+0&lt;/sub&gt;l&lt;sub&gt;3&lt;/sub&gt;<sp/>+<sp/>...<sp/>+<sp/>s&lt;sub&gt;3&lt;/sub&gt;l&lt;sub&gt;n&lt;/sub&gt;<sp/>=<sp/>0*</highlight></codeline>
<codeline><highlight class="normal">*<sp/>...</highlight></codeline>
<codeline><highlight class="normal">*<sp/>*s&lt;sub&gt;2n&lt;/sub&gt;<sp/>+<sp/>s&lt;sub&gt;2n-1&lt;/sub&gt;l&lt;sub&gt;1&lt;/sub&gt;<sp/>+<sp/>s&lt;sub&gt;2n-2&lt;/sub&gt;l&lt;sub&gt;2&lt;/sub&gt;<sp/>+<sp/>s&lt;sub&gt;2n-3&lt;/sub&gt;l&lt;sub&gt;3&lt;/sub&gt;<sp/>+<sp/>...<sp/>+<sp/>s&lt;sub&gt;n&lt;/sub&gt;l&lt;sub&gt;n&lt;/sub&gt;<sp/>=<sp/>0*</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">These<sp/>are<sp/>*n*<sp/>linear<sp/>equations<sp/>with<sp/>*n*<sp/>unknowns<sp/>(the<sp/>*l&lt;sub&gt;i&lt;sub&gt;*</highlight></codeline>
<codeline><highlight class="normal">values,<sp/>for<sp/>*i=1..n*),<sp/>which<sp/>can<sp/>be<sp/>solved<sp/>using<sp/>[Gaussian<sp/>elimination](https://en.wikipedia.org/wiki/Gaussian_elimination).<sp/>After<sp/>doing<sp/>so,</highlight></codeline>
<codeline><highlight class="normal">we<sp/>have<sp/>the<sp/>coefficients<sp/>of<sp/>*L*,<sp/>which<sp/>can<sp/>then<sp/>be<sp/>[factored](https://en.wikipedia.org/wiki/Factorization_of_polynomials_over_finite_fields)</highlight></codeline>
<codeline><highlight class="normal">into<sp/>first<sp/>degree<sp/>factors<sp/>of<sp/>the<sp/>form<sp/>*(1<sp/>-<sp/>m&lt;sub&gt;i&lt;/sub&gt;x)*.<sp/>The<sp/>resulting<sp/>*m*<sp/>values<sp/>are<sp/>our<sp/>set<sp/>elements.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">**Putting<sp/>it<sp/>all<sp/>together**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">Interestingly,<sp/>only<sp/>*2n*<sp/>coefficients<sp/>of<sp/>*S(M)*<sp/>were<sp/>needed<sp/>for<sp/>solving</highlight></codeline>
<codeline><highlight class="normal">the<sp/>set<sp/>of<sp/>equations<sp/>above.<sp/>This<sp/>means<sp/>we<sp/>have<sp/>our<sp/>answer:<sp/>the</highlight></codeline>
<codeline><highlight class="normal">coefficients<sp/>*1*<sp/>through<sp/>*2n*<sp/>of<sp/>*S(M)*,<sp/>or<sp/>the<sp/>list</highlight></codeline>
<codeline><highlight class="normal">*[m&lt;sub&gt;1&lt;/sub&gt;<sp/>+<sp/>m&lt;sub&gt;2&lt;/sub&gt;<sp/>+<sp/>...,<sp/>m&lt;sub&gt;1&lt;/sub&gt;&lt;sup&gt;2&lt;/sup&gt;<sp/>+<sp/>m&lt;sub&gt;2&lt;/sub&gt;&lt;sup&gt;2&lt;/sup&gt;<sp/>+<sp/>...,<sp/>...,<sp/>m&lt;sub&gt;1&lt;/sub&gt;&lt;sup&gt;2n&lt;/sup&gt;<sp/>+<sp/>m&lt;sub&gt;2&lt;/sub&gt;&lt;sup&gt;2n&lt;/sup&gt;<sp/>+<sp/>...]*</highlight></codeline>
<codeline><highlight class="normal">functions<sp/>as<sp/>a<sp/>sketch,<sp/>satisfying<sp/>the<sp/>two<sp/>properties<sp/>we<sp/>want:</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">*<sp/>Sketches<sp/>can<sp/>be<sp/>combined<sp/>to<sp/>form<sp/>the<sp/>sketch<sp/>of<sp/>their<sp/>symmetric<sp/>difference,<sp/>by<sp/>simply<sp/>pairwise<sp/>adding<sp/>the<sp/>list<sp/>elements<sp/>together.</highlight></codeline>
<codeline><highlight class="normal">*<sp/>With<sp/>*2n*<sp/>list<sp/>elements<sp/>we<sp/>can<sp/>efficiently<sp/>recover<sp/>*n*<sp/>elements<sp/>from<sp/>a<sp/>sketch.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">**Capacity<sp/>and<sp/>difference**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">The<sp/>approach<sp/>above<sp/>only<sp/>works<sp/>when<sp/>the<sp/>number<sp/>of<sp/>elements<sp/>*n*<sp/>in<sp/>the<sp/>sketch<sp/>is<sp/>known.<sp/>Of<sp/>course<sp/>we<sp/>want<sp/>to<sp/>support<sp/>cases<sp/>where<sp/>only<sp/>an<sp/>upper<sp/>bound<sp/>on<sp/>the<sp/>number<sp/>of<sp/>elements<sp/>in<sp/>the<sp/>sketch<sp/>is<sp/>known,<sp/>the<sp/>capacity<sp/>*c*.<sp/>Given<sp/>that<sp/>we<sp/>can<sp/>reconstruct<sp/>a<sp/>set<sp/>of<sp/>size<sp/>*c*<sp/>from<sp/>a<sp/>sketch<sp/>with<sp/>*2c*<sp/>terms,<sp/>we<sp/>should<sp/>be<sp/>able<sp/>to<sp/>reconstruct<sp/>a<sp/>set<sp/>of<sp/>size<sp/>*n*<sp/>too<sp/>as<sp/>long<sp/>as<sp/>*n<sp/>&amp;le;<sp/>c*.<sp/>This<sp/>is<sp/>simply<sp/>a<sp/>matter<sp/>of<sp/>trying<sp/>to<sp/>solve<sp/>the<sp/>above<sp/>set<sp/>of<sp/>equations<sp/>assuming<sp/>values<sp/>of<sp/>*n*<sp/>that<sp/>count<sp/>down<sp/>from<sp/>*c*<sp/>until<sp/>a<sp/>solution<sp/>is<sp/>found<sp/>for<sp/>one.<sp/>This<sp/>is<sp/>known<sp/>as<sp/>the<sp/>[Peterson-Gorenstein-Zierler<sp/>algorithm](https://en.wikipedia.org/wiki/BCH_code#Peterson%E2%80%93Gorenstein%E2%80%93Zierler_algorithm).</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>Optimizations</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">**Halving<sp/>the<sp/>sketch<sp/>size**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">We<sp/>can<sp/>in<sp/>fact<sp/>only<sp/>include<sp/>the<sp/>odd<sp/>terms<sp/>in<sp/>the<sp/>sketch,<sp/>and<sp/>reconstruct<sp/>the<sp/>even<sp/>ones<sp/>before<sp/>solving<sp/>the<sp/>equation<sp/>to<sp/>find<sp/>*L*.<sp/>This<sp/>means<sp/>the<sp/>size<sp/>of<sp/>a<sp/>sketch<sp/>becomes<sp/>just<sp/>*c*<sp/>field<sp/>elements,<sp/>the<sp/>same<sp/>size<sp/>as<sp/>would<sp/>be<sp/>needed<sp/>to<sp/>send<sp/>its<sp/>contents<sp/>naively.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">To<sp/>see<sp/>how<sp/>this<sp/>is<sp/>possible,<sp/>we<sp/>need<sp/>the<sp/>[Frobenius<sp/>endomorphism](https://en.wikipedia.org/wiki/Frobenius_endomorphism),<sp/>which<sp/>in<sp/>short<sp/>states<sp/>that<sp/>in<sp/>fields<sp/>where<sp/>*x<sp/>+<sp/>x<sp/>=<sp/>0*<sp/>it<sp/>holds<sp/>that<sp/>*(x<sp/>+<sp/>y)&lt;sup&gt;2&lt;/sup&gt;<sp/>=<sp/>x&lt;sup&gt;2&lt;/sup&gt;<sp/>+<sp/>y&lt;sup&gt;2&lt;/sup&gt;*<sp/>for<sp/>every<sp/>*x*<sp/>and<sp/>*y*<sp/>(the<sp/>dream<sp/>of<sp/>every<sp/>high<sp/>school<sp/>math<sp/>student!).<sp/>This<sp/>means<sp/>that:</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">*<sp/>*s&lt;sub&gt;2&lt;/sub&gt;<sp/>=<sp/>m&lt;sub&gt;1&lt;/sub&gt;&lt;sup&gt;2&lt;/sup&gt;<sp/>+<sp/>m&lt;sub&gt;2&lt;/sub&gt;&lt;sup&gt;2&lt;/sup&gt;<sp/>+<sp/>...<sp/>=<sp/>(m&lt;sub&gt;1&lt;/sub&gt;<sp/>+<sp/>m&lt;sub&gt;2&lt;/sub&gt;<sp/>+<sp/>...)&lt;sup&gt;2&lt;/sup&gt;<sp/>=<sp/>s&lt;sub&gt;1&lt;/sub&gt;&lt;sup&gt;2&lt;/sup&gt;*.</highlight></codeline>
<codeline><highlight class="normal">*<sp/>*s&lt;sub&gt;4&lt;/sub&gt;<sp/>=<sp/>m&lt;sub&gt;1&lt;/sub&gt;&lt;sup&gt;4&lt;/sup&gt;<sp/>+<sp/>m&lt;sub&gt;2&lt;/sub&gt;&lt;sup&gt;4&lt;/sup&gt;<sp/>+<sp/>...<sp/>=<sp/>(m&lt;sub&gt;1&lt;/sub&gt;&lt;sup&gt;2&lt;/sup&gt;<sp/>+<sp/>m&lt;sub&gt;2&lt;/sub&gt;&lt;sup&gt;2&lt;/sup&gt;<sp/>+<sp/>...)&lt;sup&gt;2&lt;/sup&gt;<sp/>=<sp/>s&lt;sub&gt;2&lt;/sub&gt;&lt;sup&gt;2&lt;/sup&gt;*.</highlight></codeline>
<codeline><highlight class="normal">*<sp/>*s&lt;sub&gt;6&lt;/sub&gt;<sp/>=<sp/>m&lt;sub&gt;1&lt;/sub&gt;&lt;sup&gt;6&lt;/sup&gt;<sp/>+<sp/>m&lt;sub&gt;2&lt;/sub&gt;&lt;sup&gt;6&lt;/sup&gt;<sp/>+<sp/>...<sp/>=<sp/>(m&lt;sub&gt;1&lt;/sub&gt;&lt;sup&gt;3&lt;/sup&gt;<sp/>+<sp/>m&lt;sub&gt;2&lt;/sub&gt;&lt;sup&gt;3&lt;/sup&gt;<sp/>+<sp/>...)&lt;sup&gt;2&lt;/sup&gt;<sp/>=<sp/>s&lt;sub&gt;3&lt;/sub&gt;&lt;sup&gt;2&lt;/sup&gt;*.</highlight></codeline>
<codeline><highlight class="normal">*<sp/>...</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">In<sp/>other<sp/>words,<sp/>we<sp/>only<sp/>need<sp/>to<sp/>send<sp/>*s&lt;sub&gt;1&lt;/sub&gt;,<sp/>s&lt;sub&gt;3&lt;/sub&gt;,<sp/>s&lt;sub&gt;5&lt;/sub&gt;,<sp/>...,<sp/>s&lt;sub&gt;2n-1&lt;/sub&gt;*<sp/>to<sp/>recover<sp/>all<sp/>*2n*<sp/>*s&lt;sub&gt;i&lt;/sub&gt;*<sp/>values,<sp/>and<sp/>proceed<sp/>with<sp/>reconstruction.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">**Quadratic<sp/>performance<sp/>rather<sp/>than<sp/>cubic**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">Using<sp/>Gaussian<sp/>elimination<sp/>to<sp/>solve<sp/>the<sp/>set<sp/>of<sp/>equations<sp/>above<sp/>for<sp/>the<sp/>*l&lt;sub&gt;i&lt;/sub&gt;*<sp/>values<sp/>requires<sp/>*O(n&lt;sup&gt;3&lt;/sup&gt;)*<sp/>field<sp/>operations.<sp/>However,<sp/>due<sp/>to<sp/>the<sp/>special<sp/>structure<sp/>in<sp/>the<sp/>equations<sp/>(look<sp/>at<sp/>the<sp/>repeated<sp/>*s&lt;sub&gt;i&lt;/sub&gt;*<sp/>values),<sp/>it<sp/>can<sp/>be<sp/>solved<sp/>in<sp/>*O(n&lt;sup&gt;2&lt;/sup&gt;)*<sp/>time<sp/>using<sp/>a<sp/>number<sp/>of<sp/>techniques,<sp/>including<sp/>the<sp/>[Berlekamp-Massey<sp/>algorithm](https://en.wikipedia.org/wiki/Berlekamp%E2%80%93Massey_algorithm)<sp/>(BM).</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">**Roots<sp/>instead<sp/>of<sp/>factorization**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">As<sp/>explained<sp/>above,<sp/>the<sp/>polynomial<sp/>*L*<sp/>can<sp/>be<sp/>factored<sp/>into<sp/>*(1<sp/>-<sp/>m&lt;sub&gt;i&lt;/sub&gt;x)*<sp/>factors,<sp/>where<sp/>the<sp/>values<sp/>*m&lt;sub&gt;i&lt;/sub&gt;*<sp/>are<sp/>the<sp/>set<sp/>elements.<sp/>However,<sp/>since<sp/>we<sp/>know<sp/>that<sp/>a<sp/>decodable<sp/>sketch<sp/>must<sp/>result<sp/>in<sp/>a<sp/>polynomial<sp/>that<sp/>is<sp/>fully<sp/>factorizable<sp/>into<sp/>degree-*1*<sp/>factors,<sp/>we<sp/>can<sp/>instead<sp/>use<sp/>a<sp/>more<sp/>efficient<sp/>root-finding<sp/>algorithm<sp/>rather<sp/>than<sp/>a<sp/>factorization<sp/>algorithm.<sp/>As<sp/>the<sp/>root<sp/>of<sp/>each<sp/>*(1<sp/>-<sp/>m&lt;sub&gt;i&lt;/sub&gt;x)*<sp/>factor<sp/>is<sp/>*m&lt;sub&gt;i&lt;/sub&gt;&lt;sup&gt;-1&lt;/sup&gt;*,<sp/>we<sp/>conclude<sp/>that<sp/>the<sp/>set<sp/>elements<sp/>are<sp/>in<sp/>fact<sp/>the<sp/>inverses<sp/>of<sp/>the<sp/>roots<sp/>of<sp/>*L*.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">**Avoiding<sp/>inversions**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">As<sp/>inversions<sp/>are<sp/>a<sp/>relatively<sp/>expensive<sp/>operation,<sp/>it<sp/>would<sp/>be<sp/>useful<sp/>to<sp/>avoid<sp/>them.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">Say<sp/>that<sp/>we&apos;re<sp/>trying<sp/>to<sp/>find<sp/>the<sp/>inverses<sp/>of<sp/>the<sp/>roots<sp/>of<sp/>*L<sp/>=<sp/>1<sp/>+<sp/>l&lt;sub&gt;1&lt;/sub&gt;x<sp/>+<sp/>l&lt;sub&gt;2&lt;/sub&gt;x&lt;sup&gt;2&lt;/sup&gt;<sp/>+<sp/>...<sp/>+<sp/>l&lt;sub&gt;n&lt;/sub&gt;x&lt;sup&gt;n&lt;/sup&gt;*,<sp/>then<sp/>we&apos;re<sp/>really<sp/>interested<sp/>in<sp/>the<sp/>solutions<sp/>*y*<sp/>for<sp/>*1<sp/>+<sp/>l&lt;sub&gt;1&lt;/sub&gt;y&lt;sup&gt;-1&lt;/sup&gt;<sp/>+<sp/>l&lt;sub&gt;2&lt;/sub&gt;y&lt;sup&gt;-2&lt;/sup&gt;<sp/>+<sp/>...<sp/>+<sp/>l&lt;sub&gt;n&lt;/sub&gt;y&lt;sup&gt;-n&lt;/sup&gt;<sp/>=<sp/>0*.<sp/>By<sp/>multiplying<sp/>both<sp/>sides<sp/>in<sp/>the<sp/>equations<sp/>with<sp/>*y&lt;sup&gt;n&lt;/sup&gt;*,<sp/>we<sp/>find<sp/>*l&lt;sub&gt;n&lt;/sub&gt;<sp/>+<sp/>l&lt;sub&gt;n-1&lt;/sub&gt;y<sp/>+<sp/>l&lt;sub&gt;n-2&lt;/sub&gt;y&lt;sup&gt;2&lt;/sup&gt;<sp/>+<sp/>...<sp/>+<sp/>y&lt;sup&gt;n&lt;/sup&gt;<sp/>=<sp/>0*.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">In<sp/>other<sp/>words,<sp/>we<sp/>can<sp/>find<sp/>the<sp/>inverses<sp/>of<sp/>the<sp/>roots<sp/>of<sp/>*L*<sp/>by<sp/>instead<sp/>factoring<sp/>the<sp/>polynomial<sp/>with<sp/>the<sp/>coefficients<sp/>of<sp/>*L*<sp/>in<sp/>reverse<sp/>order.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">*<sp/>&lt;a<sp/>name=&quot;myfootnote1&quot;&gt;[1]&lt;/a&gt;<sp/>For<sp/>those<sp/>familiar<sp/>with<sp/>coding<sp/>theory:<sp/>PinSketch<sp/>communicates<sp/>a<sp/>set<sp/>difference<sp/>by<sp/>encoding<sp/>the<sp/>set<sp/>members<sp/>as<sp/>errors<sp/>in<sp/>a<sp/>binary<sp/>[BCH](https://en.wikipedia.org/wiki/BCH_code)<sp/>codeword<sp/>2&lt;sup&gt;bits&lt;/sup&gt;<sp/>in<sp/>size<sp/>and<sp/>sends<sp/>the<sp/>syndromes.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>The<sp/>linearity<sp/>of<sp/>the<sp/>syndromes<sp/>provides<sp/>all<sp/>the<sp/>properties<sp/>needed<sp/>for<sp/>a<sp/>sketch.<sp/>Sketch<sp/>decoding<sp/>is<sp/>simply<sp/>finding<sp/>the<sp/>error<sp/>locations.<sp/>Decode<sp/>is<sp/>much<sp/>faster<sp/>than<sp/>an<sp/>ordinary<sp/>BCH<sp/>decoder<sp/>for<sp/>such<sp/>a<sp/>large<sp/>codeword<sp/>because<sp/>the<sp/>need<sp/>to<sp/>take<sp/>a<sp/>discrete<sp/>log<sp/>is<sp/>avoided<sp/>by<sp/>storing<sp/>the<sp/>set<sp/>in<sp/>the<sp/>roots<sp/>directly<sp/>instead<sp/>of<sp/>in<sp/>an<sp/>exponent<sp/>(logically<sp/>permuting<sp/>the<sp/>bits<sp/>of<sp/>the<sp/>codeword).</highlight></codeline>
    </programlisting>
    <location file="src/minisketch/doc/math.md"/>
  </compounddef>
</doxygen>
