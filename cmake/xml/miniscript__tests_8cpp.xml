<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="miniscript__tests_8cpp" kind="file" language="C++">
    <compoundname>miniscript_tests.cpp</compoundname>
    <includes refid="test_2util_2random_8h" local="no">test/util/random.h</includes>
    <includes refid="setup__common_8h" local="no">test/util/setup_common.h</includes>
    <includes local="no">boost/test/unit_test.hpp</includes>
    <includes refid="addresstype_8h" local="no">addresstype.h</includes>
    <includes refid="core__io_8h" local="no">core_io.h</includes>
    <includes local="no">hash.h</includes>
    <includes refid="pubkey_8h" local="no">pubkey.h</includes>
    <includes refid="uint256_8h" local="no">uint256.h</includes>
    <includes refid="ripemd160_8h" local="no">crypto/ripemd160.h</includes>
    <includes refid="sha256_8h" local="no">crypto/sha256.h</includes>
    <includes refid="interpreter_8h" local="no">script/interpreter.h</includes>
    <includes refid="miniscript_8h" local="no">script/miniscript.h</includes>
    <includes refid="script__error_8h" local="no">script/script_error.h</includes>
    <includes refid="signingprovider_8h" local="no">script/signingprovider.h</includes>
    <includes local="no">algorithm</includes>
    <includes local="no">cstdint</includes>
    <includes local="no">string</includes>
    <includes local="no">vector</includes>
    <incdepgraph>
      <node id="110">
        <label>addresstype.h</label>
        <link refid="addresstype_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="100" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="103" relation="include">
        </childnode>
        <childnode refid="101" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="71" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="38">
        <label>attributes.h</label>
        <link refid="attributes_8h"/>
      </node>
      <node id="34">
        <label>common/args.h</label>
        <link refid="args_8h"/>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="67" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="68" relation="include">
        </childnode>
        <childnode refid="69" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="70" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="71" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="35">
        <label>common/settings.h</label>
        <link refid="common_2settings_8h"/>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="87">
        <label>compat/assumptions.h</label>
        <link refid="compat_2assumptions_8h"/>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
      </node>
      <node id="8">
        <label>compat/byteswap.h</label>
        <link refid="byteswap_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
      </node>
      <node id="48">
        <label>compat/compat.h</label>
        <link refid="compat_8h"/>
        <childnode refid="49" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
        <childnode refid="54" relation="include">
        </childnode>
        <childnode refid="55" relation="include">
        </childnode>
        <childnode refid="56" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="60" relation="include">
        </childnode>
      </node>
      <node id="7">
        <label>compat/endian.h</label>
        <link refid="endian_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
      </node>
      <node id="3">
        <label>consensus/amount.h</label>
        <link refid="amount_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
      </node>
      <node id="119">
        <label>consensus/consensus.h</label>
        <link refid="consensus_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
      </node>
      <node id="111">
        <label>core_io.h</label>
        <link refid="core__io_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="112" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="6">
        <label>crypto/common.h</label>
        <link refid="crypto_2common_8h"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
      </node>
      <node id="19">
        <label>crypto/hex_base.h</label>
        <link refid="hex__base_8h"/>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
      </node>
      <node id="81">
        <label>crypto/ripemd160.h</label>
        <link refid="ripemd160_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
      </node>
      <node id="83">
        <label>crypto/sha256.h</label>
        <link refid="sha256_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
      </node>
      <node id="80">
        <label>hash.h</label>
        <link refid="hash_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="83" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="86" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="72">
        <label>kernel/caches.h</label>
        <link refid="kernel_2caches_8h"/>
        <childnode refid="73" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="76">
        <label>kernel/context.h</label>
        <link refid="kernel_2context_8h"/>
      </node>
      <node id="77">
        <label>key.h</label>
        <link refid="key_8h"/>
        <childnode refid="78" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="86" relation="include">
        </childnode>
        <childnode refid="89" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="78">
        <label>musig.h</label>
        <link refid="musig_8h"/>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="93">
        <label>node/caches.h</label>
        <link refid="node_2caches_8h"/>
        <childnode refid="72" relation="include">
        </childnode>
        <childnode refid="73" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
      </node>
      <node id="94">
        <label>node/context.h</label>
        <link refid="node_2context_8h"/>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="88" relation="include">
        </childnode>
        <childnode refid="66" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="120">
        <label>policy/policy.h</label>
        <link refid="policy_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="119" relation="include">
        </childnode>
        <childnode refid="95" relation="include">
        </childnode>
        <childnode refid="115" relation="include">
        </childnode>
        <childnode refid="121" relation="include">
        </childnode>
        <childnode refid="122" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
      </node>
      <node id="84">
        <label>prevector.h</label>
        <link refid="prevector_8h"/>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="85" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="95">
        <label>primitives/transaction.h</label>
        <link refid="primitives_2transaction_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="96" relation="include">
        </childnode>
        <childnode refid="100" relation="include">
        </childnode>
        <childnode refid="86" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="88" relation="include">
        </childnode>
        <childnode refid="102" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="99" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="96">
        <label>primitives/transaction_identifier.h</label>
        <link refid="transaction__identifier_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="97" relation="include">
        </childnode>
        <childnode refid="98" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="99" relation="include">
        </childnode>
        <childnode refid="71" relation="include">
        </childnode>
      </node>
      <node id="79">
        <label>pubkey.h</label>
        <link refid="pubkey_8h"/>
        <childnode refid="80" relation="include">
        </childnode>
        <childnode refid="86" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="115">
        <label>script/interpreter.h</label>
        <link refid="interpreter_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="114" relation="include">
        </childnode>
        <childnode refid="95" relation="include">
        </childnode>
        <childnode refid="116" relation="include">
        </childnode>
        <childnode refid="117" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="125">
        <label>script/keyorigin.h</label>
        <link refid="keyorigin_8h"/>
        <childnode refid="86" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="118">
        <label>script/miniscript.h</label>
        <link refid="miniscript_8h"/>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="98" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="85" relation="include">
        </childnode>
        <childnode refid="88" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="70" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="99" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="119" relation="include">
        </childnode>
        <childnode refid="120" relation="include">
        </childnode>
        <childnode refid="115" relation="include">
        </childnode>
        <childnode refid="123" relation="include">
        </childnode>
        <childnode refid="100" relation="include">
        </childnode>
        <childnode refid="86" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="103" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="107" relation="include">
        </childnode>
      </node>
      <node id="123">
        <label>script/parsing.h</label>
        <link refid="parsing_8h"/>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
      </node>
      <node id="100">
        <label>script/script.h</label>
        <link refid="script_2script_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="86" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="101" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="116">
        <label>script/script_error.h</label>
        <link refid="script__error_8h"/>
        <childnode refid="20" relation="include">
        </childnode>
      </node>
      <node id="124">
        <label>script/signingprovider.h</label>
        <link refid="signingprovider_8h"/>
        <childnode refid="110" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="77" relation="include">
        </childnode>
        <childnode refid="78" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="125" relation="include">
        </childnode>
        <childnode refid="100" relation="include">
        </childnode>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="121">
        <label>script/solver.h</label>
        <link refid="solver_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="100" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="117">
        <label>script/verify_flags.h</label>
        <link refid="verify__flags_8h"/>
        <childnode refid="98" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
      </node>
      <node id="86">
        <label>serialize.h</label>
        <link refid="serialize_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="88" relation="include">
        </childnode>
        <childnode refid="70" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="13">
        <label>span.h</label>
        <link refid="span_8h"/>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="89">
        <label>support/allocators/secure.h</label>
        <link refid="secure_8h"/>
        <childnode refid="90" relation="include">
        </childnode>
        <childnode refid="92" relation="include">
        </childnode>
        <childnode refid="88" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
      </node>
      <node id="92">
        <label>support/cleanse.h</label>
        <link refid="cleanse_8h"/>
        <childnode refid="82" relation="include">
        </childnode>
      </node>
      <node id="90">
        <label>support/lockedpool.h</label>
        <link refid="lockedpool_8h"/>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="69" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="88" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="91" relation="include">
        </childnode>
      </node>
      <node id="61">
        <label>sync.h</label>
        <link refid="sync_8h"/>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="65" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="66" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>src/test/miniscript_tests.cpp</label>
        <link refid="miniscript__tests_8cpp"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="109" relation="include">
        </childnode>
        <childnode refid="110" relation="include">
        </childnode>
        <childnode refid="111" relation="include">
        </childnode>
        <childnode refid="114" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="83" relation="include">
        </childnode>
        <childnode refid="115" relation="include">
        </childnode>
        <childnode refid="118" relation="include">
        </childnode>
        <childnode refid="116" relation="include">
        </childnode>
        <childnode refid="124" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>test/util/random.h</label>
        <link refid="test_2util_2random_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
      </node>
      <node id="33">
        <label>test/util/setup_common.h</label>
        <link refid="setup__common_8h"/>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="72" relation="include">
        </childnode>
        <childnode refid="76" relation="include">
        </childnode>
        <childnode refid="77" relation="include">
        </childnode>
        <childnode refid="93" relation="include">
        </childnode>
        <childnode refid="94" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="95" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="67" relation="include">
        </childnode>
        <childnode refid="103" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="105" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="107" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="62">
        <label>threadsafety.h</label>
        <link refid="threadsafety_8h"/>
        <childnode refid="63" relation="include">
        </childnode>
      </node>
      <node id="37">
        <label>tinyformat.h</label>
        <link refid="tinyformat_8h"/>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
      </node>
      <node id="5">
        <label>uint256.h</label>
        <link refid="uint256_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
      </node>
      <node id="73">
        <label>util/byte_units.h</label>
        <link refid="byte__units_8h"/>
        <childnode refid="74" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
      </node>
      <node id="67">
        <label>util/chaintype.h</label>
        <link refid="chaintype_8h"/>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
      </node>
      <node id="103">
        <label>util/check.h</label>
        <link refid="check_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="104" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="122">
        <label>util/feefrac.h</label>
        <link refid="feefrac_8h"/>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="103" relation="include">
        </childnode>
        <childnode refid="98" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="36">
        <label>util/fs.h</label>
        <link refid="fs_8h"/>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="101">
        <label>util/hash_type.h</label>
        <link refid="hash__type_8h"/>
      </node>
      <node id="64">
        <label>util/macros.h</label>
        <link refid="macros_8h"/>
      </node>
      <node id="74">
        <label>util/overflow.h</label>
        <link refid="overflow_8h"/>
        <childnode refid="75" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="112">
        <label>util/result.h</label>
        <link refid="result_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="113" relation="include">
        </childnode>
        <childnode refid="71" relation="include">
        </childnode>
      </node>
      <node id="105">
        <label>util/signalinterrupt.h</label>
        <link refid="signalinterrupt_8h"/>
        <childnode refid="106" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
      </node>
      <node id="18">
        <label>util/strencodings.h</label>
        <link refid="strencodings_8h"/>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="21">
        <label>util/string.h</label>
        <link refid="string_8h"/>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="106">
        <label>util/tokenpipe.h</label>
        <link refid="tokenpipe_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="113">
        <label>util/translation.h</label>
        <link refid="translation_8h"/>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
      </node>
      <node id="97">
        <label>util/types.h</label>
        <link refid="util_2types_8h"/>
      </node>
      <node id="107">
        <label>util/vector.h</label>
        <link refid="vector_8h"/>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="108" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="31">
        <label>algorithm</label>
      </node>
      <node id="49">
        <label>arpa/inet.h</label>
      </node>
      <node id="22">
        <label>array</label>
      </node>
      <node id="32">
        <label>atomic</label>
      </node>
      <node id="9">
        <label>bit</label>
      </node>
      <node id="109">
        <label>boost/test/unit_test.hpp</label>
      </node>
      <node id="14">
        <label>cassert</label>
      </node>
      <node id="60">
        <label>cerrno</label>
      </node>
      <node id="27">
        <label>charconv</label>
      </node>
      <node id="75">
        <label>climits</label>
      </node>
      <node id="98">
        <label>compare</label>
      </node>
      <node id="10">
        <label>concepts</label>
      </node>
      <node id="65">
        <label>condition_variable</label>
      </node>
      <node id="11">
        <label>cstddef</label>
      </node>
      <node id="4">
        <label>cstdint</label>
      </node>
      <node id="41">
        <label>cstdio</label>
      </node>
      <node id="82">
        <label>cstdlib</label>
      </node>
      <node id="12">
        <label>cstring</label>
      </node>
      <node id="50">
        <label>fcntl.h</label>
      </node>
      <node id="42">
        <label>filesystem</label>
      </node>
      <node id="43">
        <label>functional</label>
      </node>
      <node id="114">
        <label>hash.h</label>
      </node>
      <node id="108">
        <label>initializer_list</label>
      </node>
      <node id="44">
        <label>iomanip</label>
      </node>
      <node id="45">
        <label>ios</label>
      </node>
      <node id="68">
        <label>iosfwd</label>
      </node>
      <node id="39">
        <label>iostream</label>
      </node>
      <node id="85">
        <label>iterator</label>
      </node>
      <node id="28">
        <label>limits</label>
      </node>
      <node id="69">
        <label>list</label>
      </node>
      <node id="23">
        <label>locale</label>
      </node>
      <node id="47">
        <label>map</label>
      </node>
      <node id="88">
        <label>memory</label>
      </node>
      <node id="63">
        <label>mutex</label>
      </node>
      <node id="51">
        <label>net/if.h</label>
      </node>
      <node id="52">
        <label>netdb.h</label>
      </node>
      <node id="53">
        <label>netinet/in.h</label>
      </node>
      <node id="54">
        <label>netinet/tcp.h</label>
      </node>
      <node id="102">
        <label>numeric</label>
      </node>
      <node id="29">
        <label>optional</label>
      </node>
      <node id="46">
        <label>ostream</label>
      </node>
      <node id="70">
        <label>set</label>
      </node>
      <node id="104">
        <label>source_location</label>
      </node>
      <node id="15">
        <label>span</label>
      </node>
      <node id="24">
        <label>sstream</label>
      </node>
      <node id="40">
        <label>stdexcept</label>
      </node>
      <node id="20">
        <label>string</label>
      </node>
      <node id="25">
        <label>string_view</label>
      </node>
      <node id="55">
        <label>sys/mman.h</label>
      </node>
      <node id="56">
        <label>sys/select.h</label>
      </node>
      <node id="57">
        <label>sys/socket.h</label>
      </node>
      <node id="58">
        <label>sys/types.h</label>
      </node>
      <node id="30">
        <label>system_error</label>
      </node>
      <node id="66">
        <label>thread</label>
      </node>
      <node id="99">
        <label>tuple</label>
      </node>
      <node id="16">
        <label>type_traits</label>
      </node>
      <node id="59">
        <label>unistd.h</label>
      </node>
      <node id="91">
        <label>unordered_map</label>
      </node>
      <node id="17">
        <label>utility</label>
      </node>
      <node id="71">
        <label>variant</label>
      </node>
      <node id="26">
        <label>vector</label>
      </node>
    </incdepgraph>
    <sectiondef kind="func">
      <memberdef kind="function" id="miniscript__tests_8cpp_1a5d6e8c310bd2006c4d81ddd06d8d3f68" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>BOOST_AUTO_TEST_CASE</definition>
        <argsstring>(fixed_tests)</argsstring>
        <name>BOOST_AUTO_TEST_CASE</name>
        <param>
          <type>fixed_tests</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/test/miniscript_tests.cpp" line="502" column="1" bodyfile="src/test/miniscript_tests.cpp" bodystart="502" bodyend="728"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2019-present<sp/>The<sp/>Bitcoin<sp/>Core<sp/>developers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Distributed<sp/>under<sp/>the<sp/>MIT<sp/>software<sp/>license,<sp/>see<sp/>the<sp/>accompanying</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">//<sp/>file<sp/>COPYING<sp/>or<sp/>http://www.opensource.org/licenses/mit-license.php.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="test_2util_2random_8h" kindref="compound">test/util/random.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="setup__common_8h" kindref="compound">test/util/setup_common.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;boost/test/unit_test.hpp&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="addresstype_8h" kindref="compound">addresstype.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="core__io_8h" kindref="compound">core_io.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;hash.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="pubkey_8h" kindref="compound">pubkey.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="uint256_8h" kindref="compound">uint256.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="ripemd160_8h" kindref="compound">crypto/ripemd160.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="sha256_8h" kindref="compound">crypto/sha256.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="interpreter_8h" kindref="compound">script/interpreter.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="miniscript_8h" kindref="compound">script/miniscript.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="script__error_8h" kindref="compound">script/script_error.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="signingprovider_8h" kindref="compound">script/signingprovider.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;algorithm&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;cstdint&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;vector&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="keyword">using<sp/>namespace<sp/></highlight><highlight class="normal"><ref refid="namespaceutil_1_1hex__literals" kindref="compound">util::hex_literals</ref>;</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="keyword">namespace<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">TestData<sp/>{</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;CPubKey&gt;<sp/>pubkeys;</highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/>std::map&lt;CPubKey,<sp/>CKeyID&gt;<sp/>pkhashes;</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/>std::map&lt;CKeyID,<sp/>CPubKey&gt;<sp/>pkmap;</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/>std::map&lt;XOnlyPubKey,<sp/>CKeyID&gt;<sp/>xonly_pkhashes;</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/>std::map&lt;CPubKey,<sp/>std::vector&lt;unsigned<sp/>char&gt;&gt;<sp/><ref refid="namespacetests__wycheproof__generate__ecdsa_1afd323604a88f03623bce108d1e1ba049" kindref="member">signatures</ref>;</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/>std::map&lt;XOnlyPubKey,<sp/>std::vector&lt;unsigned<sp/>char&gt;&gt;<sp/>schnorr_signatures;</highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Various<sp/>precomputed<sp/>hashes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;std::vector&lt;unsigned<sp/>char&gt;&gt;<sp/>sha256;</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;std::vector&lt;unsigned<sp/>char&gt;&gt;<sp/>ripemd160;</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;std::vector&lt;unsigned<sp/>char&gt;&gt;<sp/>hash256;</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;std::vector&lt;unsigned<sp/>char&gt;&gt;<sp/>hash160;</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/>std::map&lt;std::vector&lt;unsigned<sp/>char&gt;,<sp/>std::vector&lt;unsigned<sp/>char&gt;&gt;<sp/>sha256_preimages;</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/>std::map&lt;std::vector&lt;unsigned<sp/>char&gt;,<sp/>std::vector&lt;unsigned<sp/>char&gt;&gt;<sp/>ripemd160_preimages;</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/>std::map&lt;std::vector&lt;unsigned<sp/>char&gt;,<sp/>std::vector&lt;unsigned<sp/>char&gt;&gt;<sp/>hash256_preimages;</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/>std::map&lt;std::vector&lt;unsigned<sp/>char&gt;,<sp/>std::vector&lt;unsigned<sp/>char&gt;&gt;<sp/>hash160_preimages;</highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/>TestData()</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>All<sp/>our<sp/>signatures<sp/>sign<sp/>(and<sp/>are<sp/>required<sp/>to<sp/>sign)<sp/>this<sp/>constant<sp/>message.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/>uint256<sp/>MESSAGE_HASH{</highlight><highlight class="stringliteral">&quot;0000000000000000f5cd94e18b6fe77dd7aca9e35c2b0c9cbd86356c80a71065&quot;</highlight><highlight class="normal">};</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>don&apos;t<sp/>pass<sp/>additional<sp/>randomness<sp/>when<sp/>creating<sp/>a<sp/>schnorr<sp/>signature.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>EMPTY_AUX{<ref refid="classuint256_1ad37cbed35b00e8c74ef40e3ef06dac31" kindref="member">uint256::ZERO</ref>};</highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>generate<sp/>255<sp/>public<sp/>keys<sp/>and<sp/>255<sp/>hashes<sp/>of<sp/>each<sp/>type.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>1;<sp/>i<sp/>&lt;=<sp/>255;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>32-byte<sp/>array<sp/>functions<sp/>as<sp/>both<sp/>private<sp/>key<sp/>data<sp/>and<sp/>hash<sp/>preimage<sp/>(31<sp/>zero<sp/>bytes<sp/>plus<sp/>any<sp/>nonzero<sp/>byte).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>keydata[32]<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>keydata[31]<sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Compute<sp/>CPubkey<sp/>and<sp/>CKeyID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CKey<sp/>key;</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>key.<ref refid="class_c_key_1a187230fea4115615c6c65b39c9e18246" kindref="member">Set</ref>(keydata,<sp/>keydata<sp/>+<sp/>32,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CPubKey<sp/>pubkey<sp/>=<sp/>key.<ref refid="class_c_key_1a344311f57d0f0df0822c9fb04f66cf95" kindref="member">GetPubKey</ref>();</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CKeyID<sp/>keyid<sp/>=<sp/>pubkey.<ref refid="class_c_pub_key_1a0dcc3372f6142fc89e4bab57e10a67c7" kindref="member">GetID</ref>();</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pubkeys.push_back(pubkey);</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pkhashes.emplace(pubkey,<sp/>keyid);</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pkmap.emplace(keyid,<sp/>pubkey);</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>XOnlyPubKey<sp/>xonly_pubkey{pubkey};</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint160<sp/>xonly_hash{<ref refid="hash_8h_1a086f67aa7715eaceb80502dc10fb19c3" kindref="member">Hash160</ref>(xonly_pubkey)};</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xonly_pkhashes.emplace(xonly_pubkey,<sp/>xonly_hash);</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pkmap.emplace(xonly_hash,<sp/>pubkey);</highlight></codeline>
<codeline lineno="76"><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Compute<sp/>ECDSA<sp/>signatures<sp/>on<sp/>MESSAGE_HASH<sp/>with<sp/>the<sp/>private<sp/>keys.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;unsigned<sp/>char&gt;<sp/>sig,<sp/>schnorr_sig(64);</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(key.<ref refid="class_c_key_1a4143ab43733a1eef40d194163a2f69b0" kindref="member">Sign</ref>(MESSAGE_HASH,<sp/>sig));</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sig.push_back(1);<sp/></highlight><highlight class="comment">//<sp/>sighash<sp/>byte</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespacetests__wycheproof__generate__ecdsa_1afd323604a88f03623bce108d1e1ba049" kindref="member">signatures</ref>.emplace(pubkey,<sp/>sig);</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(key.<ref refid="class_c_key_1a0884ca8071e122315e1fb5dc8efda906" kindref="member">SignSchnorr</ref>(MESSAGE_HASH,<sp/>schnorr_sig,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/>EMPTY_AUX));</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>schnorr_sig.push_back(1);<sp/></highlight><highlight class="comment">//<sp/>Maximally<sp/>sized<sp/>Schnorr<sp/>sigs<sp/>have<sp/>a<sp/>sighash<sp/>byte.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>schnorr_signatures.emplace(XOnlyPubKey{pubkey},<sp/>schnorr_sig);</highlight></codeline>
<codeline lineno="85"><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Compute<sp/>various<sp/>hashes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;unsigned<sp/>char&gt;<sp/>hash;</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hash.resize(32);</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CSHA256().Write(keydata,<sp/>32).Finalize(hash.data());</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sha256.push_back(hash);</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sha256_preimages[hash]<sp/>=<sp/>std::vector&lt;unsigned<sp/>char&gt;(keydata,<sp/>keydata<sp/>+<sp/>32);</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CHash256().Write(keydata).Finalize(hash);</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hash256.push_back(hash);</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hash256_preimages[hash]<sp/>=<sp/>std::vector&lt;unsigned<sp/>char&gt;(keydata,<sp/>keydata<sp/>+<sp/>32);</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hash.resize(20);</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CRIPEMD160().Write(keydata,<sp/>32).Finalize(hash.data());</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ripemd160.push_back(hash);</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ripemd160_preimages[hash]<sp/>=<sp/>std::vector&lt;unsigned<sp/>char&gt;(keydata,<sp/>keydata<sp/>+<sp/>32);</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CHash160().Write(keydata).Finalize(hash);</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hash160.push_back(hash);</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hash160_preimages[hash]<sp/>=<sp/>std::vector&lt;unsigned<sp/>char&gt;(keydata,<sp/>keydata<sp/>+<sp/>32);</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="104"><highlight class="normal">};</highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal">std::unique_ptr&lt;const<sp/>TestData&gt;<sp/>g_testdata;</highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight><highlight class="keyword">enum<sp/>class</highlight><highlight class="normal"><sp/>ChallengeType<sp/>{</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceminiscript_1a02db2bde67db0cee6704064a541c67f8ab505df5aa812b4f320420b8a952f20e5" kindref="member">SHA256</ref>,</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="hash_8h_1a5a59295ec04ef6dc48d408bbbaafbf81" kindref="member">RIPEMD160</ref>,</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceminiscript_1a02db2bde67db0cee6704064a541c67f8aa2c78e38844cd93c5d5cc5a2ec107f8d" kindref="member">HASH256</ref>,</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceminiscript_1a02db2bde67db0cee6704064a541c67f8a1af0faac30c308df3d59a5dbd47b762a" kindref="member">HASH160</ref>,</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceminiscript_1a02db2bde67db0cee6704064a541c67f8ab1f680800cb490281abf6424510c85e5" kindref="member">OLDER</ref>,</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceminiscript_1a02db2bde67db0cee6704064a541c67f8ac130fda0cb93540bf1574912e78964fb" kindref="member">AFTER</ref>,</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/>PK</highlight></codeline>
<codeline lineno="118"><highlight class="normal">};</highlight></codeline>
<codeline lineno="119"><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>With<sp/>each<sp/>leaf<sp/>condition<sp/>we<sp/>associate<sp/>a<sp/>challenge<sp/>number.</highlight></codeline>
<codeline lineno="121"><highlight class="comment"><sp/>*<sp/>For<sp/>hashes<sp/>it&apos;s<sp/>just<sp/>the<sp/>first<sp/>4<sp/>bytes<sp/>of<sp/>the<sp/>hash.<sp/>For<sp/>pubkeys,<sp/>it&apos;s<sp/>the<sp/>last<sp/>4<sp/>bytes.</highlight></codeline>
<codeline lineno="122"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal">uint32_t<sp/>ChallengeNumber(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_pub_key" kindref="compound">CPubKey</ref>&amp;<sp/>pubkey)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="crypto_2common_8h_1a4f1b9effec884b448085452b138aee10" kindref="member">ReadLE32</ref>(pubkey.<ref refid="class_c_pub_key_1a370225871d639f2fc9a3744b2a6e6128" kindref="member">data</ref>()<sp/>+<sp/>29);<sp/>}</highlight></codeline>
<codeline lineno="124"><highlight class="normal">uint32_t<sp/>ChallengeNumber(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::vector&lt;unsigned<sp/>char&gt;&amp;<sp/>hash)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="crypto_2common_8h_1a4f1b9effec884b448085452b138aee10" kindref="member">ReadLE32</ref>(hash.data());<sp/>}</highlight></codeline>
<codeline lineno="125"><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/>std::pair&lt;ChallengeType,<sp/>uint32_t&gt;<sp/>Challenge;</highlight></codeline>
<codeline lineno="128"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">KeyConverter<sp/>{</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/>CPubKey<sp/>Key;</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="namespaceminiscript_1a2bd485f92f346bb2c8cb4189d22e1530" kindref="member">miniscript::MiniscriptContext</ref><sp/>m_script_ctx;</highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/>KeyConverter(<ref refid="namespaceminiscript_1a2bd485f92f346bb2c8cb4189d22e1530" kindref="member">miniscript::MiniscriptContext</ref><sp/>ctx)<sp/>noexcept<sp/>:<sp/>m_script_ctx{ctx}<sp/>{}</highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>KeyCompare(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>Key&amp;<sp/>a,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>Key&amp;<sp/>b)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>a<sp/>&lt;<sp/>b;</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="140"><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;unsigned<sp/>char&gt;<sp/>ToPKBytes(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>CPubKey&amp;<sp/>key)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="namespaceminiscript_1a4b27e96f9ac9f1bcbf3ba746a6d1a170" kindref="member">miniscript::IsTapscript</ref>(m_script_ctx))<sp/>{</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{key.<ref refid="class_c_pub_key_1a1b0b9d70f5f2ebe577cb78aa60d88ba5" kindref="member">begin</ref>(),<sp/>key.<ref refid="class_c_pub_key_1ae08c7ee97416c0ea9a52b0d5f5820fe4" kindref="member">end</ref>()};</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>XOnlyPubKey<sp/>xonly_pubkey{key};</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{xonly_pubkey.<ref refid="class_x_only_pub_key_1a1b0b9d70f5f2ebe577cb78aa60d88ba5" kindref="member">begin</ref>(),<sp/>xonly_pubkey.<ref refid="class_x_only_pub_key_1ae08c7ee97416c0ea9a52b0d5f5820fe4" kindref="member">end</ref>()};</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="149"><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;unsigned<sp/>char&gt;<sp/>ToPKHBytes(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>CPubKey&amp;<sp/>key)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="namespaceminiscript_1a4b27e96f9ac9f1bcbf3ba746a6d1a170" kindref="member">miniscript::IsTapscript</ref>(m_script_ctx))<sp/>{</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>hash<sp/>=<sp/>g_testdata-&gt;pkhashes.at(key);</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{hash.begin(),<sp/>hash.end()};</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>XOnlyPubKey<sp/>xonly_key{key};</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>hash<sp/>=<sp/>g_testdata-&gt;xonly_pkhashes.at(xonly_key);</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{hash.begin(),<sp/>hash.end()};</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="160"><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>I&gt;</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/>std::optional&lt;Key&gt;<sp/><ref refid="namespaceminiscript_1ab1acf22ce8b1e2ffbbd786fb4a8ab198" kindref="member">FromString</ref>(I<sp/>first,<sp/>I<sp/>last)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>bytes<sp/>=<sp/><ref refid="strencodings_8h_1a882aa30dcd768538f02d7e710bf44dc9" kindref="member">ParseHex</ref>(std::string(first,<sp/>last));</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Key<sp/>key{bytes.begin(),<sp/>bytes.end()};</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(key.IsValid())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>key;</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="169"><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>I&gt;</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/>std::optional&lt;Key&gt;<sp/>FromPKBytes(I<sp/>first,<sp/>I<sp/>last)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="namespaceminiscript_1a4b27e96f9ac9f1bcbf3ba746a6d1a170" kindref="member">miniscript::IsTapscript</ref>(m_script_ctx))<sp/>{</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Key<sp/>key{first,<sp/>last};</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(key.IsValid())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>key;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(last<sp/>-<sp/>first<sp/>!=<sp/>32)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>XOnlyPubKey<sp/>xonly_pubkey;</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::copy(first,<sp/>last,<sp/>xonly_pubkey.<ref refid="class_x_only_pub_key_1a1b0b9d70f5f2ebe577cb78aa60d88ba5" kindref="member">begin</ref>());</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>xonly_pubkey.<ref refid="class_x_only_pub_key_1a68f114490ce36d3add53fafc17c5eb15" kindref="member">GetEvenCorrespondingCPubKey</ref>();</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="182"><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>I&gt;</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/>std::optional&lt;Key&gt;<sp/>FromPKHBytes(I<sp/>first,<sp/>I<sp/>last)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(last<sp/>-<sp/>first<sp/>==<sp/>20);</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CKeyID<sp/>keyid;</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::copy(first,<sp/>last,<sp/>keyid.<ref refid="classbase__blob_1a899a629fc7846994a3bbd28ba2777243" kindref="member">begin</ref>());</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>g_testdata-&gt;pkmap.at(keyid);</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="190"><highlight class="normal"></highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/>std::optional&lt;std::string&gt;<sp/><ref refid="bitcoin-cli_8cpp_1aec2c30b1707eac00ff7e4fb5b3f7a92d" kindref="member">ToString</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>Key&amp;<sp/>key)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="hex__base_8cpp_1ac2c88b156e9e245fa3d0a66105ecd371" kindref="member">HexStr</ref>(ToPKBytes(key));</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceminiscript_1a2bd485f92f346bb2c8cb4189d22e1530" kindref="member">miniscript::MiniscriptContext</ref><sp/>MsContext()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>m_script_ctx;</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="198"><highlight class="normal">};</highlight></codeline>
<codeline lineno="199"><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="struct_satisfier" kindref="compound">Satisfier</ref><sp/>:<sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>KeyConverter<sp/>{</highlight></codeline>
<codeline lineno="202"><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_satisfier_1aade33e8a5daf0b26c7503871f9f43b7d" kindref="member">Satisfier</ref>(<ref refid="namespaceminiscript_1a2bd485f92f346bb2c8cb4189d22e1530" kindref="member">miniscript::MiniscriptContext</ref><sp/>ctx)<sp/>noexcept<sp/>:<sp/>KeyConverter{ctx}<sp/>{}</highlight></codeline>
<codeline lineno="204"><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/>std::set&lt;Challenge&gt;<sp/>supported;</highlight></codeline>
<codeline lineno="207"><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="struct_satisfier_1ab4eb2ae69b37e6922c37d890480812a0" kindref="member">CheckAfter</ref>(uint32_t<sp/>value)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>supported.contains(Challenge(ChallengeType::AFTER,<sp/>value));</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="struct_satisfier_1ad6ff15327553132a13305aa067988bd4" kindref="member">CheckOlder</ref>(uint32_t<sp/>value)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>supported.contains(Challenge(ChallengeType::OLDER,<sp/>value));</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceminiscript_1adfd5523d4b709d5e28349355e79255db" kindref="member">miniscript::Availability</ref><sp/>Sign(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>CPubKey&amp;<sp/>key,<sp/>std::vector&lt;unsigned<sp/>char&gt;&amp;<sp/>sig)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(supported.contains(Challenge(ChallengeType::PK,<sp/>ChallengeNumber(key))))<sp/>{</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="namespaceminiscript_1a4b27e96f9ac9f1bcbf3ba746a6d1a170" kindref="member">miniscript::IsTapscript</ref>(<ref refid="struct_satisfier_1ae6634fbeec551fbec71c7e9db119581d" kindref="member">m_script_ctx</ref>))<sp/>{</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>it<sp/>=<sp/>g_testdata-&gt;signatures.find(key);</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(it<sp/>==<sp/>g_testdata-&gt;signatures.end())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespaceminiscript_1adfd5523d4b709d5e28349355e79255dbac2f3f489a00553e7a01d369c103c7251" kindref="member">miniscript::Availability::NO</ref>;</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sig<sp/>=<sp/>it-&gt;second;</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>it<sp/>=<sp/>g_testdata-&gt;schnorr_signatures.find(XOnlyPubKey{key});</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(it<sp/>==<sp/>g_testdata-&gt;schnorr_signatures.end())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespaceminiscript_1adfd5523d4b709d5e28349355e79255dbac2f3f489a00553e7a01d369c103c7251" kindref="member">miniscript::Availability::NO</ref>;</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sig<sp/>=<sp/>it-&gt;second;</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespaceminiscript_1adfd5523d4b709d5e28349355e79255dba7469a286259799e5b37e5db9296f00b3" kindref="member">miniscript::Availability::YES</ref>;</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespaceminiscript_1adfd5523d4b709d5e28349355e79255dbac2f3f489a00553e7a01d369c103c7251" kindref="member">miniscript::Availability::NO</ref>;</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="234"><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceminiscript_1adfd5523d4b709d5e28349355e79255db" kindref="member">miniscript::Availability</ref><sp/>SatHash(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::vector&lt;unsigned<sp/>char&gt;&amp;<sp/>hash,<sp/>std::vector&lt;unsigned<sp/>char&gt;&amp;<sp/>preimage,<sp/>ChallengeType<sp/>chtype)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!supported.contains(Challenge(chtype,<sp/>ChallengeNumber(hash))))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespaceminiscript_1adfd5523d4b709d5e28349355e79255dbac2f3f489a00553e7a01d369c103c7251" kindref="member">miniscript::Availability::NO</ref>;</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref><sp/>=</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>chtype<sp/>==<sp/>ChallengeType::SHA256<sp/>?<sp/>g_testdata-&gt;sha256_preimages<sp/>:</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>chtype<sp/>==<sp/>ChallengeType::HASH256<sp/>?<sp/>g_testdata-&gt;hash256_preimages<sp/>:</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>chtype<sp/>==<sp/>ChallengeType::RIPEMD160<sp/>?<sp/>g_testdata-&gt;ripemd160_preimages<sp/>:</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>g_testdata-&gt;hash160_preimages;</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>it<sp/>=<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>.find(hash);</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(it<sp/>==<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>.end())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespaceminiscript_1adfd5523d4b709d5e28349355e79255dbac2f3f489a00553e7a01d369c103c7251" kindref="member">miniscript::Availability::NO</ref>;</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>preimage<sp/>=<sp/>it-&gt;second;</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespaceminiscript_1adfd5523d4b709d5e28349355e79255dba7469a286259799e5b37e5db9296f00b3" kindref="member">miniscript::Availability::YES</ref>;</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="248"><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Functions<sp/>that<sp/>produce<sp/>the<sp/>preimage<sp/>for<sp/>hashes<sp/>of<sp/>various<sp/>types.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceminiscript_1adfd5523d4b709d5e28349355e79255db" kindref="member">miniscript::Availability</ref><sp/><ref refid="struct_satisfier_1ab8b9afba21be4503aefd877dc6851c67" kindref="member">SatSHA256</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::vector&lt;unsigned<sp/>char&gt;&amp;<sp/>hash,<sp/>std::vector&lt;unsigned<sp/>char&gt;&amp;<sp/>preimage)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>SatHash(hash,<sp/>preimage,<sp/>ChallengeType::SHA256);<sp/>}</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceminiscript_1adfd5523d4b709d5e28349355e79255db" kindref="member">miniscript::Availability</ref><sp/><ref refid="struct_satisfier_1a3fd4b81b13dd59a032c60428ee16427d" kindref="member">SatRIPEMD160</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::vector&lt;unsigned<sp/>char&gt;&amp;<sp/>hash,<sp/>std::vector&lt;unsigned<sp/>char&gt;&amp;<sp/>preimage)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>SatHash(hash,<sp/>preimage,<sp/>ChallengeType::RIPEMD160);<sp/>}</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceminiscript_1adfd5523d4b709d5e28349355e79255db" kindref="member">miniscript::Availability</ref><sp/><ref refid="struct_satisfier_1ac21d5d7a72cc12ac83990bab30ef675c" kindref="member">SatHASH256</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::vector&lt;unsigned<sp/>char&gt;&amp;<sp/>hash,<sp/>std::vector&lt;unsigned<sp/>char&gt;&amp;<sp/>preimage)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>SatHash(hash,<sp/>preimage,<sp/>ChallengeType::HASH256);<sp/>}</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceminiscript_1adfd5523d4b709d5e28349355e79255db" kindref="member">miniscript::Availability</ref><sp/><ref refid="struct_satisfier_1a9439c2169aa4580084a8e3ede2044e38" kindref="member">SatHASH160</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::vector&lt;unsigned<sp/>char&gt;&amp;<sp/>hash,<sp/>std::vector&lt;unsigned<sp/>char&gt;&amp;<sp/>preimage)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>SatHash(hash,<sp/>preimage,<sp/>ChallengeType::HASH160);<sp/>}</highlight></codeline>
<codeline lineno="254"><highlight class="normal">};</highlight></codeline>
<codeline lineno="255"><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">TestSignatureChecker<sp/>:<sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="class_base_signature_checker" kindref="compound">BaseSignatureChecker</ref><sp/>{</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>Satisfier&amp;<sp/>ctx;</highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/>TestSignatureChecker(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>Satisfier&amp;<sp/>in_ctx<sp/><ref refid="attributes_8h_1a37bc3dacb49779a0d18439d4383e5fd9" kindref="member">LIFETIMEBOUND</ref>)<sp/>:<sp/>ctx(in_ctx)<sp/>{}</highlight></codeline>
<codeline lineno="265"><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>CheckECDSASignature(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::vector&lt;unsigned<sp/>char&gt;&amp;<sp/>sig,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::vector&lt;unsigned<sp/>char&gt;&amp;<sp/>pubkey,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>CScript&amp;<sp/>scriptcode,<sp/><ref refid="interpreter_8h_1a3db3199560fd5419a3be2fcd88a28f8f" kindref="member">SigVersion</ref><sp/>sigversion)</highlight><highlight class="keyword"><sp/>const<sp/>override<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CPubKey<sp/><ref refid="namespacetests__wycheproof__generate__ecdh_1a58c180b301e382c190377b9dd48c1833" kindref="member">pk</ref>(pubkey);</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="namespacetests__wycheproof__generate__ecdh_1a58c180b301e382c190377b9dd48c1833" kindref="member">pk</ref>.IsValid())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Instead<sp/>of<sp/>actually<sp/>running<sp/>signature<sp/>validation,<sp/>check<sp/>if<sp/>the<sp/>signature<sp/>matches<sp/>the<sp/>precomputed<sp/>one<sp/>for<sp/>this<sp/>key.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>it<sp/>=<sp/>g_testdata-&gt;signatures.find(pk);</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(it<sp/>==<sp/>g_testdata-&gt;signatures.end())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>sig<sp/>==<sp/>it-&gt;second;</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="274"><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>CheckSchnorrSignature(std::span&lt;const<sp/>unsigned<sp/>char&gt;<sp/>sig,<sp/>std::span&lt;const<sp/>unsigned<sp/>char&gt;<sp/>pubkey,<sp/><ref refid="interpreter_8h_1a3db3199560fd5419a3be2fcd88a28f8f" kindref="member">SigVersion</ref>,</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ScriptExecutionData&amp;,<sp/><ref refid="script__error_8h_1a1453a82c0adda9b334edde231c762f31" kindref="member">ScriptError</ref>*)</highlight><highlight class="keyword"><sp/>const<sp/>override<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>XOnlyPubKey<sp/><ref refid="namespacetests__wycheproof__generate__ecdh_1a58c180b301e382c190377b9dd48c1833" kindref="member">pk</ref>{pubkey};</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>it<sp/>=<sp/>g_testdata-&gt;schnorr_signatures.find(pk);</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(it<sp/>==<sp/>g_testdata-&gt;schnorr_signatures.end())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::ranges::equal(sig,<sp/>it-&gt;second);</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="282"><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>CheckLockTime(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>CScriptNum&amp;<sp/>locktime)</highlight><highlight class="keyword"><sp/>const<sp/>override<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Delegate<sp/>to<sp/>Satisfier.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ctx.CheckAfter(locktime.<ref refid="class_c_script_num_1abeb74fb3bfb302758771174568d4649e" kindref="member">GetInt64</ref>());</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>CheckSequence(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>CScriptNum&amp;<sp/><ref refid="mempool__ephemeral__spends_8cpp_1acb520b7f5d67b3209787f3edb26d34fe" kindref="member">sequence</ref>)</highlight><highlight class="keyword"><sp/>const<sp/>override<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Delegate<sp/>to<sp/>Satisfier.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ctx.CheckOlder(<ref refid="mempool__ephemeral__spends_8cpp_1acb520b7f5d67b3209787f3edb26d34fe" kindref="member">sequence</ref>.GetInt64());</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="292"><highlight class="normal">};</highlight></codeline>
<codeline lineno="293"><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"></highlight><highlight class="keyword">using<sp/></highlight><highlight class="normal"><ref refid="namespaceminiscript_1a02db2bde67db0cee6704064a541c67f8" kindref="member">Fragment</ref><sp/>=<sp/><ref refid="namespaceminiscript_1a02db2bde67db0cee6704064a541c67f8" kindref="member">miniscript::Fragment</ref>;</highlight></codeline>
<codeline lineno="295"><highlight class="normal"></highlight><highlight class="keyword">using<sp/></highlight><highlight class="normal"><ref refid="namespaceminiscript_1a91465934fc510031f3ef3ecad7414a22" kindref="member">NodeRef</ref><sp/>=<sp/><ref refid="namespaceminiscript_1a91465934fc510031f3ef3ecad7414a22" kindref="member">miniscript::NodeRef&lt;CPubKey&gt;</ref>;</highlight></codeline>
<codeline lineno="296"><highlight class="normal"></highlight><highlight class="keyword">using<sp/></highlight><highlight class="normal">miniscript::operator</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">_mst;</highlight></codeline>
<codeline lineno="297"><highlight class="normal"></highlight><highlight class="keyword">using<sp/></highlight><highlight class="normal"><ref refid="class_node" kindref="compound">Node</ref><sp/>=<sp/><ref refid="structminiscript_1_1_node" kindref="compound">miniscript::Node&lt;CPubKey&gt;</ref>;</highlight></codeline>
<codeline lineno="298"><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal">std::set&lt;Challenge&gt;<sp/>FindChallenges(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_node" kindref="compound">Node</ref>*<sp/>root)</highlight></codeline>
<codeline lineno="301"><highlight class="normal">{</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/>std::set&lt;Challenge&gt;<sp/>chal;</highlight></codeline>
<codeline lineno="303"><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(std::vector<sp/>stack{root};<sp/>!stack.empty();)<sp/>{</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">*<sp/>ref{stack.back()};</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>stack.pop_back();</highlight></codeline>
<codeline lineno="307"><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>key<sp/>:<sp/>ref-&gt;keys)<sp/>{</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>chal.emplace(ChallengeType::PK,<sp/>ChallengeNumber(key));</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(ref-&gt;fragment)<sp/>{</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>Fragment::OLDER:<sp/>chal.emplace(ChallengeType::OLDER,<sp/>ref-&gt;k);<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>Fragment::AFTER:<sp/>chal.emplace(ChallengeType::AFTER,<sp/>ref-&gt;k);<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>Fragment::SHA256:<sp/>chal.emplace(ChallengeType::SHA256,<sp/>ChallengeNumber(ref-&gt;data));<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>Fragment::RIPEMD160:<sp/>chal.emplace(ChallengeType::RIPEMD160,<sp/>ChallengeNumber(ref-&gt;data));<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>Fragment::HASH256:<sp/>chal.emplace(ChallengeType::HASH256,<sp/>ChallengeNumber(ref-&gt;data));<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>Fragment::HASH160:<sp/>chal.emplace(ChallengeType::HASH160,<sp/>ChallengeNumber(ref-&gt;data));<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>sub<sp/>:<sp/>ref-&gt;subs)<sp/>{</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>stack.push_back(sub.get());</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>chal;</highlight></codeline>
<codeline lineno="325"><highlight class="normal">}</highlight></codeline>
<codeline lineno="326"><highlight class="normal"></highlight></codeline>
<codeline lineno="328"><highlight class="normal"><ref refid="class_c_script" kindref="compound">CScript</ref><sp/>ScriptPubKey(<ref refid="namespaceminiscript_1a2bd485f92f346bb2c8cb4189d22e1530" kindref="member">miniscript::MiniscriptContext</ref><sp/>ctx,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_script" kindref="compound">CScript</ref>&amp;<sp/><ref refid="namespacescript" kindref="compound">script</ref>,<sp/><ref refid="class_taproot_builder" kindref="compound">TaprootBuilder</ref>&amp;<sp/>builder)</highlight></codeline>
<codeline lineno="329"><highlight class="normal">{</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="namespaceminiscript_1a4b27e96f9ac9f1bcbf3ba746a6d1a170" kindref="member">miniscript::IsTapscript</ref>(ctx))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_c_script" kindref="compound">CScript</ref>()<sp/>&lt;&lt;<sp/><ref refid="script_2script_8h_1a63e349a6089a54da9fe09a3d858648bdaccd484dad2223fffdbdc2637c4f1e40e" kindref="member">OP_0</ref><sp/>&lt;&lt;<sp/><ref refid="struct_witness_v0_script_hash" kindref="compound">WitnessV0ScriptHash</ref>(<ref refid="namespacescript" kindref="compound">script</ref>);</highlight></codeline>
<codeline lineno="331"><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>Taproot<sp/>outputs<sp/>we<sp/>always<sp/>use<sp/>a<sp/>tree<sp/>with<sp/>a<sp/>single<sp/>script<sp/>and<sp/>a<sp/>dummy<sp/>internal<sp/>key.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/>builder.<ref refid="class_taproot_builder_1ab6a1b07f2b850eb59b5ac8c44bd13ed2" kindref="member">Add</ref>(0,<sp/><ref refid="namespacescript" kindref="compound">script</ref>,<sp/>TAPROOT_LEAF_TAPSCRIPT);</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/>builder.<ref refid="class_taproot_builder_1ab8b83511ea72001bc26cbb24176e08cd" kindref="member">Finalize</ref>(<ref refid="class_x_only_pub_key_1a099d3baf6f197c59f70fbd277b9b4d66" kindref="member">XOnlyPubKey::NUMS_H</ref>);</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="addresstype_8cpp_1ae40f28d3b46c21033f6ee1f1200d0321" kindref="member">GetScriptForDestination</ref>(builder.<ref refid="class_taproot_builder_1a43d5b75ae85829eaf0aab5747e42f7f1" kindref="member">GetOutput</ref>());</highlight></codeline>
<codeline lineno="336"><highlight class="normal">}</highlight></codeline>
<codeline lineno="337"><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>SatisfactionToWitness(<ref refid="namespaceminiscript_1a2bd485f92f346bb2c8cb4189d22e1530" kindref="member">miniscript::MiniscriptContext</ref><sp/>ctx,<sp/><ref refid="struct_c_script_witness" kindref="compound">CScriptWitness</ref>&amp;<sp/>witness,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_script" kindref="compound">CScript</ref>&amp;<sp/><ref refid="namespacescript" kindref="compound">script</ref>,<sp/><ref refid="class_taproot_builder" kindref="compound">TaprootBuilder</ref>&amp;<sp/>builder)<sp/>{</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>P2WSH,<sp/>it&apos;s<sp/>only<sp/>the<sp/>witness<sp/>script.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/>witness.<ref refid="struct_c_script_witness_1aa36391680511f7fb505821af71fdb1f2" kindref="member">stack</ref>.emplace_back(<ref refid="namespacescript" kindref="compound">script</ref>.begin(),<sp/><ref refid="namespacescript" kindref="compound">script</ref>.end());</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="namespaceminiscript_1a4b27e96f9ac9f1bcbf3ba746a6d1a170" kindref="member">miniscript::IsTapscript</ref>(ctx))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>Tapscript<sp/>we<sp/>also<sp/>need<sp/>the<sp/>control<sp/>block.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/>witness.<ref refid="struct_c_script_witness_1aa36391680511f7fb505821af71fdb1f2" kindref="member">stack</ref>.push_back(*builder.<ref refid="class_taproot_builder_1a699c66a0ba28809a5e92eeaff8ff60e6" kindref="member">GetSpendData</ref>().<ref refid="struct_taproot_spend_data_1a4ab6670aa413d8141538b347e4096dbe" kindref="member">scripts</ref>.begin()-&gt;second.begin());</highlight></codeline>
<codeline lineno="345"><highlight class="normal">}</highlight></codeline>
<codeline lineno="346"><highlight class="normal"></highlight></codeline>
<codeline lineno="347"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">MiniScriptTest<sp/>:<sp/><ref refid="struct_basic_testing_setup" kindref="compound">BasicTestingSetup</ref><sp/>{</highlight></codeline>
<codeline lineno="349"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>TestSatisfy(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>KeyConverter&amp;<sp/>converter,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>testcase,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>NodeRef&amp;<sp/>node)<sp/>{</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>script<sp/>=<sp/>node-&gt;ToScript(converter);</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>challenges{FindChallenges(node.get())};<sp/></highlight><highlight class="comment">//<sp/>Find<sp/>all<sp/>challenges<sp/>in<sp/>the<sp/>generated<sp/>miniscript.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;Challenge&gt;<sp/>challist(challenges.begin(),<sp/>challenges.end());</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iter<sp/>=<sp/>0;<sp/>iter<sp/>&lt;<sp/>3;<sp/>++iter)<sp/>{</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::shuffle(challist.begin(),<sp/>challist.end(),<sp/>m_rng);</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Satisfier<sp/>satisfier(converter.MsContext());</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TestSignatureChecker<sp/>checker(satisfier);</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>prev_mal_success<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">,<sp/>prev_nonmal_success<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Go<sp/>over<sp/>all<sp/>challenges<sp/>involved<sp/>in<sp/>this<sp/>miniscript<sp/>in<sp/>random<sp/>order.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>add<sp/>=<sp/>-1;<sp/>add<sp/>&lt;<sp/>(int)challist.size();<sp/>++add)<sp/>{</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(add<sp/>&gt;=<sp/>0)<sp/>satisfier.supported.insert(challist[add]);<sp/></highlight><highlight class="comment">//<sp/>The<sp/>first<sp/>iteration<sp/>does<sp/>not<sp/>add<sp/>anything</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>ScriptPubKey<sp/>for<sp/>this<sp/>script,<sp/>filling<sp/>spend<sp/>data<sp/>if<sp/>it&apos;s<sp/>Taproot.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TaprootBuilder<sp/>builder;</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>CScript<sp/>script_pubkey{ScriptPubKey(converter.MsContext(),<sp/>script,<sp/>builder)};</highlight></codeline>
<codeline lineno="365"><highlight class="normal"></highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Run<sp/>malleable<sp/>satisfaction<sp/>algorithm.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CScriptWitness<sp/>witness_mal;</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>mal_success<sp/>=<sp/>node-&gt;Satisfy(satisfier,<sp/>witness_mal.<ref refid="struct_c_script_witness_1aa36391680511f7fb505821af71fdb1f2" kindref="member">stack</ref>,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">)<sp/>==<sp/><ref refid="namespaceminiscript_1adfd5523d4b709d5e28349355e79255dba7469a286259799e5b37e5db9296f00b3" kindref="member">miniscript::Availability::YES</ref>;</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SatisfactionToWitness(converter.MsContext(),<sp/>witness_mal,<sp/>script,<sp/>builder);</highlight></codeline>
<codeline lineno="370"><highlight class="normal"></highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Run<sp/>non-malleable<sp/>satisfaction<sp/>algorithm.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CScriptWitness<sp/>witness_nonmal;</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>nonmal_success<sp/>=<sp/>node-&gt;Satisfy(satisfier,<sp/>witness_nonmal.<ref refid="struct_c_script_witness_1aa36391680511f7fb505821af71fdb1f2" kindref="member">stack</ref>,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">)<sp/>==<sp/><ref refid="namespaceminiscript_1adfd5523d4b709d5e28349355e79255dba7469a286259799e5b37e5db9296f00b3" kindref="member">miniscript::Availability::YES</ref>;</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Compute<sp/>witness<sp/>size<sp/>(excluding<sp/>script<sp/>push,<sp/>control<sp/>block,<sp/>and<sp/>witness<sp/>count<sp/>encoding).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint64_t<sp/>wit_size{<ref refid="serialize_8h_1ac0154eb0a74cc852efc55684de85b1f5" kindref="member">GetSerializeSize</ref>(witness_nonmal.<ref refid="struct_c_script_witness_1aa36391680511f7fb505821af71fdb1f2" kindref="member">stack</ref>)<sp/>-<sp/><ref refid="serialize_8h_1a10a4e43c0ccd0b8a271c2722eb19d6cf" kindref="member">GetSizeOfCompactSize</ref>(witness_nonmal.<ref refid="struct_c_script_witness_1aa36391680511f7fb505821af71fdb1f2" kindref="member">stack</ref>.size())};</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SatisfactionToWitness(converter.MsContext(),<sp/>witness_nonmal,<sp/>script,<sp/>builder);</highlight></codeline>
<codeline lineno="377"><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nonmal_success)<sp/>{</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Non-malleable<sp/>satisfactions<sp/>are<sp/>bounded<sp/>by<sp/>the<sp/>satisfaction<sp/>size<sp/>plus:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>-<sp/>For<sp/>P2WSH<sp/>spends,<sp/>the<sp/>witness<sp/>script</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>-<sp/>For<sp/>Tapscript<sp/>spends,<sp/>both<sp/>the<sp/>witness<sp/>script<sp/>and<sp/>the<sp/>control<sp/>block</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>max_stack_size{*node-&gt;GetStackSize()<sp/>+<sp/>1<sp/>+<sp/><ref refid="namespaceminiscript_1a4b27e96f9ac9f1bcbf3ba746a6d1a170" kindref="member">miniscript::IsTapscript</ref>(converter.MsContext())};</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(witness_nonmal.<ref refid="struct_c_script_witness_1aa36391680511f7fb505821af71fdb1f2" kindref="member">stack</ref>.size()<sp/>&lt;=<sp/>max_stack_size);</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>a<sp/>non-malleable<sp/>satisfaction<sp/>exists,<sp/>the<sp/>malleable<sp/>one<sp/>must<sp/>also<sp/>exist,<sp/>and<sp/>be<sp/>identical<sp/>to<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(mal_success);</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(witness_nonmal.<ref refid="struct_c_script_witness_1aa36391680511f7fb505821af71fdb1f2" kindref="member">stack</ref><sp/>==<sp/>witness_mal.<ref refid="struct_c_script_witness_1aa36391680511f7fb505821af71fdb1f2" kindref="member">stack</ref>);</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(wit_size<sp/>&lt;=<sp/>*node-&gt;GetWitnessSize());</highlight></codeline>
<codeline lineno="388"><highlight class="normal"></highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Test<sp/>non-malleable<sp/>satisfaction.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="script__error_8h_1a1453a82c0adda9b334edde231c762f31" kindref="member">ScriptError</ref><sp/>serror;</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>res<sp/>=<sp/><ref refid="interpreter_8cpp_1acdeac884f2fbcea533277458e8097e87" kindref="member">VerifyScript</ref>(CScript(),<sp/>script_pubkey,<sp/>&amp;witness_nonmal,<sp/>STANDARD_SCRIPT_VERIFY_FLAGS,<sp/>checker,<sp/>&amp;serror);</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Non-malleable<sp/>satisfactions<sp/>are<sp/>guaranteed<sp/>to<sp/>be<sp/>valid<sp/>if<sp/>ValidSatisfactions().</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(node-&gt;ValidSatisfactions())<sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(res);</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>More<sp/>detailed:<sp/>non-malleable<sp/>satisfactions<sp/>must<sp/>be<sp/>valid,<sp/>or<sp/>could<sp/>fail<sp/>with<sp/>ops<sp/>count<sp/>error<sp/>(if<sp/>CheckOpsLimit<sp/>failed),</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>or<sp/>with<sp/>a<sp/>stack<sp/>size<sp/>error<sp/>(if<sp/>CheckStackSize<sp/>check<sp/>fails).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(res<sp/>||</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(!node-&gt;CheckOpsLimit()<sp/>&amp;&amp;<sp/>serror<sp/>==<sp/>ScriptError::SCRIPT_ERR_OP_COUNT)<sp/>||</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(!node-&gt;CheckStackSize()<sp/>&amp;&amp;<sp/>serror<sp/>==<sp/>ScriptError::SCRIPT_ERR_STACK_SIZE));</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="400"><highlight class="normal"></highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mal_success<sp/>&amp;&amp;<sp/>(!nonmal_success<sp/>||<sp/>witness_mal.<ref refid="struct_c_script_witness_1aa36391680511f7fb505821af71fdb1f2" kindref="member">stack</ref><sp/>!=<sp/>witness_nonmal.<ref refid="struct_c_script_witness_1aa36391680511f7fb505821af71fdb1f2" kindref="member">stack</ref>))<sp/>{</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Test<sp/>malleable<sp/>satisfaction<sp/>only<sp/>if<sp/>it&apos;s<sp/>different<sp/>from<sp/>the<sp/>non-malleable<sp/>one.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="script__error_8h_1a1453a82c0adda9b334edde231c762f31" kindref="member">ScriptError</ref><sp/>serror;</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>res<sp/>=<sp/><ref refid="interpreter_8cpp_1acdeac884f2fbcea533277458e8097e87" kindref="member">VerifyScript</ref>(CScript(),<sp/>script_pubkey,<sp/>&amp;witness_mal,<sp/>STANDARD_SCRIPT_VERIFY_FLAGS,<sp/>checker,<sp/>&amp;serror);</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Malleable<sp/>satisfactions<sp/>are<sp/>not<sp/>guaranteed<sp/>to<sp/>be<sp/>valid<sp/>under<sp/>any<sp/>conditions,<sp/>but<sp/>they<sp/>can<sp/>only</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>fail<sp/>due<sp/>to<sp/>stack<sp/>or<sp/>ops<sp/>limits.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(res<sp/>||<sp/>serror<sp/>==<sp/>ScriptError::SCRIPT_ERR_OP_COUNT<sp/>||<sp/>serror<sp/>==<sp/>ScriptError::SCRIPT_ERR_STACK_SIZE);</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="409"><highlight class="normal"></highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(node-&gt;IsSane())<sp/>{</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>sane<sp/>nodes,<sp/>the<sp/>two<sp/>algorithms<sp/>behave<sp/>identically.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(mal_success,<sp/>nonmal_success);</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="414"><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Adding<sp/>more<sp/>satisfied<sp/>conditions<sp/>can<sp/>never<sp/>remove<sp/>our<sp/>ability<sp/>to<sp/>produce<sp/>a<sp/>satisfaction.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(mal_success<sp/>&gt;=<sp/>prev_mal_success);</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>nonmalleable<sp/>solutions<sp/>this<sp/>is<sp/>only<sp/>true<sp/>if<sp/>the<sp/>added<sp/>condition<sp/>is<sp/>PK;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>other<sp/>conditions,<sp/>adding<sp/>one<sp/>may<sp/>make<sp/>an<sp/>valid<sp/>satisfaction<sp/>become<sp/>malleable.<sp/>If<sp/>the<sp/>script</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>is<sp/>sane,<sp/>this<sp/>cannot<sp/>happen<sp/>however.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(node-&gt;IsSane()<sp/>||<sp/>add<sp/>&lt;<sp/>0<sp/>||<sp/>challist[add].first<sp/>==<sp/>ChallengeType::PK)<sp/>{</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(nonmal_success<sp/>&gt;=<sp/>prev_nonmal_success);</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Remember<sp/>results<sp/>for<sp/>the<sp/>next<sp/>added<sp/>challenge.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>prev_mal_success<sp/>=<sp/>mal_success;</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>prev_nonmal_success<sp/>=<sp/>nonmal_success;</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="427"><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>satisfiable<sp/>=<sp/>node-&gt;IsSatisfiable([](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>Node&amp;)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;<sp/>});</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>miniscript<sp/>was<sp/>satisfiable<sp/>at<sp/>all,<sp/>a<sp/>satisfaction<sp/>must<sp/>be<sp/>found<sp/>after<sp/>all<sp/>conditions<sp/>are<sp/>added.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(prev_mal_success,<sp/>satisfiable);</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>miniscript<sp/>is<sp/>sane<sp/>and<sp/>satisfiable,<sp/>a<sp/>nonmalleable<sp/>satisfaction<sp/>must<sp/>eventually<sp/>be<sp/>found.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(node-&gt;IsSane())<sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(prev_nonmal_success,<sp/>satisfiable);</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="434"><highlight class="normal">}</highlight></codeline>
<codeline lineno="435"><highlight class="normal"></highlight></codeline>
<codeline lineno="436"><highlight class="normal"></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/>TestMode<sp/>:<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/>TESTMODE_INVALID<sp/>=<sp/>0,</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/>TESTMODE_VALID<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/>TESTMODE_NONMAL<sp/>=<sp/>2,</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/>TESTMODE_NEEDSIG<sp/>=<sp/>4,</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/>TESTMODE_TIMELOCKMIX<sp/>=<sp/>8,</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/>TESTMODE_P2WSH_INVALID<sp/>=<sp/>16,</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/>TESTMODE_TAPSCRIPT_INVALID<sp/>=<sp/>32,</highlight></codeline>
<codeline lineno="448"><highlight class="normal">};</highlight></codeline>
<codeline lineno="449"><highlight class="normal"></highlight></codeline>
<codeline lineno="450"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>Test(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>ms,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>hexscript,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>mode,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>KeyConverter&amp;<sp/>converter,</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>opslimit<sp/>=<sp/>-1,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>stacklimit<sp/>=<sp/>-1,<sp/>std::optional&lt;uint32_t&gt;<sp/>max_wit_size<sp/>=<sp/>std::nullopt,</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::optional&lt;uint32_t&gt;<sp/>stack_exec<sp/>=<sp/>{})</highlight></codeline>
<codeline lineno="453"><highlight class="normal">{</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>node<sp/>=<sp/><ref refid="namespaceminiscript_1ab1acf22ce8b1e2ffbbd786fb4a8ab198" kindref="member">miniscript::FromString</ref>(ms,<sp/>converter);</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>is_tapscript{<ref refid="namespaceminiscript_1a4b27e96f9ac9f1bcbf3ba746a6d1a170" kindref="member">miniscript::IsTapscript</ref>(converter.MsContext())};</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mode<sp/>==<sp/>TESTMODE_INVALID<sp/>||<sp/>((mode<sp/>&amp;<sp/>TESTMODE_P2WSH_INVALID)<sp/>&amp;&amp;<sp/>!is_tapscript)<sp/>||<sp/>((mode<sp/>&amp;<sp/>TESTMODE_TAPSCRIPT_INVALID)<sp/>&amp;&amp;<sp/>is_tapscript))<sp/>{</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BOOST_CHECK_MESSAGE(!node<sp/>||<sp/>!node-&gt;IsValid(),<sp/></highlight><highlight class="stringliteral">&quot;Unexpectedly<sp/>valid:<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>ms);</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BOOST_CHECK_MESSAGE(node,<sp/></highlight><highlight class="stringliteral">&quot;Unparseable:<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>ms);</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BOOST_CHECK_MESSAGE(node-&gt;IsValid(),<sp/></highlight><highlight class="stringliteral">&quot;Invalid:<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>ms);</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BOOST_CHECK_MESSAGE(node-&gt;IsValidTopLevel(),<sp/></highlight><highlight class="stringliteral">&quot;Invalid<sp/>top<sp/>level:<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>ms);</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>computed_script<sp/>=<sp/>node-&gt;ToScript(converter);</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BOOST_CHECK_MESSAGE(node-&gt;ScriptSize()<sp/>==<sp/>computed_script.size(),<sp/></highlight><highlight class="stringliteral">&quot;Script<sp/>size<sp/>mismatch:<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>ms);</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(hexscript<sp/>!=<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">)<sp/>BOOST_CHECK_MESSAGE(<ref refid="hex__base_8cpp_1ac2c88b156e9e245fa3d0a66105ecd371" kindref="member">HexStr</ref>(computed_script)<sp/>==<sp/>hexscript,<sp/></highlight><highlight class="stringliteral">&quot;Script<sp/>mismatch:<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>ms<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;<sp/>(&quot;</highlight><highlight class="normal"><sp/>+<sp/><ref refid="hex__base_8cpp_1ac2c88b156e9e245fa3d0a66105ecd371" kindref="member">HexStr</ref>(computed_script)<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;<sp/>vs<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>hexscript<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BOOST_CHECK_MESSAGE(node-&gt;IsNonMalleable()<sp/>==<sp/>!!(mode<sp/>&amp;<sp/>TESTMODE_NONMAL),<sp/></highlight><highlight class="stringliteral">&quot;Malleability<sp/>mismatch:<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>ms);</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BOOST_CHECK_MESSAGE(node-&gt;NeedsSignature()<sp/>==<sp/>!!(mode<sp/>&amp;<sp/>TESTMODE_NEEDSIG),<sp/></highlight><highlight class="stringliteral">&quot;Signature<sp/>necessity<sp/>mismatch:<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>ms);</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BOOST_CHECK_MESSAGE((node-&gt;GetType()<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;k&quot;</highlight><highlight class="normal">_mst)<sp/>==<sp/>!(mode<sp/>&amp;<sp/>TESTMODE_TIMELOCKMIX),<sp/></highlight><highlight class="stringliteral">&quot;Timelock<sp/>mix<sp/>mismatch:<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>ms);</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>inferred_miniscript<sp/>=<sp/><ref refid="namespaceminiscript_1a0f4f74f7e9edf9d40b75cd4ca43656a7" kindref="member">miniscript::FromScript</ref>(computed_script,<sp/>converter);</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BOOST_CHECK_MESSAGE(inferred_miniscript,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>infer<sp/>miniscript<sp/>from<sp/>script:<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>ms);</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BOOST_CHECK_MESSAGE(inferred_miniscript-&gt;ToScript(converter)<sp/>==<sp/>computed_script,<sp/></highlight><highlight class="stringliteral">&quot;Roundtrip<sp/>failure:<sp/>miniscript-&gt;script<sp/>!=<sp/>miniscript-&gt;script-&gt;miniscript-&gt;script:<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>ms);</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opslimit<sp/>!=<sp/>-1)<sp/>BOOST_CHECK_MESSAGE((</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)*node-&gt;GetOps()<sp/>==<sp/>opslimit,<sp/></highlight><highlight class="stringliteral">&quot;Ops<sp/>limit<sp/>mismatch:<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>ms<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>(&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>*node-&gt;GetOps()<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>vs<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>opslimit<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(stacklimit<sp/>!=<sp/>-1)<sp/>BOOST_CHECK_MESSAGE((</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)*node-&gt;GetStackSize()<sp/>==<sp/>stacklimit,<sp/></highlight><highlight class="stringliteral">&quot;Stack<sp/>limit<sp/>mismatch:<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>ms<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>(&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>*node-&gt;GetStackSize()<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>vs<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>stacklimit<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(max_wit_size)<sp/>BOOST_CHECK_MESSAGE(*node-&gt;GetWitnessSize()<sp/>==<sp/>*max_wit_size,<sp/></highlight><highlight class="stringliteral">&quot;Witness<sp/>size<sp/>limit<sp/>mismatch:<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>ms<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>(&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>*node-&gt;GetWitnessSize()<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>vs<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>*max_wit_size<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(stack_exec)<sp/>BOOST_CHECK_MESSAGE(*node-&gt;GetExecStackSize()<sp/>==<sp/>*stack_exec,<sp/></highlight><highlight class="stringliteral">&quot;Stack<sp/>execution<sp/>limit<sp/>mismatch:<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>ms<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>(&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>*node-&gt;GetExecStackSize()<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>vs<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>*stack_exec<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TestSatisfy(converter,<sp/>ms,<sp/>node);</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="477"><highlight class="normal">}</highlight></codeline>
<codeline lineno="478"><highlight class="normal"></highlight></codeline>
<codeline lineno="479"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>Test(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>ms,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>hexscript,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>hextapscript,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>mode,</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>opslimit,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>stacklimit,<sp/>std::optional&lt;uint32_t&gt;<sp/>max_wit_size,</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::optional&lt;uint32_t&gt;<sp/>max_tap_wit_size,</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::optional&lt;uint32_t&gt;<sp/>stack_exec)</highlight></codeline>
<codeline lineno="483"><highlight class="normal">{</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/>KeyConverter<sp/>wsh_converter(<ref refid="namespaceminiscript_1a2bd485f92f346bb2c8cb4189d22e1530a4b704d9e9a465228c6eaa83e9a286da6" kindref="member">miniscript::MiniscriptContext::P2WSH</ref>);</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(ms,<sp/>hexscript,<sp/>mode,<sp/>wsh_converter,<sp/>opslimit,<sp/>stacklimit,<sp/>max_wit_size,<sp/>stack_exec);</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/>KeyConverter<sp/>tap_converter(<ref refid="namespaceminiscript_1a2bd485f92f346bb2c8cb4189d22e1530af91c6e2b2fe0cbda47ac0801786555e9" kindref="member">miniscript::MiniscriptContext::TAPSCRIPT</ref>);</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(ms,<sp/>hextapscript<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;=&quot;</highlight><highlight class="normal"><sp/>?<sp/>hexscript<sp/>:<sp/>hextapscript,<sp/>mode,<sp/>tap_converter,<sp/>opslimit,<sp/>stacklimit,<sp/>max_tap_wit_size,<sp/>stack_exec);</highlight></codeline>
<codeline lineno="488"><highlight class="normal">}</highlight></codeline>
<codeline lineno="489"><highlight class="normal"></highlight></codeline>
<codeline lineno="490"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>Test(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>ms,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>hexscript,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string&amp;<sp/>hextapscript,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>mode)</highlight></codeline>
<codeline lineno="491"><highlight class="normal">{</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(ms,<sp/>hexscript,<sp/>hextapscript,<sp/>mode,</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*opslimit=*/</highlight><highlight class="normal">-1,<sp/></highlight><highlight class="comment">/*stacklimit=*/</highlight><highlight class="normal">-1,</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*max_wit_size=*/</highlight><highlight class="normal">std::nullopt,<sp/></highlight><highlight class="comment">/*max_tap_wit_size=*/</highlight><highlight class="normal">std::nullopt,<sp/></highlight><highlight class="comment">/*stack_exec=*/</highlight><highlight class="normal">std::nullopt);</highlight></codeline>
<codeline lineno="495"><highlight class="normal">}</highlight></codeline>
<codeline lineno="496"><highlight class="normal">};<sp/></highlight><highlight class="comment">//<sp/>struct<sp/>MiniScriptTest</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="497"><highlight class="normal"></highlight></codeline>
<codeline lineno="498"><highlight class="normal">}<sp/></highlight><highlight class="comment">//<sp/>namespace</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="499"><highlight class="normal"></highlight></codeline>
<codeline lineno="500"><highlight class="normal"><ref refid="cuckoocache__tests_8cpp_1a70c9c33fb362f37be42ff0da470f72ef" kindref="member">BOOST_FIXTURE_TEST_SUITE</ref>(miniscript_tests,<sp/>MiniScriptTest)</highlight></codeline>
<codeline lineno="501"><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"><ref refid="miniscript__tests_8cpp_1a5d6e8c310bd2006c4d81ddd06d8d3f68" kindref="member">BOOST_AUTO_TEST_CASE</ref>(fixed_tests)</highlight></codeline>
<codeline lineno="503"><highlight class="normal">{</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/>g_testdata.reset(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>TestData());</highlight></codeline>
<codeline lineno="505"><highlight class="normal"></highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Validity<sp/>rules</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;l:older(1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL);<sp/></highlight><highlight class="comment">//<sp/>older(1):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;l:older(0)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>older(0):<sp/>k<sp/>must<sp/>be<sp/>at<sp/>least<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;l:older(2147483647)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL);<sp/></highlight><highlight class="comment">//<sp/>older(2147483647):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;l:older(2147483648)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>older(2147483648):<sp/>k<sp/>must<sp/>be<sp/>below<sp/>2^31</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;u:after(1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL);<sp/></highlight><highlight class="comment">//<sp/>after(1):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;u:after(0)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>after(0):<sp/>k<sp/>must<sp/>be<sp/>at<sp/>least<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;u:after(2147483647)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL);<sp/></highlight><highlight class="comment">//<sp/>after(2147483647):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;u:after(2147483648)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>after(2147483648):<sp/>k<sp/>must<sp/>be<sp/>below<sp/>2^31</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;andor(0,1,1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL);<sp/></highlight><highlight class="comment">//<sp/>andor(Bdu,B,B):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;andor(a:0,1,1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>andor(Wdu,B,B):<sp/>X<sp/>must<sp/>be<sp/>B</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;andor(0,a:1,a:1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>andor(Bdu,W,W):<sp/>Y<sp/>and<sp/>Z<sp/>must<sp/>be<sp/>B/V/K</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;andor(1,1,1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>andor(Bu,B,B):<sp/>X<sp/>must<sp/>be<sp/>d</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;andor(n:or_i(0,after(1)),1,1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID);<sp/></highlight><highlight class="comment">//<sp/>andor(Bdu,B,B):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;andor(or_i(0,after(1)),1,1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>andor(Bd,B,B):<sp/>X<sp/>must<sp/>be<sp/>u</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;c:andor(0,pk_k(03a0434d9e47f3c86235477c7b1ae6ae5d3442d49b1943c2b752a68e2a47e247c7),pk_k(036d2b085e9e382ed10b69fc311a03f8641ccfff21574de0927513a49d9a688a00))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG);<sp/></highlight><highlight class="comment">//<sp/>andor(Bdu,K,K):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;t:andor(0,v:1,v:1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL);<sp/></highlight><highlight class="comment">//<sp/>andor(Bdu,V,V):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_v(v:1,1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL);<sp/></highlight><highlight class="comment">//<sp/>and_v(V,B):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;t:and_v(v:1,v:1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL);<sp/></highlight><highlight class="comment">//<sp/>and_v(V,V):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;c:and_v(v:1,pk_k(036d2b085e9e382ed10b69fc311a03f8641ccfff21574de0927513a49d9a688a00))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG);<sp/></highlight><highlight class="comment">//<sp/>and_v(V,K):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_v(1,1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>and_v(B,B):<sp/>X<sp/>must<sp/>be<sp/>V</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_v(pk_k(02352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5),1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>and_v(K,B):<sp/>X<sp/>must<sp/>be<sp/>V</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_v(v:1,a:1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>and_v(K,W):<sp/>Y<sp/>must<sp/>be<sp/>B/V/K</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_b(1,a:1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL);<sp/></highlight><highlight class="comment">//<sp/>and_b(B,W):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_b(1,1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>and_b(B,B):<sp/>Y<sp/>must<sp/>W</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_b(v:1,a:1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>and_b(V,W):<sp/>X<sp/>must<sp/>be<sp/>B</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_b(a:1,a:1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>and_b(W,W):<sp/>X<sp/>must<sp/>be<sp/>B</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_b(pk_k(025601570cb47f238d2b0286db4a990fa0f3ba28d1a319f5e7cf55c2a2444da7cc),a:1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>and_b(K,W):<sp/>X<sp/>must<sp/>be<sp/>B</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_b(0,a:0)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG);<sp/></highlight><highlight class="comment">//<sp/>or_b(Bd,Wd):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_b(1,a:0)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>or_b(B,Wd):<sp/>X<sp/>must<sp/>be<sp/>d</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_b(0,a:1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>or_b(Bd,W):<sp/>Y<sp/>must<sp/>be<sp/>d</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_b(0,0)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>or_b(Bd,Bd):<sp/>Y<sp/>must<sp/>W</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_b(v:0,a:0)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>or_b(V,Wd):<sp/>X<sp/>must<sp/>be<sp/>B</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_b(a:0,a:0)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>or_b(Wd,Wd):<sp/>X<sp/>must<sp/>be<sp/>B</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_b(pk_k(025601570cb47f238d2b0286db4a990fa0f3ba28d1a319f5e7cf55c2a2444da7cc),a:0)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>or_b(Kd,Wd):<sp/>X<sp/>must<sp/>be<sp/>B</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;t:or_c(0,v:1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL);<sp/></highlight><highlight class="comment">//<sp/>or_c(Bdu,V):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;t:or_c(a:0,v:1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>or_c(Wdu,V):<sp/>X<sp/>must<sp/>be<sp/>B</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;t:or_c(1,v:1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>or_c(Bu,V):<sp/>X<sp/>must<sp/>be<sp/>d</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;t:or_c(n:or_i(0,after(1)),v:1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID);<sp/></highlight><highlight class="comment">//<sp/>or_c(Bdu,V):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;t:or_c(or_i(0,after(1)),v:1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>or_c(Bd,V):<sp/>X<sp/>must<sp/>be<sp/>u</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;t:or_c(0,1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>or_c(Bdu,B):<sp/>Y<sp/>must<sp/>be<sp/>V</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_d(0,1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL);<sp/></highlight><highlight class="comment">//<sp/>or_d(Bdu,B):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_d(a:0,1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>or_d(Wdu,B):<sp/>X<sp/>must<sp/>be<sp/>B</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_d(1,1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>or_d(Bu,B):<sp/>X<sp/>must<sp/>be<sp/>d</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_d(n:or_i(0,after(1)),1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID);<sp/></highlight><highlight class="comment">//<sp/>or_d(Bdu,B):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_d(or_i(0,after(1)),1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>or_d(Bd,B):<sp/>X<sp/>must<sp/>be<sp/>u</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_d(0,v:1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>or_d(Bdu,V):<sp/>Y<sp/>must<sp/>be<sp/>B</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_i(1,1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID);<sp/></highlight><highlight class="comment">//<sp/>or_i(B,B):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;t:or_i(v:1,v:1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID);<sp/></highlight><highlight class="comment">//<sp/>or_i(V,V):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;c:or_i(pk_k(03a0434d9e47f3c86235477c7b1ae6ae5d3442d49b1943c2b752a68e2a47e247c7),pk_k(036d2b085e9e382ed10b69fc311a03f8641ccfff21574de0927513a49d9a688a00))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG);<sp/></highlight><highlight class="comment">//<sp/>or_i(K,K):<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_i(a:1,a:1)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);<sp/></highlight><highlight class="comment">//<sp/>or_i(W,W):<sp/>X<sp/>and<sp/>Y<sp/>must<sp/>be<sp/>B/V/K</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_b(l:after(100),al:after(1000000000))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID);<sp/></highlight><highlight class="comment">//<sp/>or_b(timelock,<sp/>heighlock)<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_b(after(100),a:after(1000000000))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_TIMELOCKMIX);<sp/></highlight><highlight class="comment">//<sp/>and_b(timelock,<sp/>heighlock)<sp/>invalid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;pk(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;2103d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65ac&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;20d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65ac&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG);<sp/></highlight><highlight class="comment">//<sp/>alias<sp/>to<sp/>c:pk_k</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;pkh(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;76a914fcd35ddacad9f2d5be5e464639441c6065e6955d88ac&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;76a914fd1690c37fa3b0f04395ddc9415b220ab1ccc59588ac&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG);<sp/></highlight><highlight class="comment">//<sp/>alias<sp/>to<sp/>c:pk_h</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"></highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Randomly<sp/>generated<sp/>test<sp/>set<sp/>that<sp/>covers<sp/>the<sp/>majority<sp/>of<sp/>type<sp/>and<sp/>node<sp/>type<sp/>combinations</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;lltvln:after(1231488000)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;6300676300676300670400046749b1926869516868&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;=&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL,<sp/>12,<sp/>3,<sp/>3,<sp/>3,<sp/>3);</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;uuj:and_v(v:multi(2,03d01115d548e7561b15c38f004d734633687cf4419620095bc5b0f47070afe85a,025601570cb47f238d2b0286db4a990fa0f3ba28d1a319f5e7cf55c2a2444da7cc),after(1231488000))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;6363829263522103d01115d548e7561b15c38f004d734633687cf4419620095bc5b0f47070afe85a21025601570cb47f238d2b0286db4a990fa0f3ba28d1a319f5e7cf55c2a2444da7cc52af0400046749b168670068670068&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG<sp/>|<sp/>TESTMODE_TAPSCRIPT_INVALID,<sp/>14,<sp/>5,<sp/>2<sp/>+<sp/>2<sp/>+<sp/>1<sp/>+<sp/>2<sp/>*<sp/>73,<sp/>0,<sp/>7);</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_b(un:multi(2,03daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729,024ce119c96e2fa357200b559b2f7dd5a5f02d5290aff74b03f3e471b273211c97),al:older(16))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;63522103daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee872921024ce119c96e2fa357200b559b2f7dd5a5f02d5290aff74b03f3e471b273211c9752ae926700686b63006760b2686c9b&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_TAPSCRIPT_INVALID,<sp/>14,<sp/>5,<sp/>2<sp/>+<sp/>1<sp/>+<sp/>2<sp/>*<sp/>73<sp/>+<sp/>2,<sp/>0,<sp/>8);</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;j:and_v(vdv:after(1567547623),older(2016))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;829263766304e7e06e5db169686902e007b268&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;=&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL,<sp/>11,<sp/>1,<sp/>2,<sp/>2,<sp/>2);</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;t:and_v(vu:hash256(131772552c01444cd81360818376a040b7c3b2b7b0a53550ee3edde216cec61b),v:sha256(ec4916dd28fc4c10d78e287ca5d9cc51ee1ae73cbfde08c6b37324cbfaac8bc5))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;6382012088aa20131772552c01444cd81360818376a040b7c3b2b7b0a53550ee3edde216cec61b876700686982012088a820ec4916dd28fc4c10d78e287ca5d9cc51ee1ae73cbfde08c6b37324cbfaac8bc58851&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;6382012088aa20131772552c01444cd81360818376a040b7c3b2b7b0a53550ee3edde216cec61b876700686982012088a820ec4916dd28fc4c10d78e287ca5d9cc51ee1ae73cbfde08c6b37324cbfaac8bc58851&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL,<sp/>12,<sp/>3,<sp/>2<sp/>+<sp/>33<sp/>+<sp/>33,<sp/>2<sp/>+<sp/>33<sp/>+<sp/>33,<sp/>4);</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;t:andor(multi(3,02d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e,03fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556,02e493dbf1c10d80f3581e4904930b1404cc6c13900ee0758474fa94abe8c4cd13),v:older(4194305),v:sha256(9267d3dbed802941483f1afa2a6bc68de5f653128aca9bf1461c5d0a3ad36ed2))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;532102d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e2103fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a14602975562102e493dbf1c10d80f3581e4904930b1404cc6c13900ee0758474fa94abe8c4cd1353ae6482012088a8209267d3dbed802941483f1afa2a6bc68de5f653128aca9bf1461c5d0a3ad36ed2886703010040b2696851&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_TAPSCRIPT_INVALID,<sp/>13,<sp/>5,<sp/>1<sp/>+<sp/>3<sp/>*<sp/>73,<sp/>0,<sp/>10);</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_d(multi(1,02f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9),or_b(multi(3,022f01e5e15cca351daff3843fb70f3c2f0a1bdd05e5af888a67784ef3e10a2a01,032fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f,03d01115d548e7561b15c38f004d734633687cf4419620095bc5b0f47070afe85a),su:after(500000)))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;512102f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f951ae73645321022f01e5e15cca351daff3843fb70f3c2f0a1bdd05e5af888a67784ef3e10a2a0121032fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f2103d01115d548e7561b15c38f004d734633687cf4419620095bc5b0f47070afe85a53ae7c630320a107b16700689b68&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_TAPSCRIPT_INVALID,<sp/>15,<sp/>7,<sp/>2<sp/>+<sp/>1<sp/>+<sp/>3<sp/>*<sp/>73<sp/>+<sp/>1,<sp/>0,<sp/>10);</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_d(sha256(38df1c1f64a24a77b23393bca50dff872e31edc4f3b5aa3b90ad0b82f4f089b6),and_n(un:after(499999999),older(4194305)))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;82012088a82038df1c1f64a24a77b23393bca50dff872e31edc4f3b5aa3b90ad0b82f4f089b68773646304ff64cd1db19267006864006703010040b26868&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;82012088a82038df1c1f64a24a77b23393bca50dff872e31edc4f3b5aa3b90ad0b82f4f089b68773646304ff64cd1db19267006864006703010040b26868&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID,<sp/>16,<sp/>1,<sp/>33,<sp/>33,<sp/>3);</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_v(or_i(v:multi(2,02c6047f9441ed7d6d3045406e95c07cd85c778e4b8cef3ca7abac09b95c709ee5,03774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb),v:multi(2,03e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a,025cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc)),sha256(d1ec675902ef1633427ca360b290b0b3045a0d9058ddb5e648b4c3c3224c5c68))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;63522102c6047f9441ed7d6d3045406e95c07cd85c778e4b8cef3ca7abac09b95c709ee52103774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb52af67522103e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a21025cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc52af6882012088a820d1ec675902ef1633427ca360b290b0b3045a0d9058ddb5e648b4c3c3224c5c6887&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG<sp/>|<sp/>TESTMODE_TAPSCRIPT_INVALID,<sp/>11,<sp/>5,<sp/>2<sp/>+<sp/>1<sp/>+<sp/>2<sp/>*<sp/>73<sp/>+<sp/>33,<sp/>0,<sp/>8);</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;j:and_b(multi(2,0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798,024ce119c96e2fa357200b559b2f7dd5a5f02d5290aff74b03f3e471b273211c97),s:or_i(older(1),older(4252898)))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;82926352210279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f8179821024ce119c96e2fa357200b559b2f7dd5a5f02d5290aff74b03f3e471b273211c9752ae7c6351b26703e2e440b2689a68&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NEEDSIG<sp/>|<sp/>TESTMODE_TAPSCRIPT_INVALID,<sp/>14,<sp/>4,<sp/>1<sp/>+<sp/>2<sp/>*<sp/>73<sp/>+<sp/>2,<sp/>0,<sp/>8);</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_b(older(16),s:or_d(sha256(e38990d0c7fc009880a9c07c23842e886c6bbdc964ce6bdd5817ad357335ee6f),n:after(1567547623)))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;60b27c82012088a820e38990d0c7fc009880a9c07c23842e886c6bbdc964ce6bdd5817ad357335ee6f87736404e7e06e5db192689a&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;=&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID,<sp/>12,<sp/>1,<sp/>33,<sp/>33,<sp/>4);</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;j:and_v(v:hash160(20195b5a3d650c17f0f29f91c33f8f6335193d07),or_d(sha256(96de8fc8c256fa1e1556d41af431cace7dca68707c78dd88c3acab8b17164c47),older(16)))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;82926382012088a91420195b5a3d650c17f0f29f91c33f8f6335193d078882012088a82096de8fc8c256fa1e1556d41af431cace7dca68707c78dd88c3acab8b17164c4787736460b26868&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;=&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID,<sp/>16,<sp/>2,<sp/>33<sp/>+<sp/>33,<sp/>33<sp/>+<sp/>33,<sp/>4);</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_b(hash256(32ba476771d01e37807990ead8719f08af494723de1d228f2c2c07cc0aa40bac),a:and_b(hash256(131772552c01444cd81360818376a040b7c3b2b7b0a53550ee3edde216cec61b),a:older(1)))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;82012088aa2032ba476771d01e37807990ead8719f08af494723de1d228f2c2c07cc0aa40bac876b82012088aa20131772552c01444cd81360818376a040b7c3b2b7b0a53550ee3edde216cec61b876b51b26c9a6c9a&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;=&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL,<sp/>15,<sp/>2,<sp/>33<sp/>+<sp/>33,<sp/>33<sp/>+<sp/>33,<sp/>4);</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;thresh(2,multi(2,03a0434d9e47f3c86235477c7b1ae6ae5d3442d49b1943c2b752a68e2a47e247c7,036d2b085e9e382ed10b69fc311a03f8641ccfff21574de0927513a49d9a688a00),a:multi(1,036d2b085e9e382ed10b69fc311a03f8641ccfff21574de0927513a49d9a688a00),ac:pk_k(022f01e5e15cca351daff3843fb70f3c2f0a1bdd05e5af888a67784ef3e10a2a01))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;522103a0434d9e47f3c86235477c7b1ae6ae5d3442d49b1943c2b752a68e2a47e247c721036d2b085e9e382ed10b69fc311a03f8641ccfff21574de0927513a49d9a688a0052ae6b5121036d2b085e9e382ed10b69fc311a03f8641ccfff21574de0927513a49d9a688a0051ae6c936b21022f01e5e15cca351daff3843fb70f3c2f0a1bdd05e5af888a67784ef3e10a2a01ac6c935287&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG<sp/>|<sp/>TESTMODE_TAPSCRIPT_INVALID,<sp/>13,<sp/>6,<sp/>1<sp/>+<sp/>2<sp/>*<sp/>73<sp/>+<sp/>1<sp/>+<sp/>73<sp/>+<sp/>1,<sp/>0,<sp/>10);</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_n(sha256(d1ec675902ef1633427ca360b290b0b3045a0d9058ddb5e648b4c3c3224c5c68),t:or_i(v:older(4252898),v:older(144)))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;82012088a820d1ec675902ef1633427ca360b290b0b3045a0d9058ddb5e648b4c3c3224c5c68876400676303e2e440b26967029000b269685168&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;=&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID,<sp/>14,<sp/>2,<sp/>33<sp/>+<sp/>2,<sp/>33<sp/>+<sp/>2,<sp/>4);</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_d(nd:and_v(v:older(4252898),v:older(4252898)),sha256(38df1c1f64a24a77b23393bca50dff872e31edc4f3b5aa3b90ad0b82f4f089b6))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;766303e2e440b26903e2e440b2696892736482012088a82038df1c1f64a24a77b23393bca50dff872e31edc4f3b5aa3b90ad0b82f4f089b68768&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;=&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID,<sp/>15,<sp/>2,<sp/>1<sp/>+<sp/>33,<sp/>1<sp/>+<sp/>33,<sp/>3);</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;c:and_v(or_c(sha256(9267d3dbed802941483f1afa2a6bc68de5f653128aca9bf1461c5d0a3ad36ed2),v:multi(1,02c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db)),pk_k(03acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;82012088a8209267d3dbed802941483f1afa2a6bc68de5f653128aca9bf1461c5d0a3ad36ed28764512102c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db51af682103acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbeac&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NEEDSIG<sp/>|<sp/>TESTMODE_TAPSCRIPT_INVALID,<sp/>8,<sp/>2,<sp/>33<sp/>+<sp/>73,<sp/>0,<sp/>4);</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;c:and_v(or_c(multi(2,036d2b085e9e382ed10b69fc311a03f8641ccfff21574de0927513a49d9a688a00,02352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5),v:ripemd160(1b0f3c404d12075c68c938f9f60ebea4f74941a0)),pk_k(03fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;5221036d2b085e9e382ed10b69fc311a03f8641ccfff21574de0927513a49d9a688a002102352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d552ae6482012088a6141b0f3c404d12075c68c938f9f60ebea4f74941a088682103fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556ac&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG<sp/>|<sp/>TESTMODE_TAPSCRIPT_INVALID,<sp/>10,<sp/>5,<sp/>1<sp/>+<sp/>2<sp/>*<sp/>73<sp/>+<sp/>73,<sp/>0,<sp/>9);</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_v(andor(hash256(8a35d9ca92a48eaade6f53a64985e9e2afeb74dcf8acb4c3721e0dc7e4294b25),v:hash256(939894f70e6c3a25da75da0cc2071b4076d9b006563cf635986ada2e93c0d735),v:older(50000)),after(499999999))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;82012088aa208a35d9ca92a48eaade6f53a64985e9e2afeb74dcf8acb4c3721e0dc7e4294b2587640350c300b2696782012088aa20939894f70e6c3a25da75da0cc2071b4076d9b006563cf635986ada2e93c0d735886804ff64cd1db1&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;=&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID,<sp/>14,<sp/>2,<sp/>33<sp/>+<sp/>33,<sp/>33<sp/>+<sp/>33,<sp/>4);</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;andor(hash256(5f8d30e655a7ba0d7596bb3ddfb1d2d20390d23b1845000e1e118b3be1b3f040),j:and_v(v:hash160(3a2bff0da9d96868e66abc4427bea4691cf61ccd),older(4194305)),ripemd160(44d90e2d3714c8663b632fcf0f9d5f22192cc4c8))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;82012088aa205f8d30e655a7ba0d7596bb3ddfb1d2d20390d23b1845000e1e118b3be1b3f040876482012088a61444d90e2d3714c8663b632fcf0f9d5f22192cc4c8876782926382012088a9143a2bff0da9d96868e66abc4427bea4691cf61ccd8803010040b26868&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;=&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID,<sp/>20,<sp/>2,<sp/>33<sp/>+<sp/>33,<sp/>33<sp/>+<sp/>33,<sp/>4);</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_i(c:and_v(v:after(500000),pk_k(02c6047f9441ed7d6d3045406e95c07cd85c778e4b8cef3ca7abac09b95c709ee5)),sha256(d9147961436944f43cd99d28b2bbddbf452ef872b30c8279e255e7daafc7f946))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;630320a107b1692102c6047f9441ed7d6d3045406e95c07cd85c778e4b8cef3ca7abac09b95c709ee5ac6782012088a820d9147961436944f43cd99d28b2bbddbf452ef872b30c8279e255e7daafc7f9468768&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;630320a107b16920c6047f9441ed7d6d3045406e95c07cd85c778e4b8cef3ca7abac09b95c709ee5ac6782012088a820d9147961436944f43cd99d28b2bbddbf452ef872b30c8279e255e7daafc7f9468768&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL,<sp/>10,<sp/>2,<sp/>2<sp/>+<sp/>73,<sp/>2<sp/>+<sp/>66,<sp/>3);</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;thresh(2,c:pk_h(025cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc),s:sha256(e38990d0c7fc009880a9c07c23842e886c6bbdc964ce6bdd5817ad357335ee6f),a:hash160(dd69735817e0e3f6f826a9238dc2e291184f0131))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;76a9145dedfbf9ea599dd4e3ca6a80b333c472fd0b3f6988ac7c82012088a820e38990d0c7fc009880a9c07c23842e886c6bbdc964ce6bdd5817ad357335ee6f87936b82012088a914dd69735817e0e3f6f826a9238dc2e291184f0131876c935287&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;76a9141a7ac36cfa8431ab2395d701b0050045ae4a37d188ac7c82012088a820e38990d0c7fc009880a9c07c23842e886c6bbdc964ce6bdd5817ad357335ee6f87936b82012088a914dd69735817e0e3f6f826a9238dc2e291184f0131876c935287&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID,<sp/>18,<sp/>4,<sp/>1<sp/>+<sp/>34<sp/>+<sp/>33<sp/>+<sp/>33,<sp/>1<sp/>+<sp/>33<sp/>+<sp/>33<sp/>+<sp/>33,<sp/>6);</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_n(sha256(9267d3dbed802941483f1afa2a6bc68de5f653128aca9bf1461c5d0a3ad36ed2),uc:and_v(v:older(144),pk_k(03fe72c435413d33d48ac09c9161ba8b09683215439d62b7940502bda8b202e6ce)))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;82012088a8209267d3dbed802941483f1afa2a6bc68de5f653128aca9bf1461c5d0a3ad36ed28764006763029000b2692103fe72c435413d33d48ac09c9161ba8b09683215439d62b7940502bda8b202e6ceac67006868&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;82012088a8209267d3dbed802941483f1afa2a6bc68de5f653128aca9bf1461c5d0a3ad36ed28764006763029000b26920fe72c435413d33d48ac09c9161ba8b09683215439d62b7940502bda8b202e6ceac67006868&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NEEDSIG,<sp/>13,<sp/>3,<sp/>33<sp/>+<sp/>2<sp/>+<sp/>73,<sp/>33<sp/>+<sp/>2<sp/>+<sp/>66,<sp/>5);</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_n(c:pk_k(03daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729),and_b(l:older(4252898),a:older(16)))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;2103daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729ac64006763006703e2e440b2686b60b26c9a68&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;20daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729ac64006763006703e2e440b2686b60b26c9a68&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG<sp/>|<sp/>TESTMODE_TIMELOCKMIX,<sp/>12,<sp/>2,<sp/>73<sp/>+<sp/>1,<sp/>66<sp/>+<sp/>1,<sp/>3);</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;c:or_i(and_v(v:older(16),pk_h(02d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e)),pk_h(026a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;6360b26976a9149fc5dbe5efdce10374a4dd4053c93af540211718886776a9142fbd32c8dd59ee7c17e66cb6ebea7e9846c3040f8868ac&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;6360b26976a9144d4421361c3289bdad06441ffaee8be8e786f1ad886776a91460d4a7bcbd08f58e58bd208d1069837d7adb16ae8868ac&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG,<sp/>12,<sp/>3,<sp/>2<sp/>+<sp/>34<sp/>+<sp/>73,<sp/>2<sp/>+<sp/>33<sp/>+<sp/>66,<sp/>4);</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_d(c:pk_h(02e493dbf1c10d80f3581e4904930b1404cc6c13900ee0758474fa94abe8c4cd13),andor(c:pk_k(024ce119c96e2fa357200b559b2f7dd5a5f02d5290aff74b03f3e471b273211c97),older(2016),after(1567547623)))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;76a914c42e7ef92fdb603af844d064faad95db9bcdfd3d88ac736421024ce119c96e2fa357200b559b2f7dd5a5f02d5290aff74b03f3e471b273211c97ac6404e7e06e5db16702e007b26868&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;76a91421ab1a140d0d305b8ff62bdb887d9fef82c9899e88ac7364204ce119c96e2fa357200b559b2f7dd5a5f02d5290aff74b03f3e471b273211c97ac6404e7e06e5db16702e007b26868&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL,<sp/>13,<sp/>3,<sp/>1<sp/>+<sp/>34<sp/>+<sp/>73,<sp/>1<sp/>+<sp/>33<sp/>+<sp/>66,<sp/>5);</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;c:andor(ripemd160(6ad07d21fd5dfc646f0b30577045ce201616b9ba),pk_h(02d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e),and_v(v:hash256(8a35d9ca92a48eaade6f53a64985e9e2afeb74dcf8acb4c3721e0dc7e4294b25),pk_h(03d01115d548e7561b15c38f004d734633687cf4419620095bc5b0f47070afe85a)))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;82012088a6146ad07d21fd5dfc646f0b30577045ce201616b9ba876482012088aa208a35d9ca92a48eaade6f53a64985e9e2afeb74dcf8acb4c3721e0dc7e4294b258876a914dd100be7d9aea5721158ebde6d6a1fd8fff93bb1886776a9149fc5dbe5efdce10374a4dd4053c93af5402117188868ac&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;82012088a6146ad07d21fd5dfc646f0b30577045ce201616b9ba876482012088aa208a35d9ca92a48eaade6f53a64985e9e2afeb74dcf8acb4c3721e0dc7e4294b258876a914a63d1e4d2ed109246c600ec8c19cce546b65b1cc886776a9144d4421361c3289bdad06441ffaee8be8e786f1ad8868ac&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NEEDSIG,<sp/>18,<sp/>3,<sp/>33<sp/>+<sp/>34<sp/>+<sp/>73,<sp/>33<sp/>+<sp/>33<sp/>+<sp/>66,<sp/>5);</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;c:andor(u:ripemd160(6ad07d21fd5dfc646f0b30577045ce201616b9ba),pk_h(03daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729),or_i(pk_h(022f01e5e15cca351daff3843fb70f3c2f0a1bdd05e5af888a67784ef3e10a2a01),pk_h(0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798)))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;6382012088a6146ad07d21fd5dfc646f0b30577045ce201616b9ba87670068646376a9149652d86bedf43ad264362e6e6eba6eb764508127886776a914751e76e8199196d454941c45d1b3a323f1433bd688686776a91420d637c1a6404d2227f3561fdbaff5a680dba6488868ac&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;6382012088a6146ad07d21fd5dfc646f0b30577045ce201616b9ba87670068646376a914ceedcb44b38bdbcb614d872223964fd3dca8a434886776a914f678d9b79045452c8c64e9309d0f0046056e26c588686776a914a2a75e1819afa208f6c89ae0da43021116dfcb0c8868ac&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NEEDSIG,<sp/>23,<sp/>4,<sp/>2<sp/>+<sp/>33<sp/>+<sp/>34<sp/>+<sp/>73,<sp/>2<sp/>+<sp/>33<sp/>+<sp/>33<sp/>+<sp/>66,<sp/>5);</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;c:or_i(andor(c:pk_h(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65),pk_h(022f01e5e15cca351daff3843fb70f3c2f0a1bdd05e5af888a67784ef3e10a2a01),pk_h(02c6047f9441ed7d6d3045406e95c07cd85c778e4b8cef3ca7abac09b95c709ee5)),pk_k(02d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;6376a914fcd35ddacad9f2d5be5e464639441c6065e6955d88ac6476a91406afd46bcdfd22ef94ac122aa11f241244a37ecc886776a9149652d86bedf43ad264362e6e6eba6eb7645081278868672102d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e68ac&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;6376a914fd1690c37fa3b0f04395ddc9415b220ab1ccc59588ac6476a9149b652a14674a506079f574d20ca7daef6f9a66bb886776a914ceedcb44b38bdbcb614d872223964fd3dca8a43488686720d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e68ac&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG,<sp/>17,<sp/>5,<sp/>2<sp/>+<sp/>34<sp/>+<sp/>73<sp/>+<sp/>34<sp/>+<sp/>73,<sp/>2<sp/>+<sp/>33<sp/>+<sp/>66<sp/>+<sp/>33<sp/>+<sp/>66,<sp/>6);</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;thresh(1,c:pk_k(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65),altv:after(1000000000),altv:after(100))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;2103d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65ac6b6300670400ca9a3bb16951686c936b6300670164b16951686c935187&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;20d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65ac6b6300670400ca9a3bb16951686c936b6300670164b16951686c935187&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID,<sp/>18,<sp/>3,<sp/>73<sp/>+<sp/>2<sp/>+<sp/>2,<sp/>66<sp/>+<sp/>2<sp/>+<sp/>2,<sp/>4);</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;thresh(2,c:pk_k(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65),ac:pk_k(03fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556),altv:after(1000000000),altv:after(100))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;2103d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65ac6b2103fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556ac6c936b6300670400ca9a3bb16951686c936b6300670164b16951686c935287&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;20d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65ac6b20fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556ac6c936b6300670400ca9a3bb16951686c936b6300670164b16951686c935287&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_TIMELOCKMIX,<sp/>22,<sp/>4,<sp/>73<sp/>+<sp/>73<sp/>+<sp/>2<sp/>+<sp/>2,<sp/>66<sp/>+<sp/>66<sp/>+<sp/>2<sp/>+<sp/>2,<sp/>5);</highlight></codeline>
<codeline lineno="594"><highlight class="normal"></highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Additional<sp/>Tapscript-related<sp/>tests</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Edge<sp/>cases<sp/>when<sp/>parsing<sp/>multi_a<sp/>from<sp/>script:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/>-<sp/>no<sp/>pubkey<sp/>at<sp/>all</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/>-<sp/>no<sp/>pubkey<sp/>before<sp/>a<sp/>CHECKSIGADD</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/>-<sp/>no<sp/>pubkey<sp/>before<sp/>the<sp/>CHECKSIG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/>KeyConverter<sp/>tap_converter{<ref refid="namespaceminiscript_1a2bd485f92f346bb2c8cb4189d22e1530af91c6e2b2fe0cbda47ac0801786555e9" kindref="member">miniscript::MiniscriptContext::TAPSCRIPT</ref>};</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/>KeyConverter<sp/>wsh_converter{<ref refid="namespaceminiscript_1a2bd485f92f346bb2c8cb4189d22e1530a4b704d9e9a465228c6eaa83e9a286da6" kindref="member">miniscript::MiniscriptContext::P2WSH</ref>};</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>no_pubkey{</highlight><highlight class="stringliteral">&quot;ac519c&quot;</highlight><highlight class="normal">_hex_u8};</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(<ref refid="namespaceminiscript_1a0f4f74f7e9edf9d40b75cd4ca43656a7" kindref="member">miniscript::FromScript</ref>({no_pubkey.begin(),<sp/>no_pubkey.end()},<sp/>tap_converter)<sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>incomplete_multi_a{</highlight><highlight class="stringliteral">&quot;ba20c6047f9441ed7d6d3045406e95c07cd85c778e4b8cef3ca7abac09b95c709ee5ba519c&quot;</highlight><highlight class="normal">_hex_u8};</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(<ref refid="namespaceminiscript_1a0f4f74f7e9edf9d40b75cd4ca43656a7" kindref="member">miniscript::FromScript</ref>({incomplete_multi_a.begin(),<sp/>incomplete_multi_a.end()},<sp/>tap_converter)<sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>incomplete_multi_a_2{</highlight><highlight class="stringliteral">&quot;ac2079be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798ac20c6047f9441ed7d6d3045406e95c07cd85c778e4b8cef3ca7abac09b95c709ee5ba519c&quot;</highlight><highlight class="normal">_hex_u8};</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(<ref refid="namespaceminiscript_1a0f4f74f7e9edf9d40b75cd4ca43656a7" kindref="member">miniscript::FromScript</ref>({incomplete_multi_a_2.begin(),<sp/>incomplete_multi_a_2.end()},<sp/>tap_converter)<sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Can<sp/>use<sp/>multi_a<sp/>under<sp/>Tapscript<sp/>but<sp/>not<sp/>P2WSH.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_v(v:multi_a(2,03d01115d548e7561b15c38f004d734633687cf4419620095bc5b0f47070afe85a,025601570cb47f238d2b0286db4a990fa0f3ba28d1a319f5e7cf55c2a2444da7cc),after(1231488000))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;20d01115d548e7561b15c38f004d734633687cf4419620095bc5b0f47070afe85aac205601570cb47f238d2b0286db4a990fa0f3ba28d1a319f5e7cf55c2a2444da7ccba529d0400046749b1&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG<sp/>|<sp/>TESTMODE_P2WSH_INVALID,<sp/>4,<sp/>2,<sp/>{},<sp/>{},<sp/>3);</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Can<sp/>use<sp/>more<sp/>than<sp/>20<sp/>keys<sp/>in<sp/>a<sp/>multi_a.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/>std::string<sp/>ms_str_multi_a{</highlight><highlight class="stringliteral">&quot;multi_a(1,&quot;</highlight><highlight class="normal">};</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>21;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ms_str_multi_a<sp/>+=<sp/><ref refid="hex__base_8cpp_1ac2c88b156e9e245fa3d0a66105ecd371" kindref="member">HexStr</ref>(g_testdata-&gt;pubkeys[i]);</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(i<sp/>&lt;<sp/>20)<sp/>ms_str_multi_a<sp/>+=<sp/></highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/>ms_str_multi_a<sp/>+=<sp/></highlight><highlight class="stringliteral">&quot;)&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(ms_str_multi_a,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;2079be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798ac20c6047f9441ed7d6d3045406e95c07cd85c778e4b8cef3ca7abac09b95c709ee5ba20f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9ba20e493dbf1c10d80f3581e4904930b1404cc6c13900ee0758474fa94abe8c4cd13ba202f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4ba20fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556ba205cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bcba202f01e5e15cca351daff3843fb70f3c2f0a1bdd05e5af888a67784ef3e10a2a01ba20acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbeba20a0434d9e47f3c86235477c7b1ae6ae5d3442d49b1943c2b752a68e2a47e247c7ba20774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cbba20d01115d548e7561b15c38f004d734633687cf4419620095bc5b0f47070afe85aba20f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8ba20499fdf9e895e719cfd64e67f07d38e3226aa7b63678949e6e49b241a60e823e4ba20d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080eba20e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0aba20defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34ba205601570cb47f238d2b0286db4a990fa0f3ba28d1a319f5e7cf55c2a2444da7ccba202b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6cba204ce119c96e2fa357200b559b2f7dd5a5f02d5290aff74b03f3e471b273211c97ba20352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5ba519c&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG<sp/>|<sp/>TESTMODE_P2WSH_INVALID,<sp/>22,<sp/>21,<sp/>{},<sp/>{},<sp/>22);</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Since<sp/>&apos;d:&apos;<sp/>is<sp/>&apos;u&apos;<sp/>we<sp/>can<sp/>use<sp/>it<sp/>directly<sp/>inside<sp/>a<sp/>thresh.<sp/>But<sp/>we<sp/>can&apos;t<sp/>under<sp/>P2WSH.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;thresh(2,dv:older(42),s:pk(025cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc),s:pk(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;7663012ab269687c205cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bcac937c20d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65ac935287&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG<sp/>|<sp/>TESTMODE_P2WSH_INVALID,<sp/>12,<sp/>3,<sp/>{},<sp/>{},<sp/>4);</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>can<sp/>have<sp/>a<sp/>script<sp/>that<sp/>has<sp/>more<sp/>than<sp/>201<sp/>ops<sp/>(n<sp/>=<sp/>99),<sp/>that<sp/>needs<sp/>a<sp/>stack<sp/>size<sp/>&gt;<sp/>100<sp/>(n<sp/>=<sp/>110),<sp/>or<sp/>has<sp/>a</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>script<sp/>that<sp/>is<sp/>larger<sp/>than<sp/>3600<sp/>bytes<sp/>(n<sp/>=<sp/>200).<sp/>All<sp/>that<sp/>can&apos;t<sp/>be<sp/>under<sp/>P2WSH.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>pk_count:<sp/>{99,<sp/>110,<sp/>200})<sp/>{</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::string<sp/>ms_str_large;</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>pk_count<sp/>-<sp/>1;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ms_str_large<sp/>+=<sp/></highlight><highlight class="stringliteral">&quot;and_b(pk(&quot;</highlight><highlight class="normal"><sp/>+<sp/><ref refid="hex__base_8cpp_1ac2c88b156e9e245fa3d0a66105ecd371" kindref="member">HexStr</ref>(g_testdata-&gt;pubkeys[i])<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;),a:&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ms_str_large<sp/>+=<sp/></highlight><highlight class="stringliteral">&quot;pk(&quot;</highlight><highlight class="normal"><sp/>+<sp/><ref refid="hex__base_8cpp_1ac2c88b156e9e245fa3d0a66105ecd371" kindref="member">HexStr</ref>(g_testdata-&gt;pubkeys[pk_count<sp/>-<sp/>1])<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;)&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ms_str_large.insert(ms_str_large.end(),<sp/>pk_count<sp/>-<sp/>1,<sp/></highlight><highlight class="charliteral">&apos;)&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Test(ms_str_large,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG<sp/>|<sp/>TESTMODE_P2WSH_INVALID,<sp/>pk_count<sp/>+<sp/>(pk_count<sp/>-<sp/>1)<sp/>*<sp/>3,<sp/>pk_count,<sp/>{},<sp/>{},<sp/>pk_count<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>can<sp/>have<sp/>a<sp/>script<sp/>that<sp/>reaches<sp/>a<sp/>stack<sp/>size<sp/>of<sp/>1000<sp/>during<sp/>execution.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/>std::string<sp/>ms_stack_limit;</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>count{998};</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>count;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ms_stack_limit<sp/>+=<sp/></highlight><highlight class="stringliteral">&quot;and_b(older(1),a:&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/>ms_stack_limit<sp/>+=<sp/></highlight><highlight class="stringliteral">&quot;pk(&quot;</highlight><highlight class="normal"><sp/>+<sp/><ref refid="hex__base_8cpp_1ac2c88b156e9e245fa3d0a66105ecd371" kindref="member">HexStr</ref>(g_testdata-&gt;pubkeys[0])<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;)&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/>ms_stack_limit.insert(ms_stack_limit.end(),<sp/>count,<sp/></highlight><highlight class="charliteral">&apos;)&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>ms_stack_ok{<ref refid="namespaceminiscript_1ab1acf22ce8b1e2ffbbd786fb4a8ab198" kindref="member">miniscript::FromString</ref>(ms_stack_limit,<sp/>tap_converter)};</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(ms_stack_ok<sp/>&amp;&amp;<sp/>ms_stack_ok-&gt;CheckStackSize());</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(ms_stack_limit,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG<sp/>|<sp/>TESTMODE_P2WSH_INVALID,<sp/>4<sp/>*<sp/>count<sp/>+<sp/>1,<sp/>1,<sp/>{},<sp/>{},<sp/>1<sp/>+<sp/>count<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>But<sp/>one<sp/>more<sp/>element<sp/>on<sp/>the<sp/>stack<sp/>during<sp/>execution<sp/>will<sp/>make<sp/>it<sp/>fail.<sp/>And<sp/>we&apos;d<sp/>detect<sp/>that.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/>count++;</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/>ms_stack_limit<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;and_b(older(1),a:&quot;</highlight><highlight class="normal"><sp/>+<sp/>ms_stack_limit<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;)&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>ms_stack_nok{<ref refid="namespaceminiscript_1ab1acf22ce8b1e2ffbbd786fb4a8ab198" kindref="member">miniscript::FromString</ref>(ms_stack_limit,<sp/>tap_converter)};</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(ms_stack_nok<sp/>&amp;&amp;<sp/>!ms_stack_nok-&gt;CheckStackSize());</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(ms_stack_limit,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_NEEDSIG<sp/>|<sp/>TESTMODE_P2WSH_INVALID,<sp/>4<sp/>*<sp/>count<sp/>+<sp/>1,<sp/>1,<sp/>{},<sp/>{},<sp/>1<sp/>+<sp/>count<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="648"><highlight class="normal"></highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Misc<sp/>unit<sp/>tests</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>Script<sp/>with<sp/>a<sp/>non<sp/>minimal<sp/>push<sp/>is<sp/>invalid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>nonminpush{</highlight><highlight class="stringliteral">&quot;0000210232780000feff00ffffffffffff21ff005f00ae21ae00000000060602060406564c2102320000060900fe00005f00ae21ae00100000060606060606000000000000000000000000000000000000000000000000000000000000000000&quot;</highlight><highlight class="normal">_hex_u8};</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_script" kindref="compound">CScript</ref><sp/>nonminpush_script(nonminpush.begin(),<sp/>nonminpush.end());</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(<ref refid="namespaceminiscript_1a0f4f74f7e9edf9d40b75cd4ca43656a7" kindref="member">miniscript::FromScript</ref>(nonminpush_script,<sp/>wsh_converter)<sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(<ref refid="namespaceminiscript_1a0f4f74f7e9edf9d40b75cd4ca43656a7" kindref="member">miniscript::FromScript</ref>(nonminpush_script,<sp/>tap_converter)<sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>non-minimal<sp/>VERIFY<sp/>(&lt;key&gt;<sp/>CHECKSIG<sp/>VERIFY<sp/>1)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>nonminverify{</highlight><highlight class="stringliteral">&quot;2103a0434d9e47f3c86235477c7b1ae6ae5d3442d49b1943c2b752a68e2a47e247c7ac6951&quot;</highlight><highlight class="normal">_hex_u8};</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_script" kindref="compound">CScript</ref><sp/>nonminverify_script(nonminverify.begin(),<sp/>nonminverify.end());</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(<ref refid="namespaceminiscript_1a0f4f74f7e9edf9d40b75cd4ca43656a7" kindref="member">miniscript::FromScript</ref>(nonminverify_script,<sp/>wsh_converter)<sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(<ref refid="namespaceminiscript_1a0f4f74f7e9edf9d40b75cd4ca43656a7" kindref="member">miniscript::FromScript</ref>(nonminverify_script,<sp/>tap_converter)<sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>threshold<sp/>as<sp/>large<sp/>as<sp/>the<sp/>number<sp/>of<sp/>subs<sp/>is<sp/>valid.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;thresh(2,c:pk_k(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65),altv:after(100))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;2103d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65ac6b6300670164b16951686c935287&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;20d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65ac6b6300670164b16951686c935287&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NEEDSIG<sp/>|<sp/>TESTMODE_NONMAL);</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>threshold<sp/>of<sp/>1<sp/>is<sp/>valid.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;thresh(1,c:pk_k(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65),sc:pk_k(03fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;2103d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65ac7c2103fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556ac935187&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;20d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65ac7c20fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556ac935187&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NEEDSIG<sp/>|<sp/>TESTMODE_NONMAL);</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>threshold<sp/>with<sp/>a<sp/>k<sp/>larger<sp/>than<sp/>the<sp/>number<sp/>of<sp/>subs<sp/>is<sp/>invalid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;thresh(3,c:pk_k(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65),sc:pk_k(03fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;2103d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65ac7c2103fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556ac935187&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;=&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>threshold<sp/>with<sp/>a<sp/>k<sp/>null<sp/>is<sp/>invalid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;thresh(0,c:pk_k(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65),sc:pk_k(03fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;2103d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65ac7c2103fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556ac935187&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;=&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_INVALID);</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>CHECKMULTISIG<sp/>the<sp/>OP<sp/>cost<sp/>is<sp/>the<sp/>number<sp/>of<sp/>keys,<sp/>but<sp/>the<sp/>stack<sp/>size<sp/>is<sp/>the<sp/>number<sp/>of<sp/>sigs<sp/>(+1)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>ms_multi<sp/>=<sp/><ref refid="namespaceminiscript_1ab1acf22ce8b1e2ffbbd786fb4a8ab198" kindref="member">miniscript::FromString</ref>(</highlight><highlight class="stringliteral">&quot;multi(1,03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65,03fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556,0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798)&quot;</highlight><highlight class="normal">,<sp/>wsh_converter);</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(ms_multi);</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(*ms_multi-&gt;GetOps(),<sp/>4);<sp/></highlight><highlight class="comment">//<sp/>3<sp/>pubkeys<sp/>+<sp/>CMS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(*ms_multi-&gt;GetStackSize(),<sp/>2);<sp/></highlight><highlight class="comment">//<sp/>1<sp/>sig<sp/>+<sp/>dummy<sp/>elem</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>&apos;d:&apos;<sp/>wrapper<sp/>leaves<sp/>on<sp/>the<sp/>stack<sp/>what<sp/>was<sp/>DUP&apos;ed<sp/>at<sp/>the<sp/>beginning<sp/>of<sp/>its<sp/>execution.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Since<sp/>it<sp/>contains<sp/>an<sp/>OP_IF<sp/>just<sp/>after<sp/>on<sp/>the<sp/>same<sp/>element,<sp/>we<sp/>can<sp/>make<sp/>sure<sp/>that<sp/>the<sp/>element</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>in<sp/>question<sp/>must<sp/>be<sp/>OP_1<sp/>if<sp/>OP_IF<sp/>enforces<sp/>that<sp/>its<sp/>argument<sp/>must<sp/>only<sp/>be<sp/>OP_1<sp/>or<sp/>the<sp/>empty</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>vector<sp/>(since<sp/>otherwise<sp/>the<sp/>execution<sp/>would<sp/>immediately<sp/>fail).<sp/>This<sp/>is<sp/>the<sp/>MINIMALIF<sp/>rule.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Unfortunately,<sp/>this<sp/>rule<sp/>is<sp/>consensus<sp/>for<sp/>Taproot<sp/>but<sp/>only<sp/>policy<sp/>for<sp/>P2WSH.<sp/>Therefore<sp/>we<sp/>can&apos;t</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>(for<sp/>now)<sp/>have<sp/>&apos;d:&apos;<sp/>be<sp/>&apos;u&apos;.<sp/>This<sp/>tests<sp/>we<sp/>can&apos;t<sp/>use<sp/>a<sp/>&apos;d:&apos;<sp/>wrapper<sp/>for<sp/>a<sp/>thresh,<sp/>which<sp/>requires</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>its<sp/>subs<sp/>to<sp/>all<sp/>be<sp/>&apos;u&apos;<sp/>(taken<sp/>from<sp/>https://github.com/rust-bitcoin/rust-miniscript/discussions/341).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>ms_minimalif<sp/>=<sp/><ref refid="namespaceminiscript_1ab1acf22ce8b1e2ffbbd786fb4a8ab198" kindref="member">miniscript::FromString</ref>(</highlight><highlight class="stringliteral">&quot;thresh(3,c:pk_k(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65),sc:pk_k(03fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556),sc:pk_k(0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798),sdv:older(32))&quot;</highlight><highlight class="normal">,<sp/>wsh_converter);</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(ms_minimalif<sp/>&amp;&amp;<sp/>!ms_minimalif-&gt;IsValid());</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>Miniscript<sp/>with<sp/>duplicate<sp/>keys<sp/>is<sp/>not<sp/>sane</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>ms_dup1<sp/>=<sp/><ref refid="namespaceminiscript_1ab1acf22ce8b1e2ffbbd786fb4a8ab198" kindref="member">miniscript::FromString</ref>(</highlight><highlight class="stringliteral">&quot;and_v(v:pk(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65),pk(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65))&quot;</highlight><highlight class="normal">,<sp/>wsh_converter);</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(ms_dup1);</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(!ms_dup1-&gt;IsSane()<sp/>&amp;&amp;<sp/>!ms_dup1-&gt;CheckDuplicateKey());</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Same<sp/>with<sp/>a<sp/>disjunction,<sp/>and<sp/>different<sp/>key<sp/>nodes<sp/>(pk<sp/>and<sp/>pkh)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>ms_dup2<sp/>=<sp/><ref refid="namespaceminiscript_1ab1acf22ce8b1e2ffbbd786fb4a8ab198" kindref="member">miniscript::FromString</ref>(</highlight><highlight class="stringliteral">&quot;or_b(c:pk_k(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65),ac:pk_h(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65))&quot;</highlight><highlight class="normal">,<sp/>wsh_converter);</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(ms_dup2<sp/>&amp;&amp;<sp/>!ms_dup2-&gt;IsSane()<sp/>&amp;&amp;<sp/>!ms_dup2-&gt;CheckDuplicateKey());</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Same<sp/>when<sp/>the<sp/>duplicates<sp/>are<sp/>leaves<sp/>or<sp/>a<sp/>larger<sp/>tree</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>ms_dup3<sp/>=<sp/><ref refid="namespaceminiscript_1ab1acf22ce8b1e2ffbbd786fb4a8ab198" kindref="member">miniscript::FromString</ref>(</highlight><highlight class="stringliteral">&quot;or_i(and_b(pk(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65),s:pk(03fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556)),and_b(older(1),s:pk(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65)))&quot;</highlight><highlight class="normal">,<sp/>wsh_converter);</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(ms_dup3<sp/>&amp;&amp;<sp/>!ms_dup3-&gt;IsSane()<sp/>&amp;&amp;<sp/>!ms_dup3-&gt;CheckDuplicateKey());</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Same<sp/>when<sp/>the<sp/>duplicates<sp/>are<sp/>on<sp/>different<sp/>levels<sp/>in<sp/>the<sp/>tree</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>ms_dup4<sp/>=<sp/><ref refid="namespaceminiscript_1ab1acf22ce8b1e2ffbbd786fb4a8ab198" kindref="member">miniscript::FromString</ref>(</highlight><highlight class="stringliteral">&quot;thresh(2,pkh(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65),s:pk(03fff97bd5755eeea420453a14355235d382f6472f8568a18b2f057a1460297556),a:and_b(dv:older(1),s:pk(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65)))&quot;</highlight><highlight class="normal">,<sp/>wsh_converter);</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(ms_dup4<sp/>&amp;&amp;<sp/>!ms_dup4-&gt;IsSane()<sp/>&amp;&amp;<sp/>!ms_dup4-&gt;CheckDuplicateKey());</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Sanity<sp/>check<sp/>the<sp/>opposite<sp/>is<sp/>true,<sp/>too.<sp/>An<sp/>otherwise<sp/>sane<sp/>Miniscript<sp/>with<sp/>no<sp/>duplicate<sp/>keys<sp/>is<sp/>sane.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>ms_nondup<sp/>=<sp/><ref refid="namespaceminiscript_1ab1acf22ce8b1e2ffbbd786fb4a8ab198" kindref="member">miniscript::FromString</ref>(</highlight><highlight class="stringliteral">&quot;pk(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65)&quot;</highlight><highlight class="normal">,<sp/>wsh_converter);</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(ms_nondup<sp/>&amp;&amp;<sp/>ms_nondup-&gt;CheckDuplicateKey()<sp/>&amp;&amp;<sp/>ms_nondup-&gt;IsSane());</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Test<sp/>we<sp/>find<sp/>the<sp/>first<sp/>insane<sp/>sub<sp/>closer<sp/>to<sp/>be<sp/>a<sp/>leaf<sp/>node.<sp/>This<sp/>fragment<sp/>is<sp/>insane<sp/>for<sp/>two<sp/>reasons:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>1.<sp/>It<sp/>can<sp/>be<sp/>spent<sp/>without<sp/>a<sp/>signature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>2.<sp/>It<sp/>contains<sp/>timelock<sp/>mixes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We&apos;ll<sp/>report<sp/>the<sp/>timelock<sp/>mix<sp/>error,<sp/>as<sp/>it&apos;s<sp/>&quot;deeper&quot;<sp/>(closer<sp/>to<sp/>be<sp/>a<sp/>leaf<sp/>node)<sp/>than<sp/>the<sp/>&quot;no<sp/>&apos;s&apos;<sp/>property&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>error<sp/>is.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>ms_ins<sp/>=<sp/><ref refid="namespaceminiscript_1ab1acf22ce8b1e2ffbbd786fb4a8ab198" kindref="member">miniscript::FromString</ref>(</highlight><highlight class="stringliteral">&quot;or_i(and_b(after(1),a:after(1000000000)),pk(03cdabb7f2dce7bfbd8a0b9570c6fd1e712e5d64045e9d6b517b3d5072251dc204))&quot;</highlight><highlight class="normal">,<sp/>wsh_converter);</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(ms_ins<sp/>&amp;&amp;<sp/>ms_ins-&gt;IsValid()<sp/>&amp;&amp;<sp/>!ms_ins-&gt;IsSane());</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>insane_sub<sp/>=<sp/>ms_ins-&gt;FindInsaneSub();</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(insane_sub<sp/>&amp;&amp;<sp/>*insane_sub-&gt;ToString(wsh_converter)<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;and_b(after(1),a:after(1000000000))&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="707"><highlight class="normal"></highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Numbers<sp/>can&apos;t<sp/>be<sp/>prefixed<sp/>by<sp/>a<sp/>sign.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(!<ref refid="namespaceminiscript_1ab1acf22ce8b1e2ffbbd786fb4a8ab198" kindref="member">miniscript::FromString</ref>(</highlight><highlight class="stringliteral">&quot;after(-1)&quot;</highlight><highlight class="normal">,<sp/>wsh_converter));</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(!<ref refid="namespaceminiscript_1ab1acf22ce8b1e2ffbbd786fb4a8ab198" kindref="member">miniscript::FromString</ref>(</highlight><highlight class="stringliteral">&quot;after(+1)&quot;</highlight><highlight class="normal">,<sp/>wsh_converter));</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(!<ref refid="namespaceminiscript_1ab1acf22ce8b1e2ffbbd786fb4a8ab198" kindref="member">miniscript::FromString</ref>(</highlight><highlight class="stringliteral">&quot;thresh(-1,pk(03cdabb7f2dce7bfbd8a0b9570c6fd1e712e5d64045e9d6b517b3d5072251dc204))&quot;</highlight><highlight class="normal">,<sp/>wsh_converter));</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(!<ref refid="namespaceminiscript_1ab1acf22ce8b1e2ffbbd786fb4a8ab198" kindref="member">miniscript::FromString</ref>(</highlight><highlight class="stringliteral">&quot;multi(+1,03cdabb7f2dce7bfbd8a0b9570c6fd1e712e5d64045e9d6b517b3d5072251dc204)&quot;</highlight><highlight class="normal">,<sp/>wsh_converter));</highlight></codeline>
<codeline lineno="713"><highlight class="normal"></highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Timelock<sp/>tests</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;after(100)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL);<sp/></highlight><highlight class="comment">//<sp/>only<sp/>heightlock</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;after(1000000000)&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL);<sp/></highlight><highlight class="comment">//<sp/>only<sp/>timelock</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;or_b(l:after(100),al:after(1000000000))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID);<sp/></highlight><highlight class="comment">//<sp/>or_b(timelock,<sp/>heighlock)<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;and_b(after(100),a:after(1000000000))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_NONMAL<sp/>|<sp/>TESTMODE_TIMELOCKMIX);<sp/></highlight><highlight class="comment">//<sp/>and_b(timelock,<sp/>heighlock)<sp/>invalid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>This<sp/>is<sp/>correctly<sp/>detected<sp/>as<sp/>non-malleable<sp/>but<sp/>for<sp/>the<sp/>wrong<sp/>reason.<sp/>The<sp/>type<sp/>system<sp/>assumes<sp/>that<sp/>branches<sp/>1<sp/>and<sp/>2</highlight></codeline>
<codeline lineno="720"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>can<sp/>be<sp/>spent<sp/>together<sp/>to<sp/>create<sp/>a<sp/>non-malleble<sp/>witness,<sp/>but<sp/>because<sp/>of<sp/>mixing<sp/>of<sp/>timelocks<sp/>they<sp/>cannot<sp/>be<sp/>spent<sp/>together.</highlight></codeline>
<codeline lineno="721"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>But<sp/>since<sp/>exactly<sp/>one<sp/>of<sp/>the<sp/>two<sp/>after&apos;s<sp/>can<sp/>be<sp/>satisfied,<sp/>the<sp/>witness<sp/>involving<sp/>the<sp/>key<sp/>cannot<sp/>be<sp/>malleated.</highlight></codeline>
<codeline lineno="722"><highlight class="comment"><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;thresh(2,ltv:after(1000000000),altv:after(100),a:pk(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID<sp/>|<sp/>TESTMODE_TIMELOCKMIX<sp/>|<sp/>TESTMODE_NONMAL);<sp/></highlight><highlight class="comment">//<sp/>thresh<sp/>with<sp/>k<sp/>=<sp/>2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>is<sp/>actually<sp/>non-malleable<sp/>in<sp/>practice,<sp/>but<sp/>we<sp/>cannot<sp/>detect<sp/>it<sp/>in<sp/>type<sp/>system.<sp/>See<sp/>above<sp/>rationale</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/>Test(</highlight><highlight class="stringliteral">&quot;thresh(1,c:pk_k(03d30199d74fb5a22d47b6e054e2f378cedacffcb89904a61d75d0dbd407143e65),altv:after(1000000000),altv:after(100))&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;?&quot;</highlight><highlight class="normal">,<sp/>TESTMODE_VALID);<sp/></highlight><highlight class="comment">//<sp/>thresh<sp/>with<sp/>k<sp/>=<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="726"><highlight class="normal"></highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/>g_testdata.reset();</highlight></codeline>
<codeline lineno="728"><highlight class="normal">}</highlight></codeline>
<codeline lineno="729"><highlight class="normal"></highlight></codeline>
<codeline lineno="730"><highlight class="normal"><ref refid="cuckoocache__tests_8cpp_1af7f71af5c6c124222dd1c42c5df892f4" kindref="member">BOOST_AUTO_TEST_SUITE_END</ref>()</highlight></codeline>
    </programlisting>
    <location file="src/test/miniscript_tests.cpp"/>
  </compounddef>
</doxygen>
