<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="md_src_2ipc_2libmultiprocess_2doc_2usage" kind="page">
    <compoundname>md_src_2ipc_2libmultiprocess_2doc_2usage</compoundname>
    <title>libmultiprocess Usage</title>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para><anchor id="md_src_2ipc_2libmultiprocess_2doc_2usage_1autotoc_md20"/></para>
<sect1 id="md_src_2ipc_2libmultiprocess_2doc_2usage_1autotoc_md21">
<title>Overview</title><para><emphasis>libmultiprocess</emphasis> is a library and code generator that allows calling C++ class interfaces across different processes. For an interface to be available from other processes, it needs two definitions:</para>
<para><itemizedlist>
<listitem><para>An <bold>API definition</bold> declaring how the interface is called. Included examples: <ulink url="../example/calculator.h">calculator.h</ulink>, <ulink url="../example/printer.h">printer.h</ulink>, <ulink url="../example/init.h">init.h</ulink>. Bitcoin examples: <ulink url="https://github.com/bitcoin/bitcoin/blob/master/src/interfaces/node.h">node.h</ulink>, <ulink url="https://github.com/bitcoin/bitcoin/blob/master/src/interfaces/wallet.h">wallet.h</ulink>, <ulink url="https://github.com/bitcoin/bitcoin/blob/master/src/interfaces/echo.h">echo.h</ulink>, <ulink url="https://github.com/bitcoin/bitcoin/blob/master/src/interfaces/init.h">init.h</ulink>.</para>
</listitem><listitem><para>A <bold>data definition</bold> declaring how interface calls get sent across the wire. Included examples: <ulink url="../example/calculator.capnp">calculator.capnp</ulink>, <ulink url="../example/printer.capnp">printer.capnp</ulink>, <ulink url="../example/init.capnp">init.capnp</ulink>. Bitcoin examples: <ulink url="https://github.com/ryanofsky/bitcoin/blob/ipc-export/src/ipc/capnp/node.capnp">node.capnp</ulink>, <ulink url="https://github.com/ryanofsky/bitcoin/blob/ipc-export/src/ipc/capnp/wallet.capnp">wallet.capnp</ulink>, <ulink url="https://github.com/bitcoin/bitcoin/blob/master/src/ipc/capnp/echo.capnp">echo.capnp</ulink>, <ulink url="https://github.com/bitcoin/bitcoin/blob/master/src/ipc/capnp/init.capnp">init.capnp</ulink>.</para>
</listitem></itemizedlist>
</para>
<para>The <computeroutput>*.capnp</computeroutput> data definition files are consumed by the <emphasis>libmultiprocess</emphasis> code generator and each <computeroutput>X.capnp</computeroutput> file generates <computeroutput>X.capnp.c++</computeroutput>, <computeroutput>X.capnp.h</computeroutput>, <computeroutput>X.capnp.proxy-client.c++</computeroutput>, <computeroutput>X.capnp.proxy-server.c++</computeroutput>, <computeroutput>X.capnp.proxy-types.c++</computeroutput>, <computeroutput>X.capnp.proxy-types.h</computeroutput>, and <computeroutput>X.capnp.proxy.h</computeroutput> output files. The generated files include <computeroutput><ref refid="structmp_1_1_proxy_client" kindref="compound">mp::ProxyClient</ref>&lt;Interface&gt;</computeroutput> and <computeroutput><ref refid="structmp_1_1_proxy_server" kindref="compound">mp::ProxyServer</ref>&lt;Interface&gt;</computeroutput> class specializations for all the interfaces in the <computeroutput>.capnp</computeroutput> files. These allow methods on C++ objects in one process to be called from other processes over IPC sockets.</para>
<para>The <computeroutput>ProxyServer</computeroutput> objects help translate IPC requests from a socket to method calls on a local object. The <computeroutput>ProxyServer</computeroutput> objects are just used internally by the <computeroutput>mp::ServeStream(loop, socket, wrapped_object)</computeroutput> and <computeroutput>mp::ListenConnections(loop, socket, wrapped_object)</computeroutput> functions, and aren&apos;t exposed externally. The <computeroutput>ProxyClient</computeroutput> classes are exposed, and returned from the <computeroutput>mp::ConnectStream(loop, socket)</computeroutput> function and meant to be used directly. The classes implement methods described in <computeroutput>.capnp</computeroutput> definitions, and whenever any method is called, a request with the method arguments is sent over the associated IPC connection, and the corresponding <computeroutput>wrapped_object</computeroutput> method on the other end of the connection is called, with the <computeroutput>ProxyClient</computeroutput> method blocking until it returns and forwarding back any return value to the <computeroutput>ProxyClient</computeroutput> method caller.</para>
</sect1>
<sect1 id="md_src_2ipc_2libmultiprocess_2doc_2usage_1autotoc_md22">
<title>Example</title><para>A simple interface description can be found at <ulink url="../test/mp/test/foo.capnp">test/mp/test/foo.capnp</ulink>, implementation in <ulink url="../test/mp/test/foo.h">test/mp/test/foo.h</ulink>, and usage in <ulink url="../test/mp/test/test.cpp">test/mp/test/test.cpp</ulink>.</para>
<para>A more complete example can be found in <ulink url="../example/">example</ulink> and run with:</para>
<para><programlisting filename=".sh"><codeline><highlight class="normal">mkdir<sp/>build</highlight></codeline>
<codeline><highlight class="normal">cd<sp/>build</highlight></codeline>
<codeline><highlight class="normal">cmake<sp/>..</highlight></codeline>
<codeline><highlight class="normal">make<sp/>mpexamples</highlight></codeline>
<codeline><highlight class="normal">example/mpexample</highlight></codeline>
</programlisting> </para>
</sect1>
    </detaileddescription>
    <location file="src/ipc/libmultiprocess/doc/usage.md"/>
  </compounddef>
</doxygen>
