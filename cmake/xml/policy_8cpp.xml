<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="policy_8cpp" kind="file" language="C++">
    <compoundname>policy.cpp</compoundname>
    <includes refid="policy_8h" local="no">policy/policy.h</includes>
    <includes local="no">coins.h</includes>
    <includes refid="amount_8h" local="no">consensus/amount.h</includes>
    <includes refid="consensus_8h" local="no">consensus/consensus.h</includes>
    <includes refid="consensus_2validation_8h" local="no">consensus/validation.h</includes>
    <includes refid="feerate_8h" local="no">policy/feerate.h</includes>
    <includes refid="primitives_2transaction_8h" local="no">primitives/transaction.h</includes>
    <includes refid="interpreter_8h" local="no">script/interpreter.h</includes>
    <includes refid="script_2script_8h" local="no">script/script.h</includes>
    <includes refid="solver_8h" local="no">script/solver.h</includes>
    <includes refid="serialize_8h" local="no">serialize.h</includes>
    <includes refid="span_8h" local="no">span.h</includes>
    <includes local="no">algorithm</includes>
    <includes local="no">cstddef</includes>
    <includes local="no">vector</includes>
    <incdepgraph>
      <node id="8">
        <label>attributes.h</label>
        <link refid="attributes_8h"/>
      </node>
      <node id="45">
        <label>compat/assumptions.h</label>
        <link refid="compat_2assumptions_8h"/>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="13">
        <label>compat/byteswap.h</label>
        <link refid="byteswap_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
      </node>
      <node id="12">
        <label>compat/endian.h</label>
        <link refid="endian_8h"/>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
      </node>
      <node id="3">
        <label>consensus/amount.h</label>
        <link refid="amount_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
      </node>
      <node id="5">
        <label>consensus/consensus.h</label>
        <link refid="consensus_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="63">
        <label>consensus/validation.h</label>
        <link refid="consensus_2validation_8h"/>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
      </node>
      <node id="11">
        <label>crypto/common.h</label>
        <link refid="crypto_2common_8h"/>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="24">
        <label>crypto/hex_base.h</label>
        <link refid="hex__base_8h"/>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
      </node>
      <node id="66">
        <label>policy/feerate.h</label>
        <link refid="feerate_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>src/policy/policy.cpp</label>
        <link refid="policy_8cpp"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="66" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>policy/policy.h</label>
        <link refid="policy_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
      </node>
      <node id="42">
        <label>prevector.h</label>
        <link refid="prevector_8h"/>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="64">
        <label>primitives/block.h</label>
        <link refid="primitives_2block_8h"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="65" relation="include">
        </childnode>
      </node>
      <node id="7">
        <label>primitives/transaction.h</label>
        <link refid="primitives_2transaction_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="9">
        <label>primitives/transaction_identifier.h</label>
        <link refid="transaction__identifier_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
      </node>
      <node id="53">
        <label>script/interpreter.h</label>
        <link refid="interpreter_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="54" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="55" relation="include">
        </childnode>
        <childnode refid="56" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="41">
        <label>script/script.h</label>
        <link refid="script_2script_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="55">
        <label>script/script_error.h</label>
        <link refid="script__error_8h"/>
        <childnode refid="25" relation="include">
        </childnode>
      </node>
      <node id="57">
        <label>script/solver.h</label>
        <link refid="solver_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="56">
        <label>script/verify_flags.h</label>
        <link refid="verify__flags_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
      </node>
      <node id="44">
        <label>serialize.h</label>
        <link refid="serialize_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="49" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="18">
        <label>span.h</label>
        <link refid="span_8h"/>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="10">
        <label>uint256.h</label>
        <link refid="uint256_8h"/>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="59">
        <label>util/check.h</label>
        <link refid="check_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="60" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="58">
        <label>util/feefrac.h</label>
        <link refid="feefrac_8h"/>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="50">
        <label>util/hash_type.h</label>
        <link refid="hash__type_8h"/>
      </node>
      <node id="23">
        <label>util/strencodings.h</label>
        <link refid="strencodings_8h"/>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="26">
        <label>util/string.h</label>
        <link refid="string_8h"/>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="37">
        <label>util/types.h</label>
        <link refid="util_2types_8h"/>
      </node>
      <node id="36">
        <label>algorithm</label>
      </node>
      <node id="27">
        <label>array</label>
      </node>
      <node id="60">
        <label>atomic</label>
      </node>
      <node id="14">
        <label>bit</label>
      </node>
      <node id="19">
        <label>cassert</label>
      </node>
      <node id="32">
        <label>charconv</label>
      </node>
      <node id="62">
        <label>coins.h</label>
      </node>
      <node id="38">
        <label>compare</label>
      </node>
      <node id="15">
        <label>concepts</label>
      </node>
      <node id="16">
        <label>cstddef</label>
      </node>
      <node id="4">
        <label>cstdint</label>
      </node>
      <node id="6">
        <label>cstdlib</label>
      </node>
      <node id="17">
        <label>cstring</label>
      </node>
      <node id="54">
        <label>hash.h</label>
      </node>
      <node id="46">
        <label>ios</label>
      </node>
      <node id="43">
        <label>iterator</label>
      </node>
      <node id="33">
        <label>limits</label>
      </node>
      <node id="28">
        <label>locale</label>
      </node>
      <node id="47">
        <label>map</label>
      </node>
      <node id="48">
        <label>memory</label>
      </node>
      <node id="52">
        <label>numeric</label>
      </node>
      <node id="34">
        <label>optional</label>
      </node>
      <node id="49">
        <label>set</label>
      </node>
      <node id="61">
        <label>source_location</label>
      </node>
      <node id="20">
        <label>span</label>
      </node>
      <node id="29">
        <label>sstream</label>
      </node>
      <node id="51">
        <label>stdexcept</label>
      </node>
      <node id="25">
        <label>string</label>
      </node>
      <node id="30">
        <label>string_view</label>
      </node>
      <node id="35">
        <label>system_error</label>
      </node>
      <node id="39">
        <label>tuple</label>
      </node>
      <node id="21">
        <label>type_traits</label>
      </node>
      <node id="65">
        <label>util/time.h</label>
      </node>
      <node id="22">
        <label>utility</label>
      </node>
      <node id="40">
        <label>variant</label>
      </node>
      <node id="31">
        <label>vector</label>
      </node>
    </incdepgraph>
    <sectiondef kind="func">
      <memberdef kind="function" id="policy_8cpp_1a7b1001b4a41a02d9469e3b6985587300" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="amount_8h_1a4eaf3a5239714d8c45b851527f7cb564" kindref="member">CAmount</ref></type>
        <definition>CAmount GetDustThreshold</definition>
        <argsstring>(const CTxOut &amp;txout, const CFeeRate &amp;dustRelayFeeIn)</argsstring>
        <name>GetDustThreshold</name>
        <param>
          <type>const <ref refid="class_c_tx_out" kindref="compound">CTxOut</ref> &amp;</type>
          <declname>txout</declname>
        </param>
        <param>
          <type>const <ref refid="class_c_fee_rate" kindref="compound">CFeeRate</ref> &amp;</type>
          <declname>dustRelayFeeIn</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/policy/policy.cpp" line="26" column="9" bodyfile="src/policy/policy.cpp" bodystart="26" bodyend="63"/>
      </memberdef>
      <memberdef kind="function" id="policy_8cpp_1ab18c1023518f2920e34e05ca324d0ebb" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>bool IsDust</definition>
        <argsstring>(const CTxOut &amp;txout, const CFeeRate &amp;dustRelayFeeIn)</argsstring>
        <name>IsDust</name>
        <param>
          <type>const <ref refid="class_c_tx_out" kindref="compound">CTxOut</ref> &amp;</type>
          <declname>txout</declname>
        </param>
        <param>
          <type>const <ref refid="class_c_fee_rate" kindref="compound">CFeeRate</ref> &amp;</type>
          <declname>dustRelayFeeIn</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/policy/policy.cpp" line="65" column="6" bodyfile="src/policy/policy.cpp" bodystart="65" bodyend="68"/>
      </memberdef>
      <memberdef kind="function" id="policy_8cpp_1ab2f63d37a5bd44b01b655c2ed855cb68" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>std::vector&lt; uint32_t &gt;</type>
        <definition>std::vector&lt; uint32_t &gt; GetDust</definition>
        <argsstring>(const CTransaction &amp;tx, CFeeRate dust_relay_rate)</argsstring>
        <name>GetDust</name>
        <param>
          <type>const <ref refid="class_c_transaction" kindref="compound">CTransaction</ref> &amp;</type>
          <declname>tx</declname>
        </param>
        <param>
          <type><ref refid="class_c_fee_rate" kindref="compound">CFeeRate</ref></type>
          <declname>dust_relay_rate</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Get the vout index numbers of all dust outputs </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/policy/policy.cpp" line="70" column="13" bodyfile="src/policy/policy.cpp" bodystart="70" bodyend="77"/>
      </memberdef>
      <memberdef kind="function" id="policy_8cpp_1aacaab3b92ac5b2240e05723c7ff31e25" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>bool IsStandard</definition>
        <argsstring>(const CScript &amp;scriptPubKey, TxoutType &amp;whichType)</argsstring>
        <name>IsStandard</name>
        <param>
          <type>const <ref refid="class_c_script" kindref="compound">CScript</ref> &amp;</type>
          <declname>scriptPubKey</declname>
        </param>
        <param>
          <type><ref refid="solver_8h_1ac908d0e5a62eac70931dae97c6fd3c8f" kindref="member">TxoutType</ref> &amp;</type>
          <declname>whichType</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/policy/policy.cpp" line="79" column="6" bodyfile="src/policy/policy.cpp" bodystart="79" bodyend="97"/>
      </memberdef>
      <memberdef kind="function" id="policy_8cpp_1aadd0007b1969edf72c35e598fdadc4de" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>bool IsStandardTx</definition>
        <argsstring>(const CTransaction &amp;tx, const std::optional&lt; unsigned &gt; &amp;max_datacarrier_bytes, bool permit_bare_multisig, const CFeeRate &amp;dust_relay_fee, std::string &amp;reason)</argsstring>
        <name>IsStandardTx</name>
        <param>
          <type>const <ref refid="class_c_transaction" kindref="compound">CTransaction</ref> &amp;</type>
          <declname>tx</declname>
        </param>
        <param>
          <type>const std::optional&lt; unsigned &gt; &amp;</type>
          <declname>max_datacarrier_bytes</declname>
        </param>
        <param>
          <type>bool</type>
          <declname>permit_bare_multisig</declname>
        </param>
        <param>
          <type>const <ref refid="class_c_fee_rate" kindref="compound">CFeeRate</ref> &amp;</type>
          <declname>dust_relay_fee</declname>
        </param>
        <param>
          <type>std::string &amp;</type>
          <declname>reason</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check for standard transaction types <simplesect kind="return"><para>True if all outputs (scriptPubKeys) use only standard transaction forms </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/policy/policy.cpp" line="99" column="6" bodyfile="src/policy/policy.cpp" bodystart="99" bodyend="164"/>
      </memberdef>
      <memberdef kind="function" id="policy_8cpp_1a859da614b1e74ebec37d14ff22566a38" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool CheckSigopsBIP54</definition>
        <argsstring>(const CTransaction &amp;tx, const CCoinsViewCache &amp;inputs)</argsstring>
        <name>CheckSigopsBIP54</name>
        <param>
          <type>const <ref refid="class_c_transaction" kindref="compound">CTransaction</ref> &amp;</type>
          <declname>tx</declname>
        </param>
        <param>
          <type>const <ref refid="class_c_coins_view_cache" kindref="compound">CCoinsViewCache</ref> &amp;</type>
          <declname>inputs</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check the total number of non-witness sigops across the whole transaction, as per BIP54. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/policy/policy.cpp" line="169" column="13" bodyfile="src/policy/policy.cpp" bodystart="169" bodyend="193"/>
      </memberdef>
      <memberdef kind="function" id="policy_8cpp_1a791e33e18bea9861e449e6ebcfce8890" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>bool AreInputsStandard</definition>
        <argsstring>(const CTransaction &amp;tx, const CCoinsViewCache &amp;mapInputs)</argsstring>
        <name>AreInputsStandard</name>
        <param>
          <type>const <ref refid="class_c_transaction" kindref="compound">CTransaction</ref> &amp;</type>
          <declname>tx</declname>
        </param>
        <param>
          <type>const <ref refid="class_c_coins_view_cache" kindref="compound">CCoinsViewCache</ref> &amp;</type>
          <declname>mapInputs</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check transaction inputs.</para>
<para>This does three things:<itemizedlist>
<listitem><para>Prevents mempool acceptance of spends of future segwit versions we don&apos;t know how to validate</para>
</listitem><listitem><para>Mitigates a potential denial-of-service attack with P2SH scripts with a crazy number of expensive CHECKSIG/CHECKMULTISIG operations.</para>
</listitem><listitem><para>Prevents spends of unknown/irregular scriptPubKeys, which mitigates potential denial-of-service attacks involving expensive scripts and helps reserve them as potential new upgrade hooks.</para>
</listitem></itemizedlist>
</para>
<para>Note that only the non-witness portion of the transaction is checked here.</para>
<para>We also check the total number of non-witness sigops across the whole transaction, as per BIP54. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/policy/policy.cpp" line="213" column="6" bodyfile="src/policy/policy.cpp" bodystart="213" bodyend="249"/>
      </memberdef>
      <memberdef kind="function" id="policy_8cpp_1a8a73d04fc7e2d36b2acc4d6eb0cc2993" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>bool IsWitnessStandard</definition>
        <argsstring>(const CTransaction &amp;tx, const CCoinsViewCache &amp;mapInputs)</argsstring>
        <name>IsWitnessStandard</name>
        <param>
          <type>const <ref refid="class_c_transaction" kindref="compound">CTransaction</ref> &amp;</type>
          <declname>tx</declname>
        </param>
        <param>
          <type>const <ref refid="class_c_coins_view_cache" kindref="compound">CCoinsViewCache</ref> &amp;</type>
          <declname>mapInputs</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check if the transaction is over standard P2WSH resources limit: 3600bytes witnessScript size, 80bytes per witness stack element, 100 witness stack elements These limits are adequate for multisignatures up to n-of-100 using OP_CHECKSIG, OP_ADD, and OP_EQUAL.</para>
<para>Also enforce a maximum stack item size limit and no annexes for tapscript spends. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/policy/policy.cpp" line="251" column="6" bodyfile="src/policy/policy.cpp" bodystart="251" bodyend="338"/>
      </memberdef>
      <memberdef kind="function" id="policy_8cpp_1a63d1c42b964069822fdc1687465a6a15" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>bool SpendsNonAnchorWitnessProg</definition>
        <argsstring>(const CTransaction &amp;tx, const CCoinsViewCache &amp;prevouts)</argsstring>
        <name>SpendsNonAnchorWitnessProg</name>
        <param>
          <type>const <ref refid="class_c_transaction" kindref="compound">CTransaction</ref> &amp;</type>
          <declname>tx</declname>
        </param>
        <param>
          <type>const <ref refid="class_c_coins_view_cache" kindref="compound">CCoinsViewCache</ref> &amp;</type>
          <declname>prevouts</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check whether this transaction spends any witness program but P2A, including not-yet-defined ones. May return <computeroutput>false</computeroutput> early for consensus-invalid transactions. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/policy/policy.cpp" line="340" column="6" bodyfile="src/policy/policy.cpp" bodystart="340" bodyend="374"/>
      </memberdef>
      <memberdef kind="function" id="policy_8cpp_1aca3174d03510603f888f4431b59901ab" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int64_t</type>
        <definition>int64_t GetSigOpsAdjustedWeight</definition>
        <argsstring>(int64_t weight, int64_t sigop_cost, unsigned int bytes_per_sigop)</argsstring>
        <name>GetSigOpsAdjustedWeight</name>
        <param>
          <type>int64_t</type>
          <declname>weight</declname>
        </param>
        <param>
          <type>int64_t</type>
          <declname>sigop_cost</declname>
        </param>
        <param>
          <type>unsigned int</type>
          <declname>bytes_per_sigop</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/policy/policy.cpp" line="376" column="9" bodyfile="src/policy/policy.cpp" bodystart="376" bodyend="379"/>
      </memberdef>
      <memberdef kind="function" id="policy_8cpp_1a7cf1495f52acbb4320a50bbb831af44a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int64_t</type>
        <definition>int64_t GetVirtualTransactionSize</definition>
        <argsstring>(int64_t nWeight, int64_t nSigOpCost, unsigned int bytes_per_sigop)</argsstring>
        <name>GetVirtualTransactionSize</name>
        <param>
          <type>int64_t</type>
          <declname>nWeight</declname>
        </param>
        <param>
          <type>int64_t</type>
          <declname>nSigOpCost</declname>
        </param>
        <param>
          <type>unsigned int</type>
          <declname>bytes_per_sigop</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Compute the virtual transaction size (weight reinterpreted as bytes). </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/policy/policy.cpp" line="381" column="9" bodyfile="src/policy/policy.cpp" bodystart="381" bodyend="384"/>
      </memberdef>
      <memberdef kind="function" id="policy_8cpp_1a2cf1d55ed18bbb55661b77bc03a81dbd" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int64_t</type>
        <definition>int64_t GetVirtualTransactionSize</definition>
        <argsstring>(const CTransaction &amp;tx, int64_t nSigOpCost, unsigned int bytes_per_sigop)</argsstring>
        <name>GetVirtualTransactionSize</name>
        <param>
          <type>const <ref refid="class_c_transaction" kindref="compound">CTransaction</ref> &amp;</type>
          <declname>tx</declname>
        </param>
        <param>
          <type>int64_t</type>
          <declname>nSigOpCost</declname>
        </param>
        <param>
          <type>unsigned int</type>
          <declname>bytes_per_sigop</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/policy/policy.cpp" line="386" column="9" bodyfile="src/policy/policy.cpp" bodystart="386" bodyend="389"/>
      </memberdef>
      <memberdef kind="function" id="policy_8cpp_1a84e0a858e353ffb27cb3e445a5074022" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int64_t</type>
        <definition>int64_t GetVirtualTransactionInputSize</definition>
        <argsstring>(const CTxIn &amp;txin, int64_t nSigOpCost, unsigned int bytes_per_sigop)</argsstring>
        <name>GetVirtualTransactionInputSize</name>
        <param>
          <type>const <ref refid="class_c_tx_in" kindref="compound">CTxIn</ref> &amp;</type>
          <declname>txin</declname>
        </param>
        <param>
          <type>int64_t</type>
          <declname>nSigOpCost</declname>
        </param>
        <param>
          <type>unsigned int</type>
          <declname>bytes_per_sigop</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/policy/policy.cpp" line="391" column="9" bodyfile="src/policy/policy.cpp" bodystart="391" bodyend="394"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2009-2010<sp/>Satoshi<sp/>Nakamoto</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2009-present<sp/>The<sp/>Bitcoin<sp/>Core<sp/>developers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Distributed<sp/>under<sp/>the<sp/>MIT<sp/>software<sp/>license,<sp/>see<sp/>the<sp/>accompanying</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="comment">//<sp/>file<sp/>COPYING<sp/>or<sp/>http://www.opensource.org/licenses/mit-license.php.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="comment">//<sp/>NOTE:<sp/>This<sp/>file<sp/>is<sp/>intended<sp/>to<sp/>be<sp/>customised<sp/>by<sp/>the<sp/>end<sp/>user,<sp/>and<sp/>includes<sp/>only<sp/>local<sp/>node<sp/>policy<sp/>logic</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="policy_8h" kindref="compound">policy/policy.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;coins.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="amount_8h" kindref="compound">consensus/amount.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="consensus_8h" kindref="compound">consensus/consensus.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="consensus_2validation_8h" kindref="compound">consensus/validation.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="feerate_8h" kindref="compound">policy/feerate.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="primitives_2transaction_8h" kindref="compound">primitives/transaction.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="interpreter_8h" kindref="compound">script/interpreter.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="script_2script_8h" kindref="compound">script/script.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="solver_8h" kindref="compound">script/solver.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="serialize_8h" kindref="compound">serialize.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="span_8h" kindref="compound">span.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;algorithm&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;cstddef&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;vector&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"><ref refid="amount_8h_1a4eaf3a5239714d8c45b851527f7cb564" kindref="member">CAmount</ref><sp/><ref refid="policy_8cpp_1a7b1001b4a41a02d9469e3b6985587300" kindref="member">GetDustThreshold</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_tx_out" kindref="compound">CTxOut</ref>&amp;<sp/>txout,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_fee_rate" kindref="compound">CFeeRate</ref>&amp;<sp/>dustRelayFeeIn)</highlight></codeline>
<codeline lineno="27"><highlight class="normal">{</highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>&quot;Dust&quot;<sp/>is<sp/>defined<sp/>in<sp/>terms<sp/>of<sp/>dustRelayFee,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>which<sp/>has<sp/>units<sp/>satoshis-per-kilobyte.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>you&apos;d<sp/>pay<sp/>more<sp/>in<sp/>fees<sp/>than<sp/>the<sp/>value<sp/>of<sp/>the<sp/>output</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>spend<sp/>something,<sp/>then<sp/>we<sp/>consider<sp/>it<sp/>dust.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>typical<sp/>spendable<sp/>non-segwit<sp/>txout<sp/>is<sp/>34<sp/>bytes<sp/>big,<sp/>and<sp/>will</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>need<sp/>a<sp/>CTxIn<sp/>of<sp/>at<sp/>least<sp/>148<sp/>bytes<sp/>to<sp/>spend:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>so<sp/>dust<sp/>is<sp/>a<sp/>spendable<sp/>txout<sp/>less<sp/>than</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>182*dustRelayFee/1000<sp/>(in<sp/>satoshis).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>546<sp/>satoshis<sp/>at<sp/>the<sp/>default<sp/>rate<sp/>of<sp/>3000<sp/>sat/kvB.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>typical<sp/>spendable<sp/>segwit<sp/>P2WPKH<sp/>txout<sp/>is<sp/>31<sp/>bytes<sp/>big,<sp/>and<sp/>will</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>need<sp/>a<sp/>CTxIn<sp/>of<sp/>at<sp/>least<sp/>67<sp/>bytes<sp/>to<sp/>spend:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>so<sp/>dust<sp/>is<sp/>a<sp/>spendable<sp/>txout<sp/>less<sp/>than</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>98*dustRelayFee/1000<sp/>(in<sp/>satoshis).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>294<sp/>satoshis<sp/>at<sp/>the<sp/>default<sp/>rate<sp/>of<sp/>3000<sp/>sat/kvB.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(txout.<ref refid="class_c_tx_out_1ae3e8cf0b02315c479aae11f2b51f83bf" kindref="member">scriptPubKey</ref>.<ref refid="class_c_script_1a87fcaf8a15dd5a68d59c467499845ad7" kindref="member">IsUnspendable</ref>())</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/>uint64_t<sp/>nSize{<ref refid="serialize_8h_1ac0154eb0a74cc852efc55684de85b1f5" kindref="member">GetSerializeSize</ref>(txout)};</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>witnessversion<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;unsigned<sp/>char&gt;<sp/>witnessprogram;</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Note<sp/>this<sp/>computation<sp/>is<sp/>for<sp/>spending<sp/>a<sp/>Segwit<sp/>v0<sp/>P2WPKH<sp/>output<sp/>(a<sp/>33<sp/>bytes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>public<sp/>key<sp/>+<sp/>an<sp/>ECDSA<sp/>signature).<sp/>For<sp/>Segwit<sp/>v1<sp/>Taproot<sp/>outputs<sp/>the<sp/>minimum</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>satisfaction<sp/>is<sp/>lower<sp/>(a<sp/>single<sp/>BIP340<sp/>signature)<sp/>but<sp/>this<sp/>computation<sp/>was</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>kept<sp/>to<sp/>not<sp/>further<sp/>reduce<sp/>the<sp/>dust<sp/>level.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>See<sp/>discussion<sp/>in<sp/>https://github.com/bitcoin/bitcoin/pull/22779<sp/>for<sp/>details.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(txout.<ref refid="class_c_tx_out_1ae3e8cf0b02315c479aae11f2b51f83bf" kindref="member">scriptPubKey</ref>.<ref refid="class_c_script_1acc9f83d121b82096dcb2e84aa8fe36ff" kindref="member">IsWitnessProgram</ref>(witnessversion,<sp/>witnessprogram))<sp/>{</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>sum<sp/>the<sp/>sizes<sp/>of<sp/>the<sp/>parts<sp/>of<sp/>a<sp/>transaction<sp/>input</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>with<sp/>75%<sp/>segwit<sp/>discount<sp/>applied<sp/>to<sp/>the<sp/>script<sp/>size.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nSize<sp/>+=<sp/>(32<sp/>+<sp/>4<sp/>+<sp/>1<sp/>+<sp/>(107<sp/>/<sp/>WITNESS_SCALE_FACTOR)<sp/>+<sp/>4);</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nSize<sp/>+=<sp/>(32<sp/>+<sp/>4<sp/>+<sp/>1<sp/>+<sp/>107<sp/>+<sp/>4);<sp/></highlight><highlight class="comment">//<sp/>the<sp/>148<sp/>mentioned<sp/>above</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>dustRelayFeeIn.<ref refid="class_c_fee_rate_1a48858bde2b68fc9bd54f5ae34b45f371" kindref="member">GetFee</ref>(nSize);</highlight></codeline>
<codeline lineno="63"><highlight class="normal">}</highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="policy_8cpp_1ab18c1023518f2920e34e05ca324d0ebb" kindref="member">IsDust</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_tx_out" kindref="compound">CTxOut</ref>&amp;<sp/>txout,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_fee_rate" kindref="compound">CFeeRate</ref>&amp;<sp/>dustRelayFeeIn)</highlight></codeline>
<codeline lineno="66"><highlight class="normal">{</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(txout.<ref refid="class_c_tx_out_1a2565a2ff256ecf0a445d0fc53180fe07" kindref="member">nValue</ref><sp/>&lt;<sp/><ref refid="policy_8cpp_1a7b1001b4a41a02d9469e3b6985587300" kindref="member">GetDustThreshold</ref>(txout,<sp/>dustRelayFeeIn));</highlight></codeline>
<codeline lineno="68"><highlight class="normal">}</highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal">std::vector&lt;uint32_t&gt;<sp/><ref refid="policy_8cpp_1ab2f63d37a5bd44b01b655c2ed855cb68" kindref="member">GetDust</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_transaction" kindref="compound">CTransaction</ref>&amp;<sp/>tx,<sp/><ref refid="class_c_fee_rate" kindref="compound">CFeeRate</ref><sp/>dust_relay_rate)</highlight></codeline>
<codeline lineno="71"><highlight class="normal">{</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;uint32_t&gt;<sp/>dust_outputs;</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(uint32_t<sp/>i{0};<sp/>i<sp/>&lt;<sp/>tx.<ref refid="class_c_transaction_1ab6db6ccb0e8e9a2442296af044a29d56" kindref="member">vout</ref>.size();<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="policy_8cpp_1ab18c1023518f2920e34e05ca324d0ebb" kindref="member">IsDust</ref>(tx.<ref refid="class_c_transaction_1ab6db6ccb0e8e9a2442296af044a29d56" kindref="member">vout</ref>[i],<sp/>dust_relay_rate))<sp/>dust_outputs.push_back(i);</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>dust_outputs;</highlight></codeline>
<codeline lineno="77"><highlight class="normal">}</highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="policy_8cpp_1aacaab3b92ac5b2240e05723c7ff31e25" kindref="member">IsStandard</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_script" kindref="compound">CScript</ref>&amp;<sp/>scriptPubKey,<sp/><ref refid="solver_8h_1ac908d0e5a62eac70931dae97c6fd3c8f" kindref="member">TxoutType</ref>&amp;<sp/>whichType)</highlight></codeline>
<codeline lineno="80"><highlight class="normal">{</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;std::vector&lt;unsigned<sp/>char&gt;<sp/>&gt;<sp/>vSolutions;</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/>whichType<sp/>=<sp/><ref refid="solver_8cpp_1a0664b19198e4496f7cc0365a46a25020" kindref="member">Solver</ref>(scriptPubKey,<sp/>vSolutions);</highlight></codeline>
<codeline lineno="83"><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(whichType<sp/>==<sp/><ref refid="solver_8h_1ac908d0e5a62eac70931dae97c6fd3c8fab4c03417b9e4221f084c33e152c3535f" kindref="member">TxoutType::NONSTANDARD</ref>)<sp/>{</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(whichType<sp/>==<sp/><ref refid="solver_8h_1ac908d0e5a62eac70931dae97c6fd3c8fae50f553ee62b9fcbec1b8c8120c29050" kindref="member">TxoutType::MULTISIG</ref>)<sp/>{</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref><sp/>=<sp/>vSolutions.front()[0];</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>vSolutions.back()[0];</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Support<sp/>up<sp/>to<sp/>x-of-3<sp/>multisig<sp/>txns<sp/>as<sp/>standard</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;<sp/>1<sp/>||<sp/>n<sp/>&gt;<sp/>3)</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m &lt; 1 || m &gt;</ref><sp/>n)</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="95"><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="97"><highlight class="normal">}</highlight></codeline>
<codeline lineno="98"><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="policy_8cpp_1aadd0007b1969edf72c35e598fdadc4de" kindref="member">IsStandardTx</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_transaction" kindref="compound">CTransaction</ref>&amp;<sp/>tx,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::optional&lt;unsigned&gt;&amp;<sp/>max_datacarrier_bytes,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>permit_bare_multisig,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_fee_rate" kindref="compound">CFeeRate</ref>&amp;<sp/>dust_relay_fee,<sp/>std::string&amp;<sp/>reason)</highlight></codeline>
<codeline lineno="100"><highlight class="normal">{</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tx.<ref refid="class_c_transaction_1a4e70f410ba958435b6dfa3b562aa510d" kindref="member">version</ref><sp/>&gt;<sp/>TX_MAX_STANDARD_VERSION<sp/>||<sp/>tx.<ref refid="class_c_transaction_1a4e70f410ba958435b6dfa3b562aa510d" kindref="member">version</ref><sp/>&lt;<sp/>TX_MIN_STANDARD_VERSION)<sp/>{</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>reason<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;version&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Extremely<sp/>large<sp/>transactions<sp/>with<sp/>lots<sp/>of<sp/>inputs<sp/>can<sp/>cost<sp/>the<sp/>network</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>almost<sp/>as<sp/>much<sp/>to<sp/>process<sp/>as<sp/>they<sp/>cost<sp/>the<sp/>sender<sp/>in<sp/>fees,<sp/>because</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>computing<sp/>signature<sp/>hashes<sp/>is<sp/>O(ninputs*txsize).<sp/>Limiting<sp/>transactions</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>MAX_STANDARD_TX_WEIGHT<sp/>mitigates<sp/>CPU<sp/>exhaustion<sp/>attacks.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>sz<sp/>=<sp/>GetTransactionWeight(tx);</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(sz<sp/>&gt;<sp/>MAX_STANDARD_TX_WEIGHT)<sp/>{</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>reason<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;tx-size&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_tx_in" kindref="compound">CTxIn</ref>&amp;<sp/>txin<sp/>:<sp/>tx.<ref refid="class_c_transaction_1aaed1b4913ffce3eaaf4c5e13aa09d27f" kindref="member">vin</ref>)</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Biggest<sp/>&apos;standard&apos;<sp/>txin<sp/>involving<sp/>only<sp/>keys<sp/>is<sp/>a<sp/>15-of-15<sp/>P2SH</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>multisig<sp/>with<sp/>compressed<sp/>keys<sp/>(remember<sp/>the<sp/>MAX_SCRIPT_ELEMENT_SIZE<sp/>byte<sp/>limit<sp/>on</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>redeemScript<sp/>size).<sp/>That<sp/>works<sp/>out<sp/>to<sp/>a<sp/>(15*(33+1))+3=513<sp/>byte</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>redeemScript,<sp/>513+1+15*(73+1)+3=1627<sp/>bytes<sp/>of<sp/>scriptSig,<sp/>which</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>round<sp/>off<sp/>to<sp/>1650(MAX_STANDARD_SCRIPTSIG_SIZE)<sp/>bytes<sp/>for</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>some<sp/>minor<sp/>future-proofing.<sp/>That&apos;s<sp/>also<sp/>enough<sp/>to<sp/>spend<sp/>a</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>20-of-20<sp/>CHECKMULTISIG<sp/>scriptPubKey,<sp/>though<sp/>such<sp/>a<sp/>scriptPubKey</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>is<sp/>not<sp/>considered<sp/>standard.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(txin.<ref refid="class_c_tx_in_1a12bda3b498d6ed110bfb102a19ef5a12" kindref="member">scriptSig</ref>.<ref refid="classprevector_1a60304b65bf89363bcc3165d3cde67f86" kindref="member">size</ref>()<sp/>&gt;<sp/>MAX_STANDARD_SCRIPTSIG_SIZE)<sp/>{</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>reason<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;scriptsig-size&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!txin.<ref refid="class_c_tx_in_1a12bda3b498d6ed110bfb102a19ef5a12" kindref="member">scriptSig</ref>.<ref refid="class_c_script_1ad98c9330dd8511b678f012bc23661f9a" kindref="member">IsPushOnly</ref>())<sp/>{</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>reason<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;scriptsig-not-pushonly&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>datacarrier_bytes_left<sp/>=<sp/>max_datacarrier_bytes.value_or(0);</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="solver_8h_1ac908d0e5a62eac70931dae97c6fd3c8f" kindref="member">TxoutType</ref><sp/>whichType;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_tx_out" kindref="compound">CTxOut</ref>&amp;<sp/>txout<sp/>:<sp/>tx.<ref refid="class_c_transaction_1ab6db6ccb0e8e9a2442296af044a29d56" kindref="member">vout</ref>)<sp/>{</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="policy_8cpp_1aacaab3b92ac5b2240e05723c7ff31e25" kindref="member">::IsStandard</ref>(txout.<ref refid="class_c_tx_out_1ae3e8cf0b02315c479aae11f2b51f83bf" kindref="member">scriptPubKey</ref>,<sp/>whichType))<sp/>{</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>reason<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;scriptpubkey&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="143"><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(whichType<sp/>==<sp/><ref refid="solver_8h_1ac908d0e5a62eac70931dae97c6fd3c8faacefa22e15602129aa782e5495bc496f" kindref="member">TxoutType::NULL_DATA</ref>)<sp/>{</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>size<sp/>=<sp/>txout.<ref refid="class_c_tx_out_1ae3e8cf0b02315c479aae11f2b51f83bf" kindref="member">scriptPubKey</ref>.<ref refid="classprevector_1a60304b65bf89363bcc3165d3cde67f86" kindref="member">size</ref>();</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(size<sp/>&gt;<sp/>datacarrier_bytes_left)<sp/>{</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>reason<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;datacarrier&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>datacarrier_bytes_left<sp/>-=<sp/>size;</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((whichType<sp/>==<sp/><ref refid="solver_8h_1ac908d0e5a62eac70931dae97c6fd3c8fae50f553ee62b9fcbec1b8c8120c29050" kindref="member">TxoutType::MULTISIG</ref>)<sp/>&amp;&amp;<sp/>(!permit_bare_multisig))<sp/>{</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>reason<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;bare-multisig&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="156"><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Only<sp/>MAX_DUST_OUTPUTS_PER_TX<sp/>dust<sp/>is<sp/>permitted(on<sp/>otherwise<sp/>valid<sp/>ephemeral<sp/>dust)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="policy_8cpp_1ab2f63d37a5bd44b01b655c2ed855cb68" kindref="member">GetDust</ref>(tx,<sp/>dust_relay_fee).size()<sp/>&gt;<sp/>MAX_DUST_OUTPUTS_PER_TX)<sp/>{</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>reason<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;dust&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="164"><highlight class="normal">}</highlight></codeline>
<codeline lineno="165"><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>CheckSigopsBIP54(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_transaction" kindref="compound">CTransaction</ref>&amp;<sp/>tx,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache" kindref="compound">CCoinsViewCache</ref>&amp;<sp/>inputs)</highlight></codeline>
<codeline lineno="170"><highlight class="normal">{</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(!tx.<ref refid="class_c_transaction_1a6b4def31a0a2fbc975d0087ad2d4391a" kindref="member">IsCoinBase</ref>());</highlight></codeline>
<codeline lineno="172"><highlight class="normal"></highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>sigops{0};</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>txin:<sp/>tx.<ref refid="class_c_transaction_1aaed1b4913ffce3eaaf4c5e13aa09d27f" kindref="member">vin</ref>)<sp/>{</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>prev_txo{inputs.<ref refid="class_c_coins_view_cache_1a87f1f2449e10859291ddbdc1d090cba3" kindref="member">AccessCoin</ref>(txin.<ref refid="class_c_tx_in_1a1c567359e133d98c72b5e9a928ffd41a" kindref="member">prevout</ref>).<ref refid="class_coin_1adafe93fbab174bb8f09c8a3b9df178fa" kindref="member">out</ref>};</highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Unlike<sp/>the<sp/>existing<sp/>block<sp/>wide<sp/>sigop<sp/>limit<sp/>which<sp/>counts<sp/>sigops<sp/>present<sp/>in<sp/>the<sp/>block</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>itself<sp/>(including<sp/>the<sp/>scriptPubKey<sp/>which<sp/>is<sp/>not<sp/>executed<sp/>until<sp/>spending<sp/>later),<sp/>BIP54</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>counts<sp/>sigops<sp/>in<sp/>the<sp/>block<sp/>where<sp/>they<sp/>are<sp/>potentially<sp/>executed<sp/>(only).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>means<sp/>sigops<sp/>in<sp/>the<sp/>spent<sp/>scriptPubKey<sp/>count<sp/>toward<sp/>the<sp/>limit.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>`fAccurate`<sp/>means<sp/>correctly<sp/>accounting<sp/>sigops<sp/>for<sp/>CHECKMULTISIGs(VERIFY)<sp/>with<sp/>16<sp/>pubkeys</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>or<sp/>fewer.<sp/>This<sp/>method<sp/>of<sp/>accounting<sp/>was<sp/>introduced<sp/>by<sp/>BIP16,<sp/>and<sp/>BIP54<sp/>reuses<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>GetSigOpCount<sp/>call<sp/>on<sp/>the<sp/>previous<sp/>scriptPubKey<sp/>counts<sp/>both<sp/>bare<sp/>and<sp/>P2SH<sp/>sigops.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sigops<sp/>+=<sp/>txin.<ref refid="class_c_tx_in_1a12bda3b498d6ed110bfb102a19ef5a12" kindref="member">scriptSig</ref>.<ref refid="class_c_script_1a80c50b9db06c9c017f27f2eba801e564" kindref="member">GetSigOpCount</ref>(</highlight><highlight class="comment">/*fAccurate=*/</highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sigops<sp/>+=<sp/>prev_txo.scriptPubKey.GetSigOpCount(txin.<ref refid="class_c_tx_in_1a12bda3b498d6ed110bfb102a19ef5a12" kindref="member">scriptSig</ref>);</highlight></codeline>
<codeline lineno="186"><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(sigops<sp/>&gt;<sp/>MAX_TX_LEGACY_SIGOPS)<sp/>{</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="191"><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="193"><highlight class="normal">}</highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="policy_8cpp_1a791e33e18bea9861e449e6ebcfce8890" kindref="member">AreInputsStandard</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_transaction" kindref="compound">CTransaction</ref>&amp;<sp/>tx,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache" kindref="compound">CCoinsViewCache</ref>&amp;<sp/>mapInputs)</highlight></codeline>
<codeline lineno="214"><highlight class="normal">{</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tx.<ref refid="class_c_transaction_1a6b4def31a0a2fbc975d0087ad2d4391a" kindref="member">IsCoinBase</ref>())<sp/>{</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>Coinbases<sp/>don&apos;t<sp/>use<sp/>vin<sp/>normally</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="218"><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!CheckSigopsBIP54(tx,<sp/>mapInputs))<sp/>{</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="222"><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>tx.<ref refid="class_c_transaction_1aaed1b4913ffce3eaaf4c5e13aa09d27f" kindref="member">vin</ref>.size();<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_tx_out" kindref="compound">CTxOut</ref>&amp;<sp/>prev<sp/>=<sp/>mapInputs.<ref refid="class_c_coins_view_cache_1a87f1f2449e10859291ddbdc1d090cba3" kindref="member">AccessCoin</ref>(tx.<ref refid="class_c_transaction_1aaed1b4913ffce3eaaf4c5e13aa09d27f" kindref="member">vin</ref>[i].prevout).<ref refid="class_coin_1adafe93fbab174bb8f09c8a3b9df178fa" kindref="member">out</ref>;</highlight></codeline>
<codeline lineno="225"><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;std::vector&lt;unsigned<sp/>char&gt;<sp/>&gt;<sp/>vSolutions;</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="solver_8h_1ac908d0e5a62eac70931dae97c6fd3c8f" kindref="member">TxoutType</ref><sp/>whichType<sp/>=<sp/><ref refid="solver_8cpp_1a0664b19198e4496f7cc0365a46a25020" kindref="member">Solver</ref>(prev.<ref refid="class_c_tx_out_1ae3e8cf0b02315c479aae11f2b51f83bf" kindref="member">scriptPubKey</ref>,<sp/>vSolutions);</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(whichType<sp/>==<sp/><ref refid="solver_8h_1ac908d0e5a62eac70931dae97c6fd3c8fab4c03417b9e4221f084c33e152c3535f" kindref="member">TxoutType::NONSTANDARD</ref><sp/>||<sp/>whichType<sp/>==<sp/><ref refid="solver_8h_1ac908d0e5a62eac70931dae97c6fd3c8fa0a72348992c8c18c766d8b4040e48065" kindref="member">TxoutType::WITNESS_UNKNOWN</ref>)<sp/>{</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>WITNESS_UNKNOWN<sp/>failures<sp/>are<sp/>typically<sp/>also<sp/>caught<sp/>with<sp/>a<sp/>policy</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>flag<sp/>in<sp/>the<sp/>script<sp/>interpreter,<sp/>but<sp/>it<sp/>can<sp/>be<sp/>helpful<sp/>to<sp/>catch</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>type<sp/>of<sp/>NONSTANDARD<sp/>transaction<sp/>earlier<sp/>in<sp/>transaction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>validation.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(whichType<sp/>==<sp/><ref refid="solver_8h_1ac908d0e5a62eac70931dae97c6fd3c8fa27f02ca8bff408e6f6bfa149474cc28e" kindref="member">TxoutType::SCRIPTHASH</ref>)<sp/>{</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;std::vector&lt;unsigned<sp/>char&gt;<sp/>&gt;<sp/>stack;</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>convert<sp/>the<sp/>scriptSig<sp/>into<sp/>a<sp/>stack,<sp/>so<sp/>we<sp/>can<sp/>inspect<sp/>the<sp/>redeemScript</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="interpreter_8cpp_1a631b2ddc793b03b5914da1eac99bdd17" kindref="member">EvalScript</ref>(stack,<sp/>tx.<ref refid="class_c_transaction_1aaed1b4913ffce3eaaf4c5e13aa09d27f" kindref="member">vin</ref>[i].scriptSig,<sp/>SCRIPT_VERIFY_NONE,<sp/><ref refid="class_base_signature_checker" kindref="compound">BaseSignatureChecker</ref>(),<sp/><ref refid="interpreter_8h_1a3db3199560fd5419a3be2fcd88a28f8fae7b1a5c82772e0e055096008cb9883ef" kindref="member">SigVersion::BASE</ref>))</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(stack.empty())</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_script" kindref="compound">CScript</ref><sp/>subscript(stack.back().begin(),<sp/>stack.back().end());</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(subscript.GetSigOpCount(</highlight><highlight class="keyword">true</highlight><highlight class="normal">)<sp/>&gt;<sp/>MAX_P2SH_SIGOPS)<sp/>{</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="247"><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="249"><highlight class="normal">}</highlight></codeline>
<codeline lineno="250"><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="policy_8cpp_1a8a73d04fc7e2d36b2acc4d6eb0cc2993" kindref="member">IsWitnessStandard</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_transaction" kindref="compound">CTransaction</ref>&amp;<sp/>tx,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache" kindref="compound">CCoinsViewCache</ref>&amp;<sp/>mapInputs)</highlight></codeline>
<codeline lineno="252"><highlight class="normal">{</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tx.<ref refid="class_c_transaction_1a6b4def31a0a2fbc975d0087ad2d4391a" kindref="member">IsCoinBase</ref>())</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>Coinbases<sp/>are<sp/>skipped</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"></highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>tx.<ref refid="class_c_transaction_1aaed1b4913ffce3eaaf4c5e13aa09d27f" kindref="member">vin</ref>.size();<sp/>i++)</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>don&apos;t<sp/>care<sp/>if<sp/>witness<sp/>for<sp/>this<sp/>input<sp/>is<sp/>empty,<sp/>since<sp/>it<sp/>must<sp/>not<sp/>be<sp/>bloated.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>script<sp/>is<sp/>invalid<sp/>without<sp/>witness,<sp/>it<sp/>would<sp/>be<sp/>caught<sp/>sooner<sp/>or<sp/>later<sp/>during<sp/>validation.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tx.<ref refid="class_c_transaction_1aaed1b4913ffce3eaaf4c5e13aa09d27f" kindref="member">vin</ref>[i].scriptWitness.IsNull())</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_tx_out" kindref="compound">CTxOut</ref><sp/>&amp;prev<sp/>=<sp/>mapInputs.<ref refid="class_c_coins_view_cache_1a87f1f2449e10859291ddbdc1d090cba3" kindref="member">AccessCoin</ref>(tx.<ref refid="class_c_transaction_1aaed1b4913ffce3eaaf4c5e13aa09d27f" kindref="member">vin</ref>[i].prevout).<ref refid="class_coin_1adafe93fbab174bb8f09c8a3b9df178fa" kindref="member">out</ref>;</highlight></codeline>
<codeline lineno="264"><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>scriptPubKey<sp/>corresponding<sp/>to<sp/>this<sp/>input:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_script" kindref="compound">CScript</ref><sp/>prevScript<sp/>=<sp/>prev.<ref refid="class_c_tx_out_1ae3e8cf0b02315c479aae11f2b51f83bf" kindref="member">scriptPubKey</ref>;</highlight></codeline>
<codeline lineno="267"><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>witness<sp/>stuffing<sp/>detected</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(prevScript.<ref refid="class_c_script_1a1cb008b3f7fa3620d1beaf7651e9fb1a" kindref="member">IsPayToAnchor</ref>())<sp/>{</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="272"><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>p2sh<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(prevScript.<ref refid="class_c_script_1a4b0e5117708f9c9f449ae68a6ed3ae81" kindref="member">IsPayToScriptHash</ref>())<sp/>{</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector<sp/>&lt;std::vector&lt;unsigned<sp/>char&gt;<sp/>&gt;<sp/>stack;</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>scriptPubKey<sp/>is<sp/>P2SH,<sp/>we<sp/>try<sp/>to<sp/>extract<sp/>the<sp/>redeemScript<sp/>casually<sp/>by<sp/>converting<sp/>the<sp/>scriptSig</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>into<sp/>a<sp/>stack.<sp/>We<sp/>do<sp/>not<sp/>check<sp/>IsPushOnly<sp/>nor<sp/>compare<sp/>the<sp/>hash<sp/>as<sp/>these<sp/>will<sp/>be<sp/>done<sp/>later<sp/>anyway.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>check<sp/>fails<sp/>at<sp/>this<sp/>stage,<sp/>we<sp/>know<sp/>that<sp/>this<sp/>txid<sp/>must<sp/>be<sp/>a<sp/>bad<sp/>one.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="interpreter_8cpp_1a631b2ddc793b03b5914da1eac99bdd17" kindref="member">EvalScript</ref>(stack,<sp/>tx.<ref refid="class_c_transaction_1aaed1b4913ffce3eaaf4c5e13aa09d27f" kindref="member">vin</ref>[i].scriptSig,<sp/>SCRIPT_VERIFY_NONE,<sp/><ref refid="class_base_signature_checker" kindref="compound">BaseSignatureChecker</ref>(),<sp/><ref refid="interpreter_8h_1a3db3199560fd5419a3be2fcd88a28f8fae7b1a5c82772e0e055096008cb9883ef" kindref="member">SigVersion::BASE</ref>))</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(stack.empty())</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>prevScript<sp/>=<sp/><ref refid="class_c_script" kindref="compound">CScript</ref>(stack.back().begin(),<sp/>stack.back().end());</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2sh<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="286"><highlight class="normal"></highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>witnessversion<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;unsigned<sp/>char&gt;<sp/>witnessprogram;</highlight></codeline>
<codeline lineno="289"><highlight class="normal"></highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Non-witness<sp/>program<sp/>must<sp/>not<sp/>be<sp/>associated<sp/>with<sp/>any<sp/>witness</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!prevScript.<ref refid="class_c_script_1acc9f83d121b82096dcb2e84aa8fe36ff" kindref="member">IsWitnessProgram</ref>(witnessversion,<sp/>witnessprogram))</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="293"><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>P2WSH<sp/>standard<sp/>limits</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(witnessversion<sp/>==<sp/>0<sp/>&amp;&amp;<sp/>witnessprogram.size()<sp/>==<sp/>WITNESS_V0_SCRIPTHASH_SIZE)<sp/>{</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tx.<ref refid="class_c_transaction_1aaed1b4913ffce3eaaf4c5e13aa09d27f" kindref="member">vin</ref>[i].scriptWitness.stack.back().size()<sp/>&gt;<sp/>MAX_STANDARD_P2WSH_SCRIPT_SIZE)</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>sizeWitnessStack<sp/>=<sp/>tx.<ref refid="class_c_transaction_1aaed1b4913ffce3eaaf4c5e13aa09d27f" kindref="member">vin</ref>[i].scriptWitness.stack.size()<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(sizeWitnessStack<sp/>&gt;<sp/>MAX_STANDARD_P2WSH_STACK_ITEMS)</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>sizeWitnessStack;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tx.<ref refid="class_c_transaction_1aaed1b4913ffce3eaaf4c5e13aa09d27f" kindref="member">vin</ref>[i].scriptWitness.stack[j].size()<sp/>&gt;<sp/>MAX_STANDARD_P2WSH_STACK_ITEM_SIZE)</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="306"><highlight class="normal"></highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>policy<sp/>limits<sp/>for<sp/>Taproot<sp/>spends:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>-<sp/>MAX_STANDARD_TAPSCRIPT_STACK_ITEM_SIZE<sp/>limit<sp/>for<sp/>stack<sp/>item<sp/>size</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>-<sp/>No<sp/>annexes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(witnessversion<sp/>==<sp/>1<sp/>&amp;&amp;<sp/>witnessprogram.size()<sp/>==<sp/>WITNESS_V1_TAPROOT_SIZE<sp/>&amp;&amp;<sp/>!p2sh)<sp/>{</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Taproot<sp/>spend<sp/>(non-P2SH-wrapped,<sp/>version<sp/>1,<sp/>witness<sp/>program<sp/>size<sp/>32;<sp/>see<sp/>BIP<sp/>341)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::span<sp/>stack{tx.<ref refid="class_c_transaction_1aaed1b4913ffce3eaaf4c5e13aa09d27f" kindref="member">vin</ref>[i].scriptWitness.stack};</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(stack.size()<sp/>&gt;=<sp/>2<sp/>&amp;&amp;<sp/>!stack.back().empty()<sp/>&amp;&amp;<sp/>stack.back()[0]<sp/>==<sp/>ANNEX_TAG)<sp/>{</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Annexes<sp/>are<sp/>nonstandard<sp/>as<sp/>long<sp/>as<sp/>no<sp/>semantics<sp/>are<sp/>defined<sp/>for<sp/>them.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(stack.size()<sp/>&gt;=<sp/>2)<sp/>{</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Script<sp/>path<sp/>spend<sp/>(2<sp/>or<sp/>more<sp/>stack<sp/>elements<sp/>after<sp/>removing<sp/>optional<sp/>annex)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>control_block<sp/>=<sp/><ref refid="span_8h_1a84b987a6009949297393f7ac0ba5771d" kindref="member">SpanPopBack</ref>(stack);</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="span_8h_1a84b987a6009949297393f7ac0ba5771d" kindref="member">SpanPopBack</ref>(stack);<sp/></highlight><highlight class="comment">//<sp/>Ignore<sp/>script</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(control_block.empty())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>Empty<sp/>control<sp/>block<sp/>is<sp/>invalid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((control_block[0]<sp/>&amp;<sp/>TAPROOT_LEAF_MASK)<sp/>==<sp/>TAPROOT_LEAF_TAPSCRIPT)<sp/>{</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Leaf<sp/>version<sp/>0xc0<sp/>(aka<sp/>Tapscript,<sp/>see<sp/>BIP<sp/>342)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>item<sp/>:<sp/>stack)<sp/>{</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(item.size()<sp/>&gt;<sp/>MAX_STANDARD_TAPSCRIPT_STACK_ITEM_SIZE)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(stack.size()<sp/>==<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Key<sp/>path<sp/>spend<sp/>(1<sp/>stack<sp/>element<sp/>after<sp/>removing<sp/>optional<sp/>annex)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>(no<sp/>policy<sp/>rules<sp/>apply)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>0<sp/>stack<sp/>elements;<sp/>this<sp/>is<sp/>already<sp/>invalid<sp/>by<sp/>consensus<sp/>rules</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="338"><highlight class="normal">}</highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="policy_8cpp_1a63d1c42b964069822fdc1687465a6a15" kindref="member">SpendsNonAnchorWitnessProg</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_transaction" kindref="compound">CTransaction</ref>&amp;<sp/>tx,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache" kindref="compound">CCoinsViewCache</ref>&amp;<sp/>prevouts)</highlight></codeline>
<codeline lineno="341"><highlight class="normal">{</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tx.<ref refid="class_c_transaction_1a6b4def31a0a2fbc975d0087ad2d4391a" kindref="member">IsCoinBase</ref>())<sp/>{</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="345"><highlight class="normal"></highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>version;</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;uint8_t&gt;<sp/>program;</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>txin:<sp/>tx.<ref refid="class_c_transaction_1aaed1b4913ffce3eaaf4c5e13aa09d27f" kindref="member">vin</ref>)<sp/>{</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>prev_spk{prevouts.<ref refid="class_c_coins_view_cache_1a87f1f2449e10859291ddbdc1d090cba3" kindref="member">AccessCoin</ref>(txin.<ref refid="class_c_tx_in_1a1c567359e133d98c72b5e9a928ffd41a" kindref="member">prevout</ref>).<ref refid="class_coin_1adafe93fbab174bb8f09c8a3b9df178fa" kindref="member">out</ref>.<ref refid="class_c_tx_out_1ae3e8cf0b02315c479aae11f2b51f83bf" kindref="member">scriptPubKey</ref>};</highlight></codeline>
<codeline lineno="350"><highlight class="normal"></highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Note<sp/>this<sp/>includes<sp/>not-yet-defined<sp/>witness<sp/>programs.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(prev_spk.IsWitnessProgram(version,<sp/>program)<sp/>&amp;&amp;<sp/>!prev_spk.IsPayToAnchor(version,<sp/>program))<sp/>{</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="355"><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>P2SH<sp/>extract<sp/>the<sp/>redeem<sp/>script<sp/>and<sp/>check<sp/>if<sp/>it<sp/>spends<sp/>a<sp/>non-Taproot<sp/>witness<sp/>program.<sp/>Note</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>is<sp/>fine<sp/>to<sp/>call<sp/>EvalScript<sp/>(as<sp/>done<sp/>in<sp/>AreInputsStandard/IsWitnessStandard)<sp/>because<sp/>this</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>function<sp/>is<sp/>only<sp/>ever<sp/>called<sp/>after<sp/>IsStandardTx,<sp/>which<sp/>checks<sp/>the<sp/>scriptsig<sp/>is<sp/>pushonly.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(prev_spk.IsPayToScriptHash())<sp/>{</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>EvalScript<sp/>fails<sp/>or<sp/>results<sp/>in<sp/>an<sp/>empty<sp/>stack,<sp/>the<sp/>transaction<sp/>is<sp/>invalid<sp/>by<sp/>consensus.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector<sp/>&lt;std::vector&lt;uint8_t&gt;&gt;<sp/>stack;</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="interpreter_8cpp_1a631b2ddc793b03b5914da1eac99bdd17" kindref="member">EvalScript</ref>(stack,<sp/>txin.<ref refid="class_c_tx_in_1a12bda3b498d6ed110bfb102a19ef5a12" kindref="member">scriptSig</ref>,<sp/>SCRIPT_VERIFY_NONE,<sp/><ref refid="class_base_signature_checker" kindref="compound">BaseSignatureChecker</ref>{},<sp/><ref refid="interpreter_8h_1a3db3199560fd5419a3be2fcd88a28f8fae7b1a5c82772e0e055096008cb9883ef" kindref="member">SigVersion::BASE</ref>)</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>||<sp/>stack.empty())<sp/>{</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_script" kindref="compound">CScript</ref><sp/>redeem_script{stack.back().begin(),<sp/>stack.back().end()};</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(redeem_script.<ref refid="class_c_script_1acc9f83d121b82096dcb2e84aa8fe36ff" kindref="member">IsWitnessProgram</ref>(version,<sp/>program))<sp/>{</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="372"><highlight class="normal"></highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="374"><highlight class="normal">}</highlight></codeline>
<codeline lineno="375"><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal">int64_t<sp/><ref refid="policy_8cpp_1aca3174d03510603f888f4431b59901ab" kindref="member">GetSigOpsAdjustedWeight</ref>(int64_t<sp/>weight,<sp/>int64_t<sp/>sigop_cost,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bytes_per_sigop)</highlight></codeline>
<codeline lineno="377"><highlight class="normal">{</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::max(weight,<sp/>sigop_cost<sp/>*<sp/>bytes_per_sigop);</highlight></codeline>
<codeline lineno="379"><highlight class="normal">}</highlight></codeline>
<codeline lineno="380"><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal">int64_t<sp/><ref refid="policy_8cpp_1a7cf1495f52acbb4320a50bbb831af44a" kindref="member">GetVirtualTransactionSize</ref>(int64_t<sp/>nWeight,<sp/>int64_t<sp/>nSigOpCost,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bytes_per_sigop)</highlight></codeline>
<codeline lineno="382"><highlight class="normal">{</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(<ref refid="policy_8cpp_1aca3174d03510603f888f4431b59901ab" kindref="member">GetSigOpsAdjustedWeight</ref>(nWeight,<sp/>nSigOpCost,<sp/>bytes_per_sigop)<sp/>+<sp/>WITNESS_SCALE_FACTOR<sp/>-<sp/>1)<sp/>/<sp/>WITNESS_SCALE_FACTOR;</highlight></codeline>
<codeline lineno="384"><highlight class="normal">}</highlight></codeline>
<codeline lineno="385"><highlight class="normal"></highlight></codeline>
<codeline lineno="386"><highlight class="normal">int64_t<sp/><ref refid="policy_8cpp_1a7cf1495f52acbb4320a50bbb831af44a" kindref="member">GetVirtualTransactionSize</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_transaction" kindref="compound">CTransaction</ref>&amp;<sp/>tx,<sp/>int64_t<sp/>nSigOpCost,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bytes_per_sigop)</highlight></codeline>
<codeline lineno="387"><highlight class="normal">{</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="policy_8cpp_1a7cf1495f52acbb4320a50bbb831af44a" kindref="member">GetVirtualTransactionSize</ref>(GetTransactionWeight(tx),<sp/>nSigOpCost,<sp/>bytes_per_sigop);</highlight></codeline>
<codeline lineno="389"><highlight class="normal">}</highlight></codeline>
<codeline lineno="390"><highlight class="normal"></highlight></codeline>
<codeline lineno="391"><highlight class="normal">int64_t<sp/><ref refid="policy_8cpp_1a84e0a858e353ffb27cb3e445a5074022" kindref="member">GetVirtualTransactionInputSize</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_tx_in" kindref="compound">CTxIn</ref>&amp;<sp/>txin,<sp/>int64_t<sp/>nSigOpCost,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bytes_per_sigop)</highlight></codeline>
<codeline lineno="392"><highlight class="normal">{</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="policy_8cpp_1a7cf1495f52acbb4320a50bbb831af44a" kindref="member">GetVirtualTransactionSize</ref>(GetTransactionInputWeight(txin),<sp/>nSigOpCost,<sp/>bytes_per_sigop);</highlight></codeline>
<codeline lineno="394"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="src/policy/policy.cpp"/>
  </compounddef>
</doxygen>
