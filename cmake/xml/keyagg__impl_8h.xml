<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="keyagg__impl_8h" kind="file" language="C++">
    <compoundname>keyagg_impl.h</compoundname>
    <includes refid="string_8h" local="no">string.h</includes>
    <includes refid="keyagg_8h" local="yes">keyagg.h</includes>
    <includes refid="eckey_8h" local="yes">../../eckey.h</includes>
    <includes refid="ecmult_8h" local="yes">../../ecmult.h</includes>
    <includes refid="field_8h" local="yes">../../field.h</includes>
    <includes refid="group_8h" local="yes">../../group.h</includes>
    <includes refid="secp256k1_2src_2hash_8h" local="yes">../../hash.h</includes>
    <includes refid="secp256k1_2src_2util_8h" local="yes">../../util.h</includes>
    <includedby refid="musig_2main__impl_8h" local="yes">src/secp256k1/src/modules/musig/main_impl.h</includedby>
    <incdepgraph>
      <node id="18">
        <label>../../../include/secp256k1.h</label>
        <link refid="secp256k1_8h"/>
        <childnode refid="19" relation="include">
        </childnode>
      </node>
      <node id="21">
        <label>secp256k1_extrakeys.h</label>
        <link refid="secp256k1__extrakeys_8h"/>
        <childnode refid="18" relation="include">
        </childnode>
      </node>
      <node id="20">
        <label>../../../include/secp256k1_musig.h</label>
        <link refid="secp256k1__musig_8h"/>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="26">
        <label>checkmem.h</label>
        <link refid="checkmem_8h"/>
      </node>
      <node id="33">
        <label>../../eckey.h</label>
        <link refid="eckey_8h"/>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
      </node>
      <node id="34">
        <label>ecmult.h</label>
        <link refid="ecmult_8h"/>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
      </node>
      <node id="36">
        <label>ecmult_gen.h</label>
        <link refid="ecmult__gen_8h"/>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="24">
        <label>field.h</label>
        <link refid="field_8h"/>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="30">
        <label>field_5x52.h</label>
        <link refid="field__5x52_8h"/>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="23">
        <label>../../group.h</label>
        <link refid="group_8h"/>
        <childnode refid="24" relation="include">
        </childnode>
      </node>
      <node id="37">
        <label>../../hash.h</label>
        <link refid="secp256k1_2src_2hash_8h"/>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="17">
        <label>keyagg.h</label>
        <link refid="keyagg_8h"/>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>src/secp256k1/src/modules/musig/keyagg_impl.h</label>
        <link refid="keyagg__impl_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
      </node>
      <node id="31">
        <label>../../scalar.h</label>
        <link refid="scalar_8h"/>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
      </node>
      <node id="32">
        <label>scalar_4x64.h</label>
        <link refid="scalar__4x64_8h"/>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="35">
        <label>scratch.h</label>
        <link refid="scratch_8h"/>
      </node>
      <node id="25">
        <label>util.h</label>
        <link refid="secp256k1_2src_2util_8h"/>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="3">
        <label>span.h</label>
        <link refid="span_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>string.h</label>
        <link refid="string_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="9">
        <label>array</label>
      </node>
      <node id="4">
        <label>cassert</label>
      </node>
      <node id="5">
        <label>cstddef</label>
      </node>
      <node id="10">
        <label>cstdint</label>
      </node>
      <node id="11">
        <label>cstring</label>
      </node>
      <node id="29">
        <label>limits.h</label>
      </node>
      <node id="12">
        <label>locale</label>
      </node>
      <node id="6">
        <label>span</label>
      </node>
      <node id="13">
        <label>sstream</label>
      </node>
      <node id="19">
        <label>stddef.h</label>
      </node>
      <node id="22">
        <label>stdint.h</label>
      </node>
      <node id="28">
        <label>stdio.h</label>
      </node>
      <node id="27">
        <label>stdlib.h</label>
      </node>
      <node id="14">
        <label>string</label>
      </node>
      <node id="15">
        <label>string_view</label>
      </node>
      <node id="7">
        <label>type_traits</label>
      </node>
      <node id="8">
        <label>utility</label>
      </node>
      <node id="16">
        <label>vector</label>
      </node>
    </incdepgraph>
    <invincdepgraph>
      <node id="1">
        <label>src/secp256k1/src/modules/musig/keyagg_impl.h</label>
        <link refid="keyagg__impl_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>src/secp256k1/src/modules/musig/main_impl.h</label>
        <link refid="musig_2main__impl_8h"/>
      </node>
    </invincdepgraph>
    <innerclass refid="structsecp256k1__musig__pubkey__agg__ecmult__data" prot="public">secp256k1_musig_pubkey_agg_ecmult_data</innerclass>
    <sectiondef kind="var">
      <memberdef kind="variable" id="keyagg__impl_8h_1a6a839655ad0d02ab650161b0cd99e2b2" prot="public" static="yes" mutable="no">
        <type>const unsigned char</type>
        <definition>const unsigned char secp256k1_musig_keyagg_cache_magic[4]</definition>
        <argsstring>[4]</argsstring>
        <name>secp256k1_musig_keyagg_cache_magic</name>
        <initializer>= { 0xf4, 0xad, 0xbb, 0xdf }</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/keyagg_impl.h" line="19" column="28" bodyfile="src/secp256k1/src/modules/musig/keyagg_impl.h" bodystart="19" bodyend="19"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="func">
      <memberdef kind="function" id="keyagg__impl_8h_1a7acec76ada3a53b4434bc7e85586afdf" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_keyagg_cache_save</definition>
        <argsstring>(secp256k1_musig_keyagg_cache *cache, const secp256k1_keyagg_cache_internal *cache_i)</argsstring>
        <name>secp256k1_keyagg_cache_save</name>
        <param>
          <type><ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref> *</type>
          <declname>cache</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__keyagg__cache__internal" kindref="compound">secp256k1_keyagg_cache_internal</ref> *</type>
          <declname>cache_i</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/keyagg_impl.h" line="31" column="13" bodyfile="src/secp256k1/src/modules/musig/keyagg_impl.h" bodystart="31" bodyend="44"/>
      </memberdef>
      <memberdef kind="function" id="keyagg__impl_8h_1a1940b3a528a2c933b322f44731117169" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_keyagg_cache_load</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_keyagg_cache_internal *cache_i, const secp256k1_musig_keyagg_cache *cache)</argsstring>
        <name>secp256k1_keyagg_cache_load</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__keyagg__cache__internal" kindref="compound">secp256k1_keyagg_cache_internal</ref> *</type>
          <declname>cache_i</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref> *</type>
          <declname>cache</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/keyagg_impl.h" line="46" column="12" bodyfile="src/secp256k1/src/modules/musig/keyagg_impl.h" bodystart="46" bodyend="60"/>
      </memberdef>
      <memberdef kind="function" id="keyagg__impl_8h_1a4abb66bcb0bbdd6d0e957eafa3ff7a2e" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_musig_keyagglist_sha256</definition>
        <argsstring>(secp256k1_sha256 *sha)</argsstring>
        <name>secp256k1_musig_keyagglist_sha256</name>
        <param>
          <type><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref> *</type>
          <declname>sha</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/keyagg_impl.h" line="64" column="13" bodyfile="src/secp256k1/src/modules/musig/keyagg_impl.h" bodystart="64" bodyend="76"/>
      </memberdef>
      <memberdef kind="function" id="keyagg__impl_8h_1ad733abf82cbaaf900dab80f378b855ef" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_musig_compute_pks_hash</definition>
        <argsstring>(const secp256k1_context *ctx, unsigned char *pks_hash, const secp256k1_pubkey *const *pks, size_t np)</argsstring>
        <name>secp256k1_musig_compute_pks_hash</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type>unsigned char *</type>
          <declname>pks_hash</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref> *const *</type>
          <declname>pks</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>np</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/keyagg_impl.h" line="79" column="12" bodyfile="src/secp256k1/src/modules/musig/keyagg_impl.h" bodystart="79" bodyend="95"/>
      </memberdef>
      <memberdef kind="function" id="keyagg__impl_8h_1a1b1c1922a8506adc59f96fb629c43633" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_musig_keyaggcoef_sha256</definition>
        <argsstring>(secp256k1_sha256 *sha)</argsstring>
        <name>secp256k1_musig_keyaggcoef_sha256</name>
        <param>
          <type><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref> *</type>
          <declname>sha</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/keyagg_impl.h" line="99" column="13" bodyfile="src/secp256k1/src/modules/musig/keyagg_impl.h" bodystart="99" bodyend="111"/>
      </memberdef>
      <memberdef kind="function" id="keyagg__impl_8h_1a12b3e08533659fa5ef9d1fe6ad65439a" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_musig_keyaggcoef_internal</definition>
        <argsstring>(secp256k1_scalar *r, const unsigned char *pks_hash, secp256k1_ge *pk, const secp256k1_ge *second_pk)</argsstring>
        <name>secp256k1_musig_keyaggcoef_internal</name>
        <param>
          <type><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>r</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>pks_hash</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>pk</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>second_pk</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/keyagg_impl.h" line="118" column="13" bodyfile="src/secp256k1/src/modules/musig/keyagg_impl.h" bodystart="118" bodyend="143"/>
      </memberdef>
      <memberdef kind="function" id="keyagg__impl_8h_1a6761ea7246a360592a884f9e993e7b46" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_musig_keyaggcoef</definition>
        <argsstring>(secp256k1_scalar *r, const secp256k1_keyagg_cache_internal *cache_i, secp256k1_ge *pk)</argsstring>
        <name>secp256k1_musig_keyaggcoef</name>
        <param>
          <type><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>r</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__keyagg__cache__internal" kindref="compound">secp256k1_keyagg_cache_internal</ref> *</type>
          <declname>cache_i</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>pk</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/keyagg_impl.h" line="147" column="13" bodyfile="src/secp256k1/src/modules/musig/keyagg_impl.h" bodystart="147" bodyend="149"/>
      </memberdef>
      <memberdef kind="function" id="keyagg__impl_8h_1a17ddb6c88c9498dc86e721a8549d8cc2" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_musig_pubkey_agg_callback</definition>
        <argsstring>(secp256k1_scalar *sc, secp256k1_ge *pt, size_t idx, void *data)</argsstring>
        <name>secp256k1_musig_pubkey_agg_callback</name>
        <param>
          <type><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>sc</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>pt</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>idx</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/keyagg_impl.h" line="160" column="12" bodyfile="src/secp256k1/src/modules/musig/keyagg_impl.h" bodystart="160" bodyend="173"/>
      </memberdef>
      <memberdef kind="function" id="keyagg__impl_8h_1af9d6ed51342b250644499d9647837757" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_musig_pubkey_agg</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_xonly_pubkey *agg_pk, secp256k1_musig_keyagg_cache *keyagg_cache, const secp256k1_pubkey *const *pubkeys, size_t n_pubkeys)</argsstring>
        <name>secp256k1_musig_pubkey_agg</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__xonly__pubkey" kindref="compound">secp256k1_xonly_pubkey</ref> *</type>
          <declname>agg_pk</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref> *</type>
          <declname>keyagg_cache</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref> *const *</type>
          <declname>pubkeys</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n_pubkeys</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Computes an aggregate public key and uses it to initialize a keyagg_cache</para>
<para>Different orders of <computeroutput>pubkeys</computeroutput> result in different <computeroutput>agg_pk</computeroutput>s.</para>
<para>Before aggregating, the pubkeys can be sorted with <computeroutput><ref refid="secp256k1_8h_1ace5e4824419ef5e099f920eaa8e7cafb" kindref="member">secp256k1_ec_pubkey_sort</ref></computeroutput> which ensures the same <computeroutput>agg_pk</computeroutput> result for the same multiset of pubkeys. This is useful to do before <computeroutput>pubkey_agg</computeroutput>, such that the order of pubkeys does not affect the aggregate public key.</para>
<para>Returns: 0 if the arguments are invalid, 1 otherwise Args: ctx: pointer to a context object Out: agg_pk: the MuSig-aggregated x-only public key. If you do not need it, this arg can be NULL. keyagg_cache: if non-NULL, pointer to a musig_keyagg_cache struct that is required for signing (or observing the signing session and verifying partial signatures). In: pubkeys: input array of pointers to public keys to aggregate. The order is important; a different order will result in a different aggregate public key. n_pubkeys: length of pubkeys array. Must be greater than 0. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/keyagg_impl.h" line="175" column="5" bodyfile="src/secp256k1/src/modules/musig/keyagg_impl.h" bodystart="175" bodyend="231"/>
      </memberdef>
      <memberdef kind="function" id="keyagg__impl_8h_1aeb67650b15b67b01abfb3cfdcf28d719" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_musig_pubkey_get</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_pubkey *agg_pk, const secp256k1_musig_keyagg_cache *keyagg_cache)</argsstring>
        <name>secp256k1_musig_pubkey_get</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref> *</type>
          <declname>agg_pk</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref> *</type>
          <declname>keyagg_cache</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Obtain the aggregate public key from a keyagg_cache.</para>
<para>This is only useful if you need the non-xonly public key, in particular for plain (non-xonly) tweaking or batch-verifying multiple key aggregations (not implemented).</para>
<para>Returns: 0 if the arguments are invalid, 1 otherwise Args: ctx: pointer to a context object Out: agg_pk: the MuSig-aggregated public key. In: keyagg_cache: pointer to a <computeroutput>musig_keyagg_cache</computeroutput> struct initialized by <computeroutput>musig_pubkey_agg</computeroutput> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/keyagg_impl.h" line="233" column="5" bodyfile="src/secp256k1/src/modules/musig/keyagg_impl.h" bodystart="233" bodyend="245"/>
      </memberdef>
      <memberdef kind="function" id="keyagg__impl_8h_1a2cbdba72db373b9cc4177afc2807955f" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_musig_pubkey_tweak_add_internal</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_pubkey *output_pubkey, secp256k1_musig_keyagg_cache *keyagg_cache, const unsigned char *tweak32, int xonly)</argsstring>
        <name>secp256k1_musig_pubkey_tweak_add_internal</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref> *</type>
          <declname>output_pubkey</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref> *</type>
          <declname>keyagg_cache</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>tweak32</declname>
        </param>
        <param>
          <type>int</type>
          <declname>xonly</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/keyagg_impl.h" line="247" column="12" bodyfile="src/secp256k1/src/modules/musig/keyagg_impl.h" bodystart="247" bodyend="281"/>
      </memberdef>
      <memberdef kind="function" id="keyagg__impl_8h_1ad7db32a46ad915892398ca46fdbe3f55" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_musig_pubkey_ec_tweak_add</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_pubkey *output_pubkey, secp256k1_musig_keyagg_cache *keyagg_cache, const unsigned char *tweak32)</argsstring>
        <name>secp256k1_musig_pubkey_ec_tweak_add</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref> *</type>
          <declname>output_pubkey</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref> *</type>
          <declname>keyagg_cache</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>tweak32</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Apply plain &quot;EC&quot; tweaking to a public key in a given keyagg_cache by adding the generator multiplied with <computeroutput>tweak32</computeroutput> to it. This is useful for deriving child keys from an aggregate public key via BIP 32 where <computeroutput>tweak32</computeroutput> is set to a hash as defined in BIP 32.</para>
<para>Callers are responsible for deriving <computeroutput>tweak32</computeroutput> in a way that does not reduce the security of MuSig (for example, by following BIP 32).</para>
<para>The tweaking method is the same as <computeroutput><ref refid="secp256k1_8h_1aaac0a0211f7ebfa1af55ab571cd57751" kindref="member">secp256k1_ec_pubkey_tweak_add</ref></computeroutput>. So after the following pseudocode buf and buf2 have identical contents (absent earlier failures).</para>
<para>secp256k1_musig_pubkey_agg(..., keyagg_cache, pubkeys, ...) secp256k1_musig_pubkey_get(..., agg_pk, keyagg_cache) secp256k1_musig_pubkey_ec_tweak_add(..., output_pk, tweak32, keyagg_cache) secp256k1_ec_pubkey_serialize(..., buf, ..., output_pk, ...) secp256k1_ec_pubkey_tweak_add(..., agg_pk, tweak32) secp256k1_ec_pubkey_serialize(..., buf2, ..., agg_pk, ...)</para>
<para>This function is required if you want to <emphasis>sign</emphasis> for a tweaked aggregate key. If you are only computing a public key but not intending to create a signature for it, use <computeroutput><ref refid="secp256k1_8h_1aaac0a0211f7ebfa1af55ab571cd57751" kindref="member">secp256k1_ec_pubkey_tweak_add</ref></computeroutput> instead.</para>
<para>Returns: 0 if the arguments are invalid, 1 otherwise Args: ctx: pointer to a context object Out: output_pubkey: pointer to a public key to store the result. Will be set to an invalid value if this function returns 0. If you do not need it, this arg can be NULL. In/Out: keyagg_cache: pointer to a <computeroutput>musig_keyagg_cache</computeroutput> struct initialized by <computeroutput>musig_pubkey_agg</computeroutput> In: tweak32: pointer to a 32-byte tweak. The tweak is valid if it passes <computeroutput><ref refid="secp256k1_8h_1a366f922fc0c787351e82ff8e3a95f652" kindref="member">secp256k1_ec_seckey_verify</ref></computeroutput> and is not equal to the secret key corresponding to the public key represented by keyagg_cache or its negation. For uniformly random 32-byte arrays the chance of being invalid is negligible (around 1 in 2^128). </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/keyagg_impl.h" line="283" column="5" bodyfile="src/secp256k1/src/modules/musig/keyagg_impl.h" bodystart="283" bodyend="285"/>
      </memberdef>
      <memberdef kind="function" id="keyagg__impl_8h_1ab93abf3ae42ca6630555c1025b64b819" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_musig_pubkey_xonly_tweak_add</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_pubkey *output_pubkey, secp256k1_musig_keyagg_cache *keyagg_cache, const unsigned char *tweak32)</argsstring>
        <name>secp256k1_musig_pubkey_xonly_tweak_add</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref> *</type>
          <declname>output_pubkey</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref> *</type>
          <declname>keyagg_cache</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>tweak32</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Apply x-only tweaking to a public key in a given keyagg_cache by adding the generator multiplied with <computeroutput>tweak32</computeroutput> to it. This is useful for creating Taproot outputs where <computeroutput>tweak32</computeroutput> is set to a TapTweak hash as defined in BIP 341.</para>
<para>Callers are responsible for deriving <computeroutput>tweak32</computeroutput> in a way that does not reduce the security of MuSig (for example, by following Taproot BIP 341).</para>
<para>The tweaking method is the same as <computeroutput><ref refid="secp256k1__extrakeys_8h_1aaf832fa110c2610d69dee6ca74c856e8" kindref="member">secp256k1_xonly_pubkey_tweak_add</ref></computeroutput>. So in the following pseudocode xonly_pubkey_tweak_add_check (absent earlier failures) returns 1.</para>
<para>secp256k1_musig_pubkey_agg(..., agg_pk, keyagg_cache, pubkeys, ...) secp256k1_musig_pubkey_xonly_tweak_add(..., output_pk, keyagg_cache, tweak32) secp256k1_xonly_pubkey_serialize(..., buf, output_pk) secp256k1_xonly_pubkey_tweak_add_check(..., buf, ..., agg_pk, tweak32)</para>
<para>This function is required if you want to <emphasis>sign</emphasis> for a tweaked aggregate key. If you are only computing a public key but not intending to create a signature for it, use <computeroutput><ref refid="secp256k1__extrakeys_8h_1aaf832fa110c2610d69dee6ca74c856e8" kindref="member">secp256k1_xonly_pubkey_tweak_add</ref></computeroutput> instead.</para>
<para>Returns: 0 if the arguments are invalid, 1 otherwise Args: ctx: pointer to a context object Out: output_pubkey: pointer to a public key to store the result. Will be set to an invalid value if this function returns 0. If you do not need it, this arg can be NULL. In/Out: keyagg_cache: pointer to a <computeroutput>musig_keyagg_cache</computeroutput> struct initialized by <computeroutput>musig_pubkey_agg</computeroutput> In: tweak32: pointer to a 32-byte tweak. The tweak is valid if it passes <computeroutput><ref refid="secp256k1_8h_1a366f922fc0c787351e82ff8e3a95f652" kindref="member">secp256k1_ec_seckey_verify</ref></computeroutput> and is not equal to the secret key corresponding to the public key represented by keyagg_cache or its negation. For uniformly random 32-byte arrays the chance of being invalid is negligible (around 1 in 2^128). </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/keyagg_impl.h" line="287" column="5" bodyfile="src/secp256k1/src/modules/musig/keyagg_impl.h" bodystart="287" bodyend="289"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/***********************************************************************</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>Distributed<sp/>under<sp/>the<sp/>MIT<sp/>software<sp/>license,<sp/>see<sp/>the<sp/>accompanying<sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>file<sp/>COPYING<sp/>or<sp/>https://www.opensource.org/licenses/mit-license.php.*</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>***********************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>SECP256K1_MODULE_MUSIG_KEYAGG_IMPL_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>SECP256K1_MODULE_MUSIG_KEYAGG_IMPL_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="string_8h" kindref="compound">string.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="keyagg_8h" kindref="compound">keyagg.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="eckey_8h" kindref="compound">../../eckey.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="ecmult_8h" kindref="compound">../../ecmult.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="field_8h" kindref="compound">../../field.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="group_8h" kindref="compound">../../group.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="secp256k1_2src_2hash_8h" kindref="compound">../../hash.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="secp256k1_2src_2util_8h" kindref="compound">../../util.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>secp256k1_musig_keyagg_cache_magic[4]<sp/>=<sp/>{<sp/>0xf4,<sp/>0xad,<sp/>0xbb,<sp/>0xdf<sp/>};</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>A<sp/>keyagg<sp/>cache<sp/>consists<sp/>of</highlight></codeline>
<codeline lineno="22"><highlight class="comment"><sp/>*<sp/>-<sp/>4<sp/>byte<sp/>magic<sp/>set<sp/>during<sp/>initialization<sp/>to<sp/>allow<sp/>detecting<sp/>an<sp/>uninitialized</highlight></codeline>
<codeline lineno="23"><highlight class="comment"><sp/>*<sp/><sp/><sp/>object.</highlight></codeline>
<codeline lineno="24"><highlight class="comment"><sp/>*<sp/>-<sp/>64<sp/>byte<sp/>aggregate<sp/>(and<sp/>potentially<sp/>tweaked)<sp/>public<sp/>key</highlight></codeline>
<codeline lineno="25"><highlight class="comment"><sp/>*<sp/>-<sp/>64<sp/>byte<sp/>&quot;second&quot;<sp/>public<sp/>key<sp/>(set<sp/>to<sp/>the<sp/>point<sp/>at<sp/>infinity<sp/>if<sp/>not<sp/>present)</highlight></codeline>
<codeline lineno="26"><highlight class="comment"><sp/>*<sp/>-<sp/>32<sp/>byte<sp/>hash<sp/>of<sp/>all<sp/>public<sp/>keys</highlight></codeline>
<codeline lineno="27"><highlight class="comment"><sp/>*<sp/>-<sp/>1<sp/>byte<sp/>the<sp/>parity<sp/>of<sp/>the<sp/>internal<sp/>key<sp/>(if<sp/>tweaked,<sp/>otherwise<sp/>0)</highlight></codeline>
<codeline lineno="28"><highlight class="comment"><sp/>*<sp/>-<sp/>32<sp/>byte<sp/>tweak</highlight></codeline>
<codeline lineno="29"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Requires<sp/>that<sp/>cache_i-&gt;pk<sp/>is<sp/>not<sp/>infinity.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_keyagg_cache_save(<ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref><sp/>*cache,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__keyagg__cache__internal" kindref="compound">secp256k1_keyagg_cache_internal</ref><sp/>*cache_i)<sp/>{</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ptr<sp/>=<sp/>cache-&gt;<ref refid="structsecp256k1__musig__keyagg__cache_1a18b34cf51499db83547e25862d9e09ab" kindref="member">data</ref>;</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(ptr,<sp/>secp256k1_musig_keyagg_cache_magic,<sp/>4);</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>4;</highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ge_to_bytes(ptr,<sp/>&amp;cache_i-&gt;<ref refid="structsecp256k1__keyagg__cache__internal_1ab83e13ae5a279c417f3c293c3ac8dbaa" kindref="member">pk</ref>);</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>64;</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ge_to_bytes_ext(ptr,<sp/>&amp;cache_i-&gt;<ref refid="structsecp256k1__keyagg__cache__internal_1a537488b6554a1d8358028f28a975e9e5" kindref="member">second_pk</ref>);</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>64;</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(ptr,<sp/>cache_i-&gt;<ref refid="structsecp256k1__keyagg__cache__internal_1ae256bff40cbdb454fd743877d77ce420" kindref="member">pks_hash</ref>,<sp/>32);</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>32;</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/>*ptr<sp/>=<sp/>cache_i-&gt;<ref refid="structsecp256k1__keyagg__cache__internal_1a5bd267ac4dec5fd0394bb1d61b918a22" kindref="member">parity_acc</ref>;</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>1;</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_get_b32(ptr,<sp/>&amp;cache_i-&gt;<ref refid="structsecp256k1__keyagg__cache__internal_1aed924c8b7cb5c081a66d7ce1059f040e" kindref="member">tweak</ref>);</highlight></codeline>
<codeline lineno="44"><highlight class="normal">}</highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_keyagg_cache_load(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__keyagg__cache__internal" kindref="compound">secp256k1_keyagg_cache_internal</ref><sp/>*cache_i,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref><sp/>*cache)<sp/>{</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ptr<sp/>=<sp/>cache-&gt;<ref refid="structsecp256k1__musig__keyagg__cache_1a18b34cf51499db83547e25862d9e09ab" kindref="member">data</ref>;</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(secp256k1_memcmp_var(ptr,<sp/>secp256k1_musig_keyagg_cache_magic,<sp/>4)<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>4;</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ge_from_bytes(&amp;cache_i-&gt;<ref refid="structsecp256k1__keyagg__cache__internal_1ab83e13ae5a279c417f3c293c3ac8dbaa" kindref="member">pk</ref>,<sp/>ptr);</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>64;</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ge_from_bytes_ext(&amp;cache_i-&gt;<ref refid="structsecp256k1__keyagg__cache__internal_1a537488b6554a1d8358028f28a975e9e5" kindref="member">second_pk</ref>,<sp/>ptr);</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>64;</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(cache_i-&gt;<ref refid="structsecp256k1__keyagg__cache__internal_1ae256bff40cbdb454fd743877d77ce420" kindref="member">pks_hash</ref>,<sp/>ptr,<sp/>32);</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>32;</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/>cache_i-&gt;<ref refid="structsecp256k1__keyagg__cache__internal_1a5bd267ac4dec5fd0394bb1d61b918a22" kindref="member">parity_acc</ref><sp/>=<sp/>*ptr<sp/>&amp;<sp/>1;</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>1;</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_set_b32(&amp;cache_i-&gt;<ref refid="structsecp256k1__keyagg__cache__internal_1aed924c8b7cb5c081a66d7ce1059f040e" kindref="member">tweak</ref>,<sp/>ptr,<sp/>NULL);</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="60"><highlight class="normal">}</highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Initializes<sp/>SHA256<sp/>with<sp/>fixed<sp/>midstate.<sp/>This<sp/>midstate<sp/>was<sp/>computed<sp/>by<sp/>applying</highlight></codeline>
<codeline lineno="63"><highlight class="comment"><sp/>*<sp/>SHA256<sp/>to<sp/>SHA256(&quot;KeyAgg<sp/>list&quot;)||SHA256(&quot;KeyAgg<sp/>list&quot;).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_musig_keyagglist_sha256(<ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>*sha)<sp/>{</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_initialize(sha);</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[0]<sp/>=<sp/>0xb399d5e0ul;</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[1]<sp/>=<sp/>0xc8fff302ul;</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[2]<sp/>=<sp/>0x6badac71ul;</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[3]<sp/>=<sp/>0x07c5b7f1ul;</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[4]<sp/>=<sp/>0x9701e2eful;</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[5]<sp/>=<sp/>0x2a72ecf8ul;</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[6]<sp/>=<sp/>0x201a4c7bul;</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[7]<sp/>=<sp/>0xab148a38ul;</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a386a3a5adc6cdeb2f1083b3c3d08e7d0" kindref="member">bytes</ref><sp/>=<sp/>64;</highlight></codeline>
<codeline lineno="76"><highlight class="normal">}</highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Computes<sp/>pks_hash<sp/>=<sp/>tagged_hash(pk[0],<sp/>...,<sp/>pk[np-1])<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_musig_compute_pks_hash(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref><sp/>*ctx,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*pks_hash,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref><sp/>*<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">*<sp/>pks,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>np)<sp/>{</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>sha;</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_keyagglist_sha256(&amp;sha);</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>np;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>ser[33];</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>ser_len<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(ser);</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="secp256k1_8h_1a34977bf00322e510e881160c421836d7" kindref="member">secp256k1_ec_pubkey_serialize</ref>(ctx,<sp/>ser,<sp/>&amp;ser_len,<sp/>pks[i],<sp/><ref refid="secp256k1_8h_1a7b8f642c65e8b5c81fa4421b7c42ab57" kindref="member">SECP256K1_EC_COMPRESSED</ref>))<sp/>{</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ser_len<sp/>==<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(ser));</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;sha,<sp/>ser,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(ser));</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_finalize(&amp;sha,<sp/>pks_hash);</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="95"><highlight class="normal">}</highlight></codeline>
<codeline lineno="96"><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Initializes<sp/>SHA256<sp/>with<sp/>fixed<sp/>midstate.<sp/>This<sp/>midstate<sp/>was<sp/>computed<sp/>by<sp/>applying</highlight></codeline>
<codeline lineno="98"><highlight class="comment"><sp/>*<sp/>SHA256<sp/>to<sp/>SHA256(&quot;KeyAgg<sp/>coefficient&quot;)||SHA256(&quot;KeyAgg<sp/>coefficient&quot;).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_musig_keyaggcoef_sha256(<ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>*sha)<sp/>{</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_initialize(sha);</highlight></codeline>
<codeline lineno="101"><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[0]<sp/>=<sp/>0x6ef02c5aul;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[1]<sp/>=<sp/>0x06a480deul;</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[2]<sp/>=<sp/>0x1f298665ul;</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[3]<sp/>=<sp/>0x1d1134f2ul;</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[4]<sp/>=<sp/>0x56a0b063ul;</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[5]<sp/>=<sp/>0x52da4147ul;</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[6]<sp/>=<sp/>0xf280d9d4ul;</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[7]<sp/>=<sp/>0x4484be15ul;</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a386a3a5adc6cdeb2f1083b3c3d08e7d0" kindref="member">bytes</ref><sp/>=<sp/>64;</highlight></codeline>
<codeline lineno="111"><highlight class="normal">}</highlight></codeline>
<codeline lineno="112"><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Compute<sp/>KeyAgg<sp/>coefficient<sp/>which<sp/>is<sp/>constant<sp/>1<sp/>for<sp/>the<sp/>second<sp/>pubkey<sp/>and</highlight></codeline>
<codeline lineno="114"><highlight class="comment"><sp/>*<sp/>otherwise<sp/>tagged_hash(pks_hash,<sp/>pk)<sp/>where<sp/>pks_hash<sp/>is<sp/>the<sp/>hash<sp/>of<sp/>public<sp/>keys.</highlight></codeline>
<codeline lineno="115"><highlight class="comment"><sp/>*<sp/>second_pk<sp/>is<sp/>the<sp/>point<sp/>at<sp/>infinity<sp/>in<sp/>case<sp/>there<sp/>is<sp/>no<sp/>second_pk.<sp/>Assumes</highlight></codeline>
<codeline lineno="116"><highlight class="comment"><sp/>*<sp/>that<sp/>pk<sp/>is<sp/>not<sp/>the<sp/>point<sp/>at<sp/>infinity<sp/>and<sp/>that<sp/>the<sp/>Y-coordinates<sp/>of<sp/>pk<sp/>and</highlight></codeline>
<codeline lineno="117"><highlight class="comment"><sp/>*<sp/>second_pk<sp/>are<sp/>normalized.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_musig_keyaggcoef_internal(<ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*r,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*pks_hash,<sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*pk,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*second_pk)<sp/>{</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(!secp256k1_ge_is_infinity(pk));</highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_ge_is_infinity(second_pk)</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;&amp;<sp/>secp256k1_ge_eq_var(pk,<sp/>second_pk))<sp/>{</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_set_int(r,<sp/>1);</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>sha;</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>buf[33];</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>buflen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(buf);</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_musig_keyaggcoef_sha256(&amp;sha);</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;sha,<sp/>pks_hash,<sp/>32);</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/>secp256k1_eckey_pubkey_serialize(pk,<sp/>buf,<sp/>&amp;buflen,<sp/>1);</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>VERIFY</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Serialization<sp/>does<sp/>not<sp/>fail<sp/>since<sp/>the<sp/>pk<sp/>is<sp/>not<sp/>the<sp/>point<sp/>at<sp/>infinity</highlight></codeline>
<codeline lineno="134"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>(according<sp/>to<sp/>this<sp/>function&apos;s<sp/>precondition).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>&amp;&amp;<sp/>buflen<sp/>==<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(buf));</highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(void)<sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;sha,<sp/>buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(buf));</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_sha256_finalize(&amp;sha,<sp/>buf);</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_set_b32(r,<sp/>buf,<sp/>NULL);</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="143"><highlight class="normal">}</highlight></codeline>
<codeline lineno="144"><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Assumes<sp/>that<sp/>pk<sp/>is<sp/>not<sp/>the<sp/>point<sp/>at<sp/>infinity<sp/>and<sp/>that<sp/>the<sp/>Y-coordinates<sp/>of<sp/>pk</highlight></codeline>
<codeline lineno="146"><highlight class="comment"><sp/>*<sp/>and<sp/>cache_i-&gt;second_pk<sp/>are<sp/>normalized.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_musig_keyaggcoef(<ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*r,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__keyagg__cache__internal" kindref="compound">secp256k1_keyagg_cache_internal</ref><sp/>*cache_i,<sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*pk)<sp/>{</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_keyaggcoef_internal(r,<sp/>cache_i-&gt;<ref refid="structsecp256k1__keyagg__cache__internal_1ae256bff40cbdb454fd743877d77ce420" kindref="member">pks_hash</ref>,<sp/>pk,<sp/>&amp;cache_i-&gt;<ref refid="structsecp256k1__keyagg__cache__internal_1a537488b6554a1d8358028f28a975e9e5" kindref="member">second_pk</ref>);</highlight></codeline>
<codeline lineno="149"><highlight class="normal">}</highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight></codeline>
<codeline lineno="151" refid="structsecp256k1__musig__pubkey__agg__ecmult__data" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="152" refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1a71fd62653cfbe58733bb9748fe9d83b2" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref><sp/>*<ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1a71fd62653cfbe58733bb9748fe9d83b2" kindref="member">ctx</ref>;</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>pks_hash<sp/>is<sp/>the<sp/>hash<sp/>of<sp/>the<sp/>public<sp/>keys<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="154" refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1ae256bff40cbdb454fd743877d77ce420" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1ae256bff40cbdb454fd743877d77ce420" kindref="member">pks_hash</ref>[32];</highlight></codeline>
<codeline lineno="155" refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1a4bbe2c7ace5e4f9f684ed78d36d87437" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref><sp/>*<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">*<sp/><ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1a4bbe2c7ace5e4f9f684ed78d36d87437" kindref="member">pks</ref>;</highlight></codeline>
<codeline lineno="156" refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1a537488b6554a1d8358028f28a975e9e5" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/><ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1a537488b6554a1d8358028f28a975e9e5" kindref="member">second_pk</ref>;</highlight></codeline>
<codeline lineno="157"><highlight class="normal">}<sp/><ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data" kindref="compound">secp256k1_musig_pubkey_agg_ecmult_data</ref>;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Callback<sp/>for<sp/>batch<sp/>EC<sp/>multiplication<sp/>to<sp/>compute<sp/>keyaggcoef_0*P0<sp/>+<sp/>keyaggcoef_1*P1<sp/>+<sp/>...<sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_musig_pubkey_agg_callback(<ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*sc,<sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*pt,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>idx,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*data)<sp/>{</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data" kindref="compound">secp256k1_musig_pubkey_agg_ecmult_data</ref><sp/>*ctx<sp/>=<sp/>(<ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data" kindref="compound">secp256k1_musig_pubkey_agg_ecmult_data</ref><sp/>*)<sp/>data;</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/>secp256k1_pubkey_load(ctx-&gt;<ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1a71fd62653cfbe58733bb9748fe9d83b2" kindref="member">ctx</ref>,<sp/>pt,<sp/>ctx-&gt;<ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1a4bbe2c7ace5e4f9f684ed78d36d87437" kindref="member">pks</ref>[idx]);</highlight></codeline>
<codeline lineno="164"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>VERIFY</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>pubkey_load<sp/>can&apos;t<sp/>fail<sp/>because<sp/>the<sp/>same<sp/>pks<sp/>have<sp/>already<sp/>been<sp/>loaded<sp/>in</highlight></codeline>
<codeline lineno="166"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>`musig_compute_pks_hash`<sp/>(and<sp/>we<sp/>test<sp/>this).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)<sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="170"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_keyaggcoef_internal(sc,<sp/>ctx-&gt;<ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1ae256bff40cbdb454fd743877d77ce420" kindref="member">pks_hash</ref>,<sp/>pt,<sp/>&amp;ctx-&gt;<ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1a537488b6554a1d8358028f28a975e9e5" kindref="member">second_pk</ref>);</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="173"><highlight class="normal">}</highlight></codeline>
<codeline lineno="174"><highlight class="normal"></highlight></codeline>
<codeline lineno="175" refid="secp256k1__musig_8h_1ad0ad82976282fb6cbc20e24994ab6d94" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="keyagg__impl_8h_1af9d6ed51342b250644499d9647837757" kindref="member">secp256k1_musig_pubkey_agg</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__xonly__pubkey" kindref="compound">secp256k1_xonly_pubkey</ref><sp/>*agg_pk,<sp/><ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref><sp/>*keyagg_cache,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref><sp/>*<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">*<sp/>pubkeys,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_pubkeys)<sp/>{</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data" kindref="compound">secp256k1_musig_pubkey_agg_ecmult_data</ref><sp/>ecmult_data;</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>pkj;</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>pkp;</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="180"><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(agg_pk<sp/>!=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memset(agg_pk,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*agg_pk));</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(pubkeys<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(n_pubkeys<sp/>&gt;<sp/>0);</highlight></codeline>
<codeline lineno="187"><highlight class="normal"></highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/>ecmult_data.<ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1a71fd62653cfbe58733bb9748fe9d83b2" kindref="member">ctx</ref><sp/>=<sp/>ctx;</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/>ecmult_data.<ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1a4bbe2c7ace5e4f9f684ed78d36d87437" kindref="member">pks</ref><sp/>=<sp/>pubkeys;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"></highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ge_set_infinity(&amp;ecmult_data.<ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1a537488b6554a1d8358028f28a975e9e5" kindref="member">second_pk</ref>);</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>1;<sp/>i<sp/>&lt;<sp/>n_pubkeys;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(secp256k1_memcmp_var(pubkeys[0],<sp/>pubkeys[i],<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*pubkeys[0]))<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>pk;</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_pubkey_load(ctx,<sp/>&amp;pk,<sp/>pubkeys[i]))<sp/>{</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ecmult_data.<ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1a537488b6554a1d8358028f28a975e9e5" kindref="member">second_pk</ref><sp/>=<sp/>pk;</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="202"><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_musig_compute_pks_hash(ctx,<sp/>ecmult_data.<ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1ae256bff40cbdb454fd743877d77ce420" kindref="member">pks_hash</ref>,<sp/>pubkeys,<sp/>n_pubkeys))<sp/>{</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>TODO:<sp/>actually<sp/>use<sp/>optimized<sp/>ecmult_multi<sp/>algorithms<sp/>by<sp/>providing<sp/>a</highlight></codeline>
<codeline lineno="207"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>scratch<sp/>space<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_ecmult_multi_var(&amp;ctx-&gt;<ref refid="structsecp256k1__context__struct_1af19d0afeed943bdece4311571cf7aaa5" kindref="member">error_callback</ref>,<sp/>NULL,<sp/>&amp;pkj,<sp/>NULL,<sp/>secp256k1_musig_pubkey_agg_callback,<sp/>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*)<sp/>&amp;ecmult_data,<sp/>n_pubkeys))<sp/>{</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>In<sp/>order<sp/>to<sp/>reach<sp/>this<sp/>line<sp/>with<sp/>the<sp/>current<sp/>implementation<sp/>of</highlight></codeline>
<codeline lineno="210"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>ecmult_multi_var<sp/>one<sp/>would<sp/>need<sp/>to<sp/>provide<sp/>a<sp/>callback<sp/>that<sp/>can</highlight></codeline>
<codeline lineno="211"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>fail.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ge_set_gej(&amp;pkp,<sp/>&amp;pkj);</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a80e6ef8a08736aad544787a388956f5c" kindref="member">secp256k1_fe_normalize_var</ref>(&amp;pkp.<ref refid="structsecp256k1__ge_1a8ab8d07fa557181528b86bd1c9bb2b92" kindref="member">y</ref>);</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>resulting<sp/>public<sp/>key<sp/>is<sp/>infinity<sp/>with<sp/>negligible<sp/>probability<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(!secp256k1_ge_is_infinity(&amp;pkp));</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(keyagg_cache<sp/>!=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__keyagg__cache__internal" kindref="compound">secp256k1_keyagg_cache_internal</ref><sp/>cache_i<sp/>=<sp/>{<sp/>0<sp/>};</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1ab83e13ae5a279c417f3c293c3ac8dbaa" kindref="member">pk</ref><sp/>=<sp/>pkp;</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1a537488b6554a1d8358028f28a975e9e5" kindref="member">second_pk</ref><sp/>=<sp/>ecmult_data.<ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1a537488b6554a1d8358028f28a975e9e5" kindref="member">second_pk</ref>;</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1ae256bff40cbdb454fd743877d77ce420" kindref="member">pks_hash</ref>,<sp/>ecmult_data.<ref refid="structsecp256k1__musig__pubkey__agg__ecmult__data_1ae256bff40cbdb454fd743877d77ce420" kindref="member">pks_hash</ref>,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1ae256bff40cbdb454fd743877d77ce420" kindref="member">pks_hash</ref>));</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_keyagg_cache_save(keyagg_cache,<sp/>&amp;cache_i);</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="225"><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(agg_pk<sp/>!=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_extrakeys_ge_even_y(&amp;pkp);</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_xonly_pubkey_save(agg_pk,<sp/>&amp;pkp);</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="231"><highlight class="normal">}</highlight></codeline>
<codeline lineno="232"><highlight class="normal"></highlight></codeline>
<codeline lineno="233" refid="secp256k1__musig_8h_1a636bae714ad303b3985fb2c3df5c8c39" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="keyagg__impl_8h_1aeb67650b15b67b01abfb3cfdcf28d719" kindref="member">secp256k1_musig_pubkey_get</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref><sp/>*agg_pk,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref><sp/>*keyagg_cache)<sp/>{</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__keyagg__cache__internal" kindref="compound">secp256k1_keyagg_cache_internal</ref><sp/>cache_i;</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(agg_pk<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(agg_pk,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*agg_pk));</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(keyagg_cache<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="239"><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_keyagg_cache_load(ctx,<sp/>&amp;cache_i,<sp/>keyagg_cache))<sp/>{</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_pubkey_save(agg_pk,<sp/>&amp;cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1ab83e13ae5a279c417f3c293c3ac8dbaa" kindref="member">pk</ref>);</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="245"><highlight class="normal">}</highlight></codeline>
<codeline lineno="246"><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_musig_pubkey_tweak_add_internal(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref><sp/>*output_pubkey,<sp/><ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref><sp/>*keyagg_cache,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*tweak32,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>xonly)<sp/>{</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__keyagg__cache__internal" kindref="compound">secp256k1_keyagg_cache_internal</ref><sp/>cache_i;</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>overflow<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>tweak;</highlight></codeline>
<codeline lineno="251"><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(output_pubkey<sp/>!=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memset(output_pubkey,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*output_pubkey));</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(keyagg_cache<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(tweak32<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="258"><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_keyagg_cache_load(ctx,<sp/>&amp;cache_i,<sp/>keyagg_cache))<sp/>{</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_set_b32(&amp;tweak,<sp/>tweak32,<sp/>&amp;overflow);</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(overflow)<sp/>{</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(xonly<sp/>&amp;&amp;<sp/>secp256k1_extrakeys_ge_even_y(&amp;cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1ab83e13ae5a279c417f3c293c3ac8dbaa" kindref="member">pk</ref>))<sp/>{</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1a5bd267ac4dec5fd0394bb1d61b918a22" kindref="member">parity_acc</ref><sp/>^=<sp/>1;</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_negate(&amp;cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1aed924c8b7cb5c081a66d7ce1059f040e" kindref="member">tweak</ref>,<sp/>&amp;cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1aed924c8b7cb5c081a66d7ce1059f040e" kindref="member">tweak</ref>);</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_add(&amp;cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1aed924c8b7cb5c081a66d7ce1059f040e" kindref="member">tweak</ref>,<sp/>&amp;cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1aed924c8b7cb5c081a66d7ce1059f040e" kindref="member">tweak</ref>,<sp/>&amp;tweak);</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_eckey_pubkey_tweak_add(&amp;cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1ab83e13ae5a279c417f3c293c3ac8dbaa" kindref="member">pk</ref>,<sp/>&amp;tweak))<sp/>{</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>eckey_pubkey_tweak_add<sp/>fails<sp/>if<sp/>cache_i.pk<sp/>is<sp/>infinity<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(!secp256k1_ge_is_infinity(&amp;cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1ab83e13ae5a279c417f3c293c3ac8dbaa" kindref="member">pk</ref>));</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_keyagg_cache_save(keyagg_cache,<sp/>&amp;cache_i);</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(output_pubkey<sp/>!=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_pubkey_save(output_pubkey,<sp/>&amp;cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1ab83e13ae5a279c417f3c293c3ac8dbaa" kindref="member">pk</ref>);</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="281"><highlight class="normal">}</highlight></codeline>
<codeline lineno="282"><highlight class="normal"></highlight></codeline>
<codeline lineno="283" refid="secp256k1__musig_8h_1a01eeb0d31dee13d208245a478b777d9c" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="keyagg__impl_8h_1ad7db32a46ad915892398ca46fdbe3f55" kindref="member">secp256k1_musig_pubkey_ec_tweak_add</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref><sp/>*output_pubkey,<sp/><ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref><sp/>*keyagg_cache,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*tweak32)<sp/>{</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>secp256k1_musig_pubkey_tweak_add_internal(ctx,<sp/>output_pubkey,<sp/>keyagg_cache,<sp/>tweak32,<sp/>0);</highlight></codeline>
<codeline lineno="285"><highlight class="normal">}</highlight></codeline>
<codeline lineno="286"><highlight class="normal"></highlight></codeline>
<codeline lineno="287" refid="secp256k1__musig_8h_1a10a46b293f9744518c660bcbc8775db1" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="keyagg__impl_8h_1ab93abf3ae42ca6630555c1025b64b819" kindref="member">secp256k1_musig_pubkey_xonly_tweak_add</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref><sp/>*output_pubkey,<sp/><ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref><sp/>*keyagg_cache,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*tweak32)<sp/>{</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>secp256k1_musig_pubkey_tweak_add_internal(ctx,<sp/>output_pubkey,<sp/>keyagg_cache,<sp/>tweak32,<sp/>1);</highlight></codeline>
<codeline lineno="289"><highlight class="normal">}</highlight></codeline>
<codeline lineno="290"><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
    </programlisting>
    <location file="src/secp256k1/src/modules/musig/keyagg_impl.h"/>
  </compounddef>
</doxygen>
