<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="test_2util_2txmempool_8cpp" kind="file" language="C++">
    <compoundname>txmempool.cpp</compoundname>
    <includes refid="test_2util_2txmempool_8h" local="no">test/util/txmempool.h</includes>
    <includes local="no">chainparams.h</includes>
    <includes refid="node_2context_8h" local="no">node/context.h</includes>
    <includes refid="mempool__args_8h" local="no">node/mempool_args.h</includes>
    <includes refid="policy_2rbf_8h" local="no">policy/rbf.h</includes>
    <includes refid="truc__policy_8h" local="no">policy/truc_policy.h</includes>
    <includes refid="transaction__utils_8h" local="no">test/util/transaction_utils.h</includes>
    <includes refid="check_8h" local="no">util/check.h</includes>
    <includes local="no">util/time.h</includes>
    <includes refid="translation_8h" local="no">util/translation.h</includes>
    <includes refid="test_2util_2validation_8h" local="no">validation.h</includes>
    <incdepgraph>
      <node id="93">
        <label>addresstype.h</label>
        <link refid="addresstype_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="10">
        <label>attributes.h</label>
        <link refid="attributes_8h"/>
      </node>
      <node id="47">
        <label>compat/assumptions.h</label>
        <link refid="compat_2assumptions_8h"/>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
      </node>
      <node id="16">
        <label>compat/byteswap.h</label>
        <link refid="byteswap_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="15">
        <label>compat/endian.h</label>
        <link refid="endian_8h"/>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="11">
        <label>consensus/amount.h</label>
        <link refid="amount_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>consensus/consensus.h</label>
        <link refid="consensus_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="7">
        <label>consensus/validation.h</label>
        <link refid="consensus_2validation_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="55" relation="include">
        </childnode>
      </node>
      <node id="14">
        <label>crypto/common.h</label>
        <link refid="crypto_2common_8h"/>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
      </node>
      <node id="27">
        <label>crypto/hex_base.h</label>
        <link refid="hex__base_8h"/>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="89">
        <label>crypto/ripemd160.h</label>
        <link refid="ripemd160_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="90">
        <label>crypto/sha256.h</label>
        <link refid="sha256_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="68">
        <label>crypto/siphash.h</label>
        <link refid="siphash_8h"/>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="88">
        <label>hash.h</label>
        <link refid="hash_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="89" relation="include">
        </childnode>
        <childnode refid="90" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="94">
        <label>key.h</label>
        <link refid="key_8h"/>
        <childnode refid="95" relation="include">
        </childnode>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="96" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="95">
        <label>musig.h</label>
        <link refid="musig_8h"/>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="71">
        <label>node/context.h</label>
        <link refid="node_2context_8h"/>
        <childnode refid="65" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="72" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="73" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="74">
        <label>node/mempool_args.h</label>
        <link refid="mempool__args_8h"/>
        <childnode refid="75" relation="include">
        </childnode>
      </node>
      <node id="3">
        <label>policy/packages.h</label>
        <link refid="packages_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="67" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="69" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="57">
        <label>policy/policy.h</label>
        <link refid="policy_8h"/>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="79">
        <label>policy/rbf.h</label>
        <link refid="policy_2rbf_8h"/>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="80" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="83">
        <label>policy/truc_policy.h</label>
        <link refid="truc__policy_8h"/>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="75" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="44">
        <label>prevector.h</label>
        <link refid="prevector_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
      </node>
      <node id="55">
        <label>primitives/block.h</label>
        <link refid="primitives_2block_8h"/>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="56" relation="include">
        </childnode>
      </node>
      <node id="9">
        <label>primitives/transaction.h</label>
        <link refid="primitives_2transaction_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="54" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="12">
        <label>primitives/transaction_identifier.h</label>
        <link refid="transaction__identifier_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
      </node>
      <node id="87">
        <label>pubkey.h</label>
        <link refid="pubkey_8h"/>
        <childnode refid="88" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="58">
        <label>script/interpreter.h</label>
        <link refid="interpreter_8h"/>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="60" relation="include">
        </childnode>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="91">
        <label>script/keyorigin.h</label>
        <link refid="keyorigin_8h"/>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="43">
        <label>script/script.h</label>
        <link refid="script_2script_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="60">
        <label>script/script_error.h</label>
        <link refid="script__error_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="85">
        <label>script/sign.h</label>
        <link refid="sign_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="86" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="91" relation="include">
        </childnode>
        <childnode refid="92" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
      </node>
      <node id="92">
        <label>script/signingprovider.h</label>
        <link refid="signingprovider_8h"/>
        <childnode refid="93" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="94" relation="include">
        </childnode>
        <childnode refid="95" relation="include">
        </childnode>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="91" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="101" relation="include">
        </childnode>
        <childnode refid="72" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
      </node>
      <node id="62">
        <label>script/solver.h</label>
        <link refid="solver_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="61">
        <label>script/verify_flags.h</label>
        <link refid="verify__flags_8h"/>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="46">
        <label>serialize.h</label>
        <link refid="serialize_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="49" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="21">
        <label>span.h</label>
        <link refid="span_8h"/>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
      </node>
      <node id="96">
        <label>support/allocators/secure.h</label>
        <link refid="secure_8h"/>
        <childnode refid="97" relation="include">
        </childnode>
        <childnode refid="100" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="100">
        <label>support/cleanse.h</label>
        <link refid="cleanse_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="97">
        <label>support/lockedpool.h</label>
        <link refid="lockedpool_8h"/>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="98" relation="include">
        </childnode>
        <childnode refid="49" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="99" relation="include">
        </childnode>
      </node>
      <node id="101">
        <label>sync.h</label>
        <link refid="sync_8h"/>
        <childnode refid="80" relation="include">
        </childnode>
        <childnode refid="102" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="103" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="73" relation="include">
        </childnode>
      </node>
      <node id="84">
        <label>test/util/transaction_utils.h</label>
        <link refid="transaction__utils_8h"/>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="85" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>src/test/util/txmempool.cpp</label>
        <link refid="test_2util_2txmempool_8cpp"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="70" relation="include">
        </childnode>
        <childnode refid="71" relation="include">
        </childnode>
        <childnode refid="74" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="83" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="56" relation="include">
        </childnode>
        <childnode refid="76" relation="include">
        </childnode>
        <childnode refid="104" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>test/util/txmempool.h</label>
        <link refid="test_2util_2txmempool_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="56" relation="include">
        </childnode>
      </node>
      <node id="104">
        <label>validation.h</label>
        <link refid="test_2util_2validation_8h"/>
        <childnode refid="104" relation="include">
        </childnode>
      </node>
      <node id="80">
        <label>threadsafety.h</label>
        <link refid="threadsafety_8h"/>
        <childnode refid="81" relation="include">
        </childnode>
      </node>
      <node id="77">
        <label>tinyformat.h</label>
        <link refid="tinyformat_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="78" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="13">
        <label>uint256.h</label>
        <link refid="uint256_8h"/>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
      </node>
      <node id="64">
        <label>util/check.h</label>
        <link refid="check_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="65" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="66" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
      </node>
      <node id="63">
        <label>util/feefrac.h</label>
        <link refid="feefrac_8h"/>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="52">
        <label>util/hash_type.h</label>
        <link refid="hash__type_8h"/>
      </node>
      <node id="67">
        <label>util/hasher.h</label>
        <link refid="hasher_8h"/>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="68" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
      </node>
      <node id="102">
        <label>util/macros.h</label>
        <link refid="macros_8h"/>
      </node>
      <node id="75">
        <label>util/result.h</label>
        <link refid="result_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="76" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
      </node>
      <node id="26">
        <label>util/strencodings.h</label>
        <link refid="strencodings_8h"/>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="28">
        <label>util/string.h</label>
        <link refid="string_8h"/>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="76">
        <label>util/translation.h</label>
        <link refid="translation_8h"/>
        <childnode refid="77" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="72" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="39">
        <label>util/types.h</label>
        <link refid="util_2types_8h"/>
      </node>
      <node id="38">
        <label>algorithm</label>
      </node>
      <node id="29">
        <label>array</label>
      </node>
      <node id="65">
        <label>atomic</label>
      </node>
      <node id="17">
        <label>bit</label>
      </node>
      <node id="22">
        <label>cassert</label>
      </node>
      <node id="70">
        <label>chainparams.h</label>
      </node>
      <node id="34">
        <label>charconv</label>
      </node>
      <node id="86">
        <label>coins.h</label>
      </node>
      <node id="40">
        <label>compare</label>
      </node>
      <node id="18">
        <label>concepts</label>
      </node>
      <node id="103">
        <label>condition_variable</label>
      </node>
      <node id="19">
        <label>cstddef</label>
      </node>
      <node id="5">
        <label>cstdint</label>
      </node>
      <node id="6">
        <label>cstdlib</label>
      </node>
      <node id="20">
        <label>cstring</label>
      </node>
      <node id="72">
        <label>functional</label>
      </node>
      <node id="59">
        <label>hash.h</label>
      </node>
      <node id="48">
        <label>ios</label>
      </node>
      <node id="78">
        <label>iostream</label>
      </node>
      <node id="45">
        <label>iterator</label>
      </node>
      <node id="35">
        <label>limits</label>
      </node>
      <node id="98">
        <label>list</label>
      </node>
      <node id="30">
        <label>locale</label>
      </node>
      <node id="49">
        <label>map</label>
      </node>
      <node id="50">
        <label>memory</label>
      </node>
      <node id="81">
        <label>mutex</label>
      </node>
      <node id="54">
        <label>numeric</label>
      </node>
      <node id="36">
        <label>optional</label>
      </node>
      <node id="51">
        <label>set</label>
      </node>
      <node id="66">
        <label>source_location</label>
      </node>
      <node id="23">
        <label>span</label>
      </node>
      <node id="31">
        <label>sstream</label>
      </node>
      <node id="53">
        <label>stdexcept</label>
      </node>
      <node id="8">
        <label>string</label>
      </node>
      <node id="32">
        <label>string_view</label>
      </node>
      <node id="37">
        <label>system_error</label>
      </node>
      <node id="73">
        <label>thread</label>
      </node>
      <node id="41">
        <label>tuple</label>
      </node>
      <node id="82">
        <label>txmempool.h</label>
      </node>
      <node id="24">
        <label>type_traits</label>
      </node>
      <node id="99">
        <label>unordered_map</label>
      </node>
      <node id="69">
        <label>unordered_set</label>
      </node>
      <node id="56">
        <label>util/time.h</label>
      </node>
      <node id="25">
        <label>utility</label>
      </node>
      <node id="42">
        <label>variant</label>
      </node>
      <node id="33">
        <label>vector</label>
      </node>
    </incdepgraph>
    <sectiondef kind="func">
      <memberdef kind="function" id="test_2util_2txmempool_8cpp_1a72ec6430ddda7dc377edf13944e25df4" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="class_c_tx_mem_pool_1a181c4ec7f3c173e8ab60665e6cc5f400" kindref="member">CTxMemPool::Options</ref></type>
        <definition>CTxMemPool::Options MemPoolOptionsForTest</definition>
        <argsstring>(const NodeContext &amp;node)</argsstring>
        <name>MemPoolOptionsForTest</name>
        <param>
          <type>const <ref refid="struct_node_context" kindref="compound">NodeContext</ref> &amp;</type>
          <declname>node</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/test/util/txmempool.cpp" line="21" column="21" bodyfile="src/test/util/txmempool.cpp" bodystart="21" bodyend="32"/>
      </memberdef>
      <memberdef kind="function" id="test_2util_2txmempool_8cpp_1aa9b0781f7a2b0c0e0c4eb906dd951d43" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>std::optional&lt; std::string &gt;</type>
        <definition>std::optional&lt; std::string &gt; CheckPackageMempoolAcceptResult</definition>
        <argsstring>(const Package &amp;txns, const PackageMempoolAcceptResult &amp;result, bool expect_valid, const CTxMemPool *mempool)</argsstring>
        <name>CheckPackageMempoolAcceptResult</name>
        <param>
          <type>const <ref refid="packages_8h_1a138b5dbe56c4869308e2bc7a28b51d9c" kindref="member">Package</ref> &amp;</type>
          <declname>txns</declname>
        </param>
        <param>
          <type>const <ref refid="struct_package_mempool_accept_result" kindref="compound">PackageMempoolAcceptResult</ref> &amp;</type>
          <declname>result</declname>
        </param>
        <param>
          <type>bool</type>
          <declname>expect_valid</declname>
        </param>
        <param>
          <type>const <ref refid="class_c_tx_mem_pool" kindref="compound">CTxMemPool</ref> *</type>
          <declname>mempool</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check expected properties for every <ref refid="struct_package_mempool_accept_result" kindref="compound">PackageMempoolAcceptResult</ref>, regardless of value. Returns a string if an error occurs with error populated, nullopt otherwise. If mempool is provided, checks that the expected transactions are in mempool (this should be set to nullptr for a test_accept). </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/test/util/txmempool.cpp" line="44" column="15" bodyfile="src/test/util/txmempool.cpp" bodystart="44" bodyend="143"/>
      </memberdef>
      <memberdef kind="function" id="test_2util_2txmempool_8cpp_1ab388327157d3652cc6706dd8182dce69" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void CheckMempoolEphemeralInvariants</definition>
        <argsstring>(const CTxMemPool &amp;tx_pool)</argsstring>
        <name>CheckMempoolEphemeralInvariants</name>
        <param>
          <type>const <ref refid="class_c_tx_mem_pool" kindref="compound">CTxMemPool</ref> &amp;</type>
          <declname>tx_pool</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check that we never get into a state where an ephemeral dust transaction would be mined without the spend of the dust also being mined. This assumes standardness checks are being enforced. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/test/util/txmempool.cpp" line="145" column="6" bodyfile="src/test/util/txmempool.cpp" bodystart="145" bodyend="180"/>
      </memberdef>
      <memberdef kind="function" id="test_2util_2txmempool_8cpp_1a510d61afe1c2654572e80df2239f816f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void CheckMempoolTRUCInvariants</definition>
        <argsstring>(const CTxMemPool &amp;tx_pool)</argsstring>
        <name>CheckMempoolTRUCInvariants</name>
        <param>
          <type>const <ref refid="class_c_tx_mem_pool" kindref="compound">CTxMemPool</ref> &amp;</type>
          <declname>tx_pool</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>For every transaction in tx_pool, check TRUC invariants:<itemizedlist>
<listitem><para>a TRUC tx&apos;s ancestor count must be within TRUC_ANCESTOR_LIMIT</para>
</listitem><listitem><para>a TRUC tx&apos;s descendant count must be within TRUC_DESCENDANT_LIMIT</para>
</listitem><listitem><para>if a TRUC tx has ancestors, its sigop-adjusted vsize must be within TRUC_CHILD_MAX_VSIZE</para>
</listitem><listitem><para>any non-TRUC tx must only have non-TRUC parents</para>
</listitem><listitem><para>any TRUC tx must only have TRUC parents </para>
</listitem></itemizedlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/test/util/txmempool.cpp" line="182" column="6" bodyfile="src/test/util/txmempool.cpp" bodystart="182" bodyend="213"/>
      </memberdef>
      <memberdef kind="function" id="test_2util_2txmempool_8cpp_1ab3a262a83fb943d95fd8670b26f8ccbc" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void TryAddToMempool</definition>
        <argsstring>(CTxMemPool &amp;tx_pool, const CTxMemPoolEntry &amp;entry)</argsstring>
        <name>TryAddToMempool</name>
        <param>
          <type><ref refid="class_c_tx_mem_pool" kindref="compound">CTxMemPool</ref> &amp;</type>
          <declname>tx_pool</declname>
        </param>
        <param>
          <type>const <ref refid="class_c_tx_mem_pool_entry" kindref="compound">CTxMemPoolEntry</ref> &amp;</type>
          <declname>entry</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>One-line wrapper for creating a mempool changeset with a single transaction and applying it if the policy limits are respected. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/test/util/txmempool.cpp" line="215" column="6" bodyfile="src/test/util/txmempool.cpp" bodystart="215" bodyend="223"/>
      </memberdef>
      <memberdef kind="function" id="test_2util_2txmempool_8cpp_1ae86b44318ee26ef570fc822bb2972197" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void MockMempoolMinFee</definition>
        <argsstring>(const CFeeRate &amp;target_feerate, CTxMemPool &amp;mempool)</argsstring>
        <name>MockMempoolMinFee</name>
        <param>
          <type>const <ref refid="class_c_fee_rate" kindref="compound">CFeeRate</ref> &amp;</type>
          <declname>target_feerate</declname>
        </param>
        <param>
          <type><ref refid="class_c_tx_mem_pool" kindref="compound">CTxMemPool</ref> &amp;</type>
          <declname>mempool</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Mock the mempool minimum feerate by adding a transaction and calling TrimToSize(0), simulating the mempool &quot;reaching capacity&quot; and evicting by descendant feerate. Note that this clears the mempool, and the new minimum feerate will depend on the maximum feerate of transactions removed, so this must be called while the mempool is empty.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>target_feerate</parametername>
</parameternamelist>
<parameterdescription>
<para>The new mempool minimum feerate after this function returns. Must be above max(incremental feerate, min relay feerate), or 1sat/vB with default settings. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>mempool</parametername>
</parameternamelist>
<parameterdescription>
<para>The mempool to mock the minimum feerate for. Must be empty when called. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/test/util/txmempool.cpp" line="225" column="6" bodyfile="src/test/util/txmempool.cpp" bodystart="225" bodyend="258"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2022-present<sp/>The<sp/>Bitcoin<sp/>Core<sp/>developers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Distributed<sp/>under<sp/>the<sp/>MIT<sp/>software<sp/>license,<sp/>see<sp/>the<sp/>accompanying</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">//<sp/>file<sp/>COPYING<sp/>or<sp/>http://www.opensource.org/licenses/mit-license.php.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="test_2util_2txmempool_8h" kindref="compound">test/util/txmempool.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;chainparams.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="node_2context_8h" kindref="compound">node/context.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="mempool__args_8h" kindref="compound">node/mempool_args.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="policy_2rbf_8h" kindref="compound">policy/rbf.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="truc__policy_8h" kindref="compound">policy/truc_policy.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="test_2util_2txmempool_8h" kindref="compound">txmempool.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="transaction__utils_8h" kindref="compound">test/util/transaction_utils.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="check_8h" kindref="compound">util/check.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;util/time.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="translation_8h" kindref="compound">util/translation.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="test_2util_2validation_8h" kindref="compound">validation.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="keyword">using<sp/></highlight><highlight class="normal"><ref refid="structnode_1_1_node_context" kindref="compound">node::NodeContext</ref>;</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"><ref refid="class_c_tx_mem_pool_1a181c4ec7f3c173e8ab60665e6cc5f400" kindref="member">CTxMemPool::Options</ref><sp/><ref refid="test_2util_2txmempool_8cpp_1a72ec6430ddda7dc377edf13944e25df4" kindref="member">MemPoolOptionsForTest</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structnode_1_1_node_context" kindref="compound">NodeContext</ref>&amp;<sp/><ref refid="namespacenode" kindref="compound">node</ref>)</highlight></codeline>
<codeline lineno="22"><highlight class="normal">{</highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_tx_mem_pool_1a181c4ec7f3c173e8ab60665e6cc5f400" kindref="member">CTxMemPool::Options</ref><sp/>mempool_opts{</highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Default<sp/>to<sp/>always<sp/>checking<sp/>mempool<sp/>regardless<sp/>of</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>chainparams.DefaultConsistencyChecks<sp/>for<sp/>tests</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.check_ratio<sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.signals<sp/>=<sp/><ref refid="namespacenode" kindref="compound">node</ref>.validation_signals.get(),</highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>result{<ref refid="mempool__args_8cpp_1a41b9ed68ace5badcb96a77637b853875" kindref="member">ApplyArgsManOptions</ref>(*<ref refid="namespacenode" kindref="compound">node</ref>.args,<sp/><ref refid="chainparams_8cpp_1ad82533eea3b187c1ac5b7c54d8c6f121" kindref="member">::Params</ref>(),<sp/>mempool_opts)};</highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(result);</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>mempool_opts;</highlight></codeline>
<codeline lineno="32"><highlight class="normal">}</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"><ref refid="class_c_tx_mem_pool_entry" kindref="compound">CTxMemPoolEntry</ref><sp/><ref refid="struct_test_mem_pool_entry_helper_1a74d5e8d83bf423abea2e29eb92ac084e" kindref="member">TestMemPoolEntryHelper::FromTx</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_c_mutable_transaction" kindref="compound">CMutableTransaction</ref>&amp;<sp/>tx)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="35"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="struct_test_mem_pool_entry_helper_1a74d5e8d83bf423abea2e29eb92ac084e" kindref="member">FromTx</ref>(MakeTransactionRef(tx));</highlight></codeline>
<codeline lineno="37"><highlight class="normal">}</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"><ref refid="class_c_tx_mem_pool_entry" kindref="compound">CTxMemPoolEntry</ref><sp/><ref refid="struct_test_mem_pool_entry_helper_1a74d5e8d83bf423abea2e29eb92ac084e" kindref="member">TestMemPoolEntryHelper::FromTx</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="primitives_2transaction_8h_1ae462b4b8f07705a82bf11cf361959b97" kindref="member">CTransactionRef</ref>&amp;<sp/>tx)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="40"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>CTxMemPoolEntry{<ref refid="class_tx_graph_1a70689acebecf08e10e16c0d697d08731" kindref="member">TxGraph::Ref</ref>(),<sp/>tx,<sp/><ref refid="struct_test_mem_pool_entry_helper_1acc573e4fe4f2f79bbdb8f10891be5d8d" kindref="member">nFee</ref>,<sp/><ref refid="util_2time_8h_1a4cece1006bbcfc11487e9e8bcd837d14" kindref="member">TicksSinceEpoch&lt;std::chrono::seconds&gt;</ref>(<ref refid="struct_test_mem_pool_entry_helper_1a712adb8b659d91ce1cbdca81e1cd471f" kindref="member">time</ref>),<sp/><ref refid="struct_test_mem_pool_entry_helper_1a2e4c6b811457a16b7033af6741cfb1db" kindref="member">nHeight</ref>,<sp/><ref refid="struct_test_mem_pool_entry_helper_1adb751d9f5df34db91d93c69e65c3b835" kindref="member">m_sequence</ref>,<sp/><ref refid="struct_test_mem_pool_entry_helper_1ac093f168938dc22edc1aea7d351a54ee" kindref="member">spendsCoinbase</ref>,<sp/><ref refid="struct_test_mem_pool_entry_helper_1ac71a38054066079e0d8d6bdba2414b99" kindref="member">sigOpCost</ref>,<sp/><ref refid="struct_test_mem_pool_entry_helper_1ad9fc5be56aa884a443262a52de4ed5f6" kindref="member">lp</ref>};</highlight></codeline>
<codeline lineno="42"><highlight class="normal">}</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal">std::optional&lt;std::string&gt;<sp/><ref refid="test_2util_2txmempool_8cpp_1aa9b0781f7a2b0c0e0c4eb906dd951d43" kindref="member">CheckPackageMempoolAcceptResult</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="packages_8h_1a138b5dbe56c4869308e2bc7a28b51d9c" kindref="member">Package</ref>&amp;<sp/>txns,</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_package_mempool_accept_result" kindref="compound">PackageMempoolAcceptResult</ref>&amp;<sp/>result,</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>expect_valid,</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_tx_mem_pool" kindref="compound">CTxMemPool</ref>*<sp/>mempool)</highlight></codeline>
<codeline lineno="48"><highlight class="normal">{</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(expect_valid)<sp/>{</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(result.<ref refid="struct_package_mempool_accept_result_1a14b1b7ea32b2b5c3b49c35b147fab3cb" kindref="member">m_state</ref>.<ref refid="class_validation_state_1a6c1f27c9de7ff98356fa712e4b796a1a" kindref="member">IsInvalid</ref>())<sp/>{</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;Package<sp/>validation<sp/>unexpectedly<sp/>failed:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>result.<ref refid="struct_package_mempool_accept_result_1a14b1b7ea32b2b5c3b49c35b147fab3cb" kindref="member">m_state</ref>.<ref refid="class_validation_state_1a19c380b03cea21d7ac7325136a131ff0" kindref="member">ToString</ref>());</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(result.<ref refid="struct_package_mempool_accept_result_1a14b1b7ea32b2b5c3b49c35b147fab3cb" kindref="member">m_state</ref>.<ref refid="class_validation_state_1ac532c4b500b1a85ea22217f2c65a70ed" kindref="member">IsValid</ref>())<sp/>{</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;Package<sp/>validation<sp/>unexpectedly<sp/>succeeded.<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>result.<ref refid="struct_package_mempool_accept_result_1a14b1b7ea32b2b5c3b49c35b147fab3cb" kindref="member">m_state</ref>.<ref refid="class_validation_state_1a19c380b03cea21d7ac7325136a131ff0" kindref="member">ToString</ref>());</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(result.<ref refid="struct_package_mempool_accept_result_1a14b1b7ea32b2b5c3b49c35b147fab3cb" kindref="member">m_state</ref>.<ref refid="class_validation_state_1a1b98c7dab961aab90e13b3f3f9fcf52d" kindref="member">GetResult</ref>()<sp/>!=<sp/><ref refid="packages_8h_1ae4232e3b34bac2d3729f3b4a7b274284a87a19a0e7858be85913a6cff1b1eab4e" kindref="member">PackageValidationResult::PCKG_POLICY</ref><sp/>&amp;&amp;<sp/>txns.size()<sp/>!=<sp/>result.<ref refid="struct_package_mempool_accept_result_1a048e81b8b8e77d642e29e840c5b7488d" kindref="member">m_tx_results</ref>.size())<sp/>{</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;txns<sp/>size<sp/>%u<sp/>does<sp/>not<sp/>match<sp/>tx<sp/>results<sp/>size<sp/>%u&quot;</highlight><highlight class="normal">,<sp/>txns.size(),<sp/>result.<ref refid="struct_package_mempool_accept_result_1a048e81b8b8e77d642e29e840c5b7488d" kindref="member">m_tx_results</ref>.size());</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>tx<sp/>:<sp/>txns)<sp/>{</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>wtxid<sp/>=<sp/>tx-&gt;GetWitnessHash();</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!result.<ref refid="struct_package_mempool_accept_result_1a048e81b8b8e77d642e29e840c5b7488d" kindref="member">m_tx_results</ref>.contains(wtxid))<sp/>{</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;result<sp/>not<sp/>found<sp/>for<sp/>tx<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>wtxid.ToString());</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>atmp_result<sp/>=<sp/>result.<ref refid="struct_package_mempool_accept_result_1a048e81b8b8e77d642e29e840c5b7488d" kindref="member">m_tx_results</ref>.at(wtxid);</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>valid{atmp_result.m_result_type<sp/>==<sp/><ref refid="struct_mempool_accept_result_1aa71b5fc2a82d29a91db3a734ff892a49ac9f1a6384b1c466d4612f513bd8e13ea" kindref="member">MempoolAcceptResult::ResultType::VALID</ref>};</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(expect_valid<sp/>&amp;&amp;<sp/>atmp_result.m_state.IsInvalid())<sp/>{</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;tx<sp/>%s<sp/>unexpectedly<sp/>failed:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>wtxid.ToString(),<sp/>atmp_result.m_state.ToString());</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Each<sp/>subpackage<sp/>is<sp/>allowed<sp/>MAX_REPLACEMENT_CANDIDATES<sp/>replacements<sp/>(only<sp/>checking<sp/>individually<sp/>here)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(atmp_result.m_replaced_transactions.size()<sp/>&gt;<sp/>MAX_REPLACEMENT_CANDIDATES)<sp/>{</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;tx<sp/>%s<sp/>result<sp/>replaced<sp/>too<sp/>many<sp/>transactions&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wtxid.ToString());</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Replacements<sp/>can&apos;t<sp/>happen<sp/>for<sp/>subpackages<sp/>larger<sp/>than<sp/>2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!atmp_result.m_replaced_transactions.empty()<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atmp_result.m_wtxids_fee_calculations.has_value()<sp/>&amp;&amp;<sp/>atmp_result.m_wtxids_fee_calculations.value().size()<sp/>&gt;<sp/>2)<sp/>{</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;tx<sp/>%s<sp/>was<sp/>part<sp/>of<sp/>a<sp/>too-large<sp/>package<sp/>RBF<sp/>subpackage&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wtxid.ToString());</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="85"><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!atmp_result.m_replaced_transactions.empty()<sp/>&amp;&amp;<sp/>mempool)<sp/>{</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(mempool-&gt;<ref refid="class_c_tx_mem_pool_1ab322659c2acf98d3bb6e877e69414281" kindref="member">cs</ref>);</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>replacements<sp/>occurred<sp/>and<sp/>it<sp/>used<sp/>2<sp/>transactions,<sp/>this<sp/>is<sp/>a<sp/>package<sp/>RBF<sp/>and<sp/>should<sp/>result<sp/>in<sp/>a<sp/>cluster<sp/>of<sp/>size<sp/>2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(atmp_result.m_wtxids_fee_calculations.has_value()<sp/>&amp;&amp;<sp/>atmp_result.m_wtxids_fee_calculations.value().size()<sp/>==<sp/>2)<sp/>{</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>cluster<sp/>=<sp/>mempool-&gt;<ref refid="class_c_tx_mem_pool_1a998e1b90efb070bf2dc18e6ead3f1de7" kindref="member">GatherClusters</ref>({tx-&gt;<ref refid="struct_c_mutable_transaction_1aa7fc4cd2fa1b4d99b7e2133524316918" kindref="member">GetHash</ref>()});</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(cluster.size()<sp/>!=<sp/>2)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;tx<sp/>%s<sp/>has<sp/>too<sp/>many<sp/>ancestors<sp/>or<sp/>descendants<sp/>for<sp/>a<sp/>package<sp/>rbf&quot;</highlight><highlight class="normal">,<sp/>wtxid.ToString());</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="94"><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>m_vsize<sp/>and<sp/>m_base_fees<sp/>should<sp/>exist<sp/>iff<sp/>the<sp/>result<sp/>was<sp/>VALID<sp/>or<sp/>MEMPOOL_ENTRY</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>mempool_entry{atmp_result.m_result_type<sp/>==<sp/><ref refid="struct_mempool_accept_result_1aa71b5fc2a82d29a91db3a734ff892a49a7293a7b88fa11eadb03e7f9e3111d0b8" kindref="member">MempoolAcceptResult::ResultType::MEMPOOL_ENTRY</ref>};</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(atmp_result.m_base_fees.has_value()<sp/>!=<sp/>(valid<sp/>||<sp/>mempool_entry))<sp/>{</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;tx<sp/>%s<sp/>result<sp/>should<sp/>%shave<sp/>m_base_fees&quot;</highlight><highlight class="normal">,<sp/>wtxid.ToString(),<sp/>valid<sp/>||<sp/>mempool_entry<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;not<sp/>&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(atmp_result.m_vsize.has_value()<sp/>!=<sp/>(valid<sp/>||<sp/>mempool_entry))<sp/>{</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;tx<sp/>%s<sp/>result<sp/>should<sp/>%shave<sp/>m_vsize&quot;</highlight><highlight class="normal">,<sp/>wtxid.ToString(),<sp/>valid<sp/>||<sp/>mempool_entry<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;not<sp/>&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="103"><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>m_other_wtxid<sp/>should<sp/>exist<sp/>iff<sp/>the<sp/>result<sp/>was<sp/>DIFFERENT_WITNESS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>diff_witness{atmp_result.m_result_type<sp/>==<sp/><ref refid="struct_mempool_accept_result_1aa71b5fc2a82d29a91db3a734ff892a49a2d29ec62347aac067b052563d894edc1" kindref="member">MempoolAcceptResult::ResultType::DIFFERENT_WITNESS</ref>};</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(atmp_result.m_other_wtxid.has_value()<sp/>!=<sp/>diff_witness)<sp/>{</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;tx<sp/>%s<sp/>result<sp/>should<sp/>%shave<sp/>m_other_wtxid&quot;</highlight><highlight class="normal">,<sp/>wtxid.ToString(),<sp/>diff_witness<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;not<sp/>&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="109"><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>m_effective_feerate<sp/>and<sp/>m_wtxids_fee_calculations<sp/>should<sp/>exist<sp/>iff<sp/>the<sp/>result<sp/>was<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>or<sp/>if<sp/>the<sp/>failure<sp/>was<sp/>TX_RECONSIDERABLE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>valid_or_reconsiderable{atmp_result.m_result_type<sp/>==<sp/><ref refid="struct_mempool_accept_result_1aa71b5fc2a82d29a91db3a734ff892a49ac9f1a6384b1c466d4612f513bd8e13ea" kindref="member">MempoolAcceptResult::ResultType::VALID</ref><sp/>||</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>atmp_result.m_state.GetResult()<sp/>==<sp/><ref refid="consensus_2validation_8h_1af79c18cdf56a2455d281427abb70f89fada14c3503154c47fa98ac835983a5581" kindref="member">TxValidationResult::TX_RECONSIDERABLE</ref>};</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(atmp_result.m_effective_feerate.has_value()<sp/>!=<sp/>valid_or_reconsiderable)<sp/>{</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;tx<sp/>%s<sp/>result<sp/>should<sp/>%shave<sp/>m_effective_feerate&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wtxid.ToString(),<sp/>valid<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;not<sp/>&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(atmp_result.m_wtxids_fee_calculations.has_value()<sp/>!=<sp/>valid_or_reconsiderable)<sp/>{</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;tx<sp/>%s<sp/>result<sp/>should<sp/>%shave<sp/>m_effective_feerate&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wtxid.ToString(),<sp/>valid<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;not<sp/>&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mempool)<sp/>{</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>tx<sp/>by<sp/>txid<sp/>should<sp/>be<sp/>in<sp/>the<sp/>mempool<sp/>iff<sp/>the<sp/>result<sp/>was<sp/>not<sp/>INVALID.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>txid_in_mempool{atmp_result.m_result_type<sp/>!=<sp/><ref refid="struct_mempool_accept_result_1aa71b5fc2a82d29a91db3a734ff892a49accc0377a8afbf50e7094f5c23a8af223" kindref="member">MempoolAcceptResult::ResultType::INVALID</ref>};</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mempool-&gt;<ref refid="class_c_tx_mem_pool_1a4f1dcdad840ef946c9925b0f4a0f95b9" kindref="member">exists</ref>(tx-&gt;<ref refid="struct_c_mutable_transaction_1aa7fc4cd2fa1b4d99b7e2133524316918" kindref="member">GetHash</ref>())<sp/>!=<sp/>txid_in_mempool)<sp/>{</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;tx<sp/>%s<sp/>should<sp/>%sbe<sp/>in<sp/>mempool&quot;</highlight><highlight class="normal">,<sp/>wtxid.ToString(),<sp/>txid_in_mempool<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;not<sp/>&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Additionally,<sp/>if<sp/>the<sp/>result<sp/>was<sp/>DIFFERENT_WITNESS,<sp/>we<sp/>shouldn&apos;t<sp/>be<sp/>able<sp/>to<sp/>find<sp/>the<sp/>tx<sp/>in<sp/>mempool<sp/>by<sp/>wtxid.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tx-&gt;<ref refid="struct_c_mutable_transaction_1a084eb52f31fb8d373a622fcc0c66b206" kindref="member">HasWitness</ref>()<sp/>&amp;&amp;<sp/>atmp_result.m_result_type<sp/>==<sp/><ref refid="struct_mempool_accept_result_1aa71b5fc2a82d29a91db3a734ff892a49a2d29ec62347aac067b052563d894edc1" kindref="member">MempoolAcceptResult::ResultType::DIFFERENT_WITNESS</ref>)<sp/>{</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mempool-&gt;<ref refid="class_c_tx_mem_pool_1a4f1dcdad840ef946c9925b0f4a0f95b9" kindref="member">exists</ref>(wtxid))<sp/>{</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;wtxid<sp/>%s<sp/>should<sp/>not<sp/>be<sp/>in<sp/>mempool&quot;</highlight><highlight class="normal">,<sp/>wtxid.ToString());</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>tx_ref<sp/>:<sp/>atmp_result.m_replaced_transactions)<sp/>{</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mempool-&gt;<ref refid="class_c_tx_mem_pool_1a4f1dcdad840ef946c9925b0f4a0f95b9" kindref="member">exists</ref>(tx_ref-&gt;GetHash()))<sp/>{</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tinyformat_8h_1a56c674871a61baaad36ad52238c08857" kindref="member">strprintf</ref>(</highlight><highlight class="stringliteral">&quot;tx<sp/>%s<sp/>should<sp/>not<sp/>be<sp/>in<sp/>mempool<sp/>as<sp/>it<sp/>was<sp/>replaced&quot;</highlight><highlight class="normal">,<sp/>tx_ref-&gt;GetWitnessHash().ToString());</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="143"><highlight class="normal">}</highlight></codeline>
<codeline lineno="144"><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="test_2util_2txmempool_8cpp_1ab388327157d3652cc6706dd8182dce69" kindref="member">CheckMempoolEphemeralInvariants</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_tx_mem_pool" kindref="compound">CTxMemPool</ref>&amp;<sp/>tx_pool)</highlight></codeline>
<codeline lineno="146"><highlight class="normal">{</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(tx_pool.<ref refid="class_c_tx_mem_pool_1ab322659c2acf98d3bb6e877e69414281" kindref="member">cs</ref>);</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>tx_info<sp/>:<sp/>tx_pool.<ref refid="class_c_tx_mem_pool_1a86d9bb8441b9a708ae3fe2b5d468580f" kindref="member">infoAll</ref>())<sp/>{</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>entry<sp/>=<sp/>*<ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(tx_pool.<ref refid="class_c_tx_mem_pool_1af88c474ce801f62208a5b1f320ba138c" kindref="member">GetEntry</ref>(tx_info.tx-&gt;GetHash()));</highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;uint32_t&gt;<sp/>dust_indexes<sp/>=<sp/><ref refid="policy_8cpp_1ab2f63d37a5bd44b01b655c2ed855cb68" kindref="member">GetDust</ref>(*tx_info.tx,<sp/>tx_pool.<ref refid="class_c_tx_mem_pool_1a817fbbfe836e70934594dea772b4181b" kindref="member">m_opts</ref>.<ref refid="structkernel_1_1_mem_pool_options_1a74d2824c9989899d478845774c046ed6" kindref="member">dust_relay_feerate</ref>);</highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(dust_indexes.size()<sp/>&lt;<sp/>2);</highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dust_indexes.empty())<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="156"><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Transaction<sp/>must<sp/>have<sp/>no<sp/>base<sp/>fee</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(entry.GetFee()<sp/>==<sp/>0<sp/>&amp;&amp;<sp/>entry.GetModifiedFee()<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Transaction<sp/>has<sp/>single<sp/>dust;<sp/>make<sp/>sure<sp/>it&apos;s<sp/>swept<sp/>or<sp/>will<sp/>not<sp/>be<sp/>mined</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>children<sp/>=<sp/>tx_pool.<ref refid="class_c_tx_mem_pool_1a94c9da361a72657bca743105806faf21" kindref="member">GetChildren</ref>(entry);</highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Multiple<sp/>children<sp/>should<sp/>never<sp/>happen<sp/>as<sp/>non-dust-spending<sp/>child</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>can<sp/>get<sp/>mined<sp/>as<sp/>package</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(children.size()<sp/>&lt;<sp/>2);</highlight></codeline>
<codeline lineno="166"><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(children.empty())<sp/>{</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>No<sp/>children<sp/>and<sp/>no<sp/>fees;<sp/>modified<sp/>fees<sp/>aside<sp/>won&apos;t<sp/>get<sp/>mined<sp/>so<sp/>it&apos;s<sp/>fine</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Happens<sp/>naturally<sp/>if<sp/>child<sp/>spend<sp/>is<sp/>RBF<sp/>cycled<sp/>away.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="172"><highlight class="normal"></highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Only-child<sp/>should<sp/>be<sp/>spending<sp/>the<sp/>dust</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>only_child<sp/>=<sp/>children.begin()-&gt;get().GetTx();</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_out_point" kindref="compound">COutPoint</ref><sp/>dust_outpoint{tx_info.tx-&gt;GetHash(),<sp/>dust_indexes[0]};</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(std::any_of(only_child.vin.begin(),<sp/>only_child.vin.end(),<sp/>[&amp;dust_outpoint](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_tx_in" kindref="compound">CTxIn</ref>&amp;<sp/>txin)<sp/>{</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>txin.prevout<sp/>==<sp/>dust_outpoint;</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}));</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="180"><highlight class="normal">}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="test_2util_2txmempool_8cpp_1a510d61afe1c2654572e80df2239f816f" kindref="member">CheckMempoolTRUCInvariants</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_tx_mem_pool" kindref="compound">CTxMemPool</ref>&amp;<sp/>tx_pool)</highlight></codeline>
<codeline lineno="183"><highlight class="normal">{</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(tx_pool.<ref refid="class_c_tx_mem_pool_1ab322659c2acf98d3bb6e877e69414281" kindref="member">cs</ref>);</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>tx_info<sp/>:<sp/>tx_pool.<ref refid="class_c_tx_mem_pool_1a86d9bb8441b9a708ae3fe2b5d468580f" kindref="member">infoAll</ref>())<sp/>{</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>entry<sp/>=<sp/>*<ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(tx_pool.<ref refid="class_c_tx_mem_pool_1af88c474ce801f62208a5b1f320ba138c" kindref="member">GetEntry</ref>(tx_info.tx-&gt;GetHash()));</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>[desc_count,<sp/>desc_size,<sp/>desc_fees]<sp/>=<sp/>tx_pool.<ref refid="class_c_tx_mem_pool_1a0626fdf6e4c86e76cc787058e45d1d5c" kindref="member">CalculateDescendantData</ref>(entry);</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>[anc_count,<sp/>anc_size,<sp/>anc_fees]<sp/>=<sp/>tx_pool.<ref refid="class_c_tx_mem_pool_1a8ff8b27ea1d3b6998258980f4b2f31d0" kindref="member">CalculateAncestorData</ref>(entry);</highlight></codeline>
<codeline lineno="189"><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tx_info.tx-&gt;version<sp/>==<sp/>TRUC_VERSION)<sp/>{</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>special<sp/>maximum<sp/>virtual<sp/>size<sp/>is<sp/>respected</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(entry.GetTxSize()<sp/>&lt;=<sp/>TRUC_MAX_VSIZE);</highlight></codeline>
<codeline lineno="193"><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>special<sp/>TRUC<sp/>ancestor/descendant<sp/>limits<sp/>and<sp/>rules<sp/>are<sp/>always<sp/>respected</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(desc_count<sp/>&lt;=<sp/>TRUC_DESCENDANT_LIMIT);</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(anc_count<sp/>&lt;=<sp/>TRUC_ANCESTOR_LIMIT);</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(desc_size<sp/>&lt;=<sp/>TRUC_MAX_VSIZE<sp/>+<sp/>TRUC_CHILD_MAX_VSIZE);</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(anc_size<sp/>&lt;=<sp/>TRUC_MAX_VSIZE<sp/>+<sp/>TRUC_CHILD_MAX_VSIZE);</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>this<sp/>transaction<sp/>has<sp/>at<sp/>least<sp/>1<sp/>ancestor,<sp/>it&apos;s<sp/>a<sp/>&quot;child&quot;<sp/>and<sp/>has<sp/>restricted<sp/>weight.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(anc_count<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(entry.GetTxSize()<sp/>&lt;=<sp/>TRUC_CHILD_MAX_VSIZE);</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>All<sp/>TRUC<sp/>transactions<sp/>must<sp/>only<sp/>have<sp/>TRUC<sp/>unconfirmed<sp/>parents.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>parents<sp/>=<sp/>tx_pool.<ref refid="class_c_tx_mem_pool_1ad67bc54113b9b07ec253b7e306b4ea95" kindref="member">GetParents</ref>(entry);</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(parents.begin()-&gt;get().GetSharedTx()-&gt;version<sp/>==<sp/>TRUC_VERSION);</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(anc_count<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>All<sp/>non-TRUC<sp/>transactions<sp/>must<sp/>only<sp/>have<sp/>non-TRUC<sp/>unconfirmed<sp/>parents.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>parent<sp/>:<sp/>tx_pool.<ref refid="class_c_tx_mem_pool_1ad67bc54113b9b07ec253b7e306b4ea95" kindref="member">GetParents</ref>(entry))<sp/>{</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="check_8h_1acbd5520ad7c4d365ede4ed94b421231b" kindref="member">Assert</ref>(parent.get().GetSharedTx()-&gt;version<sp/>!=<sp/>TRUC_VERSION);</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="213"><highlight class="normal">}</highlight></codeline>
<codeline lineno="214"><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="test_2util_2txmempool_8cpp_1ab3a262a83fb943d95fd8670b26f8ccbc" kindref="member">TryAddToMempool</ref>(<ref refid="class_c_tx_mem_pool" kindref="compound">CTxMemPool</ref>&amp;<sp/>tx_pool,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_tx_mem_pool_entry" kindref="compound">CTxMemPoolEntry</ref>&amp;<sp/>entry)</highlight></codeline>
<codeline lineno="216"><highlight class="normal">{</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a35644e2b75a93da0cb0f6c768f34efa8" kindref="member">LOCK2</ref>(<ref refid="cs__main_8cpp_1ab88a4b9173207cf250ece7820db1f36d" kindref="member">cs_main</ref>,<sp/>tx_pool.<ref refid="class_c_tx_mem_pool_1ab322659c2acf98d3bb6e877e69414281" kindref="member">cs</ref>);</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>changeset<sp/>=<sp/>tx_pool.<ref refid="class_c_tx_mem_pool_1a73f1a871ee46b6a104bd6489441eb87b" kindref="member">GetChangeSet</ref>();</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/>changeset-&gt;StageAddition(entry.<ref refid="class_c_tx_mem_pool_entry_1a966a8f8b8541f9b4bfba98cb35d164f6" kindref="member">GetSharedTx</ref>(),<sp/>entry.<ref refid="class_c_tx_mem_pool_entry_1acfe61a8826d77242720bf4c57a83e838" kindref="member">GetFee</ref>(),</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>entry.<ref refid="class_c_tx_mem_pool_entry_1a1fe7e633a8314b7a7072dfdbb2dcd0e9" kindref="member">GetTime</ref>().count(),<sp/>entry.<ref refid="class_c_tx_mem_pool_entry_1a0983225e32025d901ce6547170892f56" kindref="member">GetHeight</ref>(),<sp/>entry.<ref refid="class_c_tx_mem_pool_entry_1a62f2d5e579a6474d933109ed3b255643" kindref="member">GetSequence</ref>(),</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>entry.<ref refid="class_c_tx_mem_pool_entry_1a766cc60935242616f181b50c4ffa0b65" kindref="member">GetSpendsCoinbase</ref>(),<sp/>entry.<ref refid="class_c_tx_mem_pool_entry_1a0a6c1b5aa1e6db5aa38d574f0e41502f" kindref="member">GetSigOpCost</ref>(),<sp/>entry.<ref refid="class_c_tx_mem_pool_entry_1a8ad5669526f0f4bf25f95c433cc8e233" kindref="member">GetLockPoints</ref>());</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(changeset-&gt;CheckMemPoolPolicyLimits())<sp/>changeset-&gt;Apply();</highlight></codeline>
<codeline lineno="223"><highlight class="normal">}</highlight></codeline>
<codeline lineno="224"><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="test_2util_2txmempool_8cpp_1ae86b44318ee26ef570fc822bb2972197" kindref="member">MockMempoolMinFee</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_fee_rate" kindref="compound">CFeeRate</ref>&amp;<sp/>target_feerate,<sp/><ref refid="class_c_tx_mem_pool" kindref="compound">CTxMemPool</ref>&amp;<sp/>mempool)</highlight></codeline>
<codeline lineno="226"><highlight class="normal">{</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a35644e2b75a93da0cb0f6c768f34efa8" kindref="member">LOCK2</ref>(<ref refid="cs__main_8cpp_1ab88a4b9173207cf250ece7820db1f36d" kindref="member">cs_main</ref>,<sp/>mempool.<ref refid="class_c_tx_mem_pool_1ab322659c2acf98d3bb6e877e69414281" kindref="member">cs</ref>);</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Transactions<sp/>in<sp/>the<sp/>mempool<sp/>will<sp/>affect<sp/>the<sp/>new<sp/>minimum<sp/>feerate.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(mempool.<ref refid="class_c_tx_mem_pool_1af22b5286aa0191a7087a205f6d04b032" kindref="member">size</ref>()<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>target<sp/>feerate<sp/>cannot<sp/>be<sp/>too<sp/>low...</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>...otherwise<sp/>the<sp/>transaction&apos;s<sp/>feerate<sp/>will<sp/>need<sp/>to<sp/>be<sp/>negative.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(target_feerate<sp/>&gt;<sp/>mempool.<ref refid="class_c_tx_mem_pool_1a817fbbfe836e70934594dea772b4181b" kindref="member">m_opts</ref>.<ref refid="structkernel_1_1_mem_pool_options_1a5a2333ca521fc7a9717b7aeee546dbf2" kindref="member">incremental_relay_feerate</ref>);</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>...otherwise<sp/>this<sp/>is<sp/>not<sp/>meaningful.<sp/>The<sp/>feerate<sp/>policy<sp/>uses<sp/>the<sp/>maximum<sp/>of<sp/>both<sp/>feerates.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(target_feerate<sp/>&gt;<sp/>mempool.<ref refid="class_c_tx_mem_pool_1a817fbbfe836e70934594dea772b4181b" kindref="member">m_opts</ref>.<ref refid="structkernel_1_1_mem_pool_options_1ad0f673994f163981d3b563b4e80b2d53" kindref="member">min_relay_feerate</ref>);</highlight></codeline>
<codeline lineno="235"><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Manually<sp/>create<sp/>an<sp/>invalid<sp/>transaction.<sp/>Manually<sp/>set<sp/>the<sp/>fee<sp/>in<sp/>the<sp/>CTxMemPoolEntry<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>achieve<sp/>the<sp/>exact<sp/>target<sp/>feerate.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_c_mutable_transaction" kindref="compound">CMutableTransaction</ref><sp/>mtx{};</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/>mtx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>.emplace_back(<ref refid="class_c_out_point" kindref="compound">COutPoint</ref>{<ref refid="classtransaction__identifier_1a9fd0a0c9397291deca26c21528e2f281" kindref="member">Txid::FromUint256</ref>(<ref refid="classuint256" kindref="compound">uint256</ref>{123}),<sp/>0});</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/>mtx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>.emplace_back(1<sp/>*<sp/>COIN,<sp/><ref refid="addresstype_8cpp_1ae40f28d3b46c21033f6ee1f1200d0321" kindref="member">GetScriptForDestination</ref>(<ref refid="struct_witness_v0_script_hash" kindref="compound">WitnessV0ScriptHash</ref>(<ref refid="class_c_script" kindref="compound">CScript</ref>()<sp/>&lt;&lt;<sp/><ref refid="script_2script_8h_1a63e349a6089a54da9fe09a3d858648bda804f1324daff5d2d04639a57ce6b8ec3" kindref="member">OP_TRUE</ref>)));</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>a<sp/>large<sp/>size<sp/>so<sp/>that<sp/>the<sp/>fee<sp/>evaluated<sp/>at<sp/>target_feerate<sp/>(which<sp/>is<sp/>usually<sp/>in<sp/>sats/kvB)<sp/>is<sp/>an<sp/>integer.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Otherwise,<sp/>GetMinFee()<sp/>may<sp/>end<sp/>up<sp/>slightly<sp/>different<sp/>from<sp/>target_feerate.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="transaction__utils_8cpp_1a98c69e8dd0a5ca2db92433b6005bd010" kindref="member">BulkTransaction</ref>(mtx,<sp/>4000);</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>tx{MakeTransactionRef(mtx)};</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_lock_points" kindref="compound">LockPoints</ref><sp/><ref refid="mempool__ephemeral__spends_8cpp_1ad9fc5be56aa884a443262a52de4ed5f6" kindref="member">lp</ref>;</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>new<sp/>mempool<sp/>min<sp/>feerate<sp/>is<sp/>equal<sp/>to<sp/>the<sp/>removed<sp/>package&apos;s<sp/>feerate<sp/>+<sp/>incremental<sp/>feerate.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>tx_fee<sp/>=<sp/>target_feerate.<ref refid="class_c_fee_rate_1a48858bde2b68fc9bd54f5ae34b45f371" kindref="member">GetFee</ref>(<ref refid="policy_8cpp_1a7cf1495f52acbb4320a50bbb831af44a" kindref="member">GetVirtualTransactionSize</ref>(*tx))<sp/>-</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mempool.<ref refid="class_c_tx_mem_pool_1a817fbbfe836e70934594dea772b4181b" kindref="member">m_opts</ref>.<ref refid="structkernel_1_1_mem_pool_options_1a5a2333ca521fc7a9717b7aeee546dbf2" kindref="member">incremental_relay_feerate</ref>.<ref refid="class_c_fee_rate_1a48858bde2b68fc9bd54f5ae34b45f371" kindref="member">GetFee</ref>(<ref refid="policy_8cpp_1a7cf1495f52acbb4320a50bbb831af44a" kindref="member">GetVirtualTransactionSize</ref>(*tx));</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>changeset<sp/>=<sp/>mempool.<ref refid="class_c_tx_mem_pool_1a73f1a871ee46b6a104bd6489441eb87b" kindref="member">GetChangeSet</ref>();</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>changeset-&gt;StageAddition(tx,<sp/></highlight><highlight class="comment">/*fee=*/</highlight><highlight class="normal">tx_fee,</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*time=*/</highlight><highlight class="normal">0,<sp/></highlight><highlight class="comment">/*entry_height=*/</highlight><highlight class="normal">1,<sp/></highlight><highlight class="comment">/*entry_sequence=*/</highlight><highlight class="normal">0,</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*spends_coinbase=*/</highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/></highlight><highlight class="comment">/*sigops_cost=*/</highlight><highlight class="normal">1,<sp/><ref refid="mempool__ephemeral__spends_8cpp_1ad9fc5be56aa884a443262a52de4ed5f6" kindref="member">lp</ref>);</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>changeset-&gt;Apply();</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/>mempool.<ref refid="class_c_tx_mem_pool_1a8d3b2b85c1e8d71acb0670889801c1ae" kindref="member">TrimToSize</ref>(0);</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(mempool.<ref refid="class_c_tx_mem_pool_1a7afb20886dc0488c9f76578b16b4faad" kindref="member">GetMinFee</ref>()<sp/>==<sp/>target_feerate);</highlight></codeline>
<codeline lineno="258"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="src/test/util/txmempool.cpp"/>
  </compounddef>
</doxygen>
