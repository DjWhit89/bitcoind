<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="test_2_r_e_a_d_m_e_8md" kind="file" language="Markdown">
    <compoundname>README.md</compoundname>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline><highlight class="normal">#<sp/>Unit<sp/>tests</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">The<sp/>sources<sp/>in<sp/>this<sp/>directory<sp/>are<sp/>unit<sp/>test<sp/>cases.<sp/>Boost<sp/>includes<sp/>a</highlight></codeline>
<codeline><highlight class="normal">unit<sp/>testing<sp/>framework,<sp/>and<sp/>since<sp/>Bitcoin<sp/>Core<sp/>already<sp/>uses<sp/>Boost,<sp/>it<sp/>makes</highlight></codeline>
<codeline><highlight class="normal">sense<sp/>to<sp/>simply<sp/>use<sp/>this<sp/>framework<sp/>rather<sp/>than<sp/>require<sp/>developers<sp/>to</highlight></codeline>
<codeline><highlight class="normal">configure<sp/>some<sp/>other<sp/>framework<sp/>(we<sp/>want<sp/>as<sp/>few<sp/>impediments<sp/>to<sp/>creating</highlight></codeline>
<codeline><highlight class="normal">unit<sp/>tests<sp/>as<sp/>possible).</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">The<sp/>build<sp/>system<sp/>is<sp/>set<sp/>up<sp/>to<sp/>compile<sp/>an<sp/>executable<sp/>called<sp/>`test_bitcoin`</highlight></codeline>
<codeline><highlight class="normal">that<sp/>runs<sp/>all<sp/>of<sp/>the<sp/>unit<sp/>tests.<sp/>The<sp/>main<sp/>source<sp/>file<sp/>for<sp/>the<sp/>test<sp/>library<sp/>is<sp/>found<sp/>in</highlight></codeline>
<codeline><highlight class="normal">`util/setup_common.cpp`.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">The<sp/>examples<sp/>in<sp/>this<sp/>document<sp/>assume<sp/>the<sp/>build<sp/>directory<sp/>is<sp/>named</highlight></codeline>
<codeline><highlight class="normal">`build`.<sp/>You&apos;ll<sp/>need<sp/>to<sp/>adapt<sp/>them<sp/>if<sp/>you<sp/>named<sp/>it<sp/>differently.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>Compiling/running<sp/>unit<sp/>tests</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">Unit<sp/>tests<sp/>will<sp/>be<sp/>automatically<sp/>compiled<sp/>if<sp/>dependencies<sp/>were<sp/>met</highlight></codeline>
<codeline><highlight class="normal">during<sp/>the<sp/>generation<sp/>of<sp/>the<sp/>Bitcoin<sp/>Core<sp/>build<sp/>system</highlight></codeline>
<codeline><highlight class="normal">and<sp/>tests<sp/>weren&apos;t<sp/>explicitly<sp/>disabled.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">The<sp/>unit<sp/>tests<sp/>can<sp/>be<sp/>run<sp/>with<sp/>`ctest<sp/>--test-dir<sp/>build`,<sp/>which<sp/>includes<sp/>unit</highlight></codeline>
<codeline><highlight class="normal">tests<sp/>from<sp/>subtrees.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">Run<sp/>`build/bin/test_bitcoin<sp/>--list_content`<sp/>for<sp/>the<sp/>full<sp/>list<sp/>of<sp/>tests.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">To<sp/>run<sp/>the<sp/>unit<sp/>tests<sp/>manually,<sp/>launch<sp/>`build/bin/test_bitcoin`.<sp/>To<sp/>recompile</highlight></codeline>
<codeline><highlight class="normal">after<sp/>a<sp/>test<sp/>file<sp/>was<sp/>modified,<sp/>run<sp/>`cmake<sp/>--build<sp/>build`<sp/>and<sp/>then<sp/>run<sp/>the<sp/>test<sp/>again.<sp/>If<sp/>you</highlight></codeline>
<codeline><highlight class="normal">modify<sp/>a<sp/>non-test<sp/>file,<sp/>use<sp/>`cmake<sp/>--build<sp/>build<sp/>--target<sp/>test_bitcoin`<sp/>to<sp/>recompile<sp/>only<sp/>what&apos;s<sp/>needed</highlight></codeline>
<codeline><highlight class="normal">to<sp/>run<sp/>the<sp/>unit<sp/>tests.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">To<sp/>add<sp/>more<sp/>unit<sp/>tests,<sp/>add<sp/>`BOOST_AUTO_TEST_CASE`<sp/>functions<sp/>to<sp/>the<sp/>existing</highlight></codeline>
<codeline><highlight class="normal">.cpp<sp/>files<sp/>in<sp/>the<sp/>`test/`<sp/>directory<sp/>or<sp/>add<sp/>new<sp/>.cpp<sp/>files<sp/>that</highlight></codeline>
<codeline><highlight class="normal">implement<sp/>new<sp/>`BOOST_AUTO_TEST_SUITE`<sp/>sections.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">To<sp/>run<sp/>the<sp/>GUI<sp/>unit<sp/>tests<sp/>manually,<sp/>launch<sp/>`build/bin/test_bitcoin-qt`</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">To<sp/>add<sp/>more<sp/>GUI<sp/>unit<sp/>tests,<sp/>add<sp/>them<sp/>to<sp/>the<sp/>`src/qt/test/`<sp/>directory<sp/>and</highlight></codeline>
<codeline><highlight class="normal">the<sp/>`src/qt/test/test_main.cpp`<sp/>file.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>Running<sp/>individual<sp/>tests</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">The<sp/>`test_bitcoin`<sp/>runner<sp/>accepts<sp/>command<sp/>line<sp/>arguments<sp/>from<sp/>the<sp/>Boost</highlight></codeline>
<codeline><highlight class="normal">framework.<sp/>To<sp/>see<sp/>the<sp/>list<sp/>of<sp/>arguments<sp/>that<sp/>may<sp/>be<sp/>passed,<sp/>run:</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline><highlight class="normal">build/bin/test_bitcoin<sp/>--help</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">For<sp/>example,<sp/>to<sp/>run<sp/>only<sp/>the<sp/>tests<sp/>in<sp/>the<sp/>`getarg_tests`<sp/>file,<sp/>with<sp/>full<sp/>logging:</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">```bash</highlight></codeline>
<codeline><highlight class="normal">build/bin/test_bitcoin<sp/>--log_level=all<sp/>--run_test=getarg_tests</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">or</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">```bash</highlight></codeline>
<codeline><highlight class="normal">build/bin/test_bitcoin<sp/>-l<sp/>all<sp/>-t<sp/>getarg_tests</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">or<sp/>to<sp/>run<sp/>only<sp/>the<sp/>doubledash<sp/>test<sp/>in<sp/>`getarg_tests`</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">```bash</highlight></codeline>
<codeline><highlight class="normal">build/bin/test_bitcoin<sp/>--run_test=getarg_tests/doubledash</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">The<sp/>`--log_level=`<sp/>(or<sp/>`-l`)<sp/>argument<sp/>controls<sp/>the<sp/>verbosity<sp/>of<sp/>the<sp/>test<sp/>output.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">The<sp/>`test_bitcoin`<sp/>runner<sp/>also<sp/>accepts<sp/>some<sp/>of<sp/>the<sp/>command<sp/>line<sp/>arguments<sp/>accepted<sp/>by</highlight></codeline>
<codeline><highlight class="normal">`bitcoind`.<sp/>Use<sp/>`--`<sp/>to<sp/>separate<sp/>these<sp/>sets<sp/>of<sp/>arguments:</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">```bash</highlight></codeline>
<codeline><highlight class="normal">build/bin/test_bitcoin<sp/>--log_level=all<sp/>--run_test=getarg_tests<sp/>--<sp/>-printtoconsole=1</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">The<sp/>`-printtoconsole=1`<sp/>after<sp/>the<sp/>two<sp/>dashes<sp/>sends<sp/>debug<sp/>logging,<sp/>which</highlight></codeline>
<codeline><highlight class="normal">normally<sp/>goes<sp/>only<sp/>to<sp/>`debug.log`<sp/>within<sp/>the<sp/>data<sp/>directory,<sp/>to<sp/>the</highlight></codeline>
<codeline><highlight class="normal">standard<sp/>terminal<sp/>output<sp/>as<sp/>well.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">Running<sp/>`test_bitcoin`<sp/>creates<sp/>a<sp/>temporary<sp/>working<sp/>(data)<sp/>directory<sp/>with<sp/>a<sp/>randomly</highlight></codeline>
<codeline><highlight class="normal">generated<sp/>pathname<sp/>within<sp/>`test_common<sp/>bitcoin/`,<sp/>which<sp/>in<sp/>turn<sp/>is<sp/>within</highlight></codeline>
<codeline><highlight class="normal">the<sp/>system&apos;s<sp/>temporary<sp/>directory<sp/>(see</highlight></codeline>
<codeline><highlight class="normal">[`temp_directory_path`](https://en.cppreference.com/w/cpp/filesystem/temp_directory_path)).</highlight></codeline>
<codeline><highlight class="normal">This<sp/>data<sp/>directory<sp/>looks<sp/>like<sp/>a<sp/>simplified<sp/>form<sp/>of<sp/>the<sp/>standard<sp/>`bitcoind`<sp/>data</highlight></codeline>
<codeline><highlight class="normal">directory.<sp/>Its<sp/>content<sp/>will<sp/>vary<sp/>depending<sp/>on<sp/>the<sp/>test,<sp/>but<sp/>it<sp/>will<sp/>always</highlight></codeline>
<codeline><highlight class="normal">have<sp/>a<sp/>`debug.log`<sp/>file,<sp/>for<sp/>example.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">The<sp/>location<sp/>of<sp/>the<sp/>temporary<sp/>data<sp/>directory<sp/>can<sp/>be<sp/>specified<sp/>with<sp/>the</highlight></codeline>
<codeline><highlight class="normal">`-testdatadir`<sp/>option.<sp/>This<sp/>can<sp/>make<sp/>debugging<sp/>easier.<sp/>The<sp/>directory</highlight></codeline>
<codeline><highlight class="normal">path<sp/>used<sp/>is<sp/>the<sp/>argument<sp/>path<sp/>appended<sp/>with</highlight></codeline>
<codeline><highlight class="normal">`/test_common<sp/>bitcoin/&lt;test-name&gt;/datadir`.</highlight></codeline>
<codeline><highlight class="normal">The<sp/>directory<sp/>path<sp/>is<sp/>created<sp/>if<sp/>necessary.</highlight></codeline>
<codeline><highlight class="normal">Specifying<sp/>this<sp/>argument<sp/>also<sp/>causes<sp/>the<sp/>data<sp/>directory</highlight></codeline>
<codeline><highlight class="normal">not<sp/>to<sp/>be<sp/>removed<sp/>after<sp/>the<sp/>last<sp/>test.<sp/>This<sp/>is<sp/>useful<sp/>for<sp/>looking<sp/>at</highlight></codeline>
<codeline><highlight class="normal">what<sp/>the<sp/>test<sp/>wrote<sp/>to<sp/>`debug.log`<sp/>after<sp/>it<sp/>completes,<sp/>for<sp/>example.</highlight></codeline>
<codeline><highlight class="normal">(The<sp/>directory<sp/>is<sp/>removed<sp/>at<sp/>the<sp/>start<sp/>of<sp/>the<sp/>next<sp/>test<sp/>run,</highlight></codeline>
<codeline><highlight class="normal">so<sp/>no<sp/>leftover<sp/>state<sp/>is<sp/>used.)</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">```bash</highlight></codeline>
<codeline><highlight class="normal">$<sp/>build/bin/test_bitcoin<sp/>--run_test=getarg_tests/doubledash<sp/>--<sp/>-testdatadir=/somewhere/mydatadir</highlight></codeline>
<codeline><highlight class="normal">Test<sp/>directory<sp/>(will<sp/>not<sp/>be<sp/>deleted):<sp/>&quot;/somewhere/mydatadir/test_common<sp/>bitcoin/getarg_tests/doubledash/datadir&quot;</highlight></codeline>
<codeline><highlight class="normal">Running<sp/>1<sp/>test<sp/>case...</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">***<sp/>No<sp/>errors<sp/>detected</highlight></codeline>
<codeline><highlight class="normal">$<sp/>ls<sp/>-l<sp/>&apos;/somewhere/mydatadir/test_common<sp/>bitcoin/getarg_tests/doubledash/datadir&apos;</highlight></codeline>
<codeline><highlight class="normal">total<sp/>8</highlight></codeline>
<codeline><highlight class="normal">drwxrwxr-x<sp/>2<sp/>admin<sp/>admin<sp/>4096<sp/>Nov<sp/>27<sp/>22:45<sp/>blocks</highlight></codeline>
<codeline><highlight class="normal">-rw-rw-r--<sp/>1<sp/>admin<sp/>admin<sp/>1003<sp/>Nov<sp/>27<sp/>22:45<sp/>debug.log</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">If<sp/>you<sp/>run<sp/>an<sp/>entire<sp/>test<sp/>suite,<sp/>such<sp/>as<sp/>`--run_test=getarg_tests`,<sp/>or<sp/>all<sp/>the<sp/>test<sp/>suites</highlight></codeline>
<codeline><highlight class="normal">(by<sp/>not<sp/>specifying<sp/>`--run_test`),<sp/>a<sp/>separate<sp/>directory</highlight></codeline>
<codeline><highlight class="normal">will<sp/>be<sp/>created<sp/>for<sp/>each<sp/>individual<sp/>test.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>Adding<sp/>test<sp/>cases</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">To<sp/>add<sp/>a<sp/>new<sp/>unit<sp/>test<sp/>file<sp/>to<sp/>our<sp/>test<sp/>suite,<sp/>you<sp/>need</highlight></codeline>
<codeline><highlight class="normal">to<sp/>add<sp/>the<sp/>file<sp/>to<sp/>either<sp/>`src/test/CMakeLists.txt`<sp/>or</highlight></codeline>
<codeline><highlight class="normal">`src/wallet/test/CMakeLists.txt`<sp/>for<sp/>wallet-related<sp/>tests.<sp/>The<sp/>pattern<sp/>is<sp/>to<sp/>create</highlight></codeline>
<codeline><highlight class="normal">one<sp/>test<sp/>file<sp/>for<sp/>each<sp/>class<sp/>or<sp/>source<sp/>file<sp/>for<sp/>which<sp/>you<sp/>want<sp/>to<sp/>create</highlight></codeline>
<codeline><highlight class="normal">unit<sp/>tests.<sp/>The<sp/>file<sp/>naming<sp/>convention<sp/>is<sp/>`&lt;source_filename&gt;_tests.cpp`</highlight></codeline>
<codeline><highlight class="normal">and<sp/>such<sp/>files<sp/>should<sp/>wrap<sp/>their<sp/>tests<sp/>in<sp/>a<sp/>test<sp/>suite</highlight></codeline>
<codeline><highlight class="normal">called<sp/>`&lt;source_filename&gt;_tests`.<sp/>For<sp/>an<sp/>example<sp/>of<sp/>this<sp/>pattern,</highlight></codeline>
<codeline><highlight class="normal">see<sp/>`uint256_tests.cpp`.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>Logging<sp/>and<sp/>debugging<sp/>in<sp/>unit<sp/>tests</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">`ctest<sp/>--test-dir<sp/>build`<sp/>will<sp/>write<sp/>to<sp/>the<sp/>log<sp/>file<sp/>`build/Testing/Temporary/LastTest.log`.<sp/>You<sp/>can</highlight></codeline>
<codeline><highlight class="normal">additionally<sp/>use<sp/>the<sp/>`--output-on-failure`<sp/>option<sp/>to<sp/>display<sp/>logs<sp/>of<sp/>the<sp/>failed<sp/>tests<sp/>automatically</highlight></codeline>
<codeline><highlight class="normal">on<sp/>failure.<sp/>For<sp/>running<sp/>individual<sp/>tests<sp/>verbosely,<sp/>refer<sp/>to<sp/>the<sp/>section</highlight></codeline>
<codeline><highlight class="normal">[above](#running-individual-tests).</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">To<sp/>write<sp/>to<sp/>logs<sp/>from<sp/>unit<sp/>tests<sp/>you<sp/>need<sp/>to<sp/>use<sp/>specific<sp/>message<sp/>methods</highlight></codeline>
<codeline><highlight class="normal">provided<sp/>by<sp/>Boost.<sp/>The<sp/>simplest<sp/>is<sp/>`BOOST_TEST_MESSAGE`.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">For<sp/>debugging<sp/>you<sp/>can<sp/>launch<sp/>the<sp/>`test_bitcoin`<sp/>executable<sp/>with<sp/>`gdb`<sp/>or<sp/>`lldb`<sp/>and</highlight></codeline>
<codeline><highlight class="normal">start<sp/>debugging,<sp/>just<sp/>like<sp/>you<sp/>would<sp/>with<sp/>any<sp/>other<sp/>program:</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">```bash</highlight></codeline>
<codeline><highlight class="normal">gdb<sp/>build/bin/test_bitcoin</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>Segmentation<sp/>faults</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">If<sp/>you<sp/>hit<sp/>a<sp/>segmentation<sp/>fault<sp/>during<sp/>a<sp/>test<sp/>run,<sp/>you<sp/>can<sp/>diagnose<sp/>where<sp/>the<sp/>fault</highlight></codeline>
<codeline><highlight class="normal">is<sp/>happening<sp/>by<sp/>running<sp/>`gdb<sp/>./build/bin/test_bitcoin`<sp/>and<sp/>then<sp/>using<sp/>the<sp/>`bt`<sp/>command</highlight></codeline>
<codeline><highlight class="normal">within<sp/>gdb.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">Another<sp/>tool<sp/>that<sp/>can<sp/>be<sp/>used<sp/>to<sp/>resolve<sp/>segmentation<sp/>faults<sp/>is</highlight></codeline>
<codeline><highlight class="normal">[valgrind](https://valgrind.org/).</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">If<sp/>for<sp/>whatever<sp/>reason<sp/>you<sp/>want<sp/>to<sp/>produce<sp/>a<sp/>core<sp/>dump<sp/>file<sp/>for<sp/>this<sp/>fault,<sp/>you<sp/>can<sp/>do</highlight></codeline>
<codeline><highlight class="normal">that<sp/>as<sp/>well.<sp/>By<sp/>default,<sp/>the<sp/>boost<sp/>test<sp/>runner<sp/>will<sp/>intercept<sp/>system<sp/>errors<sp/>and<sp/>not</highlight></codeline>
<codeline><highlight class="normal">produce<sp/>a<sp/>core<sp/>file.<sp/>To<sp/>bypass<sp/>this,<sp/>add<sp/>`--catch_system_errors=no`<sp/>to<sp/>the</highlight></codeline>
<codeline><highlight class="normal">`test_bitcoin`<sp/>arguments<sp/>and<sp/>ensure<sp/>that<sp/>your<sp/>ulimits<sp/>are<sp/>set<sp/>properly<sp/>(e.g.<sp/>`ulimit<sp/>-c</highlight></codeline>
<codeline><highlight class="normal">unlimited`).</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">Running<sp/>the<sp/>tests<sp/>and<sp/>hitting<sp/>a<sp/>segmentation<sp/>fault<sp/>should<sp/>now<sp/>produce<sp/>a<sp/>file<sp/>called<sp/>`core`</highlight></codeline>
<codeline><highlight class="normal">(on<sp/>Linux<sp/>platforms,<sp/>the<sp/>file<sp/>name<sp/>will<sp/>likely<sp/>depend<sp/>on<sp/>the<sp/>contents<sp/>of</highlight></codeline>
<codeline><highlight class="normal">`/proc/sys/kernel/core_pattern`).</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">You<sp/>can<sp/>then<sp/>explore<sp/>the<sp/>core<sp/>dump<sp/>using</highlight></codeline>
<codeline><highlight class="normal">```bash</highlight></codeline>
<codeline><highlight class="normal">gdb<sp/>build/bin/test_bitcoin<sp/>core</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">(gdb)<sp/>bt<sp/><sp/>#<sp/>produce<sp/>a<sp/>backtrace<sp/>for<sp/>where<sp/>a<sp/>segfault<sp/>occurred</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
    </programlisting>
    <location file="src/test/README.md"/>
  </compounddef>
</doxygen>
