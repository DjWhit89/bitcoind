<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="txgraph__tests_8cpp" kind="file" language="C++">
    <compoundname>txgraph_tests.cpp</compoundname>
    <includes refid="txgraph_8h" local="no">txgraph.h</includes>
    <includes local="no">random.h</includes>
    <includes local="no">boost/test/unit_test.hpp</includes>
    <includes local="no">memory</includes>
    <includes local="no">vector</includes>
    <incdepgraph>
      <node id="16">
        <label>attributes.h</label>
        <link refid="attributes_8h"/>
      </node>
      <node id="10">
        <label>span.h</label>
        <link refid="span_8h"/>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>src/test/txgraph_tests.cpp</label>
        <link refid="txgraph__tests_8cpp"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>txgraph.h</label>
        <link refid="txgraph_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
      </node>
      <node id="15">
        <label>util/check.h</label>
        <link refid="check_8h"/>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
      </node>
      <node id="9">
        <label>util/feefrac.h</label>
        <link refid="feefrac_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="17">
        <label>atomic</label>
      </node>
      <node id="23">
        <label>boost/test/unit_test.hpp</label>
      </node>
      <node id="11">
        <label>cassert</label>
      </node>
      <node id="3">
        <label>compare</label>
      </node>
      <node id="12">
        <label>cstddef</label>
      </node>
      <node id="4">
        <label>cstdint</label>
      </node>
      <node id="5">
        <label>memory</label>
      </node>
      <node id="6">
        <label>optional</label>
      </node>
      <node id="22">
        <label>random.h</label>
      </node>
      <node id="18">
        <label>source_location</label>
      </node>
      <node id="13">
        <label>span</label>
      </node>
      <node id="19">
        <label>stdexcept</label>
      </node>
      <node id="20">
        <label>string</label>
      </node>
      <node id="21">
        <label>string_view</label>
      </node>
      <node id="14">
        <label>type_traits</label>
      </node>
      <node id="7">
        <label>utility</label>
      </node>
      <node id="8">
        <label>vector</label>
      </node>
    </incdepgraph>
    <sectiondef kind="var">
      <memberdef kind="variable" id="txgraph__tests_8cpp_1ade37d51cacb8f2e5b3b837e04cf8464b" prot="public" static="yes" constexpr="yes" mutable="no">
        <type>uint64_t</type>
        <definition>uint64_t NUM_ACCEPTABLE_ITERS</definition>
        <argsstring></argsstring>
        <name>NUM_ACCEPTABLE_ITERS</name>
        <initializer>= 100&apos;000&apos;000</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>The number used as acceptable_iters argument in these tests. High enough that everything should be optimal, always. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/test/txgraph_tests.cpp" line="18" column="27" bodyfile="src/test/txgraph_tests.cpp" bodystart="18" bodyend="-1"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="func">
      <memberdef kind="function" id="txgraph__tests_8cpp_1ac0f2552de068e24beaf38ccff3eb41cb" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>BOOST_AUTO_TEST_CASE</definition>
        <argsstring>(txgraph_trim_zigzag)</argsstring>
        <name>BOOST_AUTO_TEST_CASE</name>
        <param>
          <type>txgraph_trim_zigzag</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
<para>The maximum cluster count used in this test.</para>
<para>The number of &quot;bottom&quot; transactions, which are in the mempool already.</para>
<para>The number of &quot;top&quot; transactions, which come from disconnected blocks. These are re-added to the mempool and, while connecting them to the already-in-mempool transactions, we discover the resulting cluster is oversized.</para>
<para>The total number of transactions in the test.</para>
<para>Set a very large cluster size limit so that only the count limit is triggered.</para>
        </inbodydescription>
        <location file="src/test/txgraph_tests.cpp" line="20" column="1" bodyfile="src/test/txgraph_tests.cpp" bodystart="20" bodyend="81"/>
      </memberdef>
      <memberdef kind="function" id="txgraph__tests_8cpp_1a50bde528003a1643de8602c460162316" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>BOOST_AUTO_TEST_CASE</definition>
        <argsstring>(txgraph_trim_flower)</argsstring>
        <name>BOOST_AUTO_TEST_CASE</name>
        <param>
          <type>txgraph_trim_flower</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
<para>The maximum cluster count used in this test.</para>
<para>The number of &quot;top&quot; transactions, which come from disconnected blocks. These are re-added to the mempool and, connecting them to the already-in-mempool transactions, we discover the resulting cluster is oversized.</para>
<para>The total number of transactions in this test.</para>
<para>Set a very large cluster size limit so that only the count limit is triggered.</para>
        </inbodydescription>
        <location file="src/test/txgraph_tests.cpp" line="83" column="1" bodyfile="src/test/txgraph_tests.cpp" bodystart="83" bodyend="140"/>
      </memberdef>
      <memberdef kind="function" id="txgraph__tests_8cpp_1a0f9638be838ec6d3185c78731338dea8" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>BOOST_AUTO_TEST_CASE</definition>
        <argsstring>(txgraph_trim_huge)</argsstring>
        <name>BOOST_AUTO_TEST_CASE</name>
        <param>
          <type>txgraph_trim_huge</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
<para>The maximum cluster count used in this test.</para>
<para>The number of &quot;top&quot; (from-block) chains of transactions.</para>
<para>The number of transactions per top chain.</para>
<para>The (maximum) number of dependencies per bottom transaction.</para>
<para>The number of bottom transactions that are expected to be created.</para>
<para>The total number of transactions created in this test.</para>
<para>Set a very large cluster size limit so that only the count limit is triggered.</para>
<para>Refs to all top transactions.</para>
<para>Refs to all bottom transactions.</para>
<para>Indexes into top_refs for some transaction of each component, in arbitrary order. Initially these are the last transactions in each chains, but as bottom transactions are added, entries will be removed when they get merged, and randomized.</para>
        </inbodydescription>
        <location file="src/test/txgraph_tests.cpp" line="142" column="1" bodyfile="src/test/txgraph_tests.cpp" bodystart="142" bodyend="253"/>
      </memberdef>
      <memberdef kind="function" id="txgraph__tests_8cpp_1aedd43383def66a24eb8014af38bfba07" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>BOOST_AUTO_TEST_CASE</definition>
        <argsstring>(txgraph_trim_big_singletons)</argsstring>
        <name>BOOST_AUTO_TEST_CASE</name>
        <param>
          <type>txgraph_trim_big_singletons</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/test/txgraph_tests.cpp" line="255" column="1" bodyfile="src/test/txgraph_tests.cpp" bodystart="255" bodyend="292"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2023-present<sp/>The<sp/>Bitcoin<sp/>Core<sp/>developers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Distributed<sp/>under<sp/>the<sp/>MIT<sp/>software<sp/>license,<sp/>see<sp/>the<sp/>accompanying</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">//<sp/>file<sp/>COPYING<sp/>or<sp/>https://opensource.org/license/mit/.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="txgraph_8h" kindref="compound">txgraph.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;random.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;boost/test/unit_test.hpp&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;memory&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;vector&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal">BOOST_AUTO_TEST_SUITE(txgraph_tests)</highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/>uint64_t<sp/>NUM_ACCEPTABLE_ITERS<sp/>=<sp/>100&apos;000&apos;000;</highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"><ref refid="txgraph__tests_8cpp_1ac0f2552de068e24beaf38ccff3eb41cb" kindref="member">BOOST_AUTO_TEST_CASE</ref>(txgraph_trim_zigzag)</highlight></codeline>
<codeline lineno="21"><highlight class="normal">{</highlight></codeline>
<codeline lineno="22"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>T<sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/>T<sp/>(50<sp/>T&apos;s)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/>\<sp/><sp/><sp/>/<sp/>\<sp/><sp/><sp/>/<sp/>\<sp/><sp/><sp/>/<sp/>\<sp/><sp/><sp/>/<sp/>\<sp/><sp/><sp/>/<sp/>\<sp/><sp/><sp/>/<sp/>\<sp/><sp/><sp/>/<sp/>\<sp/><sp/><sp/>/<sp/>\<sp/><sp/><sp/>/<sp/>\<sp/><sp/><sp/>/<sp/>\<sp/><sp/><sp/>/<sp/>\<sp/><sp/><sp/>/<sp/>\<sp/><sp/><sp/>/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/>\<sp/>/<sp/><sp/><sp/>\<sp/>/<sp/><sp/><sp/>\<sp/>/<sp/><sp/><sp/>\<sp/>/<sp/><sp/><sp/>\<sp/>/<sp/><sp/><sp/>\<sp/>/<sp/><sp/><sp/>\<sp/>/<sp/><sp/><sp/>\<sp/>/<sp/><sp/><sp/>\<sp/>/<sp/><sp/><sp/>\<sp/>/<sp/><sp/><sp/>\<sp/>/<sp/><sp/><sp/>\<sp/>/<sp/><sp/><sp/>\<sp/>/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>B<sp/><sp/><sp/><sp/><sp/>B<sp/><sp/><sp/><sp/><sp/>B<sp/><sp/><sp/><sp/><sp/>B<sp/><sp/><sp/><sp/><sp/>B<sp/><sp/><sp/><sp/><sp/>B<sp/><sp/><sp/><sp/><sp/>B<sp/><sp/><sp/><sp/><sp/>B<sp/><sp/><sp/><sp/><sp/>B<sp/><sp/><sp/><sp/><sp/>B<sp/><sp/><sp/><sp/><sp/>B<sp/><sp/><sp/><sp/><sp/>B<sp/><sp/><sp/><sp/><sp/>B<sp/><sp/><sp/><sp/>(49<sp/>B&apos;s)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>MAX_CLUSTER_COUNT<sp/>=<sp/>50;</highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>NUM_BOTTOM_TX<sp/>=<sp/>49;</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>NUM_TOP_TX<sp/>=<sp/>50;</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>NUM_TOTAL_TX<sp/>=<sp/>NUM_BOTTOM_TX<sp/>+<sp/>NUM_TOP_TX;</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_assert</highlight><highlight class="normal">(NUM_TOTAL_TX<sp/>&gt;<sp/>MAX_CLUSTER_COUNT);</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/>int32_t<sp/>MAX_CLUSTER_SIZE<sp/>=<sp/>100&apos;000<sp/>*<sp/>100;</highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>a<sp/>new<sp/>graph<sp/>for<sp/>the<sp/>test.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>graph<sp/>=<sp/><ref refid="txgraph_8cpp_1ac58e95e0103ed9acf483ead3d07eaa6d" kindref="member">MakeTxGraph</ref>(MAX_CLUSTER_COUNT,<sp/>MAX_CLUSTER_SIZE,<sp/>NUM_ACCEPTABLE_ITERS);</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>all<sp/>transactions<sp/>and<sp/>store<sp/>their<sp/>Refs.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;TxGraph::Ref&gt;<sp/>refs;</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/>refs.reserve(NUM_TOTAL_TX);</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>all<sp/>bottom<sp/>transactions:<sp/>the<sp/>i&apos;th<sp/>bottom<sp/>transaction<sp/>is<sp/>at<sp/>position<sp/>i.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>NUM_BOTTOM_TX;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>refs.push_back(graph-&gt;AddTransaction(<ref refid="feefrac_8h_1aa0ae36c78a6af8f8c4f1a1255249858e" kindref="member">FeePerWeight</ref>{200<sp/>-<sp/>i,<sp/>100}));</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Then<sp/>all<sp/>top<sp/>transactions:<sp/>the<sp/>i&apos;th<sp/>top<sp/>transaction<sp/>is<sp/>at<sp/>position<sp/>NUM_BOTTOM_TX<sp/>+<sp/>i.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>NUM_TOP_TX;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>refs.push_back(graph-&gt;AddTransaction(<ref refid="feefrac_8h_1aa0ae36c78a6af8f8c4f1a1255249858e" kindref="member">FeePerWeight</ref>{100<sp/>-<sp/>i,<sp/>100}));</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>the<sp/>zigzag<sp/>dependency<sp/>structure.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Each<sp/>transaction<sp/>in<sp/>the<sp/>bottom<sp/>row<sp/>depends<sp/>on<sp/>two<sp/>adjacent<sp/>transactions<sp/>from<sp/>the<sp/>top<sp/>row.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/>graph-&gt;SanityCheck();</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>NUM_BOTTOM_TX;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>graph-&gt;AddDependency(</highlight><highlight class="comment">/*parent=*/</highlight><highlight class="normal">refs[NUM_BOTTOM_TX<sp/>+<sp/>i],<sp/></highlight><highlight class="comment">/*child=*/</highlight><highlight class="normal">refs[i]);</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>graph-&gt;AddDependency(</highlight><highlight class="comment">/*parent=*/</highlight><highlight class="normal">refs[NUM_BOTTOM_TX<sp/>+<sp/>i<sp/>+<sp/>1],<sp/></highlight><highlight class="comment">/*child=*/</highlight><highlight class="normal">refs[i]);</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>the<sp/>graph<sp/>is<sp/>now<sp/>oversized.<sp/>This<sp/>also<sp/>forces<sp/>the<sp/>graph<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>group<sp/>clusters<sp/>and<sp/>compute<sp/>the<sp/>oversized<sp/>status.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/>graph-&gt;SanityCheck();</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(graph-&gt;GetTransactionCount(<ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>),<sp/>NUM_TOTAL_TX);</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(graph-&gt;IsOversized(<ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>));</highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Call<sp/>Trim()<sp/>to<sp/>remove<sp/>transactions<sp/>and<sp/>bring<sp/>the<sp/>cluster<sp/>back<sp/>within<sp/>limits.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>removed_refs<sp/>=<sp/>graph-&gt;Trim();</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/>graph-&gt;SanityCheck();</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(!graph-&gt;IsOversized(<ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>));</highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>only<sp/>need<sp/>to<sp/>trim<sp/>the<sp/>middle<sp/>bottom<sp/>transaction<sp/>to<sp/>end<sp/>up<sp/>with<sp/>2<sp/>clusters<sp/>each<sp/>within<sp/>cluster<sp/>limits.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(removed_refs.size(),<sp/>1);</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(graph-&gt;GetTransactionCount(<ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>),<sp/>MAX_CLUSTER_COUNT<sp/>*<sp/>2<sp/>-<sp/>2);</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>refs.size();<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(graph-&gt;Exists(refs[i],<sp/><ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>),<sp/>i<sp/>!=<sp/>(NUM_BOTTOM_TX<sp/>/<sp/>2));</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="81"><highlight class="normal">}</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><ref refid="txgraph__tests_8cpp_1ac0f2552de068e24beaf38ccff3eb41cb" kindref="member">BOOST_AUTO_TEST_CASE</ref>(txgraph_trim_flower)</highlight></codeline>
<codeline lineno="84"><highlight class="normal">{</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>will<sp/>build<sp/>an<sp/>oversized<sp/>flower-shaped<sp/>graph:<sp/>all<sp/>transactions<sp/>are<sp/>spent<sp/>by<sp/>1<sp/>descendant.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/>T<sp/><sp/><sp/>T<sp/><sp/><sp/>T<sp/><sp/><sp/>T<sp/><sp/><sp/>T<sp/><sp/><sp/>T<sp/><sp/><sp/>T<sp/><sp/><sp/>T<sp/>(100<sp/>T&apos;s)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/>|<sp/><sp/><sp/>|<sp/><sp/><sp/>|<sp/><sp/><sp/>|<sp/><sp/><sp/>|<sp/><sp/><sp/>|<sp/><sp/><sp/>|<sp/><sp/><sp/>|</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/>|<sp/><sp/><sp/>|<sp/><sp/><sp/>|<sp/><sp/><sp/>|<sp/><sp/><sp/>|<sp/><sp/><sp/>|<sp/><sp/><sp/>|<sp/><sp/><sp/>|</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/>\---+---+---+-+-+---+---+---/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B<sp/>(1<sp/>B)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>MAX_CLUSTER_COUNT<sp/>=<sp/>50;</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>NUM_TOP_TX<sp/>=<sp/>MAX_CLUSTER_COUNT<sp/>*<sp/>2;</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>NUM_TOTAL_TX<sp/>=<sp/>NUM_TOP_TX<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/>int32_t<sp/>MAX_CLUSTER_SIZE<sp/>=<sp/>100&apos;000<sp/>*<sp/>100;</highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>graph<sp/>=<sp/><ref refid="txgraph_8cpp_1ac58e95e0103ed9acf483ead3d07eaa6d" kindref="member">MakeTxGraph</ref>(MAX_CLUSTER_COUNT,<sp/>MAX_CLUSTER_SIZE,<sp/>NUM_ACCEPTABLE_ITERS);</highlight></codeline>
<codeline lineno="106"><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>all<sp/>transactions<sp/>and<sp/>store<sp/>their<sp/>Refs.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;TxGraph::Ref&gt;<sp/>refs;</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/>refs.reserve(NUM_TOTAL_TX);</highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>all<sp/>transactions.<sp/>They<sp/>are<sp/>in<sp/>individual<sp/>clusters.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/>refs.push_back(graph-&gt;AddTransaction({1,<sp/>100}));</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>NUM_TOP_TX;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>refs.push_back(graph-&gt;AddTransaction(<ref refid="feefrac_8h_1aa0ae36c78a6af8f8c4f1a1255249858e" kindref="member">FeePerWeight</ref>{500<sp/>+<sp/>i,<sp/>100}));</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/>graph-&gt;SanityCheck();</highlight></codeline>
<codeline lineno="117"><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>0th<sp/>transaction<sp/>spends<sp/>all<sp/>the<sp/>top<sp/>transactions.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>1;<sp/>i<sp/>&lt;<sp/>NUM_TOTAL_TX;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>graph-&gt;AddDependency(</highlight><highlight class="comment">/*parent=*/</highlight><highlight class="normal">refs[i],<sp/></highlight><highlight class="comment">/*child=*/</highlight><highlight class="normal">refs[0]);</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/>graph-&gt;SanityCheck();</highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>the<sp/>graph<sp/>is<sp/>now<sp/>oversized.<sp/>This<sp/>also<sp/>forces<sp/>the<sp/>graph<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>group<sp/>clusters<sp/>and<sp/>compute<sp/>the<sp/>oversized<sp/>status.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(graph-&gt;IsOversized(<ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>));</highlight></codeline>
<codeline lineno="127"><highlight class="normal"></highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Call<sp/>Trim()<sp/>to<sp/>remove<sp/>transactions<sp/>and<sp/>bring<sp/>the<sp/>cluster<sp/>back<sp/>within<sp/>limits.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>removed_refs<sp/>=<sp/>graph-&gt;Trim();</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/>graph-&gt;SanityCheck();</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(!graph-&gt;IsOversized(<ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>));</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Since<sp/>only<sp/>the<sp/>bottom<sp/>transaction<sp/>connects<sp/>these<sp/>clusters,<sp/>we<sp/>only<sp/>need<sp/>to<sp/>remove<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(removed_refs.size(),<sp/>1);</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(graph-&gt;GetTransactionCount(<ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>),<sp/>MAX_CLUSTER_COUNT<sp/>*<sp/>2);</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(!graph-&gt;Exists(refs[0],<sp/><ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>));</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>1;<sp/>i<sp/>&lt;<sp/>refs.size();<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(graph-&gt;Exists(refs[i],<sp/><ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>));</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="140"><highlight class="normal">}</highlight></codeline>
<codeline lineno="141"><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><ref refid="txgraph__tests_8cpp_1ac0f2552de068e24beaf38ccff3eb41cb" kindref="member">BOOST_AUTO_TEST_CASE</ref>(txgraph_trim_huge)</highlight></codeline>
<codeline lineno="143"><highlight class="normal">{</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>from-block<sp/>transactions<sp/>consist<sp/>of<sp/>1000<sp/>fully<sp/>linear<sp/>clusters,<sp/>each<sp/>with<sp/>64</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>transactions.<sp/>The<sp/>mempool<sp/>contains<sp/>11<sp/>transactions<sp/>that<sp/>together<sp/>merge<sp/>all<sp/>of<sp/>these<sp/>into</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>a<sp/>single<sp/>cluster.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>(1000<sp/>chains<sp/>of<sp/>64<sp/>transactions,<sp/>64000<sp/>T&apos;s<sp/>total)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/>(64<sp/>long)<sp/><sp/>(64<sp/>long)<sp/><sp/>(64<sp/>long)<sp/><sp/>(64<sp/>long)<sp/><sp/>(64<sp/>long)<sp/><sp/>(64<sp/>long)<sp/><sp/>(64<sp/>long)<sp/><sp/>(64<sp/>long)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>/<sp/>\<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>/<sp/>\<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/>\----------+--------/<sp/><sp/><sp/>\--------+--------/<sp/><sp/><sp/>\--------+-----+----+--------/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/>(11<sp/>B&apos;s,<sp/>each<sp/>attaching<sp/>to<sp/>up<sp/>to<sp/>100<sp/>chains<sp/>of<sp/>64<sp/>T&apos;s)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>MAX_CLUSTER_COUNT<sp/>=<sp/>64;</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>NUM_TOP_CHAINS<sp/>=<sp/>1000;</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>NUM_TX_PER_TOP_CHAIN<sp/>=<sp/>MAX_CLUSTER_COUNT;</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>NUM_DEPS_PER_BOTTOM_TX<sp/>=<sp/>100;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>NUM_BOTTOM_TX<sp/>=<sp/>(NUM_TOP_CHAINS<sp/>-<sp/>1<sp/>+<sp/>(NUM_DEPS_PER_BOTTOM_TX<sp/>-<sp/>2))<sp/>/<sp/>(NUM_DEPS_PER_BOTTOM_TX<sp/>-<sp/>1);</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>NUM_TOTAL_TX<sp/>=<sp/>NUM_TOP_CHAINS<sp/>*<sp/>NUM_TX_PER_TOP_CHAIN<sp/>+<sp/>NUM_BOTTOM_TX;</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/>int32_t<sp/>MAX_CLUSTER_SIZE<sp/>=<sp/>100&apos;000<sp/>*<sp/>100;</highlight></codeline>
<codeline lineno="180"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;TxGraph::Ref&gt;<sp/>top_refs;</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;TxGraph::Ref&gt;<sp/>bottom_refs;</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;size_t&gt;<sp/>top_components;</highlight></codeline>
<codeline lineno="189"><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_fast_random_context" kindref="compound">FastRandomContext</ref><sp/>rng;</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>graph<sp/>=<sp/><ref refid="txgraph_8cpp_1ac58e95e0103ed9acf483ead3d07eaa6d" kindref="member">MakeTxGraph</ref>(MAX_CLUSTER_COUNT,<sp/>MAX_CLUSTER_SIZE,<sp/>NUM_ACCEPTABLE_ITERS);</highlight></codeline>
<codeline lineno="192"><highlight class="normal"></highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Construct<sp/>the<sp/>top<sp/>chains.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>chain<sp/>=<sp/>0;<sp/>chain<sp/>&lt;<sp/>NUM_TOP_CHAINS;<sp/>++chain)<sp/>{</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>chaintx<sp/>=<sp/>0;<sp/>chaintx<sp/>&lt;<sp/>NUM_TX_PER_TOP_CHAIN;<sp/>++chaintx)<sp/>{</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Use<sp/>random<sp/>fees,<sp/>size<sp/>1.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int64_t<sp/><ref refid="mempool__ephemeral__spends_8cpp_1ab1754b8fc0364199f0cbb58d5e1f98e8" kindref="member">fee</ref><sp/>=<sp/>rng.<ref refid="class_random_mixin_1a09a69350e504d6e1b1c0232b30e581e0" kindref="member">randbits</ref>&lt;27&gt;()<sp/>+<sp/>100;</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="feefrac_8h_1aa0ae36c78a6af8f8c4f1a1255249858e" kindref="member">FeePerWeight</ref><sp/>feerate{<ref refid="mempool__ephemeral__spends_8cpp_1ab1754b8fc0364199f0cbb58d5e1f98e8" kindref="member">fee</ref>,<sp/>1};</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>top_refs.push_back(graph-&gt;AddTransaction(feerate));</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>internal<sp/>dependencies<sp/>linked<sp/>the<sp/>chain<sp/>transactions<sp/>together.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(chaintx<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>graph-&gt;AddDependency(*(top_refs.rbegin()),<sp/>*(top_refs.rbegin()<sp/>+<sp/>1));</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Remember<sp/>the<sp/>last<sp/>transaction<sp/>in<sp/>each<sp/>chain,<sp/>to<sp/>attach<sp/>the<sp/>bottom<sp/>transactions<sp/>to.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>top_components.push_back(top_refs.size()<sp/>-<sp/>1);</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/>graph-&gt;SanityCheck();</highlight></codeline>
<codeline lineno="209"><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Not<sp/>oversized<sp/>so<sp/>far<sp/>(just<sp/>1000<sp/>clusters<sp/>of<sp/>64).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(!graph-&gt;IsOversized(<ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>));</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Construct<sp/>the<sp/>bottom<sp/>transactions,<sp/>and<sp/>dependencies<sp/>to<sp/>the<sp/>top<sp/>chains.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(top_components.size()<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Construct<sp/>the<sp/>transaction.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int64_t<sp/><ref refid="mempool__ephemeral__spends_8cpp_1ab1754b8fc0364199f0cbb58d5e1f98e8" kindref="member">fee</ref><sp/>=<sp/>rng.<ref refid="class_random_mixin_1a09a69350e504d6e1b1c0232b30e581e0" kindref="member">randbits</ref>&lt;27&gt;()<sp/>+<sp/>100;</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="feefrac_8h_1aa0ae36c78a6af8f8c4f1a1255249858e" kindref="member">FeePerWeight</ref><sp/>feerate{<ref refid="mempool__ephemeral__spends_8cpp_1ab1754b8fc0364199f0cbb58d5e1f98e8" kindref="member">fee</ref>,<sp/>1};</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>bottom_tx<sp/>=<sp/>graph-&gt;AddTransaction(feerate);</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Determine<sp/>the<sp/>number<sp/>of<sp/>dependencies<sp/>this<sp/>transaction<sp/>will<sp/>have.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>deps<sp/>=<sp/>std::min&lt;int&gt;(NUM_DEPS_PER_BOTTOM_TX,<sp/>top_components.size());</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>dep<sp/>=<sp/>0;<sp/>dep<sp/>&lt;<sp/>deps;<sp/>++dep)<sp/>{</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Pick<sp/>an<sp/>transaction<sp/>in<sp/>top_components<sp/>to<sp/>attach<sp/>to.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>idx<sp/>=<sp/>rng.<ref refid="class_random_mixin_1a2d6586b973866411d231dd6fa54fc722" kindref="member">randrange</ref>(top_components.size());</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>dependency.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>graph-&gt;AddDependency(</highlight><highlight class="comment">/*parent=*/</highlight><highlight class="normal">top_refs[top_components[idx]],<sp/></highlight><highlight class="comment">/*child=*/</highlight><highlight class="normal">bottom_tx);</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Unless<sp/>this<sp/>is<sp/>the<sp/>last<sp/>dependency<sp/>being<sp/>added,<sp/>remove<sp/>from<sp/>top_components,<sp/>as</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>component<sp/>will<sp/>be<sp/>merged<sp/>with<sp/>that<sp/>one.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dep<sp/>&lt;<sp/>deps<sp/>-<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Move<sp/>entry<sp/>top<sp/>the<sp/>back.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(idx<sp/>!=<sp/>top_components.size()<sp/>-<sp/>1)<sp/>std::swap(top_components.back(),<sp/>top_components[idx]);</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>And<sp/>pop<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>top_components.pop_back();</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bottom_refs.push_back(std::move(bottom_tx));</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/>graph-&gt;SanityCheck();</highlight></codeline>
<codeline lineno="238"><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>we<sp/>are<sp/>oversized<sp/>(one<sp/>cluster<sp/>of<sp/>64011).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(graph-&gt;IsOversized(<ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>));</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>total_tx_count<sp/>=<sp/>graph-&gt;GetTransactionCount(<ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>);</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(total_tx_count<sp/>==<sp/>top_refs.size()<sp/>+<sp/>bottom_refs.size());</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(total_tx_count<sp/>==<sp/>NUM_TOTAL_TX);</highlight></codeline>
<codeline lineno="244"><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Call<sp/>Trim()<sp/>to<sp/>remove<sp/>transactions<sp/>and<sp/>bring<sp/>the<sp/>cluster<sp/>back<sp/>within<sp/>limits.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>removed_refs<sp/>=<sp/>graph-&gt;Trim();</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(!graph-&gt;IsOversized(<ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>));</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(removed_refs.size()<sp/>==<sp/>total_tx_count<sp/>-<sp/>graph-&gt;GetTransactionCount(<ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>));</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/>graph-&gt;SanityCheck();</highlight></codeline>
<codeline lineno="250"><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>At<sp/>least<sp/>99%<sp/>of<sp/>chains<sp/>must<sp/>survive.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(graph-&gt;GetTransactionCount(<ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>)<sp/>&gt;=<sp/>(NUM_TOP_CHAINS<sp/>*<sp/>NUM_TX_PER_TOP_CHAIN<sp/>*<sp/>99)<sp/>/<sp/>100);</highlight></codeline>
<codeline lineno="253"><highlight class="normal">}</highlight></codeline>
<codeline lineno="254"><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><ref refid="txgraph__tests_8cpp_1ac0f2552de068e24beaf38ccff3eb41cb" kindref="member">BOOST_AUTO_TEST_CASE</ref>(txgraph_trim_big_singletons)</highlight></codeline>
<codeline lineno="256"><highlight class="normal">{</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Mempool<sp/>consists<sp/>of<sp/>100<sp/>singleton<sp/>clusters;<sp/>there<sp/>are<sp/>no<sp/>dependencies.<sp/>Some<sp/>are<sp/>oversized.<sp/>Trim()<sp/>should<sp/>remove<sp/>all<sp/>of<sp/>the<sp/>oversized<sp/>ones.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>MAX_CLUSTER_COUNT<sp/>=<sp/>64;</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/>int32_t<sp/>MAX_CLUSTER_SIZE<sp/>=<sp/>100&apos;000;</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>NUM_TOTAL_TX<sp/>=<sp/>100;</highlight></codeline>
<codeline lineno="261"><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>a<sp/>new<sp/>graph<sp/>for<sp/>the<sp/>test.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>graph<sp/>=<sp/><ref refid="txgraph_8cpp_1ac58e95e0103ed9acf483ead3d07eaa6d" kindref="member">MakeTxGraph</ref>(MAX_CLUSTER_COUNT,<sp/>MAX_CLUSTER_SIZE,<sp/>NUM_ACCEPTABLE_ITERS);</highlight></codeline>
<codeline lineno="264"><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>all<sp/>transactions<sp/>and<sp/>store<sp/>their<sp/>Refs.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;TxGraph::Ref&gt;<sp/>refs;</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/>refs.reserve(NUM_TOTAL_TX);</highlight></codeline>
<codeline lineno="268"><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>all<sp/>transactions.<sp/>They<sp/>are<sp/>in<sp/>individual<sp/>clusters.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>NUM_TOTAL_TX;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>88th<sp/>transaction<sp/>is<sp/>oversized.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Every<sp/>20th<sp/>transaction<sp/>is<sp/>oversized.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="feefrac_8h_1aa0ae36c78a6af8f8c4f1a1255249858e" kindref="member">FeePerWeight</ref><sp/>feerate{500<sp/>+<sp/>i,<sp/>(i<sp/>==<sp/>88<sp/>||<sp/>i<sp/>%<sp/>20<sp/>==<sp/>0)<sp/>?<sp/>MAX_CLUSTER_SIZE<sp/>+<sp/>1<sp/>:<sp/>100};</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>refs.push_back(graph-&gt;AddTransaction(feerate));</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/>graph-&gt;SanityCheck();</highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>the<sp/>graph<sp/>is<sp/>now<sp/>oversized.<sp/>This<sp/>also<sp/>forces<sp/>the<sp/>graph<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>group<sp/>clusters<sp/>and<sp/>compute<sp/>the<sp/>oversized<sp/>status.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(graph-&gt;IsOversized(<ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>));</highlight></codeline>
<codeline lineno="281"><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Call<sp/>Trim()<sp/>to<sp/>remove<sp/>transactions<sp/>and<sp/>bring<sp/>the<sp/>cluster<sp/>back<sp/>within<sp/>limits.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>removed_refs<sp/>=<sp/>graph-&gt;Trim();</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/>graph-&gt;SanityCheck();</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(graph-&gt;GetTransactionCount(<ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>),<sp/>NUM_TOTAL_TX<sp/>-<sp/>6);</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(!graph-&gt;IsOversized(<ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>));</highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>all<sp/>the<sp/>oversized<sp/>transactions<sp/>were<sp/>removed.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>refs.size();<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(graph-&gt;Exists(refs[i],<sp/><ref refid="class_tx_graph_1a221b779e6bb7b8d40677d7642bfefac5a6705777b712ee811e76fb07162081d63" kindref="member">TxGraph::Level::TOP</ref>),<sp/>i<sp/>!=<sp/>88<sp/>&amp;&amp;<sp/>i<sp/>%<sp/>20<sp/>!=<sp/>0);</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="292"><highlight class="normal">}</highlight></codeline>
<codeline lineno="293"><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"><ref refid="cuckoocache__tests_8cpp_1af7f71af5c6c124222dd1c42c5df892f4" kindref="member">BOOST_AUTO_TEST_SUITE_END</ref>()</highlight></codeline>
    </programlisting>
    <location file="src/test/txgraph_tests.cpp"/>
  </compounddef>
</doxygen>
