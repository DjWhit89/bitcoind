<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="class_tx_reconciliation_tracker" kind="class" language="C++" prot="public">
    <compoundname>TxReconciliationTracker</compoundname>
    <includes refid="txreconciliation_8h" local="no">txreconciliation.h</includes>
    <innerclass refid="class_tx_reconciliation_tracker_1_1_impl" prot="public">TxReconciliationTracker::Impl</innerclass>
    <sectiondef kind="private-attrib">
      <memberdef kind="variable" id="class_tx_reconciliation_tracker_1ad8dd7a6109ef0f18d5dc19f4edd29c31" prot="private" static="no" mutable="no">
        <type>const std::unique_ptr&lt; Impl &gt;</type>
        <definition>const std::unique_ptr&lt;Impl&gt; m_impl</definition>
        <argsstring></argsstring>
        <name>m_impl</name>
        <qualifiedname>TxReconciliationTracker::m_impl</qualifiedname>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/txreconciliation.h" line="55" column="27" bodyfile="src/node/txreconciliation.h" bodystart="55" bodyend="-1"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="public-func">
      <memberdef kind="function" id="class_tx_reconciliation_tracker_1aed6be0343a8cc41fc91f3b8f7317724c" prot="public" static="no" const="no" explicit="yes" inline="no" virt="non-virtual">
        <type></type>
        <definition>TxReconciliationTracker</definition>
        <argsstring>(uint32_t recon_version)</argsstring>
        <name>TxReconciliationTracker</name>
        <qualifiedname>TxReconciliationTracker::TxReconciliationTracker</qualifiedname>
        <param>
          <type>uint32_t</type>
          <declname>recon_version</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/txreconciliation.h" line="58" column="14" bodyfile="src/node/txreconciliation.cpp" bodystart="147" bodyend="147"/>
      </memberdef>
      <memberdef kind="function" id="class_tx_reconciliation_tracker_1a8b01adf9ae2ffdbb4879f1bd44b11ecd" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>~TxReconciliationTracker</definition>
        <argsstring>()</argsstring>
        <name>~TxReconciliationTracker</name>
        <qualifiedname>TxReconciliationTracker::~TxReconciliationTracker</qualifiedname>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/txreconciliation.h" line="59" column="5"/>
      </memberdef>
      <memberdef kind="function" id="class_tx_reconciliation_tracker_1a553439bc6667ec9053705f586818847c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>uint64_t</type>
        <definition>uint64_t PreRegisterPeer</definition>
        <argsstring>(NodeId peer_id)</argsstring>
        <name>PreRegisterPeer</name>
        <qualifiedname>TxReconciliationTracker::PreRegisterPeer</qualifiedname>
        <param>
          <type><ref refid="net_8h_1aa637b11e18b77724b35db2229cd12788" kindref="member">NodeId</ref></type>
          <declname>peer_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Step 0. Generates initial part of the state (salt) required to reconcile txs with the peer. The salt is used for short ID computation required for txreconciliation. The function returns the salt. A peer can&apos;t participate in future txreconciliations without this call. This function must be called only once per peer. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/txreconciliation.h" line="68" column="14" bodyfile="src/node/txreconciliation.cpp" bodystart="151" bodyend="154"/>
      </memberdef>
      <memberdef kind="function" id="class_tx_reconciliation_tracker_1acb6f9d93f04205571b7f528ca6fd11ee" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="txreconciliation_8h_1a7a6f29933f8f0193e0b8289468a2337f" kindref="member">ReconciliationRegisterResult</ref></type>
        <definition>ReconciliationRegisterResult RegisterPeer</definition>
        <argsstring>(NodeId peer_id, bool is_peer_inbound, uint32_t peer_recon_version, uint64_t remote_salt)</argsstring>
        <name>RegisterPeer</name>
        <qualifiedname>TxReconciliationTracker::RegisterPeer</qualifiedname>
        <param>
          <type><ref refid="net_8h_1aa637b11e18b77724b35db2229cd12788" kindref="member">NodeId</ref></type>
          <declname>peer_id</declname>
        </param>
        <param>
          <type>bool</type>
          <declname>is_peer_inbound</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>peer_recon_version</declname>
        </param>
        <param>
          <type>uint64_t</type>
          <declname>remote_salt</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Step 0. Once the peer agreed to reconcile txs with us, generate the state required to track ongoing reconciliations. Must be called only after pre-registering the peer and only once. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/txreconciliation.h" line="74" column="34" bodyfile="src/node/txreconciliation.cpp" bodystart="156" bodyend="160"/>
      </memberdef>
      <memberdef kind="function" id="class_tx_reconciliation_tracker_1adb141a7aed273b229b773c503e5cc075" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void ForgetPeer</definition>
        <argsstring>(NodeId peer_id)</argsstring>
        <name>ForgetPeer</name>
        <qualifiedname>TxReconciliationTracker::ForgetPeer</qualifiedname>
        <param>
          <type><ref refid="net_8h_1aa637b11e18b77724b35db2229cd12788" kindref="member">NodeId</ref></type>
          <declname>peer_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Attempts to forget txreconciliation-related state of the peer (if we previously stored any). After this, we won&apos;t be able to reconcile transactions with the peer. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/txreconciliation.h" line="81" column="10" bodyfile="src/node/txreconciliation.cpp" bodystart="162" bodyend="165"/>
      </memberdef>
      <memberdef kind="function" id="class_tx_reconciliation_tracker_1aae67cea096486b6432b3ef0f74d01fbb" prot="public" static="no" const="yes" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>bool IsPeerRegistered</definition>
        <argsstring>(NodeId peer_id) const</argsstring>
        <name>IsPeerRegistered</name>
        <qualifiedname>TxReconciliationTracker::IsPeerRegistered</qualifiedname>
        <param>
          <type><ref refid="net_8h_1aa637b11e18b77724b35db2229cd12788" kindref="member">NodeId</ref></type>
          <declname>peer_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check if a peer is registered to reconcile transactions with us. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/txreconciliation.h" line="86" column="10" bodyfile="src/node/txreconciliation.cpp" bodystart="167" bodyend="170"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>Transaction reconciliation is a way for nodes to efficiently announce transactions. This object keeps track of all txreconciliation-related communications with the peers. The high-level protocol is:<orderedlist>
<listitem><para>Txreconciliation protocol handshake.</para>
</listitem><listitem><para>Once we receive a new transaction, add it to the set instead of announcing immediately.</para>
</listitem><listitem><para>At regular intervals, a txreconciliation initiator requests a sketch from a peer, where a sketch is a compressed representation of short form IDs of the transactions in their set.</para>
</listitem><listitem><para>Once the initiator received a sketch from the peer, the initiator computes a local sketch, and combines the two sketches to attempt finding the difference in <emphasis>sets</emphasis>. 4a. If the difference was not larger than estimated, see SUCCESS below. 4b. If the difference was larger than estimated, initial txreconciliation fails. The initiator requests a larger sketch via an extension round (allowed only once).<itemizedlist>
<listitem><para>If extension succeeds (a larger sketch is sufficient), see SUCCESS below.</para>
</listitem><listitem><para>If extension fails (a larger sketch is insufficient), see FAILURE below.</para>
</listitem></itemizedlist>
</para>
</listitem></orderedlist>
</para>
<para>SUCCESS. The initiator knows full symmetrical difference and can request what the initiator is missing and announce to the peer what the peer is missing.</para>
<para>FAILURE. The initiator notifies the peer about the failure and announces all transactions from the corresponding set. Once the peer received the failure notification, the peer announces all transactions from their set.</para>
<para>This is a modification of the Erlay protocol (<ulink url="https://arxiv.org/abs/1905.10518">https://arxiv.org/abs/1905.10518</ulink>) with two changes (sketch extensions instead of bisections, and an extra INV exchange round), both are motivated in BIP-330. </para>
    </detaileddescription>
    <location file="src/node/txreconciliation.h" line="51" column="1" bodyfile="src/node/txreconciliation.h" bodystart="52" bodyend="87"/>
    <listofallmembers>
      <member refid="class_tx_reconciliation_tracker_1adb141a7aed273b229b773c503e5cc075" prot="public" virt="non-virtual"><scope>TxReconciliationTracker</scope><name>ForgetPeer</name></member>
      <member refid="class_tx_reconciliation_tracker_1aae67cea096486b6432b3ef0f74d01fbb" prot="public" virt="non-virtual"><scope>TxReconciliationTracker</scope><name>IsPeerRegistered</name></member>
      <member refid="class_tx_reconciliation_tracker_1ad8dd7a6109ef0f18d5dc19f4edd29c31" prot="private" virt="non-virtual"><scope>TxReconciliationTracker</scope><name>m_impl</name></member>
      <member refid="class_tx_reconciliation_tracker_1a553439bc6667ec9053705f586818847c" prot="public" virt="non-virtual"><scope>TxReconciliationTracker</scope><name>PreRegisterPeer</name></member>
      <member refid="class_tx_reconciliation_tracker_1acb6f9d93f04205571b7f528ca6fd11ee" prot="public" virt="non-virtual"><scope>TxReconciliationTracker</scope><name>RegisterPeer</name></member>
      <member refid="class_tx_reconciliation_tracker_1aed6be0343a8cc41fc91f3b8f7317724c" prot="public" virt="non-virtual"><scope>TxReconciliationTracker</scope><name>TxReconciliationTracker</name></member>
      <member refid="class_tx_reconciliation_tracker_1a8b01adf9ae2ffdbb4879f1bd44b11ecd" prot="public" virt="non-virtual"><scope>TxReconciliationTracker</scope><name>~TxReconciliationTracker</name></member>
    </listofallmembers>
  </compounddef>
</doxygen>
