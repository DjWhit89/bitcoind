<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="txvalidationcache__tests_8cpp" kind="file" language="C++">
    <compoundname>txvalidationcache_tests.cpp</compoundname>
    <includes refid="consensus_2validation_8h" local="no">consensus/validation.h</includes>
    <includes refid="key_8h" local="no">key.h</includes>
    <includes local="no">random.h</includes>
    <includes refid="sigcache_8h" local="no">script/sigcache.h</includes>
    <includes refid="sign_8h" local="no">script/sign.h</includes>
    <includes refid="signingprovider_8h" local="no">script/signingprovider.h</includes>
    <includes refid="setup__common_8h" local="no">test/util/setup_common.h</includes>
    <includes local="no">txmempool.h</includes>
    <includes refid="chaintype_8h" local="no">util/chaintype.h</includes>
    <includes local="no">validation.h</includes>
    <includes local="no">boost/test/unit_test.hpp</includes>
    <incdepgraph>
      <node id="84">
        <label>addresstype.h</label>
        <link refid="addresstype_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="85" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="8">
        <label>attributes.h</label>
        <link refid="attributes_8h"/>
      </node>
      <node id="94">
        <label>common/args.h</label>
        <link refid="args_8h"/>
        <childnode refid="95" relation="include">
        </childnode>
        <childnode refid="103" relation="include">
        </childnode>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="116" relation="include">
        </childnode>
        <childnode refid="96" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="117" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="49" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="95">
        <label>common/settings.h</label>
        <link refid="common_2settings_8h"/>
        <childnode refid="96" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="45">
        <label>compat/assumptions.h</label>
        <link refid="compat_2assumptions_8h"/>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="14">
        <label>compat/byteswap.h</label>
        <link refid="byteswap_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="103">
        <label>compat/compat.h</label>
        <link refid="compat_8h"/>
        <childnode refid="104" relation="include">
        </childnode>
        <childnode refid="105" relation="include">
        </childnode>
        <childnode refid="106" relation="include">
        </childnode>
        <childnode refid="107" relation="include">
        </childnode>
        <childnode refid="108" relation="include">
        </childnode>
        <childnode refid="109" relation="include">
        </childnode>
        <childnode refid="110" relation="include">
        </childnode>
        <childnode refid="111" relation="include">
        </childnode>
        <childnode refid="112" relation="include">
        </childnode>
        <childnode refid="113" relation="include">
        </childnode>
        <childnode refid="114" relation="include">
        </childnode>
        <childnode refid="115" relation="include">
        </childnode>
      </node>
      <node id="13">
        <label>compat/endian.h</label>
        <link refid="endian_8h"/>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="9">
        <label>consensus/amount.h</label>
        <link refid="amount_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>consensus/consensus.h</label>
        <link refid="consensus_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>consensus/validation.h</label>
        <link refid="consensus_2validation_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
      </node>
      <node id="12">
        <label>crypto/common.h</label>
        <link refid="crypto_2common_8h"/>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
      </node>
      <node id="25">
        <label>crypto/hex_base.h</label>
        <link refid="hex__base_8h"/>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="59">
        <label>crypto/ripemd160.h</label>
        <link refid="ripemd160_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="60">
        <label>crypto/sha256.h</label>
        <link refid="sha256_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="78">
        <label>crypto/siphash.h</label>
        <link refid="siphash_8h"/>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
      </node>
      <node id="69">
        <label>cuckoocache.h</label>
        <link refid="cuckoocache_8h"/>
        <childnode refid="70" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="71" relation="include">
        </childnode>
        <childnode refid="72" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="58">
        <label>hash.h</label>
        <link refid="hash_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="60" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="118">
        <label>kernel/caches.h</label>
        <link refid="kernel_2caches_8h"/>
        <childnode refid="119" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
      </node>
      <node id="122">
        <label>kernel/context.h</label>
        <link refid="kernel_2context_8h"/>
      </node>
      <node id="55">
        <label>key.h</label>
        <link refid="key_8h"/>
        <childnode refid="56" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="56">
        <label>musig.h</label>
        <link refid="musig_8h"/>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="123">
        <label>node/caches.h</label>
        <link refid="node_2caches_8h"/>
        <childnode refid="118" relation="include">
        </childnode>
        <childnode refid="119" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="124">
        <label>node/context.h</label>
        <link refid="node_2context_8h"/>
        <childnode refid="71" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="92" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="91" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="42">
        <label>prevector.h</label>
        <link refid="prevector_8h"/>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="53">
        <label>primitives/block.h</label>
        <link refid="primitives_2block_8h"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="54" relation="include">
        </childnode>
      </node>
      <node id="7">
        <label>primitives/transaction.h</label>
        <link refid="primitives_2transaction_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="10">
        <label>primitives/transaction_identifier.h</label>
        <link refid="transaction__identifier_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
      </node>
      <node id="57">
        <label>pubkey.h</label>
        <link refid="pubkey_8h"/>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="73">
        <label>script/interpreter.h</label>
        <link refid="interpreter_8h"/>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="74" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="75" relation="include">
        </childnode>
        <childnode refid="76" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="82">
        <label>script/keyorigin.h</label>
        <link refid="keyorigin_8h"/>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="41">
        <label>script/script.h</label>
        <link refid="script_2script_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="75">
        <label>script/script_error.h</label>
        <link refid="script__error_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="68">
        <label>script/sigcache.h</label>
        <link refid="sigcache_8h"/>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="60" relation="include">
        </childnode>
        <childnode refid="69" relation="include">
        </childnode>
        <childnode refid="73" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="77" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="80">
        <label>script/sign.h</label>
        <link refid="sign_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="74" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="73" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="83" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
      </node>
      <node id="83">
        <label>script/signingprovider.h</label>
        <link refid="signingprovider_8h"/>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="55" relation="include">
        </childnode>
        <childnode refid="56" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="92" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="76">
        <label>script/verify_flags.h</label>
        <link refid="verify__flags_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="44">
        <label>serialize.h</label>
        <link refid="serialize_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="49" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="19">
        <label>span.h</label>
        <link refid="span_8h"/>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="61">
        <label>support/allocators/secure.h</label>
        <link refid="secure_8h"/>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="66" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="66">
        <label>support/cleanse.h</label>
        <link refid="cleanse_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="62">
        <label>support/lockedpool.h</label>
        <link refid="lockedpool_8h"/>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="65" relation="include">
        </childnode>
      </node>
      <node id="87">
        <label>sync.h</label>
        <link refid="sync_8h"/>
        <childnode refid="88" relation="include">
        </childnode>
        <childnode refid="89" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="90" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="91" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>src/test/txvalidationcache_tests.cpp</label>
        <link refid="txvalidationcache__tests_8cpp"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="55" relation="include">
        </childnode>
        <childnode refid="67" relation="include">
        </childnode>
        <childnode refid="68" relation="include">
        </childnode>
        <childnode refid="80" relation="include">
        </childnode>
        <childnode refid="83" relation="include">
        </childnode>
        <childnode refid="93" relation="include">
        </childnode>
        <childnode refid="130" relation="include">
        </childnode>
        <childnode refid="116" relation="include">
        </childnode>
        <childnode refid="131" relation="include">
        </childnode>
        <childnode refid="132" relation="include">
        </childnode>
      </node>
      <node id="125">
        <label>test/util/random.h</label>
        <link refid="test_2util_2random_8h"/>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="125" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="71" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="93">
        <label>test/util/setup_common.h</label>
        <link refid="setup__common_8h"/>
        <childnode refid="94" relation="include">
        </childnode>
        <childnode refid="118" relation="include">
        </childnode>
        <childnode refid="122" relation="include">
        </childnode>
        <childnode refid="55" relation="include">
        </childnode>
        <childnode refid="123" relation="include">
        </childnode>
        <childnode refid="124" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="102" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="125" relation="include">
        </childnode>
        <childnode refid="116" relation="include">
        </childnode>
        <childnode refid="85" relation="include">
        </childnode>
        <childnode refid="96" relation="include">
        </childnode>
        <childnode refid="126" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="128" relation="include">
        </childnode>
        <childnode refid="92" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="88">
        <label>threadsafety.h</label>
        <link refid="threadsafety_8h"/>
        <childnode refid="64" relation="include">
        </childnode>
      </node>
      <node id="97">
        <label>tinyformat.h</label>
        <link refid="tinyformat_8h"/>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="98" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
      </node>
      <node id="11">
        <label>uint256.h</label>
        <link refid="uint256_8h"/>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="119">
        <label>util/byte_units.h</label>
        <link refid="byte__units_8h"/>
        <childnode refid="120" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
      </node>
      <node id="116">
        <label>util/chaintype.h</label>
        <link refid="chaintype_8h"/>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="85">
        <label>util/check.h</label>
        <link refid="check_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="71" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="86" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="70">
        <label>util/fastrange.h</label>
        <link refid="fastrange_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="96">
        <label>util/fs.h</label>
        <link refid="fs_8h"/>
        <childnode refid="97" relation="include">
        </childnode>
        <childnode refid="99" relation="include">
        </childnode>
        <childnode refid="100" relation="include">
        </childnode>
        <childnode refid="92" relation="include">
        </childnode>
        <childnode refid="101" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="102" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="50">
        <label>util/hash_type.h</label>
        <link refid="hash__type_8h"/>
      </node>
      <node id="77">
        <label>util/hasher.h</label>
        <link refid="hasher_8h"/>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="78" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
      </node>
      <node id="89">
        <label>util/macros.h</label>
        <link refid="macros_8h"/>
      </node>
      <node id="120">
        <label>util/overflow.h</label>
        <link refid="overflow_8h"/>
        <childnode refid="121" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="126">
        <label>util/signalinterrupt.h</label>
        <link refid="signalinterrupt_8h"/>
        <childnode refid="127" relation="include">
        </childnode>
        <childnode refid="71" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="24">
        <label>util/strencodings.h</label>
        <link refid="strencodings_8h"/>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="26">
        <label>util/string.h</label>
        <link refid="string_8h"/>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="127">
        <label>util/tokenpipe.h</label>
        <link refid="tokenpipe_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="37">
        <label>util/types.h</label>
        <link refid="util_2types_8h"/>
      </node>
      <node id="128">
        <label>util/vector.h</label>
        <link refid="vector_8h"/>
        <childnode refid="92" relation="include">
        </childnode>
        <childnode refid="129" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="36">
        <label>algorithm</label>
      </node>
      <node id="104">
        <label>arpa/inet.h</label>
      </node>
      <node id="27">
        <label>array</label>
      </node>
      <node id="71">
        <label>atomic</label>
      </node>
      <node id="15">
        <label>bit</label>
      </node>
      <node id="132">
        <label>boost/test/unit_test.hpp</label>
      </node>
      <node id="20">
        <label>cassert</label>
      </node>
      <node id="115">
        <label>cerrno</label>
      </node>
      <node id="32">
        <label>charconv</label>
      </node>
      <node id="121">
        <label>climits</label>
      </node>
      <node id="72">
        <label>cmath</label>
      </node>
      <node id="81">
        <label>coins.h</label>
      </node>
      <node id="38">
        <label>compare</label>
      </node>
      <node id="16">
        <label>concepts</label>
      </node>
      <node id="90">
        <label>condition_variable</label>
      </node>
      <node id="17">
        <label>cstddef</label>
      </node>
      <node id="5">
        <label>cstdint</label>
      </node>
      <node id="99">
        <label>cstdio</label>
      </node>
      <node id="6">
        <label>cstdlib</label>
      </node>
      <node id="18">
        <label>cstring</label>
      </node>
      <node id="105">
        <label>fcntl.h</label>
      </node>
      <node id="100">
        <label>filesystem</label>
      </node>
      <node id="92">
        <label>functional</label>
      </node>
      <node id="74">
        <label>hash.h</label>
      </node>
      <node id="129">
        <label>initializer_list</label>
      </node>
      <node id="101">
        <label>iomanip</label>
      </node>
      <node id="46">
        <label>ios</label>
      </node>
      <node id="117">
        <label>iosfwd</label>
      </node>
      <node id="98">
        <label>iostream</label>
      </node>
      <node id="43">
        <label>iterator</label>
      </node>
      <node id="33">
        <label>limits</label>
      </node>
      <node id="63">
        <label>list</label>
      </node>
      <node id="28">
        <label>locale</label>
      </node>
      <node id="47">
        <label>map</label>
      </node>
      <node id="48">
        <label>memory</label>
      </node>
      <node id="64">
        <label>mutex</label>
      </node>
      <node id="106">
        <label>net/if.h</label>
      </node>
      <node id="107">
        <label>netdb.h</label>
      </node>
      <node id="108">
        <label>netinet/in.h</label>
      </node>
      <node id="109">
        <label>netinet/tcp.h</label>
      </node>
      <node id="52">
        <label>numeric</label>
      </node>
      <node id="34">
        <label>optional</label>
      </node>
      <node id="102">
        <label>ostream</label>
      </node>
      <node id="67">
        <label>random.h</label>
      </node>
      <node id="49">
        <label>set</label>
      </node>
      <node id="79">
        <label>shared_mutex</label>
      </node>
      <node id="86">
        <label>source_location</label>
      </node>
      <node id="21">
        <label>span</label>
      </node>
      <node id="29">
        <label>sstream</label>
      </node>
      <node id="51">
        <label>stdexcept</label>
      </node>
      <node id="3">
        <label>string</label>
      </node>
      <node id="30">
        <label>string_view</label>
      </node>
      <node id="110">
        <label>sys/mman.h</label>
      </node>
      <node id="111">
        <label>sys/select.h</label>
      </node>
      <node id="112">
        <label>sys/socket.h</label>
      </node>
      <node id="113">
        <label>sys/types.h</label>
      </node>
      <node id="35">
        <label>system_error</label>
      </node>
      <node id="91">
        <label>thread</label>
      </node>
      <node id="39">
        <label>tuple</label>
      </node>
      <node id="130">
        <label>txmempool.h</label>
      </node>
      <node id="22">
        <label>type_traits</label>
      </node>
      <node id="114">
        <label>unistd.h</label>
      </node>
      <node id="65">
        <label>unordered_map</label>
      </node>
      <node id="54">
        <label>util/time.h</label>
      </node>
      <node id="23">
        <label>utility</label>
      </node>
      <node id="131">
        <label>validation.h</label>
      </node>
      <node id="40">
        <label>variant</label>
      </node>
      <node id="31">
        <label>vector</label>
      </node>
    </incdepgraph>
    <innerclass refid="struct_dersig100_setup" prot="public">Dersig100Setup</innerclass>
    <sectiondef kind="func">
      <memberdef kind="function" id="txvalidationcache__tests_8cpp_1a97d6169ac38d1dc06811732fda310b8c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>bool CheckInputScripts</definition>
        <argsstring>(const CTransaction &amp;tx, TxValidationState &amp;state, const CCoinsViewCache &amp;inputs, script_verify_flags flags, bool cacheSigStore, bool cacheFullScriptStore, PrecomputedTransactionData &amp;txdata, ValidationCache &amp;validation_cache, std::vector&lt; CScriptCheck &gt; *pvChecks) EXCLUSIVE_LOCKS_REQUIRED(cs_main)</argsstring>
        <name>CheckInputScripts</name>
        <param>
          <type>const <ref refid="class_c_transaction" kindref="compound">CTransaction</ref> &amp;</type>
          <declname>tx</declname>
        </param>
        <param>
          <type><ref refid="class_tx_validation_state" kindref="compound">TxValidationState</ref> &amp;</type>
          <declname>state</declname>
        </param>
        <param>
          <type>const <ref refid="class_c_coins_view_cache" kindref="compound">CCoinsViewCache</ref> &amp;</type>
          <declname>inputs</declname>
        </param>
        <param>
          <type><ref refid="classscript__verify__flags" kindref="compound">script_verify_flags</ref></type>
          <declname>flags</declname>
        </param>
        <param>
          <type>bool</type>
          <declname>cacheSigStore</declname>
        </param>
        <param>
          <type>bool</type>
          <declname>cacheFullScriptStore</declname>
        </param>
        <param>
          <type><ref refid="struct_precomputed_transaction_data" kindref="compound">PrecomputedTransactionData</ref> &amp;</type>
          <declname>txdata</declname>
        </param>
        <param>
          <type><ref refid="class_validation_cache" kindref="compound">ValidationCache</ref> &amp;</type>
          <declname>validation_cache</declname>
        </param>
        <param>
          <type>std::vector&lt; <ref refid="class_c_script_check" kindref="compound">CScriptCheck</ref> &gt; *</type>
          <declname>pvChecks</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check whether all of this transaction&apos;s input scripts succeed.</para>
<para>This involves ECDSA signature checks so can be computationally intensive. This function should only be called after the cheap sanity checks in CheckTxInputs passed.</para>
<para>If pvChecks is not nullptr, script checks are pushed onto it instead of being performed inline. Any script checks which are not necessary (eg due to script execution cache hits) are, obviously, not pushed onto pvChecks/run.</para>
<para>Setting cacheSigStore/cacheFullScriptStore to false will remove elements from the corresponding cache which are matched. This is useful for checking blocks where we will likely never need the cache entry again.</para>
<para>Note that we may set state.reason to NOT_STANDARD for extra soft-fork flags in flags, block-checking callers should probably reset it to CONSENSUS in such cases.</para>
<para>Non-static (and redeclared) in <ref refid="txvalidationcache__tests_8cpp" kindref="compound">src/test/txvalidationcache_tests.cpp</ref> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/test/txvalidationcache_tests.cpp" line="23" column="6" bodyfile="src/validation.cpp" bodystart="2102" bodyend="2175" declfile="src/test/txvalidationcache_tests.cpp" declline="23" declcolumn="6"/>
      </memberdef>
      <memberdef kind="function" id="txvalidationcache__tests_8cpp_1a0ad149e00d827fbbe731dde7852fe4c8" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>BOOST_FIXTURE_TEST_CASE</definition>
        <argsstring>(tx_mempool_block_doublespend, Dersig100Setup)</argsstring>
        <name>BOOST_FIXTURE_TEST_CASE</name>
        <param>
          <type>tx_mempool_block_doublespend</type>
        </param>
        <param>
          <type><ref refid="struct_dersig100_setup" kindref="compound">Dersig100Setup</ref></type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/test/txvalidationcache_tests.cpp" line="31" column="1" bodyfile="src/test/txvalidationcache_tests.cpp" bodystart="31" bodyend="110"/>
      </memberdef>
      <memberdef kind="function" id="txvalidationcache__tests_8cpp_1a057f751bdc145cea5be6c0c3fae03f07" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void ValidateCheckInputsForAllFlags</definition>
        <argsstring>(const CTransaction &amp;tx, script_verify_flags failing_flags, bool add_to_cache, CCoinsViewCache &amp;active_coins_tip, ValidationCache &amp;validation_cache) EXCLUSIVE_LOCKS_REQUIRED(</argsstring>
        <name>ValidateCheckInputsForAllFlags</name>
        <param>
          <type>const <ref refid="class_c_transaction" kindref="compound">CTransaction</ref> &amp;</type>
          <declname>tx</declname>
        </param>
        <param>
          <type><ref refid="classscript__verify__flags" kindref="compound">script_verify_flags</ref></type>
          <declname>failing_flags</declname>
        </param>
        <param>
          <type>bool</type>
          <declname>add_to_cache</declname>
        </param>
        <param>
          <type><ref refid="class_c_coins_view_cache" kindref="compound">CCoinsViewCache</ref> &amp;</type>
          <declname>active_coins_tip</declname>
        </param>
        <param>
          <type><ref refid="class_validation_cache" kindref="compound">ValidationCache</ref> &amp;</type>
          <declname>validation_cache</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/test/txvalidationcache_tests.cpp" line="123" column="13" bodyfile="src/test/txvalidationcache_tests.cpp" bodystart="123" bodyend="165"/>
      </memberdef>
      <memberdef kind="function" id="txvalidationcache__tests_8cpp_1a0cede32905e27934cd347c1455ae477b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>BOOST_FIXTURE_TEST_CASE</definition>
        <argsstring>(checkinputs_test, Dersig100Setup)</argsstring>
        <name>BOOST_FIXTURE_TEST_CASE</name>
        <param>
          <type>checkinputs_test</type>
        </param>
        <param>
          <type><ref refid="struct_dersig100_setup" kindref="compound">Dersig100Setup</ref></type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/test/txvalidationcache_tests.cpp" line="167" column="1" bodyfile="src/test/txvalidationcache_tests.cpp" bodystart="167" bodyend="386"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2011-present<sp/>The<sp/>Bitcoin<sp/>Core<sp/>developers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Distributed<sp/>under<sp/>the<sp/>MIT<sp/>software<sp/>license,<sp/>see<sp/>the<sp/>accompanying</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">//<sp/>file<sp/>COPYING<sp/>or<sp/>http://www.opensource.org/licenses/mit-license.php.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="consensus_2validation_8h" kindref="compound">consensus/validation.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="key_8h" kindref="compound">key.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;random.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="sigcache_8h" kindref="compound">script/sigcache.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="sign_8h" kindref="compound">script/sign.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="signingprovider_8h" kindref="compound">script/signingprovider.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="setup__common_8h" kindref="compound">test/util/setup_common.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;txmempool.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="chaintype_8h" kindref="compound">util/chaintype.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="validation_8h" kindref="compound">validation.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;boost/test/unit_test.hpp&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight></codeline>
<codeline lineno="18" refid="struct_dersig100_setup" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="struct_dersig100_setup_1a56cdafa8f118cf0a1f35f1a3aa8734a3" kindref="member">Dersig100Setup</ref><sp/>:<sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="struct_test_chain100_setup_1a2ce135e2fe297137a4dc423261ac6271" kindref="member">TestChain100Setup</ref><sp/>{</highlight></codeline>
<codeline lineno="19"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_dersig100_setup_1a56cdafa8f118cf0a1f35f1a3aa8734a3" kindref="member">Dersig100Setup</ref>()</highlight></codeline>
<codeline lineno="20"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/><ref refid="struct_test_chain100_setup_1a2ce135e2fe297137a4dc423261ac6271" kindref="member">TestChain100Setup</ref>{<ref refid="chaintype_8h_1a697252c7d3bf770f98b0fa46f338d5a7ad10d9759c6b71ea71a78e3a55bafc4d5" kindref="member">ChainType::REGTEST</ref>,<sp/>{.extra_args<sp/>=<sp/>{</highlight><highlight class="stringliteral">&quot;-testactivationheight=dersig@102&quot;</highlight><highlight class="normal">}}}<sp/>{}</highlight></codeline>
<codeline lineno="21"><highlight class="normal">};</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="txvalidationcache__tests_8cpp_1a97d6169ac38d1dc06811732fda310b8c" kindref="member">CheckInputScripts</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_transaction" kindref="compound">CTransaction</ref>&amp;<sp/>tx,<sp/><ref refid="class_tx_validation_state" kindref="compound">TxValidationState</ref>&amp;<sp/>state,</highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache" kindref="compound">CCoinsViewCache</ref>&amp;<sp/>inputs,<sp/><ref refid="classscript__verify__flags" kindref="compound">script_verify_flags</ref><sp/><ref refid="bitcoin-tx_8cpp_1ac8bf36fe0577cba66bccda3a6f7e80a4" kindref="member">flags</ref>,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>cacheSigStore,</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>cacheFullScriptStore,<sp/><ref refid="struct_precomputed_transaction_data" kindref="compound">PrecomputedTransactionData</ref>&amp;<sp/>txdata,</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_validation_cache" kindref="compound">ValidationCache</ref>&amp;<sp/>validation_cache,</highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;CScriptCheck&gt;*<sp/>pvChecks)<sp/><ref refid="thread__annotations_8h_1a0e2e86b0f11d9778240b0a0b263047b1" kindref="member">EXCLUSIVE_LOCKS_REQUIRED</ref>(<ref refid="cs__main_8cpp_1ab88a4b9173207cf250ece7820db1f36d" kindref="member">cs_main</ref>);</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal">BOOST_AUTO_TEST_SUITE(txvalidationcache_tests)</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"><ref refid="txvalidationcache__tests_8cpp_1a0ad149e00d827fbbe731dde7852fe4c8" kindref="member">BOOST_FIXTURE_TEST_CASE</ref>(tx_mempool_block_doublespend,<sp/><ref refid="struct_dersig100_setup" kindref="compound">Dersig100Setup</ref>)</highlight></codeline>
<codeline lineno="32"><highlight class="normal">{</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>sure<sp/>skipping<sp/>validation<sp/>of<sp/>transactions<sp/>that<sp/>were</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>validated<sp/>going<sp/>into<sp/>the<sp/>memory<sp/>pool<sp/>does<sp/>not<sp/>allow</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>double-spends<sp/>in<sp/>blocks<sp/>to<sp/>pass<sp/>validation<sp/>when<sp/>they<sp/>should<sp/>not.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_script" kindref="compound">CScript</ref><sp/>scriptPubKey<sp/>=<sp/><ref refid="class_c_script" kindref="compound">CScript</ref>()<sp/>&lt;&lt;<sp/><sp/><ref refid="script_2script_8h_1adb3d23f17cd1c3d543c096c67489a738" kindref="member">ToByteVector</ref>(coinbaseKey.GetPubKey())<sp/>&lt;&lt;<sp/><ref refid="script_2script_8h_1a63e349a6089a54da9fe09a3d858648bda2c190c5caf052f92d3d9ac31a0d96151" kindref="member">OP_CHECKSIG</ref>;</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>ToMemPool<sp/>=<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_c_mutable_transaction" kindref="compound">CMutableTransaction</ref>&amp;<sp/>tx)<sp/>{</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(<ref refid="cs__main_8cpp_1ab88a4b9173207cf250ece7820db1f36d" kindref="member">cs_main</ref>);</highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_mempool_accept_result" kindref="compound">MempoolAcceptResult</ref><sp/>result<sp/>=<sp/>m_node.chainman-&gt;ProcessTransaction(MakeTransactionRef(tx));</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result.<ref refid="struct_mempool_accept_result_1af8017e4319a28c0cac9c61662b1d7565" kindref="member">m_result_type</ref><sp/>==<sp/><ref refid="struct_mempool_accept_result_1aa71b5fc2a82d29a91db3a734ff892a49ac9f1a6384b1c466d4612f513bd8e13ea" kindref="member">MempoolAcceptResult::ResultType::VALID</ref>;</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>a<sp/>double-spend<sp/>of<sp/>mature<sp/>coinbase<sp/>txn:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;CMutableTransaction&gt;<sp/>spends;</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/>spends.resize(2);</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2;<sp/>i++)</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>spends[i].version<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>spends[i].vin.resize(1);</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>spends[i].vin[0].prevout.hash<sp/>=<sp/>m_coinbase_txns[0]-&gt;GetHash();</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>spends[i].vin[0].prevout.n<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>spends[i].vout.resize(1);</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>spends[i].vout[0].nValue<sp/>=<sp/>11*CENT;</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>spends[i].vout[0].scriptPubKey<sp/>=<sp/>scriptPubKey;</highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Sign:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;unsigned<sp/>char&gt;<sp/>vchSig;</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classuint256" kindref="compound">uint256</ref><sp/>hash<sp/>=<sp/><ref refid="interpreter_8cpp_1a63c4884dd720c4d306603998b5d02b49" kindref="member">SignatureHash</ref>(scriptPubKey,<sp/>spends[i],<sp/>0,<sp/><ref refid="interpreter_8h_1aad9879e99a65218a36881f0bc8713fcdac68c7df6528b3001624e56b2de3826de" kindref="member">SIGHASH_ALL</ref>,<sp/>0,<sp/><ref refid="interpreter_8h_1a3db3199560fd5419a3be2fcd88a28f8fae7b1a5c82772e0e055096008cb9883ef" kindref="member">SigVersion::BASE</ref>);</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(coinbaseKey.Sign(hash,<sp/>vchSig));</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vchSig.push_back((</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">)<ref refid="interpreter_8h_1aad9879e99a65218a36881f0bc8713fcdac68c7df6528b3001624e56b2de3826de" kindref="member">SIGHASH_ALL</ref>);</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>spends[i].vin[0].scriptSig<sp/>&lt;&lt;<sp/>vchSig;</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_block" kindref="compound">CBlock</ref><sp/>block;</highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Test<sp/>1:<sp/>block<sp/>with<sp/>both<sp/>of<sp/>those<sp/>transactions<sp/>should<sp/>be<sp/>rejected.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/>block<sp/>=<sp/>CreateAndProcessBlock(spends,<sp/>scriptPubKey);</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(<ref refid="cs__main_8cpp_1ab88a4b9173207cf250ece7820db1f36d" kindref="member">cs_main</ref>);</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(m_node.chainman-&gt;ActiveChain().Tip()-&gt;GetBlockHash()<sp/>!=<sp/>block.<ref refid="class_c_block_header_1a6df30b63c4634d52dfeaadb46d60d0f5" kindref="member">GetHash</ref>());</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Test<sp/>2:<sp/>...<sp/>and<sp/>should<sp/>be<sp/>rejected<sp/>if<sp/>spend1<sp/>is<sp/>in<sp/>the<sp/>memory<sp/>pool</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(ToMemPool(spends[0]));</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/>block<sp/>=<sp/>CreateAndProcessBlock(spends,<sp/>scriptPubKey);</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(<ref refid="cs__main_8cpp_1ab88a4b9173207cf250ece7820db1f36d" kindref="member">cs_main</ref>);</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(m_node.chainman-&gt;ActiveChain().Tip()-&gt;GetBlockHash()<sp/>!=<sp/>block.<ref refid="class_c_block_header_1a6df30b63c4634d52dfeaadb46d60d0f5" kindref="member">GetHash</ref>());</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(m_node.mempool-&gt;size(),<sp/>1U);</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sync_8h_1ab3029e545f54f330170cbf37f0819693" kindref="member">WITH_LOCK</ref>(m_node.mempool-&gt;cs,<sp/>m_node.mempool-&gt;removeRecursive(<ref refid="class_c_transaction" kindref="compound">CTransaction</ref>{spends[0]},<sp/><ref refid="mempool__removal__reason_8h_1a2bc6653552b5871101b6cbefdbaf251faddbe277f267f119df2ef18a8fe3364ae" kindref="member">MemPoolRemovalReason::CONFLICT</ref>));</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(m_node.mempool-&gt;size(),<sp/>0U);</highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Test<sp/>3:<sp/>...<sp/>and<sp/>should<sp/>be<sp/>rejected<sp/>if<sp/>spend2<sp/>is<sp/>in<sp/>the<sp/>memory<sp/>pool</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(ToMemPool(spends[1]));</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/>block<sp/>=<sp/>CreateAndProcessBlock(spends,<sp/>scriptPubKey);</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(<ref refid="cs__main_8cpp_1ab88a4b9173207cf250ece7820db1f36d" kindref="member">cs_main</ref>);</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(m_node.chainman-&gt;ActiveChain().Tip()-&gt;GetBlockHash()<sp/>!=<sp/>block.<ref refid="class_c_block_header_1a6df30b63c4634d52dfeaadb46d60d0f5" kindref="member">GetHash</ref>());</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(m_node.mempool-&gt;size(),<sp/>1U);</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sync_8h_1ab3029e545f54f330170cbf37f0819693" kindref="member">WITH_LOCK</ref>(m_node.mempool-&gt;cs,<sp/>m_node.mempool-&gt;removeRecursive(<ref refid="class_c_transaction" kindref="compound">CTransaction</ref>{spends[1]},<sp/><ref refid="mempool__removal__reason_8h_1a2bc6653552b5871101b6cbefdbaf251faddbe277f267f119df2ef18a8fe3364ae" kindref="member">MemPoolRemovalReason::CONFLICT</ref>));</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(m_node.mempool-&gt;size(),<sp/>0U);</highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Final<sp/>sanity<sp/>test:<sp/>first<sp/>spend<sp/>in<sp/>*m_node.mempool,<sp/>second<sp/>in<sp/>block,<sp/>that&apos;s<sp/>OK:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;CMutableTransaction&gt;<sp/>oneSpend;</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/>oneSpend.push_back(spends[0]);</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(ToMemPool(spends[1]));</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/>block<sp/>=<sp/>CreateAndProcessBlock(oneSpend,<sp/>scriptPubKey);</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(<ref refid="cs__main_8cpp_1ab88a4b9173207cf250ece7820db1f36d" kindref="member">cs_main</ref>);</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(m_node.chainman-&gt;ActiveChain().Tip()-&gt;GetBlockHash()<sp/>==<sp/>block.<ref refid="class_c_block_header_1a6df30b63c4634d52dfeaadb46d60d0f5" kindref="member">GetHash</ref>());</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>spends[1]<sp/>should<sp/>have<sp/>been<sp/>removed<sp/>from<sp/>the<sp/>mempool<sp/>when<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>block<sp/>with<sp/>spends[0]<sp/>is<sp/>accepted:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(m_node.mempool-&gt;size(),<sp/>0U);</highlight></codeline>
<codeline lineno="110"><highlight class="normal">}</highlight></codeline>
<codeline lineno="111"><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Run<sp/>CheckInputScripts<sp/>(using<sp/>CoinsTip())<sp/>on<sp/>the<sp/>given<sp/>transaction,<sp/>for<sp/>all<sp/>script</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight><highlight class="comment">//<sp/>flags.<sp/><sp/>Test<sp/>that<sp/>CheckInputScripts<sp/>passes<sp/>for<sp/>all<sp/>flags<sp/>that<sp/>don&apos;t<sp/>overlap<sp/>with</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"></highlight><highlight class="comment">//<sp/>the<sp/>failing_flags<sp/>argument,<sp/>but<sp/>otherwise<sp/>fails.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight><highlight class="comment">//<sp/>CHECKLOCKTIMEVERIFY<sp/>and<sp/>CHECKSEQUENCEVERIFY<sp/>(and<sp/>future<sp/>NOP<sp/>codes<sp/>that<sp/>may</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight><highlight class="comment">//<sp/>get<sp/>reassigned)<sp/>have<sp/>an<sp/>interaction<sp/>with<sp/>DISCOURAGE_UPGRADABLE_NOPS:<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"></highlight><highlight class="comment">//<sp/>the<sp/>script<sp/>flags<sp/>used<sp/>contain<sp/>DISCOURAGE_UPGRADABLE_NOPS<sp/>but<sp/>don&apos;t<sp/>contain</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight><highlight class="comment">//<sp/>CHECKLOCKTIMEVERIFY<sp/>(or<sp/>CHECKSEQUENCEVERIFY),<sp/>but<sp/>the<sp/>script<sp/>does<sp/>contain</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"></highlight><highlight class="comment">//<sp/>OP_CHECKLOCKTIMEVERIFY<sp/>(or<sp/>OP_CHECKSEQUENCEVERIFY),<sp/>then<sp/>script<sp/>execution</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight><highlight class="comment">//<sp/>should<sp/>fail.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Capture<sp/>this<sp/>interaction<sp/>with<sp/>the<sp/>upgraded_nop<sp/>argument:<sp/>set<sp/>it<sp/>when<sp/>evaluating</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight><highlight class="comment">//<sp/>any<sp/>script<sp/>flag<sp/>that<sp/>is<sp/>implemented<sp/>as<sp/>an<sp/>upgraded<sp/>NOP<sp/>code.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>ValidateCheckInputsForAllFlags(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_transaction" kindref="compound">CTransaction</ref><sp/>&amp;tx,<sp/><ref refid="classscript__verify__flags" kindref="compound">script_verify_flags</ref><sp/>failing_flags,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>add_to_cache,<sp/><ref refid="class_c_coins_view_cache" kindref="compound">CCoinsViewCache</ref>&amp;<sp/>active_coins_tip,<sp/><ref refid="class_validation_cache" kindref="compound">ValidationCache</ref>&amp;<sp/>validation_cache)<sp/><ref refid="thread__annotations_8h_1a0e2e86b0f11d9778240b0a0b263047b1" kindref="member">EXCLUSIVE_LOCKS_REQUIRED</ref>(<ref refid="cs__main_8cpp_1ab88a4b9173207cf250ece7820db1f36d" kindref="member">::cs_main</ref>)</highlight></codeline>
<codeline lineno="124"><highlight class="normal">{</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_precomputed_transaction_data" kindref="compound">PrecomputedTransactionData</ref><sp/>txdata;</highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_fast_random_context" kindref="compound">FastRandomContext</ref><sp/>insecure_rand(</highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="128"><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>count<sp/>=<sp/>0;<sp/>count<sp/>&lt;<sp/>10000;<sp/>++count)<sp/>{</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_tx_validation_state" kindref="compound">TxValidationState</ref><sp/>state;</highlight></codeline>
<codeline lineno="131"><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Randomly<sp/>selects<sp/>flag<sp/>combinations</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classscript__verify__flags" kindref="compound">script_verify_flags</ref><sp/>test_flags<sp/>=<sp/><ref refid="classscript__verify__flags_1a3746f860da94848252a66b95e8c7965c" kindref="member">script_verify_flags::from_int</ref>(insecure_rand.randrange(MAX_SCRIPT_VERIFY_FLAGS));</highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Filter<sp/>out<sp/>incompatible<sp/>flag<sp/>choices</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((test_flags<sp/>&amp;<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637a2baa4c539864504eb80c2b2df0f6fb29" kindref="member">SCRIPT_VERIFY_CLEANSTACK</ref>))<sp/>{</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>CLEANSTACK<sp/>requires<sp/>P2SH<sp/>and<sp/>WITNESS,<sp/>see<sp/>VerifyScript()<sp/>in</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>script/interpreter.cpp</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>test_flags<sp/>|=<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637aeb9561bbd06f9c457e9a44535a261134" kindref="member">SCRIPT_VERIFY_P2SH</ref><sp/>|<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637a41693a201df8f796c932d407b22da9b2" kindref="member">SCRIPT_VERIFY_WITNESS</ref>;</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((test_flags<sp/>&amp;<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637a41693a201df8f796c932d407b22da9b2" kindref="member">SCRIPT_VERIFY_WITNESS</ref>))<sp/>{</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>WITNESS<sp/>requires<sp/>P2SH</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>test_flags<sp/>|=<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637aeb9561bbd06f9c457e9a44535a261134" kindref="member">SCRIPT_VERIFY_P2SH</ref>;</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="txvalidationcache__tests_8cpp_1a97d6169ac38d1dc06811732fda310b8c" kindref="member">CheckInputScripts</ref>(tx,<sp/>state,<sp/>&amp;active_coins_tip,<sp/>test_flags,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>add_to_cache,<sp/>txdata,<sp/>validation_cache,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>CheckInputScripts<sp/>should<sp/>succeed<sp/>iff<sp/>test_flags<sp/>doesn&apos;t<sp/>intersect<sp/>with</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>failing_flags</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>expected_return_value<sp/>=<sp/>!(test_flags<sp/>&amp;<sp/>failing_flags);</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>,<sp/>expected_return_value);</highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Test<sp/>the<sp/>caching</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>&amp;&amp;<sp/>add_to_cache)<sp/>{</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>we<sp/>get<sp/>a<sp/>cache<sp/>hit<sp/>if<sp/>the<sp/>tx<sp/>was<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;CScriptCheck&gt;<sp/>scriptchecks;</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(<ref refid="txvalidationcache__tests_8cpp_1a97d6169ac38d1dc06811732fda310b8c" kindref="member">CheckInputScripts</ref>(tx,<sp/>state,<sp/>&amp;active_coins_tip,<sp/>test_flags,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>add_to_cache,<sp/>txdata,<sp/>validation_cache,<sp/>&amp;scriptchecks));</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(scriptchecks.empty());</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>we<sp/>get<sp/>script<sp/>executions<sp/>to<sp/>check,<sp/>if<sp/>the<sp/>transaction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>was<sp/>invalid,<sp/>or<sp/>we<sp/>didn&apos;t<sp/>add<sp/>to<sp/>cache.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;CScriptCheck&gt;<sp/>scriptchecks;</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(<ref refid="txvalidationcache__tests_8cpp_1a97d6169ac38d1dc06811732fda310b8c" kindref="member">CheckInputScripts</ref>(tx,<sp/>state,<sp/>&amp;active_coins_tip,<sp/>test_flags,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>add_to_cache,<sp/>txdata,<sp/>validation_cache,<sp/>&amp;scriptchecks));</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(scriptchecks.size(),<sp/>tx.vin.size());</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="165"><highlight class="normal">}</highlight></codeline>
<codeline lineno="166"><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"><ref refid="txvalidationcache__tests_8cpp_1a0ad149e00d827fbbe731dde7852fe4c8" kindref="member">BOOST_FIXTURE_TEST_CASE</ref>(checkinputs_test,<sp/><ref refid="struct_dersig100_setup" kindref="compound">Dersig100Setup</ref>)</highlight></codeline>
<codeline lineno="168"><highlight class="normal">{</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Test<sp/>that<sp/>passing<sp/>CheckInputScripts<sp/>with<sp/>one<sp/>set<sp/>of<sp/>script<sp/>flags<sp/>doesn&apos;t<sp/>imply</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>that<sp/>we<sp/>would<sp/>pass<sp/>again<sp/>with<sp/>a<sp/>different<sp/>set<sp/>of<sp/>flags.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_script" kindref="compound">CScript</ref><sp/>p2pk_scriptPubKey<sp/>=<sp/><ref refid="class_c_script" kindref="compound">CScript</ref>()<sp/>&lt;&lt;<sp/><ref refid="script_2script_8h_1adb3d23f17cd1c3d543c096c67489a738" kindref="member">ToByteVector</ref>(coinbaseKey.GetPubKey())<sp/>&lt;&lt;<sp/><ref refid="script_2script_8h_1a63e349a6089a54da9fe09a3d858648bda2c190c5caf052f92d3d9ac31a0d96151" kindref="member">OP_CHECKSIG</ref>;</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_script" kindref="compound">CScript</ref><sp/>p2sh_scriptPubKey<sp/>=<sp/><ref refid="addresstype_8cpp_1ae40f28d3b46c21033f6ee1f1200d0321" kindref="member">GetScriptForDestination</ref>(<ref refid="struct_script_hash" kindref="compound">ScriptHash</ref>(p2pk_scriptPubKey));</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_script" kindref="compound">CScript</ref><sp/>p2pkh_scriptPubKey<sp/>=<sp/><ref refid="addresstype_8cpp_1ae40f28d3b46c21033f6ee1f1200d0321" kindref="member">GetScriptForDestination</ref>(<ref refid="struct_p_k_hash" kindref="compound">PKHash</ref>(coinbaseKey.GetPubKey()));</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_script" kindref="compound">CScript</ref><sp/>p2wpkh_scriptPubKey<sp/>=<sp/><ref refid="addresstype_8cpp_1ae40f28d3b46c21033f6ee1f1200d0321" kindref="member">GetScriptForDestination</ref>(<ref refid="struct_witness_v0_key_hash" kindref="compound">WitnessV0KeyHash</ref>(coinbaseKey.GetPubKey()));</highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_fillable_signing_provider" kindref="compound">FillableSigningProvider</ref><sp/>keystore;</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(keystore.<ref refid="class_fillable_signing_provider_1a82103fc85f16d100da2455121901aba7" kindref="member">AddKey</ref>(coinbaseKey));</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(keystore.<ref refid="class_fillable_signing_provider_1a8257be7589bc86beab11d5237e957d4b" kindref="member">AddCScript</ref>(p2pk_scriptPubKey));</highlight></codeline>
<codeline lineno="179"><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>flags<sp/>to<sp/>test:<sp/>SCRIPT_VERIFY_CHECKLOCKTIMEVERIFY,<sp/>SCRIPT_VERIFY_CHECKSEQUENCE_VERIFY,<sp/>SCRIPT_VERIFY_NULLDUMMY,<sp/>uncompressed<sp/>pubkey<sp/>thing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>2<sp/>outputs<sp/>that<sp/>match<sp/>the<sp/>three<sp/>scripts<sp/>above,<sp/>spending<sp/>the<sp/>first</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>coinbase<sp/>tx.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_c_mutable_transaction" kindref="compound">CMutableTransaction</ref><sp/>spend_tx;</highlight></codeline>
<codeline lineno="185"><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1acd99bb05ca015e7d74448acb1deba7ca" kindref="member">version</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>.resize(1);</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].prevout.hash<sp/>=<sp/>m_coinbase_txns[0]-&gt;GetHash();</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].prevout.n<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>.resize(4);</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[0].nValue<sp/>=<sp/>11*CENT;</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[0].scriptPubKey<sp/>=<sp/>p2sh_scriptPubKey;</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[1].nValue<sp/>=<sp/>11*CENT;</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[1].scriptPubKey<sp/>=<sp/>p2wpkh_scriptPubKey;</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[2].nValue<sp/>=<sp/>11*CENT;</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[2].scriptPubKey<sp/>=<sp/><ref refid="class_c_script" kindref="compound">CScript</ref>()<sp/>&lt;&lt;<sp/><ref refid="script_2script_8h_1a63e349a6089a54da9fe09a3d858648bda2db159d3bf6031bf6413728f3d1a74e3" kindref="member">OP_CHECKLOCKTIMEVERIFY</ref><sp/>&lt;&lt;<sp/><ref refid="script_2script_8h_1a63e349a6089a54da9fe09a3d858648bdaa0d82e656d9819fdce32a9e04fad124a" kindref="member">OP_DROP</ref><sp/>&lt;&lt;<sp/><ref refid="script_2script_8h_1adb3d23f17cd1c3d543c096c67489a738" kindref="member">ToByteVector</ref>(coinbaseKey.GetPubKey())<sp/>&lt;&lt;<sp/><ref refid="script_2script_8h_1a63e349a6089a54da9fe09a3d858648bda2c190c5caf052f92d3d9ac31a0d96151" kindref="member">OP_CHECKSIG</ref>;</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[3].nValue<sp/>=<sp/>11*CENT;</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[3].scriptPubKey<sp/>=<sp/><ref refid="class_c_script" kindref="compound">CScript</ref>()<sp/>&lt;&lt;<sp/><ref refid="script_2script_8h_1a63e349a6089a54da9fe09a3d858648bdaff2d931584100152c5a1af8c875c3cb6" kindref="member">OP_CHECKSEQUENCEVERIFY</ref><sp/>&lt;&lt;<sp/><ref refid="script_2script_8h_1a63e349a6089a54da9fe09a3d858648bdaa0d82e656d9819fdce32a9e04fad124a" kindref="member">OP_DROP</ref><sp/>&lt;&lt;<sp/><ref refid="script_2script_8h_1adb3d23f17cd1c3d543c096c67489a738" kindref="member">ToByteVector</ref>(coinbaseKey.GetPubKey())<sp/>&lt;&lt;<sp/><ref refid="script_2script_8h_1a63e349a6089a54da9fe09a3d858648bda2c190c5caf052f92d3d9ac31a0d96151" kindref="member">OP_CHECKSIG</ref>;</highlight></codeline>
<codeline lineno="199"><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Sign,<sp/>with<sp/>a<sp/>non-DER<sp/>signature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;unsigned<sp/>char&gt;<sp/>vchSig;</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classuint256" kindref="compound">uint256</ref><sp/>hash<sp/>=<sp/><ref refid="interpreter_8cpp_1a63c4884dd720c4d306603998b5d02b49" kindref="member">SignatureHash</ref>(p2pk_scriptPubKey,<sp/>spend_tx,<sp/>0,<sp/><ref refid="interpreter_8h_1aad9879e99a65218a36881f0bc8713fcdac68c7df6528b3001624e56b2de3826de" kindref="member">SIGHASH_ALL</ref>,<sp/>0,<sp/><ref refid="interpreter_8h_1a3db3199560fd5419a3be2fcd88a28f8fae7b1a5c82772e0e055096008cb9883ef" kindref="member">SigVersion::BASE</ref>);</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(coinbaseKey.Sign(hash,<sp/>vchSig));</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vchSig.push_back((</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">)<sp/>0);<sp/></highlight><highlight class="comment">//<sp/>padding<sp/>byte<sp/>makes<sp/>this<sp/>non-DER</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vchSig.push_back((</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">)<ref refid="interpreter_8h_1aad9879e99a65218a36881f0bc8713fcdac68c7df6528b3001624e56b2de3826de" kindref="member">SIGHASH_ALL</ref>);</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].scriptSig<sp/>&lt;&lt;<sp/>vchSig;</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="209"><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Test<sp/>that<sp/>invalidity<sp/>under<sp/>a<sp/>set<sp/>of<sp/>flags<sp/>doesn&apos;t<sp/>preclude<sp/>validity</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>under<sp/>other<sp/>(eg<sp/>consensus)<sp/>flags.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>spend_tx<sp/>is<sp/>invalid<sp/>according<sp/>to<sp/>DERSIG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(<ref refid="cs__main_8cpp_1ab88a4b9173207cf250ece7820db1f36d" kindref="member">cs_main</ref>);</highlight></codeline>
<codeline lineno="215"><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_tx_validation_state" kindref="compound">TxValidationState</ref><sp/>state;</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_precomputed_transaction_data" kindref="compound">PrecomputedTransactionData</ref><sp/>ptd_spend_tx;</highlight></codeline>
<codeline lineno="218"><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(!<ref refid="txvalidationcache__tests_8cpp_1a97d6169ac38d1dc06811732fda310b8c" kindref="member">CheckInputScripts</ref>(<ref refid="class_c_transaction" kindref="compound">CTransaction</ref>(spend_tx),<sp/>state,<sp/>&amp;m_node.chainman-&gt;ActiveChainstate().CoinsTip(),<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637aeb9561bbd06f9c457e9a44535a261134" kindref="member">SCRIPT_VERIFY_P2SH</ref><sp/>|<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637a683b906961d0b296bd1d590777aab12a" kindref="member">SCRIPT_VERIFY_DERSIG</ref>,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>ptd_spend_tx,<sp/>m_node.chainman-&gt;m_validation_cache,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="220"><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>we<sp/>call<sp/>again<sp/>asking<sp/>for<sp/>scriptchecks<sp/>(as<sp/>happens<sp/>in</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ConnectBlock),<sp/>we<sp/>should<sp/>add<sp/>a<sp/>script<sp/>check<sp/>object<sp/>for<sp/>this<sp/>--<sp/>we&apos;re</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>not<sp/>caching<sp/>invalidity<sp/>(if<sp/>that<sp/>changes,<sp/>delete<sp/>this<sp/>test<sp/>case).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;CScriptCheck&gt;<sp/>scriptchecks;</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(<ref refid="txvalidationcache__tests_8cpp_1a97d6169ac38d1dc06811732fda310b8c" kindref="member">CheckInputScripts</ref>(<ref refid="class_c_transaction" kindref="compound">CTransaction</ref>(spend_tx),<sp/>state,<sp/>&amp;m_node.chainman-&gt;ActiveChainstate().CoinsTip(),<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637aeb9561bbd06f9c457e9a44535a261134" kindref="member">SCRIPT_VERIFY_P2SH</ref><sp/>|<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637a683b906961d0b296bd1d590777aab12a" kindref="member">SCRIPT_VERIFY_DERSIG</ref>,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>ptd_spend_tx,<sp/>m_node.chainman-&gt;m_validation_cache,<sp/>&amp;scriptchecks));</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(scriptchecks.size(),<sp/>1U);</highlight></codeline>
<codeline lineno="227"><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Test<sp/>that<sp/>CheckInputScripts<sp/>returns<sp/>true<sp/>iff<sp/>DERSIG-enforcing<sp/>flags<sp/>are</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>not<sp/>present.<sp/><sp/>Don&apos;t<sp/>add<sp/>these<sp/>checks<sp/>to<sp/>the<sp/>cache,<sp/>so<sp/>that<sp/>we<sp/>can</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>test<sp/>later<sp/>that<sp/>block<sp/>validation<sp/>works<sp/>fine<sp/>in<sp/>the<sp/>absence<sp/>of<sp/>cached</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>successes.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ValidateCheckInputsForAllFlags(<ref refid="class_c_transaction" kindref="compound">CTransaction</ref>(spend_tx),<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637a683b906961d0b296bd1d590777aab12a" kindref="member">SCRIPT_VERIFY_DERSIG</ref><sp/>|<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637a35683df988abbbfb21820e60cb891db0" kindref="member">SCRIPT_VERIFY_LOW_S</ref><sp/>|<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637a23082594a50dd409538ddba4fd05c354" kindref="member">SCRIPT_VERIFY_STRICTENC</ref>,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">,<sp/>m_node.chainman-&gt;ActiveChainstate().CoinsTip(),<sp/>m_node.chainman-&gt;m_validation_cache);</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="234"><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>And<sp/>if<sp/>we<sp/>produce<sp/>a<sp/>block<sp/>with<sp/>this<sp/>tx,<sp/>it<sp/>should<sp/>be<sp/>valid<sp/>(DERSIG<sp/>not</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>enabled<sp/>yet),<sp/>even<sp/>though<sp/>there&apos;s<sp/>no<sp/>cache<sp/>entry.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_block" kindref="compound">CBlock</ref><sp/>block;</highlight></codeline>
<codeline lineno="238"><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/>block<sp/>=<sp/>CreateAndProcessBlock({spend_tx},<sp/>p2pk_scriptPubKey);</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sync_8h_1a911fe23f057c2fe5aad629162d6c99d0" kindref="member">LOCK</ref>(<ref refid="cs__main_8cpp_1ab88a4b9173207cf250ece7820db1f36d" kindref="member">cs_main</ref>);</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(m_node.chainman-&gt;ActiveChain().Tip()-&gt;GetBlockHash()<sp/>==<sp/>block.<ref refid="class_c_block_header_1a6df30b63c4634d52dfeaadb46d60d0f5" kindref="member">GetHash</ref>());</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(m_node.chainman-&gt;ActiveChainstate().CoinsTip().GetBestBlock()<sp/>==<sp/>block.<ref refid="class_c_block_header_1a6df30b63c4634d52dfeaadb46d60d0f5" kindref="member">GetHash</ref>());</highlight></codeline>
<codeline lineno="243"><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Test<sp/>P2SH:<sp/>construct<sp/>a<sp/>transaction<sp/>that<sp/>is<sp/>valid<sp/>without<sp/>P2SH,<sp/>and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>then<sp/>test<sp/>validity<sp/>with<sp/>P2SH.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_c_mutable_transaction" kindref="compound">CMutableTransaction</ref><sp/>invalid_under_p2sh_tx;</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_under_p2sh_tx.<ref refid="struct_c_mutable_transaction_1acd99bb05ca015e7d74448acb1deba7ca" kindref="member">version</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_under_p2sh_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>.resize(1);</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_under_p2sh_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].prevout.hash<sp/>=<sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1aa7fc4cd2fa1b4d99b7e2133524316918" kindref="member">GetHash</ref>();</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_under_p2sh_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].prevout.n<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_under_p2sh_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>.resize(1);</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_under_p2sh_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[0].nValue<sp/>=<sp/>11*CENT;</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_under_p2sh_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[0].scriptPubKey<sp/>=<sp/>p2pk_scriptPubKey;</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;unsigned<sp/>char&gt;<sp/>vchSig2(p2pk_scriptPubKey.<ref refid="classprevector_1ad69bd11391be1a1dba5c8202259664f8" kindref="member">begin</ref>(),<sp/>p2pk_scriptPubKey.<ref refid="classprevector_1acad38d52497a975bfb6f2f6acd76631f" kindref="member">end</ref>());</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_under_p2sh_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].scriptSig<sp/>&lt;&lt;<sp/>vchSig2;</highlight></codeline>
<codeline lineno="257"><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ValidateCheckInputsForAllFlags(<ref refid="class_c_transaction" kindref="compound">CTransaction</ref>(invalid_under_p2sh_tx),<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637aeb9561bbd06f9c457e9a44535a261134" kindref="member">SCRIPT_VERIFY_P2SH</ref>,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>m_node.chainman-&gt;ActiveChainstate().CoinsTip(),<sp/>m_node.chainman-&gt;m_validation_cache);</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="260"><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Test<sp/>CHECKLOCKTIMEVERIFY</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_c_mutable_transaction" kindref="compound">CMutableTransaction</ref><sp/>invalid_with_cltv_tx;</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_cltv_tx.<ref refid="struct_c_mutable_transaction_1acd99bb05ca015e7d74448acb1deba7ca" kindref="member">version</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_cltv_tx.<ref refid="struct_c_mutable_transaction_1a74c41398d51060aaa60d6c7c49ac715f" kindref="member">nLockTime</ref><sp/>=<sp/>100;</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_cltv_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>.resize(1);</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_cltv_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].prevout.hash<sp/>=<sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1aa7fc4cd2fa1b4d99b7e2133524316918" kindref="member">GetHash</ref>();</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_cltv_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].prevout.n<sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_cltv_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].nSequence<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_cltv_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>.resize(1);</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_cltv_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[0].nValue<sp/>=<sp/>11*CENT;</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_cltv_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[0].scriptPubKey<sp/>=<sp/>p2pk_scriptPubKey;</highlight></codeline>
<codeline lineno="273"><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Sign</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;unsigned<sp/>char&gt;<sp/>vchSig;</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classuint256" kindref="compound">uint256</ref><sp/>hash<sp/>=<sp/><ref refid="interpreter_8cpp_1a63c4884dd720c4d306603998b5d02b49" kindref="member">SignatureHash</ref>(spend_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[2].scriptPubKey,<sp/>invalid_with_cltv_tx,<sp/>0,<sp/><ref refid="interpreter_8h_1aad9879e99a65218a36881f0bc8713fcdac68c7df6528b3001624e56b2de3826de" kindref="member">SIGHASH_ALL</ref>,<sp/>0,<sp/><ref refid="interpreter_8h_1a3db3199560fd5419a3be2fcd88a28f8fae7b1a5c82772e0e055096008cb9883ef" kindref="member">SigVersion::BASE</ref>);</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(coinbaseKey.Sign(hash,<sp/>vchSig));</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vchSig.push_back((</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">)<ref refid="interpreter_8h_1aad9879e99a65218a36881f0bc8713fcdac68c7df6528b3001624e56b2de3826de" kindref="member">SIGHASH_ALL</ref>);</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_cltv_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].scriptSig<sp/>=<sp/><ref refid="class_c_script" kindref="compound">CScript</ref>()<sp/>&lt;&lt;<sp/>vchSig<sp/>&lt;&lt;<sp/>101;</highlight></codeline>
<codeline lineno="280"><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ValidateCheckInputsForAllFlags(<ref refid="class_c_transaction" kindref="compound">CTransaction</ref>(invalid_with_cltv_tx),<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637a2fb7c2ee28fb2a70eb4401a347641a8e" kindref="member">SCRIPT_VERIFY_CHECKLOCKTIMEVERIFY</ref>,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>m_node.chainman-&gt;ActiveChainstate().CoinsTip(),<sp/>m_node.chainman-&gt;m_validation_cache);</highlight></codeline>
<codeline lineno="282"><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>it<sp/>valid,<sp/>and<sp/>check<sp/>again</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_cltv_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].scriptSig<sp/>=<sp/><ref refid="class_c_script" kindref="compound">CScript</ref>()<sp/>&lt;&lt;<sp/>vchSig<sp/>&lt;&lt;<sp/>100;</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_tx_validation_state" kindref="compound">TxValidationState</ref><sp/>state;</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_precomputed_transaction_data" kindref="compound">PrecomputedTransactionData</ref><sp/>txdata;</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(<ref refid="txvalidationcache__tests_8cpp_1a97d6169ac38d1dc06811732fda310b8c" kindref="member">CheckInputScripts</ref>(<ref refid="class_c_transaction" kindref="compound">CTransaction</ref>(invalid_with_cltv_tx),<sp/>state,<sp/>m_node.chainman-&gt;ActiveChainstate().CoinsTip(),<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637a2fb7c2ee28fb2a70eb4401a347641a8e" kindref="member">SCRIPT_VERIFY_CHECKLOCKTIMEVERIFY</ref>,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>txdata,<sp/>m_node.chainman-&gt;m_validation_cache,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="289"><highlight class="normal"></highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TEST<sp/>CHECKSEQUENCEVERIFY</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_c_mutable_transaction" kindref="compound">CMutableTransaction</ref><sp/>invalid_with_csv_tx;</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_csv_tx.<ref refid="struct_c_mutable_transaction_1acd99bb05ca015e7d74448acb1deba7ca" kindref="member">version</ref><sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_csv_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>.resize(1);</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_csv_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].prevout.hash<sp/>=<sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1aa7fc4cd2fa1b4d99b7e2133524316918" kindref="member">GetHash</ref>();</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_csv_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].prevout.n<sp/>=<sp/>3;</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_csv_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].nSequence<sp/>=<sp/>100;</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_csv_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>.resize(1);</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_csv_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[0].nValue<sp/>=<sp/>11*CENT;</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_csv_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[0].scriptPubKey<sp/>=<sp/>p2pk_scriptPubKey;</highlight></codeline>
<codeline lineno="301"><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Sign</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;unsigned<sp/>char&gt;<sp/>vchSig;</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classuint256" kindref="compound">uint256</ref><sp/>hash<sp/>=<sp/><ref refid="interpreter_8cpp_1a63c4884dd720c4d306603998b5d02b49" kindref="member">SignatureHash</ref>(spend_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[3].scriptPubKey,<sp/>invalid_with_csv_tx,<sp/>0,<sp/><ref refid="interpreter_8h_1aad9879e99a65218a36881f0bc8713fcdac68c7df6528b3001624e56b2de3826de" kindref="member">SIGHASH_ALL</ref>,<sp/>0,<sp/><ref refid="interpreter_8h_1a3db3199560fd5419a3be2fcd88a28f8fae7b1a5c82772e0e055096008cb9883ef" kindref="member">SigVersion::BASE</ref>);</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(coinbaseKey.Sign(hash,<sp/>vchSig));</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vchSig.push_back((</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">)<ref refid="interpreter_8h_1aad9879e99a65218a36881f0bc8713fcdac68c7df6528b3001624e56b2de3826de" kindref="member">SIGHASH_ALL</ref>);</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_csv_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].scriptSig<sp/>=<sp/><ref refid="class_c_script" kindref="compound">CScript</ref>()<sp/>&lt;&lt;<sp/>vchSig<sp/>&lt;&lt;<sp/>101;</highlight></codeline>
<codeline lineno="308"><highlight class="normal"></highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ValidateCheckInputsForAllFlags(<ref refid="class_c_transaction" kindref="compound">CTransaction</ref>(invalid_with_csv_tx),<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637a2b8db46985788749ca121e3ea5df8ef9" kindref="member">SCRIPT_VERIFY_CHECKSEQUENCEVERIFY</ref>,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>m_node.chainman-&gt;ActiveChainstate().CoinsTip(),<sp/>m_node.chainman-&gt;m_validation_cache);</highlight></codeline>
<codeline lineno="310"><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>it<sp/>valid,<sp/>and<sp/>check<sp/>again</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_with_csv_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].scriptSig<sp/>=<sp/><ref refid="class_c_script" kindref="compound">CScript</ref>()<sp/>&lt;&lt;<sp/>vchSig<sp/>&lt;&lt;<sp/>100;</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_tx_validation_state" kindref="compound">TxValidationState</ref><sp/>state;</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_precomputed_transaction_data" kindref="compound">PrecomputedTransactionData</ref><sp/>txdata;</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(<ref refid="txvalidationcache__tests_8cpp_1a97d6169ac38d1dc06811732fda310b8c" kindref="member">CheckInputScripts</ref>(<ref refid="class_c_transaction" kindref="compound">CTransaction</ref>(invalid_with_csv_tx),<sp/>state,<sp/>&amp;m_node.chainman-&gt;ActiveChainstate().CoinsTip(),<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637a2b8db46985788749ca121e3ea5df8ef9" kindref="member">SCRIPT_VERIFY_CHECKSEQUENCEVERIFY</ref>,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>txdata,<sp/>m_node.chainman-&gt;m_validation_cache,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="317"><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>add<sp/>tests<sp/>for<sp/>remaining<sp/>script<sp/>flags</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"></highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Test<sp/>that<sp/>passing<sp/>CheckInputScripts<sp/>with<sp/>a<sp/>valid<sp/>witness<sp/>doesn&apos;t<sp/>imply<sp/>success</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>the<sp/>same<sp/>tx<sp/>with<sp/>a<sp/>different<sp/>witness.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_c_mutable_transaction" kindref="compound">CMutableTransaction</ref><sp/>valid_with_witness_tx;</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>valid_with_witness_tx.<ref refid="struct_c_mutable_transaction_1acd99bb05ca015e7d74448acb1deba7ca" kindref="member">version</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>valid_with_witness_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>.resize(1);</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>valid_with_witness_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].prevout.hash<sp/>=<sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1aa7fc4cd2fa1b4d99b7e2133524316918" kindref="member">GetHash</ref>();</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>valid_with_witness_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].prevout.n<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>valid_with_witness_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>.resize(1);</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>valid_with_witness_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[0].nValue<sp/>=<sp/>11*CENT;</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>valid_with_witness_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[0].scriptPubKey<sp/>=<sp/>p2pk_scriptPubKey;</highlight></codeline>
<codeline lineno="331"><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Sign</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_signature_data" kindref="compound">SignatureData</ref><sp/>sigdata;</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(<ref refid="sign_8cpp_1a0c453416d09212d876bee81dc9353c16" kindref="member">ProduceSignature</ref>(keystore,<sp/><ref refid="class_mutable_transaction_signature_creator" kindref="compound">MutableTransactionSignatureCreator</ref>(valid_with_witness_tx,<sp/>0,<sp/>11<sp/>*<sp/>CENT,<sp/><ref refid="interpreter_8h_1aad9879e99a65218a36881f0bc8713fcdac68c7df6528b3001624e56b2de3826de" kindref="member">SIGHASH_ALL</ref>),<sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[1].scriptPubKey,<sp/>sigdata));</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sign_8cpp_1a2051a9625f7300cb8ad7fdc1bc06f5c5" kindref="member">UpdateInput</ref>(valid_with_witness_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0],<sp/>sigdata);</highlight></codeline>
<codeline lineno="336"><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>should<sp/>be<sp/>valid<sp/>under<sp/>all<sp/>script<sp/>flags.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ValidateCheckInputsForAllFlags(<ref refid="class_c_transaction" kindref="compound">CTransaction</ref>(valid_with_witness_tx),<sp/>0,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>m_node.chainman-&gt;ActiveChainstate().CoinsTip(),<sp/>m_node.chainman-&gt;m_validation_cache);</highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Remove<sp/>the<sp/>witness,<sp/>and<sp/>check<sp/>that<sp/>it<sp/>is<sp/>now<sp/>invalid.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>valid_with_witness_tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].scriptWitness.SetNull();</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ValidateCheckInputsForAllFlags(<ref refid="class_c_transaction" kindref="compound">CTransaction</ref>(valid_with_witness_tx),<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637a41693a201df8f796c932d407b22da9b2" kindref="member">SCRIPT_VERIFY_WITNESS</ref>,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>m_node.chainman-&gt;ActiveChainstate().CoinsTip(),<sp/>m_node.chainman-&gt;m_validation_cache);</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="344"><highlight class="normal"></highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Test<sp/>a<sp/>transaction<sp/>with<sp/>multiple<sp/>inputs.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_c_mutable_transaction" kindref="compound">CMutableTransaction</ref><sp/>tx;</highlight></codeline>
<codeline lineno="348"><highlight class="normal"></highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tx.<ref refid="struct_c_mutable_transaction_1acd99bb05ca015e7d74448acb1deba7ca" kindref="member">version</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>.resize(2);</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].prevout.hash<sp/>=<sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1aa7fc4cd2fa1b4d99b7e2133524316918" kindref="member">GetHash</ref>();</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[0].prevout.n<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[1].prevout.hash<sp/>=<sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1aa7fc4cd2fa1b4d99b7e2133524316918" kindref="member">GetHash</ref>();</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[1].prevout.n<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>.resize(1);</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[0].nValue<sp/>=<sp/>22*CENT;</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[0].scriptPubKey<sp/>=<sp/>p2pk_scriptPubKey;</highlight></codeline>
<codeline lineno="358"><highlight class="normal"></highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Sign</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_signature_data" kindref="compound">SignatureData</ref><sp/>sigdata;</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(<ref refid="sign_8cpp_1a0c453416d09212d876bee81dc9353c16" kindref="member">ProduceSignature</ref>(keystore,<sp/><ref refid="class_mutable_transaction_signature_creator" kindref="compound">MutableTransactionSignatureCreator</ref>(tx,<sp/>i,<sp/>11<sp/>*<sp/>CENT,<sp/><ref refid="interpreter_8h_1aad9879e99a65218a36881f0bc8713fcdac68c7df6528b3001624e56b2de3826de" kindref="member">SIGHASH_ALL</ref>),<sp/>spend_tx.<ref refid="struct_c_mutable_transaction_1a9a7a8db8703f71229398b5dec69c027d" kindref="member">vout</ref>[i].scriptPubKey,<sp/>sigdata));</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sign_8cpp_1a2051a9625f7300cb8ad7fdc1bc06f5c5" kindref="member">UpdateInput</ref>(tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[i],<sp/>sigdata);</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="365"><highlight class="normal"></highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>should<sp/>be<sp/>valid<sp/>under<sp/>all<sp/>script<sp/>flags</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ValidateCheckInputsForAllFlags(<ref refid="class_c_transaction" kindref="compound">CTransaction</ref>(tx),<sp/>0,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>m_node.chainman-&gt;ActiveChainstate().CoinsTip(),<sp/>m_node.chainman-&gt;m_validation_cache);</highlight></codeline>
<codeline lineno="368"><highlight class="normal"></highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>if<sp/>the<sp/>second<sp/>input<sp/>is<sp/>invalid,<sp/>but<sp/>the<sp/>first<sp/>input<sp/>is</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>valid,<sp/>the<sp/>transaction<sp/>is<sp/>not<sp/>cached.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Invalidate<sp/>vin[1]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tx.<ref refid="struct_c_mutable_transaction_1afd91da81fb92925e0cdf710fd8addadb" kindref="member">vin</ref>[1].scriptWitness.SetNull();</highlight></codeline>
<codeline lineno="373"><highlight class="normal"></highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_tx_validation_state" kindref="compound">TxValidationState</ref><sp/>state;</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_precomputed_transaction_data" kindref="compound">PrecomputedTransactionData</ref><sp/>txdata;</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>transaction<sp/>is<sp/>now<sp/>invalid<sp/>under<sp/>segwit,<sp/>because<sp/>of<sp/>the<sp/>second<sp/>input.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(!<ref refid="txvalidationcache__tests_8cpp_1a97d6169ac38d1dc06811732fda310b8c" kindref="member">CheckInputScripts</ref>(<ref refid="class_c_transaction" kindref="compound">CTransaction</ref>(tx),<sp/>state,<sp/>&amp;m_node.chainman-&gt;ActiveChainstate().CoinsTip(),<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637aeb9561bbd06f9c457e9a44535a261134" kindref="member">SCRIPT_VERIFY_P2SH</ref><sp/>|<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637a41693a201df8f796c932d407b22da9b2" kindref="member">SCRIPT_VERIFY_WITNESS</ref>,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>txdata,<sp/>m_node.chainman-&gt;m_validation_cache,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="378"><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;CScriptCheck&gt;<sp/>scriptchecks;</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>sure<sp/>this<sp/>transaction<sp/>was<sp/>not<sp/>cached<sp/>(ie<sp/>because<sp/>the<sp/>first</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>input<sp/>was<sp/>valid)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1adae801baf804b33f52b180d64dbf0340" kindref="member">BOOST_CHECK</ref>(<ref refid="txvalidationcache__tests_8cpp_1a97d6169ac38d1dc06811732fda310b8c" kindref="member">CheckInputScripts</ref>(<ref refid="class_c_transaction" kindref="compound">CTransaction</ref>(tx),<sp/>state,<sp/>&amp;m_node.chainman-&gt;ActiveChainstate().CoinsTip(),<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637aeb9561bbd06f9c457e9a44535a261134" kindref="member">SCRIPT_VERIFY_P2SH</ref><sp/>|<sp/><ref refid="interpreter_8h_1adfb2695ade741a5e62728f3586ec1637a41693a201df8f796c932d407b22da9b2" kindref="member">SCRIPT_VERIFY_WITNESS</ref>,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/>txdata,<sp/>m_node.chainman-&gt;m_validation_cache,<sp/>&amp;scriptchecks));</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Should<sp/>get<sp/>2<sp/>script<sp/>checks<sp/>back<sp/>--<sp/>caching<sp/>is<sp/>on<sp/>a<sp/>whole-transaction<sp/>basis.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="object_8cpp_1a95059d744e94ee0d05e036083b8b2e09" kindref="member">BOOST_CHECK_EQUAL</ref>(scriptchecks.size(),<sp/>2U);</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="386"><highlight class="normal">}</highlight></codeline>
<codeline lineno="387"><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"><ref refid="cuckoocache__tests_8cpp_1af7f71af5c6c124222dd1c42c5df892f4" kindref="member">BOOST_AUTO_TEST_SUITE_END</ref>()</highlight></codeline>
    </programlisting>
    <location file="src/test/txvalidationcache_tests.cpp"/>
  </compounddef>
</doxygen>
