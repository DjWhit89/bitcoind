<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="md_src_2secp256k1_2_c_o_n_t_r_i_b_u_t_i_n_g" kind="page">
    <compoundname>md_src_2secp256k1_2_c_o_n_t_r_i_b_u_t_i_n_g</compoundname>
    <title>Contributing to libsecp256k1</title>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para><anchor id="md_src_2secp256k1_2_c_o_n_t_r_i_b_u_t_i_n_g_1autotoc_md171"/></para>
<sect1 id="md_src_2secp256k1_2_c_o_n_t_r_i_b_u_t_i_n_g_1autotoc_md172">
<title>Scope</title><para>libsecp256k1 is a library for elliptic curve cryptography on the curve secp256k1, not a general-purpose cryptography library. The library primarily serves the needs of the Bitcoin Core project but provides additional functionality for the benefit of the wider Bitcoin ecosystem.</para>
</sect1>
<sect1 id="md_src_2secp256k1_2_c_o_n_t_r_i_b_u_t_i_n_g_1autotoc_md173">
<title>Adding new functionality or modules</title><para>The libsecp256k1 project welcomes contributions in the form of new functionality or modules, provided they are within the project&apos;s scope.</para>
<para>It is the responsibility of the contributors to convince the maintainers that the proposed functionality is within the project&apos;s scope, high-quality and maintainable. Contributors are recommended to provide the following in addition to the new code:</para>
<para><itemizedlist>
<listitem><para><bold>Specification:</bold> A specification can help significantly in reviewing the new code as it provides documentation and context. It may justify various design decisions, give a motivation and outline security goals. If the specification contains pseudocode, a reference implementation or test vectors, these can be used to compare with the proposed libsecp256k1 code.</para>
</listitem><listitem><para><bold>Security Arguments:</bold> In addition to a defining the security goals, it should be argued that the new functionality meets these goals. Depending on the nature of the new functionality, a wide range of security arguments are acceptable, ranging from being &quot;obviously secure&quot; to rigorous proofs of security.</para>
</listitem><listitem><para><bold>Relevance Arguments:</bold> The relevance of the new functionality for the Bitcoin ecosystem should be argued by outlining clear use cases.</para>
</listitem></itemizedlist>
</para>
<para>These are not the only factors taken into account when considering to add new functionality. The proposed new libsecp256k1 code must be of high quality, including API documentation and tests, as well as featuring a misuse-resistant API design.</para>
<para>We recommend reaching out to other contributors (see Communication Channels) and get feedback before implementing new functionality.</para>
</sect1>
<sect1 id="md_src_2secp256k1_2_c_o_n_t_r_i_b_u_t_i_n_g_1autotoc_md174">
<title>Communication channels</title><para>Most communication about libsecp256k1 occurs on the GitHub repository: in issues, pull request or on the discussion board.</para>
<para>Additionally, there is an IRC channel dedicated to libsecp256k1, with biweekly meetings (see channel topic). The channel is <computeroutput>#secp256k1</computeroutput> on Libera Chat. The easiest way to participate on IRC is with the web client, <ulink url="https://web.libera.chat/#secp256k1">web.libera.chat</ulink>. Chat history logs can be found at <ulink url="https://gnusha.org/secp256k1/">https://gnusha.org/secp256k1/</ulink>.</para>
</sect1>
<sect1 id="md_src_2secp256k1_2_c_o_n_t_r_i_b_u_t_i_n_g_1autotoc_md175">
<title>Contributor workflow &amp; peer review</title><para>The Contributor Workflow &amp; Peer Review in libsecp256k1 are similar to Bitcoin Core&apos;s workflow and review processes described in its <ulink url="https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md">CONTRIBUTING.md</ulink>.</para>
<sect2 id="md_src_2secp256k1_2_c_o_n_t_r_i_b_u_t_i_n_g_1autotoc_md176">
<title>Coding conventions</title><para>In addition, libsecp256k1 tries to maintain the following coding conventions:</para>
<para><itemizedlist>
<listitem><para>No runtime heap allocation (e.g., no <computeroutput>malloc</computeroutput>) unless explicitly requested by the caller (via <computeroutput><ref refid="secp256k1_8h_1a3aaa9fcc3ab67bc8f841779a049069c5" kindref="member">secp256k1_context_create</ref></computeroutput> or <computeroutput>secp256k1_scratch_space_create</computeroutput>, for example). Moreover, it should be possible to use the library without any heap allocations.</para>
</listitem><listitem><para>The tests should cover all lines and branches of the library (see Test coverage).</para>
</listitem><listitem><para>Operations involving secret data should be tested for being constant time with respect to the secrets (see <ulink url="src/ctime_tests.c">src/ctime_tests.c</ulink>).</para>
</listitem><listitem><para>Local variables containing secret data should be cleared explicitly to try to delete secrets from memory.</para>
</listitem><listitem><para>Use <computeroutput>secp256k1_memcmp_var</computeroutput> instead of <computeroutput>memcmp</computeroutput> (see <ulink url="https://github.com/bitcoin-core/secp256k1/issues/823">#823</ulink>).</para>
</listitem><listitem><para>As a rule of thumb, the default values for configuration options should target standard desktop machines and align with Bitcoin Core&apos;s defaults, and the tests should mostly exercise the default configuration (see <ulink url="https://github.com/bitcoin-core/secp256k1/issues/1549#issuecomment-2200559257">#1549</ulink>).</para>
</listitem></itemizedlist>
</para>
<sect3 id="md_src_2secp256k1_2_c_o_n_t_r_i_b_u_t_i_n_g_1autotoc_md177">
<title>Style conventions</title><para><itemizedlist>
<listitem><para>Commits should be atomic and diffs should be easy to read. For this reason, do not mix any formatting fixes or code moves with actual code changes. Make sure each individual commit is hygienic: that it builds successfully on its own without warnings, errors, regressions, or test failures.</para>
</listitem><listitem><para>New code should adhere to the style of existing, in particular surrounding, code. Other than that, we do not enforce strict rules for code formatting.</para>
</listitem><listitem><para>The code conforms to C89. Most notably, that means that only <computeroutput>/* ... */</computeroutput> comments are allowed (no <computeroutput>//</computeroutput> line comments). Moreover, any declarations in a <computeroutput>{ ... }</computeroutput> block (e.g., a function) must appear at the beginning of the block before any statements. When you would like to declare a variable in the middle of a block, you can open a new block: <programlisting filename=".C"><codeline><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k_foo(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>x;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>declaration<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>y<sp/>=<sp/>2*x;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>declaration<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>x<sp/>=<sp/>17;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>statement<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>a,<sp/>b;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>declaration<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>a<sp/>=<sp/>x<sp/>+<sp/>y;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>statement<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k_bar(x,<sp/>&amp;b);<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>statement<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
</programlisting></para>
</listitem><listitem><para>Use <computeroutput>unsigned int</computeroutput> instead of just <computeroutput>unsigned</computeroutput>.</para>
</listitem><listitem><para>Use <computeroutput>void *ptr</computeroutput> instead of <computeroutput>void* ptr</computeroutput>.</para>
</listitem><listitem><para>Arguments of the publicly-facing API must have a specific order defined in <ulink url="include/secp256k1.h">include/secp256k1.h</ulink>.</para>
</listitem><listitem><para>User-facing comment lines in headers should be limited to 80 chars if possible.</para>
</listitem><listitem><para>All identifiers in file scope should start with <computeroutput>secp256k1_</computeroutput>.</para>
</listitem><listitem><para>Avoid trailing whitespace.</para>
</listitem><listitem><para>Use the constants <computeroutput><ref refid="bitcoin-wallet_8cpp_1a1a8bb385160d2854b0c2ebb85db2d212" kindref="member">EXIT_SUCCESS</ref></computeroutput>/<computeroutput>EXIT_FAILURE</computeroutput> (defined in <computeroutput>stdlib.h</computeroutput>) to indicate program execution status for examples and other binaries.</para>
</listitem></itemizedlist>
</para>
</sect3>
</sect2>
<sect2 id="md_src_2secp256k1_2_c_o_n_t_r_i_b_u_t_i_n_g_1autotoc_md178">
<title>Tests</title><sect3 id="md_src_2secp256k1_2_c_o_n_t_r_i_b_u_t_i_n_g_1autotoc_md179">
<title>Coverage</title><para>This library aims to have full coverage of reachable lines and branches.</para>
<para>To create a test coverage report, configure with <computeroutput>--enable-coverage</computeroutput> (use of GCC is necessary): <verbatim>$ ./configure --enable-coverage
</verbatim></para>
<para>Run the tests: <verbatim>$ make check
</verbatim></para>
<para>To create a report, <computeroutput>gcovr</computeroutput> is recommended, as it includes branch coverage reporting: <verbatim>$ gcovr --gcov-ignore-parse-errors=all --merge-mode-functions=separate --exclude &apos;src/bench*&apos; --exclude &apos;src/modules/.*/bench_impl.h&apos; --print-summary
</verbatim></para>
<para>To create a HTML report with coloured and annotated source code: <verbatim>$ mkdir -p coverage
$ gcovr --gcov-ignore-parse-errors=all --merge-mode-functions=separate --exclude &apos;src/bench*&apos; --exclude &apos;src/modules/.*/bench_impl.h&apos; --html --html-details -o coverage/coverage.html
</verbatim></para>
<para>On <computeroutput>gcovr</computeroutput> &gt;=8.3, <computeroutput>--gcov-ignore-parse-errors=all</computeroutput> can be replaced with <computeroutput>--gcov-suspicious-hits-threshold=140737488355330</computeroutput>.</para>
</sect3>
<sect3 id="md_src_2secp256k1_2_c_o_n_t_r_i_b_u_t_i_n_g_1autotoc_md180">
<title>Exhaustive tests</title><para>There are tests of several functions in which a small group replaces secp256k1. These tests are <emphasis>exhaustive</emphasis> since they provide all elements and scalars of the small group as input arguments (see <ulink url="src/tests_exhaustive.c">src/tests_exhaustive.c</ulink>).</para>
</sect3>
</sect2>
<sect2 id="md_src_2secp256k1_2_c_o_n_t_r_i_b_u_t_i_n_g_1autotoc_md181">
<title>Benchmarks</title><para>See <computeroutput>src/bench*.c</computeroutput> for examples of benchmarks. </para>
</sect2>
</sect1>
    </detaileddescription>
    <location file="src/secp256k1/CONTRIBUTING.md"/>
  </compounddef>
</doxygen>
