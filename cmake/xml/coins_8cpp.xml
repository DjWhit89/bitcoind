<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="coins_8cpp" kind="file" language="C++">
    <compoundname>coins.cpp</compoundname>
    <includes refid="coins_8h" local="no">coins.h</includes>
    <includes refid="consensus_8h" local="no">consensus/consensus.h</includes>
    <includes refid="logging_8h" local="no">logging.h</includes>
    <includes refid="random_8h" local="no">random.h</includes>
    <includes refid="trace_8h" local="no">util/trace.h</includes>
    <incdepgraph>
      <node id="15">
        <label>attributes.h</label>
        <link refid="attributes_8h"/>
      </node>
      <node id="1">
        <label>src/coins.cpp</label>
        <link refid="coins_8cpp"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="69" relation="include">
        </childnode>
        <childnode refid="70" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>coins.h</label>
        <link refid="coins_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
        <childnode refid="56" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="66" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="68" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
      </node>
      <node id="45">
        <label>compat/assumptions.h</label>
        <link refid="compat_2assumptions_8h"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
      </node>
      <node id="21">
        <label>compat/byteswap.h</label>
        <link refid="byteswap_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="20">
        <label>compat/endian.h</label>
        <link refid="endian_8h"/>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="3">
        <label>compressor.h</label>
        <link refid="compressor_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
      </node>
      <node id="16">
        <label>consensus/amount.h</label>
        <link refid="amount_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="69">
        <label>consensus/consensus.h</label>
        <link refid="consensus_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
      </node>
      <node id="53">
        <label>core_memusage.h</label>
        <link refid="core__memusage_8h"/>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="54" relation="include">
        </childnode>
        <childnode refid="56" relation="include">
        </childnode>
      </node>
      <node id="83">
        <label>crypto/chacha20.h</label>
        <link refid="chacha20_8h"/>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
      </node>
      <node id="19">
        <label>crypto/common.h</label>
        <link refid="crypto_2common_8h"/>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
      </node>
      <node id="27">
        <label>crypto/hex_base.h</label>
        <link refid="hex__base_8h"/>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
      </node>
      <node id="67">
        <label>crypto/siphash.h</label>
        <link refid="siphash_8h"/>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
      </node>
      <node id="57">
        <label>indirectmap.h</label>
        <link refid="indirectmap_8h"/>
        <childnode refid="47" relation="include">
        </childnode>
      </node>
      <node id="70">
        <label>logging.h</label>
        <link refid="logging_8h"/>
        <childnode refid="67" relation="include">
        </childnode>
        <childnode refid="71" relation="include">
        </childnode>
        <childnode refid="73" relation="include">
        </childnode>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="75" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="80" relation="include">
        </childnode>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="68" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="72" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="65" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="56">
        <label>memusage.h</label>
        <link refid="memusage_8h"/>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="49" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="65" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>prevector.h</label>
        <link refid="prevector_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
      </node>
      <node id="54">
        <label>primitives/block.h</label>
        <link refid="primitives_2block_8h"/>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="55" relation="include">
        </childnode>
      </node>
      <node id="14">
        <label>primitives/transaction.h</label>
        <link refid="primitives_2transaction_8h"/>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="17">
        <label>primitives/transaction_identifier.h</label>
        <link refid="transaction__identifier_8h"/>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
      </node>
      <node id="82">
        <label>random.h</label>
        <link refid="random_8h"/>
        <childnode refid="83" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="43">
        <label>script/script.h</label>
        <link refid="script_2script_8h"/>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="44">
        <label>serialize.h</label>
        <link refid="serialize_8h"/>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="49" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="24">
        <label>span.h</label>
        <link refid="span_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
      </node>
      <node id="58">
        <label>support/allocators/pool.h</label>
        <link refid="pool_8h"/>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="60" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="61" relation="include">
        </childnode>
      </node>
      <node id="71">
        <label>threadsafety.h</label>
        <link refid="threadsafety_8h"/>
        <childnode refid="72" relation="include">
        </childnode>
      </node>
      <node id="73">
        <label>tinyformat.h</label>
        <link refid="tinyformat_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="74" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="18">
        <label>uint256.h</label>
        <link refid="uint256_8h"/>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="61">
        <label>util/check.h</label>
        <link refid="check_8h"/>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
      </node>
      <node id="75">
        <label>util/fs.h</label>
        <link refid="fs_8h"/>
        <childnode refid="73" relation="include">
        </childnode>
        <childnode refid="76" relation="include">
        </childnode>
        <childnode refid="77" relation="include">
        </childnode>
        <childnode refid="68" relation="include">
        </childnode>
        <childnode refid="78" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
      </node>
      <node id="50">
        <label>util/hash_type.h</label>
        <link refid="hash__type_8h"/>
      </node>
      <node id="66">
        <label>util/hasher.h</label>
        <link refid="hasher_8h"/>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="67" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
      </node>
      <node id="26">
        <label>util/strencodings.h</label>
        <link refid="strencodings_8h"/>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="29">
        <label>util/string.h</label>
        <link refid="string_8h"/>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="80">
        <label>util/time.h</label>
        <link refid="util_2time_8h"/>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="84">
        <label>util/trace.h</label>
        <link refid="trace_8h"/>
        <childnode refid="85" relation="include">
        </childnode>
      </node>
      <node id="39">
        <label>util/types.h</label>
        <link refid="util_2types_8h"/>
      </node>
      <node id="5">
        <label>algorithm</label>
      </node>
      <node id="30">
        <label>array</label>
      </node>
      <node id="62">
        <label>atomic</label>
      </node>
      <node id="22">
        <label>bit</label>
      </node>
      <node id="85">
        <label>bitcoin-build-config.h</label>
      </node>
      <node id="6">
        <label>cassert</label>
      </node>
      <node id="35">
        <label>charconv</label>
      </node>
      <node id="81">
        <label>chrono</label>
      </node>
      <node id="40">
        <label>compare</label>
      </node>
      <node id="23">
        <label>concepts</label>
      </node>
      <node id="7">
        <label>cstddef</label>
      </node>
      <node id="8">
        <label>cstdint</label>
      </node>
      <node id="76">
        <label>cstdio</label>
      </node>
      <node id="9">
        <label>cstdlib</label>
      </node>
      <node id="10">
        <label>cstring</label>
      </node>
      <node id="77">
        <label>filesystem</label>
      </node>
      <node id="68">
        <label>functional</label>
      </node>
      <node id="78">
        <label>iomanip</label>
      </node>
      <node id="46">
        <label>ios</label>
      </node>
      <node id="74">
        <label>iostream</label>
      </node>
      <node id="11">
        <label>iterator</label>
      </node>
      <node id="36">
        <label>limits</label>
      </node>
      <node id="59">
        <label>list</label>
      </node>
      <node id="31">
        <label>locale</label>
      </node>
      <node id="47">
        <label>map</label>
      </node>
      <node id="48">
        <label>memory</label>
      </node>
      <node id="72">
        <label>mutex</label>
      </node>
      <node id="60">
        <label>new</label>
      </node>
      <node id="52">
        <label>numeric</label>
      </node>
      <node id="37">
        <label>optional</label>
      </node>
      <node id="79">
        <label>ostream</label>
      </node>
      <node id="49">
        <label>set</label>
      </node>
      <node id="63">
        <label>source_location</label>
      </node>
      <node id="25">
        <label>span</label>
      </node>
      <node id="32">
        <label>sstream</label>
      </node>
      <node id="51">
        <label>stdexcept</label>
      </node>
      <node id="28">
        <label>string</label>
      </node>
      <node id="33">
        <label>string_view</label>
      </node>
      <node id="38">
        <label>system_error</label>
      </node>
      <node id="41">
        <label>tuple</label>
      </node>
      <node id="12">
        <label>type_traits</label>
      </node>
      <node id="64">
        <label>unordered_map</label>
      </node>
      <node id="65">
        <label>unordered_set</label>
      </node>
      <node id="55">
        <label>util/time.h</label>
      </node>
      <node id="13">
        <label>utility</label>
      </node>
      <node id="42">
        <label>variant</label>
      </node>
      <node id="34">
        <label>vector</label>
      </node>
    </incdepgraph>
    <sectiondef kind="var">
      <memberdef kind="variable" id="coins_8cpp_1a63131ff50cda4f65908e4a7880809e64" prot="public" static="yes" mutable="no">
        <type>const <ref refid="class_coin" kindref="compound">Coin</ref></type>
        <definition>const Coin coinEmpty</definition>
        <argsstring></argsstring>
        <name>coinEmpty</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/coins.cpp" line="155" column="19" bodyfile="src/coins.cpp" bodystart="155" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="coins_8cpp_1ad09ebd13a91ccdd8ecc1226ea027ea3a" prot="public" static="yes" mutable="no">
        <type>const uint64_t</type>
        <definition>const uint64_t MIN_TRANSACTION_OUTPUT_WEIGHT</definition>
        <argsstring></argsstring>
        <name>MIN_TRANSACTION_OUTPUT_WEIGHT</name>
        <initializer>{WITNESS_SCALE_FACTOR * <ref refid="serialize_8h_1ac0154eb0a74cc852efc55684de85b1f5" kindref="member">::GetSerializeSize</ref>(<ref refid="class_c_tx_out" kindref="compound">CTxOut</ref>())}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/coins.cpp" line="352" column="23" bodyfile="src/coins.cpp" bodystart="352" bodyend="352"/>
      </memberdef>
      <memberdef kind="variable" id="coins_8cpp_1ac74170f98776f1771b96c7e3cc3032f2" prot="public" static="yes" mutable="no">
        <type>const uint64_t</type>
        <definition>const uint64_t MAX_OUTPUTS_PER_BLOCK</definition>
        <argsstring></argsstring>
        <name>MAX_OUTPUTS_PER_BLOCK</name>
        <initializer>{MAX_BLOCK_WEIGHT / MIN_TRANSACTION_OUTPUT_WEIGHT}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/coins.cpp" line="353" column="23" bodyfile="src/coins.cpp" bodystart="353" bodyend="353"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="func">
      <memberdef kind="function" id="coins_8cpp_1a849bb6fcd701f77a2d6f1077060b4321" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>TRACEPOINT_SEMAPHORE</definition>
        <argsstring>(utxocache, add)</argsstring>
        <name>TRACEPOINT_SEMAPHORE</name>
        <param>
          <type>utxocache</type>
        </param>
        <param>
          <type>add</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/coins.cpp" line="12" column="1" declfile="src/coins.cpp" declline="12" declcolumn="1"/>
      </memberdef>
      <memberdef kind="function" id="coins_8cpp_1a25a6fbbc515693e456c18356cb2f476c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>TRACEPOINT_SEMAPHORE</definition>
        <argsstring>(utxocache, spent)</argsstring>
        <name>TRACEPOINT_SEMAPHORE</name>
        <param>
          <type>utxocache</type>
        </param>
        <param>
          <type>spent</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/coins.cpp" line="13" column="1" declfile="src/coins.cpp" declline="13" declcolumn="1"/>
      </memberdef>
      <memberdef kind="function" id="coins_8cpp_1a9a4740da827434fe5e87209960308ef0" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>TRACEPOINT_SEMAPHORE</definition>
        <argsstring>(utxocache, uncache)</argsstring>
        <name>TRACEPOINT_SEMAPHORE</name>
        <param>
          <type>utxocache</type>
        </param>
        <param>
          <type>uncache</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/coins.cpp" line="14" column="1" declfile="src/coins.cpp" declline="14" declcolumn="1"/>
      </memberdef>
      <memberdef kind="function" id="coins_8cpp_1ae4190d2c27c3c27c7fb6ad026ca11beb" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void AddCoins</definition>
        <argsstring>(CCoinsViewCache &amp;cache, const CTransaction &amp;tx, int nHeight, bool check_for_overwrite)</argsstring>
        <name>AddCoins</name>
        <param>
          <type><ref refid="class_c_coins_view_cache" kindref="compound">CCoinsViewCache</ref> &amp;</type>
          <declname>cache</declname>
        </param>
        <param>
          <type>const <ref refid="class_c_transaction" kindref="compound">CTransaction</ref> &amp;</type>
          <declname>tx</declname>
        </param>
        <param>
          <type>int</type>
          <declname>nHeight</declname>
        </param>
        <param>
          <type>bool</type>
          <declname>check</declname>
          <defname>check_for_overwrite</defname>
          <defval>false</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Utility function to add all of a transaction&apos;s outputs to a cache. When check is false, this assumes that overwrites are only possible for coinbase transactions. When check is true, the underlying view may be queried to determine whether an addition is an overwrite. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/coins.cpp" line="122" column="6" bodyfile="src/coins.cpp" bodystart="122" bodyend="131"/>
      </memberdef>
      <memberdef kind="function" id="coins_8cpp_1ae1198ec42f88d653cdc627aabbdb1ff9" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const <ref refid="class_coin" kindref="compound">Coin</ref> &amp;</type>
        <definition>const Coin &amp; AccessByTxid</definition>
        <argsstring>(const CCoinsViewCache &amp;view, const Txid &amp;txid)</argsstring>
        <name>AccessByTxid</name>
        <param>
          <type>const <ref refid="class_c_coins_view_cache" kindref="compound">CCoinsViewCache</ref> &amp;</type>
          <declname>cache</declname>
          <defname>view</defname>
        </param>
        <param>
          <type>const <ref refid="transaction__identifier_8h_1ac4bb3c35b94889843d632be4de4b223c" kindref="member">Txid</ref> &amp;</type>
          <declname>txid</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Utility function to find any unspent output with a given txid. This function can be quite expensive because in the event of a transaction which is not found in the cache, it can cause up to MAX_OUTPUTS_PER_BLOCK lookups to database, so it should be used with care. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/coins.cpp" line="355" column="12" bodyfile="src/coins.cpp" bodystart="355" bodyend="364"/>
      </memberdef>
      <memberdef kind="function" id="coins_8cpp_1ad8d0df5f2ae76ce5e50195a2210c9665" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <templateparamlist>
          <param>
            <type>typename ReturnType</type>
          </param>
          <param>
            <type>typename Func</type>
          </param>
        </templateparamlist>
        <type>ReturnType</type>
        <definition>static ReturnType ExecuteBackedWrapper</definition>
        <argsstring>(Func func, const std::vector&lt; std::function&lt; void()&gt; &gt; &amp;err_callbacks)</argsstring>
        <name>ExecuteBackedWrapper</name>
        <param>
          <type>Func</type>
          <declname>func</declname>
        </param>
        <param>
          <type>const std::vector&lt; std::function&lt; void()&gt; &gt; &amp;</type>
          <declname>err_callbacks</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/coins.cpp" line="367" column="19" bodyfile="src/coins.cpp" bodystart="367" bodyend="382"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2012-present<sp/>The<sp/>Bitcoin<sp/>Core<sp/>developers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Distributed<sp/>under<sp/>the<sp/>MIT<sp/>software<sp/>license,<sp/>see<sp/>the<sp/>accompanying</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">//<sp/>file<sp/>COPYING<sp/>or<sp/>http://www.opensource.org/licenses/mit-license.php.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="coins_8h" kindref="compound">coins.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="consensus_8h" kindref="compound">consensus/consensus.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="logging_8h" kindref="compound">logging.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="random_8h" kindref="compound">random.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="trace_8h" kindref="compound">util/trace.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"><ref refid="trace_8h_1af7302c002c156c1b9ea318c0d86f624a" kindref="member">TRACEPOINT_SEMAPHORE</ref>(utxocache,<sp/>add);</highlight></codeline>
<codeline lineno="13"><highlight class="normal"><ref refid="trace_8h_1af7302c002c156c1b9ea318c0d86f624a" kindref="member">TRACEPOINT_SEMAPHORE</ref>(utxocache,<sp/>spent);</highlight></codeline>
<codeline lineno="14"><highlight class="normal"><ref refid="trace_8h_1af7302c002c156c1b9ea318c0d86f624a" kindref="member">TRACEPOINT_SEMAPHORE</ref>(utxocache,<sp/>uncache);</highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal">std::optional&lt;Coin&gt;<sp/><ref refid="class_c_coins_view_1a61b812f0303e2e66dcbdd78992bf3478" kindref="member">CCoinsView::GetCoin</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_out_point" kindref="compound">COutPoint</ref>&amp;<sp/>outpoint)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;<sp/>}</highlight></codeline>
<codeline lineno="17"><highlight class="normal"><ref refid="classuint256" kindref="compound">uint256</ref><sp/><ref refid="class_c_coins_view_1a32e48fb2d05ede4a1eb6d2709aa0436c" kindref="member">CCoinsView::GetBestBlock</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>uint256();<sp/>}</highlight></codeline>
<codeline lineno="18"><highlight class="normal">std::vector&lt;uint256&gt;<sp/><ref refid="class_c_coins_view_1a0793beb40f9e77c408cd673ff38cbc8b" kindref="member">CCoinsView::GetHeadBlocks</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::vector&lt;uint256&gt;();<sp/>}</highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_1a433922bb29053e30cb00224aa60351e7" kindref="member">CCoinsView::BatchWrite</ref>(<ref refid="struct_coins_view_cache_cursor" kindref="compound">CoinsViewCacheCursor</ref>&amp;<sp/>cursor,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref><sp/>&amp;hashBlock)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="20"><highlight class="normal">std::unique_ptr&lt;CCoinsViewCursor&gt;<sp/><ref refid="class_c_coins_view_1a6cec651f9dd2b1af270b18b6b4f006fa" kindref="member">CCoinsView::Cursor</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_1a565d28efda751ff411f4953dae8f74f7" kindref="member">CCoinsView::HaveCoin</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_out_point" kindref="compound">COutPoint</ref><sp/>&amp;outpoint)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="23"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_1a61b812f0303e2e66dcbdd78992bf3478" kindref="member">GetCoin</ref>(outpoint).has_value();</highlight></codeline>
<codeline lineno="25"><highlight class="normal">}</highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"><ref refid="class_c_coins_view_backed_1a3f2a505dace6c6aa3fbf9437389d7559" kindref="member">CCoinsViewBacked::CCoinsViewBacked</ref>(<ref refid="class_c_coins_view" kindref="compound">CCoinsView</ref><sp/>*viewIn)<sp/>:<sp/>base(viewIn)<sp/>{<sp/>}</highlight></codeline>
<codeline lineno="28"><highlight class="normal">std::optional&lt;Coin&gt;<sp/><ref refid="class_c_coins_view_backed_1a053700fd896babb8aa62fc7c53dd27f6" kindref="member">CCoinsViewBacked::GetCoin</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_out_point" kindref="compound">COutPoint</ref>&amp;<sp/>outpoint)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_backed_1a96ab1be7e47c893d0ef009276e7ca8af" kindref="member">base</ref>-&gt;GetCoin(outpoint);<sp/>}</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_backed_1a57c7063d0b2cb3900509d8a9e91a8459" kindref="member">CCoinsViewBacked::HaveCoin</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_out_point" kindref="compound">COutPoint</ref><sp/>&amp;outpoint)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_backed_1a96ab1be7e47c893d0ef009276e7ca8af" kindref="member">base</ref>-&gt;HaveCoin(outpoint);<sp/>}</highlight></codeline>
<codeline lineno="30"><highlight class="normal"><ref refid="classuint256" kindref="compound">uint256</ref><sp/><ref refid="class_c_coins_view_backed_1a357197e89d0c22e33f9e58b3dac685ff" kindref="member">CCoinsViewBacked::GetBestBlock</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_backed_1a96ab1be7e47c893d0ef009276e7ca8af" kindref="member">base</ref>-&gt;GetBestBlock();<sp/>}</highlight></codeline>
<codeline lineno="31"><highlight class="normal">std::vector&lt;uint256&gt;<sp/><ref refid="class_c_coins_view_backed_1a50cca46427f48531df06f904e85cd907" kindref="member">CCoinsViewBacked::GetHeadBlocks</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_backed_1a96ab1be7e47c893d0ef009276e7ca8af" kindref="member">base</ref>-&gt;GetHeadBlocks();<sp/>}</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_backed_1a92d89d686195319f0bbc4f57ada1c6c2" kindref="member">CCoinsViewBacked::SetBackend</ref>(<ref refid="class_c_coins_view" kindref="compound">CCoinsView</ref><sp/>&amp;viewIn)<sp/>{<sp/><ref refid="class_c_coins_view_backed_1a96ab1be7e47c893d0ef009276e7ca8af" kindref="member">base</ref><sp/>=<sp/>&amp;viewIn;<sp/>}</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_backed_1a56d539fa8b1427ee21191bd0690b96d7" kindref="member">CCoinsViewBacked::BatchWrite</ref>(<ref refid="struct_coins_view_cache_cursor" kindref="compound">CoinsViewCacheCursor</ref>&amp;<sp/>cursor,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref><sp/>&amp;hashBlock)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_backed_1a96ab1be7e47c893d0ef009276e7ca8af" kindref="member">base</ref>-&gt;BatchWrite(cursor,<sp/>hashBlock);<sp/>}</highlight></codeline>
<codeline lineno="34"><highlight class="normal">std::unique_ptr&lt;CCoinsViewCursor&gt;<sp/><ref refid="class_c_coins_view_backed_1a8c25e928c7d604e75e3bb5913a41613f" kindref="member">CCoinsViewBacked::Cursor</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_backed_1a96ab1be7e47c893d0ef009276e7ca8af" kindref="member">base</ref>-&gt;Cursor();<sp/>}</highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_backed_1acaefa4e24e5ff7816b5bd2c94092e12f" kindref="member">CCoinsViewBacked::EstimateSize</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_backed_1a96ab1be7e47c893d0ef009276e7ca8af" kindref="member">base</ref>-&gt;EstimateSize();<sp/>}</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"><ref refid="class_c_coins_view_cache_1aebec811b4bad5edf5477ad47ce70799b" kindref="member">CCoinsViewCache::CCoinsViewCache</ref>(<ref refid="class_c_coins_view" kindref="compound">CCoinsView</ref>*<sp/>baseIn,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>deterministic)<sp/>:</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_backed" kindref="compound">CCoinsViewBacked</ref>(baseIn),<sp/>m_deterministic(deterministic),</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/>cacheCoins(0,<sp/><ref refid="class_salted_outpoint_hasher" kindref="compound">SaltedOutpointHasher</ref>(</highlight><highlight class="comment">/*deterministic=*/</highlight><highlight class="normal">deterministic),<sp/><ref refid="coins_8h_1abb6c00f4f94a3084a430d1848fed7697" kindref="member">CCoinsMap</ref>::key_equal{},<sp/>&amp;m_cache_coins_memory_resource)</highlight></codeline>
<codeline lineno="40"><highlight class="normal">{</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/>m_sentinel.second.SelfRef(m_sentinel);</highlight></codeline>
<codeline lineno="42"><highlight class="normal">}</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1afcc22204abc15aeefd5d1f7396e909a4" kindref="member">CCoinsViewCache::DynamicMemoryUsage</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>memusage::DynamicUsage(<ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>)<sp/>+<sp/><ref refid="class_c_coins_view_cache_1a8c1d785094f8ac4c2ace4dee99bcbe37" kindref="member">cachedCoinsUsage</ref>;</highlight></codeline>
<codeline lineno="46"><highlight class="normal">}</highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal">CCoinsMap::iterator<sp/>CCoinsViewCache::FetchCoin(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_out_point" kindref="compound">COutPoint</ref><sp/>&amp;outpoint)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>[<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>,<sp/>inserted]<sp/>=<sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.try_emplace(outpoint);</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(inserted)<sp/>{</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>coin{<ref refid="class_c_coins_view_backed_1a96ab1be7e47c893d0ef009276e7ca8af" kindref="member">base</ref>-&gt;GetCoin(outpoint)})<sp/>{</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>-&gt;second.coin<sp/>=<sp/>std::move(*coin);</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a8c1d785094f8ac4c2ace4dee99bcbe37" kindref="member">cachedCoinsUsage</ref><sp/>+=<sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>-&gt;second.coin.DynamicMemoryUsage();</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>-&gt;second.coin.IsSpent())<sp/>{<sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>GetCoin<sp/>cannot<sp/>return<sp/>spent<sp/>coins</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>parent<sp/>only<sp/>has<sp/>an<sp/>empty<sp/>entry<sp/>for<sp/>this<sp/>outpoint;<sp/>we<sp/>can<sp/>consider<sp/>our<sp/>version<sp/>as<sp/>fresh.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_c_coins_cache_entry_1af89b52459db336190ad8c4ee3c4cffac" kindref="member">CCoinsCacheEntry::SetFresh</ref>(*<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>,<sp/><ref refid="class_c_coins_view_cache_1a6a970d45d413eb7695ee5c862c57a542" kindref="member">m_sentinel</ref>);</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.erase(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.end();</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="64"><highlight class="normal">}</highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal">std::optional&lt;Coin&gt;<sp/><ref refid="class_c_coins_view_cache_1a053700fd896babb8aa62fc7c53dd27f6" kindref="member">CCoinsViewCache::GetCoin</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_out_point" kindref="compound">COutPoint</ref>&amp;<sp/>outpoint)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="67"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>it{FetchCoin(outpoint)};<sp/>it<sp/>!=<sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.end()<sp/>&amp;&amp;<sp/>!it-&gt;second.coin.IsSpent())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>it-&gt;second.coin;</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="70"><highlight class="normal">}</highlight></codeline>
<codeline lineno="71"><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1a0fe5f056188a32c5ae94aa19e1351698" kindref="member">CCoinsViewCache::AddCoin</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_out_point" kindref="compound">COutPoint</ref><sp/>&amp;outpoint,<sp/><ref refid="class_coin" kindref="compound">Coin</ref>&amp;&amp;<sp/>coin,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>possible_overwrite)<sp/>{</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(!coin.IsSpent());</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(coin.out.scriptPubKey.IsUnspendable())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/>CCoinsMap::iterator<sp/>it;</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>inserted;</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/>std::tie(it,<sp/>inserted)<sp/>=<sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.emplace(std::piecewise_construct,<sp/>std::forward_as_tuple(outpoint),<sp/>std::tuple&lt;&gt;());</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>fresh<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!possible_overwrite)<sp/>{</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!it-&gt;second.coin.IsSpent())<sp/>{</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/>std::logic_error(</highlight><highlight class="stringliteral">&quot;Attempted<sp/>to<sp/>overwrite<sp/>an<sp/>unspent<sp/>coin<sp/>(when<sp/>possible_overwrite<sp/>is<sp/>false)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>coin<sp/>exists<sp/>in<sp/>this<sp/>cache<sp/>as<sp/>a<sp/>spent<sp/>coin<sp/>and<sp/>is<sp/>DIRTY,<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>its<sp/>spentness<sp/>hasn&apos;t<sp/>been<sp/>flushed<sp/>to<sp/>the<sp/>parent<sp/>cache.<sp/>We&apos;re</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>re-adding<sp/>the<sp/>coin<sp/>to<sp/>this<sp/>cache<sp/>now<sp/>but<sp/>we<sp/>can&apos;t<sp/>mark<sp/>it<sp/>as<sp/>FRESH.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>we<sp/>mark<sp/>it<sp/>FRESH<sp/>and<sp/>then<sp/>spend<sp/>it<sp/>before<sp/>the<sp/>cache<sp/>is<sp/>flushed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>would<sp/>remove<sp/>it<sp/>from<sp/>this<sp/>cache<sp/>and<sp/>would<sp/>never<sp/>flush<sp/>spentness</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>the<sp/>parent<sp/>cache.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Re-adding<sp/>a<sp/>spent<sp/>coin<sp/>can<sp/>happen<sp/>in<sp/>the<sp/>case<sp/>of<sp/>a<sp/>re-org<sp/>(the<sp/>coin</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>is<sp/>&apos;spent&apos;<sp/>when<sp/>the<sp/>block<sp/>adding<sp/>it<sp/>is<sp/>disconnected<sp/>and<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>re-added<sp/>when<sp/>it<sp/>is<sp/>also<sp/>added<sp/>in<sp/>a<sp/>newly<sp/>connected<sp/>block).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>coin<sp/>doesn&apos;t<sp/>exist<sp/>in<sp/>the<sp/>current<sp/>cache,<sp/>or<sp/>is<sp/>spent<sp/>but<sp/>not</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>DIRTY,<sp/>then<sp/>it<sp/>can<sp/>be<sp/>marked<sp/>FRESH.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fresh<sp/>=<sp/>!it-&gt;second.IsDirty();</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!inserted)<sp/>{</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a8c1d785094f8ac4c2ace4dee99bcbe37" kindref="member">cachedCoinsUsage</ref><sp/>-=<sp/>it-&gt;second.coin.DynamicMemoryUsage();</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/>it-&gt;second.coin<sp/>=<sp/>std::move(coin);</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_c_coins_cache_entry_1ae648a5fc9150ce651456b8f45e4af7d7" kindref="member">CCoinsCacheEntry::SetDirty</ref>(*it,<sp/><ref refid="class_c_coins_view_cache_1a6a970d45d413eb7695ee5c862c57a542" kindref="member">m_sentinel</ref>);</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fresh)<sp/><ref refid="struct_c_coins_cache_entry_1af89b52459db336190ad8c4ee3c4cffac" kindref="member">CCoinsCacheEntry::SetFresh</ref>(*it,<sp/><ref refid="class_c_coins_view_cache_1a6a970d45d413eb7695ee5c862c57a542" kindref="member">m_sentinel</ref>);</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a8c1d785094f8ac4c2ace4dee99bcbe37" kindref="member">cachedCoinsUsage</ref><sp/>+=<sp/>it-&gt;second.coin.DynamicMemoryUsage();</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="trace_8h_1ae7d4767c75c045d7e4d4b840fb4a8e5f" kindref="member">TRACEPOINT</ref>(utxocache,<sp/>add,</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>outpoint.<ref refid="class_c_out_point_1a021232319a9e2a4d04c8c9a95e66c96f" kindref="member">hash</ref>.<ref refid="classtransaction__identifier_1a0a74bc1365c4626988042de05dfa34f1" kindref="member">data</ref>(),</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(uint32_t)outpoint.<ref refid="class_c_out_point_1a3d8a9527a2ee4a7ebf59175650142e75" kindref="member">n</ref>,</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(uint32_t)it-&gt;second.coin.nHeight,</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(int64_t)it-&gt;second.coin.out.nValue,</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">bool</highlight><highlight class="normal">)it-&gt;second.coin.IsCoinBase());</highlight></codeline>
<codeline lineno="111"><highlight class="normal">}</highlight></codeline>
<codeline lineno="112"><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1afc256d69d7ad6be668f44626db665929" kindref="member">CCoinsViewCache::EmplaceCoinInternalDANGER</ref>(<ref refid="class_c_out_point" kindref="compound">COutPoint</ref>&amp;&amp;<sp/>outpoint,<sp/><ref refid="class_coin" kindref="compound">Coin</ref>&amp;&amp;<sp/>coin)<sp/>{</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>mem_usage{coin.DynamicMemoryUsage()};</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>[it,<sp/>inserted]<sp/>=<sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.try_emplace(std::move(outpoint),<sp/>std::move(coin));</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(inserted)<sp/>{</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_c_coins_cache_entry_1ae648a5fc9150ce651456b8f45e4af7d7" kindref="member">CCoinsCacheEntry::SetDirty</ref>(*it,<sp/><ref refid="class_c_coins_view_cache_1a6a970d45d413eb7695ee5c862c57a542" kindref="member">m_sentinel</ref>);</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a8c1d785094f8ac4c2ace4dee99bcbe37" kindref="member">cachedCoinsUsage</ref><sp/>+=<sp/>mem_usage;</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="120"><highlight class="normal">}</highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="coins_8cpp_1ae4190d2c27c3c27c7fb6ad026ca11beb" kindref="member">AddCoins</ref>(<ref refid="class_c_coins_view_cache" kindref="compound">CCoinsViewCache</ref>&amp;<sp/>cache,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_transaction" kindref="compound">CTransaction</ref><sp/>&amp;tx,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="mempool__ephemeral__spends_8cpp_1a2e4c6b811457a16b7033af6741cfb1db" kindref="member">nHeight</ref>,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>check_for_overwrite)<sp/>{</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>fCoinbase<sp/>=<sp/>tx.<ref refid="class_c_transaction_1a6b4def31a0a2fbc975d0087ad2d4391a" kindref="member">IsCoinBase</ref>();</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="transaction__identifier_8h_1ac4bb3c35b94889843d632be4de4b223c" kindref="member">Txid</ref>&amp;<sp/>txid<sp/>=<sp/>tx.<ref refid="class_c_transaction_1a919ff1093793433f4717d74fb751423b" kindref="member">GetHash</ref>();</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>tx.<ref refid="class_c_transaction_1ab6db6ccb0e8e9a2442296af044a29d56" kindref="member">vout</ref>.size();<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>overwrite<sp/>=<sp/>check_for_overwrite<sp/>?<sp/>cache.<ref refid="class_c_coins_view_cache_1a57c7063d0b2cb3900509d8a9e91a8459" kindref="member">HaveCoin</ref>(<ref refid="class_c_out_point" kindref="compound">COutPoint</ref>(txid,<sp/>i))<sp/>:<sp/>fCoinbase;</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Coinbase<sp/>transactions<sp/>can<sp/>always<sp/>be<sp/>overwritten,<sp/>in<sp/>order<sp/>to<sp/>correctly</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>deal<sp/>with<sp/>the<sp/>pre-BIP30<sp/>occurrences<sp/>of<sp/>duplicate<sp/>coinbase<sp/>transactions.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cache.<ref refid="class_c_coins_view_cache_1a0fe5f056188a32c5ae94aa19e1351698" kindref="member">AddCoin</ref>(<ref refid="class_c_out_point" kindref="compound">COutPoint</ref>(txid,<sp/>i),<sp/><ref refid="class_coin" kindref="compound">Coin</ref>(tx.<ref refid="class_c_transaction_1ab6db6ccb0e8e9a2442296af044a29d56" kindref="member">vout</ref>[i],<sp/><ref refid="mempool__ephemeral__spends_8cpp_1a2e4c6b811457a16b7033af6741cfb1db" kindref="member">nHeight</ref>,<sp/>fCoinbase),<sp/>overwrite);</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="131"><highlight class="normal">}</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1af5547d7b4e71fcf9319ab7a12f7f20e0" kindref="member">CCoinsViewCache::SpendCoin</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_out_point" kindref="compound">COutPoint</ref><sp/>&amp;outpoint,<sp/><ref refid="class_coin" kindref="compound">Coin</ref>*<sp/>moveout)<sp/>{</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/>CCoinsMap::iterator<sp/>it<sp/>=<sp/>FetchCoin(outpoint);</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(it<sp/>==<sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.end())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a8c1d785094f8ac4c2ace4dee99bcbe37" kindref="member">cachedCoinsUsage</ref><sp/>-=<sp/>it-&gt;second.coin.DynamicMemoryUsage();</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="trace_8h_1ae7d4767c75c045d7e4d4b840fb4a8e5f" kindref="member">TRACEPOINT</ref>(utxocache,<sp/>spent,</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>outpoint.<ref refid="class_c_out_point_1a021232319a9e2a4d04c8c9a95e66c96f" kindref="member">hash</ref>.<ref refid="classtransaction__identifier_1a0a74bc1365c4626988042de05dfa34f1" kindref="member">data</ref>(),</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(uint32_t)outpoint.<ref refid="class_c_out_point_1a3d8a9527a2ee4a7ebf59175650142e75" kindref="member">n</ref>,</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(uint32_t)it-&gt;second.coin.nHeight,</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(int64_t)it-&gt;second.coin.out.nValue,</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">bool</highlight><highlight class="normal">)it-&gt;second.coin.IsCoinBase());</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(moveout)<sp/>{</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*moveout<sp/>=<sp/>std::move(it-&gt;second.coin);</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(it-&gt;second.IsFresh())<sp/>{</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.erase(it);</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_c_coins_cache_entry_1ae648a5fc9150ce651456b8f45e4af7d7" kindref="member">CCoinsCacheEntry::SetDirty</ref>(*it,<sp/><ref refid="class_c_coins_view_cache_1a6a970d45d413eb7695ee5c862c57a542" kindref="member">m_sentinel</ref>);</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>it-&gt;second.coin.Clear();</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="153"><highlight class="normal">}</highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_coin" kindref="compound">Coin</ref><sp/>coinEmpty;</highlight></codeline>
<codeline lineno="156"><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_coin" kindref="compound">Coin</ref>&amp;<sp/><ref refid="class_c_coins_view_cache_1a87f1f2449e10859291ddbdc1d090cba3" kindref="member">CCoinsViewCache::AccessCoin</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_out_point" kindref="compound">COutPoint</ref><sp/>&amp;outpoint)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/>CCoinsMap::const_iterator<sp/>it<sp/>=<sp/>FetchCoin(outpoint);</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(it<sp/>==<sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.end())<sp/>{</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>coinEmpty;</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>it-&gt;second.coin;</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="164"><highlight class="normal">}</highlight></codeline>
<codeline lineno="165"><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1a57c7063d0b2cb3900509d8a9e91a8459" kindref="member">CCoinsViewCache::HaveCoin</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_out_point" kindref="compound">COutPoint</ref><sp/>&amp;outpoint)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/>CCoinsMap::const_iterator<sp/>it<sp/>=<sp/>FetchCoin(outpoint);</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(it<sp/>!=<sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.end()<sp/>&amp;&amp;<sp/>!it-&gt;second.coin.IsSpent());</highlight></codeline>
<codeline lineno="169"><highlight class="normal">}</highlight></codeline>
<codeline lineno="170"><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1a546edde7d3db81c9fa65e8ad55195f7e" kindref="member">CCoinsViewCache::HaveCoinInCache</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_out_point" kindref="compound">COutPoint</ref><sp/>&amp;outpoint)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/>CCoinsMap::const_iterator<sp/>it<sp/>=<sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.find(outpoint);</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(it<sp/>!=<sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.end()<sp/>&amp;&amp;<sp/>!it-&gt;second.coin.IsSpent());</highlight></codeline>
<codeline lineno="174"><highlight class="normal">}</highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><ref refid="classuint256" kindref="compound">uint256</ref><sp/><ref refid="class_c_coins_view_cache_1a357197e89d0c22e33f9e58b3dac685ff" kindref="member">CCoinsViewCache::GetBestBlock</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_c_coins_view_cache_1ac39f229fd16f40a5743453adc110dfb4" kindref="member">hashBlock</ref>.IsNull())</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1ac39f229fd16f40a5743453adc110dfb4" kindref="member">hashBlock</ref><sp/>=<sp/><ref refid="class_c_coins_view_backed_1a96ab1be7e47c893d0ef009276e7ca8af" kindref="member">base</ref>-&gt;GetBestBlock();</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1ac39f229fd16f40a5743453adc110dfb4" kindref="member">hashBlock</ref>;</highlight></codeline>
<codeline lineno="180"><highlight class="normal">}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1ae3eca32d352e35141dee0a90d5d29b09" kindref="member">CCoinsViewCache::SetBestBlock</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref><sp/>&amp;hashBlockIn)<sp/>{</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1ac39f229fd16f40a5743453adc110dfb4" kindref="member">hashBlock</ref><sp/>=<sp/>hashBlockIn;</highlight></codeline>
<codeline lineno="184"><highlight class="normal">}</highlight></codeline>
<codeline lineno="185"><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1a56d539fa8b1427ee21191bd0690b96d7" kindref="member">CCoinsViewCache::BatchWrite</ref>(<ref refid="struct_coins_view_cache_cursor" kindref="compound">CoinsViewCacheCursor</ref>&amp;<sp/>cursor,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref><sp/>&amp;hashBlockIn)<sp/>{</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>it{cursor.<ref refid="struct_coins_view_cache_cursor_1a15f48f1acfbaa01d37624b124f2a1380" kindref="member">Begin</ref>()};<sp/>it<sp/>!=<sp/>cursor.<ref refid="struct_coins_view_cache_cursor_1ac8dec2d9ae50424e274b9ead7f918394" kindref="member">End</ref>();<sp/>it<sp/>=<sp/>cursor.<ref refid="struct_coins_view_cache_cursor_1a45f955f98a96c700415c265067fb36ce" kindref="member">NextAndMaybeErase</ref>(*it))<sp/>{</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!it-&gt;second.IsDirty())<sp/>{<sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>a<sp/>cursor<sp/>can<sp/>only<sp/>contain<sp/>dirty<sp/>entries</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>[itUs,<sp/>inserted]{<ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.try_emplace(it-&gt;first)};</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(inserted)<sp/>{</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(it-&gt;second.IsFresh()<sp/>&amp;&amp;<sp/>it-&gt;second.coin.IsSpent())<sp/>{</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.erase(itUs);<sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>fresh<sp/>coins<sp/>should<sp/>have<sp/>been<sp/>removed<sp/>at<sp/>spend</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>parent<sp/>cache<sp/>does<sp/>not<sp/>have<sp/>an<sp/>entry,<sp/>while<sp/>the<sp/>child<sp/>cache<sp/>does.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Move<sp/>the<sp/>data<sp/>up<sp/>and<sp/>mark<sp/>it<sp/>as<sp/>dirty.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CCoinsCacheEntry&amp;<sp/>entry{itUs-&gt;second};</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(entry.<ref refid="struct_c_coins_cache_entry_1ab59e55b114996a58cf056cbc7296037d" kindref="member">coin</ref>.<ref refid="class_coin_1afcc22204abc15aeefd5d1f7396e909a4" kindref="member">DynamicMemoryUsage</ref>()<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(cursor.<ref refid="struct_coins_view_cache_cursor_1aa0202b2599a0d8d029f5a8f277d7dd31" kindref="member">WillErase</ref>(*it))<sp/>{</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Since<sp/>this<sp/>entry<sp/>will<sp/>be<sp/>erased,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>can<sp/>move<sp/>the<sp/>coin<sp/>into<sp/>us<sp/>instead<sp/>of<sp/>copying<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>entry.<ref refid="struct_c_coins_cache_entry_1ab59e55b114996a58cf056cbc7296037d" kindref="member">coin</ref><sp/>=<sp/>std::move(it-&gt;second.coin);</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>entry.<ref refid="struct_c_coins_cache_entry_1ab59e55b114996a58cf056cbc7296037d" kindref="member">coin</ref><sp/>=<sp/>it-&gt;second.coin;</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a8c1d785094f8ac4c2ace4dee99bcbe37" kindref="member">cachedCoinsUsage</ref><sp/>+=<sp/>entry.<ref refid="struct_c_coins_cache_entry_1ab59e55b114996a58cf056cbc7296037d" kindref="member">coin</ref>.<ref refid="class_coin_1afcc22204abc15aeefd5d1f7396e909a4" kindref="member">DynamicMemoryUsage</ref>();</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_c_coins_cache_entry_1ae648a5fc9150ce651456b8f45e4af7d7" kindref="member">CCoinsCacheEntry::SetDirty</ref>(*itUs,<sp/><ref refid="class_c_coins_view_cache_1a6a970d45d413eb7695ee5c862c57a542" kindref="member">m_sentinel</ref>);</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>can<sp/>mark<sp/>it<sp/>FRESH<sp/>in<sp/>the<sp/>parent<sp/>if<sp/>it<sp/>was<sp/>FRESH<sp/>in<sp/>the<sp/>child</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Otherwise<sp/>it<sp/>might<sp/>have<sp/>just<sp/>been<sp/>flushed<sp/>from<sp/>the<sp/>parent&apos;s<sp/>cache</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>already<sp/>exist<sp/>in<sp/>the<sp/>grandparent</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(it-&gt;second.IsFresh())<sp/><ref refid="struct_c_coins_cache_entry_1af89b52459db336190ad8c4ee3c4cffac" kindref="member">CCoinsCacheEntry::SetFresh</ref>(*itUs,<sp/><ref refid="class_c_coins_view_cache_1a6a970d45d413eb7695ee5c862c57a542" kindref="member">m_sentinel</ref>);</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Found<sp/>the<sp/>entry<sp/>in<sp/>the<sp/>parent<sp/>cache</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(it-&gt;second.IsFresh()<sp/>&amp;&amp;<sp/>!itUs-&gt;second.coin.IsSpent())<sp/>{</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>coin<sp/>was<sp/>marked<sp/>FRESH<sp/>in<sp/>the<sp/>child<sp/>cache,<sp/>but<sp/>the<sp/>coin</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>exists<sp/>in<sp/>the<sp/>parent<sp/>cache.<sp/>If<sp/>this<sp/>ever<sp/>happens,<sp/>it<sp/>means</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>FRESH<sp/>flag<sp/>was<sp/>misapplied<sp/>and<sp/>there<sp/>is<sp/>a<sp/>logic<sp/>error<sp/>in</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>calling<sp/>code.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/>std::logic_error(</highlight><highlight class="stringliteral">&quot;FRESH<sp/>flag<sp/>misapplied<sp/>to<sp/>coin<sp/>that<sp/>exists<sp/>in<sp/>parent<sp/>cache&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="223"><highlight class="normal"></highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(itUs-&gt;second.IsFresh()<sp/>&amp;&amp;<sp/>it-&gt;second.coin.IsSpent())<sp/>{</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>grandparent<sp/>cache<sp/>does<sp/>not<sp/>have<sp/>an<sp/>entry,<sp/>and<sp/>the<sp/>coin</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>has<sp/>been<sp/>spent.<sp/>We<sp/>can<sp/>just<sp/>delete<sp/>it<sp/>from<sp/>the<sp/>parent<sp/>cache.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a8c1d785094f8ac4c2ace4dee99bcbe37" kindref="member">cachedCoinsUsage</ref><sp/>-=<sp/>itUs-&gt;second.coin.DynamicMemoryUsage();</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.erase(itUs);</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>normal<sp/>modification.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a8c1d785094f8ac4c2ace4dee99bcbe37" kindref="member">cachedCoinsUsage</ref><sp/>-=<sp/>itUs-&gt;second.coin.DynamicMemoryUsage();</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(cursor.<ref refid="struct_coins_view_cache_cursor_1aa0202b2599a0d8d029f5a8f277d7dd31" kindref="member">WillErase</ref>(*it))<sp/>{</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Since<sp/>this<sp/>entry<sp/>will<sp/>be<sp/>erased,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>can<sp/>move<sp/>the<sp/>coin<sp/>into<sp/>us<sp/>instead<sp/>of<sp/>copying<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>itUs-&gt;second.coin<sp/>=<sp/>std::move(it-&gt;second.coin);</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>itUs-&gt;second.coin<sp/>=<sp/>it-&gt;second.coin;</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a8c1d785094f8ac4c2ace4dee99bcbe37" kindref="member">cachedCoinsUsage</ref><sp/>+=<sp/>itUs-&gt;second.coin.DynamicMemoryUsage();</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_c_coins_cache_entry_1ae648a5fc9150ce651456b8f45e4af7d7" kindref="member">CCoinsCacheEntry::SetDirty</ref>(*itUs,<sp/><ref refid="class_c_coins_view_cache_1a6a970d45d413eb7695ee5c862c57a542" kindref="member">m_sentinel</ref>);</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>NOTE:<sp/>It<sp/>isn&apos;t<sp/>safe<sp/>to<sp/>mark<sp/>the<sp/>coin<sp/>as<sp/>FRESH<sp/>in<sp/>the<sp/>parent</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>cache.<sp/>If<sp/>it<sp/>already<sp/>existed<sp/>and<sp/>was<sp/>spent<sp/>in<sp/>the<sp/>parent</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>cache<sp/>then<sp/>marking<sp/>it<sp/>FRESH<sp/>would<sp/>prevent<sp/>that<sp/>spentness</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>from<sp/>being<sp/>flushed<sp/>to<sp/>the<sp/>grandparent.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1ac39f229fd16f40a5743453adc110dfb4" kindref="member">hashBlock</ref><sp/>=<sp/>hashBlockIn;</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="250"><highlight class="normal">}</highlight></codeline>
<codeline lineno="251"><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1a166e3b1951caaaf582e7b67c5be762ce" kindref="member">CCoinsViewCache::Flush</ref>(</highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>will_reuse_cache)<sp/>{</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>cursor{CoinsViewCacheCursor(<ref refid="class_c_coins_view_cache_1a6a970d45d413eb7695ee5c862c57a542" kindref="member">m_sentinel</ref>,<sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>,<sp/></highlight><highlight class="comment">/*will_erase=*/</highlight><highlight class="keyword">true</highlight><highlight class="normal">)};</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>fOk<sp/>=<sp/><ref refid="class_c_coins_view_backed_1a96ab1be7e47c893d0ef009276e7ca8af" kindref="member">base</ref>-&gt;BatchWrite(cursor,<sp/><ref refid="class_c_coins_view_cache_1ac39f229fd16f40a5743453adc110dfb4" kindref="member">hashBlock</ref>);</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fOk)<sp/>{</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.clear();</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(will_reuse_cache)<sp/>{</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a63f689c5d5987ded578ddb4874f08a63" kindref="member">ReallocateCache</ref>();</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a8c1d785094f8ac4c2ace4dee99bcbe37" kindref="member">cachedCoinsUsage</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>fOk;</highlight></codeline>
<codeline lineno="263"><highlight class="normal">}</highlight></codeline>
<codeline lineno="264"><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1a071d010e76ac762ffab420fcf90656a4" kindref="member">CCoinsViewCache::Sync</ref>()</highlight></codeline>
<codeline lineno="266"><highlight class="normal">{</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>cursor{CoinsViewCacheCursor(<ref refid="class_c_coins_view_cache_1a6a970d45d413eb7695ee5c862c57a542" kindref="member">m_sentinel</ref>,<sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>,<sp/></highlight><highlight class="comment">/*will_erase=*/</highlight><highlight class="keyword">false</highlight><highlight class="normal">)};</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>fOk<sp/>=<sp/><ref refid="class_c_coins_view_backed_1a96ab1be7e47c893d0ef009276e7ca8af" kindref="member">base</ref>-&gt;BatchWrite(cursor,<sp/><ref refid="class_c_coins_view_cache_1ac39f229fd16f40a5743453adc110dfb4" kindref="member">hashBlock</ref>);</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fOk)<sp/>{</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_c_coins_view_cache_1a6a970d45d413eb7695ee5c862c57a542" kindref="member">m_sentinel</ref>.second.Next()<sp/>!=<sp/>&amp;<ref refid="class_c_coins_view_cache_1a6a970d45d413eb7695ee5c862c57a542" kindref="member">m_sentinel</ref>)<sp/>{</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>BatchWrite<sp/>must<sp/>clear<sp/>flags<sp/>of<sp/>all<sp/>entries<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/>std::logic_error(</highlight><highlight class="stringliteral">&quot;Not<sp/>all<sp/>unspent<sp/>flagged<sp/>entries<sp/>were<sp/>cleared&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>fOk;</highlight></codeline>
<codeline lineno="276"><highlight class="normal">}</highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1ad79839a8f70a58de19104ac6bfbb5ae8" kindref="member">CCoinsViewCache::Uncache</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_out_point" kindref="compound">COutPoint</ref>&amp;<sp/>hash)</highlight></codeline>
<codeline lineno="279"><highlight class="normal">{</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/>CCoinsMap::iterator<sp/>it<sp/>=<sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.find(hash);</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(it<sp/>!=<sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.end()<sp/>&amp;&amp;<sp/>!it-&gt;second.IsDirty()<sp/>&amp;&amp;<sp/>!it-&gt;second.IsFresh())<sp/>{</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a8c1d785094f8ac4c2ace4dee99bcbe37" kindref="member">cachedCoinsUsage</ref><sp/>-=<sp/>it-&gt;second.coin.DynamicMemoryUsage();</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="trace_8h_1ae7d4767c75c045d7e4d4b840fb4a8e5f" kindref="member">TRACEPOINT</ref>(utxocache,<sp/>uncache,</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hash.<ref refid="class_c_out_point_1a021232319a9e2a4d04c8c9a95e66c96f" kindref="member">hash</ref>.<ref refid="classtransaction__identifier_1a0a74bc1365c4626988042de05dfa34f1" kindref="member">data</ref>(),</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(uint32_t)hash.<ref refid="class_c_out_point_1a3d8a9527a2ee4a7ebf59175650142e75" kindref="member">n</ref>,</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(uint32_t)it-&gt;second.coin.nHeight,</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(int64_t)it-&gt;second.coin.out.nValue,</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">bool</highlight><highlight class="normal">)it-&gt;second.coin.IsCoinBase());</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.erase(it);</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="291"><highlight class="normal">}</highlight></codeline>
<codeline lineno="292"><highlight class="normal"></highlight></codeline>
<codeline lineno="293"><highlight class="normal"></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1af787027ef08bdf3db72110265cc4f055" kindref="member">CCoinsViewCache::GetCacheSize</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.size();</highlight></codeline>
<codeline lineno="295"><highlight class="normal">}</highlight></codeline>
<codeline lineno="296"><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1aed3ee6fa10e37a5f22862b45e8abb3b4" kindref="member">CCoinsViewCache::HaveInputs</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_transaction" kindref="compound">CTransaction</ref>&amp;<sp/>tx)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="298"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!tx.<ref refid="class_c_transaction_1a6b4def31a0a2fbc975d0087ad2d4391a" kindref="member">IsCoinBase</ref>())<sp/>{</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>tx.<ref refid="class_c_transaction_1aaed1b4913ffce3eaaf4c5e13aa09d27f" kindref="member">vin</ref>.size();<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="class_c_coins_view_cache_1a57c7063d0b2cb3900509d8a9e91a8459" kindref="member">HaveCoin</ref>(tx.<ref refid="class_c_transaction_1aaed1b4913ffce3eaaf4c5e13aa09d27f" kindref="member">vin</ref>[i].prevout))<sp/>{</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="307"><highlight class="normal">}</highlight></codeline>
<codeline lineno="308"><highlight class="normal"></highlight></codeline>
<codeline lineno="309"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1a63f689c5d5987ded578ddb4874f08a63" kindref="member">CCoinsViewCache::ReallocateCache</ref>()</highlight></codeline>
<codeline lineno="310"><highlight class="normal">{</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Cache<sp/>should<sp/>be<sp/>empty<sp/>when<sp/>we&apos;re<sp/>calling<sp/>this.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.size()<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>.~CCoinsMap();</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_coins_view_cache_1a1bba2e27d1155e615224665ac117e1f2" kindref="member">m_cache_coins_memory_resource</ref>.~CCoinsMapMemoryResource();</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/>::new<sp/>(&amp;<ref refid="class_c_coins_view_cache_1a1bba2e27d1155e615224665ac117e1f2" kindref="member">m_cache_coins_memory_resource</ref>)<sp/><ref refid="coins_8h_1ad512438d571689179e69cf922c01bcc8" kindref="member">CCoinsMapMemoryResource</ref>{};</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/>::new<sp/>(&amp;<ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>)<sp/><ref refid="coins_8h_1abb6c00f4f94a3084a430d1848fed7697" kindref="member">CCoinsMap</ref>{0,<sp/>SaltedOutpointHasher{</highlight><highlight class="comment">/*deterministic=*/</highlight><highlight class="normal">m_deterministic},<sp/>CCoinsMap::key_equal{},<sp/>&amp;<ref refid="class_c_coins_view_cache_1a1bba2e27d1155e615224665ac117e1f2" kindref="member">m_cache_coins_memory_resource</ref>};</highlight></codeline>
<codeline lineno="317"><highlight class="normal">}</highlight></codeline>
<codeline lineno="318"><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache_1a234d9f2765fec4cf82214f30a06813aa" kindref="member">CCoinsViewCache::SanityCheck</ref>()</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="320"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>recomputed_usage<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>count_flagged<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>[<ref refid="translation_8h_1a4f2d958035f4051a605124ebe248de38" kindref="member">_</ref>,<sp/>entry]<sp/>:<sp/><ref refid="class_c_coins_view_cache_1a7923587df4fa5cc22ab7b68c34f74c94" kindref="member">cacheCoins</ref>)<sp/>{</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>attr<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(entry.<ref refid="struct_c_coins_cache_entry_1a74d2adb4706dfe4ba36553f5ab9f74a7" kindref="member">IsDirty</ref>())<sp/>attr<sp/>|=<sp/>1;</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(entry.<ref refid="struct_c_coins_cache_entry_1a13d3777ce953e5a4984a09fcdd396e0d" kindref="member">IsFresh</ref>())<sp/>attr<sp/>|=<sp/>2;</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(entry.<ref refid="struct_c_coins_cache_entry_1ab59e55b114996a58cf056cbc7296037d" kindref="member">coin</ref>.<ref refid="class_coin_1ae0032141d9e76130a91e97e19eaad1ec" kindref="member">IsSpent</ref>())<sp/>attr<sp/>|=<sp/>4;</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Only<sp/>5<sp/>combinations<sp/>are<sp/>possible.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(attr<sp/>!=<sp/>2<sp/>&amp;&amp;<sp/>attr<sp/>!=<sp/>4<sp/>&amp;&amp;<sp/>attr<sp/>!=<sp/>7);</highlight></codeline>
<codeline lineno="330"><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Recompute<sp/>cachedCoinsUsage.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>recomputed_usage<sp/>+=<sp/>entry.<ref refid="struct_c_coins_cache_entry_1ab59e55b114996a58cf056cbc7296037d" kindref="member">coin</ref>.<ref refid="class_coin_1afcc22204abc15aeefd5d1f7396e909a4" kindref="member">DynamicMemoryUsage</ref>();</highlight></codeline>
<codeline lineno="333"><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Count<sp/>the<sp/>number<sp/>of<sp/>entries<sp/>we<sp/>expect<sp/>in<sp/>the<sp/>linked<sp/>list.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(entry.<ref refid="struct_c_coins_cache_entry_1a74d2adb4706dfe4ba36553f5ab9f74a7" kindref="member">IsDirty</ref>()<sp/>||<sp/>entry.<ref refid="struct_c_coins_cache_entry_1a13d3777ce953e5a4984a09fcdd396e0d" kindref="member">IsFresh</ref>())<sp/>++count_flagged;</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>over<sp/>the<sp/>linked<sp/>list<sp/>of<sp/>flagged<sp/>entries.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>count_linked<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>it<sp/>=<sp/><ref refid="class_c_coins_view_cache_1a6a970d45d413eb7695ee5c862c57a542" kindref="member">m_sentinel</ref>.second.Next();<sp/>it<sp/>!=<sp/>&amp;<ref refid="class_c_coins_view_cache_1a6a970d45d413eb7695ee5c862c57a542" kindref="member">m_sentinel</ref>;<sp/>it<sp/>=<sp/>it-&gt;second.Next())<sp/>{</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Verify<sp/>linked<sp/>list<sp/>integrity.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(it-&gt;second.Next()-&gt;second.Prev()<sp/>==<sp/>it);</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(it-&gt;second.Prev()-&gt;second.Next()<sp/>==<sp/>it);</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Verify<sp/>they<sp/>are<sp/>actually<sp/>flagged.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(it-&gt;second.IsDirty()<sp/>||<sp/>it-&gt;second.IsFresh());</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Count<sp/>the<sp/>number<sp/>of<sp/>entries<sp/>actually<sp/>in<sp/>the<sp/>list.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>++count_linked;</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(count_linked<sp/>==<sp/>count_flagged);</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(recomputed_usage<sp/>==<sp/><ref refid="class_c_coins_view_cache_1a8c1d785094f8ac4c2ace4dee99bcbe37" kindref="member">cachedCoinsUsage</ref>);</highlight></codeline>
<codeline lineno="350"><highlight class="normal">}</highlight></codeline>
<codeline lineno="351"><highlight class="normal"></highlight></codeline>
<codeline lineno="352"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint64_t<sp/>MIN_TRANSACTION_OUTPUT_WEIGHT{WITNESS_SCALE_FACTOR<sp/>*<sp/><ref refid="serialize_8h_1ac0154eb0a74cc852efc55684de85b1f5" kindref="member">::GetSerializeSize</ref>(<ref refid="class_c_tx_out" kindref="compound">CTxOut</ref>())};</highlight></codeline>
<codeline lineno="353"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint64_t<sp/>MAX_OUTPUTS_PER_BLOCK{MAX_BLOCK_WEIGHT<sp/>/<sp/>MIN_TRANSACTION_OUTPUT_WEIGHT};</highlight></codeline>
<codeline lineno="354"><highlight class="normal"></highlight></codeline>
<codeline lineno="355"><highlight class="normal"></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_coin" kindref="compound">Coin</ref>&amp;<sp/><ref refid="coins_8cpp_1ae1198ec42f88d653cdc627aabbdb1ff9" kindref="member">AccessByTxid</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_cache" kindref="compound">CCoinsViewCache</ref>&amp;<sp/>view,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="transaction__identifier_8h_1ac4bb3c35b94889843d632be4de4b223c" kindref="member">Txid</ref>&amp;<sp/>txid)</highlight></codeline>
<codeline lineno="356"><highlight class="normal">{</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_out_point" kindref="compound">COutPoint</ref><sp/>iter(txid,<sp/>0);</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(iter.n<sp/>&lt;<sp/>MAX_OUTPUTS_PER_BLOCK)<sp/>{</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_coin" kindref="compound">Coin</ref>&amp;<sp/>alternate<sp/>=<sp/>view.<ref refid="class_c_coins_view_cache_1a87f1f2449e10859291ddbdc1d090cba3" kindref="member">AccessCoin</ref>(iter);</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!alternate.<ref refid="class_coin_1ae0032141d9e76130a91e97e19eaad1ec" kindref="member">IsSpent</ref>())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>alternate;</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>++iter.n;</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>coinEmpty;</highlight></codeline>
<codeline lineno="364"><highlight class="normal">}</highlight></codeline>
<codeline lineno="365"><highlight class="normal"></highlight></codeline>
<codeline lineno="366"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>ReturnType,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>Func&gt;</highlight></codeline>
<codeline lineno="367"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>ReturnType<sp/>ExecuteBackedWrapper(Func<sp/>func,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::vector&lt;std::function&lt;</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">()&gt;&gt;&amp;<sp/>err_callbacks)</highlight></codeline>
<codeline lineno="368"><highlight class="normal">{</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>func();</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal">(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::runtime_error&amp;<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>f<sp/>:<sp/>err_callbacks)<sp/>{</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f();</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="logging_8h_1a611dbbfa5c2f148b7190b97a12835b5e" kindref="member">LogError</ref>(</highlight><highlight class="stringliteral">&quot;Error<sp/>reading<sp/>from<sp/>database:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>e.what());</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Starting<sp/>the<sp/>shutdown<sp/>sequence<sp/>and<sp/>returning<sp/>false<sp/>to<sp/>the<sp/>caller<sp/>would<sp/>be</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>interpreted<sp/>as<sp/>&apos;entry<sp/>not<sp/>found&apos;<sp/>(as<sp/>opposed<sp/>to<sp/>unable<sp/>to<sp/>read<sp/>data),<sp/>and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>could<sp/>lead<sp/>to<sp/>invalid<sp/>interpretation.<sp/>Just<sp/>exit<sp/>immediately,<sp/>as<sp/>we<sp/>can&apos;t</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>continue<sp/>anyway,<sp/>and<sp/>all<sp/>writes<sp/>should<sp/>be<sp/>atomic.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::abort();</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="382"><highlight class="normal">}</highlight></codeline>
<codeline lineno="383"><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal">std::optional&lt;Coin&gt;<sp/><ref refid="class_c_coins_view_error_catcher_1a053700fd896babb8aa62fc7c53dd27f6" kindref="member">CCoinsViewErrorCatcher::GetCoin</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_out_point" kindref="compound">COutPoint</ref>&amp;<sp/>outpoint)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="385"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ExecuteBackedWrapper&lt;std::optional&lt;Coin&gt;&gt;([&amp;]()<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_backed_1a053700fd896babb8aa62fc7c53dd27f6" kindref="member">CCoinsViewBacked::GetCoin</ref>(outpoint);<sp/>},<sp/>m_err_callbacks);</highlight></codeline>
<codeline lineno="387"><highlight class="normal">}</highlight></codeline>
<codeline lineno="388"><highlight class="normal"></highlight></codeline>
<codeline lineno="389"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_error_catcher_1a57c7063d0b2cb3900509d8a9e91a8459" kindref="member">CCoinsViewErrorCatcher::HaveCoin</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_out_point" kindref="compound">COutPoint</ref>&amp;<sp/>outpoint)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="390"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ExecuteBackedWrapper&lt;bool&gt;([&amp;]()<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_c_coins_view_backed_1a57c7063d0b2cb3900509d8a9e91a8459" kindref="member">CCoinsViewBacked::HaveCoin</ref>(outpoint);<sp/>},<sp/>m_err_callbacks);</highlight></codeline>
<codeline lineno="392"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="src/coins.cpp"/>
  </compounddef>
</doxygen>
