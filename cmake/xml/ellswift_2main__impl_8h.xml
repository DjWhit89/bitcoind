<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="ellswift_2main__impl_8h" kind="file" language="C++">
    <compoundname>main_impl.h</compoundname>
    <includes refid="secp256k1_8h" local="yes">../../../include/secp256k1.h</includes>
    <includes refid="secp256k1__ellswift_8h" local="yes">../../../include/secp256k1_ellswift.h</includes>
    <includes refid="eckey_8h" local="yes">../../eckey.h</includes>
    <includes refid="secp256k1_2src_2hash_8h" local="yes">../../hash.h</includes>
    <includedby refid="ellswift_2tests__exhaustive__impl_8h" local="yes">src/secp256k1/src/modules/ellswift/tests_exhaustive_impl.h</includedby>
    <incdepgraph>
      <node id="2">
        <label>../../../include/secp256k1.h</label>
        <link refid="secp256k1_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>../../../include/secp256k1_ellswift.h</label>
        <link refid="secp256k1__ellswift_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
      </node>
      <node id="9">
        <label>checkmem.h</label>
        <link refid="checkmem_8h"/>
      </node>
      <node id="5">
        <label>../../eckey.h</label>
        <link refid="eckey_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="32">
        <label>ecmult.h</label>
        <link refid="ecmult_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="34">
        <label>ecmult_gen.h</label>
        <link refid="ecmult__gen_8h"/>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="7">
        <label>field.h</label>
        <link refid="field_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="29">
        <label>field_5x52.h</label>
        <link refid="field__5x52_8h"/>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="6">
        <label>group.h</label>
        <link refid="group_8h"/>
        <childnode refid="7" relation="include">
        </childnode>
      </node>
      <node id="35">
        <label>../../hash.h</label>
        <link refid="secp256k1_2src_2hash_8h"/>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>src/secp256k1/src/modules/ellswift/main_impl.h</label>
        <link refid="ellswift_2main__impl_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
      </node>
      <node id="30">
        <label>scalar.h</label>
        <link refid="scalar_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="31">
        <label>scalar_4x64.h</label>
        <link refid="scalar__4x64_8h"/>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="33">
        <label>scratch.h</label>
        <link refid="scratch_8h"/>
      </node>
      <node id="8">
        <label>util.h</label>
        <link refid="secp256k1_2src_2util_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
      </node>
      <node id="11">
        <label>span.h</label>
        <link refid="span_8h"/>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="10">
        <label>string.h</label>
        <link refid="string_8h"/>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
      </node>
      <node id="17">
        <label>array</label>
      </node>
      <node id="12">
        <label>cassert</label>
      </node>
      <node id="13">
        <label>cstddef</label>
      </node>
      <node id="18">
        <label>cstdint</label>
      </node>
      <node id="19">
        <label>cstring</label>
      </node>
      <node id="28">
        <label>limits.h</label>
      </node>
      <node id="20">
        <label>locale</label>
      </node>
      <node id="14">
        <label>span</label>
      </node>
      <node id="21">
        <label>sstream</label>
      </node>
      <node id="3">
        <label>stddef.h</label>
      </node>
      <node id="26">
        <label>stdint.h</label>
      </node>
      <node id="27">
        <label>stdio.h</label>
      </node>
      <node id="25">
        <label>stdlib.h</label>
      </node>
      <node id="22">
        <label>string</label>
      </node>
      <node id="23">
        <label>string_view</label>
      </node>
      <node id="15">
        <label>type_traits</label>
      </node>
      <node id="16">
        <label>utility</label>
      </node>
      <node id="24">
        <label>vector</label>
      </node>
    </incdepgraph>
    <invincdepgraph>
      <node id="1">
        <label>src/secp256k1/src/modules/ellswift/main_impl.h</label>
        <link refid="ellswift_2main__impl_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>src/secp256k1/src/modules/ellswift/tests_exhaustive_impl.h</label>
        <link refid="ellswift_2tests__exhaustive__impl_8h"/>
      </node>
    </invincdepgraph>
    <sectiondef kind="var">
      <memberdef kind="variable" id="ellswift_2main__impl_8h_1af24b3cb2f2e5a5e5df530282ab7cd930" prot="public" static="yes" mutable="no">
        <type>const <ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref></type>
        <definition>const secp256k1_fe secp256k1_ellswift_c1</definition>
        <argsstring></argsstring>
        <name>secp256k1_ellswift_c1</name>
        <initializer>= <ref refid="field_8h_1a8c00ba3d97ea0d9b0d461463e890de15" kindref="member">SECP256K1_FE_CONST</ref>(0x851695d4, 0x9a83f8ef, 0x919bb861, 0x53cbcb16, 0x630fb68a, 0xed0a766a, 0x3ec693d6, 0x8e6afa40)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>c1 = (sqrt(-3)-1)/2 </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="15" column="27" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="15" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="ellswift_2main__impl_8h_1a6bb31fdbe3966633d92e867d4ba2016b" prot="public" static="yes" mutable="no">
        <type>const <ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref></type>
        <definition>const secp256k1_fe secp256k1_ellswift_c2</definition>
        <argsstring></argsstring>
        <name>secp256k1_ellswift_c2</name>
        <initializer>= <ref refid="field_8h_1a8c00ba3d97ea0d9b0d461463e890de15" kindref="member">SECP256K1_FE_CONST</ref>(0x7ae96a2b, 0x657c0710, 0x6e64479e, 0xac3434e9, 0x9cf04975, 0x12f58995, 0xc1396c28, 0x719501ee)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>c2 = (-sqrt(-3)-1)/2 = -(c1+1) </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="17" column="27" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="17" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="ellswift_2main__impl_8h_1a5448fb9d65bde103fdd4ac60c7542d48" prot="public" static="yes" mutable="no">
        <type>const <ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref></type>
        <definition>const secp256k1_fe secp256k1_ellswift_c3</definition>
        <argsstring></argsstring>
        <name>secp256k1_ellswift_c3</name>
        <initializer>= <ref refid="field_8h_1a8c00ba3d97ea0d9b0d461463e890de15" kindref="member">SECP256K1_FE_CONST</ref>(0x7ae96a2b, 0x657c0710, 0x6e64479e, 0xac3434e9, 0x9cf04975, 0x12f58995, 0xc1396c28, 0x719501ef)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>c3 = (-sqrt(-3)+1)/2 = -c1 = c2+1 </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="19" column="27" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="19" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="ellswift_2main__impl_8h_1a5e3c2335e9c2283bdfe03919f76dc5d7" prot="public" static="yes" mutable="no">
        <type>const <ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref></type>
        <definition>const secp256k1_fe secp256k1_ellswift_c4</definition>
        <argsstring></argsstring>
        <name>secp256k1_ellswift_c4</name>
        <initializer>= <ref refid="field_8h_1a8c00ba3d97ea0d9b0d461463e890de15" kindref="member">SECP256K1_FE_CONST</ref>(0x851695d4, 0x9a83f8ef, 0x919bb861, 0x53cbcb16, 0x630fb68a, 0xed0a766a, 0x3ec693d6, 0x8e6afa41)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>c4 = (sqrt(-3)+1)/2 = -c2 = c1+1 </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="21" column="27" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="21" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="ellswift_2main__impl_8h_1a2e7ab4d967f95dddbbcf9a72f067ca1f" prot="public" static="no" mutable="no">
        <type>const <ref refid="secp256k1__ellswift_8h_1ac1ac7f0ce1fa1f4bbbe054c3128a5640" kindref="member">secp256k1_ellswift_xdh_hash_function</ref></type>
        <definition>const secp256k1_ellswift_xdh_hash_function secp256k1_ellswift_xdh_hash_function_prefix</definition>
        <argsstring></argsstring>
        <name>secp256k1_ellswift_xdh_hash_function_prefix</name>
        <initializer>= ellswift_xdh_hash_function_prefix</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="548" column="44" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="548" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="ellswift_2main__impl_8h_1a9e66d67ac918016de7350e0acfe9bcda" prot="public" static="no" mutable="no">
        <type>const <ref refid="secp256k1__ellswift_8h_1ac1ac7f0ce1fa1f4bbbe054c3128a5640" kindref="member">secp256k1_ellswift_xdh_hash_function</ref></type>
        <definition>const secp256k1_ellswift_xdh_hash_function secp256k1_ellswift_xdh_hash_function_bip324</definition>
        <argsstring></argsstring>
        <name>secp256k1_ellswift_xdh_hash_function_bip324</name>
        <initializer>= ellswift_xdh_hash_function_bip324</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="549" column="44" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="549" bodyend="-1"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="func">
      <memberdef kind="function" id="ellswift_2main__impl_8h_1aa65a0c01dcb15aa84a34da36fbf847aa" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_ellswift_xswiftec_frac_var</definition>
        <argsstring>(secp256k1_fe *xn, secp256k1_fe *xd, const secp256k1_fe *u, const secp256k1_fe *t)</argsstring>
        <name>secp256k1_ellswift_xswiftec_frac_var</name>
        <param>
          <type><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>xn</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>xd</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>u</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>t</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Decode ElligatorSwift encoding (u, t) to a fraction xn/xd representing a curve X coordinate. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="24" column="13" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="24" bodyend="132"/>
      </memberdef>
      <memberdef kind="function" id="ellswift_2main__impl_8h_1a5e440e84a3839c1bb9b7248d34e75c81" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_ellswift_xswiftec_var</definition>
        <argsstring>(secp256k1_fe *x, const secp256k1_fe *u, const secp256k1_fe *t)</argsstring>
        <name>secp256k1_ellswift_xswiftec_var</name>
        <param>
          <type><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>x</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>u</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>t</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Decode ElligatorSwift encoding (u, t) to X coordinate. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="135" column="13" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="135" bodyend="140"/>
      </memberdef>
      <memberdef kind="function" id="ellswift_2main__impl_8h_1a1d0cccf13a84b7b00c929959fc7d38c1" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_ellswift_swiftec_var</definition>
        <argsstring>(secp256k1_ge *p, const secp256k1_fe *u, const secp256k1_fe *t)</argsstring>
        <name>secp256k1_ellswift_swiftec_var</name>
        <param>
          <type><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>u</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>t</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Decode ElligatorSwift encoding (u, t) to point P. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="143" column="13" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="143" bodyend="147"/>
      </memberdef>
      <memberdef kind="function" id="ellswift_2main__impl_8h_1ab384abf496214701b2a748a84a905a05" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_ellswift_xswiftec_inv_var</definition>
        <argsstring>(secp256k1_fe *t, const secp256k1_fe *x_in, const secp256k1_fe *u_in, int c)</argsstring>
        <name>secp256k1_ellswift_xswiftec_inv_var</name>
        <param>
          <type><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>t</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>x_in</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>u_in</declname>
        </param>
        <param>
          <type>int</type>
          <declname>c</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="168" column="12" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="168" bodyend="303"/>
      </memberdef>
      <memberdef kind="function" id="ellswift_2main__impl_8h_1adf6d531979054e7cc0b1b288de3d3acc" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_ellswift_prng</definition>
        <argsstring>(unsigned char *out32, const secp256k1_sha256 *hasher, uint32_t cnt)</argsstring>
        <name>secp256k1_ellswift_prng</name>
        <param>
          <type>unsigned char *</type>
          <declname>out32</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref> *</type>
          <declname>hasher</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>cnt</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Use SHA256 as a PRNG, returning SHA256(hasher || cnt).</para>
<para>hasher is a SHA256 object to which an incrementing 4-byte counter is written to generate randomness. Writing 13 bytes (4 bytes for counter, plus 9 bytes for the SHA256 padding) cannot cross a 64-byte block size boundary (to make sure it only triggers a single SHA256 compression). </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="310" column="13" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="310" bodyend="325"/>
      </memberdef>
      <memberdef kind="function" id="ellswift_2main__impl_8h_1a85c53b4a602b5f689309a1f403cdfdce" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_ellswift_xelligatorswift_var</definition>
        <argsstring>(unsigned char *u32, secp256k1_fe *t, const secp256k1_fe *x, const secp256k1_sha256 *hasher)</argsstring>
        <name>secp256k1_ellswift_xelligatorswift_var</name>
        <param>
          <type>unsigned char *</type>
          <declname>u32</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>t</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>x</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref> *</type>
          <declname>hasher</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Find an ElligatorSwift encoding (u, t) for X coordinate x, and random Y coordinate.</para>
<para><ref refid="crypto__diff__fuzz__chacha20_8cpp_1a10e94b422ef0c20dcdec20d31a1f5049" kindref="member">u32</ref> is the 32-byte big endian encoding of u; t is the output field element t that still needs encoding.</para>
<para>hasher is a hasher in the secp256k1_ellswift_prng sense, with the same restrictions. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="333" column="13" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="333" bodyend="367"/>
      </memberdef>
      <memberdef kind="function" id="ellswift_2main__impl_8h_1ab27e8735982b6346429f366197975026" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_ellswift_elligatorswift_var</definition>
        <argsstring>(unsigned char *u32, secp256k1_fe *t, const secp256k1_ge *p, const secp256k1_sha256 *hasher)</argsstring>
        <name>secp256k1_ellswift_elligatorswift_var</name>
        <param>
          <type>unsigned char *</type>
          <declname>u32</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>t</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref> *</type>
          <declname>hasher</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Find an ElligatorSwift encoding (u, t) for point P.</para>
<para>This is similar secp256k1_ellswift_xelligatorswift_var, except it takes a full group element p as input, and returns an encoding that matches the provided Y coordinate rather than a random one. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="375" column="13" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="375" bodyend="382"/>
      </memberdef>
      <memberdef kind="function" id="ellswift_2main__impl_8h_1ac6105325c7ae5821b959a8f1fae4cd65" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_ellswift_sha256_init_encode</definition>
        <argsstring>(secp256k1_sha256 *hash)</argsstring>
        <name>secp256k1_ellswift_sha256_init_encode</name>
        <param>
          <type><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref> *</type>
          <declname>hash</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Set hash state to the BIP340 tagged hash midstate for &quot;secp256k1_ellswift_encode&quot;. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="385" column="13" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="385" bodyend="397"/>
      </memberdef>
      <memberdef kind="function" id="ellswift_2main__impl_8h_1ae507a00028bb585ea530824d15630dc6" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_ellswift_encode</definition>
        <argsstring>(const secp256k1_context *ctx, unsigned char *ell64, const secp256k1_pubkey *pubkey, const unsigned char *rnd32)</argsstring>
        <name>secp256k1_ellswift_encode</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type>unsigned char *</type>
          <declname>ell64</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref> *</type>
          <declname>pubkey</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>rnd32</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Construct a 64-byte ElligatorSwift encoding of a given pubkey.</para>
<para>Returns: 1 always. Args: ctx: pointer to a context object Out: ell64: pointer to a 64-byte array to be filled In: pubkey: pointer to a <ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref> containing an initialized public key rnd32: pointer to 32 bytes of randomness</para>
<para>It is recommended that rnd32 consists of 32 uniformly random bytes, not known to any adversary trying to detect whether public keys are being encoded, though 16 bytes of randomness (padded to an array of 32 bytes, e.g., with zeros) suffice to make the result indistinguishable from uniform. The randomness in rnd32 must not be a deterministic function of the pubkey (it can be derived from the private key, though).</para>
<para>It is not guaranteed that the computed encoding is stable across versions of the library, even if all arguments to this function (including rnd32) are the same.</para>
<para>This function runs in variable time. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="399" column="5" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="399" bodyend="433"/>
      </memberdef>
      <memberdef kind="function" id="ellswift_2main__impl_8h_1a6185814e3988795c56bc96324d9dae75" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_ellswift_sha256_init_create</definition>
        <argsstring>(secp256k1_sha256 *hash)</argsstring>
        <name>secp256k1_ellswift_sha256_init_create</name>
        <param>
          <type><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref> *</type>
          <declname>hash</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Set hash state to the BIP340 tagged hash midstate for &quot;secp256k1_ellswift_create&quot;. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="436" column="13" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="436" bodyend="448"/>
      </memberdef>
      <memberdef kind="function" id="ellswift_2main__impl_8h_1a48e79201d56ff62c5e952647ac1563e7" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_ellswift_create</definition>
        <argsstring>(const secp256k1_context *ctx, unsigned char *ell64, const unsigned char *seckey32, const unsigned char *auxrnd32)</argsstring>
        <name>secp256k1_ellswift_create</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type>unsigned char *</type>
          <declname>ell64</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>seckey32</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>auxrnd32</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Compute an ElligatorSwift public key for a secret key.</para>
<para>Returns: 1: secret was valid, public key was stored. 0: secret was invalid, try again. Args: ctx: pointer to a context object (not secp256k1_context_static) Out: ell64: pointer to a 64-byte array to receive the ElligatorSwift public key In: seckey32: pointer to a 32-byte secret key auxrnd32: (optional) pointer to 32 bytes of randomness</para>
<para>Constant time in seckey and auxrnd32, but not in the resulting public key.</para>
<para>It is recommended that auxrnd32 contains 32 uniformly random bytes, though it is optional (and does result in encodings that are indistinguishable from uniform even without any auxrnd32). It differs from the (mandatory) rnd32 argument to secp256k1_ellswift_encode in this regard.</para>
<para>This function can be used instead of calling secp256k1_ec_pubkey_create followed by secp256k1_ellswift_encode. It is safer, as it uses the secret key as entropy for the encoding (supplemented with auxrnd32, if provided).</para>
<para>Like secp256k1_ellswift_encode, this function does not guarantee that the computed encoding is stable across versions of the library, even if all arguments (including auxrnd32) are the same. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="450" column="5" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="450" bodyend="487"/>
      </memberdef>
      <memberdef kind="function" id="ellswift_2main__impl_8h_1ae88ee4e67572f02768f89e5cc0f271a7" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_ellswift_decode</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_pubkey *pubkey, const unsigned char *ell64)</argsstring>
        <name>secp256k1_ellswift_decode</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref> *</type>
          <declname>pubkey</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>ell64</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Decode a 64-bytes ElligatorSwift encoded public key.</para>
<para>Returns: always 1 Args: ctx: pointer to a context object Out: pubkey: pointer to a <ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref> that will be filled In: ell64: pointer to a 64-byte array to decode</para>
<para>This function runs in variable time. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="489" column="5" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="489" bodyend="502"/>
      </memberdef>
      <memberdef kind="function" id="ellswift_2main__impl_8h_1a9386ff52dce89ce759a335850568d053" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int ellswift_xdh_hash_function_prefix</definition>
        <argsstring>(unsigned char *output, const unsigned char *x32, const unsigned char *ell_a64, const unsigned char *ell_b64, void *data)</argsstring>
        <name>ellswift_xdh_hash_function_prefix</name>
        <param>
          <type>unsigned char *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>x32</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>ell_a64</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>ell_b64</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="504" column="12" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="504" bodyend="516"/>
      </memberdef>
      <memberdef kind="function" id="ellswift_2main__impl_8h_1aba9ebaf513ff40a08dba52163622167e" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_ellswift_sha256_init_bip324</definition>
        <argsstring>(secp256k1_sha256 *hash)</argsstring>
        <name>secp256k1_ellswift_sha256_init_bip324</name>
        <param>
          <type><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref> *</type>
          <declname>hash</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Set hash state to the BIP340 tagged hash midstate for &quot;bip324_ellswift_xonly_ecdh&quot;. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="519" column="13" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="519" bodyend="531"/>
      </memberdef>
      <memberdef kind="function" id="ellswift_2main__impl_8h_1abc167a11cff1bd369e791d0191435eb5" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int ellswift_xdh_hash_function_bip324</definition>
        <argsstring>(unsigned char *output, const unsigned char *x32, const unsigned char *ell_a64, const unsigned char *ell_b64, void *data)</argsstring>
        <name>ellswift_xdh_hash_function_bip324</name>
        <param>
          <type>unsigned char *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>x32</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>ell_a64</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>ell_b64</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="533" column="12" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="533" bodyend="546"/>
      </memberdef>
      <memberdef kind="function" id="ellswift_2main__impl_8h_1a4b4ed069c280c8d4caea2afa7e43779a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_ellswift_xdh</definition>
        <argsstring>(const secp256k1_context *ctx, unsigned char *output, const unsigned char *ell_a64, const unsigned char *ell_b64, const unsigned char *seckey32, int party, secp256k1_ellswift_xdh_hash_function hashfp, void *data)</argsstring>
        <name>secp256k1_ellswift_xdh</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type>unsigned char *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>ell_a64</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>ell_b64</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>seckey32</declname>
        </param>
        <param>
          <type>int</type>
          <declname>party</declname>
        </param>
        <param>
          <type><ref refid="secp256k1__ellswift_8h_1ac1ac7f0ce1fa1f4bbbe054c3128a5640" kindref="member">secp256k1_ellswift_xdh_hash_function</ref></type>
          <declname>hashfp</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Given a private key, and ElligatorSwift public keys sent in both directions, compute a shared secret using x-only Elliptic Curve Diffie-Hellman (ECDH).</para>
<para>Returns: 1: shared secret was successfully computed 0: secret was invalid or hashfp returned 0 Args: ctx: pointer to a context object. Out: output: pointer to an array to be filled by hashfp. In: ell_a64: pointer to the 64-byte encoded public key of party A (will not be NULL) ell_b64: pointer to the 64-byte encoded public key of party B (will not be NULL) seckey32: pointer to our 32-byte secret key party: boolean indicating which party we are: zero if we are party A, non-zero if we are party B. seckey32 must be the private key corresponding to that party&apos;s ell_?64. This correspondence is not checked. hashfp: pointer to a hash function. data: arbitrary data pointer passed through to hashfp.</para>
<para>Constant time in seckey32.</para>
<para>This function is more efficient than decoding the public keys, and performing ECDH on them. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/ellswift/main_impl.h" line="551" column="5" bodyfile="src/secp256k1/src/modules/ellswift/main_impl.h" bodystart="551" bodyend="590"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/***********************************************************************</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>Distributed<sp/>under<sp/>the<sp/>MIT<sp/>software<sp/>license,<sp/>see<sp/>the<sp/>accompanying<sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>file<sp/>COPYING<sp/>or<sp/>https://www.opensource.org/licenses/mit-license.php.*</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>***********************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>SECP256K1_MODULE_ELLSWIFT_MAIN_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>SECP256K1_MODULE_ELLSWIFT_MAIN_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="secp256k1_8h" kindref="compound">../../../include/secp256k1.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="secp256k1__ellswift_8h" kindref="compound">../../../include/secp256k1_ellswift.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="eckey_8h" kindref="compound">../../eckey.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="secp256k1_2src_2hash_8h" kindref="compound">../../hash.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>secp256k1_ellswift_c1<sp/>=<sp/><ref refid="field_8h_1a8c00ba3d97ea0d9b0d461463e890de15" kindref="member">SECP256K1_FE_CONST</ref>(0x851695d4,<sp/>0x9a83f8ef,<sp/>0x919bb861,<sp/>0x53cbcb16,<sp/>0x630fb68a,<sp/>0xed0a766a,<sp/>0x3ec693d6,<sp/>0x8e6afa40);</highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>secp256k1_ellswift_c2<sp/>=<sp/><ref refid="field_8h_1a8c00ba3d97ea0d9b0d461463e890de15" kindref="member">SECP256K1_FE_CONST</ref>(0x7ae96a2b,<sp/>0x657c0710,<sp/>0x6e64479e,<sp/>0xac3434e9,<sp/>0x9cf04975,<sp/>0x12f58995,<sp/>0xc1396c28,<sp/>0x719501ee);</highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>secp256k1_ellswift_c3<sp/>=<sp/><ref refid="field_8h_1a8c00ba3d97ea0d9b0d461463e890de15" kindref="member">SECP256K1_FE_CONST</ref>(0x7ae96a2b,<sp/>0x657c0710,<sp/>0x6e64479e,<sp/>0xac3434e9,<sp/>0x9cf04975,<sp/>0x12f58995,<sp/>0xc1396c28,<sp/>0x719501ef);</highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>secp256k1_ellswift_c4<sp/>=<sp/><ref refid="field_8h_1a8c00ba3d97ea0d9b0d461463e890de15" kindref="member">SECP256K1_FE_CONST</ref>(0x851695d4,<sp/>0x9a83f8ef,<sp/>0x919bb861,<sp/>0x53cbcb16,<sp/>0x630fb68a,<sp/>0xed0a766a,<sp/>0x3ec693d6,<sp/>0x8e6afa41);</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_ellswift_xswiftec_frac_var(<ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*xn,<sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*xd,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*u,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>)<sp/>{</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>implemented<sp/>algorithm<sp/>is<sp/>the<sp/>following<sp/>(all<sp/>operations<sp/>in<sp/>GF(p)):</highlight></codeline>
<codeline lineno="26"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="27"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Let<sp/>c0<sp/>=<sp/>sqrt(-3)<sp/>=<sp/>0xa2d2ba93507f1df233770c2a797962cc61f6d15da14ecd47d8d27ae1cd5f852.</highlight></codeline>
<codeline lineno="28"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>u<sp/>=<sp/>0,<sp/>set<sp/>u<sp/>=<sp/>1.</highlight></codeline>
<codeline lineno="29"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>t<sp/>=<sp/>0,<sp/>set<sp/>t<sp/>=<sp/>1.</highlight></codeline>
<codeline lineno="30"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>u^3+7+t^2<sp/>=<sp/>0,<sp/>set<sp/>t<sp/>=<sp/>2*t.</highlight></codeline>
<codeline lineno="31"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Let<sp/>X<sp/>=<sp/>(u^3+7-t^2)/(2*t).</highlight></codeline>
<codeline lineno="32"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Let<sp/>Y<sp/>=<sp/>(X+t)/(c0*u).</highlight></codeline>
<codeline lineno="33"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>x3<sp/>=<sp/>u+4*Y^2<sp/>is<sp/>a<sp/>valid<sp/>x<sp/>coordinate,<sp/>return<sp/>it.</highlight></codeline>
<codeline lineno="34"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>x2<sp/>=<sp/>(-X/Y-u)/2<sp/>is<sp/>a<sp/>valid<sp/>x<sp/>coordinate,<sp/>return<sp/>it.</highlight></codeline>
<codeline lineno="35"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Return<sp/>x1<sp/>=<sp/>(X/Y-u)/2<sp/>(which<sp/>is<sp/>now<sp/>guaranteed<sp/>to<sp/>be<sp/>a<sp/>valid<sp/>x<sp/>coordinate).</highlight></codeline>
<codeline lineno="36"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="37"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>Introducing<sp/>s=t^2,<sp/>g=u^3+7,<sp/>and<sp/>simplifying<sp/>x1=-(x2+u)<sp/>we<sp/>get:</highlight></codeline>
<codeline lineno="38"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="39"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Let<sp/>c0<sp/>=<sp/>...</highlight></codeline>
<codeline lineno="40"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>u<sp/>=<sp/>0,<sp/>set<sp/>u<sp/>=<sp/>1.</highlight></codeline>
<codeline lineno="41"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>t<sp/>=<sp/>0,<sp/>set<sp/>t<sp/>=<sp/>1.</highlight></codeline>
<codeline lineno="42"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Let<sp/>s<sp/>=<sp/>t^2</highlight></codeline>
<codeline lineno="43"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Let<sp/>g<sp/>=<sp/>u^3+7</highlight></codeline>
<codeline lineno="44"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>g+s<sp/>=<sp/>0,<sp/>set<sp/>t<sp/>=<sp/>2*t,<sp/>s<sp/>=<sp/>4*s</highlight></codeline>
<codeline lineno="45"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Let<sp/>X<sp/>=<sp/>(g-s)/(2*t).</highlight></codeline>
<codeline lineno="46"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Let<sp/>Y<sp/>=<sp/>(X+t)/(c0*u)<sp/>=<sp/>(g+s)/(2*c0*t*u).</highlight></codeline>
<codeline lineno="47"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>x3<sp/>=<sp/>u+4*Y^2<sp/>is<sp/>a<sp/>valid<sp/>x<sp/>coordinate,<sp/>return<sp/>it.</highlight></codeline>
<codeline lineno="48"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>x2<sp/>=<sp/>(-X/Y-u)/2<sp/>is<sp/>a<sp/>valid<sp/>x<sp/>coordinate,<sp/>return<sp/>it.</highlight></codeline>
<codeline lineno="49"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Return<sp/>x1<sp/>=<sp/>-(x2+u).</highlight></codeline>
<codeline lineno="50"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="51"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>Now<sp/>substitute<sp/>Y^2<sp/>=<sp/>-(g+s)^2/(12*s*u^2)<sp/>and<sp/>X/Y<sp/>=<sp/>c0*u*(g-s)/(g+s).<sp/>This</highlight></codeline>
<codeline lineno="52"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>means<sp/>X<sp/>and<sp/>Y<sp/>do<sp/>not<sp/>need<sp/>to<sp/>be<sp/>evaluated<sp/>explicitly<sp/>anymore.</highlight></codeline>
<codeline lineno="53"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="54"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>...</highlight></codeline>
<codeline lineno="55"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>g+s<sp/>=<sp/>0,<sp/>set<sp/>s<sp/>=<sp/>4*s.</highlight></codeline>
<codeline lineno="56"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>x3<sp/>=<sp/>u-(g+s)^2/(3*s*u^2)<sp/>is<sp/>a<sp/>valid<sp/>x<sp/>coordinate,<sp/>return<sp/>it.</highlight></codeline>
<codeline lineno="57"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>x2<sp/>=<sp/>(-c0*u*(g-s)/(g+s)-u)/2<sp/>is<sp/>a<sp/>valid<sp/>x<sp/>coordinate,<sp/>return<sp/>it.</highlight></codeline>
<codeline lineno="58"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Return<sp/>x1<sp/>=<sp/>-(x2+u).</highlight></codeline>
<codeline lineno="59"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="60"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>Simplifying<sp/>x2<sp/>using<sp/>2<sp/>additional<sp/>constants:</highlight></codeline>
<codeline lineno="61"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="62"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Let<sp/>c1<sp/>=<sp/>(c0-1)/2<sp/>=<sp/>0x851695d49a83f8ef919bb86153cbcb16630fb68aed0a766a3ec693d68e6afa40.</highlight></codeline>
<codeline lineno="63"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Let<sp/>c2<sp/>=<sp/>(-c0-1)/2<sp/>=<sp/>0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee.</highlight></codeline>
<codeline lineno="64"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>...</highlight></codeline>
<codeline lineno="65"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>x2<sp/>=<sp/>u*(c1*s+c2*g)/(g+s)<sp/>is<sp/>a<sp/>valid<sp/>x<sp/>coordinate,<sp/>return<sp/>it.</highlight></codeline>
<codeline lineno="66"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>...</highlight></codeline>
<codeline lineno="67"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="68"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>Writing<sp/>x3<sp/>as<sp/>a<sp/>fraction:</highlight></codeline>
<codeline lineno="69"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="70"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>...</highlight></codeline>
<codeline lineno="71"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>x3<sp/>=<sp/>(3*s*u^3-(g+s)^2)/(3*s*u^2)<sp/>...</highlight></codeline>
<codeline lineno="72"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>...</highlight></codeline>
<codeline lineno="73"><highlight class="comment"></highlight></codeline>
<codeline lineno="74"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>Overall,<sp/>we<sp/>get:</highlight></codeline>
<codeline lineno="75"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="76"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Let<sp/>c1<sp/>=<sp/>0x851695d49a83f8ef919bb86153cbcb16630fb68aed0a766a3ec693d68e6afa40.</highlight></codeline>
<codeline lineno="77"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Let<sp/>c2<sp/>=<sp/>0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee.</highlight></codeline>
<codeline lineno="78"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>u<sp/>=<sp/>0,<sp/>set<sp/>u<sp/>=<sp/>1.</highlight></codeline>
<codeline lineno="79"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>t<sp/>=<sp/>0,<sp/>set<sp/>s<sp/>=<sp/>1,<sp/>else<sp/>set<sp/>s<sp/>=<sp/>t^2.</highlight></codeline>
<codeline lineno="80"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Let<sp/>g<sp/>=<sp/>u^3+7.</highlight></codeline>
<codeline lineno="81"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>g+s<sp/>=<sp/>0,<sp/>set<sp/>s<sp/>=<sp/>4*s.</highlight></codeline>
<codeline lineno="82"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>x3<sp/>=<sp/>(3*s*u^3-(g+s)^2)/(3*s*u^2)<sp/>is<sp/>a<sp/>valid<sp/>x<sp/>coordinate,<sp/>return<sp/>it.</highlight></codeline>
<codeline lineno="83"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>x2<sp/>=<sp/>u*(c1*s+c2*g)/(g+s)<sp/>is<sp/>a<sp/>valid<sp/>x<sp/>coordinate,<sp/>return<sp/>it.</highlight></codeline>
<codeline lineno="84"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Return<sp/>x1<sp/>=<sp/>-(x2+u).</highlight></codeline>
<codeline lineno="85"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>u1,<sp/><ref refid="namespacetest__vectors__musig2__generate_1a5fcf9c70fa717a8efd481752dcb8ffa4" kindref="member">s</ref>,<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>,<sp/>p,<sp/>d,<sp/>n,<sp/>l;</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/>u1<sp/>=<sp/>*u;</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="minisketch_2src_2util_8h_1a76e8a689f16456e44a2cc438a6821025" kindref="member">EXPECT</ref>(<ref refid="field_8h_1a1cb62d54d1ee78cf102b68fa54dc279b" kindref="member">secp256k1_fe_normalizes_to_zero_var</ref>(&amp;u1),<sp/>0))<sp/>u1<sp/>=<sp/>secp256k1_fe_one;</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1ad9dea8392967835e0e925f808c0e563f" kindref="member">secp256k1_fe_sqr</ref>(&amp;s,<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>);</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="minisketch_2src_2util_8h_1a76e8a689f16456e44a2cc438a6821025" kindref="member">EXPECT</ref>(<ref refid="field_8h_1a1cb62d54d1ee78cf102b68fa54dc279b" kindref="member">secp256k1_fe_normalizes_to_zero_var</ref>(<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>),<sp/>0))<sp/><ref refid="namespacetest__vectors__musig2__generate_1a5fcf9c70fa717a8efd481752dcb8ffa4" kindref="member">s</ref><sp/>=<sp/>secp256k1_fe_one;</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1ad9dea8392967835e0e925f808c0e563f" kindref="member">secp256k1_fe_sqr</ref>(&amp;l,<sp/>&amp;u1);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>l<sp/>=<sp/>u^2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>,<sp/>&amp;l,<sp/>&amp;u1);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>g<sp/>=<sp/>u^3<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1af1125dec014cc84f3f62cbed8be95fc8" kindref="member">secp256k1_fe_add_int</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>,<sp/><ref refid="group__impl_8h_1a6ac7906b0db18f65df2909faefce2416" kindref="member">SECP256K1_B</ref>);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>g<sp/>=<sp/>u^3<sp/>+<sp/>7<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>p<sp/>=<sp/>g<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a781758016240ae593998306356388ab0" kindref="member">secp256k1_fe_add</ref>(&amp;p,<sp/>&amp;s);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>p<sp/>=<sp/>g+s<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="minisketch_2src_2util_8h_1a76e8a689f16456e44a2cc438a6821025" kindref="member">EXPECT</ref>(<ref refid="field_8h_1a1cb62d54d1ee78cf102b68fa54dc279b" kindref="member">secp256k1_fe_normalizes_to_zero_var</ref>(&amp;p),<sp/>0))<sp/>{</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a1b53120e78e87f77227520c8a8d15245" kindref="member">secp256k1_fe_mul_int</ref>(&amp;s,<sp/>4);</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Recompute<sp/>p<sp/>=<sp/>g+s<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>p<sp/>=<sp/>g<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a781758016240ae593998306356388ab0" kindref="member">secp256k1_fe_add</ref>(&amp;p,<sp/>&amp;s);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>p<sp/>=<sp/>g+s<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;d,<sp/>&amp;s,<sp/>&amp;l);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>d<sp/>=<sp/>s*u^2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a1b53120e78e87f77227520c8a8d15245" kindref="member">secp256k1_fe_mul_int</ref>(&amp;d,<sp/>3);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>d<sp/>=<sp/>3*s*u^2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1ad9dea8392967835e0e925f808c0e563f" kindref="member">secp256k1_fe_sqr</ref>(&amp;l,<sp/>&amp;p);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>l<sp/>=<sp/>(g+s)^2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a10e9ec8d30dca4e992dd0f9075beb574" kindref="member">secp256k1_fe_negate</ref>(&amp;l,<sp/>&amp;l,<sp/>1);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>l<sp/>=<sp/>-(g+s)^2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;n,<sp/>&amp;d,<sp/>&amp;u1);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>n<sp/>=<sp/>3*s*u^3<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a781758016240ae593998306356388ab0" kindref="member">secp256k1_fe_add</ref>(&amp;n,<sp/>&amp;l);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>n<sp/>=<sp/>3*s*u^3-(g+s)^2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(secp256k1_ge_x_frac_on_curve_var(&amp;n,<sp/>&amp;d))<sp/>{</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Return<sp/>x3<sp/>=<sp/>n/d<sp/>=<sp/>(3*s*u^3-(g+s)^2)/(3*s*u^2)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*xn<sp/>=<sp/>n;</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*xd<sp/>=<sp/>d;</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/>*xd<sp/>=<sp/>p;</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;l,<sp/>&amp;secp256k1_ellswift_c1,<sp/>&amp;s);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>l<sp/>=<sp/>c1*s<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;n,<sp/>&amp;secp256k1_ellswift_c2,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>n<sp/>=<sp/>c2*g<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a781758016240ae593998306356388ab0" kindref="member">secp256k1_fe_add</ref>(&amp;n,<sp/>&amp;l);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>n<sp/>=<sp/>c1*s+c2*g<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;n,<sp/>&amp;n,<sp/>&amp;u1);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>n<sp/>=<sp/>u*(c1*s+c2*g)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Possible<sp/>optimization:<sp/>in<sp/>the<sp/>invocation<sp/>below,<sp/>p^2<sp/>=<sp/>(g+s)^2<sp/>is<sp/>computed,</highlight></codeline>
<codeline lineno="120"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>which<sp/>we<sp/>already<sp/>have<sp/>computed<sp/>above.<sp/>This<sp/>could<sp/>be<sp/>deduplicated.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(secp256k1_ge_x_frac_on_curve_var(&amp;n,<sp/>&amp;p))<sp/>{</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Return<sp/>x2<sp/>=<sp/>n/p<sp/>=<sp/>u*(c1*s+c2*g)/(g+s)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*xn<sp/>=<sp/>n;</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;l,<sp/>&amp;p,<sp/>&amp;u1);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>l<sp/>=<sp/>u*(g+s)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a781758016240ae593998306356388ab0" kindref="member">secp256k1_fe_add</ref>(&amp;n,<sp/>&amp;l);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>n<sp/>=<sp/>u*(c1*s+c2*g)+u*(g+s)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a10e9ec8d30dca4e992dd0f9075beb574" kindref="member">secp256k1_fe_negate</ref>(xn,<sp/>&amp;n,<sp/>2);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>n<sp/>=<sp/>-u*(c1*s+c2*g)-u*(g+s)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(secp256k1_ge_x_frac_on_curve_var(xn,<sp/>&amp;p));</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Return<sp/>x3<sp/>=<sp/>n/p<sp/>=<sp/>-(u*(c1*s+c2*g)/(g+s)+u)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal">}</highlight></codeline>
<codeline lineno="133"><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_ellswift_xswiftec_var(<ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*x,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*u,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>)<sp/>{</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>xn,<sp/>xd;</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ellswift_xswiftec_frac_var(&amp;xn,<sp/>&amp;xd,<sp/>u,<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>);</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a94d9a1f4c5b138e81471289c8596afe5" kindref="member">secp256k1_fe_inv_var</ref>(&amp;xd,<sp/>&amp;xd);</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(x,<sp/>&amp;xn,<sp/>&amp;xd);</highlight></codeline>
<codeline lineno="140"><highlight class="normal">}</highlight></codeline>
<codeline lineno="141"><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_ellswift_swiftec_var(<ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*p,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*u,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>)<sp/>{</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>x;</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ellswift_xswiftec_var(&amp;x,<sp/>u,<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>);</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ge_set_xo_var(p,<sp/>&amp;x,<sp/><ref refid="field_8h_1a5bcecb31c985b8cd07086ffc254b7902" kindref="member">secp256k1_fe_is_odd</ref>(<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>));</highlight></codeline>
<codeline lineno="147"><highlight class="normal">}</highlight></codeline>
<codeline lineno="148"><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Try<sp/>to<sp/>complete<sp/>an<sp/>ElligatorSwift<sp/>encoding<sp/>(u,<sp/>t)<sp/>for<sp/>X<sp/>coordinate<sp/>x,<sp/>given<sp/>u<sp/>and<sp/>x.</highlight></codeline>
<codeline lineno="150"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="151"><highlight class="comment"><sp/>*<sp/>There<sp/>may<sp/>be<sp/>up<sp/>to<sp/>8<sp/>distinct<sp/>t<sp/>values<sp/>such<sp/>that<sp/>(u,<sp/>t)<sp/>decodes<sp/>back<sp/>to<sp/>x,<sp/>but<sp/>also</highlight></codeline>
<codeline lineno="152"><highlight class="comment"><sp/>*<sp/>fewer,<sp/>or<sp/>none<sp/>at<sp/>all.<sp/>Each<sp/>such<sp/>partial<sp/>inverse<sp/>can<sp/>be<sp/>accessed<sp/>individually<sp/>using<sp/>a</highlight></codeline>
<codeline lineno="153"><highlight class="comment"><sp/>*<sp/>distinct<sp/>input<sp/>argument<sp/>c<sp/>(in<sp/>range<sp/>0-7),<sp/>and<sp/>some<sp/>or<sp/>all<sp/>of<sp/>these<sp/>may<sp/>return<sp/>failure.</highlight></codeline>
<codeline lineno="154"><highlight class="comment"><sp/>*<sp/>The<sp/>following<sp/>guarantees<sp/>exist:</highlight></codeline>
<codeline lineno="155"><highlight class="comment"><sp/>*<sp/>-<sp/>Given<sp/>(x,<sp/>u),<sp/>no<sp/>two<sp/>distinct<sp/>c<sp/>values<sp/>give<sp/>the<sp/>same<sp/>successful<sp/>result<sp/>t.</highlight></codeline>
<codeline lineno="156"><highlight class="comment"><sp/>*<sp/>-<sp/>Every<sp/>successful<sp/>result<sp/>maps<sp/>back<sp/>to<sp/>x<sp/>through<sp/>secp256k1_ellswift_xswiftec_var.</highlight></codeline>
<codeline lineno="157"><highlight class="comment"><sp/>*<sp/>-<sp/>Given<sp/>(x,<sp/>u),<sp/>all<sp/>t<sp/>values<sp/>that<sp/>map<sp/>back<sp/>to<sp/>x<sp/>can<sp/>be<sp/>reached<sp/>by<sp/>combining<sp/>the</highlight></codeline>
<codeline lineno="158"><highlight class="comment"><sp/>*<sp/><sp/><sp/>successful<sp/>results<sp/>from<sp/>this<sp/>function<sp/>over<sp/>all<sp/>c<sp/>values,<sp/>with<sp/>the<sp/>exception<sp/>of:</highlight></codeline>
<codeline lineno="159"><highlight class="comment"><sp/>*<sp/><sp/><sp/>-<sp/>this<sp/>function<sp/>cannot<sp/>be<sp/>called<sp/>with<sp/>u=0</highlight></codeline>
<codeline lineno="160"><highlight class="comment"><sp/>*<sp/><sp/><sp/>-<sp/>no<sp/>result<sp/>with<sp/>t=0<sp/>will<sp/>be<sp/>returned</highlight></codeline>
<codeline lineno="161"><highlight class="comment"><sp/>*<sp/><sp/><sp/>-<sp/>no<sp/>result<sp/>for<sp/>which<sp/>u^3<sp/>+<sp/>t^2<sp/>+<sp/>7<sp/>=<sp/>0<sp/>will<sp/>be<sp/>returned.</highlight></codeline>
<codeline lineno="162"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="163"><highlight class="comment"><sp/>*<sp/>The<sp/>rather<sp/>unusual<sp/>encoding<sp/>of<sp/>bits<sp/>in<sp/>c<sp/>(a<sp/>large<sp/>&quot;if&quot;<sp/>based<sp/>on<sp/>the<sp/>middle<sp/>bit,<sp/>and<sp/>then</highlight></codeline>
<codeline lineno="164"><highlight class="comment"><sp/>*<sp/>using<sp/>the<sp/>low<sp/>and<sp/>high<sp/>bits<sp/>to<sp/>pick<sp/>signs<sp/>of<sp/>square<sp/>roots)<sp/>is<sp/>to<sp/>match<sp/>the<sp/>paper&apos;s</highlight></codeline>
<codeline lineno="165"><highlight class="comment"><sp/>*<sp/>encoding<sp/>more<sp/>closely:<sp/>c=0<sp/>through<sp/>c=3<sp/>match<sp/>branches<sp/>1..4<sp/>in<sp/>the<sp/>paper,<sp/>while<sp/>c=4<sp/>through</highlight></codeline>
<codeline lineno="166"><highlight class="comment"><sp/>*<sp/>c=7<sp/>are<sp/>copies<sp/>of<sp/>those<sp/>with<sp/>an<sp/>additional<sp/>negation<sp/>of<sp/>sqrt(w).</highlight></codeline>
<codeline lineno="167"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_ellswift_xswiftec_inv_var(<ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*x_in,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*u_in,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>c)<sp/>{</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>implemented<sp/>algorithm<sp/>is<sp/>this<sp/>(all<sp/>arithmetic,<sp/>except<sp/>involving<sp/>c,<sp/>is<sp/>mod<sp/>p):</highlight></codeline>
<codeline lineno="170"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="171"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>(c<sp/>&amp;<sp/>2)<sp/>=<sp/>0:</highlight></codeline>
<codeline lineno="172"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/>-<sp/>If<sp/>(-x-u)<sp/>is<sp/>a<sp/>valid<sp/>X<sp/>coordinate,<sp/>fail.</highlight></codeline>
<codeline lineno="173"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/>-<sp/>Let<sp/>s=-(u^3+7)/(u^2+u*x+x^2).</highlight></codeline>
<codeline lineno="174"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/>-<sp/>If<sp/>s<sp/>is<sp/>not<sp/>square,<sp/>fail.</highlight></codeline>
<codeline lineno="175"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/>-<sp/>Let<sp/>v=x.</highlight></codeline>
<codeline lineno="176"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>(c<sp/>&amp;<sp/>2)<sp/>=<sp/>2:</highlight></codeline>
<codeline lineno="177"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/>-<sp/>Let<sp/>s=x-u.</highlight></codeline>
<codeline lineno="178"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/>-<sp/>If<sp/>s<sp/>is<sp/>not<sp/>square,<sp/>fail.</highlight></codeline>
<codeline lineno="179"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/>-<sp/>Let<sp/>r=sqrt(-s*(4*(u^3+7)+3*u^2*s));<sp/>fail<sp/>if<sp/>it<sp/>doesn&apos;t<sp/>exist.</highlight></codeline>
<codeline lineno="180"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/>-<sp/>If<sp/>(c<sp/>&amp;<sp/>1)<sp/>=<sp/>1<sp/>and<sp/>r<sp/>=<sp/>0,<sp/>fail.</highlight></codeline>
<codeline lineno="181"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/>-<sp/>If<sp/>s=0,<sp/>fail.</highlight></codeline>
<codeline lineno="182"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/>-<sp/>Let<sp/>v=(r/s-u)/2.</highlight></codeline>
<codeline lineno="183"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>Let<sp/>w=sqrt(s).</highlight></codeline>
<codeline lineno="184"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>(c<sp/>&amp;<sp/>5)<sp/>=<sp/>0:<sp/>return<sp/>-w*(c3*u<sp/>+<sp/>v).</highlight></codeline>
<codeline lineno="185"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>(c<sp/>&amp;<sp/>5)<sp/>=<sp/>1:<sp/>return<sp/><sp/>w*(c4*u<sp/>+<sp/>v).</highlight></codeline>
<codeline lineno="186"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>(c<sp/>&amp;<sp/>5)<sp/>=<sp/>4:<sp/>return<sp/><sp/>w*(c3*u<sp/>+<sp/>v).</highlight></codeline>
<codeline lineno="187"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>-<sp/>If<sp/>(c<sp/>&amp;<sp/>5)<sp/>=<sp/>5:<sp/>return<sp/>-w*(c4*u<sp/>+<sp/>v).</highlight></codeline>
<codeline lineno="188"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>x<sp/>=<sp/>*x_in,<sp/>u<sp/>=<sp/>*u_in,<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>,<sp/>v,<sp/><ref refid="namespacetest__vectors__musig2__generate_1a5fcf9c70fa717a8efd481752dcb8ffa4" kindref="member">s</ref>,<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>,<sp/>r,<sp/>q;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="191"><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a428cc197bc9ca753662aac188a70d7c5" kindref="member">secp256k1_fe_normalize_weak</ref>(&amp;x);</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a428cc197bc9ca753662aac188a70d7c5" kindref="member">secp256k1_fe_normalize_weak</ref>(&amp;u);</highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(c<sp/>&gt;=<sp/>0<sp/>&amp;&amp;<sp/>c<sp/>&lt;<sp/>8);</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(secp256k1_ge_x_on_curve_var(&amp;x));</highlight></codeline>
<codeline lineno="197"><highlight class="normal"></highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!(c<sp/>&amp;<sp/>2))<sp/>{</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>c<sp/>is<sp/>in<sp/>{0,<sp/>1,<sp/>4,<sp/>5}.<sp/>In<sp/>this<sp/>case<sp/>we<sp/>look<sp/>for<sp/>an<sp/>inverse<sp/>under<sp/>the<sp/>x1<sp/>(if<sp/>c=0<sp/>or</highlight></codeline>
<codeline lineno="200"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>c=4)<sp/>formula,<sp/>or<sp/>x2<sp/>(if<sp/>c=1<sp/>or<sp/>c=5)<sp/>formula.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>-u-x<sp/>is<sp/>a<sp/>valid<sp/>X<sp/>coordinate,<sp/>fail.<sp/>This<sp/>would<sp/>yield<sp/>an<sp/>encoding<sp/>that<sp/>roundtrips</highlight></codeline>
<codeline lineno="203"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>back<sp/>under<sp/>the<sp/>x3<sp/>formula<sp/>instead<sp/>(which<sp/>has<sp/>priority<sp/>over<sp/>x1<sp/>and<sp/>x2,<sp/>so<sp/>the<sp/>decoding</highlight></codeline>
<codeline lineno="204"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>would<sp/>not<sp/>match<sp/>x).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref><sp/>=<sp/>x;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>m<sp/>=<sp/>x<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a781758016240ae593998306356388ab0" kindref="member">secp256k1_fe_add</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>,<sp/>&amp;u);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>m<sp/>=<sp/>u+x<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a10e9ec8d30dca4e992dd0f9075beb574" kindref="member">secp256k1_fe_negate</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>,<sp/>2);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>m<sp/>=<sp/>-u-x<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Test<sp/>if<sp/>(-u-x)<sp/>is<sp/>a<sp/>valid<sp/>X<sp/>coordinate.<sp/>If<sp/>so,<sp/>fail.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(secp256k1_ge_x_on_curve_var(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="210"><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Let<sp/>s<sp/>=<sp/>-(u^3<sp/>+<sp/>7)/(u^2<sp/>+<sp/>u*x<sp/>+<sp/>x^2)<sp/>[first<sp/>part]<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1ad9dea8392967835e0e925f808c0e563f" kindref="member">secp256k1_fe_sqr</ref>(&amp;s,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>s<sp/>=<sp/>(u+x)^2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a10e9ec8d30dca4e992dd0f9075beb574" kindref="member">secp256k1_fe_negate</ref>(&amp;s,<sp/>&amp;s,<sp/>1);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>s<sp/>=<sp/>-(u+x)^2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>,<sp/>&amp;u,<sp/>&amp;x);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>m<sp/>=<sp/>u*x<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a781758016240ae593998306356388ab0" kindref="member">secp256k1_fe_add</ref>(&amp;s,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>s<sp/>=<sp/>-(u^2<sp/>+<sp/>u*x<sp/>+<sp/>x^2)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Note<sp/>that<sp/>at<sp/>this<sp/>point,<sp/>s<sp/>=<sp/>0<sp/>is<sp/>impossible.<sp/>If<sp/>it<sp/>were<sp/>the<sp/>case:</highlight></codeline>
<codeline lineno="218"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>s<sp/>=<sp/>-(u^2<sp/>+<sp/>u*x<sp/>+<sp/>x^2)<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="219"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>=&gt;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u^2<sp/>+<sp/>u*x<sp/>+<sp/>x^2<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="220"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>=&gt;<sp/><sp/><sp/>(u<sp/>+<sp/>2*x)<sp/>*<sp/>(u^2<sp/>+<sp/>u*x<sp/>+<sp/>x^2)<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="221"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>=&gt;<sp/>2*x^3<sp/>+<sp/>3*x^2*u<sp/>+<sp/>3*x*u^2<sp/>+<sp/>u^3<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="222"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>=&gt;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(x<sp/>+<sp/>u)^3<sp/>+<sp/>x^3<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="223"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>=&gt;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x^3<sp/>=<sp/>-(x<sp/>+<sp/>u)^3</highlight></codeline>
<codeline lineno="224"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>=&gt;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x^3<sp/>+<sp/>B<sp/>=<sp/>(-u<sp/>-<sp/>x)^3<sp/>+<sp/>B</highlight></codeline>
<codeline lineno="225"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="226"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>However,<sp/>we<sp/>know<sp/>x^3<sp/>+<sp/>B<sp/>is<sp/>square<sp/>(because<sp/>x<sp/>is<sp/>on<sp/>the<sp/>curve)<sp/>and</highlight></codeline>
<codeline lineno="227"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>that<sp/>(-u-x)^3<sp/>+<sp/>B<sp/>is<sp/>not<sp/>square<sp/>(the<sp/>secp256k1_ge_x_on_curve_var(&amp;m)</highlight></codeline>
<codeline lineno="228"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>test<sp/>above<sp/>would<sp/>have<sp/>failed).<sp/>This<sp/>is<sp/>a<sp/>contradiction,<sp/>and<sp/>thus<sp/>the</highlight></codeline>
<codeline lineno="229"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>assumption<sp/>s=0<sp/>is<sp/>false.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(!<ref refid="field_8h_1a1cb62d54d1ee78cf102b68fa54dc279b" kindref="member">secp256k1_fe_normalizes_to_zero_var</ref>(&amp;s));</highlight></codeline>
<codeline lineno="231"><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>s<sp/>is<sp/>not<sp/>square,<sp/>fail.<sp/>We<sp/>have<sp/>not<sp/>fully<sp/>computed<sp/>s<sp/>yet,<sp/>but<sp/>s<sp/>is<sp/>square<sp/>iff</highlight></codeline>
<codeline lineno="233"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>-(u^3+7)*(u^2+u*x+x^2)<sp/>is<sp/>square<sp/>(because<sp/>a/b<sp/>is<sp/>square<sp/>iff<sp/>a*b<sp/>is<sp/>square<sp/>and<sp/>b<sp/>is</highlight></codeline>
<codeline lineno="234"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>nonzero).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1ad9dea8392967835e0e925f808c0e563f" kindref="member">secp256k1_fe_sqr</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>,<sp/>&amp;u);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>g<sp/>=<sp/>u^2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>,<sp/>&amp;u);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>g<sp/>=<sp/>u^3<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1af1125dec014cc84f3f62cbed8be95fc8" kindref="member">secp256k1_fe_add_int</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>,<sp/><ref refid="group__impl_8h_1a6ac7906b0db18f65df2909faefce2416" kindref="member">SECP256K1_B</ref>);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>g<sp/>=<sp/>u^3+7<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>,<sp/>&amp;s,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>m<sp/>=<sp/>-(u^3<sp/>+<sp/>7)*(u^2<sp/>+<sp/>u*x<sp/>+<sp/>x^2)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="field_8h_1ab4f8ed33ded868148c61ae3f0027e807" kindref="member">secp256k1_fe_is_square_var</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="240"><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Let<sp/>s<sp/>=<sp/>-(u^3<sp/>+<sp/>7)/(u^2<sp/>+<sp/>u*x<sp/>+<sp/>x^2)<sp/>[second<sp/>part]<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a94d9a1f4c5b138e81471289c8596afe5" kindref="member">secp256k1_fe_inv_var</ref>(&amp;s,<sp/>&amp;s);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>s<sp/>=<sp/>-1/(u^2<sp/>+<sp/>u*x<sp/>+<sp/>x^2)<sp/>[no<sp/>div<sp/>by<sp/>0]<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;s,<sp/>&amp;s,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>s<sp/>=<sp/>-(u^3<sp/>+<sp/>7)/(u^2<sp/>+<sp/>u*x<sp/>+<sp/>x^2)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Let<sp/>v<sp/>=<sp/>x.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>v<sp/>=<sp/>x;</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>c<sp/>is<sp/>in<sp/>{2,<sp/>3,<sp/>6,<sp/>7}.<sp/>In<sp/>this<sp/>case<sp/>we<sp/>look<sp/>for<sp/>an<sp/>inverse<sp/>under<sp/>the<sp/>x3<sp/>formula.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Let<sp/>s<sp/>=<sp/>x-u.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a10e9ec8d30dca4e992dd0f9075beb574" kindref="member">secp256k1_fe_negate</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>,<sp/>&amp;u,<sp/>1);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>m<sp/>=<sp/>-u<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespacetest__vectors__musig2__generate_1a5fcf9c70fa717a8efd481752dcb8ffa4" kindref="member">s</ref><sp/>=<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>s<sp/>=<sp/>-u<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a781758016240ae593998306356388ab0" kindref="member">secp256k1_fe_add</ref>(&amp;s,<sp/>&amp;x);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>s<sp/>=<sp/>x-u<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="254"><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>s<sp/>is<sp/>not<sp/>square,<sp/>fail.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="field_8h_1ab4f8ed33ded868148c61ae3f0027e807" kindref="member">secp256k1_fe_is_square_var</ref>(&amp;s))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="257"><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Let<sp/>r<sp/>=<sp/>sqrt(-s*(4*(u^3+7)+3*u^2*s));<sp/>fail<sp/>if<sp/>it<sp/>doesn&apos;t<sp/>exist.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1ad9dea8392967835e0e925f808c0e563f" kindref="member">secp256k1_fe_sqr</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>,<sp/>&amp;u);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>g<sp/>=<sp/>u^2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;q,<sp/>&amp;s,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>q<sp/>=<sp/>s*u^2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a1b53120e78e87f77227520c8a8d15245" kindref="member">secp256k1_fe_mul_int</ref>(&amp;q,<sp/>3);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>q<sp/>=<sp/>3*s*u^2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>,<sp/>&amp;u);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>g<sp/>=<sp/>u^3<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a1b53120e78e87f77227520c8a8d15245" kindref="member">secp256k1_fe_mul_int</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>,<sp/>4);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>g<sp/>=<sp/>4*u^3<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1af1125dec014cc84f3f62cbed8be95fc8" kindref="member">secp256k1_fe_add_int</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>,<sp/>4<sp/>*<sp/><ref refid="group__impl_8h_1a6ac7906b0db18f65df2909faefce2416" kindref="member">SECP256K1_B</ref>);<sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>g<sp/>=<sp/>4*(u^3+7)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a781758016240ae593998306356388ab0" kindref="member">secp256k1_fe_add</ref>(&amp;q,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cab2f5ff47436671b6e533d8dc3614845d" kindref="member">g</ref>);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>q<sp/>=<sp/>4*(u^3+7)+3*s*u^2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;q,<sp/>&amp;q,<sp/>&amp;s);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>q<sp/>=<sp/>s*(4*(u^3+7)+3*u^2*s)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a10e9ec8d30dca4e992dd0f9075beb574" kindref="member">secp256k1_fe_negate</ref>(&amp;q,<sp/>&amp;q,<sp/>1);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>q<sp/>=<sp/>-s*(4*(u^3+7)+3*u^2*s)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="field_8h_1ab4f8ed33ded868148c61ae3f0027e807" kindref="member">secp256k1_fe_is_square_var</ref>(&amp;q))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/>secp256k1_fe_sqrt(&amp;r,<sp/>&amp;q);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>r<sp/>=<sp/>sqrt(-s*(4*(u^3+7)+3*u^2*s))<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>VERIFY</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="272"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(void)<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="274"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"></highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>(c<sp/>&amp;<sp/>1)<sp/>=<sp/>1<sp/>and<sp/>r<sp/>=<sp/>0,<sp/>fail.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="minisketch_2src_2util_8h_1a76e8a689f16456e44a2cc438a6821025" kindref="member">EXPECT</ref>((c<sp/>&amp;<sp/>1)<sp/>&amp;&amp;<sp/><ref refid="field_8h_1a1cb62d54d1ee78cf102b68fa54dc279b" kindref="member">secp256k1_fe_normalizes_to_zero_var</ref>(&amp;r),<sp/>0))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="278"><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>s<sp/>=<sp/>0,<sp/>fail.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="minisketch_2src_2util_8h_1a76e8a689f16456e44a2cc438a6821025" kindref="member">EXPECT</ref>(<ref refid="field_8h_1a1cb62d54d1ee78cf102b68fa54dc279b" kindref="member">secp256k1_fe_normalizes_to_zero_var</ref>(&amp;s),<sp/>0))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="281"><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Let<sp/>v<sp/>=<sp/>(r/s-u)/2.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a94d9a1f4c5b138e81471289c8596afe5" kindref="member">secp256k1_fe_inv_var</ref>(&amp;v,<sp/>&amp;s);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>v<sp/>=<sp/>1/s<sp/>[no<sp/>div<sp/>by<sp/>0]<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;v,<sp/>&amp;v,<sp/>&amp;r);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>v<sp/>=<sp/>r/s<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a781758016240ae593998306356388ab0" kindref="member">secp256k1_fe_add</ref>(&amp;v,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>v<sp/>=<sp/>r/s-u<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a89c8d1918ce921e899956a4f901c7f62" kindref="member">secp256k1_fe_half</ref>(&amp;v);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>v<sp/>=<sp/>(r/s-u)/2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="288"><highlight class="normal"></highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Let<sp/>w<sp/>=<sp/>sqrt(s).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/>secp256k1_fe_sqrt(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>,<sp/>&amp;s);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>m<sp/>=<sp/>sqrt(s)<sp/>=<sp/>w<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="292"><highlight class="normal"></highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Return<sp/>logic.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((c<sp/>&amp;<sp/>5)<sp/>==<sp/>0<sp/>||<sp/>(c<sp/>&amp;<sp/>5)<sp/>==<sp/>5)<sp/>{</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a10e9ec8d30dca4e992dd0f9075beb574" kindref="member">secp256k1_fe_negate</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>,<sp/>1);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>m<sp/>=<sp/>-w<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Now<sp/>m<sp/>=<sp/>{-w<sp/>if<sp/>c&amp;5=0<sp/>or<sp/>c&amp;5=5;<sp/>w<sp/>otherwise}.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;u,<sp/>&amp;u,<sp/>c&amp;1<sp/>?<sp/>&amp;secp256k1_ellswift_c4<sp/>:<sp/>&amp;secp256k1_ellswift_c3);</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>u<sp/>=<sp/>{c4<sp/>if<sp/>c&amp;1=1;<sp/>c3<sp/>otherwise}*u<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a781758016240ae593998306356388ab0" kindref="member">secp256k1_fe_add</ref>(&amp;u,<sp/>&amp;v);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>u<sp/>=<sp/>{c4<sp/>if<sp/>c&amp;1=1;<sp/>c3<sp/>otherwise}*u<sp/>+<sp/>v<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca6f8f57715090da2632453988d9a1501b" kindref="member">m</ref>,<sp/>&amp;u);</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="303"><highlight class="normal">}</highlight></codeline>
<codeline lineno="304"><highlight class="normal"></highlight></codeline>
<codeline lineno="310"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_ellswift_prng(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>out32,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>*hasher,<sp/>uint32_t<sp/>cnt)<sp/>{</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>hash<sp/>=<sp/>*hasher;</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>buf4[4];</highlight></codeline>
<codeline lineno="313"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>VERIFY</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>blocks<sp/>=<sp/>hash.<ref refid="structsecp256k1__sha256_1a386a3a5adc6cdeb2f1083b3c3d08e7d0" kindref="member">bytes</ref><sp/>&gt;&gt;<sp/>6;</highlight></codeline>
<codeline lineno="315"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/>buf4[0]<sp/>=<sp/>cnt;</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/>buf4[1]<sp/>=<sp/>cnt<sp/>&gt;&gt;<sp/>8;</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/>buf4[2]<sp/>=<sp/>cnt<sp/>&gt;&gt;<sp/>16;</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/>buf4[3]<sp/>=<sp/>cnt<sp/>&gt;&gt;<sp/>24;</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;hash,<sp/>buf4,<sp/>4);</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_finalize(&amp;hash,<sp/>out32);</highlight></codeline>
<codeline lineno="322"><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Writing<sp/>and<sp/>finalizing<sp/>together<sp/>should<sp/>trigger<sp/>exactly<sp/>one<sp/>SHA256<sp/>compression.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(((hash.<ref refid="structsecp256k1__sha256_1a386a3a5adc6cdeb2f1083b3c3d08e7d0" kindref="member">bytes</ref>)<sp/>&gt;&gt;<sp/>6)<sp/>==<sp/>(blocks<sp/>+<sp/>1));</highlight></codeline>
<codeline lineno="325"><highlight class="normal">}</highlight></codeline>
<codeline lineno="326"><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_ellswift_xelligatorswift_var(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="crypto__diff__fuzz__chacha20_8cpp_1a10e94b422ef0c20dcdec20d31a1f5049" kindref="member">u32</ref>,<sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*x,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>*hasher)<sp/>{</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Pool<sp/>of<sp/>3-bit<sp/>branch<sp/>values.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>branch_hash[32];</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Number<sp/>of<sp/>3-bit<sp/>values<sp/>in<sp/>branch_hash<sp/>left.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>branches_left<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Field<sp/>elements<sp/>u<sp/>and<sp/>branch<sp/>values<sp/>are<sp/>extracted<sp/>from<sp/>RNG<sp/>based<sp/>on<sp/>hasher<sp/>for<sp/>consecutive</highlight></codeline>
<codeline lineno="339"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>values<sp/>of<sp/>cnt.<sp/>cnt==0<sp/>is<sp/>first<sp/>used<sp/>to<sp/>populate<sp/>a<sp/>pool<sp/>of<sp/>64<sp/>4-bit<sp/>branch<sp/>values.<sp/>The<sp/>64</highlight></codeline>
<codeline lineno="340"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>cnt<sp/>values<sp/>that<sp/>follow<sp/>are<sp/>used<sp/>to<sp/>generate<sp/>field<sp/>elements<sp/>u.<sp/>cnt==65<sp/>(and<sp/>multiples</highlight></codeline>
<codeline lineno="341"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>thereof)<sp/>are<sp/>used<sp/>to<sp/>repopulate<sp/>the<sp/>pool<sp/>and<sp/>start<sp/>over,<sp/>if<sp/>that<sp/>were<sp/>ever<sp/>necessary.</highlight></codeline>
<codeline lineno="342"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>On<sp/>average,<sp/>4<sp/>iterations<sp/>are<sp/>needed.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>cnt<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(1)<sp/>{</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>branch;</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>u;</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>the<sp/>pool<sp/>of<sp/>branch<sp/>values<sp/>is<sp/>empty,<sp/>populate<sp/>it.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(branches_left<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ellswift_prng(branch_hash,<sp/>hasher,<sp/>cnt++);</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>branches_left<sp/>=<sp/>64;</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Take<sp/>a<sp/>3-bit<sp/>branch<sp/>value<sp/>from<sp/>the<sp/>branch<sp/>pool<sp/>(top<sp/>bit<sp/>is<sp/>discarded).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>--branches_left;</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>branch<sp/>=<sp/>(branch_hash[branches_left<sp/>&gt;&gt;<sp/>1]<sp/>&gt;&gt;<sp/>((branches_left<sp/>&amp;<sp/>1)<sp/>&lt;&lt;<sp/>2))<sp/>&amp;<sp/>7;</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Compute<sp/>a<sp/>new<sp/>u<sp/>value<sp/>by<sp/>hashing.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ellswift_prng(<ref refid="crypto__diff__fuzz__chacha20_8cpp_1a10e94b422ef0c20dcdec20d31a1f5049" kindref="member">u32</ref>,<sp/>hasher,<sp/>cnt++);</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>overflow<sp/>is<sp/>not<sp/>a<sp/>problem<sp/>(we<sp/>prefer<sp/>uniform<sp/>u32<sp/>over<sp/>uniform<sp/>u).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1ac9dce27350e10a28a04ac8c5fa70e553" kindref="member">secp256k1_fe_set_b32_mod</ref>(&amp;u,<sp/><ref refid="crypto__diff__fuzz__chacha20_8cpp_1a10e94b422ef0c20dcdec20d31a1f5049" kindref="member">u32</ref>);</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Since<sp/>u<sp/>is<sp/>the<sp/>output<sp/>of<sp/>a<sp/>hash,<sp/>it<sp/>should<sp/>practically<sp/>never<sp/>be<sp/>0.<sp/>We<sp/>could<sp/>apply<sp/>the</highlight></codeline>
<codeline lineno="360"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>u=0<sp/>to<sp/>u=1<sp/>correction<sp/>here<sp/>too<sp/>to<sp/>deal<sp/>with<sp/>that<sp/>case<sp/>still,<sp/>but<sp/>it&apos;s<sp/>such<sp/>a<sp/>low</highlight></codeline>
<codeline lineno="361"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>probability<sp/>event<sp/>that<sp/>we<sp/>do<sp/>not<sp/>bother.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(!<ref refid="field_8h_1a1cb62d54d1ee78cf102b68fa54dc279b" kindref="member">secp256k1_fe_normalizes_to_zero_var</ref>(&amp;u));</highlight></codeline>
<codeline lineno="363"><highlight class="normal"></highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Find<sp/>a<sp/>remainder<sp/>t,<sp/>and<sp/>return<sp/>it<sp/>if<sp/>found.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="minisketch_2src_2util_8h_1a76e8a689f16456e44a2cc438a6821025" kindref="member">EXPECT</ref>(secp256k1_ellswift_xswiftec_inv_var(<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>,<sp/>x,<sp/>&amp;u,<sp/>branch),<sp/>0))<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="367"><highlight class="normal">}</highlight></codeline>
<codeline lineno="368"><highlight class="normal"></highlight></codeline>
<codeline lineno="375"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_ellswift_elligatorswift_var(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="crypto__diff__fuzz__chacha20_8cpp_1a10e94b422ef0c20dcdec20d31a1f5049" kindref="member">u32</ref>,<sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*p,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>*hasher)<sp/>{</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ellswift_xelligatorswift_var(<ref refid="crypto__diff__fuzz__chacha20_8cpp_1a10e94b422ef0c20dcdec20d31a1f5049" kindref="member">u32</ref>,<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>,<sp/>&amp;p-&gt;<ref refid="structsecp256k1__ge_1af089d748d95dc12c1185adae8e11972d" kindref="member">x</ref>,<sp/>hasher);</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a80e6ef8a08736aad544787a388956f5c" kindref="member">secp256k1_fe_normalize_var</ref>(<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>);</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="field_8h_1a5bcecb31c985b8cd07086ffc254b7902" kindref="member">secp256k1_fe_is_odd</ref>(<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>)<sp/>!=<sp/><ref refid="field_8h_1a5bcecb31c985b8cd07086ffc254b7902" kindref="member">secp256k1_fe_is_odd</ref>(&amp;p-&gt;<ref refid="structsecp256k1__ge_1a8ab8d07fa557181528b86bd1c9bb2b92" kindref="member">y</ref>))<sp/>{</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a10e9ec8d30dca4e992dd0f9075beb574" kindref="member">secp256k1_fe_negate</ref>(<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>,<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>,<sp/>1);</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a80e6ef8a08736aad544787a388956f5c" kindref="member">secp256k1_fe_normalize_var</ref>(<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>);</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="382"><highlight class="normal">}</highlight></codeline>
<codeline lineno="383"><highlight class="normal"></highlight></codeline>
<codeline lineno="385"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_ellswift_sha256_init_encode(<ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref>*<sp/>hash)<sp/>{</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_initialize(hash);</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[0]<sp/>=<sp/>0xd1a6524bul;</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[1]<sp/>=<sp/>0x028594b3ul;</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[2]<sp/>=<sp/>0x96e42f4eul;</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[3]<sp/>=<sp/>0x1037a177ul;</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[4]<sp/>=<sp/>0x1b8fcb8bul;</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[5]<sp/>=<sp/>0x56023885ul;</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[6]<sp/>=<sp/>0x2560ede1ul;</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[7]<sp/>=<sp/>0xd626b715ul;</highlight></codeline>
<codeline lineno="395"><highlight class="normal"></highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a386a3a5adc6cdeb2f1083b3c3d08e7d0" kindref="member">bytes</ref><sp/>=<sp/>64;</highlight></codeline>
<codeline lineno="397"><highlight class="normal">}</highlight></codeline>
<codeline lineno="398"><highlight class="normal"></highlight></codeline>
<codeline lineno="399" refid="secp256k1__ellswift_8h_1ae82e63733c89c1219cb495e42e989d13" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="ellswift_2main__impl_8h_1ae507a00028bb585ea530824d15630dc6" kindref="member">secp256k1_ellswift_encode</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref><sp/>*ctx,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ell64,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref><sp/>*pubkey,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*rnd32)<sp/>{</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>p;</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(ell64<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(pubkey<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(rnd32<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="405"><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(secp256k1_pubkey_load(ctx,<sp/>&amp;p,<sp/>pubkey))<sp/>{</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>;</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>p64[64]<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>ser_size;</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ser_ret;</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>hash;</highlight></codeline>
<codeline lineno="412"><highlight class="normal"></highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Set<sp/>up<sp/>hasher<sp/>state;<sp/>the<sp/>used<sp/>RNG<sp/>is<sp/>H(pubkey<sp/>||<sp/>&quot;\x00&quot;*31<sp/>||<sp/>rnd32<sp/>||<sp/>cnt++),<sp/>using</highlight></codeline>
<codeline lineno="414"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>BIP340<sp/>tagged<sp/>hash<sp/>with<sp/>tag<sp/>&quot;secp256k1_ellswift_encode&quot;.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ellswift_sha256_init_encode(&amp;hash);</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ser_ret<sp/>=<sp/>secp256k1_eckey_pubkey_serialize(&amp;p,<sp/>p64,<sp/>&amp;ser_size,<sp/>1);</highlight></codeline>
<codeline lineno="417"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>VERIFY</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ser_ret<sp/>&amp;&amp;<sp/>ser_size<sp/>==<sp/>33);</highlight></codeline>
<codeline lineno="419"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(void)ser_ret;</highlight></codeline>
<codeline lineno="421"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;hash,<sp/>p64,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(p64));</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;hash,<sp/>rnd32,<sp/>32);</highlight></codeline>
<codeline lineno="424"><highlight class="normal"></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Compute<sp/>ElligatorSwift<sp/>encoding<sp/>and<sp/>construct<sp/>output.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ellswift_elligatorswift_var(ell64,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>,<sp/>&amp;p,<sp/>&amp;hash);<sp/></highlight><highlight class="comment">/*<sp/>puts<sp/>u<sp/>in<sp/>ell64[0..32]<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1ad0cc14c85bd2f671868b048de75c8042" kindref="member">secp256k1_fe_get_b32</ref>(ell64<sp/>+<sp/>32,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>);<sp/></highlight><highlight class="comment">/*<sp/>puts<sp/>t<sp/>in<sp/>ell64[32..64]<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Only<sp/>reached<sp/>in<sp/>case<sp/>the<sp/>provided<sp/>pubkey<sp/>is<sp/>invalid.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(ell64,<sp/>0,<sp/>64);</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="433"><highlight class="normal">}</highlight></codeline>
<codeline lineno="434"><highlight class="normal"></highlight></codeline>
<codeline lineno="436"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_ellswift_sha256_init_create(<ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref>*<sp/>hash)<sp/>{</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_initialize(hash);</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[0]<sp/>=<sp/>0xd29e1bf5ul;</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[1]<sp/>=<sp/>0xf7025f42ul;</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[2]<sp/>=<sp/>0x9b024773ul;</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[3]<sp/>=<sp/>0x094cb7d5ul;</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[4]<sp/>=<sp/>0xe59ed789ul;</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[5]<sp/>=<sp/>0x03bc9786ul;</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[6]<sp/>=<sp/>0x68335b35ul;</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[7]<sp/>=<sp/>0x4e363b53ul;</highlight></codeline>
<codeline lineno="446"><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a386a3a5adc6cdeb2f1083b3c3d08e7d0" kindref="member">bytes</ref><sp/>=<sp/>64;</highlight></codeline>
<codeline lineno="448"><highlight class="normal">}</highlight></codeline>
<codeline lineno="449"><highlight class="normal"></highlight></codeline>
<codeline lineno="450" refid="secp256k1__ellswift_8h_1a4bc05874a6482805236e4e7eb69fa117" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="ellswift_2main__impl_8h_1a48e79201d56ff62c5e952647ac1563e7" kindref="member">secp256k1_ellswift_create</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref><sp/>*ctx,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ell64,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*seckey32,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*auxrnd32)<sp/>{</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>p;</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>;</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>hash;</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>seckey_scalar;</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>zero32[32]<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="457"><highlight class="normal"></highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Sanity<sp/>check<sp/>inputs.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(ell64<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(ell64,<sp/>0,<sp/>64);</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(secp256k1_ecmult_gen_context_is_built(&amp;ctx-&gt;<ref refid="structsecp256k1__context__struct_1abb65f6e84b17f93f74cd8b4eb2910a47" kindref="member">ecmult_gen_ctx</ref>));</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(seckey32<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="464"><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Compute<sp/>(affine)<sp/>public<sp/>key<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/>secp256k1_ec_pubkey_create_helper(&amp;ctx-&gt;<ref refid="structsecp256k1__context__struct_1abb65f6e84b17f93f74cd8b4eb2910a47" kindref="member">ecmult_gen_ctx</ref>,<sp/>&amp;seckey_scalar,<sp/>&amp;p,<sp/>seckey32);</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_declassify(ctx,<sp/>&amp;p,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(p));<sp/></highlight><highlight class="comment">/*<sp/>not<sp/>constant<sp/>time<sp/>in<sp/>produced<sp/>pubkey<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a80e6ef8a08736aad544787a388956f5c" kindref="member">secp256k1_fe_normalize_var</ref>(&amp;p.<ref refid="structsecp256k1__ge_1af089d748d95dc12c1185adae8e11972d" kindref="member">x</ref>);</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a80e6ef8a08736aad544787a388956f5c" kindref="member">secp256k1_fe_normalize_var</ref>(&amp;p.<ref refid="structsecp256k1__ge_1a8ab8d07fa557181528b86bd1c9bb2b92" kindref="member">y</ref>);</highlight></codeline>
<codeline lineno="470"><highlight class="normal"></highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Set<sp/>up<sp/>hasher<sp/>state.<sp/>The<sp/>used<sp/>RNG<sp/>is<sp/>H(privkey<sp/>||<sp/>&quot;\x00&quot;*32<sp/>[||<sp/>auxrnd32]<sp/>||<sp/>cnt++),</highlight></codeline>
<codeline lineno="472"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>using<sp/>BIP340<sp/>tagged<sp/>hash<sp/>with<sp/>tag<sp/>&quot;secp256k1_ellswift_create&quot;.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ellswift_sha256_init_create(&amp;hash);</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;hash,<sp/>seckey32,<sp/>32);</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;hash,<sp/>zero32,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(zero32));</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_declassify(ctx,<sp/>&amp;hash,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(hash));<sp/></highlight><highlight class="comment">/*<sp/>private<sp/>key<sp/>is<sp/>hashed<sp/>now<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(auxrnd32)<sp/>secp256k1_sha256_write(&amp;hash,<sp/>auxrnd32,<sp/>32);</highlight></codeline>
<codeline lineno="478"><highlight class="normal"></highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Compute<sp/>ElligatorSwift<sp/>encoding<sp/>and<sp/>construct<sp/>output.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ellswift_elligatorswift_var(ell64,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>,<sp/>&amp;p,<sp/>&amp;hash);<sp/></highlight><highlight class="comment">/*<sp/>puts<sp/>u<sp/>in<sp/>ell64[0..32]<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1ad0cc14c85bd2f671868b048de75c8042" kindref="member">secp256k1_fe_get_b32</ref>(ell64<sp/>+<sp/>32,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>);<sp/></highlight><highlight class="comment">/*<sp/>puts<sp/>t<sp/>in<sp/>ell64[32..64]<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"></highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_memczero(ell64,<sp/>64,<sp/>!<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_clear(&amp;seckey_scalar);</highlight></codeline>
<codeline lineno="485"><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="487"><highlight class="normal">}</highlight></codeline>
<codeline lineno="488"><highlight class="normal"></highlight></codeline>
<codeline lineno="489" refid="secp256k1__ellswift_8h_1a6253bbd9ea50595f37628ec192b201ee" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="ellswift_2main__impl_8h_1ae88ee4e67572f02768f89e5cc0f271a7" kindref="member">secp256k1_ellswift_decode</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref><sp/>*ctx,<sp/><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref><sp/>*pubkey,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ell64)<sp/>{</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>u,<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>;</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>p;</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(pubkey<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(ell64<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="495"><highlight class="normal"></highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1ac9dce27350e10a28a04ac8c5fa70e553" kindref="member">secp256k1_fe_set_b32_mod</ref>(&amp;u,<sp/>ell64);</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1ac9dce27350e10a28a04ac8c5fa70e553" kindref="member">secp256k1_fe_set_b32_mod</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>,<sp/>ell64<sp/>+<sp/>32);</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a80e6ef8a08736aad544787a388956f5c" kindref="member">secp256k1_fe_normalize_var</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>);</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ellswift_swiftec_var(&amp;p,<sp/>&amp;u,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>);</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_pubkey_save(pubkey,<sp/>&amp;p);</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="502"><highlight class="normal">}</highlight></codeline>
<codeline lineno="503"><highlight class="normal"></highlight></codeline>
<codeline lineno="504"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ellswift_xdh_hash_function_prefix(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*output,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*x32,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ell_a64,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ell_b64,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*data)<sp/>{</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>sha;</highlight></codeline>
<codeline lineno="506"><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_initialize(&amp;sha);</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;sha,<sp/>data,<sp/>64);</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;sha,<sp/>ell_a64,<sp/>64);</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;sha,<sp/>ell_b64,<sp/>64);</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;sha,<sp/>x32,<sp/>32);</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_finalize(&amp;sha,<sp/>output);</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_clear(&amp;sha);</highlight></codeline>
<codeline lineno="514"><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="516"><highlight class="normal">}</highlight></codeline>
<codeline lineno="517"><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_ellswift_sha256_init_bip324(<ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref>*<sp/>hash)<sp/>{</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_initialize(hash);</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[0]<sp/>=<sp/>0x8c12d730ul;</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[1]<sp/>=<sp/>0x827bd392ul;</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[2]<sp/>=<sp/>0x9e4fb2eeul;</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[3]<sp/>=<sp/>0x207b373eul;</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[4]<sp/>=<sp/>0x2292bd7aul;</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[5]<sp/>=<sp/>0xaa5441bcul;</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[6]<sp/>=<sp/>0x15c3779ful;</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[7]<sp/>=<sp/>0xcfb52549ul;</highlight></codeline>
<codeline lineno="529"><highlight class="normal"></highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/>hash-&gt;<ref refid="structsecp256k1__sha256_1a386a3a5adc6cdeb2f1083b3c3d08e7d0" kindref="member">bytes</ref><sp/>=<sp/>64;</highlight></codeline>
<codeline lineno="531"><highlight class="normal">}</highlight></codeline>
<codeline lineno="532"><highlight class="normal"></highlight></codeline>
<codeline lineno="533"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ellswift_xdh_hash_function_bip324(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>output,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*x32,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ell_a64,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ell_b64,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*data)<sp/>{</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>sha;</highlight></codeline>
<codeline lineno="535"><highlight class="normal"></highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)data;</highlight></codeline>
<codeline lineno="537"><highlight class="normal"></highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ellswift_sha256_init_bip324(&amp;sha);</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;sha,<sp/>ell_a64,<sp/>64);</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;sha,<sp/>ell_b64,<sp/>64);</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;sha,<sp/>x32,<sp/>32);</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_finalize(&amp;sha,<sp/>output);</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_clear(&amp;sha);</highlight></codeline>
<codeline lineno="544"><highlight class="normal"></highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="546"><highlight class="normal">}</highlight></codeline>
<codeline lineno="547"><highlight class="normal"></highlight></codeline>
<codeline lineno="548" refid="ellswift_2main__impl_8h_1a2e7ab4d967f95dddbbcf9a72f067ca1f" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1__ellswift_8h_1ac1ac7f0ce1fa1f4bbbe054c3128a5640" kindref="member">secp256k1_ellswift_xdh_hash_function</ref><sp/><ref refid="secp256k1__ellswift_8h_1a17f569135082056600fcacc1ae9658e3" kindref="member">secp256k1_ellswift_xdh_hash_function_prefix</ref><sp/>=<sp/>ellswift_xdh_hash_function_prefix;</highlight></codeline>
<codeline lineno="549" refid="ellswift_2main__impl_8h_1a9e66d67ac918016de7350e0acfe9bcda" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1__ellswift_8h_1ac1ac7f0ce1fa1f4bbbe054c3128a5640" kindref="member">secp256k1_ellswift_xdh_hash_function</ref><sp/><ref refid="secp256k1__ellswift_8h_1ae7142918ae750a69e2b8105d9d25c10b" kindref="member">secp256k1_ellswift_xdh_hash_function_bip324</ref><sp/>=<sp/>ellswift_xdh_hash_function_bip324;</highlight></codeline>
<codeline lineno="550"><highlight class="normal"></highlight></codeline>
<codeline lineno="551" refid="secp256k1__ellswift_8h_1a6e4b9b088bcf1c76973af5c97040c4a1" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="ellswift_2main__impl_8h_1a4b4ed069c280c8d4caea2afa7e43779a" kindref="member">secp256k1_ellswift_xdh</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref><sp/>*ctx,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*output,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ell_a64,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ell_b64,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*seckey32,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>party,<sp/><ref refid="secp256k1__ellswift_8h_1ac1ac7f0ce1fa1f4bbbe054c3128a5640" kindref="member">secp256k1_ellswift_xdh_hash_function</ref><sp/>hashfp,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*data)<sp/>{</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>overflow;</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>s;</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>xn,<sp/>xd,<sp/>px,<sp/>u,<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>;</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>sx[32];</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>theirs64;</highlight></codeline>
<codeline lineno="558"><highlight class="normal"></highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(output<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(ell_a64<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(ell_b64<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(seckey32<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(hashfp<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="565"><highlight class="normal"></highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Load<sp/>remote<sp/>public<sp/>key<sp/>(as<sp/>fraction).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/>theirs64<sp/>=<sp/>party<sp/>?<sp/>ell_a64<sp/>:<sp/>ell_b64;</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1ac9dce27350e10a28a04ac8c5fa70e553" kindref="member">secp256k1_fe_set_b32_mod</ref>(&amp;u,<sp/>theirs64);</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1ac9dce27350e10a28a04ac8c5fa70e553" kindref="member">secp256k1_fe_set_b32_mod</ref>(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>,<sp/>theirs64<sp/>+<sp/>32);</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ellswift_xswiftec_frac_var(&amp;xn,<sp/>&amp;xd,<sp/>&amp;u,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2cae358efa489f58062f10dd7316b65649e" kindref="member">t</ref>);</highlight></codeline>
<codeline lineno="571"><highlight class="normal"></highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Load<sp/>private<sp/>key<sp/>(using<sp/>one<sp/>if<sp/>invalid).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_set_b32(&amp;s,<sp/>seckey32,<sp/>&amp;overflow);</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/>overflow<sp/>=<sp/>secp256k1_scalar_is_zero(&amp;s);</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_cmov(&amp;s,<sp/>&amp;secp256k1_scalar_one,<sp/>overflow);</highlight></codeline>
<codeline lineno="576"><highlight class="normal"></highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Compute<sp/>shared<sp/>X<sp/>coordinate.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ecmult_const_xonly(&amp;px,<sp/>&amp;xn,<sp/>&amp;xd,<sp/>&amp;s,<sp/>1);</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1ae47edc35c5aa8e1ca5899f6e0ac8fb57" kindref="member">secp256k1_fe_normalize</ref>(&amp;px);</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1ad0cc14c85bd2f671868b048de75c8042" kindref="member">secp256k1_fe_get_b32</ref>(sx,<sp/>&amp;px);</highlight></codeline>
<codeline lineno="581"><highlight class="normal"></highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Invoke<sp/>hasher<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/>hashfp(output,<sp/>sx,<sp/>ell_a64,<sp/>ell_b64,<sp/>data);</highlight></codeline>
<codeline lineno="584"><highlight class="normal"></highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_memclear_explicit(sx,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(sx));</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_fe_clear(&amp;px);</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_clear(&amp;s);</highlight></codeline>
<codeline lineno="588"><highlight class="normal"></highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>!!<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>&amp;<sp/>!overflow;</highlight></codeline>
<codeline lineno="590"><highlight class="normal">}</highlight></codeline>
<codeline lineno="591"><highlight class="normal"></highlight></codeline>
<codeline lineno="592"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
    </programlisting>
    <location file="src/secp256k1/src/modules/ellswift/main_impl.h"/>
  </compounddef>
</doxygen>
