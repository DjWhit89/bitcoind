<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="ecmult__impl_8h" kind="file" language="C++">
    <compoundname>ecmult_impl.h</compoundname>
    <includes refid="string_8h" local="no">string.h</includes>
    <includes local="no">stdint.h</includes>
    <includes refid="secp256k1_2src_2util_8h" local="yes">util.h</includes>
    <includes refid="group_8h" local="yes">group.h</includes>
    <includes refid="scalar_8h" local="yes">scalar.h</includes>
    <includes refid="ecmult_8h" local="yes">ecmult.h</includes>
    <includes refid="precomputed__ecmult_8h" local="yes">precomputed_ecmult.h</includes>
    <includedby refid="bench__ecmult_8c" local="yes">src/secp256k1/src/bench_ecmult.c</includedby>
    <includedby refid="bench__internal_8c" local="yes">src/secp256k1/src/bench_internal.c</includedby>
    <includedby refid="ecmult__const__impl_8h" local="yes">src/secp256k1/src/ecmult_const_impl.h</includedby>
    <includedby refid="secp256k1_8c" local="yes">src/secp256k1/src/secp256k1.c</includedby>
    <incdepgraph>
      <node id="19">
        <label>../include/secp256k1.h</label>
        <link refid="secp256k1_8h"/>
        <childnode refid="20" relation="include">
        </childnode>
      </node>
      <node id="21">
        <label>checkmem.h</label>
        <link refid="checkmem_8h"/>
      </node>
      <node id="30">
        <label>ecmult.h</label>
        <link refid="ecmult_8h"/>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>src/secp256k1/src/ecmult_impl.h</label>
        <link refid="ecmult__impl_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
      </node>
      <node id="26">
        <label>field.h</label>
        <link refid="field_8h"/>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
      </node>
      <node id="27">
        <label>field_5x52.h</label>
        <link refid="field__5x52_8h"/>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="25">
        <label>group.h</label>
        <link refid="group_8h"/>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="32">
        <label>precomputed_ecmult.h</label>
        <link refid="precomputed__ecmult_8h"/>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="28">
        <label>scalar.h</label>
        <link refid="scalar_8h"/>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="29">
        <label>scalar_4x64.h</label>
        <link refid="scalar__4x64_8h"/>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="31">
        <label>scratch.h</label>
        <link refid="scratch_8h"/>
      </node>
      <node id="18">
        <label>util.h</label>
        <link refid="secp256k1_2src_2util_8h"/>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
      </node>
      <node id="33">
        <label>util_local_visibility.h</label>
        <link refid="util__local__visibility_8h"/>
      </node>
      <node id="3">
        <label>span.h</label>
        <link refid="span_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>string.h</label>
        <link refid="string_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="9">
        <label>array</label>
      </node>
      <node id="4">
        <label>cassert</label>
      </node>
      <node id="5">
        <label>cstddef</label>
      </node>
      <node id="10">
        <label>cstdint</label>
      </node>
      <node id="11">
        <label>cstring</label>
      </node>
      <node id="24">
        <label>limits.h</label>
      </node>
      <node id="12">
        <label>locale</label>
      </node>
      <node id="6">
        <label>span</label>
      </node>
      <node id="13">
        <label>sstream</label>
      </node>
      <node id="20">
        <label>stddef.h</label>
      </node>
      <node id="17">
        <label>stdint.h</label>
      </node>
      <node id="23">
        <label>stdio.h</label>
      </node>
      <node id="22">
        <label>stdlib.h</label>
      </node>
      <node id="14">
        <label>string</label>
      </node>
      <node id="15">
        <label>string_view</label>
      </node>
      <node id="7">
        <label>type_traits</label>
      </node>
      <node id="8">
        <label>utility</label>
      </node>
      <node id="16">
        <label>vector</label>
      </node>
    </incdepgraph>
    <invincdepgraph>
      <node id="2">
        <label>src/secp256k1/src/bench_ecmult.c</label>
        <link refid="bench__ecmult_8c"/>
      </node>
      <node id="3">
        <label>src/secp256k1/src/bench_internal.c</label>
        <link refid="bench__internal_8c"/>
      </node>
      <node id="4">
        <label>src/secp256k1/src/ecmult_const_impl.h</label>
        <link refid="ecmult__const__impl_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>src/secp256k1/src/ecmult_impl.h</label>
        <link refid="ecmult__impl_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="5">
        <label>src/secp256k1/src/modules/ecdh/main_impl.h</label>
        <link refid="ecdh_2main__impl_8h"/>
      </node>
      <node id="6">
        <label>src/secp256k1/src/secp256k1.c</label>
        <link refid="secp256k1_8c"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="7">
        <label>src/secp256k1/src/tests.c</label>
        <link refid="tests_8c"/>
      </node>
      <node id="8">
        <label>src/secp256k1/src/tests_exhaustive.c</label>
        <link refid="tests__exhaustive_8c"/>
      </node>
    </invincdepgraph>
    <innerclass refid="structsecp256k1__strauss__point__state" prot="public">secp256k1_strauss_point_state</innerclass>
    <innerclass refid="structsecp256k1__strauss__state" prot="public">secp256k1_strauss_state</innerclass>
    <innerclass refid="structsecp256k1__pippenger__point__state" prot="public">secp256k1_pippenger_point_state</innerclass>
    <innerclass refid="structsecp256k1__pippenger__state" prot="public">secp256k1_pippenger_state</innerclass>
    <sectiondef kind="define">
      <memberdef kind="define" id="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" prot="public" static="no">
        <name>WINDOW_A</name>
        <initializer>5</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="32" column="11" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="32" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="ecmult__impl_8h_1a7ca5efdae3396a6261bcc836e4a32739" prot="public" static="no">
        <name>WNAF_BITS</name>
        <initializer>128</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Larger values for ECMULT_WINDOW_SIZE result in possibly better performance at the cost of an exponentially larger precomputed table. The exact table size is (1 &lt;&lt; (WINDOW_G - 2)) * sizeof(secp256k1_ge_storage) bytes, where sizeof(secp256k1_ge_storage) is typically 64 bytes but can be larger due to platform-specific padding and alignment. Two tables of this size are used (due to the endomorphism optimization). </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="44" column="9" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="44" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="ecmult__impl_8h_1ade3191685190c40779d2de9d0664216d" prot="public" static="no">
        <name>WNAF_SIZE_BITS</name>
        <param><defname>bits</defname></param>
        <param><defname>w</defname></param>
        <initializer><ref refid="secp256k1_2src_2util_8h_1afbc3b0509e5eeaa83c581c4c3f4fda43" kindref="member">CEIL_DIV</ref>(bits, w)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="45" column="9" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="45" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="ecmult__impl_8h_1a23d9fb349265ae338b9977f7f7aab065" prot="public" static="no">
        <name>WNAF_SIZE</name>
        <param><defname>w</defname></param>
        <initializer><ref refid="ecmult__impl_8h_1ade3191685190c40779d2de9d0664216d" kindref="member">WNAF_SIZE_BITS</ref>(<ref refid="ecmult__impl_8h_1a7ca5efdae3396a6261bcc836e4a32739" kindref="member">WNAF_BITS</ref>, w)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="46" column="9" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="46" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="ecmult__impl_8h_1a991c52a2d9fa18dd39f5a9fffe373922" prot="public" static="no">
        <name>PIPPENGER_SCRATCH_OBJECTS</name>
        <initializer>6</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="49" column="9" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="49" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="ecmult__impl_8h_1a0447eb99687dea95c58a48eb6b6e17e2" prot="public" static="no">
        <name>STRAUSS_SCRATCH_OBJECTS</name>
        <initializer>5</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="50" column="9" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="50" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="ecmult__impl_8h_1a9114820daf51f54afc1858640539ac6d" prot="public" static="no">
        <name>PIPPENGER_MAX_BUCKET_WINDOW</name>
        <initializer>12</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="52" column="9" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="52" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="ecmult__impl_8h_1a71e7f4ad865cad35efddc0495b59fcf3" prot="public" static="no">
        <name>ECMULT_PIPPENGER_THRESHOLD</name>
        <initializer>88</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="55" column="9" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="55" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="ecmult__impl_8h_1a8be09901326f35f4390bb788d9fa2fea" prot="public" static="no">
        <name>ECMULT_MAX_POINTS_PER_BATCH</name>
        <initializer>5000000</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="57" column="9" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="57" bodyend="-1"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="typedef">
      <memberdef kind="typedef" id="ecmult__impl_8h_1afedbad22c020fec93edb5823e9d385ed" prot="public" static="no">
        <type>int(*</type>
        <definition>typedef int(* secp256k1_ecmult_multi_func) (const secp256k1_callback *error_callback, secp256k1_scratch *, secp256k1_gej *, const secp256k1_scalar *, secp256k1_ecmult_multi_callback cb, void *, size_t)</definition>
        <argsstring>)(const secp256k1_callback *error_callback, secp256k1_scratch *, secp256k1_gej *, const secp256k1_scalar *, secp256k1_ecmult_multi_callback cb, void *, size_t)</argsstring>
        <name>secp256k1_ecmult_multi_func</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="806" column="9" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="806" bodyend="-1"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="func">
      <memberdef kind="function" id="ecmult__impl_8h_1aed8dc2160c07c97c063bdeffbffa46a8" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_ecmult_odd_multiples_table</definition>
        <argsstring>(int n, secp256k1_ge *pre_a, secp256k1_fe *zr, secp256k1_fe *z, const secp256k1_gej *a)</argsstring>
        <name>secp256k1_ecmult_odd_multiples_table</name>
        <param>
          <type>int</type>
          <declname>n</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>pre_a</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>zr</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>z</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref> *</type>
          <declname>a</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Fill a table &apos;pre_a&apos; with precomputed odd multiples of a. pre_a will contain [1*a,3*a,...,(2*n-1)*a], so it needs space for n group elements. zr needs space for n field elements.</para>
<para>Although pre_a is an array of _ge rather than _gej, it actually represents elements in Jacobian coordinates with their z coordinates omitted. The omitted z-coordinates can be recovered using z and zr. Using the notation z(b) to represent the omitted z coordinate of b:<itemizedlist>
<listitem><para>z(pre_a[n-1]) = &apos;z&apos;</para>
</listitem><listitem><para>z(pre_a[i-1]) = z(pre_a[i]) / zr[i] for n &gt; i &gt; 0</para>
</listitem></itemizedlist>
</para>
<para>Lastly the zr[0] value, which isn&apos;t used above, is set so that:<itemizedlist>
<listitem><para>a.z = z(pre_a[0]) / zr[0] </para>
</listitem></itemizedlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="73" column="13" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="73" bodyend="115"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1aac2c9ba836aa415ab130a0360adac245" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="secp256k1_2src_2util_8h_1a7ddc487fd46aee88f21cabedb7268b1e" kindref="member">SECP256K1_INLINE</ref> void</type>
        <definition>static SECP256K1_INLINE void secp256k1_ecmult_table_verify</definition>
        <argsstring>(int n, int w)</argsstring>
        <name>secp256k1_ecmult_table_verify</name>
        <param>
          <type>int</type>
          <declname>n</declname>
        </param>
        <param>
          <type>int</type>
          <declname>w</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="117" column="30" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="117" bodyend="123"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1abc5af5df03e9ee8d78ea2489c05338bc" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="secp256k1_2src_2util_8h_1a7ddc487fd46aee88f21cabedb7268b1e" kindref="member">SECP256K1_INLINE</ref> void</type>
        <definition>static SECP256K1_INLINE void secp256k1_ecmult_table_get_ge</definition>
        <argsstring>(secp256k1_ge *r, const secp256k1_ge *pre, int n, int w)</argsstring>
        <name>secp256k1_ecmult_table_get_ge</name>
        <param>
          <type><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>r</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>pre</declname>
        </param>
        <param>
          <type>int</type>
          <declname>n</declname>
        </param>
        <param>
          <type>int</type>
          <declname>w</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="125" column="30" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="125" bodyend="133"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1a5c5a19ad45aa3f057dc34e92ae6bf1df" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="secp256k1_2src_2util_8h_1a7ddc487fd46aee88f21cabedb7268b1e" kindref="member">SECP256K1_INLINE</ref> void</type>
        <definition>static SECP256K1_INLINE void secp256k1_ecmult_table_get_ge_lambda</definition>
        <argsstring>(secp256k1_ge *r, const secp256k1_ge *pre, const secp256k1_fe *x, int n, int w)</argsstring>
        <name>secp256k1_ecmult_table_get_ge_lambda</name>
        <param>
          <type><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>r</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>pre</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref> *</type>
          <declname>x</declname>
        </param>
        <param>
          <type>int</type>
          <declname>n</declname>
        </param>
        <param>
          <type>int</type>
          <declname>w</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="135" column="30" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="135" bodyend="143"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1a4cd4a3ce3d9292cd197283fc0e17749c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="secp256k1_2src_2util_8h_1a7ddc487fd46aee88f21cabedb7268b1e" kindref="member">SECP256K1_INLINE</ref> void</type>
        <definition>static SECP256K1_INLINE void secp256k1_ecmult_table_get_ge_storage</definition>
        <argsstring>(secp256k1_ge *r, const secp256k1_ge_storage *pre, int n, int w)</argsstring>
        <name>secp256k1_ecmult_table_get_ge_storage</name>
        <param>
          <type><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>r</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__ge__storage" kindref="compound">secp256k1_ge_storage</ref> *</type>
          <declname>pre</declname>
        </param>
        <param>
          <type>int</type>
          <declname>n</declname>
        </param>
        <param>
          <type>int</type>
          <declname>w</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="145" column="30" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="145" bodyend="153"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1a48a8b6bbead18d4475c8a29d28376c5b" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_ecmult_wnaf</definition>
        <argsstring>(int *wnaf, int len, const secp256k1_scalar *a, int w)</argsstring>
        <name>secp256k1_ecmult_wnaf</name>
        <param>
          <type>int *</type>
          <declname>wnaf</declname>
        </param>
        <param>
          <type>int</type>
          <declname>len</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>a</declname>
        </param>
        <param>
          <type>int</type>
          <declname>w</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Convert a number to WNAF notation. The number becomes represented by sum(2^i * wnaf[i], i=0..bits), with the following guarantees:<itemizedlist>
<listitem><para>each wnaf[i] is either 0, or an odd integer between -(1&lt;&lt;(w-1) - 1) and (1&lt;&lt;(w-1) - 1)</para>
</listitem><listitem><para>two non-zero entries in wnaf are separated by at least w-1 zeroes.</para>
</listitem><listitem><para>the number of set values in wnaf is returned. This number is at most 256, and at most one more than the number of bits in the (absolute value) of the input. </para>
</listitem></itemizedlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="162" column="12" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="162" bodyend="221"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1af712c07897d43e290c166f73d11fd110" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_ecmult_strauss_wnaf</definition>
        <argsstring>(const struct secp256k1_strauss_state *state, secp256k1_gej *r, size_t num, const secp256k1_gej *a, const secp256k1_scalar *na, const secp256k1_scalar *ng)</argsstring>
        <name>secp256k1_ecmult_strauss_wnaf</name>
        <param>
          <type>const struct <ref refid="structsecp256k1__strauss__state" kindref="compound">secp256k1_strauss_state</ref> *</type>
          <declname>state</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref> *</type>
          <declname>r</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>num</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref> *</type>
          <declname>a</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>na</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>ng</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="237" column="13" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="237" bodyend="347"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1aa405bbca6527b19cbdfe5658272044db" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_ecmult</definition>
        <argsstring>(secp256k1_gej *r, const secp256k1_gej *a, const secp256k1_scalar *na, const secp256k1_scalar *ng)</argsstring>
        <name>secp256k1_ecmult</name>
        <param>
          <type><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref> *</type>
          <declname>r</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref> *</type>
          <declname>a</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>na</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>ng</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="349" column="13" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="349" bodyend="359"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1a7146d7f05cdd7440271523da3674004c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>size_t</type>
        <definition>static size_t secp256k1_strauss_scratch_size</definition>
        <argsstring>(size_t n_points)</argsstring>
        <name>secp256k1_strauss_scratch_size</name>
        <param>
          <type>size_t</type>
          <declname>n_points</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="361" column="15" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="361" bodyend="364"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1aa185e51cc47dae567c15da179a1b4b7c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_ecmult_strauss_batch</definition>
        <argsstring>(const secp256k1_callback *error_callback, secp256k1_scratch *scratch, secp256k1_gej *r, const secp256k1_scalar *inp_g_sc, secp256k1_ecmult_multi_callback cb, void *cbdata, size_t n_points, size_t cb_offset)</argsstring>
        <name>secp256k1_ecmult_strauss_batch</name>
        <param>
          <type>const <ref refid="structsecp256k1__callback" kindref="compound">secp256k1_callback</ref> *</type>
          <declname>error_callback</declname>
        </param>
        <param>
          <type><ref refid="scratch_8h_1a84bdf30f4ca993587d89471cf1ae8be7" kindref="member">secp256k1_scratch</ref> *</type>
          <declname>scratch</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref> *</type>
          <declname>r</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>inp_g_sc</declname>
        </param>
        <param>
          <type><ref refid="ecmult_8h_1a0f127c89ba0f17e7992666f3d789e58e" kindref="member">secp256k1_ecmult_multi_callback</ref></type>
          <declname>cb</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>cbdata</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n_points</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>cb_offset</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="366" column="12" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="366" bodyend="403"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1a24500d7bf818b6782b88e2e53dcf85e2" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_ecmult_strauss_batch_single</definition>
        <argsstring>(const secp256k1_callback *error_callback, secp256k1_scratch *scratch, secp256k1_gej *r, const secp256k1_scalar *inp_g_sc, secp256k1_ecmult_multi_callback cb, void *cbdata, size_t n)</argsstring>
        <name>secp256k1_ecmult_strauss_batch_single</name>
        <param>
          <type>const <ref refid="structsecp256k1__callback" kindref="compound">secp256k1_callback</ref> *</type>
          <declname>error_callback</declname>
        </param>
        <param>
          <type><ref refid="scratch_8h_1a84bdf30f4ca993587d89471cf1ae8be7" kindref="member">secp256k1_scratch</ref> *</type>
          <declname>scratch</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref> *</type>
          <declname>r</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>inp_g_sc</declname>
        </param>
        <param>
          <type><ref refid="ecmult_8h_1a0f127c89ba0f17e7992666f3d789e58e" kindref="member">secp256k1_ecmult_multi_callback</ref></type>
          <declname>cb</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>cbdata</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="406" column="12" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="406" bodyend="408"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1a2ed67cbaf00f8ccdfff87129844b8635" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>size_t</type>
        <definition>static size_t secp256k1_strauss_max_points</definition>
        <argsstring>(const secp256k1_callback *error_callback, secp256k1_scratch *scratch)</argsstring>
        <name>secp256k1_strauss_max_points</name>
        <param>
          <type>const <ref refid="structsecp256k1__callback" kindref="compound">secp256k1_callback</ref> *</type>
          <declname>error_callback</declname>
        </param>
        <param>
          <type><ref refid="scratch_8h_1a84bdf30f4ca993587d89471cf1ae8be7" kindref="member">secp256k1_scratch</ref> *</type>
          <declname>scratch</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="410" column="15" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="410" bodyend="412"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1a346b925ab43432349898ad6a7ac9c31a" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_wnaf_fixed</definition>
        <argsstring>(int *wnaf, const secp256k1_scalar *s, int w)</argsstring>
        <name>secp256k1_wnaf_fixed</name>
        <param>
          <type>int *</type>
          <declname>wnaf</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>s</declname>
        </param>
        <param>
          <type>int</type>
          <declname>w</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Convert a number to WNAF notation. The number becomes represented by sum(2^{wi} * wnaf[i], i=0..<ref refid="ecmult__impl_8h_1a23d9fb349265ae338b9977f7f7aab065" kindref="member">WNAF_SIZE(w)</ref>+1) - return_val. It has the following guarantees:<itemizedlist>
<listitem><para>each wnaf[i] is either 0 or an odd integer between -(1 &lt;&lt; w) and (1 &lt;&lt; w)</para>
</listitem><listitem><para>the number of words set is always <ref refid="ecmult__impl_8h_1a23d9fb349265ae338b9977f7f7aab065" kindref="member">WNAF_SIZE(w)</ref></para>
</listitem><listitem><para>the returned skew is 0 or 1 </para>
</listitem></itemizedlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="421" column="12" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="421" bodyend="481"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1ab9fa16936f32ca87ef0fa602dd440e61" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_ecmult_pippenger_wnaf</definition>
        <argsstring>(secp256k1_gej *buckets, int bucket_window, struct secp256k1_pippenger_state *state, secp256k1_gej *r, const secp256k1_scalar *sc, const secp256k1_ge *pt, size_t num)</argsstring>
        <name>secp256k1_ecmult_pippenger_wnaf</name>
        <param>
          <type><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref> *</type>
          <declname>buckets</declname>
        </param>
        <param>
          <type>int</type>
          <declname>bucket_window</declname>
        </param>
        <param>
          <type>struct <ref refid="structsecp256k1__pippenger__state" kindref="compound">secp256k1_pippenger_state</ref> *</type>
          <declname>state</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref> *</type>
          <declname>r</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>sc</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>pt</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>num</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="500" column="12" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="500" bodyend="575"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1a7ab4c858354f0c2f67bf76642b15d82c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_pippenger_bucket_window</definition>
        <argsstring>(size_t n)</argsstring>
        <name>secp256k1_pippenger_bucket_window</name>
        <param>
          <type>size_t</type>
          <declname>n</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Returns optimal bucket_window (number of bits of a scalar represented by a set of buckets) for a given number of points. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="581" column="12" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="581" bodyend="605"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1a087cc0c7875deb19ebefb6c7f86979e0" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>size_t</type>
        <definition>static size_t secp256k1_pippenger_bucket_window_inv</definition>
        <argsstring>(int bucket_window)</argsstring>
        <name>secp256k1_pippenger_bucket_window_inv</name>
        <param>
          <type>int</type>
          <declname>bucket_window</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Returns the maximum optimal number of points for a bucket_window. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="610" column="15" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="610" bodyend="626"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1a3b82a0af2e50a893f660ee0c0cad6886" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="secp256k1_2src_2util_8h_1a7ddc487fd46aee88f21cabedb7268b1e" kindref="member">SECP256K1_INLINE</ref> void</type>
        <definition>static SECP256K1_INLINE void secp256k1_ecmult_endo_split</definition>
        <argsstring>(secp256k1_scalar *s1, secp256k1_scalar *s2, secp256k1_ge *p1, secp256k1_ge *p2)</argsstring>
        <name>secp256k1_ecmult_endo_split</name>
        <param>
          <type><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>s1</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>s2</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>p1</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>p2</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="629" column="30" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="629" bodyend="642"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1abb210b3b61e37937e46f58e3d78f89d1" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>size_t</type>
        <definition>static size_t secp256k1_pippenger_scratch_size</definition>
        <argsstring>(size_t n_points, int bucket_window)</argsstring>
        <name>secp256k1_pippenger_scratch_size</name>
        <param>
          <type>size_t</type>
          <declname>n_points</declname>
        </param>
        <param>
          <type>int</type>
          <declname>bucket_window</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Returns the scratch size required for a given number of points (excluding base point G) without considering alignment. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="648" column="15" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="648" bodyend="652"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1a1372e3ca22fc9730cc744a2007c6b1f3" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_ecmult_pippenger_batch</definition>
        <argsstring>(const secp256k1_callback *error_callback, secp256k1_scratch *scratch, secp256k1_gej *r, const secp256k1_scalar *inp_g_sc, secp256k1_ecmult_multi_callback cb, void *cbdata, size_t n_points, size_t cb_offset)</argsstring>
        <name>secp256k1_ecmult_pippenger_batch</name>
        <param>
          <type>const <ref refid="structsecp256k1__callback" kindref="compound">secp256k1_callback</ref> *</type>
          <declname>error_callback</declname>
        </param>
        <param>
          <type><ref refid="scratch_8h_1a84bdf30f4ca993587d89471cf1ae8be7" kindref="member">secp256k1_scratch</ref> *</type>
          <declname>scratch</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref> *</type>
          <declname>r</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>inp_g_sc</declname>
        </param>
        <param>
          <type><ref refid="ecmult_8h_1a0f127c89ba0f17e7992666f3d789e58e" kindref="member">secp256k1_ecmult_multi_callback</ref></type>
          <declname>cb</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>cbdata</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n_points</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>cb_offset</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="654" column="12" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="654" bodyend="715"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1a7b70dc19eefeb37607ba72cf32f61847" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_ecmult_pippenger_batch_single</definition>
        <argsstring>(const secp256k1_callback *error_callback, secp256k1_scratch *scratch, secp256k1_gej *r, const secp256k1_scalar *inp_g_sc, secp256k1_ecmult_multi_callback cb, void *cbdata, size_t n)</argsstring>
        <name>secp256k1_ecmult_pippenger_batch_single</name>
        <param>
          <type>const <ref refid="structsecp256k1__callback" kindref="compound">secp256k1_callback</ref> *</type>
          <declname>error_callback</declname>
        </param>
        <param>
          <type><ref refid="scratch_8h_1a84bdf30f4ca993587d89471cf1ae8be7" kindref="member">secp256k1_scratch</ref> *</type>
          <declname>scratch</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref> *</type>
          <declname>r</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>inp_g_sc</declname>
        </param>
        <param>
          <type><ref refid="ecmult_8h_1a0f127c89ba0f17e7992666f3d789e58e" kindref="member">secp256k1_ecmult_multi_callback</ref></type>
          <declname>cb</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>cbdata</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="718" column="12" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="718" bodyend="720"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1a117129015e68d74721e8c62320bb86c7" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>size_t</type>
        <definition>static size_t secp256k1_pippenger_max_points</definition>
        <argsstring>(const secp256k1_callback *error_callback, secp256k1_scratch *scratch)</argsstring>
        <name>secp256k1_pippenger_max_points</name>
        <param>
          <type>const <ref refid="structsecp256k1__callback" kindref="compound">secp256k1_callback</ref> *</type>
          <declname>error_callback</declname>
        </param>
        <param>
          <type><ref refid="scratch_8h_1a84bdf30f4ca993587d89471cf1ae8be7" kindref="member">secp256k1_scratch</ref> *</type>
          <declname>scratch</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Returns the maximum number of points in addition to G that can be used with a given scratch space. The function ensures that fewer points may also be used. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="727" column="15" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="727" bodyend="759"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1a77c14862f4d2e7d6306a884c64baa8ad" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_ecmult_multi_simple_var</definition>
        <argsstring>(secp256k1_gej *r, const secp256k1_scalar *inp_g_sc, secp256k1_ecmult_multi_callback cb, void *cbdata, size_t n_points)</argsstring>
        <name>secp256k1_ecmult_multi_simple_var</name>
        <param>
          <type><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref> *</type>
          <declname>r</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>inp_g_sc</declname>
        </param>
        <param>
          <type><ref refid="ecmult_8h_1a0f127c89ba0f17e7992666f3d789e58e" kindref="member">secp256k1_ecmult_multi_callback</ref></type>
          <declname>cb</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>cbdata</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n_points</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="763" column="12" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="763" bodyend="784"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1aab645acb4c1b1831b5183926474c7335" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_ecmult_multi_batch_size_helper</definition>
        <argsstring>(size_t *n_batches, size_t *n_batch_points, size_t max_n_batch_points, size_t n)</argsstring>
        <name>secp256k1_ecmult_multi_batch_size_helper</name>
        <param>
          <type>size_t *</type>
          <declname>n_batches</declname>
        </param>
        <param>
          <type>size_t *</type>
          <declname>n_batch_points</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>max_n_batch_points</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="788" column="12" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="788" bodyend="804"/>
      </memberdef>
      <memberdef kind="function" id="ecmult__impl_8h_1a570f27c620391853d1ca8e4be199eb66" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_ecmult_multi_var</definition>
        <argsstring>(const secp256k1_callback *error_callback, secp256k1_scratch *scratch, secp256k1_gej *r, const secp256k1_scalar *inp_g_sc, secp256k1_ecmult_multi_callback cb, void *cbdata, size_t n)</argsstring>
        <name>secp256k1_ecmult_multi_var</name>
        <param>
          <type>const <ref refid="structsecp256k1__callback" kindref="compound">secp256k1_callback</ref> *</type>
          <declname>error_callback</declname>
        </param>
        <param>
          <type><ref refid="scratch_8h_1a84bdf30f4ca993587d89471cf1ae8be7" kindref="member">secp256k1_scratch</ref> *</type>
          <declname>scratch</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref> *</type>
          <declname>r</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>inp_g_sc</declname>
        </param>
        <param>
          <type><ref refid="ecmult_8h_1a0f127c89ba0f17e7992666f3d789e58e" kindref="member">secp256k1_ecmult_multi_callback</ref></type>
          <declname>cb</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>cbdata</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/ecmult_impl.h" line="807" column="12" bodyfile="src/secp256k1/src/ecmult_impl.h" bodystart="807" bodyend="851"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/******************************************************************************</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>Copyright<sp/>(c)<sp/>2013,<sp/>2014,<sp/>2017<sp/>Pieter<sp/>Wuille,<sp/>Andrew<sp/>Poelstra,<sp/>Jonas<sp/>Nick<sp/><sp/>*</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>Distributed<sp/>under<sp/>the<sp/>MIT<sp/>software<sp/>license,<sp/>see<sp/>the<sp/>accompanying<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*<sp/>file<sp/>COPYING<sp/>or<sp/>https://www.opensource.org/licenses/mit-license.php.<sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="5"><highlight class="comment"><sp/>******************************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>SECP256K1_ECMULT_IMPL_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>SECP256K1_ECMULT_IMPL_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="string_8h" kindref="compound">string.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdint.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="secp256k1_2src_2util_8h" kindref="compound">util.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="group_8h" kindref="compound">group.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="scalar_8h" kindref="compound">scalar.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="ecmult_8h" kindref="compound">ecmult.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="precomputed__ecmult_8h" kindref="compound">precomputed_ecmult.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>defined(EXHAUSTIVE_TEST_ORDER)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>We<sp/>need<sp/>to<sp/>lower<sp/>these<sp/>values<sp/>for<sp/>exhaustive<sp/>tests<sp/>because</highlight></codeline>
<codeline lineno="21"><highlight class="comment"><sp/>*<sp/>the<sp/>tables<sp/>cannot<sp/>have<sp/>infinities<sp/>in<sp/>them<sp/>(this<sp/>breaks<sp/>the</highlight></codeline>
<codeline lineno="22"><highlight class="comment"><sp/>*<sp/>affine-isomorphism<sp/>stuff<sp/>which<sp/>tracks<sp/>z-ratios)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/>if<sp/>EXHAUSTIVE_TEST_ORDER<sp/>&gt;<sp/>128</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/><sp/><sp/>define<sp/>WINDOW_A<sp/>5</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/>elif<sp/>EXHAUSTIVE_TEST_ORDER<sp/>&gt;<sp/>8</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/><sp/><sp/>define<sp/>WINDOW_A<sp/>4</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/>else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/><sp/><sp/>define<sp/>WINDOW_A<sp/>2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/>endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>optimal<sp/>for<sp/>128-bit<sp/>and<sp/>256-bit<sp/>exponents.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32" refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/>define<sp/>WINDOW_A<sp/>5</highlight><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight></codeline>
<codeline lineno="44" refid="ecmult__impl_8h_1a7ca5efdae3396a6261bcc836e4a32739" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>WNAF_BITS<sp/>128</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45" refid="ecmult__impl_8h_1ade3191685190c40779d2de9d0664216d" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>WNAF_SIZE_BITS(bits,<sp/>w)<sp/>CEIL_DIV(bits,<sp/>w)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="46" refid="ecmult__impl_8h_1a23d9fb349265ae338b9977f7f7aab065" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>WNAF_SIZE(w)<sp/>WNAF_SIZE_BITS(WNAF_BITS,<sp/>w)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>The<sp/>number<sp/>of<sp/>objects<sp/>allocated<sp/>on<sp/>the<sp/>scratch<sp/>space<sp/>for<sp/>ecmult_multi<sp/>algorithms<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49" refid="ecmult__impl_8h_1a991c52a2d9fa18dd39f5a9fffe373922" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>PIPPENGER_SCRATCH_OBJECTS<sp/>6</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50" refid="ecmult__impl_8h_1a0447eb99687dea95c58a48eb6b6e17e2" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>STRAUSS_SCRATCH_OBJECTS<sp/>5</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight></codeline>
<codeline lineno="52" refid="ecmult__impl_8h_1a9114820daf51f54afc1858640539ac6d" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>PIPPENGER_MAX_BUCKET_WINDOW<sp/>12</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Minimum<sp/>number<sp/>of<sp/>points<sp/>for<sp/>which<sp/>pippenger_wnaf<sp/>is<sp/>faster<sp/>than<sp/>strauss<sp/>wnaf<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55" refid="ecmult__impl_8h_1a71e7f4ad865cad35efddc0495b59fcf3" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>ECMULT_PIPPENGER_THRESHOLD<sp/>88</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57" refid="ecmult__impl_8h_1a8be09901326f35f4390bb788d9fa2fea" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>ECMULT_MAX_POINTS_PER_BATCH<sp/>5000000</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_ecmult_odd_multiples_table(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n,<sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*pre_a,<sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*zr,<sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*z,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>*a)<sp/>{</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>d,<sp/>ai;</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>d_ge;</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(!a-&gt;<ref refid="structsecp256k1__gej_1a652f88fb6bac77f1882023c1410e84d3" kindref="member">infinity</ref>);</highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_gej_double_var(&amp;d,<sp/>a,<sp/>NULL);</highlight></codeline>
<codeline lineno="81"><highlight class="normal"></highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="83"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>Perform<sp/>the<sp/>additions<sp/>using<sp/>an<sp/>isomorphic<sp/>curve<sp/>Y^2<sp/>=<sp/>X^3<sp/>+<sp/>7*C^6<sp/>where<sp/>C<sp/>:=<sp/>d.z.</highlight></codeline>
<codeline lineno="84"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>The<sp/>isomorphism,<sp/>phi,<sp/>maps<sp/>a<sp/>secp256k1<sp/>point<sp/>(x,<sp/>y)<sp/>to<sp/>the<sp/>point<sp/>(x*C^2,<sp/>y*C^3)<sp/>on<sp/>the<sp/>other<sp/>curve.</highlight></codeline>
<codeline lineno="85"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>In<sp/>Jacobian<sp/>coordinates<sp/>phi<sp/>maps<sp/>(x,<sp/>y,<sp/>z)<sp/>to<sp/>(x*C^2,<sp/>y*C^3,<sp/>z)<sp/>or,<sp/>equivalently<sp/>to<sp/>(x,<sp/>y,<sp/>z/C).</highlight></codeline>
<codeline lineno="86"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="87"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>phi(x,<sp/>y,<sp/>z)<sp/>=<sp/>(x*C^2,<sp/>y*C^3,<sp/>z)<sp/>=<sp/>(x,<sp/>y,<sp/>z/C)</highlight></codeline>
<codeline lineno="88"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/>d_ge<sp/>:=<sp/>phi(d)<sp/>=<sp/>(d.x,<sp/>d.y,<sp/>1)</highlight></codeline>
<codeline lineno="89"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>ai<sp/>:=<sp/>phi(a)<sp/>=<sp/>(a.x*C^2,<sp/>a.y*C^3,<sp/>a.z)</highlight></codeline>
<codeline lineno="90"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="91"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>The<sp/>group<sp/>addition<sp/>functions<sp/>work<sp/>correctly<sp/>on<sp/>these<sp/>isomorphic<sp/>curves.</highlight></codeline>
<codeline lineno="92"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>In<sp/>particular<sp/>phi(d)<sp/>is<sp/>easy<sp/>to<sp/>represent<sp/>in<sp/>affine<sp/>coordinates<sp/>under<sp/>this<sp/>isomorphism.</highlight></codeline>
<codeline lineno="93"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>This<sp/>lets<sp/>us<sp/>use<sp/>the<sp/>faster<sp/>secp256k1_gej_add_ge_var<sp/>group<sp/>addition<sp/>function<sp/>that<sp/>we<sp/>wouldn&apos;t<sp/>be<sp/>able<sp/>to<sp/>use<sp/>otherwise.</highlight></codeline>
<codeline lineno="94"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ge_set_xy(&amp;d_ge,<sp/>&amp;d.<ref refid="structsecp256k1__gej_1af089d748d95dc12c1185adae8e11972d" kindref="member">x</ref>,<sp/>&amp;d.<ref refid="structsecp256k1__gej_1a8ab8d07fa557181528b86bd1c9bb2b92" kindref="member">y</ref>);</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ge_set_gej_zinv(&amp;pre_a[0],<sp/>a,<sp/>&amp;d.<ref refid="structsecp256k1__gej_1a761e4ae44d26ee28461beeaf09a26218" kindref="member">z</ref>);</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_gej_set_ge(&amp;ai,<sp/>&amp;pre_a[0]);</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/>ai.<ref refid="structsecp256k1__gej_1a761e4ae44d26ee28461beeaf09a26218" kindref="member">z</ref><sp/>=<sp/>a-&gt;<ref refid="structsecp256k1__gej_1a761e4ae44d26ee28461beeaf09a26218" kindref="member">z</ref>;</highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>pre_a[0]<sp/>is<sp/>the<sp/>point<sp/>(a.x*C^2,<sp/>a.y*C^3,<sp/>a.z*C)<sp/>which<sp/>is<sp/>equivalent<sp/>to<sp/>a.</highlight></codeline>
<codeline lineno="101"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>Set<sp/>zr[0]<sp/>to<sp/>C,<sp/>which<sp/>is<sp/>the<sp/>ratio<sp/>between<sp/>the<sp/>omitted<sp/>z(pre_a[0])<sp/>value<sp/>and<sp/>a.z.</highlight></codeline>
<codeline lineno="102"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/>zr[0]<sp/>=<sp/>d.<ref refid="structsecp256k1__gej_1a761e4ae44d26ee28461beeaf09a26218" kindref="member">z</ref>;</highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>1;<sp/>i<sp/>&lt;<sp/>n;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_add_ge_var(&amp;ai,<sp/>&amp;ai,<sp/>&amp;d_ge,<sp/>&amp;zr[i]);</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ge_set_xy(&amp;pre_a[i],<sp/>&amp;ai.<ref refid="structsecp256k1__gej_1af089d748d95dc12c1185adae8e11972d" kindref="member">x</ref>,<sp/>&amp;ai.<ref refid="structsecp256k1__gej_1a8ab8d07fa557181528b86bd1c9bb2b92" kindref="member">y</ref>);</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="109"><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Multiply<sp/>the<sp/>last<sp/>z-coordinate<sp/>by<sp/>C<sp/>to<sp/>undo<sp/>the<sp/>isomorphism.</highlight></codeline>
<codeline lineno="111"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>Since<sp/>the<sp/>z-coordinates<sp/>of<sp/>the<sp/>pre_a<sp/>values<sp/>are<sp/>implied<sp/>by<sp/>the<sp/>zr<sp/>array<sp/>of<sp/>z-coordinate<sp/>ratios,</highlight></codeline>
<codeline lineno="112"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>undoing<sp/>the<sp/>isomorphism<sp/>here<sp/>undoes<sp/>the<sp/>isomorphism<sp/>for<sp/>all<sp/>pre_a<sp/>values.</highlight></codeline>
<codeline lineno="113"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(z,<sp/>&amp;ai.<ref refid="structsecp256k1__gej_1a761e4ae44d26ee28461beeaf09a26218" kindref="member">z</ref>,<sp/>&amp;d.<ref refid="structsecp256k1__gej_1a761e4ae44d26ee28461beeaf09a26218" kindref="member">z</ref>);</highlight></codeline>
<codeline lineno="115"><highlight class="normal">}</highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><ref refid="secp256k1_2src_2util_8h_1a7ddc487fd46aee88f21cabedb7268b1e" kindref="member">SECP256K1_INLINE</ref><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_ecmult_table_verify(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>w)<sp/>{</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)n;</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)w;</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(((n)<sp/>&amp;<sp/>1)<sp/>==<sp/>1);</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>((n)<sp/>&gt;=<sp/>-((1<sp/>&lt;&lt;<sp/>((w)-1))<sp/>-<sp/>1));</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>((n)<sp/>&lt;=<sp/><sp/>((1<sp/>&lt;&lt;<sp/>((w)-1))<sp/>-<sp/>1));</highlight></codeline>
<codeline lineno="123"><highlight class="normal">}</highlight></codeline>
<codeline lineno="124"><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"><ref refid="secp256k1_2src_2util_8h_1a7ddc487fd46aee88f21cabedb7268b1e" kindref="member">SECP256K1_INLINE</ref><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_ecmult_table_get_ge(<ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*r,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*pre,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>w)<sp/>{</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ecmult_table_verify(n,w);</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*r<sp/>=<sp/>pre[(n-1)/2];</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*r<sp/>=<sp/>pre[(-n-1)/2];</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a10e9ec8d30dca4e992dd0f9075beb574" kindref="member">secp256k1_fe_negate</ref>(&amp;(r-&gt;<ref refid="structsecp256k1__ge_1a8ab8d07fa557181528b86bd1c9bb2b92" kindref="member">y</ref>),<sp/>&amp;(r-&gt;<ref refid="structsecp256k1__ge_1a8ab8d07fa557181528b86bd1c9bb2b92" kindref="member">y</ref>),<sp/>1);</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="133"><highlight class="normal">}</highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><ref refid="secp256k1_2src_2util_8h_1a7ddc487fd46aee88f21cabedb7268b1e" kindref="member">SECP256K1_INLINE</ref><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_ecmult_table_get_ge_lambda(<ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*r,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*pre,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>*x,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>w)<sp/>{</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ecmult_table_verify(n,w);</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ge_set_xy(r,<sp/>&amp;x[(n-1)/2],<sp/>&amp;pre[(n-1)/2].y);</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ge_set_xy(r,<sp/>&amp;x[(-n-1)/2],<sp/>&amp;pre[(-n-1)/2].y);</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a10e9ec8d30dca4e992dd0f9075beb574" kindref="member">secp256k1_fe_negate</ref>(&amp;(r-&gt;<ref refid="structsecp256k1__ge_1a8ab8d07fa557181528b86bd1c9bb2b92" kindref="member">y</ref>),<sp/>&amp;(r-&gt;<ref refid="structsecp256k1__ge_1a8ab8d07fa557181528b86bd1c9bb2b92" kindref="member">y</ref>),<sp/>1);</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="143"><highlight class="normal">}</highlight></codeline>
<codeline lineno="144"><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"><ref refid="secp256k1_2src_2util_8h_1a7ddc487fd46aee88f21cabedb7268b1e" kindref="member">SECP256K1_INLINE</ref><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_ecmult_table_get_ge_storage(<ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*r,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__ge__storage" kindref="compound">secp256k1_ge_storage</ref><sp/>*pre,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>w)<sp/>{</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ecmult_table_verify(n,w);</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ge_from_storage(r,<sp/>&amp;pre[(n-1)/2]);</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ge_from_storage(r,<sp/>&amp;pre[(-n-1)/2]);</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a10e9ec8d30dca4e992dd0f9075beb574" kindref="member">secp256k1_fe_negate</ref>(&amp;(r-&gt;<ref refid="structsecp256k1__ge_1a8ab8d07fa557181528b86bd1c9bb2b92" kindref="member">y</ref>),<sp/>&amp;(r-&gt;<ref refid="structsecp256k1__ge_1a8ab8d07fa557181528b86bd1c9bb2b92" kindref="member">y</ref>),<sp/>1);</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="153"><highlight class="normal">}</highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_ecmult_wnaf(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*wnaf,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>len,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*a,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>w)<sp/>{</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/><ref refid="namespacetest__vectors__musig2__generate_1a5fcf9c70fa717a8efd481752dcb8ffa4" kindref="member">s</ref>;</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>last_set_bit<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bit<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>sign<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>carry<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(wnaf<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(0<sp/>&lt;=<sp/>len<sp/>&amp;&amp;<sp/>len<sp/>&lt;=<sp/>256);</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(a<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(2<sp/>&lt;=<sp/>w<sp/>&amp;&amp;<sp/>w<sp/>&lt;=<sp/>31);</highlight></codeline>
<codeline lineno="173"><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(bit<sp/>=<sp/>0;<sp/>bit<sp/>&lt;<sp/>len;<sp/>bit++)<sp/>{</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wnaf[bit]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="177"><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespacetest__vectors__musig2__generate_1a5fcf9c70fa717a8efd481752dcb8ffa4" kindref="member">s</ref><sp/>=<sp/>*a;</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(secp256k1_scalar_get_bits_limb32(&amp;s,<sp/>255,<sp/>1))<sp/>{</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_negate(&amp;s,<sp/>&amp;s);</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sign<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="183"><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/>bit<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(bit<sp/>&lt;<sp/>len)<sp/>{</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>now;</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>word;</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(secp256k1_scalar_get_bits_limb32(&amp;s,<sp/>bit,<sp/>1)<sp/>==<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)carry)<sp/>{</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bit++;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="192"><highlight class="normal"></highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>now<sp/>=<sp/>w;</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(now<sp/>&gt;<sp/>len<sp/>-<sp/>bit)<sp/>{</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>now<sp/>=<sp/>len<sp/>-<sp/>bit;</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="197"><highlight class="normal"></highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>word<sp/>=<sp/>secp256k1_scalar_get_bits_var(&amp;s,<sp/>bit,<sp/>now)<sp/>+<sp/>carry;</highlight></codeline>
<codeline lineno="199"><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>carry<sp/>=<sp/>(word<sp/>&gt;&gt;<sp/>(w-1))<sp/>&amp;<sp/>1;</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>word<sp/>-=<sp/>carry<sp/>&lt;&lt;<sp/>w;</highlight></codeline>
<codeline lineno="202"><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wnaf[bit]<sp/>=<sp/>sign<sp/>*<sp/>word;</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>last_set_bit<sp/>=<sp/>bit;</highlight></codeline>
<codeline lineno="205"><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bit<sp/>+=<sp/>now;</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="208"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>VERIFY</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>verify_bit<sp/>=<sp/>bit;</highlight></codeline>
<codeline lineno="211"><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(carry<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="213"><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(verify_bit<sp/>&lt;<sp/>256)<sp/>{</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(secp256k1_scalar_get_bits_limb32(&amp;s,<sp/>verify_bit,<sp/>1)<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>verify_bit++;</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="219"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>last_set_bit<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="221"><highlight class="normal">}</highlight></codeline>
<codeline lineno="222"><highlight class="normal"></highlight></codeline>
<codeline lineno="223" refid="structsecp256k1__strauss__point__state" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__strauss__point__state" kindref="compound">secp256k1_strauss_point_state</ref><sp/>{</highlight></codeline>
<codeline lineno="224" refid="structsecp256k1__strauss__point__state_1a8b204951954c292ef1bd33b1d2cd82d1" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__strauss__point__state_1a8b204951954c292ef1bd33b1d2cd82d1" kindref="member">wnaf_na_1</ref>[129];</highlight></codeline>
<codeline lineno="225" refid="structsecp256k1__strauss__point__state_1a0c2a504aa0c0e609c1e64a90eb63e5d9" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__strauss__point__state_1a0c2a504aa0c0e609c1e64a90eb63e5d9" kindref="member">wnaf_na_lam</ref>[129];</highlight></codeline>
<codeline lineno="226" refid="structsecp256k1__strauss__point__state_1a0e09bfd878d2a5e3e1dddb9e418e6250" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__strauss__point__state_1a0e09bfd878d2a5e3e1dddb9e418e6250" kindref="member">bits_na_1</ref>;</highlight></codeline>
<codeline lineno="227" refid="structsecp256k1__strauss__point__state_1afa108324336cd9a9c3655b1865fc43b7" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__strauss__point__state_1afa108324336cd9a9c3655b1865fc43b7" kindref="member">bits_na_lam</ref>;</highlight></codeline>
<codeline lineno="228"><highlight class="normal">};</highlight></codeline>
<codeline lineno="229"><highlight class="normal"></highlight></codeline>
<codeline lineno="230" refid="structsecp256k1__strauss__state" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__strauss__state" kindref="compound">secp256k1_strauss_state</ref><sp/>{</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>aux<sp/>is<sp/>used<sp/>to<sp/>hold<sp/>z-ratios,<sp/>and<sp/>then<sp/>used<sp/>to<sp/>hold<sp/>pre_a[i].x<sp/>*<sp/>BETA<sp/>values.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232" refid="structsecp256k1__strauss__state_1a7a69cca018bcc4bd43c50929476abf0d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref>*<sp/><ref refid="structsecp256k1__strauss__state_1a7a69cca018bcc4bd43c50929476abf0d" kindref="member">aux</ref>;</highlight></codeline>
<codeline lineno="233" refid="structsecp256k1__strauss__state_1abee89a01aee111d4f47fe6b358bad345" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref>*<sp/><ref refid="structsecp256k1__strauss__state_1abee89a01aee111d4f47fe6b358bad345" kindref="member">pre_a</ref>;</highlight></codeline>
<codeline lineno="234" refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__strauss__point__state" kindref="compound">secp256k1_strauss_point_state</ref>*<sp/><ref refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" kindref="member">ps</ref>;</highlight></codeline>
<codeline lineno="235"><highlight class="normal">};</highlight></codeline>
<codeline lineno="236"><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_ecmult_strauss_wnaf(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__strauss__state" kindref="compound">secp256k1_strauss_state</ref><sp/>*state,<sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>*r,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>num,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>*a,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*na,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*ng)<sp/>{</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>tmpa;</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>Z;</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Split<sp/>G<sp/>factors.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>ng_1,<sp/>ng_128;</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>wnaf_ng_1[129];</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bits_ng_1<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>wnaf_ng_128[129];</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bits_ng_128<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bits<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>np;</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>no<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="250"><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1af5ad8646165b43a33c534918a205f966" kindref="member">secp256k1_fe_set_int</ref>(&amp;Z,<sp/>1);</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(np<sp/>=<sp/>0;<sp/>np<sp/>&lt;<sp/>num;<sp/>++np)<sp/>{</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>tmp;</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>na_1,<sp/>na_lam;</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(secp256k1_scalar_is_zero(&amp;na[np])<sp/>||<sp/>secp256k1_gej_is_infinity(&amp;a[np]))<sp/>{</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>split<sp/>na<sp/>into<sp/>na_1<sp/>and<sp/>na_lam<sp/>(where<sp/>na<sp/>=<sp/>na_1<sp/>+<sp/>na_lam*lambda,<sp/>and<sp/>na_1<sp/>and<sp/>na_lam<sp/>are<sp/>~128<sp/>bit)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_split_lambda(&amp;na_1,<sp/>&amp;na_lam,<sp/>&amp;na[np]);</highlight></codeline>
<codeline lineno="260"><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>build<sp/>wnaf<sp/>representation<sp/>for<sp/>na_1<sp/>and<sp/>na_lam.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>state-&gt;<ref refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" kindref="member">ps</ref>[no].<ref refid="structsecp256k1__strauss__point__state_1a0e09bfd878d2a5e3e1dddb9e418e6250" kindref="member">bits_na_1</ref><sp/><sp/><sp/>=<sp/>secp256k1_ecmult_wnaf(state-&gt;<ref refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" kindref="member">ps</ref>[no].<ref refid="structsecp256k1__strauss__point__state_1a8b204951954c292ef1bd33b1d2cd82d1" kindref="member">wnaf_na_1</ref>,<sp/><sp/><sp/>129,<sp/>&amp;na_1,<sp/><sp/><sp/><ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>);</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>state-&gt;<ref refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" kindref="member">ps</ref>[no].<ref refid="structsecp256k1__strauss__point__state_1afa108324336cd9a9c3655b1865fc43b7" kindref="member">bits_na_lam</ref><sp/>=<sp/>secp256k1_ecmult_wnaf(state-&gt;<ref refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" kindref="member">ps</ref>[no].<ref refid="structsecp256k1__strauss__point__state_1a0c2a504aa0c0e609c1e64a90eb63e5d9" kindref="member">wnaf_na_lam</ref>,<sp/>129,<sp/>&amp;na_lam,<sp/><ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>);</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(state-&gt;<ref refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" kindref="member">ps</ref>[no].<ref refid="structsecp256k1__strauss__point__state_1a0e09bfd878d2a5e3e1dddb9e418e6250" kindref="member">bits_na_1</ref><sp/>&lt;=<sp/>129);</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(state-&gt;<ref refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" kindref="member">ps</ref>[no].<ref refid="structsecp256k1__strauss__point__state_1afa108324336cd9a9c3655b1865fc43b7" kindref="member">bits_na_lam</ref><sp/>&lt;=<sp/>129);</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(state-&gt;<ref refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" kindref="member">ps</ref>[no].<ref refid="structsecp256k1__strauss__point__state_1a0e09bfd878d2a5e3e1dddb9e418e6250" kindref="member">bits_na_1</ref><sp/>&gt;<sp/>bits)<sp/>{</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bits<sp/>=<sp/>state-&gt;<ref refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" kindref="member">ps</ref>[no].<ref refid="structsecp256k1__strauss__point__state_1a0e09bfd878d2a5e3e1dddb9e418e6250" kindref="member">bits_na_1</ref>;</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(state-&gt;<ref refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" kindref="member">ps</ref>[no].<ref refid="structsecp256k1__strauss__point__state_1afa108324336cd9a9c3655b1865fc43b7" kindref="member">bits_na_lam</ref><sp/>&gt;<sp/>bits)<sp/>{</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bits<sp/>=<sp/>state-&gt;<ref refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" kindref="member">ps</ref>[no].<ref refid="structsecp256k1__strauss__point__state_1afa108324336cd9a9c3655b1865fc43b7" kindref="member">bits_na_lam</ref>;</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="272"><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Calculate<sp/>odd<sp/>multiples<sp/>of<sp/>a.</highlight></codeline>
<codeline lineno="274"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>All<sp/>multiples<sp/>are<sp/>brought<sp/>to<sp/>the<sp/>same<sp/>Z<sp/>&apos;denominator&apos;,<sp/>which<sp/>is<sp/>stored</highlight></codeline>
<codeline lineno="275"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>in<sp/>Z.<sp/>Due<sp/>to<sp/>secp256k1&apos;<sp/>isomorphism<sp/>we<sp/>can<sp/>do<sp/>all<sp/>operations<sp/>pretending</highlight></codeline>
<codeline lineno="276"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>that<sp/>the<sp/>Z<sp/>coordinate<sp/>was<sp/>1,<sp/>use<sp/>affine<sp/>addition<sp/>formulae,<sp/>and<sp/>correct</highlight></codeline>
<codeline lineno="277"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>the<sp/>Z<sp/>coordinate<sp/>of<sp/>the<sp/>result<sp/>once<sp/>at<sp/>the<sp/>end.</highlight></codeline>
<codeline lineno="278"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>The<sp/>exception<sp/>is<sp/>the<sp/>precomputed<sp/>G<sp/>table<sp/>points,<sp/>which<sp/>are<sp/>actually</highlight></codeline>
<codeline lineno="279"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>affine.<sp/>Compared<sp/>to<sp/>the<sp/>base<sp/>used<sp/>for<sp/>other<sp/>points,<sp/>they<sp/>have<sp/>a<sp/>Z<sp/>ratio</highlight></codeline>
<codeline lineno="280"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>of<sp/>1/Z,<sp/>so<sp/>we<sp/>can<sp/>use<sp/>secp256k1_gej_add_zinv_var,<sp/>which<sp/>uses<sp/>the<sp/>same</highlight></codeline>
<codeline lineno="281"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>isomorphism<sp/>to<sp/>efficiently<sp/>add<sp/>with<sp/>a<sp/>known<sp/>Z<sp/>inverse.</highlight></codeline>
<codeline lineno="282"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tmp<sp/>=<sp/>a[np];</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(no)<sp/>{</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_rescale(&amp;tmp,<sp/>&amp;Z);</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ecmult_odd_multiples_table(<ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(<ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>),<sp/>state-&gt;<ref refid="structsecp256k1__strauss__state_1abee89a01aee111d4f47fe6b358bad345" kindref="member">pre_a</ref><sp/>+<sp/>no<sp/>*<sp/><ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(<ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>),<sp/>state-&gt;<ref refid="structsecp256k1__strauss__state_1a7a69cca018bcc4bd43c50929476abf0d" kindref="member">aux</ref><sp/>+<sp/>no<sp/>*<sp/><ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(<ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>),<sp/>&amp;Z,<sp/>&amp;tmp);</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(no)<sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(state-&gt;<ref refid="structsecp256k1__strauss__state_1a7a69cca018bcc4bd43c50929476abf0d" kindref="member">aux</ref><sp/>+<sp/>no<sp/>*<sp/><ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(<ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>),<sp/>state-&gt;<ref refid="structsecp256k1__strauss__state_1a7a69cca018bcc4bd43c50929476abf0d" kindref="member">aux</ref><sp/>+<sp/>no<sp/>*<sp/><ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(<ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>),<sp/>&amp;(a[np].z));</highlight></codeline>
<codeline lineno="289"><highlight class="normal"></highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>++no;</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="292"><highlight class="normal"></highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Bring<sp/>them<sp/>to<sp/>the<sp/>same<sp/>Z<sp/>denominator.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(no)<sp/>{</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ge_table_set_globalz(<ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(<ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>)<sp/>*<sp/>no,<sp/>state-&gt;<ref refid="structsecp256k1__strauss__state_1abee89a01aee111d4f47fe6b358bad345" kindref="member">pre_a</ref>,<sp/>state-&gt;<ref refid="structsecp256k1__strauss__state_1a7a69cca018bcc4bd43c50929476abf0d" kindref="member">aux</ref>);</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="297"><highlight class="normal"></highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(np<sp/>=<sp/>0;<sp/>np<sp/>&lt;<sp/>no;<sp/>++np)<sp/>{</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(<ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>);<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;state-&gt;<ref refid="structsecp256k1__strauss__state_1a7a69cca018bcc4bd43c50929476abf0d" kindref="member">aux</ref>[np<sp/>*<sp/><ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(<ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>)<sp/>+<sp/>i],<sp/>&amp;state-&gt;<ref refid="structsecp256k1__strauss__state_1abee89a01aee111d4f47fe6b358bad345" kindref="member">pre_a</ref>[np<sp/>*<sp/><ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(<ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>)<sp/>+<sp/>i].x,<sp/>&amp;secp256k1_const_beta);</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="303"><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ng)<sp/>{</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>split<sp/>ng<sp/>into<sp/>ng_1<sp/>and<sp/>ng_128<sp/>(where<sp/>gn<sp/>=<sp/>gn_1<sp/>+<sp/>gn_128*2^128,<sp/>and<sp/>gn_1<sp/>and<sp/>gn_128<sp/>are<sp/>~128<sp/>bit)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_split_128(&amp;ng_1,<sp/>&amp;ng_128,<sp/>ng);</highlight></codeline>
<codeline lineno="307"><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Build<sp/>wnaf<sp/>representation<sp/>for<sp/>ng_1<sp/>and<sp/>ng_128<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bits_ng_1<sp/><sp/><sp/>=<sp/>secp256k1_ecmult_wnaf(wnaf_ng_1,<sp/><sp/><sp/>129,<sp/>&amp;ng_1,<sp/><sp/><sp/><ref refid="precomputed__ecmult_8c_1afe951ac62b5b06848cb4e6f4dbc69616" kindref="member">WINDOW_G</ref>);</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bits_ng_128<sp/>=<sp/>secp256k1_ecmult_wnaf(wnaf_ng_128,<sp/>129,<sp/>&amp;ng_128,<sp/><ref refid="precomputed__ecmult_8c_1afe951ac62b5b06848cb4e6f4dbc69616" kindref="member">WINDOW_G</ref>);</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(bits_ng_1<sp/>&gt;<sp/>bits)<sp/>{</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bits<sp/>=<sp/>bits_ng_1;</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(bits_ng_128<sp/>&gt;<sp/>bits)<sp/>{</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bits<sp/>=<sp/>bits_ng_128;</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="318"><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_gej_set_infinity(r);</highlight></codeline>
<codeline lineno="320"><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>bits<sp/>-<sp/>1;<sp/>i<sp/>&gt;=<sp/>0;<sp/>i--)<sp/>{</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n;</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_double_var(r,<sp/>r,<sp/>NULL);</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(np<sp/>=<sp/>0;<sp/>np<sp/>&lt;<sp/>no;<sp/>++np)<sp/>{</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(i<sp/>&lt;<sp/>state-&gt;ps[np].<ref refid="structsecp256k1__strauss__point__state_1a0e09bfd878d2a5e3e1dddb9e418e6250" kindref="member">bits_na_1</ref><sp/>&amp;&amp;<sp/>(n<sp/>=<sp/>state-&gt;<ref refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" kindref="member">ps</ref>[np].<ref refid="structsecp256k1__strauss__point__state_1a8b204951954c292ef1bd33b1d2cd82d1" kindref="member">wnaf_na_1</ref>[i]))<sp/>{</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ecmult_table_get_ge(&amp;tmpa,<sp/>state-&gt;<ref refid="structsecp256k1__strauss__state_1abee89a01aee111d4f47fe6b358bad345" kindref="member">pre_a</ref><sp/>+<sp/>np<sp/>*<sp/><ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(<ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>),<sp/>n,<sp/><ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>);</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_add_ge_var(r,<sp/>r,<sp/>&amp;tmpa,<sp/>NULL);</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(i<sp/>&lt;<sp/>state-&gt;ps[np].<ref refid="structsecp256k1__strauss__point__state_1afa108324336cd9a9c3655b1865fc43b7" kindref="member">bits_na_lam</ref><sp/>&amp;&amp;<sp/>(n<sp/>=<sp/>state-&gt;<ref refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" kindref="member">ps</ref>[np].<ref refid="structsecp256k1__strauss__point__state_1a0c2a504aa0c0e609c1e64a90eb63e5d9" kindref="member">wnaf_na_lam</ref>[i]))<sp/>{</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ecmult_table_get_ge_lambda(&amp;tmpa,<sp/>state-&gt;<ref refid="structsecp256k1__strauss__state_1abee89a01aee111d4f47fe6b358bad345" kindref="member">pre_a</ref><sp/>+<sp/>np<sp/>*<sp/><ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(<ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>),<sp/>state-&gt;<ref refid="structsecp256k1__strauss__state_1a7a69cca018bcc4bd43c50929476abf0d" kindref="member">aux</ref><sp/>+<sp/>np<sp/>*<sp/><ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(<ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>),<sp/>n,<sp/><ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>);</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_add_ge_var(r,<sp/>r,<sp/>&amp;tmpa,<sp/>NULL);</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(i<sp/>&lt;<sp/>bits_ng_1<sp/>&amp;&amp;<sp/>(n<sp/>=<sp/>wnaf_ng_1[i]))<sp/>{</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ecmult_table_get_ge_storage(&amp;tmpa,<sp/><ref refid="precomputed__ecmult_8c_1ab052c377e10c0ce101f47af9f6dcb4a7" kindref="member">secp256k1_pre_g</ref>,<sp/>n,<sp/><ref refid="precomputed__ecmult_8c_1afe951ac62b5b06848cb4e6f4dbc69616" kindref="member">WINDOW_G</ref>);</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_add_zinv_var(r,<sp/>r,<sp/>&amp;tmpa,<sp/>&amp;Z);</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(i<sp/>&lt;<sp/>bits_ng_128<sp/>&amp;&amp;<sp/>(n<sp/>=<sp/>wnaf_ng_128[i]))<sp/>{</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ecmult_table_get_ge_storage(&amp;tmpa,<sp/><ref refid="precomputed__ecmult_8c_1ab047348edae9da6233f4d4a21eef0d0c" kindref="member">secp256k1_pre_g_128</ref>,<sp/>n,<sp/><ref refid="precomputed__ecmult_8c_1afe951ac62b5b06848cb4e6f4dbc69616" kindref="member">WINDOW_G</ref>);</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_add_zinv_var(r,<sp/>r,<sp/>&amp;tmpa,<sp/>&amp;Z);</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="343"><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!r-&gt;<ref refid="structsecp256k1__gej_1a652f88fb6bac77f1882023c1410e84d3" kindref="member">infinity</ref>)<sp/>{</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1a60271f91746f3029ea2cac2ec2e37b36" kindref="member">secp256k1_fe_mul</ref>(&amp;r-&gt;<ref refid="structsecp256k1__gej_1a761e4ae44d26ee28461beeaf09a26218" kindref="member">z</ref>,<sp/>&amp;r-&gt;<ref refid="structsecp256k1__gej_1a761e4ae44d26ee28461beeaf09a26218" kindref="member">z</ref>,<sp/>&amp;Z);</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="347"><highlight class="normal">}</highlight></codeline>
<codeline lineno="348"><highlight class="normal"></highlight></codeline>
<codeline lineno="349"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_ecmult(<ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>*r,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>*a,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*na,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*ng)<sp/>{</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref><sp/>aux[<ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(<ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>)];</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>pre_a[<ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(<ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>)];</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__strauss__point__state" kindref="compound">secp256k1_strauss_point_state</ref><sp/>ps[1];</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__strauss__state" kindref="compound">secp256k1_strauss_state</ref><sp/>state;</highlight></codeline>
<codeline lineno="354"><highlight class="normal"></highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/>state.<ref refid="structsecp256k1__strauss__state_1a7a69cca018bcc4bd43c50929476abf0d" kindref="member">aux</ref><sp/>=<sp/><ref refid="structsecp256k1__strauss__state_1a7a69cca018bcc4bd43c50929476abf0d" kindref="member">aux</ref>;</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/>state.<ref refid="structsecp256k1__strauss__state_1abee89a01aee111d4f47fe6b358bad345" kindref="member">pre_a</ref><sp/>=<sp/><ref refid="structsecp256k1__strauss__state_1abee89a01aee111d4f47fe6b358bad345" kindref="member">pre_a</ref>;</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/>state.<ref refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" kindref="member">ps</ref><sp/>=<sp/><ref refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" kindref="member">ps</ref>;</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ecmult_strauss_wnaf(&amp;state,<sp/>r,<sp/>1,<sp/>a,<sp/>na,<sp/>ng);</highlight></codeline>
<codeline lineno="359"><highlight class="normal">}</highlight></codeline>
<codeline lineno="360"><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>secp256k1_strauss_scratch_size(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_points)<sp/>{</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>point_size<sp/>=<sp/>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref>)<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref>))<sp/>*<sp/><ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(<ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>)<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__strauss__point__state" kindref="compound">secp256k1_strauss_point_state</ref>)<sp/>+<sp/>sizeof(<ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref>)<sp/>+<sp/>sizeof(<ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref>);</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>n_points*point_size;</highlight></codeline>
<codeline lineno="364"><highlight class="normal">}</highlight></codeline>
<codeline lineno="365"><highlight class="normal"></highlight></codeline>
<codeline lineno="366"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_ecmult_strauss_batch(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__callback" kindref="compound">secp256k1_callback</ref>*<sp/>error_callback,<sp/><ref refid="scratch_8h_1a84bdf30f4ca993587d89471cf1ae8be7" kindref="member">secp256k1_scratch</ref><sp/>*scratch,<sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>*r,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*inp_g_sc,<sp/><ref refid="ecmult_8h_1a0f127c89ba0f17e7992666f3d789e58e" kindref="member">secp256k1_ecmult_multi_callback</ref><sp/>cb,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*cbdata,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_points,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>cb_offset)<sp/>{</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref>*<sp/>points;</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref>*<sp/>scalars;</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__strauss__state" kindref="compound">secp256k1_strauss_state</ref><sp/>state;</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>scratch_checkpoint<sp/>=<sp/>secp256k1_scratch_checkpoint(error_callback,<sp/>scratch);</highlight></codeline>
<codeline lineno="372"><highlight class="normal"></highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_gej_set_infinity(r);</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(inp_g_sc<sp/>==<sp/>NULL<sp/>&amp;&amp;<sp/>n_points<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="377"><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>We<sp/>allocate<sp/>STRAUSS_SCRATCH_OBJECTS<sp/>objects<sp/>on<sp/>the<sp/>scratch<sp/>space.<sp/>If<sp/>these</highlight></codeline>
<codeline lineno="379"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>allocations<sp/>change,<sp/>make<sp/>sure<sp/>to<sp/>update<sp/>the<sp/>STRAUSS_SCRATCH_OBJECTS</highlight></codeline>
<codeline lineno="380"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>constant<sp/>and<sp/>strauss_scratch_size<sp/>accordingly.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/>points<sp/>=<sp/>(<ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref>*)secp256k1_scratch_alloc(error_callback,<sp/>scratch,<sp/>n_points<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref>));</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/>scalars<sp/>=<sp/>(<ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref>*)secp256k1_scratch_alloc(error_callback,<sp/>scratch,<sp/>n_points<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref>));</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/>state.<ref refid="structsecp256k1__strauss__state_1a7a69cca018bcc4bd43c50929476abf0d" kindref="member">aux</ref><sp/>=<sp/>(<ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref>*)secp256k1_scratch_alloc(error_callback,<sp/>scratch,<sp/>n_points<sp/>*<sp/><ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(<ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>)<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structsecp256k1__fe" kindref="compound">secp256k1_fe</ref>));</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/>state.<ref refid="structsecp256k1__strauss__state_1abee89a01aee111d4f47fe6b358bad345" kindref="member">pre_a</ref><sp/>=<sp/>(<ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref>*)secp256k1_scratch_alloc(error_callback,<sp/>scratch,<sp/>n_points<sp/>*<sp/><ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(<ref refid="ecmult__impl_8h_1a6216c81c6adbb8796c55fe0c8d3b6718" kindref="member">WINDOW_A</ref>)<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref>));</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/>state.<ref refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" kindref="member">ps</ref><sp/>=<sp/>(</highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__strauss__point__state" kindref="compound">secp256k1_strauss_point_state</ref>*)secp256k1_scratch_alloc(error_callback,<sp/>scratch,<sp/>n_points<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__strauss__point__state" kindref="compound">secp256k1_strauss_point_state</ref>));</highlight></codeline>
<codeline lineno="386"><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(points<sp/>==<sp/>NULL<sp/>||<sp/>scalars<sp/>==<sp/>NULL<sp/>||<sp/>state.<ref refid="structsecp256k1__strauss__state_1a7a69cca018bcc4bd43c50929476abf0d" kindref="member">aux</ref><sp/>==<sp/>NULL<sp/>||<sp/>state.<ref refid="structsecp256k1__strauss__state_1abee89a01aee111d4f47fe6b358bad345" kindref="member">pre_a</ref><sp/>==<sp/>NULL<sp/>||<sp/>state.<ref refid="structsecp256k1__strauss__state_1ad4d9eac8005497cfc717d2aebe9a50d2" kindref="member">ps</ref><sp/>==<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scratch_apply_checkpoint(error_callback,<sp/>scratch,<sp/>scratch_checkpoint);</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="391"><highlight class="normal"></highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>n_points;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>point;</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!cb(&amp;scalars[i],<sp/>&amp;point,<sp/>i+cb_offset,<sp/>cbdata))<sp/>{</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scratch_apply_checkpoint(error_callback,<sp/>scratch,<sp/>scratch_checkpoint);</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_set_ge(&amp;points[i],<sp/>&amp;point);</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ecmult_strauss_wnaf(&amp;state,<sp/>r,<sp/>n_points,<sp/>points,<sp/>scalars,<sp/>inp_g_sc);</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scratch_apply_checkpoint(error_callback,<sp/>scratch,<sp/>scratch_checkpoint);</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="403"><highlight class="normal">}</highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Wrapper<sp/>for<sp/>secp256k1_ecmult_multi_func<sp/>interface<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_ecmult_strauss_batch_single(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__callback" kindref="compound">secp256k1_callback</ref>*<sp/>error_callback,<sp/><ref refid="scratch_8h_1a84bdf30f4ca993587d89471cf1ae8be7" kindref="member">secp256k1_scratch</ref><sp/>*scratch,<sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>*r,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*inp_g_sc,<sp/><ref refid="ecmult_8h_1a0f127c89ba0f17e7992666f3d789e58e" kindref="member">secp256k1_ecmult_multi_callback</ref><sp/>cb,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*cbdata,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n)<sp/>{</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>secp256k1_ecmult_strauss_batch(error_callback,<sp/>scratch,<sp/>r,<sp/>inp_g_sc,<sp/>cb,<sp/>cbdata,<sp/>n,<sp/>0);</highlight></codeline>
<codeline lineno="408"><highlight class="normal">}</highlight></codeline>
<codeline lineno="409"><highlight class="normal"></highlight></codeline>
<codeline lineno="410"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>secp256k1_strauss_max_points(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__callback" kindref="compound">secp256k1_callback</ref>*<sp/>error_callback,<sp/><ref refid="scratch_8h_1a84bdf30f4ca993587d89471cf1ae8be7" kindref="member">secp256k1_scratch</ref><sp/>*scratch)<sp/>{</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>secp256k1_scratch_max_allocation(error_callback,<sp/>scratch,<sp/><ref refid="ecmult__impl_8h_1a0447eb99687dea95c58a48eb6b6e17e2" kindref="member">STRAUSS_SCRATCH_OBJECTS</ref>)<sp/>/<sp/>secp256k1_strauss_scratch_size(1);</highlight></codeline>
<codeline lineno="412"><highlight class="normal">}</highlight></codeline>
<codeline lineno="413"><highlight class="normal"></highlight></codeline>
<codeline lineno="421"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_wnaf_fixed(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*wnaf,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*s,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>w)<sp/>{</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>skew<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pos;</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>max_pos;</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>last_w;</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*work<sp/>=<sp/><ref refid="namespacetest__vectors__musig2__generate_1a5fcf9c70fa717a8efd481752dcb8ffa4" kindref="member">s</ref>;</highlight></codeline>
<codeline lineno="427"><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(secp256k1_scalar_is_zero(s))<sp/>{</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(pos<sp/>=<sp/>0;<sp/>pos<sp/>&lt;<sp/><ref refid="ecmult__impl_8h_1a23d9fb349265ae338b9977f7f7aab065" kindref="member">WNAF_SIZE</ref>(w);<sp/>pos++)<sp/>{</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wnaf[pos]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="434"><highlight class="normal"></highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(secp256k1_scalar_is_even(s))<sp/>{</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>skew<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="438"><highlight class="normal"></highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/>wnaf[0]<sp/>=<sp/>secp256k1_scalar_get_bits_var(work,<sp/>0,<sp/>w)<sp/>+<sp/>skew;</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Compute<sp/>last<sp/>window<sp/>size.<sp/>Relevant<sp/>when<sp/>window<sp/>size<sp/>doesn&apos;t<sp/>divide<sp/>the</highlight></codeline>
<codeline lineno="441"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>number<sp/>of<sp/>bits<sp/>in<sp/>the<sp/>scalar<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/>last_w<sp/>=<sp/><ref refid="ecmult__impl_8h_1a7ca5efdae3396a6261bcc836e4a32739" kindref="member">WNAF_BITS</ref><sp/>-<sp/>(<ref refid="ecmult__impl_8h_1a23d9fb349265ae338b9977f7f7aab065" kindref="member">WNAF_SIZE</ref>(w)<sp/>-<sp/>1)<sp/>*<sp/>w;</highlight></codeline>
<codeline lineno="443"><highlight class="normal"></highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Store<sp/>the<sp/>position<sp/>of<sp/>the<sp/>first<sp/>nonzero<sp/>word<sp/>in<sp/>max_pos<sp/>to<sp/>allow</highlight></codeline>
<codeline lineno="445"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>skipping<sp/>leading<sp/>zeros<sp/>when<sp/>calculating<sp/>the<sp/>wnaf.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(pos<sp/>=<sp/><ref refid="ecmult__impl_8h_1a23d9fb349265ae338b9977f7f7aab065" kindref="member">WNAF_SIZE</ref>(w)<sp/>-<sp/>1;<sp/>pos<sp/>&gt;<sp/>0;<sp/>pos--)<sp/>{</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>val<sp/>=<sp/>secp256k1_scalar_get_bits_var(work,<sp/>pos<sp/>*<sp/>w,<sp/>pos<sp/>==<sp/><ref refid="ecmult__impl_8h_1a23d9fb349265ae338b9977f7f7aab065" kindref="member">WNAF_SIZE</ref>(w)-1<sp/>?<sp/>last_w<sp/>:<sp/>w);</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(val<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wnaf[pos]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/>max_pos<sp/>=<sp/>pos;</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/>pos<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="455"><highlight class="normal"></highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(pos<sp/>&lt;=<sp/>max_pos)<sp/>{</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>val<sp/>=<sp/>secp256k1_scalar_get_bits_var(work,<sp/>pos<sp/>*<sp/>w,<sp/>pos<sp/>==<sp/><ref refid="ecmult__impl_8h_1a23d9fb349265ae338b9977f7f7aab065" kindref="member">WNAF_SIZE</ref>(w)-1<sp/>?<sp/>last_w<sp/>:<sp/>w);</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((val<sp/>&amp;<sp/>1)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wnaf[pos<sp/>-<sp/>1]<sp/>-=<sp/>(1<sp/>&lt;&lt;<sp/>w);</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wnaf[pos]<sp/>=<sp/>(val<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wnaf[pos]<sp/>=<sp/>val;</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Set<sp/>a<sp/>coefficient<sp/>to<sp/>zero<sp/>if<sp/>it<sp/>is<sp/>1<sp/>or<sp/>-1<sp/>and<sp/>the<sp/>proceeding<sp/>digit</highlight></codeline>
<codeline lineno="465"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>is<sp/>strictly<sp/>negative<sp/>or<sp/>strictly<sp/>positive<sp/>respectively.<sp/>Only<sp/>change</highlight></codeline>
<codeline lineno="466"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>coefficients<sp/>at<sp/>previous<sp/>positions<sp/>because<sp/>above<sp/>code<sp/>assumes<sp/>that</highlight></codeline>
<codeline lineno="467"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>wnaf[pos<sp/>-<sp/>1]<sp/>is<sp/>odd.</highlight></codeline>
<codeline lineno="468"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pos<sp/>&gt;=<sp/>2<sp/>&amp;&amp;<sp/>((wnaf[pos<sp/>-<sp/>1]<sp/>==<sp/>1<sp/>&amp;&amp;<sp/>wnaf[pos<sp/>-<sp/>2]<sp/>&lt;<sp/>0)<sp/>||<sp/>(wnaf[pos<sp/>-<sp/>1]<sp/>==<sp/>-1<sp/>&amp;&amp;<sp/>wnaf[pos<sp/>-<sp/>2]<sp/>&gt;<sp/>0)))<sp/>{</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(wnaf[pos<sp/>-<sp/>1]<sp/>==<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wnaf[pos<sp/>-<sp/>2]<sp/>+=<sp/>1<sp/>&lt;&lt;<sp/>w;</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wnaf[pos<sp/>-<sp/>2]<sp/>-=<sp/>1<sp/>&lt;&lt;<sp/>w;</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wnaf[pos<sp/>-<sp/>1]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>++pos;</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="479"><highlight class="normal"></highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>skew;</highlight></codeline>
<codeline lineno="481"><highlight class="normal">}</highlight></codeline>
<codeline lineno="482"><highlight class="normal"></highlight></codeline>
<codeline lineno="483" refid="structsecp256k1__pippenger__point__state" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__pippenger__point__state" kindref="compound">secp256k1_pippenger_point_state</ref><sp/>{</highlight></codeline>
<codeline lineno="484" refid="structsecp256k1__pippenger__point__state_1a1de86ed0cdfae930a4ed5208676b3ac1" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__pippenger__point__state_1a1de86ed0cdfae930a4ed5208676b3ac1" kindref="member">skew_na</ref>;</highlight></codeline>
<codeline lineno="485" refid="structsecp256k1__pippenger__point__state_1ad700dc3b95746831ab8708f894f174f9" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__pippenger__point__state_1ad700dc3b95746831ab8708f894f174f9" kindref="member">input_pos</ref>;</highlight></codeline>
<codeline lineno="486"><highlight class="normal">};</highlight></codeline>
<codeline lineno="487"><highlight class="normal"></highlight></codeline>
<codeline lineno="488" refid="structsecp256k1__pippenger__state" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__pippenger__state" kindref="compound">secp256k1_pippenger_state</ref><sp/>{</highlight></codeline>
<codeline lineno="489" refid="structsecp256k1__pippenger__state_1a0fd8693a4455cd726932b025f774fbdb" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*<ref refid="structsecp256k1__pippenger__state_1a0fd8693a4455cd726932b025f774fbdb" kindref="member">wnaf_na</ref>;</highlight></codeline>
<codeline lineno="490" refid="structsecp256k1__pippenger__state_1acf3337b1747efba8ab565a35b7749c7d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__pippenger__point__state" kindref="compound">secp256k1_pippenger_point_state</ref>*<sp/><ref refid="structsecp256k1__pippenger__state_1acf3337b1747efba8ab565a35b7749c7d" kindref="member">ps</ref>;</highlight></codeline>
<codeline lineno="491"><highlight class="normal">};</highlight></codeline>
<codeline lineno="492"><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="494"><highlight class="comment"><sp/>*<sp/>pippenger_wnaf<sp/>computes<sp/>the<sp/>result<sp/>of<sp/>a<sp/>multi-point<sp/>multiplication<sp/>as</highlight></codeline>
<codeline lineno="495"><highlight class="comment"><sp/>*<sp/>follows:<sp/>The<sp/>scalars<sp/>are<sp/>brought<sp/>into<sp/>wnaf<sp/>with<sp/>n_wnaf<sp/>elements<sp/>each.<sp/>Then</highlight></codeline>
<codeline lineno="496"><highlight class="comment"><sp/>*<sp/>for<sp/>every<sp/>i<sp/>&lt;<sp/>n_wnaf,<sp/>first<sp/>each<sp/>point<sp/>is<sp/>added<sp/>to<sp/>a<sp/>&quot;bucket&quot;<sp/>corresponding</highlight></codeline>
<codeline lineno="497"><highlight class="comment"><sp/>*<sp/>to<sp/>the<sp/>point&apos;s<sp/>wnaf[i].<sp/>Second,<sp/>the<sp/>buckets<sp/>are<sp/>added<sp/>together<sp/>such<sp/>that</highlight></codeline>
<codeline lineno="498"><highlight class="comment"><sp/>*<sp/>r<sp/>+=<sp/>1*bucket[0]<sp/>+<sp/>3*bucket[1]<sp/>+<sp/>5*bucket[2]<sp/>+<sp/>...</highlight></codeline>
<codeline lineno="499"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="500"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_ecmult_pippenger_wnaf(<ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>*buckets,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bucket_window,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__pippenger__state" kindref="compound">secp256k1_pippenger_state</ref><sp/>*state,<sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>*r,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*sc,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*pt,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>num)<sp/>{</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_wnaf<sp/>=<sp/><ref refid="ecmult__impl_8h_1a23d9fb349265ae338b9977f7f7aab065" kindref="member">WNAF_SIZE</ref>(bucket_window+1);</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>np;</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>no<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j;</highlight></codeline>
<codeline lineno="506"><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(np<sp/>=<sp/>0;<sp/>np<sp/>&lt;<sp/>num;<sp/>++np)<sp/>{</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(secp256k1_scalar_is_zero(&amp;sc[np])<sp/>||<sp/>secp256k1_ge_is_infinity(&amp;pt[np]))<sp/>{</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>state-&gt;<ref refid="structsecp256k1__pippenger__state_1acf3337b1747efba8ab565a35b7749c7d" kindref="member">ps</ref>[no].<ref refid="structsecp256k1__pippenger__point__state_1ad700dc3b95746831ab8708f894f174f9" kindref="member">input_pos</ref><sp/>=<sp/>np;</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>state-&gt;<ref refid="structsecp256k1__pippenger__state_1acf3337b1747efba8ab565a35b7749c7d" kindref="member">ps</ref>[no].<ref refid="structsecp256k1__pippenger__point__state_1a1de86ed0cdfae930a4ed5208676b3ac1" kindref="member">skew_na</ref><sp/>=<sp/>secp256k1_wnaf_fixed(&amp;state-&gt;<ref refid="structsecp256k1__pippenger__state_1a0fd8693a4455cd726932b025f774fbdb" kindref="member">wnaf_na</ref>[no*n_wnaf],<sp/>&amp;sc[np],<sp/>bucket_window+1);</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>no++;</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_gej_set_infinity(r);</highlight></codeline>
<codeline lineno="516"><highlight class="normal"></highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(no<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="520"><highlight class="normal"></highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>n_wnaf<sp/>-<sp/>1;<sp/>i<sp/>&gt;=<sp/>0;<sp/>i--)<sp/>{</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>running_sum;</highlight></codeline>
<codeline lineno="523"><highlight class="normal"></highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/><ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(bucket_window+2);<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_set_infinity(&amp;buckets[j]);</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="527"><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(np<sp/>=<sp/>0;<sp/>np<sp/>&lt;<sp/>no;<sp/>++np)<sp/>{</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>state-&gt;<ref refid="structsecp256k1__pippenger__state_1a0fd8693a4455cd726932b025f774fbdb" kindref="member">wnaf_na</ref>[np*n_wnaf<sp/>+<sp/>i];</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__pippenger__point__state" kindref="compound">secp256k1_pippenger_point_state</ref><sp/>point_state<sp/>=<sp/>state-&gt;<ref refid="structsecp256k1__pippenger__state_1acf3337b1747efba8ab565a35b7749c7d" kindref="member">ps</ref>[np];</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>tmp;</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>idx;</highlight></codeline>
<codeline lineno="533"><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(i<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>correct<sp/>for<sp/>wnaf<sp/>skew<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>skew<sp/>=<sp/>point_state.<ref refid="structsecp256k1__pippenger__point__state_1a1de86ed0cdfae930a4ed5208676b3ac1" kindref="member">skew_na</ref>;</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(skew)<sp/>{</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ge_neg(&amp;tmp,<sp/>&amp;pt[point_state.<ref refid="structsecp256k1__pippenger__point__state_1ad700dc3b95746831ab8708f894f174f9" kindref="member">input_pos</ref>]);</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_add_ge_var(&amp;buckets[0],<sp/>&amp;buckets[0],<sp/>&amp;tmp,<sp/>NULL);</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idx<sp/>=<sp/>(n<sp/>-<sp/>1)/2;</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_add_ge_var(&amp;buckets[idx],<sp/>&amp;buckets[idx],<sp/>&amp;pt[point_state.<ref refid="structsecp256k1__pippenger__point__state_1ad700dc3b95746831ab8708f894f174f9" kindref="member">input_pos</ref>],<sp/>NULL);</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idx<sp/>=<sp/>-(n<sp/>+<sp/>1)/2;</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ge_neg(&amp;tmp,<sp/>&amp;pt[point_state.<ref refid="structsecp256k1__pippenger__point__state_1ad700dc3b95746831ab8708f894f174f9" kindref="member">input_pos</ref>]);</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_add_ge_var(&amp;buckets[idx],<sp/>&amp;buckets[idx],<sp/>&amp;tmp,<sp/>NULL);</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="551"><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>bucket_window;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_double_var(r,<sp/>r,<sp/>NULL);</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="555"><highlight class="normal"></highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_set_infinity(&amp;running_sum);</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Accumulate<sp/>the<sp/>sum:<sp/>bucket[0]<sp/>+<sp/>3*bucket[1]<sp/>+<sp/>5*bucket[2]<sp/>+<sp/>7*bucket[3]<sp/>+<sp/>...</highlight></codeline>
<codeline lineno="558"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>bucket[0]<sp/>+<sp/><sp/><sp/>bucket[1]<sp/>+<sp/><sp/><sp/>bucket[2]<sp/>+<sp/><sp/><sp/>bucket[3]<sp/>+<sp/>...</highlight></codeline>
<codeline lineno="559"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>2<sp/>*<sp/><sp/>(bucket[1]<sp/>+<sp/>2*bucket[2]<sp/>+<sp/>3*bucket[3]<sp/>+<sp/>...)</highlight></codeline>
<codeline lineno="560"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>using<sp/>an<sp/>intermediate<sp/>running<sp/>sum:</highlight></codeline>
<codeline lineno="561"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>running_sum<sp/>=<sp/>bucket[0]<sp/>+<sp/><sp/><sp/>bucket[1]<sp/>+<sp/><sp/><sp/>bucket[2]<sp/>+<sp/>...</highlight></codeline>
<codeline lineno="562"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="563"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>The<sp/>doubling<sp/>is<sp/>done<sp/>implicitly<sp/>by<sp/>deferring<sp/>the<sp/>final<sp/>window<sp/>doubling<sp/>(of<sp/>&apos;r&apos;).</highlight></codeline>
<codeline lineno="564"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(j<sp/>=<sp/><ref refid="ecmult_8h_1a97c6c6e5aa98f202eec77c4c931e02f1" kindref="member">ECMULT_TABLE_SIZE</ref>(bucket_window+2)<sp/>-<sp/>1;<sp/>j<sp/>&gt;<sp/>0;<sp/>j--)<sp/>{</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_add_var(&amp;running_sum,<sp/>&amp;running_sum,<sp/>&amp;buckets[j],<sp/>NULL);</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_add_var(r,<sp/>r,<sp/>&amp;running_sum,<sp/>NULL);</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="569"><highlight class="normal"></highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_add_var(&amp;running_sum,<sp/>&amp;running_sum,<sp/>&amp;buckets[0],<sp/>NULL);</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_double_var(r,<sp/>r,<sp/>NULL);</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_add_var(r,<sp/>r,<sp/>&amp;running_sum,<sp/>NULL);</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="575"><highlight class="normal">}</highlight></codeline>
<codeline lineno="576"><highlight class="normal"></highlight></codeline>
<codeline lineno="581"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_pippenger_bucket_window(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n)<sp/>{</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;=<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;=<sp/>4)<sp/>{</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>2;</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;=<sp/>20)<sp/>{</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>3;</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;=<sp/>57)<sp/>{</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>4;</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;=<sp/>136)<sp/>{</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>5;</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;=<sp/>235)<sp/>{</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>6;</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;=<sp/>1260)<sp/>{</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>7;</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;=<sp/>4420)<sp/>{</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>9;</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;=<sp/>7880)<sp/>{</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>10;</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;=<sp/>16050)<sp/>{</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>11;</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ecmult__impl_8h_1a9114820daf51f54afc1858640539ac6d" kindref="member">PIPPENGER_MAX_BUCKET_WINDOW</ref>;</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="605"><highlight class="normal">}</highlight></codeline>
<codeline lineno="606"><highlight class="normal"></highlight></codeline>
<codeline lineno="610"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>secp256k1_pippenger_bucket_window_inv(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bucket_window)<sp/>{</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">(bucket_window)<sp/>{</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>1:<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>2:<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>4;</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>3:<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>20;</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>4:<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>57;</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>5:<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>136;</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>6:<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>235;</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>7:<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1260;</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>8:<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1260;</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>9:<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>4420;</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>10:<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>7880;</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>11:<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>16050;</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ecmult__impl_8h_1a9114820daf51f54afc1858640539ac6d" kindref="member">PIPPENGER_MAX_BUCKET_WINDOW</ref>:<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>SIZE_MAX;</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="626"><highlight class="normal">}</highlight></codeline>
<codeline lineno="627"><highlight class="normal"></highlight></codeline>
<codeline lineno="628"><highlight class="normal"></highlight></codeline>
<codeline lineno="629"><highlight class="normal"><ref refid="secp256k1_2src_2util_8h_1a7ddc487fd46aee88f21cabedb7268b1e" kindref="member">SECP256K1_INLINE</ref><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_ecmult_endo_split(<ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*s1,<sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*s2,<sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*p1,<sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*p2)<sp/>{</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>tmp<sp/>=<sp/>*s1;</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_split_lambda(s1,<sp/>s2,<sp/>&amp;tmp);</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ge_mul_lambda(p2,<sp/>p1);</highlight></codeline>
<codeline lineno="633"><highlight class="normal"></highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(secp256k1_scalar_is_high(s1))<sp/>{</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_negate(s1,<sp/>s1);</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ge_neg(p1,<sp/>p1);</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(secp256k1_scalar_is_high(s2))<sp/>{</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_negate(s2,<sp/>s2);</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ge_neg(p2,<sp/>p2);</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="642"><highlight class="normal">}</highlight></codeline>
<codeline lineno="643"><highlight class="normal"></highlight></codeline>
<codeline lineno="648"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>secp256k1_pippenger_scratch_size(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_points,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bucket_window)<sp/>{</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>entries<sp/>=<sp/>2*n_points<sp/>+<sp/>2;</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>entry_size<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref>)<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref>)<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__pippenger__point__state" kindref="compound">secp256k1_pippenger_point_state</ref>)<sp/>+<sp/>(<ref refid="ecmult__impl_8h_1a23d9fb349265ae338b9977f7f7aab065" kindref="member">WNAF_SIZE</ref>(bucket_window+1)+1)*</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(int);</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref>)<sp/>&lt;&lt;<sp/>bucket_window)<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__pippenger__state" kindref="compound">secp256k1_pippenger_state</ref>)<sp/>+<sp/>entries<sp/>*<sp/>entry_size;</highlight></codeline>
<codeline lineno="652"><highlight class="normal">}</highlight></codeline>
<codeline lineno="653"><highlight class="normal"></highlight></codeline>
<codeline lineno="654"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_ecmult_pippenger_batch(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__callback" kindref="compound">secp256k1_callback</ref>*<sp/>error_callback,<sp/><ref refid="scratch_8h_1a84bdf30f4ca993587d89471cf1ae8be7" kindref="member">secp256k1_scratch</ref><sp/>*scratch,<sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>*r,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*inp_g_sc,<sp/><ref refid="ecmult_8h_1a0f127c89ba0f17e7992666f3d789e58e" kindref="member">secp256k1_ecmult_multi_callback</ref><sp/>cb,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*cbdata,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_points,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>cb_offset)<sp/>{</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>scratch_checkpoint<sp/>=<sp/>secp256k1_scratch_checkpoint(error_callback,<sp/>scratch);</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Use<sp/>2(n+1)<sp/>with<sp/>the<sp/>endomorphism,<sp/>when<sp/>calculating<sp/>batch</highlight></codeline>
<codeline lineno="657"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>sizes.<sp/>The<sp/>reason<sp/>for<sp/>+1<sp/>is<sp/>that<sp/>we<sp/>add<sp/>the<sp/>G<sp/>scalar<sp/>to<sp/>the<sp/>list<sp/>of</highlight></codeline>
<codeline lineno="658"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>other<sp/>scalars.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>entries<sp/>=<sp/>2*n_points<sp/>+<sp/>2;</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*points;</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*scalars;</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>*buckets;</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__pippenger__state" kindref="compound">secp256k1_pippenger_state</ref><sp/>*state_space;</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>idx<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>point_idx<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bucket_window;</highlight></codeline>
<codeline lineno="667"><highlight class="normal"></highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_gej_set_infinity(r);</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(inp_g_sc<sp/>==<sp/>NULL<sp/>&amp;&amp;<sp/>n_points<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/>bucket_window<sp/>=<sp/>secp256k1_pippenger_bucket_window(n_points);</highlight></codeline>
<codeline lineno="673"><highlight class="normal"></highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>We<sp/>allocate<sp/>PIPPENGER_SCRATCH_OBJECTS<sp/>objects<sp/>on<sp/>the<sp/>scratch<sp/>space.<sp/>If</highlight></codeline>
<codeline lineno="675"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>these<sp/>allocations<sp/>change,<sp/>make<sp/>sure<sp/>to<sp/>update<sp/>the</highlight></codeline>
<codeline lineno="676"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>PIPPENGER_SCRATCH_OBJECTS<sp/>constant<sp/>and<sp/>pippenger_scratch_size</highlight></codeline>
<codeline lineno="677"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>accordingly.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/>points<sp/>=<sp/>(<ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*)<sp/>secp256k1_scratch_alloc(error_callback,<sp/>scratch,<sp/>entries<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*points));</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/>scalars<sp/>=<sp/>(<ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*)<sp/>secp256k1_scratch_alloc(error_callback,<sp/>scratch,<sp/>entries<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*scalars));</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/>state_space<sp/>=<sp/>(</highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__pippenger__state" kindref="compound">secp256k1_pippenger_state</ref><sp/>*)<sp/>secp256k1_scratch_alloc(error_callback,<sp/>scratch,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*state_space));</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(points<sp/>==<sp/>NULL<sp/>||<sp/>scalars<sp/>==<sp/>NULL<sp/>||<sp/>state_space<sp/>==<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scratch_apply_checkpoint(error_callback,<sp/>scratch,<sp/>scratch_checkpoint);</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/>state_space-&gt;<ref refid="structsecp256k1__pippenger__state_1acf3337b1747efba8ab565a35b7749c7d" kindref="member">ps</ref><sp/>=<sp/>(</highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__pippenger__point__state" kindref="compound">secp256k1_pippenger_point_state</ref><sp/>*)<sp/>secp256k1_scratch_alloc(error_callback,<sp/>scratch,<sp/>entries<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*state_space-&gt;<ref refid="structsecp256k1__pippenger__state_1acf3337b1747efba8ab565a35b7749c7d" kindref="member">ps</ref>));</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/>state_space-&gt;<ref refid="structsecp256k1__pippenger__state_1a0fd8693a4455cd726932b025f774fbdb" kindref="member">wnaf_na</ref><sp/>=<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*)<sp/>secp256k1_scratch_alloc(error_callback,<sp/>scratch,<sp/>entries*(<ref refid="ecmult__impl_8h_1a23d9fb349265ae338b9977f7f7aab065" kindref="member">WNAF_SIZE</ref>(bucket_window+1))<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/>buckets<sp/>=<sp/>(<ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>*)<sp/>secp256k1_scratch_alloc(error_callback,<sp/>scratch,<sp/>((</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)1<sp/>&lt;&lt;<sp/>bucket_window)<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*buckets));</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(state_space-&gt;<ref refid="structsecp256k1__pippenger__state_1acf3337b1747efba8ab565a35b7749c7d" kindref="member">ps</ref><sp/>==<sp/>NULL<sp/>||<sp/>state_space-&gt;<ref refid="structsecp256k1__pippenger__state_1a0fd8693a4455cd726932b025f774fbdb" kindref="member">wnaf_na</ref><sp/>==<sp/>NULL<sp/>||<sp/>buckets<sp/>==<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scratch_apply_checkpoint(error_callback,<sp/>scratch,<sp/>scratch_checkpoint);</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="692"><highlight class="normal"></highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(inp_g_sc<sp/>!=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scalars[0]<sp/>=<sp/>*inp_g_sc;</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>points[0]<sp/>=<sp/>secp256k1_ge_const_g;</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idx++;</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ecmult_endo_split(&amp;scalars[0],<sp/>&amp;scalars[1],<sp/>&amp;points[0],<sp/>&amp;points[1]);</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idx++;</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="700"><highlight class="normal"></highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(point_idx<sp/>&lt;<sp/>n_points)<sp/>{</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!cb(&amp;scalars[idx],<sp/>&amp;points[idx],<sp/>point_idx<sp/>+<sp/>cb_offset,<sp/>cbdata))<sp/>{</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scratch_apply_checkpoint(error_callback,<sp/>scratch,<sp/>scratch_checkpoint);</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idx++;</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ecmult_endo_split(&amp;scalars[idx<sp/>-<sp/>1],<sp/>&amp;scalars[idx],<sp/>&amp;points[idx<sp/>-<sp/>1],<sp/>&amp;points[idx]);</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idx++;</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>point_idx++;</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="711"><highlight class="normal"></highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ecmult_pippenger_wnaf(buckets,<sp/>bucket_window,<sp/>state_space,<sp/>r,<sp/>scalars,<sp/>points,<sp/>idx);</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scratch_apply_checkpoint(error_callback,<sp/>scratch,<sp/>scratch_checkpoint);</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="715"><highlight class="normal">}</highlight></codeline>
<codeline lineno="716"><highlight class="normal"></highlight></codeline>
<codeline lineno="717"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Wrapper<sp/>for<sp/>secp256k1_ecmult_multi_func<sp/>interface<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="718"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_ecmult_pippenger_batch_single(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__callback" kindref="compound">secp256k1_callback</ref>*<sp/>error_callback,<sp/><ref refid="scratch_8h_1a84bdf30f4ca993587d89471cf1ae8be7" kindref="member">secp256k1_scratch</ref><sp/>*scratch,<sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>*r,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*inp_g_sc,<sp/><ref refid="ecmult_8h_1a0f127c89ba0f17e7992666f3d789e58e" kindref="member">secp256k1_ecmult_multi_callback</ref><sp/>cb,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*cbdata,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n)<sp/>{</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>secp256k1_ecmult_pippenger_batch(error_callback,<sp/>scratch,<sp/>r,<sp/>inp_g_sc,<sp/>cb,<sp/>cbdata,<sp/>n,<sp/>0);</highlight></codeline>
<codeline lineno="720"><highlight class="normal">}</highlight></codeline>
<codeline lineno="721"><highlight class="normal"></highlight></codeline>
<codeline lineno="727"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>secp256k1_pippenger_max_points(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__callback" kindref="compound">secp256k1_callback</ref>*<sp/>error_callback,<sp/><ref refid="scratch_8h_1a84bdf30f4ca993587d89471cf1ae8be7" kindref="member">secp256k1_scratch</ref><sp/>*scratch)<sp/>{</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>max_alloc<sp/>=<sp/>secp256k1_scratch_max_allocation(error_callback,<sp/>scratch,<sp/><ref refid="ecmult__impl_8h_1a991c52a2d9fa18dd39f5a9fffe373922" kindref="member">PIPPENGER_SCRATCH_OBJECTS</ref>);</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bucket_window;</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>res<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="731"><highlight class="normal"></highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(bucket_window<sp/>=<sp/>1;<sp/>bucket_window<sp/>&lt;=<sp/><ref refid="ecmult__impl_8h_1a9114820daf51f54afc1858640539ac6d" kindref="member">PIPPENGER_MAX_BUCKET_WINDOW</ref>;<sp/>bucket_window++)<sp/>{</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_points;</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>max_points<sp/>=<sp/>secp256k1_pippenger_bucket_window_inv(bucket_window);</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>space_for_points;</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>space_overhead;</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>entry_size<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref>)<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref>)<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__pippenger__point__state" kindref="compound">secp256k1_pippenger_point_state</ref>)<sp/>+<sp/>(<ref refid="ecmult__impl_8h_1a23d9fb349265ae338b9977f7f7aab065" kindref="member">WNAF_SIZE</ref>(bucket_window+1)+1)*</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(int);</highlight></codeline>
<codeline lineno="738"><highlight class="normal"></highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>entry_size<sp/>=<sp/>2*entry_size;</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>space_overhead<sp/>=<sp/>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref>)<sp/>&lt;&lt;<sp/>bucket_window)<sp/>+<sp/>entry_size<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structsecp256k1__pippenger__state" kindref="compound">secp256k1_pippenger_state</ref>);</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(space_overhead<sp/>&gt;<sp/>max_alloc)<sp/>{</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>space_for_points<sp/>=<sp/>max_alloc<sp/>-<sp/>space_overhead;</highlight></codeline>
<codeline lineno="745"><highlight class="normal"></highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n_points<sp/>=<sp/>space_for_points/entry_size;</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n_points<sp/>=<sp/>n_points<sp/>&gt;<sp/>max_points<sp/>?<sp/>max_points<sp/>:<sp/>n_points;</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n_points<sp/>&gt;<sp/>res)<sp/>{</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>res<sp/>=<sp/>n_points;</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n_points<sp/>&lt;<sp/>max_points)<sp/>{</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>A<sp/>larger<sp/>bucket_window<sp/>may<sp/>support<sp/>even<sp/>more<sp/>points.<sp/>But<sp/>if<sp/>we</highlight></codeline>
<codeline lineno="753"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>would<sp/>choose<sp/>that<sp/>then<sp/>the<sp/>caller<sp/>couldn&apos;t<sp/>safely<sp/>use<sp/>any<sp/>number</highlight></codeline>
<codeline lineno="754"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>smaller<sp/>than<sp/>what<sp/>this<sp/>function<sp/>returns<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>res;</highlight></codeline>
<codeline lineno="759"><highlight class="normal">}</highlight></codeline>
<codeline lineno="760"><highlight class="normal"></highlight></codeline>
<codeline lineno="761"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Computes<sp/>ecmult_multi<sp/>by<sp/>simply<sp/>multiplying<sp/>and<sp/>adding<sp/>each<sp/>point.<sp/>Does<sp/>not</highlight></codeline>
<codeline lineno="762"><highlight class="comment"><sp/>*<sp/>require<sp/>a<sp/>scratch<sp/>space<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="763"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_ecmult_multi_simple_var(<ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>*r,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*inp_g_sc,<sp/><ref refid="ecmult_8h_1a0f127c89ba0f17e7992666f3d789e58e" kindref="member">secp256k1_ecmult_multi_callback</ref><sp/>cb,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*cbdata,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_points)<sp/>{</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>point_idx;</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>tmpj;</highlight></codeline>
<codeline lineno="766"><highlight class="normal"></highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_gej_set_infinity(r);</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_gej_set_infinity(&amp;tmpj);</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>r<sp/>=<sp/>inp_g_sc*G<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ecmult(r,<sp/>&amp;tmpj,<sp/>&amp;secp256k1_scalar_zero,<sp/>inp_g_sc);</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(point_idx<sp/>=<sp/>0;<sp/>point_idx<sp/>&lt;<sp/>n_points;<sp/>point_idx++)<sp/>{</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>point;</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>pointj;</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>scalar;</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!cb(&amp;scalar,<sp/>&amp;point,<sp/>point_idx,<sp/>cbdata))<sp/>{</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>r<sp/>+=<sp/>scalar*point<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_set_ge(&amp;pointj,<sp/>&amp;point);</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ecmult(&amp;tmpj,<sp/>&amp;pointj,<sp/>&amp;scalar,<sp/>NULL);</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_add_var(r,<sp/>r,<sp/>&amp;tmpj,<sp/>NULL);</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="784"><highlight class="normal">}</highlight></codeline>
<codeline lineno="785"><highlight class="normal"></highlight></codeline>
<codeline lineno="786"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Compute<sp/>the<sp/>number<sp/>of<sp/>batches<sp/>and<sp/>the<sp/>batch<sp/>size<sp/>given<sp/>the<sp/>maximum<sp/>batch<sp/>size<sp/>and<sp/>the</highlight></codeline>
<codeline lineno="787"><highlight class="comment"><sp/>*<sp/>total<sp/>number<sp/>of<sp/>points<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="788"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_ecmult_multi_batch_size_helper(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>*n_batches,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>*n_batch_points,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>max_n_batch_points,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n)<sp/>{</highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(max_n_batch_points<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(max_n_batch_points<sp/>&gt;<sp/><ref refid="ecmult__impl_8h_1a8be09901326f35f4390bb788d9fa2fea" kindref="member">ECMULT_MAX_POINTS_PER_BATCH</ref>)<sp/>{</highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>max_n_batch_points<sp/>=<sp/><ref refid="ecmult__impl_8h_1a8be09901326f35f4390bb788d9fa2fea" kindref="member">ECMULT_MAX_POINTS_PER_BATCH</ref>;</highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*n_batches<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*n_batch_points<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Compute<sp/>ceil(n/max_n_batch_points)<sp/>and<sp/>ceil(n/n_batches)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/>*n_batches<sp/>=<sp/><ref refid="secp256k1_2src_2util_8h_1afbc3b0509e5eeaa83c581c4c3f4fda43" kindref="member">CEIL_DIV</ref>(n,<sp/>max_n_batch_points);</highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/><sp/><sp/>*n_batch_points<sp/>=<sp/><ref refid="secp256k1_2src_2util_8h_1afbc3b0509e5eeaa83c581c4c3f4fda43" kindref="member">CEIL_DIV</ref>(n,<sp/>*n_batches);</highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="804"><highlight class="normal">}</highlight></codeline>
<codeline lineno="805"><highlight class="normal"></highlight></codeline>
<codeline lineno="806" refid="ecmult__impl_8h_1afedbad22c020fec93edb5823e9d385ed" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/>int<sp/>(*<ref refid="ecmult__impl_8h_1afedbad22c020fec93edb5823e9d385ed" kindref="member">secp256k1_ecmult_multi_func</ref>)(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__callback" kindref="compound">secp256k1_callback</ref>*<sp/>error_callback,<sp/><ref refid="scratch_8h_1a84bdf30f4ca993587d89471cf1ae8be7" kindref="member">secp256k1_scratch</ref>*,<sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref>*,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref>*,<sp/><ref refid="ecmult_8h_1a0f127c89ba0f17e7992666f3d789e58e" kindref="member">secp256k1_ecmult_multi_callback</ref><sp/>cb,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*,<sp/>size_t);</highlight></codeline>
<codeline lineno="807"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_ecmult_multi_var(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__callback" kindref="compound">secp256k1_callback</ref>*<sp/>error_callback,<sp/><ref refid="scratch_8h_1a84bdf30f4ca993587d89471cf1ae8be7" kindref="member">secp256k1_scratch</ref><sp/>*scratch,<sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>*r,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*inp_g_sc,<sp/><ref refid="ecmult_8h_1a0f127c89ba0f17e7992666f3d789e58e" kindref="member">secp256k1_ecmult_multi_callback</ref><sp/>cb,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*cbdata,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n)<sp/>{</highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="809"><highlight class="normal"></highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/>int<sp/>(*f)(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__callback" kindref="compound">secp256k1_callback</ref>*<sp/>error_callback,<sp/><ref refid="scratch_8h_1a84bdf30f4ca993587d89471cf1ae8be7" kindref="member">secp256k1_scratch</ref>*,<sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref>*,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref>*,<sp/><ref refid="ecmult_8h_1a0f127c89ba0f17e7992666f3d789e58e" kindref="member">secp256k1_ecmult_multi_callback</ref><sp/>cb,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*,<sp/>size_t,<sp/>size_t);</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_batches;</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_batch_points;</highlight></codeline>
<codeline lineno="813"><highlight class="normal"></highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_gej_set_infinity(r);</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(inp_g_sc<sp/>==<sp/>NULL<sp/>&amp;&amp;<sp/>n<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ecmult(r,<sp/>r,<sp/>&amp;secp256k1_scalar_zero,<sp/>inp_g_sc);</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(scratch<sp/>==<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>secp256k1_ecmult_multi_simple_var(r,<sp/>inp_g_sc,<sp/>cb,<sp/>cbdata,<sp/>n);</highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="824"><highlight class="normal"></highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Compute<sp/>the<sp/>batch<sp/>sizes<sp/>for<sp/>Pippenger&apos;s<sp/>algorithm<sp/>given<sp/>a<sp/>scratch<sp/>space.<sp/>If<sp/>it&apos;s<sp/>greater<sp/>than</highlight></codeline>
<codeline lineno="826"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>a<sp/>threshold<sp/>use<sp/>Pippenger&apos;s<sp/>algorithm.<sp/>Otherwise<sp/>use<sp/>Strauss&apos;<sp/>algorithm.</highlight></codeline>
<codeline lineno="827"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>As<sp/>a<sp/>first<sp/>step<sp/>check<sp/>if<sp/>there&apos;s<sp/>enough<sp/>space<sp/>for<sp/>Pippenger&apos;s<sp/>algo<sp/>(which<sp/>requires<sp/>less<sp/>space</highlight></codeline>
<codeline lineno="828"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>than<sp/>Strauss&apos;<sp/>algo)<sp/>and<sp/>if<sp/>not,<sp/>use<sp/>the<sp/>simple<sp/>algorithm.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_ecmult_multi_batch_size_helper(&amp;n_batches,<sp/>&amp;n_batch_points,<sp/>secp256k1_pippenger_max_points(error_callback,<sp/>scratch),<sp/>n))<sp/>{</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>secp256k1_ecmult_multi_simple_var(r,<sp/>inp_g_sc,<sp/>cb,<sp/>cbdata,<sp/>n);</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n_batch_points<sp/>&gt;=<sp/><ref refid="ecmult__impl_8h_1a71e7f4ad865cad35efddc0495b59fcf3" kindref="member">ECMULT_PIPPENGER_THRESHOLD</ref>)<sp/>{</highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f<sp/>=<sp/>secp256k1_ecmult_pippenger_batch;</highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="835"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_ecmult_multi_batch_size_helper(&amp;n_batches,<sp/>&amp;n_batch_points,<sp/>secp256k1_strauss_max_points(error_callback,<sp/>scratch),<sp/>n))<sp/>{</highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>secp256k1_ecmult_multi_simple_var(r,<sp/>inp_g_sc,<sp/>cb,<sp/>cbdata,<sp/>n);</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f<sp/>=<sp/>secp256k1_ecmult_strauss_batch;</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>n_batches;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>nbp<sp/>=<sp/>n<sp/>&lt;<sp/>n_batch_points<sp/>?<sp/>n<sp/>:<sp/>n_batch_points;</highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>offset<sp/>=<sp/>n_batch_points*i;</highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>tmp;</highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!f(error_callback,<sp/>scratch,<sp/>&amp;tmp,<sp/>i<sp/>==<sp/>0<sp/>?<sp/>inp_g_sc<sp/>:<sp/>NULL,<sp/>cb,<sp/>cbdata,<sp/>nbp,<sp/>offset))<sp/>{</highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_add_var(r,<sp/>r,<sp/>&amp;tmp,<sp/>NULL);</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n<sp/>-=<sp/>nbp;</highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="851"><highlight class="normal">}</highlight></codeline>
<codeline lineno="852"><highlight class="normal"></highlight></codeline>
<codeline lineno="853"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/></highlight><highlight class="comment">/*<sp/>SECP256K1_ECMULT_IMPL_H<sp/>*/</highlight><highlight class="preprocessor"></highlight></codeline>
    </programlisting>
    <location file="src/secp256k1/src/ecmult_impl.h"/>
  </compounddef>
</doxygen>
