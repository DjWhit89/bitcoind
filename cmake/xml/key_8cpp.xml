<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="key_8cpp" kind="file" language="C++">
    <compoundname>key.cpp</compoundname>
    <includes refid="key_8h" local="no">key.h</includes>
    <includes refid="crypto_2common_8h" local="no">crypto/common.h</includes>
    <includes refid="hmac__sha512_8h" local="no">crypto/hmac_sha512.h</includes>
    <includes refid="hash_8h" local="no">hash.h</includes>
    <includes refid="random_8h" local="no">random.h</includes>
    <includes refid="secp256k1_8h" local="no">secp256k1.h</includes>
    <includes refid="secp256k1__ellswift_8h" local="no">secp256k1_ellswift.h</includes>
    <includes refid="secp256k1__extrakeys_8h" local="no">secp256k1_extrakeys.h</includes>
    <includes refid="secp256k1__musig_8h" local="no">secp256k1_musig.h</includes>
    <includes refid="secp256k1__recovery_8h" local="no">secp256k1_recovery.h</includes>
    <includes refid="secp256k1__schnorrsig_8h" local="no">secp256k1_schnorrsig.h</includes>
    <incdepgraph>
      <node id="6">
        <label>attributes.h</label>
        <link refid="attributes_8h"/>
      </node>
      <node id="26">
        <label>compat/assumptions.h</label>
        <link refid="compat_2assumptions_8h"/>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
      </node>
      <node id="9">
        <label>compat/byteswap.h</label>
        <link refid="byteswap_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
      </node>
      <node id="8">
        <label>compat/endian.h</label>
        <link refid="endian_8h"/>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
      </node>
      <node id="56">
        <label>crypto/chacha20.h</label>
        <link refid="chacha20_8h"/>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
      </node>
      <node id="7">
        <label>crypto/common.h</label>
        <link refid="crypto_2common_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
      </node>
      <node id="37">
        <label>crypto/hex_base.h</label>
        <link refid="hex__base_8h"/>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
      </node>
      <node id="53">
        <label>crypto/hmac_sha512.h</label>
        <link refid="hmac__sha512_8h"/>
        <childnode refid="54" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
      </node>
      <node id="15">
        <label>crypto/ripemd160.h</label>
        <link refid="ripemd160_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="17">
        <label>crypto/sha256.h</label>
        <link refid="sha256_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
      </node>
      <node id="54">
        <label>crypto/sha512.h</label>
        <link refid="sha512_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="5">
        <label>hash.h</label>
        <link refid="hash_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>src/key.cpp</label>
        <link refid="key_8cpp"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="55" relation="include">
        </childnode>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="65" relation="include">
        </childnode>
        <childnode refid="67" relation="include">
        </childnode>
        <childnode refid="68" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>key.h</label>
        <link refid="key_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="3">
        <label>musig.h</label>
        <link refid="musig_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="19">
        <label>prevector.h</label>
        <link refid="prevector_8h"/>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>pubkey.h</label>
        <link refid="pubkey_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="55">
        <label>random.h</label>
        <link refid="random_8h"/>
        <childnode refid="56" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="60" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="61">
        <label>secp256k1.h</label>
        <link refid="secp256k1_8h"/>
        <childnode refid="62" relation="include">
        </childnode>
      </node>
      <node id="63">
        <label>secp256k1_ellswift.h</label>
        <link refid="secp256k1__ellswift_8h"/>
        <childnode refid="61" relation="include">
        </childnode>
      </node>
      <node id="64">
        <label>secp256k1_extrakeys.h</label>
        <link refid="secp256k1__extrakeys_8h"/>
        <childnode refid="61" relation="include">
        </childnode>
      </node>
      <node id="65">
        <label>secp256k1_musig.h</label>
        <link refid="secp256k1__musig_8h"/>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="66" relation="include">
        </childnode>
      </node>
      <node id="67">
        <label>secp256k1_recovery.h</label>
        <link refid="secp256k1__recovery_8h"/>
        <childnode refid="61" relation="include">
        </childnode>
      </node>
      <node id="68">
        <label>secp256k1_schnorrsig.h</label>
        <link refid="secp256k1__schnorrsig_8h"/>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
      </node>
      <node id="25">
        <label>serialize.h</label>
        <link refid="serialize_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="28">
        <label>span.h</label>
        <link refid="span_8h"/>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
      </node>
      <node id="46">
        <label>support/allocators/secure.h</label>
        <link refid="secure_8h"/>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
      </node>
      <node id="51">
        <label>support/cleanse.h</label>
        <link refid="cleanse_8h"/>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="47">
        <label>support/lockedpool.h</label>
        <link refid="lockedpool_8h"/>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="49" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
      </node>
      <node id="35">
        <label>uint256.h</label>
        <link refid="uint256_8h"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
      </node>
      <node id="57">
        <label>util/check.h</label>
        <link refid="check_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
      </node>
      <node id="36">
        <label>util/strencodings.h</label>
        <link refid="strencodings_8h"/>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="38">
        <label>util/string.h</label>
        <link refid="string_8h"/>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="20">
        <label>algorithm</label>
      </node>
      <node id="39">
        <label>array</label>
      </node>
      <node id="58">
        <label>atomic</label>
      </node>
      <node id="11">
        <label>bit</label>
      </node>
      <node id="21">
        <label>cassert</label>
      </node>
      <node id="43">
        <label>charconv</label>
      </node>
      <node id="60">
        <label>chrono</label>
      </node>
      <node id="12">
        <label>concepts</label>
      </node>
      <node id="13">
        <label>cstddef</label>
      </node>
      <node id="10">
        <label>cstdint</label>
      </node>
      <node id="16">
        <label>cstdlib</label>
      </node>
      <node id="14">
        <label>cstring</label>
      </node>
      <node id="30">
        <label>ios</label>
      </node>
      <node id="22">
        <label>iterator</label>
      </node>
      <node id="27">
        <label>limits</label>
      </node>
      <node id="48">
        <label>list</label>
      </node>
      <node id="40">
        <label>locale</label>
      </node>
      <node id="31">
        <label>map</label>
      </node>
      <node id="32">
        <label>memory</label>
      </node>
      <node id="49">
        <label>mutex</label>
      </node>
      <node id="44">
        <label>optional</label>
      </node>
      <node id="33">
        <label>set</label>
      </node>
      <node id="59">
        <label>source_location</label>
      </node>
      <node id="29">
        <label>span</label>
      </node>
      <node id="41">
        <label>sstream</label>
      </node>
      <node id="62">
        <label>stddef.h</label>
      </node>
      <node id="52">
        <label>stdexcept</label>
      </node>
      <node id="66">
        <label>stdint.h</label>
      </node>
      <node id="18">
        <label>string</label>
      </node>
      <node id="42">
        <label>string_view</label>
      </node>
      <node id="45">
        <label>system_error</label>
      </node>
      <node id="23">
        <label>type_traits</label>
      </node>
      <node id="50">
        <label>unordered_map</label>
      </node>
      <node id="24">
        <label>utility</label>
      </node>
      <node id="34">
        <label>vector</label>
      </node>
    </incdepgraph>
    <sectiondef kind="var">
      <memberdef kind="variable" id="key_8cpp_1aa353374fd6a64d469d7d2f3540f8ac76" prot="public" static="yes" mutable="no">
        <type><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
        <definition>secp256k1_context* secp256k1_context_sign</definition>
        <argsstring></argsstring>
        <name>secp256k1_context_sign</name>
        <initializer>= nullptr</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/key.cpp" line="20" column="26" bodyfile="src/key.cpp" bodystart="20" bodyend="-1"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="func">
      <memberdef kind="function" id="key_8cpp_1acb3e61a21bab4d7e4f38985463982b73" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int ec_seckey_import_der</definition>
        <argsstring>(const secp256k1_context *ctx, unsigned char *out32, const unsigned char *seckey, size_t seckeylen)</argsstring>
        <name>ec_seckey_import_der</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type>unsigned char *</type>
          <declname>out32</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>seckey</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>seckeylen</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>These functions are taken from the libsecp256k1 distribution and are very ugly. This parses a format loosely based on a DER encoding of the ECPrivateKey type from section C.4 of SEC 1 <ulink url="https://www.secg.org/sec1-v2.pdf">https://www.secg.org/sec1-v2.pdf</ulink>, with the following caveats:</para>
<para><itemizedlist>
<listitem><para>The octet-length of the SEQUENCE must be encoded as 1 or 2 octets. It is not required to be encoded as one octet if it is less than 256, as DER would require.</para>
</listitem><listitem><para>The octet-length of the SEQUENCE must not be greater than the remaining length of the key encoding, but need not match it (i.e. the encoding may contain junk after the encoded SEQUENCE).</para>
</listitem><listitem><para>The privateKey OCTET STRING is zero-filled on the left to 32 octets.</para>
</listitem><listitem><para>Anything after the encoding of the privateKey OCTET STRING is ignored, whether or not it is validly encoded DER.</para>
</listitem></itemizedlist>
</para>
<para>out32 must point to an output buffer of length at least 32 bytes. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/key.cpp" line="39" column="5" bodyfile="src/key.cpp" bodystart="39" bodyend="84"/>
      </memberdef>
      <memberdef kind="function" id="key_8cpp_1a8dfc834bbe7d6fb7715c07826c1b1507" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int ec_seckey_export_der</definition>
        <argsstring>(const secp256k1_context *ctx, unsigned char *seckey, size_t *seckeylen, const unsigned char *key32, bool compressed)</argsstring>
        <name>ec_seckey_export_der</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type>unsigned char *</type>
          <declname>seckey</declname>
        </param>
        <param>
          <type>size_t *</type>
          <declname>seckeylen</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>key32</declname>
        </param>
        <param>
          <type>bool</type>
          <declname>compressed</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This serializes to a DER encoding of the ECPrivateKey type from section C.4 of SEC 1 <ulink url="https://www.secg.org/sec1-v2.pdf">https://www.secg.org/sec1-v2.pdf</ulink>. The optional parameters and publicKey fields are included.</para>
<para>seckey must point to an output buffer of length at least <ref refid="class_c_key_1a0760cd6fcc3f45a64b0402a4cc9b9ce3" kindref="member">CKey::SIZE</ref> bytes. seckeylen must initially be set to the size of the seckey buffer. Upon return it will be set to the number of bytes used in the buffer. key32 must point to a 32-byte raw private key. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/key.cpp" line="96" column="5" bodyfile="src/key.cpp" bodystart="96" bodyend="156"/>
      </memberdef>
      <memberdef kind="function" id="key_8cpp_1ac9ec599027c6b68a87ebd788be2a611c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>bool SigHasLowR</definition>
        <argsstring>(const secp256k1_ecdsa_signature *sig)</argsstring>
        <name>SigHasLowR</name>
        <param>
          <type>const <ref refid="structsecp256k1__ecdsa__signature" kindref="compound">secp256k1_ecdsa_signature</ref> *</type>
          <declname>sig</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/key.cpp" line="197" column="6" bodyfile="src/key.cpp" bodystart="197" bodyend="207"/>
      </memberdef>
      <memberdef kind="function" id="key_8cpp_1aeb5c90c6e6a817f5ed4876d9722ae37f" prot="public" static="no" const="no" explicit="no" inline="no" noexcept="yes" virt="non-virtual">
        <type><ref refid="class_c_key" kindref="compound">CKey</ref></type>
        <definition>CKey GenerateRandomKey</definition>
        <argsstring>(bool compressed) noexcept</argsstring>
        <name>GenerateRandomKey</name>
        <param>
          <type>bool</type>
          <declname>compressed</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/key.cpp" line="475" column="6" bodyfile="src/key.cpp" bodystart="475" bodyend="480"/>
      </memberdef>
      <memberdef kind="function" id="key_8cpp_1adc8d142f5bcd2ca6646462fb45a7945d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>bool ECC_InitSanityCheck</definition>
        <argsstring>()</argsstring>
        <name>ECC_InitSanityCheck</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check that required EC support is available at runtime. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/key.cpp" line="565" column="6" bodyfile="src/key.cpp" bodystart="565" bodyend="569"/>
      </memberdef>
      <memberdef kind="function" id="key_8cpp_1a58fed27325bda851c5471926f095d6de" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void ECC_Start</definition>
        <argsstring>()</argsstring>
        <name>ECC_Start</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Initialize the elliptic curve support. May not be called twice without calling ECC_Stop first. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/key.cpp" line="572" column="13" bodyfile="src/key.cpp" bodystart="572" bodyend="587"/>
      </memberdef>
      <memberdef kind="function" id="key_8cpp_1a993650d2186e122347c2262f055b48dd" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void ECC_Stop</definition>
        <argsstring>()</argsstring>
        <name>ECC_Stop</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Deinitialize the elliptic curve support. No-op if ECC_Start wasn&apos;t called first. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/key.cpp" line="590" column="13" bodyfile="src/key.cpp" bodystart="590" bodyend="597"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2009-present<sp/>The<sp/>Bitcoin<sp/>Core<sp/>developers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2017<sp/>The<sp/>Zcash<sp/>developers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Distributed<sp/>under<sp/>the<sp/>MIT<sp/>software<sp/>license,<sp/>see<sp/>the<sp/>accompanying</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="comment">//<sp/>file<sp/>COPYING<sp/>or<sp/>http://www.opensource.org/licenses/mit-license.php.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="key_8h" kindref="compound">key.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="crypto_2common_8h" kindref="compound">crypto/common.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="hmac__sha512_8h" kindref="compound">crypto/hmac_sha512.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="hash_8h" kindref="compound">hash.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="random_8h" kindref="compound">random.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="secp256k1_8h" kindref="compound">secp256k1.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="secp256k1__ellswift_8h" kindref="compound">secp256k1_ellswift.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="secp256k1__extrakeys_8h" kindref="compound">secp256k1_extrakeys.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="secp256k1__musig_8h" kindref="compound">secp256k1_musig.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="secp256k1__recovery_8h" kindref="compound">secp256k1_recovery.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="secp256k1__schnorrsig_8h" kindref="compound">secp256k1_schnorrsig.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>secp256k1_context_sign<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="key_8cpp_1acb3e61a21bab4d7e4f38985463982b73" kindref="member">ec_seckey_import_der</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*out32,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*seckey,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>seckeylen)<sp/>{</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*end<sp/>=<sp/>seckey<sp/>+<sp/>seckeylen;</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(out32,<sp/>0,<sp/>32);</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>sequence<sp/>header<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>-<sp/>seckey<sp/>&lt;<sp/>1<sp/>||<sp/>*seckey<sp/>!=<sp/>0x30u)<sp/>{</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/>seckey++;</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>sequence<sp/>length<sp/>constructor<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>-<sp/>seckey<sp/>&lt;<sp/>1<sp/>||<sp/>!(*seckey<sp/>&amp;<sp/>0x80u))<sp/>{</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/>ptrdiff_t<sp/>lenb<sp/>=<sp/>*seckey<sp/>&amp;<sp/>~0x80u;<sp/>seckey++;</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(lenb<sp/>&lt;<sp/>1<sp/>||<sp/>lenb<sp/>&gt;<sp/>2)<sp/>{</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>-<sp/>seckey<sp/>&lt;<sp/>lenb)<sp/>{</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>sequence<sp/>length<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/>ptrdiff_t<sp/>len<sp/>=<sp/>seckey[lenb-1]<sp/>|<sp/>(lenb<sp/>&gt;<sp/>1<sp/>?<sp/>seckey[lenb-2]<sp/>&lt;&lt;<sp/>8<sp/>:<sp/>0u);</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/>seckey<sp/>+=<sp/>lenb;</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>-<sp/>seckey<sp/>&lt;<sp/>len)<sp/>{</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>sequence<sp/>element<sp/>0:<sp/>version<sp/>number<sp/>(=1)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>-<sp/>seckey<sp/>&lt;<sp/>3<sp/>||<sp/>seckey[0]<sp/>!=<sp/>0x02u<sp/>||<sp/>seckey[1]<sp/>!=<sp/>0x01u<sp/>||<sp/>seckey[2]<sp/>!=<sp/>0x01u)<sp/>{</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/>seckey<sp/>+=<sp/>3;</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>sequence<sp/>element<sp/>1:<sp/>octet<sp/>string,<sp/>up<sp/>to<sp/>32<sp/>bytes<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>-<sp/>seckey<sp/>&lt;<sp/>2<sp/>||<sp/>seckey[0]<sp/>!=<sp/>0x04u)<sp/>{</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/>ptrdiff_t<sp/>oslen<sp/>=<sp/>seckey[1];</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/>seckey<sp/>+=<sp/>2;</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(oslen<sp/>&gt;<sp/>32<sp/>||<sp/>end<sp/>-<sp/>seckey<sp/>&lt;<sp/>oslen)<sp/>{</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(out32<sp/>+<sp/>(32<sp/>-<sp/>oslen),<sp/>seckey,<sp/>oslen);</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="secp256k1_8h_1a366f922fc0c787351e82ff8e3a95f652" kindref="member">secp256k1_ec_seckey_verify</ref>(ctx,<sp/>out32))<sp/>{</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memset(out32,<sp/>0,<sp/>32);</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="84"><highlight class="normal">}</highlight></codeline>
<codeline lineno="85"><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="key_8cpp_1a8dfc834bbe7d6fb7715c07826c1b1507" kindref="member">ec_seckey_export_der</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref><sp/>*ctx,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*seckey,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>*seckeylen,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*key32,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>compressed)<sp/>{</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(*seckeylen<sp/>&gt;=<sp/><ref refid="class_c_key_1a0760cd6fcc3f45a64b0402a4cc9b9ce3" kindref="member">CKey::SIZE</ref>);</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref><sp/>pubkey;</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>pubkeylen<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="secp256k1_8h_1a7438071aa8a6dc4697abe4f4659f2161" kindref="member">secp256k1_ec_pubkey_create</ref>(ctx,<sp/>&amp;pubkey,<sp/>key32))<sp/>{</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*seckeylen<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(compressed)<sp/>{</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>begin[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0x30,0x81,0xD3,0x02,0x01,0x01,0x04,0x20</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>middle[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0xA0,0x81,0x85,0x30,0x81,0x82,0x02,0x01,0x01,0x30,0x2C,0x06,0x07,0x2A,0x86,0x48,</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0xCE,0x3D,0x01,0x01,0x02,0x21,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0xFF,0xFF,0xFE,0xFF,0xFF,0xFC,0x2F,0x30,0x06,0x04,0x01,0x00,0x04,0x01,0x07,0x04,</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0x21,0x02,0x79,0xBE,0x66,0x7E,0xF9,0xDC,0xBB,0xAC,0x55,0xA0,0x62,0x95,0xCE,0x87,</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0x0B,0x07,0x02,0x9B,0xFC,0xDB,0x2D,0xCE,0x28,0xD9,0x59,0xF2,0x81,0x5B,0x16,0xF8,</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0x17,0x98,0x02,0x21,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0xFF,0xFF,0xFF,0xFF,0xFE,0xBA,0xAE,0xDC,0xE6,0xAF,0x48,0xA0,0x3B,0xBF,0xD2,0x5E,</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0x8C,0xD0,0x36,0x41,0x41,0x02,0x01,0x01,0xA1,0x24,0x03,0x22,0x00</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ptr<sp/>=<sp/>seckey;</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(ptr,<sp/>begin,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(begin));<sp/>ptr<sp/>+=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(begin);</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(ptr,<sp/>key32,<sp/>32);<sp/>ptr<sp/>+=<sp/>32;</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(ptr,<sp/>middle,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(middle));<sp/>ptr<sp/>+=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(middle);</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pubkeylen<sp/>=<sp/><ref refid="class_c_pub_key_1a0fa69c6e3c696e919052d6e663127986" kindref="member">CPubKey::COMPRESSED_SIZE</ref>;</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1_8h_1a34977bf00322e510e881160c421836d7" kindref="member">secp256k1_ec_pubkey_serialize</ref>(ctx,<sp/>ptr,<sp/>&amp;pubkeylen,<sp/>&amp;pubkey,<sp/><ref refid="secp256k1_8h_1a7b8f642c65e8b5c81fa4421b7c42ab57" kindref="member">SECP256K1_EC_COMPRESSED</ref>);</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>pubkeylen;</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*seckeylen<sp/>=<sp/>ptr<sp/>-<sp/>seckey;</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(*seckeylen<sp/>==<sp/><ref refid="class_c_key_1a474ebdb27a1c99c2b71f8ac40e2e68ac" kindref="member">CKey::COMPRESSED_SIZE</ref>);</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>begin[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0x30,0x82,0x01,0x13,0x02,0x01,0x01,0x04,0x20</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>middle[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0xA0,0x81,0xA5,0x30,0x81,0xA2,0x02,0x01,0x01,0x30,0x2C,0x06,0x07,0x2A,0x86,0x48,</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0xCE,0x3D,0x01,0x01,0x02,0x21,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0xFF,0xFF,0xFE,0xFF,0xFF,0xFC,0x2F,0x30,0x06,0x04,0x01,0x00,0x04,0x01,0x07,0x04,</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0x41,0x04,0x79,0xBE,0x66,0x7E,0xF9,0xDC,0xBB,0xAC,0x55,0xA0,0x62,0x95,0xCE,0x87,</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0x0B,0x07,0x02,0x9B,0xFC,0xDB,0x2D,0xCE,0x28,0xD9,0x59,0xF2,0x81,0x5B,0x16,0xF8,</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0x17,0x98,0x48,0x3A,0xDA,0x77,0x26,0xA3,0xC4,0x65,0x5D,0xA4,0xFB,0xFC,0x0E,0x11,</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0x08,0xA8,0xFD,0x17,0xB4,0x48,0xA6,0x85,0x54,0x19,0x9C,0x47,0xD0,0x8F,0xFB,0x10,</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0xD4,0xB8,0x02,0x21,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0xFF,0xFF,0xFF,0xFF,0xFE,0xBA,0xAE,0xDC,0xE6,0xAF,0x48,0xA0,0x3B,0xBF,0xD2,0x5E,</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0x8C,0xD0,0x36,0x41,0x41,0x02,0x01,0x01,0xA1,0x44,0x03,0x42,0x00</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ptr<sp/>=<sp/>seckey;</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(ptr,<sp/>begin,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(begin));<sp/>ptr<sp/>+=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(begin);</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(ptr,<sp/>key32,<sp/>32);<sp/>ptr<sp/>+=<sp/>32;</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(ptr,<sp/>middle,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(middle));<sp/>ptr<sp/>+=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(middle);</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pubkeylen<sp/>=<sp/><ref refid="class_c_pub_key_1aa3a132dbabee1ebb28e49b61879079d9" kindref="member">CPubKey::SIZE</ref>;</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1_8h_1a34977bf00322e510e881160c421836d7" kindref="member">secp256k1_ec_pubkey_serialize</ref>(ctx,<sp/>ptr,<sp/>&amp;pubkeylen,<sp/>&amp;pubkey,<sp/><ref refid="secp256k1_8h_1ab8e25dc58843e83926f95795f9e8a6e2" kindref="member">SECP256K1_EC_UNCOMPRESSED</ref>);</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>pubkeylen;</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*seckeylen<sp/>=<sp/>ptr<sp/>-<sp/>seckey;</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(*seckeylen<sp/>==<sp/><ref refid="class_c_key_1a0760cd6fcc3f45a64b0402a4cc9b9ce3" kindref="member">CKey::SIZE</ref>);</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="156"><highlight class="normal">}</highlight></codeline>
<codeline lineno="157"><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>CKey::Check(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*vch)<sp/>{</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a366f922fc0c787351e82ff8e3a95f652" kindref="member">secp256k1_ec_seckey_verify</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>vch);</highlight></codeline>
<codeline lineno="160"><highlight class="normal">}</highlight></codeline>
<codeline lineno="161"><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_c_key_1a4c2b881159b01dacff86884fa2a7b7ff" kindref="member">CKey::MakeNewKey</ref>(</highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>fCompressedIn)<sp/>{</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/>MakeKeyData();</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="random_8cpp_1a573a23ce1afe5405047d74faaafe7cbd" kindref="member">GetStrongRandBytes</ref>(*keydata);</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(!Check(keydata-&gt;data()));</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/>fCompressed<sp/>=<sp/>fCompressedIn;</highlight></codeline>
<codeline lineno="168"><highlight class="normal">}</highlight></codeline>
<codeline lineno="169"><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"><ref refid="key_8h_1a1da569b8b6e5b3fa1196cc1b877e7f54" kindref="member">CPrivKey</ref><sp/><ref refid="class_c_key_1a280157fca5685cc0894e582a3ef1d138" kindref="member">CKey::GetPrivKey</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(keydata);</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="key_8h_1a1da569b8b6e5b3fa1196cc1b877e7f54" kindref="member">CPrivKey</ref><sp/>seckey;</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>seckeylen;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/>seckey.resize(<ref refid="class_c_key_1a0760cd6fcc3f45a64b0402a4cc9b9ce3" kindref="member">SIZE</ref>);</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/>seckeylen<sp/>=<sp/><ref refid="class_c_key_1a0760cd6fcc3f45a64b0402a4cc9b9ce3" kindref="member">SIZE</ref>;</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="key_8cpp_1a8dfc834bbe7d6fb7715c07826c1b1507" kindref="member">ec_seckey_export_der</ref>(secp256k1_context_sign,<sp/>seckey.data(),<sp/>&amp;seckeylen,<sp/><ref refid="span_8h_1ad150fa0b59e38198809cfce8d0d5d11d" kindref="member">UCharCast</ref>(<ref refid="class_c_key_1a3f0e783949c4bbf1122b67f8b3e0c6b8" kindref="member">begin</ref>()),<sp/>fCompressed);</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/>seckey.resize(seckeylen);</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>seckey;</highlight></codeline>
<codeline lineno="181"><highlight class="normal">}</highlight></codeline>
<codeline lineno="182"><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><ref refid="class_c_pub_key" kindref="compound">CPubKey</ref><sp/><ref refid="class_c_key_1a344311f57d0f0df0822c9fb04f66cf95" kindref="member">CKey::GetPubKey</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(keydata);</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8h_1a7d2fa05f2977d675bbcc274e911f16e6" kindref="member">secp256k1_pubkey</ref><sp/>pubkey;</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>clen<sp/>=<sp/><ref refid="class_c_pub_key_1aa3a132dbabee1ebb28e49b61879079d9" kindref="member">CPubKey::SIZE</ref>;</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/>CPubKey<sp/>result;</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="secp256k1_8h_1a7438071aa8a6dc4697abe4f4659f2161" kindref="member">secp256k1_ec_pubkey_create</ref>(secp256k1_context_sign,<sp/>&amp;pubkey,<sp/><ref refid="span_8h_1ad150fa0b59e38198809cfce8d0d5d11d" kindref="member">UCharCast</ref>(<ref refid="class_c_key_1a3f0e783949c4bbf1122b67f8b3e0c6b8" kindref="member">begin</ref>()));</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8h_1a34977bf00322e510e881160c421836d7" kindref="member">secp256k1_ec_pubkey_serialize</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*)result.<ref refid="class_c_pub_key_1a1b0b9d70f5f2ebe577cb78aa60d88ba5" kindref="member">begin</ref>(),<sp/>&amp;clen,<sp/>&amp;pubkey,<sp/>fCompressed<sp/>?<sp/><ref refid="secp256k1_8h_1a7b8f642c65e8b5c81fa4421b7c42ab57" kindref="member">SECP256K1_EC_COMPRESSED</ref><sp/>:<sp/><ref refid="secp256k1_8h_1ab8e25dc58843e83926f95795f9e8a6e2" kindref="member">SECP256K1_EC_UNCOMPRESSED</ref>);</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(result.<ref refid="class_c_pub_key_1a69622a843a8c7f05bf706cf80fad6951" kindref="member">size</ref>()<sp/>==<sp/>clen);</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(result.<ref refid="class_c_pub_key_1ac532c4b500b1a85ea22217f2c65a70ed" kindref="member">IsValid</ref>());</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="194"><highlight class="normal">}</highlight></codeline>
<codeline lineno="195"><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>the<sp/>sig<sp/>has<sp/>a<sp/>low<sp/>R<sp/>value<sp/>and<sp/>will<sp/>be<sp/>less<sp/>than<sp/>71<sp/>bytes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="key_8cpp_1ac9ec599027c6b68a87ebd788be2a611c" kindref="member">SigHasLowR</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__ecdsa__signature" kindref="compound">secp256k1_ecdsa_signature</ref>*<sp/>sig)</highlight></codeline>
<codeline lineno="198"><highlight class="normal">{</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>compact_sig[64];</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8h_1af8571ca8dcfb7f892519b337504dc700" kindref="member">secp256k1_ecdsa_signature_serialize_compact</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>compact_sig,<sp/>sig);</highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>In<sp/>DER<sp/>serialization,<sp/>all<sp/>values<sp/>are<sp/>interpreted<sp/>as<sp/>big-endian,<sp/>signed<sp/>integers.<sp/>The<sp/>highest<sp/>bit<sp/>in<sp/>the<sp/>integer<sp/>indicates</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>its<sp/>signed-ness;<sp/>0<sp/>is<sp/>positive,<sp/>1<sp/>is<sp/>negative.<sp/>When<sp/>the<sp/>value<sp/>is<sp/>interpreted<sp/>as<sp/>a<sp/>negative<sp/>integer,<sp/>it<sp/>must<sp/>be<sp/>converted</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>a<sp/>positive<sp/>value<sp/>by<sp/>prepending<sp/>a<sp/>0x00<sp/>byte<sp/>so<sp/>that<sp/>the<sp/>highest<sp/>bit<sp/>is<sp/>0.<sp/>We<sp/>can<sp/>avoid<sp/>this<sp/>prepending<sp/>by<sp/>ensuring<sp/>that</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>our<sp/>highest<sp/>bit<sp/>is<sp/>always<sp/>0,<sp/>and<sp/>thus<sp/>we<sp/>must<sp/>check<sp/>that<sp/>the<sp/>first<sp/>byte<sp/>is<sp/>less<sp/>than<sp/>0x80.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>compact_sig[0]<sp/>&lt;<sp/>0x80;</highlight></codeline>
<codeline lineno="207"><highlight class="normal">}</highlight></codeline>
<codeline lineno="208"><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_key_1a4143ab43733a1eef40d194163a2f69b0" kindref="member">CKey::Sign</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref><sp/>&amp;hash,<sp/>std::vector&lt;unsigned<sp/>char&gt;&amp;<sp/>vchSig,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>grind,<sp/>uint32_t<sp/>test_case)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!keydata)</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/>vchSig.resize(<ref refid="class_c_pub_key_1a299359805e58ddec0e31c3e3a33f3550" kindref="member">CPubKey::SIGNATURE_SIZE</ref>);</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>nSigLen<sp/>=<sp/><ref refid="class_c_pub_key_1a299359805e58ddec0e31c3e3a33f3550" kindref="member">CPubKey::SIGNATURE_SIZE</ref>;</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>extra_entropy[32]<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="crypto_2common_8h_1a016abe8ac98caf7486a8bea3c4a3612a" kindref="member">WriteLE32</ref>(extra_entropy,<sp/>test_case);</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8h_1ac98891eaf377baa800b131845e60e859" kindref="member">secp256k1_ecdsa_signature</ref><sp/>sig;</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>counter<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="secp256k1_8h_1a4185cc9a9de502e52cfe5350f7dc8438" kindref="member">secp256k1_ecdsa_sign</ref>(secp256k1_context_sign,<sp/>&amp;sig,<sp/>hash.<ref refid="classbase__blob_1a899a629fc7846994a3bbd28ba2777243" kindref="member">begin</ref>(),<sp/><ref refid="span_8h_1ad150fa0b59e38198809cfce8d0d5d11d" kindref="member">UCharCast</ref>(<ref refid="class_c_key_1a3f0e783949c4bbf1122b67f8b3e0c6b8" kindref="member">begin</ref>()),<sp/><ref refid="secp256k1_8h_1ac03ab067f194eb561175a6b522def2d8" kindref="member">secp256k1_nonce_function_rfc6979</ref>,<sp/>(!grind<sp/>&amp;&amp;<sp/>test_case)<sp/>?<sp/>extra_entropy<sp/>:<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="219"><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Grind<sp/>for<sp/>low<sp/>R</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>&amp;&amp;<sp/>!<ref refid="key_8cpp_1ac9ec599027c6b68a87ebd788be2a611c" kindref="member">SigHasLowR</ref>(&amp;sig)<sp/>&amp;&amp;<sp/>grind)<sp/>{</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="crypto_2common_8h_1a016abe8ac98caf7486a8bea3c4a3612a" kindref="member">WriteLE32</ref>(extra_entropy,<sp/>++counter);</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="secp256k1_8h_1a4185cc9a9de502e52cfe5350f7dc8438" kindref="member">secp256k1_ecdsa_sign</ref>(secp256k1_context_sign,<sp/>&amp;sig,<sp/>hash.<ref refid="classbase__blob_1a899a629fc7846994a3bbd28ba2777243" kindref="member">begin</ref>(),<sp/><ref refid="span_8h_1ad150fa0b59e38198809cfce8d0d5d11d" kindref="member">UCharCast</ref>(<ref refid="class_c_key_1a3f0e783949c4bbf1122b67f8b3e0c6b8" kindref="member">begin</ref>()),<sp/><ref refid="secp256k1_8h_1ac03ab067f194eb561175a6b522def2d8" kindref="member">secp256k1_nonce_function_rfc6979</ref>,<sp/>extra_entropy);</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8h_1ac07809ca872ec967ab4d3b1a95eafe0b" kindref="member">secp256k1_ecdsa_signature_serialize_der</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>vchSig.data(),<sp/>&amp;nSigLen,<sp/>&amp;sig);</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/>vchSig.resize(nSigLen);</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Additional<sp/>verification<sp/>step<sp/>to<sp/>prevent<sp/>using<sp/>a<sp/>potentially<sp/>corrupted<sp/>signature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8h_1a7d2fa05f2977d675bbcc274e911f16e6" kindref="member">secp256k1_pubkey</ref><sp/><ref refid="namespacetests__wycheproof__generate__ecdh_1a58c180b301e382c190377b9dd48c1833" kindref="member">pk</ref>;</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="secp256k1_8h_1a7438071aa8a6dc4697abe4f4659f2161" kindref="member">secp256k1_ec_pubkey_create</ref>(secp256k1_context_sign,<sp/>&amp;pk,<sp/><ref refid="span_8h_1ad150fa0b59e38198809cfce8d0d5d11d" kindref="member">UCharCast</ref>(<ref refid="class_c_key_1a3f0e783949c4bbf1122b67f8b3e0c6b8" kindref="member">begin</ref>()));</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="secp256k1_8h_1a7dd6acb7ef7100a6aebff91ecb7ede30" kindref="member">secp256k1_ecdsa_verify</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>&amp;sig,<sp/>hash.<ref refid="classbase__blob_1a899a629fc7846994a3bbd28ba2777243" kindref="member">begin</ref>(),<sp/>&amp;pk);</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="235"><highlight class="normal">}</highlight></codeline>
<codeline lineno="236"><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_key_1ad7a34331f4b6972a38928b176038ef75" kindref="member">CKey::VerifyPubKey</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_pub_key" kindref="compound">CPubKey</ref>&amp;<sp/>pubkey)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pubkey.<ref refid="class_c_pub_key_1a61c81b509c5f281f1afae76c7a3f3b4b" kindref="member">IsCompressed</ref>()<sp/>!=<sp/>fCompressed)<sp/>{</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>rnd[8];</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/>std::string<sp/>str<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Bitcoin<sp/>key<sp/>verification\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="random_8cpp_1ab12e884f2063117fd7ae32b213b83175" kindref="member">GetRandBytes</ref>(rnd);</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/>uint256<sp/>hash{<ref refid="hash_8h_1ac49a4a382d911138c745234f2fe7986d" kindref="member">Hash</ref>(str,<sp/>rnd)};</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;unsigned<sp/>char&gt;<sp/>vchSig;</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_key_1a4143ab43733a1eef40d194163a2f69b0" kindref="member">Sign</ref>(hash,<sp/>vchSig);</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pubkey.<ref refid="class_c_pub_key_1a7c8edfcaf0694aa344c0da4ce5a602b9" kindref="member">Verify</ref>(hash,<sp/>vchSig);</highlight></codeline>
<codeline lineno="248"><highlight class="normal">}</highlight></codeline>
<codeline lineno="249"><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_key_1ab813495ee5dd24d04ccd4abe59b6cf50" kindref="member">CKey::SignCompact</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref><sp/>&amp;hash,<sp/>std::vector&lt;unsigned<sp/>char&gt;&amp;<sp/>vchSig)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!keydata)</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/>vchSig.resize(<ref refid="class_c_pub_key_1aad6606f52a6543ad40f1691fd317b8be" kindref="member">CPubKey::COMPACT_SIGNATURE_SIZE</ref>);</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rec<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1__recovery_8h_1a458eba22320a4df81ccdbd68c0a2e3c4" kindref="member">secp256k1_ecdsa_recoverable_signature</ref><sp/>rsig;</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="secp256k1__recovery_8h_1a7868accd4760afcaeaa0ff3d239afc2a" kindref="member">secp256k1_ecdsa_sign_recoverable</ref>(secp256k1_context_sign,<sp/>&amp;rsig,<sp/>hash.<ref refid="classbase__blob_1a899a629fc7846994a3bbd28ba2777243" kindref="member">begin</ref>(),<sp/><ref refid="span_8h_1ad150fa0b59e38198809cfce8d0d5d11d" kindref="member">UCharCast</ref>(<ref refid="class_c_key_1a3f0e783949c4bbf1122b67f8b3e0c6b8" kindref="member">begin</ref>()),<sp/><ref refid="secp256k1_8h_1ac03ab067f194eb561175a6b522def2d8" kindref="member">secp256k1_nonce_function_rfc6979</ref>,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="secp256k1__recovery_8h_1a12f08c89ceb61949c6a4ec6eb2511185" kindref="member">secp256k1_ecdsa_recoverable_signature_serialize_compact</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>&amp;vchSig[1],<sp/>&amp;rec,<sp/>&amp;rsig);</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(rec<sp/>!=<sp/>-1);</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/>vchSig[0]<sp/>=<sp/>27<sp/>+<sp/>rec<sp/>+<sp/>(fCompressed<sp/>?<sp/>4<sp/>:<sp/>0);</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Additional<sp/>verification<sp/>step<sp/>to<sp/>prevent<sp/>using<sp/>a<sp/>potentially<sp/>corrupted<sp/>signature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8h_1a7d2fa05f2977d675bbcc274e911f16e6" kindref="member">secp256k1_pubkey</ref><sp/>epk,<sp/>rpk;</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="secp256k1_8h_1a7438071aa8a6dc4697abe4f4659f2161" kindref="member">secp256k1_ec_pubkey_create</ref>(secp256k1_context_sign,<sp/>&amp;epk,<sp/><ref refid="span_8h_1ad150fa0b59e38198809cfce8d0d5d11d" kindref="member">UCharCast</ref>(<ref refid="class_c_key_1a3f0e783949c4bbf1122b67f8b3e0c6b8" kindref="member">begin</ref>()));</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="secp256k1__recovery_8h_1af9f2082776bf8ebdb4c38161a211a02b" kindref="member">secp256k1_ecdsa_recover</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>&amp;rpk,<sp/>&amp;rsig,<sp/>hash.<ref refid="classbase__blob_1a899a629fc7846994a3bbd28ba2777243" kindref="member">begin</ref>());</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="secp256k1_8h_1a3607442049a415a5f649f53b089e766a" kindref="member">secp256k1_ec_pubkey_cmp</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>&amp;epk,<sp/>&amp;rpk);</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="271"><highlight class="normal">}</highlight></codeline>
<codeline lineno="272"><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_key_1a0884ca8071e122315e1fb5dc8efda906" kindref="member">CKey::SignSchnorr</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref>&amp;<sp/>hash,<sp/>std::span&lt;unsigned<sp/>char&gt;<sp/>sig,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref>*<sp/>merkle_root,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref>&amp;<sp/>aux)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="274"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/>KeyPair<sp/>kp<sp/>=<sp/><ref refid="class_c_key_1a1989d2094d3ab2510b9f839a1ab05b34" kindref="member">ComputeKeyPair</ref>(merkle_root);</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>kp.<ref refid="class_key_pair_1a14c5a153a3cb50e0cdf4bf244771fe24" kindref="member">SignSchnorr</ref>(hash,<sp/>sig,<sp/>aux);</highlight></codeline>
<codeline lineno="277"><highlight class="normal">}</highlight></codeline>
<codeline lineno="278"><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_key_1ad226478fb14c47c32a6d75a2130114d8" kindref="member">CKey::Load</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="key_8h_1a1da569b8b6e5b3fa1196cc1b877e7f54" kindref="member">CPrivKey</ref><sp/>&amp;seckey,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_pub_key" kindref="compound">CPubKey</ref><sp/>&amp;vchPubKey,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>fSkipCheck=</highlight><highlight class="keyword">false</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/>MakeKeyData();</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="key_8cpp_1acb3e61a21bab4d7e4f38985463982b73" kindref="member">ec_seckey_import_der</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*)<ref refid="class_c_key_1a3f0e783949c4bbf1122b67f8b3e0c6b8" kindref="member">begin</ref>(),<sp/>seckey.data(),<sp/>seckey.size()))<sp/>{</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ClearKeyData();</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/>fCompressed<sp/>=<sp/>vchPubKey.<ref refid="class_c_pub_key_1a61c81b509c5f281f1afae76c7a3f3b4b" kindref="member">IsCompressed</ref>();</highlight></codeline>
<codeline lineno="286"><highlight class="normal"></highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fSkipCheck)</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="289"><highlight class="normal"></highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_c_key_1ad7a34331f4b6972a38928b176038ef75" kindref="member">VerifyPubKey</ref>(vchPubKey);</highlight></codeline>
<codeline lineno="291"><highlight class="normal">}</highlight></codeline>
<codeline lineno="292"><highlight class="normal"></highlight></codeline>
<codeline lineno="293"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_c_key_1ac1e5f90d3ea728a29c0f29b5a85f3b87" kindref="member">CKey::Derive</ref>(<ref refid="class_c_key" kindref="compound">CKey</ref>&amp;<sp/>keyChild,<sp/><ref refid="hash_8h_1aa201a9867f780a040c7af908e0a85db3" kindref="member">ChainCode</ref><sp/>&amp;ccChild,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nChild,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="hash_8h_1aa201a9867f780a040c7af908e0a85db3" kindref="member">ChainCode</ref>&amp;<sp/>cc)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="class_c_key_1ac532c4b500b1a85ea22217f2c65a70ed" kindref="member">IsValid</ref>());</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="class_c_key_1a61c81b509c5f281f1afae76c7a3f3b4b" kindref="member">IsCompressed</ref>());</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;unsigned<sp/>char,<sp/>secure_allocator&lt;unsigned<sp/>char&gt;&gt;<sp/>vout(64);</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((nChild<sp/>&gt;&gt;<sp/>31)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CPubKey<sp/>pubkey<sp/>=<sp/><ref refid="class_c_key_1a344311f57d0f0df0822c9fb04f66cf95" kindref="member">GetPubKey</ref>();</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(pubkey.<ref refid="class_c_pub_key_1a69622a843a8c7f05bf706cf80fad6951" kindref="member">size</ref>()<sp/>==<sp/><ref refid="class_c_pub_key_1a0fa69c6e3c696e919052d6e663127986" kindref="member">CPubKey::COMPRESSED_SIZE</ref>);</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="hash_8cpp_1a391c1a6a1f947abbc53cc51fc709110e" kindref="member">BIP32Hash</ref>(cc,<sp/>nChild,<sp/>*pubkey.<ref refid="class_c_pub_key_1a1b0b9d70f5f2ebe577cb78aa60d88ba5" kindref="member">begin</ref>(),<sp/>pubkey.<ref refid="class_c_pub_key_1a1b0b9d70f5f2ebe577cb78aa60d88ba5" kindref="member">begin</ref>()+1,<sp/>vout.data());</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="class_c_key_1a69622a843a8c7f05bf706cf80fad6951" kindref="member">size</ref>()<sp/>==<sp/>32);</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="hash_8cpp_1a391c1a6a1f947abbc53cc51fc709110e" kindref="member">BIP32Hash</ref>(cc,<sp/>nChild,<sp/>0,<sp/><ref refid="span_8h_1ad150fa0b59e38198809cfce8d0d5d11d" kindref="member">UCharCast</ref>(<ref refid="class_c_key_1a3f0e783949c4bbf1122b67f8b3e0c6b8" kindref="member">begin</ref>()),<sp/>vout.data());</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(ccChild.<ref refid="classbase__blob_1a899a629fc7846994a3bbd28ba2777243" kindref="member">begin</ref>(),<sp/>vout.data()+32,<sp/>32);</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/>keyChild.<ref refid="class_c_key_1a187230fea4115615c6c65b39c9e18246" kindref="member">Set</ref>(<ref refid="class_c_key_1a3f0e783949c4bbf1122b67f8b3e0c6b8" kindref="member">begin</ref>(),<sp/><ref refid="class_c_key_1a3f0e783949c4bbf1122b67f8b3e0c6b8" kindref="member">begin</ref>()<sp/>+<sp/>32,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="secp256k1_8h_1af190f597732ce69f0829c40cda6854b8" kindref="member">secp256k1_ec_seckey_tweak_add</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*)keyChild.<ref refid="class_c_key_1a3f0e783949c4bbf1122b67f8b3e0c6b8" kindref="member">begin</ref>(),<sp/>vout.data());</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>)<sp/>keyChild.ClearKeyData();</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="310"><highlight class="normal">}</highlight></codeline>
<codeline lineno="311"><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><ref refid="struct_ell_swift_pub_key" kindref="compound">EllSwiftPubKey</ref><sp/><ref refid="class_c_key_1aaa51951a1ed98ba1e5b575f70c17a0e6" kindref="member">CKey::EllSwiftCreate</ref>(std::span&lt;const<sp/>std::byte&gt;<sp/>ent32)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="313"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(keydata);</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(ent32.size()<sp/>==<sp/>32);</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/>std::array&lt;std::byte,<sp/><ref refid="struct_ell_swift_pub_key_1a1b5d7e2e663d7997796fd9f72b8af75a" kindref="member">EllSwiftPubKey::size</ref>()&gt;<sp/>encoded_pubkey;</highlight></codeline>
<codeline lineno="317"><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>success<sp/>=<sp/><ref refid="secp256k1__ellswift_8h_1a4bc05874a6482805236e4e7eb69fa117" kindref="member">secp256k1_ellswift_create</ref>(secp256k1_context_sign,</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="span_8h_1ad150fa0b59e38198809cfce8d0d5d11d" kindref="member">UCharCast</ref>(encoded_pubkey.data()),</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>keydata-&gt;data(),</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="span_8h_1ad150fa0b59e38198809cfce8d0d5d11d" kindref="member">UCharCast</ref>(ent32.data()));</highlight></codeline>
<codeline lineno="322"><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Should<sp/>always<sp/>succeed<sp/>for<sp/>valid<sp/>keys<sp/>(asserted<sp/>above).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(success);</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{encoded_pubkey};</highlight></codeline>
<codeline lineno="326"><highlight class="normal">}</highlight></codeline>
<codeline lineno="327"><highlight class="normal"></highlight></codeline>
<codeline lineno="328"><highlight class="normal"><ref refid="key_8h_1ad7b25429fd258736677f9f9277e6bb8a" kindref="member">ECDHSecret</ref><sp/><ref refid="class_c_key_1a51daf36829a33c58aece705cb2f79cd8" kindref="member">CKey::ComputeBIP324ECDHSecret</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_ell_swift_pub_key" kindref="compound">EllSwiftPubKey</ref>&amp;<sp/>their_ellswift,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_ell_swift_pub_key" kindref="compound">EllSwiftPubKey</ref>&amp;<sp/>our_ellswift,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>initiating)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="329"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(keydata);</highlight></codeline>
<codeline lineno="331"><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="key_8h_1ad7b25429fd258736677f9f9277e6bb8a" kindref="member">ECDHSecret</ref><sp/>output;</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>BIP324<sp/>uses<sp/>the<sp/>initiator<sp/>as<sp/>party<sp/>A,<sp/>and<sp/>the<sp/>responder<sp/>as<sp/>party<sp/>B.<sp/>Remap<sp/>the<sp/>inputs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>accordingly:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>success<sp/>=<sp/><ref refid="secp256k1__ellswift_8h_1a6e4b9b088bcf1c76973af5c97040c4a1" kindref="member">secp256k1_ellswift_xdh</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="span_8h_1ad150fa0b59e38198809cfce8d0d5d11d" kindref="member">UCharCast</ref>(output.data()),</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="span_8h_1ad150fa0b59e38198809cfce8d0d5d11d" kindref="member">UCharCast</ref>(initiating<sp/>?<sp/>our_ellswift.<ref refid="struct_ell_swift_pub_key_1a79d691e4fa7d073b7c1809715933d8d1" kindref="member">data</ref>()<sp/>:<sp/>their_ellswift.<ref refid="struct_ell_swift_pub_key_1a79d691e4fa7d073b7c1809715933d8d1" kindref="member">data</ref>()),</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="span_8h_1ad150fa0b59e38198809cfce8d0d5d11d" kindref="member">UCharCast</ref>(initiating<sp/>?<sp/>their_ellswift.<ref refid="struct_ell_swift_pub_key_1a79d691e4fa7d073b7c1809715933d8d1" kindref="member">data</ref>()<sp/>:<sp/>our_ellswift.<ref refid="struct_ell_swift_pub_key_1a79d691e4fa7d073b7c1809715933d8d1" kindref="member">data</ref>()),</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>keydata-&gt;data(),</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>initiating<sp/>?<sp/>0<sp/>:<sp/>1,</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1__ellswift_8h_1ae7142918ae750a69e2b8105d9d25c10b" kindref="member">secp256k1_ellswift_xdh_hash_function_bip324</ref>,</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Should<sp/>always<sp/>succeed<sp/>for<sp/>valid<sp/>keys<sp/>(assert<sp/>above).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(success);</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>output;</highlight></codeline>
<codeline lineno="346"><highlight class="normal">}</highlight></codeline>
<codeline lineno="347"><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><ref refid="class_key_pair" kindref="compound">KeyPair</ref><sp/><ref refid="class_c_key_1a1989d2094d3ab2510b9f839a1ab05b34" kindref="member">CKey::ComputeKeyPair</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref>*<sp/>merkle_root)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="349"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>KeyPair(*</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>merkle_root);</highlight></codeline>
<codeline lineno="351"><highlight class="normal">}</highlight></codeline>
<codeline lineno="352"><highlight class="normal"></highlight></codeline>
<codeline lineno="353"><highlight class="normal">std::vector&lt;uint8_t&gt;<sp/><ref refid="class_c_key_1a9f8effa6c90983899312668a2268c99f" kindref="member">CKey::CreateMuSig2Nonce</ref>(<ref refid="class_mu_sig2_sec_nonce" kindref="compound">MuSig2SecNonce</ref>&amp;<sp/>secnonce,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref>&amp;<sp/>sighash,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_pub_key" kindref="compound">CPubKey</ref>&amp;<sp/>aggregate_pubkey,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::vector&lt;CPubKey&gt;&amp;<sp/>pubkeys)</highlight></codeline>
<codeline lineno="354"><highlight class="normal">{</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>keyagg<sp/>cache<sp/>and<sp/>aggregate<sp/>pubkey</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1__musig_8h_1ac649ade872dc56aa2320b74f169f0949" kindref="member">secp256k1_musig_keyagg_cache</ref><sp/>keyagg_cache;</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="musig_8cpp_1abeb828224f84045ca66600c7de7c172f" kindref="member">MuSig2AggregatePubkeys</ref>(pubkeys,<sp/>keyagg_cache,<sp/>aggregate_pubkey))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="358"><highlight class="normal"></highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Parse<sp/>participant<sp/>pubkey</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/>CPubKey<sp/>our_pubkey<sp/>=<sp/><ref refid="class_c_key_1a344311f57d0f0df0822c9fb04f66cf95" kindref="member">GetPubKey</ref>();</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8h_1a7d2fa05f2977d675bbcc274e911f16e6" kindref="member">secp256k1_pubkey</ref><sp/>pubkey;</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="secp256k1_8h_1a4e5dc8952c9a7e791376505ef2023ca1" kindref="member">secp256k1_ec_pubkey_parse</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>&amp;pubkey,<sp/>our_pubkey.<ref refid="class_c_pub_key_1a370225871d639f2fc9a3744b2a6e6128" kindref="member">data</ref>(),<sp/>our_pubkey.<ref refid="class_c_pub_key_1a69622a843a8c7f05bf706cf80fad6951" kindref="member">size</ref>()))<sp/>{</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="365"><highlight class="normal"></highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Generate<sp/>randomness<sp/>for<sp/>nonce</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/>uint256<sp/>rand;</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="random_8cpp_1a573a23ce1afe5405047d74faaafe7cbd" kindref="member">GetStrongRandBytes</ref>(rand);</highlight></codeline>
<codeline lineno="369"><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Generate<sp/>nonce</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1__musig_8h_1a840ebbf17cb525df609a556a9b535a5c" kindref="member">secp256k1_musig_pubnonce</ref><sp/>pubnonce;</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="secp256k1__musig_8h_1a7ec24f575d1e46794f3ce3532a03615b" kindref="member">secp256k1_musig_nonce_gen</ref>(secp256k1_context_sign,<sp/>secnonce.<ref refid="class_mu_sig2_sec_nonce_1ab2957f32805ff2bd549fe98e00e376af" kindref="member">Get</ref>(),<sp/>&amp;pubnonce,<sp/>rand.<ref refid="classbase__blob_1ad33ec60b8fc9ad7eef168e57aa6c5fb9" kindref="member">data</ref>(),<sp/><ref refid="span_8h_1ad150fa0b59e38198809cfce8d0d5d11d" kindref="member">UCharCast</ref>(<ref refid="class_c_key_1a3f0e783949c4bbf1122b67f8b3e0c6b8" kindref="member">begin</ref>()),<sp/>&amp;pubkey,<sp/>sighash.<ref refid="classbase__blob_1ad33ec60b8fc9ad7eef168e57aa6c5fb9" kindref="member">data</ref>(),<sp/>&amp;keyagg_cache,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="375"><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Serialize<sp/>pubnonce</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;uint8_t&gt;<sp/><ref refid="namespacetests__wycheproof__generate__ecdsa_1a4402d36d1c85ad1e0bdccb05af4d417f" kindref="member">out</ref>;</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespacetests__wycheproof__generate__ecdsa_1a4402d36d1c85ad1e0bdccb05af4d417f" kindref="member">out</ref>.resize(<ref refid="musig_8h_1a4e0153b3f51a3a0cd42dbf0ad0b24b1a" kindref="member">MUSIG2_PUBNONCE_SIZE</ref>);</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="secp256k1__musig_8h_1ae80450048d95054d60611dd5cce349b5" kindref="member">secp256k1_musig_pubnonce_serialize</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/><ref refid="namespacetests__wycheproof__generate__ecdsa_1a4402d36d1c85ad1e0bdccb05af4d417f" kindref="member">out</ref>.data(),<sp/>&amp;pubnonce))<sp/>{</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="382"><highlight class="normal"></highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespacetests__wycheproof__generate__ecdsa_1a4402d36d1c85ad1e0bdccb05af4d417f" kindref="member">out</ref>;</highlight></codeline>
<codeline lineno="384"><highlight class="normal">}</highlight></codeline>
<codeline lineno="385"><highlight class="normal"></highlight></codeline>
<codeline lineno="386"><highlight class="normal">std::optional&lt;uint256&gt;<sp/><ref refid="class_c_key_1a88514aca46316a04e95dfce4ec209d68" kindref="member">CKey::CreateMuSig2PartialSig</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref>&amp;<sp/>sighash,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_pub_key" kindref="compound">CPubKey</ref>&amp;<sp/>aggregate_pubkey,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::vector&lt;CPubKey&gt;&amp;<sp/>pubkeys,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::map&lt;<ref refid="class_c_pub_key" kindref="compound">CPubKey</ref>,<sp/>std::vector&lt;uint8_t&gt;&gt;&amp;<sp/>pubnonces,<sp/><ref refid="class_mu_sig2_sec_nonce" kindref="compound">MuSig2SecNonce</ref>&amp;<sp/>secnonce,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::vector&lt;std::pair&lt;uint256,<sp/>bool&gt;&gt;&amp;<sp/>tweaks)</highlight></codeline>
<codeline lineno="387"><highlight class="normal">{</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1__extrakeys_8h_1ad8d14ec4a23d43f16eb45e216c414a9b" kindref="member">secp256k1_keypair</ref><sp/>keypair;</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="secp256k1__extrakeys_8h_1a61b1362ada2435ab10240e52ff738476" kindref="member">secp256k1_keypair_create</ref>(secp256k1_context_sign,<sp/>&amp;keypair,<sp/><ref refid="span_8h_1ad150fa0b59e38198809cfce8d0d5d11d" kindref="member">UCharCast</ref>(<ref refid="class_c_key_1a3f0e783949c4bbf1122b67f8b3e0c6b8" kindref="member">begin</ref>())))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="390"><highlight class="normal"></highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>keyagg<sp/>cache<sp/>and<sp/>aggregate<sp/>pubkey</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1__musig_8h_1ac649ade872dc56aa2320b74f169f0949" kindref="member">secp256k1_musig_keyagg_cache</ref><sp/>keyagg_cache;</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="musig_8cpp_1abeb828224f84045ca66600c7de7c172f" kindref="member">MuSig2AggregatePubkeys</ref>(pubkeys,<sp/>keyagg_cache,<sp/>aggregate_pubkey))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="394"><highlight class="normal"></highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>there<sp/>are<sp/>enough<sp/>pubnonces</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pubnonces.size()<sp/>!=<sp/>pubkeys.size())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="397"><highlight class="normal"></highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Parse<sp/>the<sp/>pubnonces</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;std::pair&lt;secp256k1_pubkey,<sp/>secp256k1_musig_pubnonce&gt;&gt;<sp/>signers_data;</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;const<sp/>secp256k1_musig_pubnonce*&gt;<sp/>pubnonce_ptrs;</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/>std::optional&lt;size_t&gt;<sp/>our_pubkey_idx;</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/>CPubKey<sp/>our_pubkey<sp/>=<sp/><ref refid="class_c_key_1a344311f57d0f0df0822c9fb04f66cf95" kindref="member">GetPubKey</ref>();</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>CPubKey&amp;<sp/>part_pk<sp/>:<sp/>pubkeys)<sp/>{</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>pn_it<sp/>=<sp/>pubnonces.find(part_pk);</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pn_it<sp/>==<sp/>pubnonces.end())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::vector&lt;uint8_t&gt;<sp/>pubnonce<sp/>=<sp/>pn_it-&gt;second;</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pubnonce.size()<sp/>!=<sp/><ref refid="musig_8h_1a4e0153b3f51a3a0cd42dbf0ad0b24b1a" kindref="member">MUSIG2_PUBNONCE_SIZE</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(part_pk<sp/>==<sp/>our_pubkey)<sp/>{</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>our_pubkey_idx<sp/>=<sp/>signers_data.size();</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="411"><highlight class="normal"></highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>[secp_pk,<sp/>secp_pn]<sp/>=<sp/>signers_data.emplace_back();</highlight></codeline>
<codeline lineno="413"><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="secp256k1_8h_1a4e5dc8952c9a7e791376505ef2023ca1" kindref="member">secp256k1_ec_pubkey_parse</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>&amp;secp_pk,<sp/>part_pk.data(),<sp/>part_pk.size()))<sp/>{</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="417"><highlight class="normal"></highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="secp256k1__musig_8h_1a31ed1d14cfc4aeea471e7949364576d2" kindref="member">secp256k1_musig_pubnonce_parse</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>&amp;secp_pn,<sp/>pubnonce.data()))<sp/>{</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(our_pubkey_idx<sp/>==<sp/>std::nullopt)<sp/>{</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/>pubnonce_ptrs.reserve(signers_data.size());</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>[<ref refid="translation_8h_1a4f2d958035f4051a605124ebe248de38" kindref="member">_</ref>,<sp/>pn]<sp/>:<sp/>signers_data)<sp/>{</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pubnonce_ptrs.push_back(&amp;pn);</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="429"><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Aggregate<sp/>nonces</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1__musig_8h_1a2770ea8cc9fe29b4ad76f5ef7a046d1e" kindref="member">secp256k1_musig_aggnonce</ref><sp/>aggnonce;</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="secp256k1__musig_8h_1a32c50c1197c2e1c817893b037cd8d721" kindref="member">secp256k1_musig_nonce_agg</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>&amp;aggnonce,<sp/>pubnonce_ptrs.data(),<sp/>pubnonce_ptrs.size()))<sp/>{</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="435"><highlight class="normal"></highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Apply<sp/>tweaks</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>[tweak,<sp/>xonly]<sp/>:<sp/>tweaks)<sp/>{</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(xonly)<sp/>{</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="secp256k1__musig_8h_1a10a46b293f9744518c660bcbc8775db1" kindref="member">secp256k1_musig_pubkey_xonly_tweak_add</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/>&amp;keyagg_cache,<sp/>tweak.data()))<sp/>{</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="secp256k1__musig_8h_1a01eeb0d31dee13d208245a478b777d9c" kindref="member">secp256k1_musig_pubkey_ec_tweak_add</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/>&amp;keyagg_cache,<sp/>tweak.data()))<sp/>{</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="446"><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>musig_session</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1__musig_8h_1a195f9c320f8c373400c5b5c789a35941" kindref="member">secp256k1_musig_session</ref><sp/>session;</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="secp256k1__musig_8h_1ae2294b047f341afacce48e9f9a509f11" kindref="member">secp256k1_musig_nonce_process</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>&amp;session,<sp/>&amp;aggnonce,<sp/>sighash.<ref refid="classbase__blob_1ad33ec60b8fc9ad7eef168e57aa6c5fb9" kindref="member">data</ref>(),<sp/>&amp;keyagg_cache))<sp/>{</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="452"><highlight class="normal"></highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>partial<sp/>signature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1__musig_8h_1a7958289e96ef90b230e3f31fc8405ea8" kindref="member">secp256k1_musig_partial_sig</ref><sp/>psig;</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="secp256k1__musig_8h_1a37c235ba487df277f97464708c06f98e" kindref="member">secp256k1_musig_partial_sign</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>&amp;psig,<sp/>secnonce.<ref refid="class_mu_sig2_sec_nonce_1ab2957f32805ff2bd549fe98e00e376af" kindref="member">Get</ref>(),<sp/>&amp;keypair,<sp/>&amp;keyagg_cache,<sp/>&amp;session))<sp/>{</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>secnonce<sp/>must<sp/>be<sp/>deleted<sp/>after<sp/>signing<sp/>to<sp/>prevent<sp/>nonce<sp/>reuse.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/>secnonce.<ref refid="class_mu_sig2_sec_nonce_1ab9adfea0e765ab447b8ce7730a6cd812" kindref="member">Invalidate</ref>();</highlight></codeline>
<codeline lineno="460"><highlight class="normal"></highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Verify<sp/>partial<sp/>signature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="secp256k1__musig_8h_1a94cce9a0b321047ba1f341bc8f3f8ee3" kindref="member">secp256k1_musig_partial_sig_verify</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>&amp;psig,<sp/>&amp;(signers_data.at(*our_pubkey_idx).second),<sp/>&amp;(signers_data.at(*our_pubkey_idx).first),<sp/>&amp;keyagg_cache,<sp/>&amp;session))<sp/>{</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="465"><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Serialize</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/>uint256<sp/>sig;</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="secp256k1__musig_8h_1a828f4076c9b7d44f7b243a6d6df8c962" kindref="member">secp256k1_musig_partial_sig_serialize</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>sig.<ref refid="classbase__blob_1ad33ec60b8fc9ad7eef168e57aa6c5fb9" kindref="member">data</ref>(),<sp/>&amp;psig))<sp/>{</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="471"><highlight class="normal"></highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>sig;</highlight></codeline>
<codeline lineno="473"><highlight class="normal">}</highlight></codeline>
<codeline lineno="474"><highlight class="normal"></highlight></codeline>
<codeline lineno="475"><highlight class="normal"><ref refid="class_c_key" kindref="compound">CKey</ref><sp/><ref refid="key_8cpp_1aeb5c90c6e6a817f5ed4876d9722ae37f" kindref="member">GenerateRandomKey</ref>(</highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>compressed)<sp/></highlight><highlight class="keyword">noexcept</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="476"><highlight class="normal">{</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_key" kindref="compound">CKey</ref><sp/>key;</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/>key.<ref refid="class_c_key_1a4c2b881159b01dacff86884fa2a7b7ff" kindref="member">MakeNewKey</ref>(</highlight><highlight class="comment">/*fCompressed=*/</highlight><highlight class="normal">compressed);</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>key;</highlight></codeline>
<codeline lineno="480"><highlight class="normal">}</highlight></codeline>
<codeline lineno="481"><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="struct_c_ext_key_1aaab27584ce32960d7a5e0b9010e5ad42" kindref="member">CExtKey::Derive</ref>(<ref refid="struct_c_ext_key" kindref="compound">CExtKey</ref><sp/>&amp;out,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>_nChild)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="struct_c_ext_key_1a9501efdc906c0551e559b38433f5cf84" kindref="member">nDepth</ref><sp/>==<sp/>std::numeric_limits&lt;unsigned<sp/>char&gt;::max())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespacetests__wycheproof__generate__ecdsa_1a4402d36d1c85ad1e0bdccb05af4d417f" kindref="member">out</ref>.nDepth<sp/>=<sp/><ref refid="struct_c_ext_key_1a9501efdc906c0551e559b38433f5cf84" kindref="member">nDepth</ref><sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/>CKeyID<sp/></highlight><highlight class="keywordtype">id</highlight><highlight class="normal"><sp/>=<sp/><ref refid="struct_c_ext_key_1a8d350ff361690ac2a2db267f5ea63dc9" kindref="member">key</ref>.GetPubKey().GetID();</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(<ref refid="namespacetests__wycheproof__generate__ecdsa_1a4402d36d1c85ad1e0bdccb05af4d417f" kindref="member">out</ref>.vchFingerprint,<sp/>&amp;</highlight><highlight class="keywordtype">id</highlight><highlight class="normal">,<sp/>4);</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespacetests__wycheproof__generate__ecdsa_1a4402d36d1c85ad1e0bdccb05af4d417f" kindref="member">out</ref>.nChild<sp/>=<sp/>_nChild;</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="struct_c_ext_key_1a8d350ff361690ac2a2db267f5ea63dc9" kindref="member">key</ref>.Derive(<ref refid="namespacetests__wycheproof__generate__ecdsa_1a4402d36d1c85ad1e0bdccb05af4d417f" kindref="member">out</ref>.key,<sp/><ref refid="namespacetests__wycheproof__generate__ecdsa_1a4402d36d1c85ad1e0bdccb05af4d417f" kindref="member">out</ref>.chaincode,<sp/>_nChild,<sp/><ref refid="struct_c_ext_key_1ada41f125a490502b4eb9c43cecbd73c6" kindref="member">chaincode</ref>);</highlight></codeline>
<codeline lineno="489"><highlight class="normal">}</highlight></codeline>
<codeline lineno="490"><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="struct_c_ext_key_1a9649c8c3d583657dc347ad986a4a96d6" kindref="member">CExtKey::SetSeed</ref>(std::span&lt;const<sp/>std::byte&gt;<sp/>seed)</highlight></codeline>
<codeline lineno="492"><highlight class="normal">{</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>hashkey[]<sp/>=<sp/>{</highlight><highlight class="charliteral">&apos;B&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;i&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;t&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;c&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;o&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;i&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;n&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;s&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;e&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;e&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;d&apos;</highlight><highlight class="normal">};</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;unsigned<sp/>char,<sp/>secure_allocator&lt;unsigned<sp/>char&gt;&gt;<sp/>vout(64);</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/>CHMAC_SHA512{hashkey,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(hashkey)}.Write(<ref refid="span_8h_1ad150fa0b59e38198809cfce8d0d5d11d" kindref="member">UCharCast</ref>(seed.data()),<sp/>seed.size()).Finalize(vout.data());</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_c_ext_key_1a8d350ff361690ac2a2db267f5ea63dc9" kindref="member">key</ref>.Set(vout.data(),<sp/>vout.data()<sp/>+<sp/>32,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(<ref refid="struct_c_ext_key_1ada41f125a490502b4eb9c43cecbd73c6" kindref="member">chaincode</ref>.begin(),<sp/>vout.data()<sp/>+<sp/>32,<sp/>32);</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_c_ext_key_1a9501efdc906c0551e559b38433f5cf84" kindref="member">nDepth</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_c_ext_key_1a5d55b30f5f8d50f9a9b3c7040883e31d" kindref="member">nChild</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(<ref refid="struct_c_ext_key_1ab4bdb62b8e53b8e251facdead293c290" kindref="member">vchFingerprint</ref>,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="struct_c_ext_key_1ab4bdb62b8e53b8e251facdead293c290" kindref="member">vchFingerprint</ref>));</highlight></codeline>
<codeline lineno="501"><highlight class="normal">}</highlight></codeline>
<codeline lineno="502"><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"><ref refid="struct_c_ext_pub_key" kindref="compound">CExtPubKey</ref><sp/><ref refid="struct_c_ext_key_1a55d751174f830d940ca3660b80f87820" kindref="member">CExtKey::Neuter</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/>CExtPubKey<sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>.<ref refid="struct_c_ext_pub_key_1a9501efdc906c0551e559b38433f5cf84" kindref="member">nDepth</ref><sp/>=<sp/><ref refid="struct_c_ext_key_1a9501efdc906c0551e559b38433f5cf84" kindref="member">nDepth</ref>;</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>.vchFingerprint,<sp/><ref refid="struct_c_ext_key_1ab4bdb62b8e53b8e251facdead293c290" kindref="member">vchFingerprint</ref>,<sp/>4);</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>.nChild<sp/>=<sp/><ref refid="struct_c_ext_key_1a5d55b30f5f8d50f9a9b3c7040883e31d" kindref="member">nChild</ref>;</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>.pubkey<sp/>=<sp/><ref refid="struct_c_ext_key_1a8d350ff361690ac2a2db267f5ea63dc9" kindref="member">key</ref>.GetPubKey();</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>.chaincode<sp/>=<sp/><ref refid="struct_c_ext_key_1ada41f125a490502b4eb9c43cecbd73c6" kindref="member">chaincode</ref>;</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="511"><highlight class="normal">}</highlight></codeline>
<codeline lineno="512"><highlight class="normal"></highlight></codeline>
<codeline lineno="513"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="struct_c_ext_key_1af3dee6e6a820bdabad39ffbe273663fa" kindref="member">CExtKey::Encode</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>code[<ref refid="pubkey_8h_1a702db985212b196f8243268bc752c8ec" kindref="member">BIP32_EXTKEY_SIZE</ref>])</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/>code[0]<sp/>=<sp/><ref refid="struct_c_ext_key_1a9501efdc906c0551e559b38433f5cf84" kindref="member">nDepth</ref>;</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(code+1,<sp/><ref refid="struct_c_ext_key_1ab4bdb62b8e53b8e251facdead293c290" kindref="member">vchFingerprint</ref>,<sp/>4);</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="crypto_2common_8h_1a61710c1fb467677ea004c83f207235f6" kindref="member">WriteBE32</ref>(code+5,<sp/><ref refid="struct_c_ext_key_1a5d55b30f5f8d50f9a9b3c7040883e31d" kindref="member">nChild</ref>);</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(code+9,<sp/><ref refid="struct_c_ext_key_1ada41f125a490502b4eb9c43cecbd73c6" kindref="member">chaincode</ref>.begin(),<sp/>32);</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/>code[41]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="struct_c_ext_key_1a8d350ff361690ac2a2db267f5ea63dc9" kindref="member">key</ref>.size()<sp/>==<sp/>32);</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(code+42,<sp/><ref refid="struct_c_ext_key_1a8d350ff361690ac2a2db267f5ea63dc9" kindref="member">key</ref>.begin(),<sp/>32);</highlight></codeline>
<codeline lineno="521"><highlight class="normal">}</highlight></codeline>
<codeline lineno="522"><highlight class="normal"></highlight></codeline>
<codeline lineno="523"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="struct_c_ext_key_1ae5159995ca1c2f638679bef07adcbf48" kindref="member">CExtKey::Decode</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>code[<ref refid="pubkey_8h_1a702db985212b196f8243268bc752c8ec" kindref="member">BIP32_EXTKEY_SIZE</ref>])<sp/>{</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_c_ext_key_1a9501efdc906c0551e559b38433f5cf84" kindref="member">nDepth</ref><sp/>=<sp/>code[0];</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(<ref refid="struct_c_ext_key_1ab4bdb62b8e53b8e251facdead293c290" kindref="member">vchFingerprint</ref>,<sp/>code+1,<sp/>4);</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_c_ext_key_1a5d55b30f5f8d50f9a9b3c7040883e31d" kindref="member">nChild</ref><sp/>=<sp/><ref refid="crypto_2common_8h_1ae34e43528bdaaf18b35710e52ba493d5" kindref="member">ReadBE32</ref>(code+5);</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(<ref refid="struct_c_ext_key_1ada41f125a490502b4eb9c43cecbd73c6" kindref="member">chaincode</ref>.begin(),<sp/>code+9,<sp/>32);</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_c_ext_key_1a8d350ff361690ac2a2db267f5ea63dc9" kindref="member">key</ref>.Set(code+42,<sp/>code+<ref refid="pubkey_8h_1a702db985212b196f8243268bc752c8ec" kindref="member">BIP32_EXTKEY_SIZE</ref>,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((<ref refid="struct_c_ext_key_1a9501efdc906c0551e559b38433f5cf84" kindref="member">nDepth</ref><sp/>==<sp/>0<sp/>&amp;&amp;<sp/>(<ref refid="struct_c_ext_key_1a5d55b30f5f8d50f9a9b3c7040883e31d" kindref="member">nChild</ref><sp/>!=<sp/>0<sp/>||<sp/><ref refid="crypto_2common_8h_1a4f1b9effec884b448085452b138aee10" kindref="member">ReadLE32</ref>(<ref refid="struct_c_ext_key_1ab4bdb62b8e53b8e251facdead293c290" kindref="member">vchFingerprint</ref>)<sp/>!=<sp/>0))<sp/>||<sp/>code[41]<sp/>!=<sp/>0)<sp/><ref refid="struct_c_ext_key_1a8d350ff361690ac2a2db267f5ea63dc9" kindref="member">key</ref><sp/>=<sp/>CKey();</highlight></codeline>
<codeline lineno="530"><highlight class="normal">}</highlight></codeline>
<codeline lineno="531"><highlight class="normal"></highlight></codeline>
<codeline lineno="532"><highlight class="normal"><ref refid="class_key_pair_1a06d884bd9456c0b3699cfbcf44ab99e5" kindref="member">KeyPair::KeyPair</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="class_c_key" kindref="compound">CKey</ref>&amp;<sp/>key,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref>*<sp/>merkle_root)</highlight></codeline>
<codeline lineno="533"><highlight class="normal">{</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_assert</highlight><highlight class="normal">(std::tuple_size&lt;KeyType&gt;()<sp/>==<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="secp256k1__extrakeys_8h_1ad8d14ec4a23d43f16eb45e216c414a9b" kindref="member">secp256k1_keypair</ref>));</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/>MakeKeyPairData();</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>keypair<sp/>=<sp/></highlight><highlight class="keyword">reinterpret_cast&lt;</highlight><highlight class="normal"><ref refid="secp256k1__extrakeys_8h_1ad8d14ec4a23d43f16eb45e216c414a9b" kindref="member">secp256k1_keypair</ref>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(m_keypair-&gt;data());</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>success<sp/>=<sp/><ref refid="secp256k1__extrakeys_8h_1a61b1362ada2435ab10240e52ff738476" kindref="member">secp256k1_keypair_create</ref>(secp256k1_context_sign,<sp/>keypair,<sp/><ref refid="span_8h_1ad150fa0b59e38198809cfce8d0d5d11d" kindref="member">UCharCast</ref>(key.<ref refid="class_c_key_1a79d691e4fa7d073b7c1809715933d8d1" kindref="member">data</ref>()));</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(success<sp/>&amp;&amp;<sp/>merkle_root)<sp/>{</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1__extrakeys_8h_1a0868e774c9b0692ede20b4ce2a7d2a85" kindref="member">secp256k1_xonly_pubkey</ref><sp/>pubkey;</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>pubkey_bytes[32];</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="secp256k1__extrakeys_8h_1a96800411deb08bb3b6b0876fea6f6eb4" kindref="member">secp256k1_keypair_xonly_pub</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>&amp;pubkey,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/>keypair));</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="secp256k1__extrakeys_8h_1a455e86be0f18f4313ba8ea73e34a25a6" kindref="member">secp256k1_xonly_pubkey_serialize</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>pubkey_bytes,<sp/>&amp;pubkey));</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint256<sp/>tweak<sp/>=<sp/>XOnlyPubKey(pubkey_bytes).ComputeTapTweakHash(merkle_root-&gt;<ref refid="classbase__blob_1a067b44b9f2bd293d8a93401655e6476e" kindref="member">IsNull</ref>()<sp/>?<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal"><sp/>:<sp/>merkle_root);</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>success<sp/>=<sp/><ref refid="secp256k1__extrakeys_8h_1aa99a68bfe473704d08eac556915883b6" kindref="member">secp256k1_keypair_xonly_tweak_add</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>keypair,<sp/>tweak.<ref refid="classbase__blob_1ad33ec60b8fc9ad7eef168e57aa6c5fb9" kindref="member">data</ref>());</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!success)<sp/>ClearKeyPairData();</highlight></codeline>
<codeline lineno="547"><highlight class="normal">}</highlight></codeline>
<codeline lineno="548"><highlight class="normal"></highlight></codeline>
<codeline lineno="549"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="class_key_pair_1a14c5a153a3cb50e0cdf4bf244771fe24" kindref="member">KeyPair::SignSchnorr</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref>&amp;<sp/>hash,<sp/>std::span&lt;unsigned<sp/>char&gt;<sp/>sig,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classuint256" kindref="compound">uint256</ref>&amp;<sp/>aux)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="550"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(sig.size()<sp/>==<sp/>64);</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="class_key_pair_1ac532c4b500b1a85ea22217f2c65a70ed" kindref="member">IsValid</ref>())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>keypair<sp/>=<sp/></highlight><highlight class="keyword">reinterpret_cast&lt;</highlight><highlight class="keyword">const<sp/></highlight><highlight class="normal"><ref refid="secp256k1__extrakeys_8h_1ad8d14ec4a23d43f16eb45e216c414a9b" kindref="member">secp256k1_keypair</ref>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(m_keypair-&gt;data());</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="secp256k1__schnorrsig_8h_1a562fe7745d3c285d64ef8b88ab70d7e1" kindref="member">secp256k1_schnorrsig_sign32</ref>(secp256k1_context_sign,<sp/>sig.data(),<sp/>hash.<ref refid="classbase__blob_1ad33ec60b8fc9ad7eef168e57aa6c5fb9" kindref="member">data</ref>(),<sp/>keypair,<sp/>aux.<ref refid="classbase__blob_1ad33ec60b8fc9ad7eef168e57aa6c5fb9" kindref="member">data</ref>());</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>)<sp/>{</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Additional<sp/>verification<sp/>step<sp/>to<sp/>prevent<sp/>using<sp/>a<sp/>potentially<sp/>corrupted<sp/>signature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1__extrakeys_8h_1a0868e774c9b0692ede20b4ce2a7d2a85" kindref="member">secp256k1_xonly_pubkey</ref><sp/>pubkey_verify;</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="secp256k1__extrakeys_8h_1a96800411deb08bb3b6b0876fea6f6eb4" kindref="member">secp256k1_keypair_xonly_pub</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>&amp;pubkey_verify,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/>keypair);</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>&amp;=<sp/><ref refid="secp256k1__schnorrsig_8h_1ad8c9ecde1b1b561bb0a864ef307a48cb" kindref="member">secp256k1_schnorrsig_verify</ref>(<ref refid="secp256k1_8h_1a9254966d2821ffb7bf204fb31a6e0ad7" kindref="member">secp256k1_context_static</ref>,<sp/>sig.data(),<sp/>hash.<ref refid="classbase__blob_1a899a629fc7846994a3bbd28ba2777243" kindref="member">begin</ref>(),<sp/>32,<sp/>&amp;pubkey_verify);</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>)<sp/><ref refid="cleanse_8cpp_1a5a4afb85dd16ecc1f6019c782db78663" kindref="member">memory_cleanse</ref>(sig.data(),<sp/>sig.size());</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="563"><highlight class="normal">}</highlight></codeline>
<codeline lineno="564"><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="key_8cpp_1adc8d142f5bcd2ca6646462fb45a7945d" kindref="member">ECC_InitSanityCheck</ref>()<sp/>{</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_key" kindref="compound">CKey</ref><sp/>key<sp/>=<sp/><ref refid="key_8cpp_1aeb5c90c6e6a817f5ed4876d9722ae37f" kindref="member">GenerateRandomKey</ref>();</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_c_pub_key" kindref="compound">CPubKey</ref><sp/>pubkey<sp/>=<sp/>key.<ref refid="class_c_key_1a344311f57d0f0df0822c9fb04f66cf95" kindref="member">GetPubKey</ref>();</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>key.<ref refid="class_c_key_1ad7a34331f4b6972a38928b176038ef75" kindref="member">VerifyPubKey</ref>(pubkey);</highlight></codeline>
<codeline lineno="569"><highlight class="normal">}</highlight></codeline>
<codeline lineno="570"><highlight class="normal"></highlight></codeline>
<codeline lineno="572"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>ECC_Start()<sp/>{</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(secp256k1_context_sign<sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="574"><highlight class="normal"></highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref><sp/>*ctx<sp/>=<sp/><ref refid="secp256k1_8h_1a3aaa9fcc3ab67bc8f841779a049069c5" kindref="member">secp256k1_context_create</ref>(<ref refid="secp256k1_8h_1a4f7b286aa714c2e0fb279c180f67e9b3" kindref="member">SECP256K1_CONTEXT_NONE</ref>);</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(ctx<sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="577"><highlight class="normal"></highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Pass<sp/>in<sp/>a<sp/>random<sp/>blinding<sp/>seed<sp/>to<sp/>the<sp/>secp256k1<sp/>context.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;unsigned<sp/>char,<sp/>secure_allocator&lt;unsigned<sp/>char&gt;&gt;<sp/>vseed(32);</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="random_8cpp_1ab12e884f2063117fd7ae32b213b83175" kindref="member">GetRandBytes</ref>(vseed);</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="secp256k1_8h_1a1b81d70feb6ed24dc902cbbd5ba569e7" kindref="member">secp256k1_context_randomize</ref>(ctx,<sp/>vseed.data());</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="585"><highlight class="normal"></highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_context_sign<sp/>=<sp/>ctx;</highlight></codeline>
<codeline lineno="587"><highlight class="normal">}</highlight></codeline>
<codeline lineno="588"><highlight class="normal"></highlight></codeline>
<codeline lineno="590"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>ECC_Stop()<sp/>{</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref><sp/>*ctx<sp/>=<sp/>secp256k1_context_sign;</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_context_sign<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="593"><highlight class="normal"></highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ctx)<sp/>{</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1_8h_1a026db914e3723531825ecf25a0cbd699" kindref="member">secp256k1_context_destroy</ref>(ctx);</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="597"><highlight class="normal">}</highlight></codeline>
<codeline lineno="598"><highlight class="normal"></highlight></codeline>
<codeline lineno="599"><highlight class="normal"><ref refid="class_e_c_c___context_1aa8a3c2b962529f065986843181de601a" kindref="member">ECC_Context::ECC_Context</ref>()</highlight></codeline>
<codeline lineno="600"><highlight class="normal">{</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/>ECC_Start();</highlight></codeline>
<codeline lineno="602"><highlight class="normal">}</highlight></codeline>
<codeline lineno="603"><highlight class="normal"></highlight></codeline>
<codeline lineno="604"><highlight class="normal"><ref refid="class_e_c_c___context_1a221f7cbdfc7397fb3fd868b5ce9e1a9e" kindref="member">ECC_Context::~ECC_Context</ref>()</highlight></codeline>
<codeline lineno="605"><highlight class="normal">{</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/>ECC_Stop();</highlight></codeline>
<codeline lineno="607"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="src/key.cpp"/>
  </compounddef>
</doxygen>
