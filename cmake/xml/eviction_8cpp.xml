<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="eviction_8cpp" kind="file" language="C++">
    <compoundname>eviction.cpp</compoundname>
    <includes refid="eviction_8h" local="no">node/eviction.h</includes>
    <includes local="no">algorithm</includes>
    <includes local="no">array</includes>
    <includes local="no">chrono</includes>
    <includes local="no">cstdint</includes>
    <includes local="no">functional</includes>
    <includes local="no">map</includes>
    <includes local="no">vector</includes>
    <incdepgraph>
      <node id="54">
        <label>attributes.h</label>
        <link refid="attributes_8h"/>
      </node>
      <node id="60">
        <label>compat/assumptions.h</label>
        <link refid="compat_2assumptions_8h"/>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
      </node>
      <node id="37">
        <label>compat/byteswap.h</label>
        <link refid="byteswap_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
      </node>
      <node id="8">
        <label>compat/compat.h</label>
        <link refid="compat_8h"/>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
      </node>
      <node id="36">
        <label>compat/endian.h</label>
        <link refid="endian_8h"/>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
      </node>
      <node id="34">
        <label>crypto/chacha20.h</label>
        <link refid="chacha20_8h"/>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
      </node>
      <node id="35">
        <label>crypto/common.h</label>
        <link refid="crypto_2common_8h"/>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="43">
        <label>crypto/hex_base.h</label>
        <link refid="hex__base_8h"/>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="21">
        <label>crypto/siphash.h</label>
        <link refid="siphash_8h"/>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="6">
        <label>net_permissions.h</label>
        <link refid="net__permissions_8h"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="67" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
      </node>
      <node id="7">
        <label>netaddress.h</label>
        <link refid="netaddress_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="65" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
      </node>
      <node id="67">
        <label>netbase.h</label>
        <link refid="netbase_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="68" relation="include">
        </childnode>
        <childnode refid="72" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="80" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
      </node>
      <node id="3">
        <label>node/connection_types.h</label>
        <link refid="connection__types_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>src/node/eviction.cpp</label>
        <link refid="eviction_8cpp"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>node/eviction.h</label>
        <link refid="eviction_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
      </node>
      <node id="24">
        <label>prevector.h</label>
        <link refid="prevector_8h"/>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
      </node>
      <node id="33">
        <label>random.h</label>
        <link refid="random_8h"/>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
      </node>
      <node id="59">
        <label>serialize.h</label>
        <link refid="serialize_8h"/>
        <childnode refid="54" relation="include">
        </childnode>
        <childnode refid="60" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
      </node>
      <node id="40">
        <label>span.h</label>
        <link refid="span_8h"/>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
      </node>
      <node id="73">
        <label>sync.h</label>
        <link refid="sync_8h"/>
        <childnode refid="74" relation="include">
        </childnode>
        <childnode refid="76" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="77" relation="include">
        </childnode>
        <childnode refid="75" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="78" relation="include">
        </childnode>
      </node>
      <node id="74">
        <label>threadsafety.h</label>
        <link refid="threadsafety_8h"/>
        <childnode refid="75" relation="include">
        </childnode>
      </node>
      <node id="65">
        <label>tinyformat.h</label>
        <link refid="tinyformat_8h"/>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="54" relation="include">
        </childnode>
        <childnode refid="66" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
      </node>
      <node id="41">
        <label>uint256.h</label>
        <link refid="uint256_8h"/>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
      </node>
      <node id="53">
        <label>util/check.h</label>
        <link refid="check_8h"/>
        <childnode refid="54" relation="include">
        </childnode>
        <childnode refid="55" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="56" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
      </node>
      <node id="76">
        <label>util/macros.h</label>
        <link refid="macros_8h"/>
      </node>
      <node id="68">
        <label>util/sock.h</label>
        <link refid="sock_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="69" relation="include">
        </childnode>
        <childnode refid="70" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="71" relation="include">
        </childnode>
      </node>
      <node id="42">
        <label>util/strencodings.h</label>
        <link refid="strencodings_8h"/>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="49" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
      </node>
      <node id="44">
        <label>util/string.h</label>
        <link refid="string_8h"/>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
      </node>
      <node id="72">
        <label>util/threadinterrupt.h</label>
        <link refid="util_2threadinterrupt_8h"/>
        <childnode refid="73" relation="include">
        </childnode>
        <childnode refid="74" relation="include">
        </childnode>
        <childnode refid="55" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="77" relation="include">
        </childnode>
      </node>
      <node id="25">
        <label>algorithm</label>
      </node>
      <node id="9">
        <label>arpa/inet.h</label>
      </node>
      <node id="22">
        <label>array</label>
      </node>
      <node id="55">
        <label>atomic</label>
      </node>
      <node id="38">
        <label>bit</label>
      </node>
      <node id="26">
        <label>cassert</label>
      </node>
      <node id="20">
        <label>cerrno</label>
      </node>
      <node id="49">
        <label>charconv</label>
      </node>
      <node id="58">
        <label>chrono</label>
      </node>
      <node id="39">
        <label>concepts</label>
      </node>
      <node id="77">
        <label>condition_variable</label>
      </node>
      <node id="27">
        <label>cstddef</label>
      </node>
      <node id="4">
        <label>cstdint</label>
      </node>
      <node id="28">
        <label>cstdlib</label>
      </node>
      <node id="29">
        <label>cstring</label>
      </node>
      <node id="10">
        <label>fcntl.h</label>
      </node>
      <node id="79">
        <label>functional</label>
      </node>
      <node id="61">
        <label>ios</label>
      </node>
      <node id="66">
        <label>iostream</label>
      </node>
      <node id="30">
        <label>iterator</label>
      </node>
      <node id="50">
        <label>limits</label>
      </node>
      <node id="45">
        <label>locale</label>
      </node>
      <node id="62">
        <label>map</label>
      </node>
      <node id="63">
        <label>memory</label>
      </node>
      <node id="75">
        <label>mutex</label>
      </node>
      <node id="11">
        <label>net/if.h</label>
      </node>
      <node id="12">
        <label>netdb.h</label>
      </node>
      <node id="13">
        <label>netinet/in.h</label>
      </node>
      <node id="14">
        <label>netinet/tcp.h</label>
      </node>
      <node id="51">
        <label>optional</label>
      </node>
      <node id="64">
        <label>set</label>
      </node>
      <node id="56">
        <label>source_location</label>
      </node>
      <node id="23">
        <label>span</label>
      </node>
      <node id="46">
        <label>sstream</label>
      </node>
      <node id="57">
        <label>stdexcept</label>
      </node>
      <node id="5">
        <label>string</label>
      </node>
      <node id="47">
        <label>string_view</label>
      </node>
      <node id="15">
        <label>sys/mman.h</label>
      </node>
      <node id="16">
        <label>sys/select.h</label>
      </node>
      <node id="17">
        <label>sys/socket.h</label>
      </node>
      <node id="18">
        <label>sys/types.h</label>
      </node>
      <node id="52">
        <label>system_error</label>
      </node>
      <node id="78">
        <label>thread</label>
      </node>
      <node id="31">
        <label>type_traits</label>
      </node>
      <node id="19">
        <label>unistd.h</label>
      </node>
      <node id="71">
        <label>unordered_map</label>
      </node>
      <node id="80">
        <label>unordered_set</label>
      </node>
      <node id="69">
        <label>util/threadinterrupt.h</label>
      </node>
      <node id="70">
        <label>util/time.h</label>
      </node>
      <node id="32">
        <label>utility</label>
      </node>
      <node id="48">
        <label>vector</label>
      </node>
    </incdepgraph>
    <innerclass refid="struct_compare_node_network_time" prot="public">CompareNodeNetworkTime</innerclass>
    <sectiondef kind="func">
      <memberdef kind="function" id="eviction_8cpp_1ae96c8b921771b8ffe774146180dcdfd0" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool ReverseCompareNodeMinPingTime</definition>
        <argsstring>(const NodeEvictionCandidate &amp;a, const NodeEvictionCandidate &amp;b)</argsstring>
        <name>ReverseCompareNodeMinPingTime</name>
        <param>
          <type>const <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &amp;</type>
          <declname>a</declname>
        </param>
        <param>
          <type>const <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &amp;</type>
          <declname>b</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/eviction.cpp" line="16" column="13" bodyfile="src/node/eviction.cpp" bodystart="16" bodyend="19"/>
      </memberdef>
      <memberdef kind="function" id="eviction_8cpp_1a56c574c7d0575da90992b4d9459130d5" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool ReverseCompareNodeTimeConnected</definition>
        <argsstring>(const NodeEvictionCandidate &amp;a, const NodeEvictionCandidate &amp;b)</argsstring>
        <name>ReverseCompareNodeTimeConnected</name>
        <param>
          <type>const <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &amp;</type>
          <declname>a</declname>
        </param>
        <param>
          <type>const <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &amp;</type>
          <declname>b</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/eviction.cpp" line="21" column="13" bodyfile="src/node/eviction.cpp" bodystart="21" bodyend="24"/>
      </memberdef>
      <memberdef kind="function" id="eviction_8cpp_1a6375bd6394f769a5c0177043972f2ada" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool CompareNetGroupKeyed</definition>
        <argsstring>(const NodeEvictionCandidate &amp;a, const NodeEvictionCandidate &amp;b)</argsstring>
        <name>CompareNetGroupKeyed</name>
        <param>
          <type>const <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &amp;</type>
          <declname>a</declname>
        </param>
        <param>
          <type>const <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &amp;</type>
          <declname>b</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/eviction.cpp" line="26" column="13" bodyfile="src/node/eviction.cpp" bodystart="26" bodyend="28"/>
      </memberdef>
      <memberdef kind="function" id="eviction_8cpp_1a041f7af36ac1a8be9d6b01e1441c6144" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool CompareNodeBlockTime</definition>
        <argsstring>(const NodeEvictionCandidate &amp;a, const NodeEvictionCandidate &amp;b)</argsstring>
        <name>CompareNodeBlockTime</name>
        <param>
          <type>const <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &amp;</type>
          <declname>a</declname>
        </param>
        <param>
          <type>const <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &amp;</type>
          <declname>b</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/eviction.cpp" line="30" column="13" bodyfile="src/node/eviction.cpp" bodystart="30" bodyend="36"/>
      </memberdef>
      <memberdef kind="function" id="eviction_8cpp_1a8b9513c93cc783f979f926ef76c16b6e" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool CompareNodeTXTime</definition>
        <argsstring>(const NodeEvictionCandidate &amp;a, const NodeEvictionCandidate &amp;b)</argsstring>
        <name>CompareNodeTXTime</name>
        <param>
          <type>const <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &amp;</type>
          <declname>a</declname>
        </param>
        <param>
          <type>const <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &amp;</type>
          <declname>b</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/eviction.cpp" line="38" column="13" bodyfile="src/node/eviction.cpp" bodystart="38" bodyend="45"/>
      </memberdef>
      <memberdef kind="function" id="eviction_8cpp_1a24a21a74f52fac4caf4d6487b1ea1840" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool CompareNodeBlockRelayOnlyTime</definition>
        <argsstring>(const NodeEvictionCandidate &amp;a, const NodeEvictionCandidate &amp;b)</argsstring>
        <name>CompareNodeBlockRelayOnlyTime</name>
        <param>
          <type>const <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &amp;</type>
          <declname>a</declname>
        </param>
        <param>
          <type>const <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &amp;</type>
          <declname>b</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/eviction.cpp" line="48" column="13" bodyfile="src/node/eviction.cpp" bodystart="48" bodyend="54"/>
      </memberdef>
      <memberdef kind="function" id="eviction_8cpp_1a0bffbfd5613482c5d53b3b44f36ef35e" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <templateparamlist>
          <param>
            <type>typename <ref refid="hash__tests_8cpp_1ad4971a985148c784a362f962d42aa012" kindref="member">T</ref></type>
          </param>
          <param>
            <type>typename <ref refid="class_comparator" kindref="compound">Comparator</ref></type>
          </param>
        </templateparamlist>
        <type>void</type>
        <definition>static void EraseLastKElements</definition>
        <argsstring>(std::vector&lt; T &gt; &amp;elements, Comparator comparator, size_t k, std::function&lt; bool(const NodeEvictionCandidate &amp;)&gt; predicate=[](const NodeEvictionCandidate &amp;n) { return true;})</argsstring>
        <name>EraseLastKElements</name>
        <param>
          <type>std::vector&lt; <ref refid="hash__tests_8cpp_1ad4971a985148c784a362f962d42aa012" kindref="member">T</ref> &gt; &amp;</type>
          <declname>elements</declname>
        </param>
        <param>
          <type><ref refid="class_comparator" kindref="compound">Comparator</ref></type>
          <declname>comparator</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>k</declname>
        </param>
        <param>
          <type>std::function&lt; bool(const <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &amp;)&gt;</type>
          <declname>predicate</declname>
          <defval>[](const <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &amp;n) { return true;}</defval>
        </param>
        <briefdescription>
<para>Sort an array by the specified comparator, then erase the last K elements where predicate is true. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/eviction.cpp" line="78" column="13" bodyfile="src/node/eviction.cpp" bodystart="78" bodyend="85"/>
      </memberdef>
      <memberdef kind="function" id="eviction_8cpp_1a31eb14e9967af753ff75ef1e61520314" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void ProtectNoBanConnections</definition>
        <argsstring>(std::vector&lt; NodeEvictionCandidate &gt; &amp;eviction_candidates)</argsstring>
        <name>ProtectNoBanConnections</name>
        <param>
          <type>std::vector&lt; <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &gt; &amp;</type>
          <declname>eviction_candidates</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/eviction.cpp" line="87" column="6" bodyfile="src/node/eviction.cpp" bodystart="87" bodyend="94"/>
      </memberdef>
      <memberdef kind="function" id="eviction_8cpp_1ad5272b431f51c08dd3d65ed5d6c10be3" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void ProtectOutboundConnections</definition>
        <argsstring>(std::vector&lt; NodeEvictionCandidate &gt; &amp;eviction_candidates)</argsstring>
        <name>ProtectOutboundConnections</name>
        <param>
          <type>std::vector&lt; <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &gt; &amp;</type>
          <declname>eviction_candidates</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/eviction.cpp" line="96" column="6" bodyfile="src/node/eviction.cpp" bodystart="96" bodyend="103"/>
      </memberdef>
      <memberdef kind="function" id="eviction_8cpp_1a6d7ad378024a7749d028e7e9f570b1e3" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void ProtectEvictionCandidatesByRatio</definition>
        <argsstring>(std::vector&lt; NodeEvictionCandidate &gt; &amp;eviction_candidates)</argsstring>
        <name>ProtectEvictionCandidatesByRatio</name>
        <param>
          <type>std::vector&lt; <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &gt; &amp;</type>
          <declname>vEvictionCandidates</declname>
          <defname>eviction_candidates</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Protect desirable or disadvantaged inbound peers from eviction by ratio.</para>
<para>This function protects half of the peers which have been connected the longest, to replicate the non-eviction implicit behavior and preclude attacks that start later.</para>
<para>Half of these protected spots (1/4 of the total) are reserved for the following categories of peers, sorted by longest uptime, even if they&apos;re not longest uptime overall:</para>
<para><itemizedlist>
<listitem><para>onion peers connected via our tor control service</para>
</listitem><listitem><para>localhost peers, as manually configured hidden services not using <computeroutput>-bind=addr[:port]=onion</computeroutput> will not be detected as inbound onion connections</para>
</listitem><listitem><para>I2P peers</para>
</listitem><listitem><para>CJDNS peers</para>
</listitem></itemizedlist>
</para>
<para>This helps protect these privacy network peers, which tend to be otherwise disadvantaged under our eviction criteria for their higher min ping times relative to IPv4/IPv6 peers, and favorise the diversity of peer connections. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/eviction.cpp" line="105" column="6" bodyfile="src/node/eviction.cpp" bodystart="105" bodyend="176"/>
      </memberdef>
      <memberdef kind="function" id="eviction_8cpp_1a799d58489ce4ea35e8bc556dd9ffb33c" prot="public" static="no" nodiscard="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>std::optional&lt; <ref refid="net_8h_1aa637b11e18b77724b35db2229cd12788" kindref="member">NodeId</ref> &gt;</type>
        <definition>std::optional&lt; NodeId &gt; SelectNodeToEvict</definition>
        <argsstring>(std::vector&lt; NodeEvictionCandidate &gt; &amp;&amp;vEvictionCandidates)</argsstring>
        <name>SelectNodeToEvict</name>
        <param>
          <type>std::vector&lt; <ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref> &gt; &amp;&amp;</type>
          <declname>vEvictionCandidates</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Select an inbound peer to evict after filtering out (protecting) peers having distinct, difficult-to-forge characteristics. The protection logic picks out fixed numbers of desirable peers per various criteria, followed by (mostly) ratios of desirable or disadvantaged peers. If any eviction candidates remain, the selection logic chooses a peer to evict. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/node/eviction.cpp" line="178" column="16" bodyfile="src/node/eviction.cpp" bodystart="178" bodyend="240"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>(c)<sp/>2022-present<sp/>The<sp/>Bitcoin<sp/>Core<sp/>developers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Distributed<sp/>under<sp/>the<sp/>MIT<sp/>software<sp/>license,<sp/>see<sp/>the<sp/>accompanying</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">//<sp/>file<sp/>COPYING<sp/>or<sp/>http://www.opensource.org/licenses/mit-license.php.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="eviction_8h" kindref="compound">node/eviction.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;algorithm&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;array&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;chrono&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;cstdint&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;functional&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;map&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;vector&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>ReverseCompareNodeMinPingTime(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref><sp/>&amp;a,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref><sp/>&amp;b)</highlight></codeline>
<codeline lineno="17"><highlight class="normal">{</highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>a.<ref refid="struct_node_eviction_candidate_1a21305b100c3272d0242c4798b7ce3143" kindref="member">m_min_ping_time</ref><sp/>&gt;<sp/>b.<ref refid="struct_node_eviction_candidate_1a21305b100c3272d0242c4798b7ce3143" kindref="member">m_min_ping_time</ref>;</highlight></codeline>
<codeline lineno="19"><highlight class="normal">}</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>ReverseCompareNodeTimeConnected(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref><sp/>&amp;a,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref><sp/>&amp;b)</highlight></codeline>
<codeline lineno="22"><highlight class="normal">{</highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>a.<ref refid="struct_node_eviction_candidate_1a105854ad29bea0496c2653aaee610af0" kindref="member">m_connected</ref><sp/>&gt;<sp/>b.<ref refid="struct_node_eviction_candidate_1a105854ad29bea0496c2653aaee610af0" kindref="member">m_connected</ref>;</highlight></codeline>
<codeline lineno="24"><highlight class="normal">}</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>CompareNetGroupKeyed(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref><sp/>&amp;a,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref><sp/>&amp;b)<sp/>{</highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>a.<ref refid="struct_node_eviction_candidate_1aa786f21ec54d06a233db0e4278af4c9a" kindref="member">nKeyedNetGroup</ref><sp/>&lt;<sp/>b.<ref refid="struct_node_eviction_candidate_1aa786f21ec54d06a233db0e4278af4c9a" kindref="member">nKeyedNetGroup</ref>;</highlight></codeline>
<codeline lineno="28"><highlight class="normal">}</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>CompareNodeBlockTime(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref><sp/>&amp;a,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref><sp/>&amp;b)</highlight></codeline>
<codeline lineno="31"><highlight class="normal">{</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>There<sp/>is<sp/>a<sp/>fall-through<sp/>here<sp/>because<sp/>it<sp/>is<sp/>common<sp/>for<sp/>a<sp/>node<sp/>to<sp/>have<sp/>many<sp/>peers<sp/>which<sp/>have<sp/>not<sp/>yet<sp/>relayed<sp/>a<sp/>block.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(a.<ref refid="struct_node_eviction_candidate_1ae6a2f94834c1021efe90228614a5efa3" kindref="member">m_last_block_time</ref><sp/>!=<sp/>b.<ref refid="struct_node_eviction_candidate_1ae6a2f94834c1021efe90228614a5efa3" kindref="member">m_last_block_time</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>a.<ref refid="struct_node_eviction_candidate_1ae6a2f94834c1021efe90228614a5efa3" kindref="member">m_last_block_time</ref><sp/>&lt;<sp/>b.<ref refid="struct_node_eviction_candidate_1ae6a2f94834c1021efe90228614a5efa3" kindref="member">m_last_block_time</ref>;</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(a.<ref refid="struct_node_eviction_candidate_1a10e1acc32033fe856b45f6101804ab2b" kindref="member">fRelevantServices</ref><sp/>!=<sp/>b.<ref refid="struct_node_eviction_candidate_1a10e1acc32033fe856b45f6101804ab2b" kindref="member">fRelevantServices</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>b.<ref refid="struct_node_eviction_candidate_1a10e1acc32033fe856b45f6101804ab2b" kindref="member">fRelevantServices</ref>;</highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>a.<ref refid="struct_node_eviction_candidate_1a105854ad29bea0496c2653aaee610af0" kindref="member">m_connected</ref><sp/>&gt;<sp/>b.<ref refid="struct_node_eviction_candidate_1a105854ad29bea0496c2653aaee610af0" kindref="member">m_connected</ref>;</highlight></codeline>
<codeline lineno="36"><highlight class="normal">}</highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>CompareNodeTXTime(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref><sp/>&amp;a,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref><sp/>&amp;b)</highlight></codeline>
<codeline lineno="39"><highlight class="normal">{</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>There<sp/>is<sp/>a<sp/>fall-through<sp/>here<sp/>because<sp/>it<sp/>is<sp/>common<sp/>for<sp/>a<sp/>node<sp/>to<sp/>have<sp/>more<sp/>than<sp/>a<sp/>few<sp/>peers<sp/>that<sp/>have<sp/>not<sp/>yet<sp/>relayed<sp/>txn.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(a.<ref refid="struct_node_eviction_candidate_1a6f542a97e7b172f603589c0022476d04" kindref="member">m_last_tx_time</ref><sp/>!=<sp/>b.<ref refid="struct_node_eviction_candidate_1a6f542a97e7b172f603589c0022476d04" kindref="member">m_last_tx_time</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>a.<ref refid="struct_node_eviction_candidate_1a6f542a97e7b172f603589c0022476d04" kindref="member">m_last_tx_time</ref><sp/>&lt;<sp/>b.<ref refid="struct_node_eviction_candidate_1a6f542a97e7b172f603589c0022476d04" kindref="member">m_last_tx_time</ref>;</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(a.<ref refid="struct_node_eviction_candidate_1a7543e00102377ff2f261b4b2451fb6f6" kindref="member">m_relay_txs</ref><sp/>!=<sp/>b.<ref refid="struct_node_eviction_candidate_1a7543e00102377ff2f261b4b2451fb6f6" kindref="member">m_relay_txs</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>b.<ref refid="struct_node_eviction_candidate_1a7543e00102377ff2f261b4b2451fb6f6" kindref="member">m_relay_txs</ref>;</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(a.<ref refid="struct_node_eviction_candidate_1a56b6e7596e1ced94f71d0f1363512950" kindref="member">fBloomFilter</ref><sp/>!=<sp/>b.<ref refid="struct_node_eviction_candidate_1a56b6e7596e1ced94f71d0f1363512950" kindref="member">fBloomFilter</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>a.<ref refid="struct_node_eviction_candidate_1a56b6e7596e1ced94f71d0f1363512950" kindref="member">fBloomFilter</ref>;</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>a.<ref refid="struct_node_eviction_candidate_1a105854ad29bea0496c2653aaee610af0" kindref="member">m_connected</ref><sp/>&gt;<sp/>b.<ref refid="struct_node_eviction_candidate_1a105854ad29bea0496c2653aaee610af0" kindref="member">m_connected</ref>;</highlight></codeline>
<codeline lineno="45"><highlight class="normal">}</highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Pick<sp/>out<sp/>the<sp/>potential<sp/>block-relay<sp/>only<sp/>peers,<sp/>and<sp/>sort<sp/>them<sp/>by<sp/>last<sp/>block<sp/>time.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>CompareNodeBlockRelayOnlyTime(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref><sp/>&amp;a,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref><sp/>&amp;b)</highlight></codeline>
<codeline lineno="49"><highlight class="normal">{</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(a.<ref refid="struct_node_eviction_candidate_1a7543e00102377ff2f261b4b2451fb6f6" kindref="member">m_relay_txs</ref><sp/>!=<sp/>b.<ref refid="struct_node_eviction_candidate_1a7543e00102377ff2f261b4b2451fb6f6" kindref="member">m_relay_txs</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>a.<ref refid="struct_node_eviction_candidate_1a7543e00102377ff2f261b4b2451fb6f6" kindref="member">m_relay_txs</ref>;</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(a.<ref refid="struct_node_eviction_candidate_1ae6a2f94834c1021efe90228614a5efa3" kindref="member">m_last_block_time</ref><sp/>!=<sp/>b.<ref refid="struct_node_eviction_candidate_1ae6a2f94834c1021efe90228614a5efa3" kindref="member">m_last_block_time</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>a.<ref refid="struct_node_eviction_candidate_1ae6a2f94834c1021efe90228614a5efa3" kindref="member">m_last_block_time</ref><sp/>&lt;<sp/>b.<ref refid="struct_node_eviction_candidate_1ae6a2f94834c1021efe90228614a5efa3" kindref="member">m_last_block_time</ref>;</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(a.<ref refid="struct_node_eviction_candidate_1a10e1acc32033fe856b45f6101804ab2b" kindref="member">fRelevantServices</ref><sp/>!=<sp/>b.<ref refid="struct_node_eviction_candidate_1a10e1acc32033fe856b45f6101804ab2b" kindref="member">fRelevantServices</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>b.<ref refid="struct_node_eviction_candidate_1a10e1acc32033fe856b45f6101804ab2b" kindref="member">fRelevantServices</ref>;</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>a.<ref refid="struct_node_eviction_candidate_1a105854ad29bea0496c2653aaee610af0" kindref="member">m_connected</ref><sp/>&gt;<sp/>b.<ref refid="struct_node_eviction_candidate_1a105854ad29bea0496c2653aaee610af0" kindref="member">m_connected</ref>;</highlight></codeline>
<codeline lineno="54"><highlight class="normal">}</highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight></codeline>
<codeline lineno="64" refid="struct_compare_node_network_time" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="struct_compare_node_network_time_1a7517fa2ca89f0afeeb807e70a0bfae00" kindref="member">CompareNodeNetworkTime</ref><sp/>{</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="struct_compare_node_network_time_1a569c4e394daf8923511e4ce6a8975071" kindref="member">m_is_local</ref>;</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="netaddress_8h_1acc9a38c714afe79b5035cb36f560dac3" kindref="member">Network</ref><sp/><ref refid="struct_compare_node_network_time_1aa9f4d584e458c45b2f7b359be424b2c3" kindref="member">m_network</ref>;</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_compare_node_network_time_1a7517fa2ca89f0afeeb807e70a0bfae00" kindref="member">CompareNodeNetworkTime</ref>(</highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>is_local,<sp/><ref refid="netaddress_8h_1acc9a38c714afe79b5035cb36f560dac3" kindref="member">Network</ref><sp/>network)<sp/>:<sp/><ref refid="struct_compare_node_network_time_1a569c4e394daf8923511e4ce6a8975071" kindref="member">m_is_local</ref>(is_local),<sp/><ref refid="struct_compare_node_network_time_1aa9f4d584e458c45b2f7b359be424b2c3" kindref="member">m_network</ref>(network)<sp/>{}</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="struct_compare_node_network_time_1a878e5122026e50f5981ad31aea49e917" kindref="member">operator()</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref>&amp;<sp/>a,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref>&amp;<sp/>b)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="69"><highlight class="keyword"><sp/><sp/><sp/><sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="struct_compare_node_network_time_1a569c4e394daf8923511e4ce6a8975071" kindref="member">m_is_local</ref><sp/>&amp;&amp;<sp/>a.<ref refid="struct_node_eviction_candidate_1af5d42837cee106296cb35582aae8502c" kindref="member">m_is_local</ref><sp/>!=<sp/>b.<ref refid="struct_node_eviction_candidate_1af5d42837cee106296cb35582aae8502c" kindref="member">m_is_local</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>b.<ref refid="struct_node_eviction_candidate_1af5d42837cee106296cb35582aae8502c" kindref="member">m_is_local</ref>;</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((a.<ref refid="struct_node_eviction_candidate_1a3e7092693765b04078ed708197ceb8e2" kindref="member">m_network</ref><sp/>==<sp/><ref refid="struct_compare_node_network_time_1aa9f4d584e458c45b2f7b359be424b2c3" kindref="member">m_network</ref>)<sp/>!=<sp/>(b.<ref refid="struct_node_eviction_candidate_1a3e7092693765b04078ed708197ceb8e2" kindref="member">m_network</ref><sp/>==<sp/><ref refid="struct_compare_node_network_time_1aa9f4d584e458c45b2f7b359be424b2c3" kindref="member">m_network</ref>))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>b.<ref refid="struct_node_eviction_candidate_1a3e7092693765b04078ed708197ceb8e2" kindref="member">m_network</ref><sp/>==<sp/><ref refid="struct_compare_node_network_time_1aa9f4d584e458c45b2f7b359be424b2c3" kindref="member">m_network</ref>;</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>a.<ref refid="struct_node_eviction_candidate_1a105854ad29bea0496c2653aaee610af0" kindref="member">m_connected</ref><sp/>&gt;<sp/>b.<ref refid="struct_node_eviction_candidate_1a105854ad29bea0496c2653aaee610af0" kindref="member">m_connected</ref>;</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="74"><highlight class="normal">};</highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight><highlight class="keyword">template</highlight><highlight class="normal"><sp/>&lt;</highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>T,<sp/></highlight><highlight class="keyword">typename</highlight><highlight class="normal"><sp/>Comparator&gt;</highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>EraseLastKElements(</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;T&gt;&amp;<sp/>elements,<sp/><ref refid="class_comparator" kindref="compound">Comparator</ref><sp/>comparator,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>,</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>std::function&lt;</highlight><highlight class="keywordtype">bool</highlight><highlight class="normal">(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref>&amp;)&gt;<sp/>predicate<sp/>=<sp/>[](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref>&amp;<sp/>n)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;<sp/>})</highlight></codeline>
<codeline lineno="81"><highlight class="normal">{</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/>std::sort(elements.begin(),<sp/>elements.end(),<sp/>comparator);</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>eraseSize<sp/>=<sp/>std::min(<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>,<sp/>elements.size());</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/>elements.erase(std::remove_if(elements.end()<sp/>-<sp/>eraseSize,<sp/>elements.end(),<sp/>predicate),<sp/>elements.end());</highlight></codeline>
<codeline lineno="85"><highlight class="normal">}</highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="eviction_8cpp_1a31eb14e9967af753ff75ef1e61520314" kindref="member">ProtectNoBanConnections</ref>(std::vector&lt;NodeEvictionCandidate&gt;&amp;<sp/>eviction_candidates)</highlight></codeline>
<codeline lineno="88"><highlight class="normal">{</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/>eviction_candidates.erase(std::remove_if(eviction_candidates.begin(),<sp/>eviction_candidates.end(),</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[](<ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">&amp;<sp/>n)<sp/>{</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>n.m_noban;</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}),</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>eviction_candidates.end());</highlight></codeline>
<codeline lineno="94"><highlight class="normal">}</highlight></codeline>
<codeline lineno="95"><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="eviction_8cpp_1ad5272b431f51c08dd3d65ed5d6c10be3" kindref="member">ProtectOutboundConnections</ref>(std::vector&lt;NodeEvictionCandidate&gt;&amp;<sp/>eviction_candidates)</highlight></codeline>
<codeline lineno="97"><highlight class="normal">{</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/>eviction_candidates.erase(std::remove_if(eviction_candidates.begin(),<sp/>eviction_candidates.end(),</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[](<ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">&amp;<sp/>n)<sp/>{</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>n.m_conn_type<sp/>!=<sp/>ConnectionType::INBOUND;</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}),</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>eviction_candidates.end());</highlight></codeline>
<codeline lineno="103"><highlight class="normal">}</highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="eviction_8cpp_1a6d7ad378024a7749d028e7e9f570b1e3" kindref="member">ProtectEvictionCandidatesByRatio</ref>(std::vector&lt;NodeEvictionCandidate&gt;&amp;<sp/>eviction_candidates)</highlight></codeline>
<codeline lineno="106"><highlight class="normal">{</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Protect<sp/>the<sp/>half<sp/>of<sp/>the<sp/>remaining<sp/>nodes<sp/>which<sp/>have<sp/>been<sp/>connected<sp/>the<sp/>longest.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>replicates<sp/>the<sp/>non-eviction<sp/>implicit<sp/>behavior,<sp/>and<sp/>precludes<sp/>attacks<sp/>that<sp/>start<sp/>later.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>To<sp/>favorise<sp/>the<sp/>diversity<sp/>of<sp/>our<sp/>peer<sp/>connections,<sp/>reserve<sp/>up<sp/>to<sp/>half<sp/>of<sp/>these<sp/>protected</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>spots<sp/>for<sp/>Tor/onion,<sp/>localhost,<sp/>I2P,<sp/>and<sp/>CJDNS<sp/>peers,<sp/>even<sp/>if<sp/>they&apos;re<sp/>not<sp/>longest<sp/>uptime</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>overall.<sp/>This<sp/>helps<sp/>protect<sp/>these<sp/>higher-latency<sp/>peers<sp/>that<sp/>tend<sp/>to<sp/>be<sp/>otherwise</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>disadvantaged<sp/>under<sp/>our<sp/>eviction<sp/>criteria.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>initial_size<sp/>=<sp/>eviction_candidates.size();</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>total_protect_size{initial_size<sp/>/<sp/>2};</highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Disadvantaged<sp/>networks<sp/>to<sp/>protect.<sp/>In<sp/>the<sp/>case<sp/>of<sp/>equal<sp/>counts,<sp/>earlier<sp/>array<sp/>members</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>have<sp/>the<sp/>first<sp/>opportunity<sp/>to<sp/>recover<sp/>unused<sp/>slots<sp/>from<sp/>the<sp/>previous<sp/>iteration.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">Net<sp/>{<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>is_local;<sp/><ref refid="netaddress_8h_1acc9a38c714afe79b5035cb36f560dac3" kindref="member">Network</ref><sp/>id;<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>count;<sp/>};</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/>std::array&lt;Net,<sp/>4&gt;<sp/>networks{</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{{</highlight><highlight class="keyword">false</highlight><highlight class="normal">,<sp/><ref refid="netaddress_8h_1acc9a38c714afe79b5035cb36f560dac3a16bdaeec24a970c2a88fe66cf82e48a3" kindref="member">NET_CJDNS</ref>,<sp/>0},<sp/>{</highlight><highlight class="keyword">false</highlight><highlight class="normal">,<sp/><ref refid="netaddress_8h_1acc9a38c714afe79b5035cb36f560dac3a0cb8b5dbd08567fffe61bc1b3942aedd" kindref="member">NET_I2P</ref>,<sp/>0},<sp/>{</highlight><highlight class="comment">/*localhost=*/</highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/><ref refid="netaddress_8h_1acc9a38c714afe79b5035cb36f560dac3a675b0737d6c404a5de25e324c166a4b5" kindref="member">NET_MAX</ref>,<sp/>0},<sp/>{</highlight><highlight class="keyword">false</highlight><highlight class="normal">,<sp/><ref refid="netaddress_8h_1acc9a38c714afe79b5035cb36f560dac3a74254f483ed8f948cd89e53ce36f484b" kindref="member">NET_ONION</ref>,<sp/>0}}};</highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Count<sp/>and<sp/>store<sp/>the<sp/>number<sp/>of<sp/>eviction<sp/>candidates<sp/>per<sp/>network.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(Net&amp;<sp/>n<sp/>:<sp/>networks)<sp/>{</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n.count<sp/>=<sp/>std::count_if(eviction_candidates.cbegin(),<sp/>eviction_candidates.cend(),</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[&amp;n](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref>&amp;<sp/>c)<sp/>{</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>n.is_local<sp/>?<sp/>c.m_is_local<sp/>:<sp/>c.m_network<sp/>==<sp/>n.id;</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Sort<sp/>`networks`<sp/>by<sp/>ascending<sp/>candidate<sp/>count,<sp/>to<sp/>give<sp/>networks<sp/>having<sp/>fewer<sp/>candidates</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>first<sp/>opportunity<sp/>to<sp/>recover<sp/>unused<sp/>protected<sp/>slots<sp/>from<sp/>the<sp/>previous<sp/>iteration.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/>std::stable_sort(networks.begin(),<sp/>networks.end(),<sp/>[](Net<sp/>a,<sp/>Net<sp/>b)<sp/>{<sp/>return<sp/>a.count<sp/>&lt;<sp/>b.count;<sp/>});</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Protect<sp/>up<sp/>to<sp/>25%<sp/>of<sp/>the<sp/>eviction<sp/>candidates<sp/>by<sp/>disadvantaged<sp/>network.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>max_protect_by_network{total_protect_size<sp/>/<sp/>2};</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>num_protected{0};</highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(num_protected<sp/>&lt;<sp/>max_protect_by_network)<sp/>{</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Count<sp/>the<sp/>number<sp/>of<sp/>disadvantaged<sp/>networks<sp/>from<sp/>which<sp/>we<sp/>have<sp/>peers<sp/>to<sp/>protect.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>num_networks<sp/>=<sp/>std::count_if(networks.begin(),<sp/>networks.end(),<sp/>[](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>Net&amp;<sp/>n)<sp/>{<sp/>return<sp/>n.count;<sp/>});</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(num_networks<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>disadvantaged_to_protect{max_protect_by_network<sp/>-<sp/>num_protected};</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>protect_per_network{std::max(disadvantaged_to_protect<sp/>/<sp/>num_networks,<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="keywordtype">size_t</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(1))};</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Early<sp/>exit<sp/>flag<sp/>if<sp/>there<sp/>are<sp/>no<sp/>remaining<sp/>candidates<sp/>by<sp/>disadvantaged<sp/>network.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>protected_at_least_one{</highlight><highlight class="keyword">false</highlight><highlight class="normal">};</highlight></codeline>
<codeline lineno="147"><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(Net&amp;<sp/>n<sp/>:<sp/>networks)<sp/>{</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n.count<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>before<sp/>=<sp/>eviction_candidates.size();</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>EraseLastKElements(eviction_candidates,<sp/><ref refid="struct_compare_node_network_time" kindref="compound">CompareNodeNetworkTime</ref>(n.is_local,<sp/>n.<ref refid="struct_node_eviction_candidate_1a74da8e651f4684ed58c78d8ba5984487" kindref="member">id</ref>),</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>protect_per_network,<sp/>[&amp;n](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref>&amp;<sp/>c)<sp/>{</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>n.is_local<sp/>?<sp/>c.m_is_local<sp/>:<sp/>c.m_network<sp/>==<sp/>n.id;</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>after<sp/>=<sp/>eviction_candidates.size();</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(before<sp/>&gt;<sp/>after)<sp/>{</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>protected_at_least_one<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>delta{before<sp/>-<sp/>after};</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>num_protected<sp/>+=<sp/>delta;</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(num_protected<sp/>&gt;=<sp/>max_protect_by_network)<sp/>{</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n.count<sp/>-=<sp/>delta;</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!protected_at_least_one)<sp/>{</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="170"><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Calculate<sp/>how<sp/>many<sp/>we<sp/>removed,<sp/>and<sp/>update<sp/>our<sp/>total<sp/>number<sp/>of<sp/>peers<sp/>that</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>want<sp/>to<sp/>protect<sp/>based<sp/>on<sp/>uptime<sp/>accordingly.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="validation_8cpp_1afb7ea74ba028421697aa7f364741ee6c" kindref="member">assert</ref>(num_protected<sp/>==<sp/>initial_size<sp/>-<sp/>eviction_candidates.size());</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>remaining_to_protect{total_protect_size<sp/>-<sp/>num_protected};</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/>EraseLastKElements(eviction_candidates,<sp/>ReverseCompareNodeTimeConnected,<sp/>remaining_to_protect);</highlight></codeline>
<codeline lineno="176"><highlight class="normal">}</highlight></codeline>
<codeline lineno="177"><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal">[[nodiscard]]<sp/>std::optional&lt;NodeId&gt;<sp/><ref refid="eviction_8cpp_1a799d58489ce4ea35e8bc556dd9ffb33c" kindref="member">SelectNodeToEvict</ref>(std::vector&lt;NodeEvictionCandidate&gt;&amp;&amp;<sp/>vEvictionCandidates)</highlight></codeline>
<codeline lineno="179"><highlight class="normal">{</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Protect<sp/>connections<sp/>with<sp/>certain<sp/>characteristics</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="eviction_8cpp_1a31eb14e9967af753ff75ef1e61520314" kindref="member">ProtectNoBanConnections</ref>(vEvictionCandidates);</highlight></codeline>
<codeline lineno="183"><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="eviction_8cpp_1ad5272b431f51c08dd3d65ed5d6c10be3" kindref="member">ProtectOutboundConnections</ref>(vEvictionCandidates);</highlight></codeline>
<codeline lineno="185"><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Deterministically<sp/>select<sp/>4<sp/>peers<sp/>to<sp/>protect<sp/>by<sp/>netgroup.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>An<sp/>attacker<sp/>cannot<sp/>predict<sp/>which<sp/>netgroups<sp/>will<sp/>be<sp/>protected</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/>EraseLastKElements(vEvictionCandidates,<sp/>CompareNetGroupKeyed,<sp/>4);</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Protect<sp/>the<sp/>8<sp/>nodes<sp/>with<sp/>the<sp/>lowest<sp/>minimum<sp/>ping<sp/>time.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>An<sp/>attacker<sp/>cannot<sp/>manipulate<sp/>this<sp/>metric<sp/>without<sp/>physically<sp/>moving<sp/>nodes<sp/>closer<sp/>to<sp/>the<sp/>target.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/>EraseLastKElements(vEvictionCandidates,<sp/>ReverseCompareNodeMinPingTime,<sp/>8);</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Protect<sp/>4<sp/>nodes<sp/>that<sp/>most<sp/>recently<sp/>sent<sp/>us<sp/>novel<sp/>transactions<sp/>accepted<sp/>into<sp/>our<sp/>mempool.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>An<sp/>attacker<sp/>cannot<sp/>manipulate<sp/>this<sp/>metric<sp/>without<sp/>performing<sp/>useful<sp/>work.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/>EraseLastKElements(vEvictionCandidates,<sp/>CompareNodeTXTime,<sp/>4);</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Protect<sp/>up<sp/>to<sp/>8<sp/>non-tx-relay<sp/>peers<sp/>that<sp/>have<sp/>sent<sp/>us<sp/>novel<sp/>blocks.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/>EraseLastKElements(vEvictionCandidates,<sp/>CompareNodeBlockRelayOnlyTime,<sp/>8,</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref>&amp;<sp/>n)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>!n.<ref refid="struct_node_eviction_candidate_1a7543e00102377ff2f261b4b2451fb6f6" kindref="member">m_relay_txs</ref><sp/>&amp;&amp;<sp/>n.<ref refid="struct_node_eviction_candidate_1a10e1acc32033fe856b45f6101804ab2b" kindref="member">fRelevantServices</ref>;<sp/>});</highlight></codeline>
<codeline lineno="198"><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Protect<sp/>4<sp/>nodes<sp/>that<sp/>most<sp/>recently<sp/>sent<sp/>us<sp/>novel<sp/>blocks.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>An<sp/>attacker<sp/>cannot<sp/>manipulate<sp/>this<sp/>metric<sp/>without<sp/>performing<sp/>useful<sp/>work.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/>EraseLastKElements(vEvictionCandidates,<sp/>CompareNodeBlockTime,<sp/>4);</highlight></codeline>
<codeline lineno="202"><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Protect<sp/>some<sp/>of<sp/>the<sp/>remaining<sp/>eviction<sp/>candidates<sp/>by<sp/>ratios<sp/>of<sp/>desirable</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>or<sp/>disadvantaged<sp/>characteristics.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="eviction_8cpp_1a6d7ad378024a7749d028e7e9f570b1e3" kindref="member">ProtectEvictionCandidatesByRatio</ref>(vEvictionCandidates);</highlight></codeline>
<codeline lineno="206"><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(vEvictionCandidates.empty())<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::nullopt;</highlight></codeline>
<codeline lineno="208"><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>any<sp/>remaining<sp/>peers<sp/>are<sp/>preferred<sp/>for<sp/>eviction<sp/>consider<sp/>only<sp/>them.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>happens<sp/>after<sp/>the<sp/>other<sp/>preferences<sp/>since<sp/>if<sp/>a<sp/>peer<sp/>is<sp/>really<sp/>the<sp/>best<sp/>by<sp/>other<sp/>criteria<sp/>(esp<sp/>relaying<sp/>blocks)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/>then<sp/>we<sp/>probably<sp/>don&apos;t<sp/>want<sp/>to<sp/>evict<sp/>it<sp/>no<sp/>matter<sp/>what.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(std::any_of(vEvictionCandidates.begin(),vEvictionCandidates.end(),[](<ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>&amp;n){return<sp/>n.prefer_evict;}))<sp/>{</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vEvictionCandidates.erase(std::remove_if(vEvictionCandidates.begin(),vEvictionCandidates.end(),</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[](<ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>&amp;n){return<sp/>!n.prefer_evict;}),vEvictionCandidates.end());</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Identify<sp/>the<sp/>network<sp/>group<sp/>with<sp/>the<sp/>most<sp/>connections<sp/>and<sp/>youngest<sp/>member.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>(vEvictionCandidates<sp/>is<sp/>already<sp/>sorted<sp/>by<sp/>reverse<sp/>connect<sp/>time)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/>uint64_t<sp/>naMostConnections;</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nMostConnections<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/>std::chrono::seconds<sp/>nMostConnectionsTime{0};</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/>std::map&lt;uint64_t,<sp/>std::vector&lt;NodeEvictionCandidate&gt;<sp/>&gt;<sp/>mapNetGroupNodes;</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_node_eviction_candidate" kindref="compound">NodeEvictionCandidate</ref><sp/>&amp;<ref refid="namespacenode" kindref="compound">node</ref><sp/>:<sp/>vEvictionCandidates)<sp/>{</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;NodeEvictionCandidate&gt;<sp/>&amp;<ref refid="namespacetests__wycheproof__generate__ecdsa_1a0f9123af540f084d1c0421dccc31e1dd" kindref="member">group</ref><sp/>=<sp/>mapNetGroupNodes[<ref refid="namespacenode" kindref="compound">node</ref>.nKeyedNetGroup];</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespacetests__wycheproof__generate__ecdsa_1a0f9123af540f084d1c0421dccc31e1dd" kindref="member">group</ref>.push_back(<ref refid="namespacenode" kindref="compound">node</ref>);</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>grouptime{<ref refid="namespacetests__wycheproof__generate__ecdsa_1a0f9123af540f084d1c0421dccc31e1dd" kindref="member">group</ref>[0].m_connected};</highlight></codeline>
<codeline lineno="227"><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespacetests__wycheproof__generate__ecdsa_1a0f9123af540f084d1c0421dccc31e1dd" kindref="member">group</ref>.size()<sp/>&gt;<sp/>nMostConnections<sp/>||<sp/>(<ref refid="namespacetests__wycheproof__generate__ecdsa_1a0f9123af540f084d1c0421dccc31e1dd" kindref="member">group</ref>.size()<sp/>==<sp/>nMostConnections<sp/>&amp;&amp;<sp/>grouptime<sp/>&gt;<sp/>nMostConnectionsTime))<sp/>{</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nMostConnections<sp/>=<sp/><ref refid="namespacetests__wycheproof__generate__ecdsa_1a0f9123af540f084d1c0421dccc31e1dd" kindref="member">group</ref>.size();</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nMostConnectionsTime<sp/>=<sp/>grouptime;</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>naMostConnections<sp/>=<sp/><ref refid="namespacenode" kindref="compound">node</ref>.nKeyedNetGroup;</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="234"><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Reduce<sp/>to<sp/>the<sp/>network<sp/>group<sp/>with<sp/>the<sp/>most<sp/>connections</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/>vEvictionCandidates<sp/>=<sp/>std::move(mapNetGroupNodes[naMostConnections]);</highlight></codeline>
<codeline lineno="237"><highlight class="normal"></highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Disconnect<sp/>from<sp/>the<sp/>network<sp/>group<sp/>with<sp/>the<sp/>most<sp/>connections</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>vEvictionCandidates.front().id;</highlight></codeline>
<codeline lineno="240"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="src/node/eviction.cpp"/>
  </compounddef>
</doxygen>
