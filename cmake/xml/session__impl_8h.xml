<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="session__impl_8h" kind="file" language="C++">
    <compoundname>session_impl.h</compoundname>
    <includes refid="string_8h" local="no">string.h</includes>
    <includes refid="secp256k1_8h" local="yes">../../../include/secp256k1.h</includes>
    <includes refid="secp256k1__extrakeys_8h" local="yes">../../../include/secp256k1_extrakeys.h</includes>
    <includes refid="secp256k1__musig_8h" local="yes">../../../include/secp256k1_musig.h</includes>
    <includes refid="keyagg_8h" local="yes">keyagg.h</includes>
    <includes refid="session_8h" local="yes">session.h</includes>
    <includes refid="eckey_8h" local="yes">../../eckey.h</includes>
    <includes refid="secp256k1_2src_2hash_8h" local="yes">../../hash.h</includes>
    <includes refid="scalar_8h" local="yes">../../scalar.h</includes>
    <includes refid="secp256k1_2src_2util_8h" local="yes">../../util.h</includes>
    <includedby refid="musig_2main__impl_8h" local="yes">src/secp256k1/src/modules/musig/main_impl.h</includedby>
    <incdepgraph>
      <node id="17">
        <label>../../../include/secp256k1.h</label>
        <link refid="secp256k1_8h"/>
        <childnode refid="18" relation="include">
        </childnode>
      </node>
      <node id="19">
        <label>../../../include/secp256k1_extrakeys.h</label>
        <link refid="secp256k1__extrakeys_8h"/>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="20">
        <label>../../../include/secp256k1_musig.h</label>
        <link refid="secp256k1__musig_8h"/>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
      </node>
      <node id="26">
        <label>checkmem.h</label>
        <link refid="checkmem_8h"/>
      </node>
      <node id="34">
        <label>../../eckey.h</label>
        <link refid="eckey_8h"/>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
      </node>
      <node id="35">
        <label>ecmult.h</label>
        <link refid="ecmult_8h"/>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
      </node>
      <node id="37">
        <label>ecmult_gen.h</label>
        <link refid="ecmult__gen_8h"/>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="24">
        <label>field.h</label>
        <link refid="field_8h"/>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="30">
        <label>field_5x52.h</label>
        <link refid="field__5x52_8h"/>
        <childnode refid="21" relation="include">
        </childnode>
      </node>
      <node id="23">
        <label>../../group.h</label>
        <link refid="group_8h"/>
        <childnode refid="24" relation="include">
        </childnode>
      </node>
      <node id="38">
        <label>../../hash.h</label>
        <link refid="secp256k1_2src_2hash_8h"/>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
      </node>
      <node id="22">
        <label>keyagg.h</label>
        <link refid="keyagg_8h"/>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="33">
        <label>session.h</label>
        <link refid="session_8h"/>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>src/secp256k1/src/modules/musig/session_impl.h</label>
        <link refid="session__impl_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
      </node>
      <node id="31">
        <label>../../scalar.h</label>
        <link refid="scalar_8h"/>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
      </node>
      <node id="32">
        <label>scalar_4x64.h</label>
        <link refid="scalar__4x64_8h"/>
        <childnode refid="21" relation="include">
        </childnode>
      </node>
      <node id="36">
        <label>scratch.h</label>
        <link refid="scratch_8h"/>
      </node>
      <node id="25">
        <label>util.h</label>
        <link refid="secp256k1_2src_2util_8h"/>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="3">
        <label>span.h</label>
        <link refid="span_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>string.h</label>
        <link refid="string_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="9">
        <label>array</label>
      </node>
      <node id="4">
        <label>cassert</label>
      </node>
      <node id="5">
        <label>cstddef</label>
      </node>
      <node id="10">
        <label>cstdint</label>
      </node>
      <node id="11">
        <label>cstring</label>
      </node>
      <node id="29">
        <label>limits.h</label>
      </node>
      <node id="12">
        <label>locale</label>
      </node>
      <node id="6">
        <label>span</label>
      </node>
      <node id="13">
        <label>sstream</label>
      </node>
      <node id="18">
        <label>stddef.h</label>
      </node>
      <node id="21">
        <label>stdint.h</label>
      </node>
      <node id="28">
        <label>stdio.h</label>
      </node>
      <node id="27">
        <label>stdlib.h</label>
      </node>
      <node id="14">
        <label>string</label>
      </node>
      <node id="15">
        <label>string_view</label>
      </node>
      <node id="7">
        <label>type_traits</label>
      </node>
      <node id="8">
        <label>utility</label>
      </node>
      <node id="16">
        <label>vector</label>
      </node>
    </incdepgraph>
    <invincdepgraph>
      <node id="2">
        <label>src/secp256k1/src/modules/musig/main_impl.h</label>
        <link refid="musig_2main__impl_8h"/>
      </node>
      <node id="1">
        <label>src/secp256k1/src/modules/musig/session_impl.h</label>
        <link refid="session__impl_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
      </node>
    </invincdepgraph>
    <sectiondef kind="var">
      <memberdef kind="variable" id="session__impl_8h_1a44a00f5be8c9da7ba7379bf761003fce" prot="public" static="yes" mutable="no">
        <type>const unsigned char</type>
        <definition>const unsigned char secp256k1_musig_secnonce_magic[4]</definition>
        <argsstring>[4]</argsstring>
        <name>secp256k1_musig_secnonce_magic</name>
        <initializer>= { 0x22, 0x0e, 0xdc, 0xf1 }</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="55" column="28" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="55" bodyend="55"/>
      </memberdef>
      <memberdef kind="variable" id="session__impl_8h_1ad90fc185bd3190d7dc34ab641cc53ed3" prot="public" static="yes" mutable="no">
        <type>const unsigned char</type>
        <definition>const unsigned char secp256k1_musig_pubnonce_magic[4]</definition>
        <argsstring>[4]</argsstring>
        <name>secp256k1_musig_pubnonce_magic</name>
        <initializer>= { 0xf5, 0x7a, 0x3d, 0xa0 }</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="90" column="28" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="90" bodyend="90"/>
      </memberdef>
      <memberdef kind="variable" id="session__impl_8h_1a3135d0ab4c578fb8207d44c765744224" prot="public" static="yes" mutable="no">
        <type>const unsigned char</type>
        <definition>const unsigned char secp256k1_musig_aggnonce_magic[4]</definition>
        <argsstring>[4]</argsstring>
        <name>secp256k1_musig_aggnonce_magic</name>
        <initializer>= { 0xa8, 0xb7, 0xe4, 0x67 }</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="114" column="28" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="114" bodyend="114"/>
      </memberdef>
      <memberdef kind="variable" id="session__impl_8h_1a7296349b09e4c83f5af8d9033d984e91" prot="public" static="yes" mutable="no">
        <type>const unsigned char</type>
        <definition>const unsigned char secp256k1_musig_session_cache_magic[4]</definition>
        <argsstring>[4]</argsstring>
        <name>secp256k1_musig_session_cache_magic</name>
        <initializer>= { 0x9d, 0xed, 0xe9, 0x17 }</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="134" column="28" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="134" bodyend="134"/>
      </memberdef>
      <memberdef kind="variable" id="session__impl_8h_1a6182db7120005d49334d695a321d9632" prot="public" static="yes" mutable="no">
        <type>const unsigned char</type>
        <definition>const unsigned char secp256k1_musig_partial_sig_magic[4]</definition>
        <argsstring>[4]</argsstring>
        <name>secp256k1_musig_partial_sig_magic</name>
        <initializer>= { 0xeb, 0xfb, 0x1a, 0x32 }</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="177" column="28" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="177" bodyend="177"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="func">
      <memberdef kind="function" id="session__impl_8h_1a3af9ab79148a08b9d5f315a3cad39bec" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_musig_ge_serialize_ext</definition>
        <argsstring>(unsigned char *out33, secp256k1_ge *ge)</argsstring>
        <name>secp256k1_musig_ge_serialize_ext</name>
        <param>
          <type>unsigned char *</type>
          <declname>out33</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>ge</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="24" column="13" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="24" bodyend="38"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1ab9a08bd6bfb6ad6754e69b33da0c85f2" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_musig_ge_parse_ext</definition>
        <argsstring>(secp256k1_ge *ge, const unsigned char *in33)</argsstring>
        <name>secp256k1_musig_ge_parse_ext</name>
        <param>
          <type><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>ge</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>in33</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="42" column="12" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="42" bodyend="53"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a09afbf1b45a0ab161860fe61ef9321e5" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_musig_secnonce_save</definition>
        <argsstring>(secp256k1_musig_secnonce *secnonce, const secp256k1_scalar *k, const secp256k1_ge *pk)</argsstring>
        <name>secp256k1_musig_secnonce_save</name>
        <param>
          <type><ref refid="structsecp256k1__musig__secnonce" kindref="compound">secp256k1_musig_secnonce</ref> *</type>
          <declname>secnonce</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>k</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>pk</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="57" column="13" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="57" bodyend="62"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a7c67a46beb3640fa88ea4798c89742c8" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_musig_secnonce_load</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_scalar *k, secp256k1_ge *pk, const secp256k1_musig_secnonce *secnonce)</argsstring>
        <name>secp256k1_musig_secnonce_load</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>k</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>pk</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__secnonce" kindref="compound">secp256k1_musig_secnonce</ref> *</type>
          <declname>secnonce</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="64" column="12" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="64" bodyend="77"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a86b8a224c0fd008cd989a5b6c334d942" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_musig_secnonce_invalidate</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_musig_secnonce *secnonce, int flag)</argsstring>
        <name>secp256k1_musig_secnonce_invalidate</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__secnonce" kindref="compound">secp256k1_musig_secnonce</ref> *</type>
          <declname>secnonce</declname>
        </param>
        <param>
          <type>int</type>
          <declname>flag</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="80" column="13" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="80" bodyend="88"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1afb6e3c8be48c0aa6cbe1c94b5b119be2" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_musig_pubnonce_save</definition>
        <argsstring>(secp256k1_musig_pubnonce *nonce, const secp256k1_ge *ges)</argsstring>
        <name>secp256k1_musig_pubnonce_save</name>
        <param>
          <type><ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref> *</type>
          <declname>nonce</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>ges</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="94" column="13" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="94" bodyend="100"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a7066859cf33032cc34ca3e63e1744f3d" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_musig_pubnonce_load</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_ge *ges, const secp256k1_musig_pubnonce *nonce)</argsstring>
        <name>secp256k1_musig_pubnonce_load</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>ges</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref> *</type>
          <declname>nonce</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="104" column="12" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="104" bodyend="112"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a57fbe9904e23088f8dfb3196b913cf27" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_musig_aggnonce_save</definition>
        <argsstring>(secp256k1_musig_aggnonce *nonce, const secp256k1_ge *ges)</argsstring>
        <name>secp256k1_musig_aggnonce_save</name>
        <param>
          <type><ref refid="structsecp256k1__musig__aggnonce" kindref="compound">secp256k1_musig_aggnonce</ref> *</type>
          <declname>nonce</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>ges</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="116" column="13" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="116" bodyend="122"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1af296bc9934bbd61996d4982f613753e1" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_musig_aggnonce_load</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_ge *ges, const secp256k1_musig_aggnonce *nonce)</argsstring>
        <name>secp256k1_musig_aggnonce_load</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>ges</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__aggnonce" kindref="compound">secp256k1_musig_aggnonce</ref> *</type>
          <declname>nonce</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="124" column="12" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="124" bodyend="132"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a9b742c2863df2c5730024c37147993f2" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_musig_session_save</definition>
        <argsstring>(secp256k1_musig_session *session, const secp256k1_musig_session_internal *session_i)</argsstring>
        <name>secp256k1_musig_session_save</name>
        <param>
          <type><ref refid="structsecp256k1__musig__session" kindref="compound">secp256k1_musig_session</ref> *</type>
          <declname>session</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__session__internal" kindref="compound">secp256k1_musig_session_internal</ref> *</type>
          <declname>session_i</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="144" column="13" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="144" bodyend="158"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1ac1e8e726ab352a851a56af775fa5aca6" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_musig_session_load</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_musig_session_internal *session_i, const secp256k1_musig_session *session)</argsstring>
        <name>secp256k1_musig_session_load</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__session__internal" kindref="compound">secp256k1_musig_session_internal</ref> *</type>
          <declname>session_i</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__session" kindref="compound">secp256k1_musig_session</ref> *</type>
          <declname>session</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="160" column="12" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="160" bodyend="175"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a84a61c8ebecfb719fb79b456d07ebf50" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_musig_partial_sig_save</definition>
        <argsstring>(secp256k1_musig_partial_sig *sig, secp256k1_scalar *s)</argsstring>
        <name>secp256k1_musig_partial_sig_save</name>
        <param>
          <type><ref refid="structsecp256k1__musig__partial__sig" kindref="compound">secp256k1_musig_partial_sig</ref> *</type>
          <declname>sig</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>s</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="179" column="13" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="179" bodyend="182"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a57df1988068131b949068ed62faf1b84" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_musig_partial_sig_load</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_scalar *s, const secp256k1_musig_partial_sig *sig)</argsstring>
        <name>secp256k1_musig_partial_sig_load</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>s</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__partial__sig" kindref="compound">secp256k1_musig_partial_sig</ref> *</type>
          <declname>sig</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="184" column="12" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="184" bodyend="192"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1af056793e0da13f6a4e9e83758fd8819a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_musig_pubnonce_parse</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_musig_pubnonce *nonce, const unsigned char *in66)</argsstring>
        <name>secp256k1_musig_pubnonce_parse</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref> *</type>
          <declname>nonce</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>in66</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Parse a signer&apos;s public nonce.</para>
<para>Returns: 1 when the nonce could be parsed, 0 otherwise. Args: ctx: pointer to a context object Out: nonce: pointer to a nonce object In: in66: pointer to the 66-byte nonce to be parsed </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="194" column="5" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="194" bodyend="212"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1afc95a7052d1f59d6ca498b25c0b0f695" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_musig_pubnonce_serialize</definition>
        <argsstring>(const secp256k1_context *ctx, unsigned char *out66, const secp256k1_musig_pubnonce *nonce)</argsstring>
        <name>secp256k1_musig_pubnonce_serialize</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type>unsigned char *</type>
          <declname>out66</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref> *</type>
          <declname>nonce</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Serialize a signer&apos;s public nonce</para>
<para>Returns: 1 always Args: ctx: pointer to a context object Out: out66: pointer to a 66-byte array to store the serialized nonce In: nonce: pointer to the nonce </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="214" column="5" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="214" bodyend="238"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a9d872cf01aaaa14e59dad5a8cc914957" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_musig_aggnonce_parse</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_musig_aggnonce *nonce, const unsigned char *in66)</argsstring>
        <name>secp256k1_musig_aggnonce_parse</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__aggnonce" kindref="compound">secp256k1_musig_aggnonce</ref> *</type>
          <declname>nonce</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>in66</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Parse an aggregate public nonce.</para>
<para>Returns: 1 when the nonce could be parsed, 0 otherwise. Args: ctx: pointer to a context object Out: nonce: pointer to a nonce object In: in66: pointer to the 66-byte nonce to be parsed </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="240" column="5" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="240" bodyend="255"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a43fae1272df0b8ad18979b0a9b92de71" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_musig_aggnonce_serialize</definition>
        <argsstring>(const secp256k1_context *ctx, unsigned char *out66, const secp256k1_musig_aggnonce *nonce)</argsstring>
        <name>secp256k1_musig_aggnonce_serialize</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type>unsigned char *</type>
          <declname>out66</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__aggnonce" kindref="compound">secp256k1_musig_aggnonce</ref> *</type>
          <declname>nonce</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Serialize an aggregate public nonce</para>
<para>Returns: 1 always Args: ctx: pointer to a context object Out: out66: pointer to a 66-byte array to store the serialized nonce In: nonce: pointer to the nonce </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="257" column="5" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="257" bodyend="273"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1ae4a5d7ef0dd5a03fdcd4fc5b99ac3b9e" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_musig_partial_sig_parse</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_musig_partial_sig *sig, const unsigned char *in32)</argsstring>
        <name>secp256k1_musig_partial_sig_parse</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__partial__sig" kindref="compound">secp256k1_musig_partial_sig</ref> *</type>
          <declname>sig</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>in32</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Parse a MuSig partial signature.</para>
<para>Returns: 1 when the signature could be parsed, 0 otherwise. Args: ctx: pointer to a context object Out: sig: pointer to a signature object In: in32: pointer to the 32-byte signature to be parsed </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="275" column="5" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="275" bodyend="292"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a4b8e427d8d38088b5191c63d0cfde740" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_musig_partial_sig_serialize</definition>
        <argsstring>(const secp256k1_context *ctx, unsigned char *out32, const secp256k1_musig_partial_sig *sig)</argsstring>
        <name>secp256k1_musig_partial_sig_serialize</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type>unsigned char *</type>
          <declname>out32</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__partial__sig" kindref="compound">secp256k1_musig_partial_sig</ref> *</type>
          <declname>sig</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Serialize a MuSig partial signature</para>
<para>Returns: 1 always Args: ctx: pointer to a context object Out: out32: pointer to a 32-byte array to store the serialized signature In: sig: pointer to the signature </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="294" column="5" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="294" bodyend="302"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1ad37d8fdc7c56063bb8de660fd91d77cf" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_nonce_function_musig_helper</definition>
        <argsstring>(secp256k1_sha256 *sha, unsigned int prefix_size, const unsigned char *data, unsigned char len)</argsstring>
        <name>secp256k1_nonce_function_musig_helper</name>
        <param>
          <type><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref> *</type>
          <declname>sha</declname>
        </param>
        <param>
          <type>unsigned int</type>
          <declname>prefix_size</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>data</declname>
        </param>
        <param>
          <type>unsigned char</type>
          <declname>len</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="305" column="13" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="305" bodyend="320"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a7700c00c0968f3652577c665fd96f9fd" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_nonce_function_musig_sha256_tagged_aux</definition>
        <argsstring>(secp256k1_sha256 *sha)</argsstring>
        <name>secp256k1_nonce_function_musig_sha256_tagged_aux</name>
        <param>
          <type><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref> *</type>
          <declname>sha</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="324" column="13" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="324" bodyend="335"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a7cfb5d9e093fcac166c9fc32445fdb64" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_nonce_function_musig_sha256_tagged</definition>
        <argsstring>(secp256k1_sha256 *sha)</argsstring>
        <name>secp256k1_nonce_function_musig_sha256_tagged</name>
        <param>
          <type><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref> *</type>
          <declname>sha</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="339" column="13" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="339" bodyend="350"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a6d033cfc38c20d08d772c12cdf30eda8" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_nonce_function_musig</definition>
        <argsstring>(secp256k1_scalar *k, const unsigned char *session_secrand, const unsigned char *msg32, const unsigned char *seckey32, const unsigned char *pk33, const unsigned char *agg_pk32, const unsigned char *extra_input32)</argsstring>
        <name>secp256k1_nonce_function_musig</name>
        <param>
          <type><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>k</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>session_secrand</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>msg32</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>seckey32</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>pk33</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>agg_pk32</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>extra_input32</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="352" column="13" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="352" bodyend="393"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a0d23990582e1640566009bfca310211c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_musig_nonce_gen_internal</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_musig_secnonce *secnonce, secp256k1_musig_pubnonce *pubnonce, const unsigned char *input_nonce, const unsigned char *seckey, const secp256k1_pubkey *pubkey, const unsigned char *msg32, const secp256k1_musig_keyagg_cache *keyagg_cache, const unsigned char *extra_input32)</argsstring>
        <name>secp256k1_musig_nonce_gen_internal</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__secnonce" kindref="compound">secp256k1_musig_secnonce</ref> *</type>
          <declname>secnonce</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref> *</type>
          <declname>pubnonce</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>input_nonce</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>seckey</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref> *</type>
          <declname>pubkey</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>msg32</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref> *</type>
          <declname>keyagg_cache</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>extra_input32</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="395" column="12" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="395" bodyend="467"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a3df8ee129f48649f6973d7b3426d7ac0" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_musig_nonce_gen</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_musig_secnonce *secnonce, secp256k1_musig_pubnonce *pubnonce, unsigned char *session_secrand32, const unsigned char *seckey, const secp256k1_pubkey *pubkey, const unsigned char *msg32, const secp256k1_musig_keyagg_cache *keyagg_cache, const unsigned char *extra_input32)</argsstring>
        <name>secp256k1_musig_nonce_gen</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__secnonce" kindref="compound">secp256k1_musig_secnonce</ref> *</type>
          <declname>secnonce</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref> *</type>
          <declname>pubnonce</declname>
        </param>
        <param>
          <type>unsigned char *</type>
          <declname>session_secrand32</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>seckey</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref> *</type>
          <declname>pubkey</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>msg32</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref> *</type>
          <declname>keyagg_cache</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>extra_input32</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Starts a signing session by generating a nonce</para>
<para>This function outputs a secret nonce that will be required for signing and a corresponding public nonce that is intended to be sent to other signers.</para>
<para>MuSig differs from regular Schnorr signing in that implementers <emphasis>must</emphasis> take special care to not reuse a nonce. This can be ensured by following these rules:</para>
<para><orderedlist>
<listitem><para>Each call to this function must have a UNIQUE session_secrand32 that must NOT BE REUSED in subsequent calls to this function and must be KEPT SECRET (even from other signers).</para>
</listitem><listitem><para>If you already know the seckey, message or aggregate public key cache, they can be optionally provided to derive the nonce and increase misuse-resistance. The extra_input32 argument can be used to provide additional data that does not repeat in normal scenarios, such as the current time.</para>
</listitem><listitem><para>Avoid copying (or serializing) the secnonce. This reduces the possibility that it is used more than once for signing.</para>
</listitem></orderedlist>
</para>
<para>If you don&apos;t have access to good randomness for session_secrand32, but you have access to a non-repeating counter, then see secp256k1_musig_nonce_gen_counter.</para>
<para>Remember that nonce reuse will leak the secret key! Note that using the same seckey for multiple MuSig sessions is fine.</para>
<para>Returns: 0 if the arguments are invalid and 1 otherwise Args: ctx: pointer to a context object (not secp256k1_context_static) Out: secnonce: pointer to a structure to store the secret nonce pubnonce: pointer to a structure to store the public nonce In/Out: session_secrand32: a 32-byte session_secrand32 as explained above. Must be unique to this call to secp256k1_musig_nonce_gen and must be uniformly random. If the function call is successful, the session_secrand32 buffer is invalidated to prevent reuse. In: seckey: the 32-byte secret key that will later be used for signing, if already known (can be NULL) pubkey: public key of the signer creating the nonce. The secnonce output of this function cannot be used to sign for any other public key. While the public key should correspond to the provided seckey, a mismatch will not cause the function to return 0. msg32: the 32-byte message that will later be signed, if already known (can be NULL) keyagg_cache: pointer to the keyagg_cache that was used to create the aggregate (and potentially tweaked) public key if already known (can be NULL) extra_input32: an optional 32-byte array that is input to the nonce derivation function (can be NULL) </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="469" column="5" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="469" bodyend="495"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a4e9bb7524abb0090eb116ff27b35e3ff" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_musig_nonce_gen_counter</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_musig_secnonce *secnonce, secp256k1_musig_pubnonce *pubnonce, uint64_t nonrepeating_cnt, const secp256k1_keypair *keypair, const unsigned char *msg32, const secp256k1_musig_keyagg_cache *keyagg_cache, const unsigned char *extra_input32)</argsstring>
        <name>secp256k1_musig_nonce_gen_counter</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__secnonce" kindref="compound">secp256k1_musig_secnonce</ref> *</type>
          <declname>secnonce</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref> *</type>
          <declname>pubnonce</declname>
        </param>
        <param>
          <type>uint64_t</type>
          <declname>nonrepeating_cnt</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__keypair" kindref="compound">secp256k1_keypair</ref> *</type>
          <declname>keypair</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>msg32</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref> *</type>
          <declname>keyagg_cache</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>extra_input32</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Alternative way to generate a nonce and start a signing session</para>
<para>This function outputs a secret nonce that will be required for signing and a corresponding public nonce that is intended to be sent to other signers.</para>
<para>This function differs from <computeroutput><ref refid="secp256k1__musig_8h_1a7ec24f575d1e46794f3ce3532a03615b" kindref="member">secp256k1_musig_nonce_gen</ref></computeroutput> by accepting a non-repeating counter value instead of a secret random value. This requires that a secret key is provided to <computeroutput><ref refid="secp256k1__musig_8h_1acf856b8cbcfc932add9d68a6a4e941b7" kindref="member">secp256k1_musig_nonce_gen_counter</ref></computeroutput> (through the keypair argument), as opposed to <computeroutput><ref refid="secp256k1__musig_8h_1a7ec24f575d1e46794f3ce3532a03615b" kindref="member">secp256k1_musig_nonce_gen</ref></computeroutput> where the seckey argument is optional.</para>
<para>MuSig differs from regular Schnorr signing in that implementers <emphasis>must</emphasis> take special care to not reuse a nonce. This can be ensured by following these rules:</para>
<para><orderedlist>
<listitem><para>The nonrepeating_cnt argument must be a counter value that never repeats, i.e., you must never call <computeroutput><ref refid="secp256k1__musig_8h_1acf856b8cbcfc932add9d68a6a4e941b7" kindref="member">secp256k1_musig_nonce_gen_counter</ref></computeroutput> twice with the same keypair and nonrepeating_cnt value. For example, this implies that if the same keypair is used with <computeroutput><ref refid="secp256k1__musig_8h_1acf856b8cbcfc932add9d68a6a4e941b7" kindref="member">secp256k1_musig_nonce_gen_counter</ref></computeroutput> on multiple devices, none of the devices should have the same counter value as any other device.</para>
</listitem><listitem><para>If the seckey, message or aggregate public key cache is already available at this stage, any of these can be optionally provided, in which case they will be used in the derivation of the nonce and increase misuse-resistance. The extra_input32 argument can be used to provide additional data that does not repeat in normal scenarios, such as the current time.</para>
</listitem><listitem><para>Avoid copying (or serializing) the secnonce. This reduces the possibility that it is used more than once for signing.</para>
</listitem></orderedlist>
</para>
<para>Remember that nonce reuse will leak the secret key! Note that using the same keypair for multiple MuSig sessions is fine.</para>
<para>Returns: 0 if the arguments are invalid and 1 otherwise Args: ctx: pointer to a context object (not secp256k1_context_static) Out: secnonce: pointer to a structure to store the secret nonce pubnonce: pointer to a structure to store the public nonce In: nonrepeating_cnt: the value of a counter as explained above. Must be unique to this call to secp256k1_musig_nonce_gen. keypair: keypair of the signer creating the nonce. The secnonce output of this function cannot be used to sign for any other keypair. msg32: the 32-byte message that will later be signed, if already known (can be NULL) keyagg_cache: pointer to the keyagg_cache that was used to create the aggregate (and potentially tweaked) public key if already known (can be NULL) extra_input32: an optional 32-byte array that is input to the nonce derivation function (can be NULL) </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="497" column="5" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="497" bodyend="523"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a48581afe3daeefdfe30751a4b419ce98" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int secp256k1_musig_sum_pubnonces</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_gej *summed_pubnonces, const secp256k1_musig_pubnonce *const *pubnonces, size_t n_pubnonces)</argsstring>
        <name>secp256k1_musig_sum_pubnonces</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref> *</type>
          <declname>summed_pubnonces</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref> *const *</type>
          <declname>pubnonces</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n_pubnonces</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="525" column="12" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="525" bodyend="542"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1ac6576fa35eb1d7ad9d3e9a6e27946b3f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_musig_nonce_agg</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_musig_aggnonce *aggnonce, const secp256k1_musig_pubnonce *const *pubnonces, size_t n_pubnonces)</argsstring>
        <name>secp256k1_musig_nonce_agg</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__aggnonce" kindref="compound">secp256k1_musig_aggnonce</ref> *</type>
          <declname>aggnonce</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref> *const *</type>
          <declname>pubnonces</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n_pubnonces</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Aggregates the nonces of all signers into a single nonce</para>
<para>This can be done by an untrusted party to reduce the communication between signers. Instead of everyone sending nonces to everyone else, there can be one party receiving all nonces, aggregating the nonces with this function and then sending only the aggregate nonce back to the signers.</para>
<para>If the aggregator does not compute the aggregate nonce correctly, the final signature will be invalid.</para>
<para>Returns: 0 if the arguments are invalid, 1 otherwise Args: ctx: pointer to a context object Out: aggnonce: pointer to an aggregate public nonce object for musig_nonce_process In: pubnonces: array of pointers to public nonces sent by the signers n_pubnonces: number of elements in the pubnonces array. Must be greater than 0. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="544" column="5" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="544" bodyend="558"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a72d5f67f3d47fa236e2c26e269df0c9c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_musig_compute_noncehash_sha256_tagged</definition>
        <argsstring>(secp256k1_sha256 *sha)</argsstring>
        <name>secp256k1_musig_compute_noncehash_sha256_tagged</name>
        <param>
          <type><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref> *</type>
          <declname>sha</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="562" column="13" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="562" bodyend="573"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1ae873673f385df4b09270f47ed2812689" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_musig_compute_noncehash</definition>
        <argsstring>(unsigned char *noncehash, secp256k1_ge *aggnonce, const unsigned char *agg_pk32, const unsigned char *msg)</argsstring>
        <name>secp256k1_musig_compute_noncehash</name>
        <param>
          <type>unsigned char *</type>
          <declname>noncehash</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>aggnonce</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>agg_pk32</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>msg</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="576" column="13" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="576" bodyend="589"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1aac5fad16926b36c388d2cfec0331e44c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_effective_nonce</definition>
        <argsstring>(secp256k1_gej *out_nonce, const secp256k1_ge *nonce_pts, const secp256k1_scalar *b)</argsstring>
        <name>secp256k1_effective_nonce</name>
        <param>
          <type><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref> *</type>
          <declname>out_nonce</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>nonce_pts</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>b</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="592" column="13" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="592" bodyend="598"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a154b771729435b20f78d0c83ceb487a9" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_musig_nonce_process_internal</definition>
        <argsstring>(int *fin_nonce_parity, unsigned char *fin_nonce, secp256k1_scalar *b, secp256k1_ge *aggnonce_pts, const unsigned char *agg_pk32, const unsigned char *msg)</argsstring>
        <name>secp256k1_musig_nonce_process_internal</name>
        <param>
          <type>int *</type>
          <declname>fin_nonce_parity</declname>
        </param>
        <param>
          <type>unsigned char *</type>
          <declname>fin_nonce</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>b</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref> *</type>
          <declname>aggnonce_pts</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>agg_pk32</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>msg</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="600" column="13" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="600" bodyend="618"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1ab327f436aa657318ab2362972cee36b1" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_musig_nonce_process</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_musig_session *session, const secp256k1_musig_aggnonce *aggnonce, const unsigned char *msg32, const secp256k1_musig_keyagg_cache *keyagg_cache)</argsstring>
        <name>secp256k1_musig_nonce_process</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__session" kindref="compound">secp256k1_musig_session</ref> *</type>
          <declname>session</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__aggnonce" kindref="compound">secp256k1_musig_aggnonce</ref> *</type>
          <declname>aggnonce</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>msg32</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref> *</type>
          <declname>keyagg_cache</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Takes the aggregate nonce and creates a session that is required for signing and verification of partial signatures.</para>
<para>Returns: 0 if the arguments are invalid, 1 otherwise Args: ctx: pointer to a context object Out: session: pointer to a struct to store the session In: aggnonce: pointer to an aggregate public nonce object that is the output of musig_nonce_agg msg32: the 32-byte message to sign keyagg_cache: pointer to the keyagg_cache that was used to create the aggregate (and potentially tweaked) pubkey </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="620" column="5" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="620" bodyend="658"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1ad51172008388904285b1ef99698833b3" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void secp256k1_musig_partial_sign_clear</definition>
        <argsstring>(secp256k1_scalar *sk, secp256k1_scalar *k)</argsstring>
        <name>secp256k1_musig_partial_sign_clear</name>
        <param>
          <type><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>sk</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref> *</type>
          <declname>k</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="660" column="13" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="660" bodyend="664"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a1d51739b87304a56fa38b8560e39cd83" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_musig_partial_sign</definition>
        <argsstring>(const secp256k1_context *ctx, secp256k1_musig_partial_sig *partial_sig, secp256k1_musig_secnonce *secnonce, const secp256k1_keypair *keypair, const secp256k1_musig_keyagg_cache *keyagg_cache, const secp256k1_musig_session *session)</argsstring>
        <name>secp256k1_musig_partial_sign</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__partial__sig" kindref="compound">secp256k1_musig_partial_sig</ref> *</type>
          <declname>partial_sig</declname>
        </param>
        <param>
          <type><ref refid="structsecp256k1__musig__secnonce" kindref="compound">secp256k1_musig_secnonce</ref> *</type>
          <declname>secnonce</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__keypair" kindref="compound">secp256k1_keypair</ref> *</type>
          <declname>keypair</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref> *</type>
          <declname>keyagg_cache</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__session" kindref="compound">secp256k1_musig_session</ref> *</type>
          <declname>session</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Produces a partial signature</para>
<para>This function overwrites the given secnonce with zeros and will abort if given a secnonce that is all zeros. This is a best effort attempt to protect against nonce reuse. However, this is of course easily defeated if the secnonce has been copied (or serialized). Remember that nonce reuse will leak the secret key!</para>
<para>For signing to succeed, the secnonce provided to this function must have been generated for the provided keypair. This means that when signing for a keypair consisting of a seckey and pubkey, the secnonce must have been created by calling musig_nonce_gen with that pubkey. Otherwise, the illegal_callback is called.</para>
<para>This function does not verify the output partial signature, deviating from the BIP 327 specification. It is recommended to verify the output partial signature with <computeroutput><ref refid="secp256k1__musig_8h_1a94cce9a0b321047ba1f341bc8f3f8ee3" kindref="member">secp256k1_musig_partial_sig_verify</ref></computeroutput> to prevent random or adversarially provoked computation errors.</para>
<para>Returns: 0 if the arguments are invalid or the provided secnonce has already been used for signing, 1 otherwise Args: ctx: pointer to a context object Out: partial_sig: pointer to struct to store the partial signature In/Out: secnonce: pointer to the secnonce struct created in musig_nonce_gen that has been never used in a partial_sign call before and has been created for the keypair In: keypair: pointer to keypair to sign the message with keyagg_cache: pointer to the keyagg_cache that was output when the aggregate public key for this session session: pointer to the session that was created with musig_nonce_process </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="666" column="5" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="666" bodyend="734"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a8919645dbc6e72741a6df8ac3202ab1c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_musig_partial_sig_verify</definition>
        <argsstring>(const secp256k1_context *ctx, const secp256k1_musig_partial_sig *partial_sig, const secp256k1_musig_pubnonce *pubnonce, const secp256k1_pubkey *pubkey, const secp256k1_musig_keyagg_cache *keyagg_cache, const secp256k1_musig_session *session)</argsstring>
        <name>secp256k1_musig_partial_sig_verify</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__partial__sig" kindref="compound">secp256k1_musig_partial_sig</ref> *</type>
          <declname>partial_sig</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref> *</type>
          <declname>pubnonce</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref> *</type>
          <declname>pubkey</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref> *</type>
          <declname>keyagg_cache</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__session" kindref="compound">secp256k1_musig_session</ref> *</type>
          <declname>session</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Verifies an individual signer&apos;s partial signature</para>
<para>The signature is verified for a specific signing session. In order to avoid accidentally verifying a signature from a different or non-existing signing session, you must ensure the following:<orderedlist>
<listitem><para>The <computeroutput>keyagg_cache</computeroutput> argument is identical to the one used to create the <computeroutput>session</computeroutput> with <computeroutput>musig_nonce_process</computeroutput>.</para>
</listitem><listitem><para>The <computeroutput>pubkey</computeroutput> argument must be identical to the one sent by the signer before aggregating it with <computeroutput>musig_pubkey_agg</computeroutput> to create the <computeroutput>keyagg_cache</computeroutput>.</para>
</listitem><listitem><para>The <computeroutput>pubnonce</computeroutput> argument must be identical to the one sent by the signer before aggregating it with <computeroutput>musig_nonce_agg</computeroutput> and using the result to create the <computeroutput>session</computeroutput> with <computeroutput>musig_nonce_process</computeroutput>.</para>
</listitem></orderedlist>
</para>
<para>It is not required to call this function in regular MuSig sessions, because if any partial signature does not verify, the final signature will not verify either, so the problem will be caught. However, this function provides the ability to identify which specific partial signature fails verification.</para>
<para>Returns: 0 if the arguments are invalid or the partial signature does not verify, 1 otherwise Args ctx: pointer to a context object In: partial_sig: pointer to partial signature to verify, sent by the signer associated with <computeroutput>pubnonce</computeroutput> and <computeroutput>pubkey</computeroutput> pubnonce: public nonce of the signer in the signing session pubkey: public key of the signer in the signing session keyagg_cache: pointer to the keyagg_cache that was output when the aggregate public key for this signing session session: pointer to the session that was created with <computeroutput>musig_nonce_process</computeroutput> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="736" column="5" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="736" bodyend="797"/>
      </memberdef>
      <memberdef kind="function" id="session__impl_8h_1a5caae9c879594c721031cc6cdaea16d6" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int secp256k1_musig_partial_sig_agg</definition>
        <argsstring>(const secp256k1_context *ctx, unsigned char *sig64, const secp256k1_musig_session *session, const secp256k1_musig_partial_sig *const *partial_sigs, size_t n_sigs)</argsstring>
        <name>secp256k1_musig_partial_sig_agg</name>
        <param>
          <type>const <ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type>unsigned char *</type>
          <declname>sig64</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__session" kindref="compound">secp256k1_musig_session</ref> *</type>
          <declname>session</declname>
        </param>
        <param>
          <type>const <ref refid="structsecp256k1__musig__partial__sig" kindref="compound">secp256k1_musig_partial_sig</ref> *const *</type>
          <declname>partial_sigs</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n_sigs</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Aggregates partial signatures</para>
<para>Returns: 0 if the arguments are invalid, 1 otherwise (which does NOT mean the resulting signature verifies). Args: ctx: pointer to a context object Out: sig64: complete (but possibly invalid) Schnorr signature In: session: pointer to the session that was created with musig_nonce_process partial_sigs: array of pointers to partial signatures to aggregate n_sigs: number of elements in the partial_sigs array. Must be greater than 0. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/secp256k1/src/modules/musig/session_impl.h" line="799" column="5" bodyfile="src/secp256k1/src/modules/musig/session_impl.h" bodystart="799" bodyend="822"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/***********************************************************************</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>Distributed<sp/>under<sp/>the<sp/>MIT<sp/>software<sp/>license,<sp/>see<sp/>the<sp/>accompanying<sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>file<sp/>COPYING<sp/>or<sp/>https://www.opensource.org/licenses/mit-license.php.*</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>***********************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>SECP256K1_MODULE_MUSIG_SESSION_IMPL_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>SECP256K1_MODULE_MUSIG_SESSION_IMPL_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="string_8h" kindref="compound">string.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="secp256k1_8h" kindref="compound">../../../include/secp256k1.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="secp256k1__extrakeys_8h" kindref="compound">../../../include/secp256k1_extrakeys.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="secp256k1__musig_8h" kindref="compound">../../../include/secp256k1_musig.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="keyagg_8h" kindref="compound">keyagg.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="session_8h" kindref="compound">session.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="eckey_8h" kindref="compound">../../eckey.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="secp256k1_2src_2hash_8h" kindref="compound">../../hash.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="scalar_8h" kindref="compound">../../scalar.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="secp256k1_2src_2util_8h" kindref="compound">../../util.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Outputs<sp/>33<sp/>zero<sp/>bytes<sp/>if<sp/>the<sp/>given<sp/>group<sp/>element<sp/>is<sp/>the<sp/>point<sp/>at<sp/>infinity<sp/>and</highlight></codeline>
<codeline lineno="23"><highlight class="comment"><sp/>*<sp/>otherwise<sp/>outputs<sp/>the<sp/>compressed<sp/>serialization<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_musig_ge_serialize_ext(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*out33,<sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref>*<sp/>ge)<sp/>{</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(secp256k1_ge_is_infinity(ge))<sp/>{</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memset(out33,<sp/>0,<sp/>33);</highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>size<sp/>=<sp/>33;</highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/>secp256k1_eckey_pubkey_serialize(ge,<sp/>out33,<sp/>&amp;size,<sp/>1);</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>VERIFY</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Serialize<sp/>must<sp/>succeed<sp/>because<sp/>the<sp/>point<sp/>is<sp/>not<sp/>at<sp/>infinity<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>&amp;&amp;<sp/>size<sp/>==<sp/>33);</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(void)<sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="38"><highlight class="normal">}</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Outputs<sp/>the<sp/>point<sp/>at<sp/>infinity<sp/>if<sp/>the<sp/>given<sp/>byte<sp/>array<sp/>is<sp/>all<sp/>zero,<sp/>otherwise</highlight></codeline>
<codeline lineno="41"><highlight class="comment"><sp/>*<sp/>attempts<sp/>to<sp/>parse<sp/>compressed<sp/>point<sp/>serialization.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_musig_ge_parse_ext(<ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref>*<sp/>ge,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*in33)<sp/>{</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>zeros[33]<sp/>=<sp/>{<sp/>0<sp/>};</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(secp256k1_memcmp_var(in33,<sp/>zeros,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(zeros))<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ge_set_infinity(ge);</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_eckey_pubkey_parse(ge,<sp/>in33,<sp/>33))<sp/>{</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>secp256k1_ge_is_in_correct_subgroup(ge);</highlight></codeline>
<codeline lineno="53"><highlight class="normal">}</highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>secp256k1_musig_secnonce_magic[4]<sp/>=<sp/>{<sp/>0x22,<sp/>0x0e,<sp/>0xdc,<sp/>0xf1<sp/>};</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_musig_secnonce_save(<ref refid="structsecp256k1__musig__secnonce" kindref="compound">secp256k1_musig_secnonce</ref><sp/>*secnonce,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*pk)<sp/>{</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(&amp;secnonce-&gt;<ref refid="structsecp256k1__musig__secnonce_1a66fdcf3f6b931a5854a71278169ca12f" kindref="member">data</ref>[0],<sp/>secp256k1_musig_secnonce_magic,<sp/>4);</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_get_b32(&amp;secnonce-&gt;<ref refid="structsecp256k1__musig__secnonce_1a66fdcf3f6b931a5854a71278169ca12f" kindref="member">data</ref>[4],<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[0]);</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_get_b32(&amp;secnonce-&gt;<ref refid="structsecp256k1__musig__secnonce_1a66fdcf3f6b931a5854a71278169ca12f" kindref="member">data</ref>[36],<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[1]);</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ge_to_bytes(&amp;secnonce-&gt;<ref refid="structsecp256k1__musig__secnonce_1a66fdcf3f6b931a5854a71278169ca12f" kindref="member">data</ref>[68],<sp/>pk);</highlight></codeline>
<codeline lineno="62"><highlight class="normal">}</highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_musig_secnonce_load(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>,<sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*pk,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__secnonce" kindref="compound">secp256k1_musig_secnonce</ref><sp/>*secnonce)<sp/>{</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>is_zero;</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(secp256k1_memcmp_var(&amp;secnonce-&gt;<ref refid="structsecp256k1__musig__secnonce_1a66fdcf3f6b931a5854a71278169ca12f" kindref="member">data</ref>[0],<sp/>secp256k1_musig_secnonce_magic,<sp/>4)<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>We<sp/>make<sp/>very<sp/>sure<sp/>that<sp/>the<sp/>nonce<sp/>isn&apos;t<sp/>invalidated<sp/>by<sp/>checking<sp/>the<sp/>values</highlight></codeline>
<codeline lineno="68"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>in<sp/>addition<sp/>to<sp/>the<sp/>magic.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/>is_zero<sp/>=<sp/>secp256k1_is_zero_array(&amp;secnonce-&gt;<ref refid="structsecp256k1__musig__secnonce_1a66fdcf3f6b931a5854a71278169ca12f" kindref="member">data</ref>[4],<sp/>2<sp/>*<sp/>32);</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_declassify(ctx,<sp/>&amp;is_zero,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(is_zero));</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(!is_zero);</highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_set_b32(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[0],<sp/>&amp;secnonce-&gt;<ref refid="structsecp256k1__musig__secnonce_1a66fdcf3f6b931a5854a71278169ca12f" kindref="member">data</ref>[4],<sp/>NULL);</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_set_b32(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[1],<sp/>&amp;secnonce-&gt;<ref refid="structsecp256k1__musig__secnonce_1a66fdcf3f6b931a5854a71278169ca12f" kindref="member">data</ref>[36],<sp/>NULL);</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ge_from_bytes(pk,<sp/>&amp;secnonce-&gt;<ref refid="structsecp256k1__musig__secnonce_1a66fdcf3f6b931a5854a71278169ca12f" kindref="member">data</ref>[68]);</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="77"><highlight class="normal">}</highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>If<sp/>flag<sp/>is<sp/>true,<sp/>invalidate<sp/>the<sp/>secnonce;<sp/>otherwise<sp/>leave<sp/>it.<sp/>Constant-time.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_musig_secnonce_invalidate(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__musig__secnonce" kindref="compound">secp256k1_musig_secnonce</ref><sp/>*secnonce,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>flag)<sp/>{</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_memczero(secnonce-&gt;<ref refid="structsecp256k1__musig__secnonce_1a66fdcf3f6b931a5854a71278169ca12f" kindref="member">data</ref>,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(secnonce-&gt;<ref refid="structsecp256k1__musig__secnonce_1a66fdcf3f6b931a5854a71278169ca12f" kindref="member">data</ref>),<sp/>flag);</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>flag<sp/>argument<sp/>is<sp/>usually<sp/>classified.<sp/>So,<sp/>the<sp/>line<sp/>above<sp/>makes<sp/>the</highlight></codeline>
<codeline lineno="83"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>magic<sp/>and<sp/>public<sp/>key<sp/>classified.<sp/>However,<sp/>we<sp/>need<sp/>both<sp/>to<sp/>be</highlight></codeline>
<codeline lineno="84"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>declassified.<sp/>Note<sp/>that<sp/>we<sp/>don&apos;t<sp/>declassify<sp/>the<sp/>entire<sp/>object,<sp/>because<sp/>if</highlight></codeline>
<codeline lineno="85"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>flag<sp/>is<sp/>0,<sp/>then<sp/>k[0]<sp/>and<sp/>k[1]<sp/>have<sp/>not<sp/>been<sp/>zeroed.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_declassify(ctx,<sp/>secnonce-&gt;<ref refid="structsecp256k1__musig__secnonce_1a66fdcf3f6b931a5854a71278169ca12f" kindref="member">data</ref>,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(secp256k1_musig_secnonce_magic));</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_declassify(ctx,<sp/>&amp;secnonce-&gt;<ref refid="structsecp256k1__musig__secnonce_1a66fdcf3f6b931a5854a71278169ca12f" kindref="member">data</ref>[68],<sp/>64);</highlight></codeline>
<codeline lineno="88"><highlight class="normal">}</highlight></codeline>
<codeline lineno="89"><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>secp256k1_musig_pubnonce_magic[4]<sp/>=<sp/>{<sp/>0xf5,<sp/>0x7a,<sp/>0x3d,<sp/>0xa0<sp/>};</highlight></codeline>
<codeline lineno="91"><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Saves<sp/>two<sp/>group<sp/>elements<sp/>into<sp/>a<sp/>pubnonce.<sp/>Requires<sp/>that<sp/>none<sp/>of<sp/>the<sp/>provided</highlight></codeline>
<codeline lineno="93"><highlight class="comment"><sp/>*<sp/>group<sp/>elements<sp/>is<sp/>infinity.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_musig_pubnonce_save(<ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref>*<sp/><ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref>*<sp/>ges)<sp/>{</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(&amp;<ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>-&gt;data[0],<sp/>secp256k1_musig_pubnonce_magic,<sp/>4);</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ge_to_bytes(<ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>-&gt;data<sp/>+<sp/>4+64*i,<sp/>&amp;ges[i]);</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="100"><highlight class="normal">}</highlight></codeline>
<codeline lineno="101"><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Loads<sp/>two<sp/>group<sp/>elements<sp/>from<sp/>a<sp/>pubnonce.<sp/>Returns<sp/>1<sp/>unless<sp/>the<sp/>nonce<sp/>wasn&apos;t</highlight></codeline>
<codeline lineno="103"><highlight class="comment"><sp/>*<sp/>properly<sp/>initialized<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_musig_pubnonce_load(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref>*<sp/>ges,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref>*<sp/><ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>)<sp/>{</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="106"><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(secp256k1_memcmp_var(&amp;<ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>-&gt;data[0],<sp/>secp256k1_musig_pubnonce_magic,<sp/>4)<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ge_from_bytes(&amp;ges[i],<sp/><ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>-&gt;data<sp/>+<sp/>4<sp/>+<sp/>64*i);</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="112"><highlight class="normal">}</highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>secp256k1_musig_aggnonce_magic[4]<sp/>=<sp/>{<sp/>0xa8,<sp/>0xb7,<sp/>0xe4,<sp/>0x67<sp/>};</highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_musig_aggnonce_save(<ref refid="structsecp256k1__musig__aggnonce" kindref="compound">secp256k1_musig_aggnonce</ref>*<sp/><ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref>*<sp/>ges)<sp/>{</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(&amp;<ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>-&gt;data[0],<sp/>secp256k1_musig_aggnonce_magic,<sp/>4);</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ge_to_bytes_ext(&amp;<ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>-&gt;data[4<sp/>+<sp/>64*i],<sp/>&amp;ges[i]);</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="122"><highlight class="normal">}</highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_musig_aggnonce_load(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref>*<sp/>ges,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__aggnonce" kindref="compound">secp256k1_musig_aggnonce</ref>*<sp/><ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>)<sp/>{</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(secp256k1_memcmp_var(&amp;<ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>-&gt;data[0],<sp/>secp256k1_musig_aggnonce_magic,<sp/>4)<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ge_from_bytes_ext(&amp;ges[i],<sp/>&amp;<ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>-&gt;data[4<sp/>+<sp/>64*i]);</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="132"><highlight class="normal">}</highlight></codeline>
<codeline lineno="133"><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>secp256k1_musig_session_cache_magic[4]<sp/>=<sp/>{<sp/>0x9d,<sp/>0xed,<sp/>0xe9,<sp/>0x17<sp/>};</highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>A<sp/>session<sp/>consists<sp/>of</highlight></codeline>
<codeline lineno="137"><highlight class="comment"><sp/>*<sp/>-<sp/>4<sp/>byte<sp/>session<sp/>cache<sp/>magic</highlight></codeline>
<codeline lineno="138"><highlight class="comment"><sp/>*<sp/>-<sp/>1<sp/>byte<sp/>the<sp/>parity<sp/>of<sp/>the<sp/>final<sp/>nonce</highlight></codeline>
<codeline lineno="139"><highlight class="comment"><sp/>*<sp/>-<sp/>32<sp/>byte<sp/>serialized<sp/>x-only<sp/>final<sp/>nonce</highlight></codeline>
<codeline lineno="140"><highlight class="comment"><sp/>*<sp/>-<sp/>32<sp/>byte<sp/>nonce<sp/>coefficient<sp/>b</highlight></codeline>
<codeline lineno="141"><highlight class="comment"><sp/>*<sp/>-<sp/>32<sp/>byte<sp/>signature<sp/>challenge<sp/>hash<sp/>e</highlight></codeline>
<codeline lineno="142"><highlight class="comment"><sp/>*<sp/>-<sp/>32<sp/>byte<sp/>scalar<sp/>s<sp/>that<sp/>is<sp/>added<sp/>to<sp/>the<sp/>partial<sp/>signatures<sp/>of<sp/>the<sp/>signers</highlight></codeline>
<codeline lineno="143"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_musig_session_save(<ref refid="structsecp256k1__musig__session" kindref="compound">secp256k1_musig_session</ref><sp/>*session,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__session__internal" kindref="compound">secp256k1_musig_session_internal</ref><sp/>*session_i)<sp/>{</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ptr<sp/>=<sp/>session-&gt;<ref refid="structsecp256k1__musig__session_1adbcbfdcb5ab7240f081d1a31cc1840ae" kindref="member">data</ref>;</highlight></codeline>
<codeline lineno="146"><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(ptr,<sp/>secp256k1_musig_session_cache_magic,<sp/>4);</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>4;</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/>*ptr<sp/>=<sp/>session_i-&gt;<ref refid="structsecp256k1__musig__session__internal_1a46e67b0bab0aa3bc9a66e605853b54de" kindref="member">fin_nonce_parity</ref>;</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>1;</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(ptr,<sp/>session_i-&gt;<ref refid="structsecp256k1__musig__session__internal_1a50ff1f51f8a70b481dd19ad14636ba1a" kindref="member">fin_nonce</ref>,<sp/>32);</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>32;</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_get_b32(ptr,<sp/>&amp;session_i-&gt;<ref refid="structsecp256k1__musig__session__internal_1a5fd209204d3de44c0084492b9cb8c692" kindref="member">noncecoef</ref>);</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>32;</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_get_b32(ptr,<sp/>&amp;session_i-&gt;<ref refid="structsecp256k1__musig__session__internal_1a03e546a8ba89fbbbb1f765257951f951" kindref="member">challenge</ref>);</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>32;</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_get_b32(ptr,<sp/>&amp;session_i-&gt;<ref refid="structsecp256k1__musig__session__internal_1a4d47fdcda6ed7f3692377a7b2b702dbb" kindref="member">s_part</ref>);</highlight></codeline>
<codeline lineno="158"><highlight class="normal">}</highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_musig_session_load(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__musig__session__internal" kindref="compound">secp256k1_musig_session_internal</ref><sp/>*session_i,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__session" kindref="compound">secp256k1_musig_session</ref><sp/>*session)<sp/>{</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ptr<sp/>=<sp/>session-&gt;<ref refid="structsecp256k1__musig__session_1adbcbfdcb5ab7240f081d1a31cc1840ae" kindref="member">data</ref>;</highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(secp256k1_memcmp_var(ptr,<sp/>secp256k1_musig_session_cache_magic,<sp/>4)<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>4;</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/>session_i-&gt;<ref refid="structsecp256k1__musig__session__internal_1a46e67b0bab0aa3bc9a66e605853b54de" kindref="member">fin_nonce_parity</ref><sp/>=<sp/>*ptr;</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>1;</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(session_i-&gt;<ref refid="structsecp256k1__musig__session__internal_1a50ff1f51f8a70b481dd19ad14636ba1a" kindref="member">fin_nonce</ref>,<sp/>ptr,<sp/>32);</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>32;</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_set_b32(&amp;session_i-&gt;<ref refid="structsecp256k1__musig__session__internal_1a5fd209204d3de44c0084492b9cb8c692" kindref="member">noncecoef</ref>,<sp/>ptr,<sp/>NULL);</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>32;</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_set_b32(&amp;session_i-&gt;<ref refid="structsecp256k1__musig__session__internal_1a03e546a8ba89fbbbb1f765257951f951" kindref="member">challenge</ref>,<sp/>ptr,<sp/>NULL);</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/>ptr<sp/>+=<sp/>32;</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_set_b32(&amp;session_i-&gt;<ref refid="structsecp256k1__musig__session__internal_1a4d47fdcda6ed7f3692377a7b2b702dbb" kindref="member">s_part</ref>,<sp/>ptr,<sp/>NULL);</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="175"><highlight class="normal">}</highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>secp256k1_musig_partial_sig_magic[4]<sp/>=<sp/>{<sp/>0xeb,<sp/>0xfb,<sp/>0x1a,<sp/>0x32<sp/>};</highlight></codeline>
<codeline lineno="178"><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_musig_partial_sig_save(<ref refid="structsecp256k1__musig__partial__sig" kindref="compound">secp256k1_musig_partial_sig</ref>*<sp/>sig,<sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*s)<sp/>{</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(&amp;sig-&gt;<ref refid="structsecp256k1__musig__partial__sig_1acc54e5d2980d4f33b922e3cc1698bd95" kindref="member">data</ref>[0],<sp/>secp256k1_musig_partial_sig_magic,<sp/>4);</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_get_b32(&amp;sig-&gt;<ref refid="structsecp256k1__musig__partial__sig_1acc54e5d2980d4f33b922e3cc1698bd95" kindref="member">data</ref>[4],<sp/>s);</highlight></codeline>
<codeline lineno="182"><highlight class="normal">}</highlight></codeline>
<codeline lineno="183"><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_musig_partial_sig_load(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*s,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__partial__sig" kindref="compound">secp256k1_musig_partial_sig</ref>*<sp/>sig)<sp/>{</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>overflow;</highlight></codeline>
<codeline lineno="186"><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(secp256k1_memcmp_var(&amp;sig-&gt;<ref refid="structsecp256k1__musig__partial__sig_1acc54e5d2980d4f33b922e3cc1698bd95" kindref="member">data</ref>[0],<sp/>secp256k1_musig_partial_sig_magic,<sp/>4)<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_set_b32(s,<sp/>&amp;sig-&gt;<ref refid="structsecp256k1__musig__partial__sig_1acc54e5d2980d4f33b922e3cc1698bd95" kindref="member">data</ref>[4],<sp/>&amp;overflow);</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Parsed<sp/>signatures<sp/>can<sp/>not<sp/>overflow<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(!overflow);</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="192"><highlight class="normal">}</highlight></codeline>
<codeline lineno="193"><highlight class="normal"></highlight></codeline>
<codeline lineno="194" refid="secp256k1__musig_8h_1a31ed1d14cfc4aeea471e7949364576d2" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="session__impl_8h_1af056793e0da13f6a4e9e83758fd8819a" kindref="member">secp256k1_musig_pubnonce_parse</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref>*<sp/><ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*in66)<sp/>{</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>ges[2];</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="197"><highlight class="normal"></highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(<ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref><sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(in66<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_eckey_pubkey_parse(&amp;ges[i],<sp/>&amp;in66[33*i],<sp/>33))<sp/>{</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_ge_is_in_correct_subgroup(&amp;ges[i]))<sp/>{</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_pubnonce_save(<ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>,<sp/>ges);</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="212"><highlight class="normal">}</highlight></codeline>
<codeline lineno="213"><highlight class="normal"></highlight></codeline>
<codeline lineno="214" refid="secp256k1__musig_8h_1ae80450048d95054d60611dd5cce349b5" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="session__impl_8h_1afc95a7052d1f59d6ca498b25c0b0f695" kindref="member">secp256k1_musig_pubnonce_serialize</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*out66,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref>*<sp/><ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>)<sp/>{</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>ges[2];</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(out66<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(out66,<sp/>0,<sp/>66);</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(<ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref><sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="222"><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_musig_pubnonce_load(ctx,<sp/>ges,<sp/><ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>))<sp/>{</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>size<sp/>=<sp/>33;</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/>secp256k1_eckey_pubkey_serialize(&amp;ges[i],<sp/>&amp;out66[33*i],<sp/>&amp;size,<sp/>1);</highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>VERIFY</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>serialize<sp/>must<sp/>succeed<sp/>because<sp/>the<sp/>point<sp/>was<sp/>just<sp/>loaded<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>&amp;&amp;<sp/>size<sp/>==<sp/>33);</highlight></codeline>
<codeline lineno="233"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(void)<sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="235"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="238"><highlight class="normal">}</highlight></codeline>
<codeline lineno="239"><highlight class="normal"></highlight></codeline>
<codeline lineno="240" refid="secp256k1__musig_8h_1a39e8d9d788986e2305ef44897314a08c" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="session__impl_8h_1a9d872cf01aaaa14e59dad5a8cc914957" kindref="member">secp256k1_musig_aggnonce_parse</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__musig__aggnonce" kindref="compound">secp256k1_musig_aggnonce</ref>*<sp/><ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*in66)<sp/>{</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>ges[2];</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="243"><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(<ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref><sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(in66<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="247"><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_musig_ge_parse_ext(&amp;ges[i],<sp/>&amp;in66[33*i]))<sp/>{</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_aggnonce_save(<ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>,<sp/>ges);</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="255"><highlight class="normal">}</highlight></codeline>
<codeline lineno="256"><highlight class="normal"></highlight></codeline>
<codeline lineno="257" refid="secp256k1__musig_8h_1a12e7b1df6a5c248b0fd2fbd3b181cf4d" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="session__impl_8h_1a43fae1272df0b8ad18979b0a9b92de71" kindref="member">secp256k1_musig_aggnonce_serialize</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*out66,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__aggnonce" kindref="compound">secp256k1_musig_aggnonce</ref>*<sp/><ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>)<sp/>{</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>ges[2];</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="260"><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(out66<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(out66,<sp/>0,<sp/>66);</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(<ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref><sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="265"><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_musig_aggnonce_load(ctx,<sp/>ges,<sp/><ref refid="miner__tests_8cpp_1ad73ee4141a6536b03f4e493b56859e86" kindref="member">nonce</ref>))<sp/>{</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_musig_ge_serialize_ext(&amp;out66[33*i],<sp/>&amp;ges[i]);</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="273"><highlight class="normal">}</highlight></codeline>
<codeline lineno="274"><highlight class="normal"></highlight></codeline>
<codeline lineno="275" refid="secp256k1__musig_8h_1a2a87025c9b2609f636bb3804e619e01d" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="session__impl_8h_1ae4a5d7ef0dd5a03fdcd4fc5b99ac3b9e" kindref="member">secp256k1_musig_partial_sig_parse</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__musig__partial__sig" kindref="compound">secp256k1_musig_partial_sig</ref>*<sp/>sig,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*in32)<sp/>{</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>tmp;</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>overflow;</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(sig<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(in32<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="281"><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Ensure<sp/>that<sp/>using<sp/>the<sp/>signature<sp/>will<sp/>fail<sp/>if<sp/>parsing<sp/>fails<sp/>(and<sp/>the<sp/>user</highlight></codeline>
<codeline lineno="283"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>doesn&apos;t<sp/>check<sp/>the<sp/>return<sp/>value).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(sig,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*sig));</highlight></codeline>
<codeline lineno="285"><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_set_b32(&amp;tmp,<sp/>in32,<sp/>&amp;overflow);</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(overflow)<sp/>{</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_partial_sig_save(sig,<sp/>&amp;tmp);</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="292"><highlight class="normal">}</highlight></codeline>
<codeline lineno="293"><highlight class="normal"></highlight></codeline>
<codeline lineno="294" refid="secp256k1__musig_8h_1a828f4076c9b7d44f7b243a6d6df8c962" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="session__impl_8h_1a4b8e427d8d38088b5191c63d0cfde740" kindref="member">secp256k1_musig_partial_sig_serialize</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*out32,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__partial__sig" kindref="compound">secp256k1_musig_partial_sig</ref>*<sp/>sig)<sp/>{</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(out32<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(sig<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(secp256k1_memcmp_var(&amp;sig-&gt;<ref refid="structsecp256k1__musig__partial__sig_1acc54e5d2980d4f33b922e3cc1698bd95" kindref="member">data</ref>[0],<sp/>secp256k1_musig_partial_sig_magic,<sp/>4)<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="299"><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(out32,<sp/>&amp;sig-&gt;<ref refid="structsecp256k1__musig__partial__sig_1acc54e5d2980d4f33b922e3cc1698bd95" kindref="member">data</ref>[4],<sp/>32);</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="302"><highlight class="normal">}</highlight></codeline>
<codeline lineno="303"><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Write<sp/>optional<sp/>inputs<sp/>into<sp/>the<sp/>hash<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="305"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_nonce_function_musig_helper(<ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>*sha,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>prefix_size,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*data,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>len)<sp/>{</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>zero[7]<sp/>=<sp/>{<sp/>0<sp/>};</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>spec<sp/>requires<sp/>length<sp/>prefixes<sp/>to<sp/>be<sp/>between<sp/>1<sp/>and<sp/>8<sp/>bytes</highlight></codeline>
<codeline lineno="308"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>(inclusive)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(prefix_size<sp/>&gt;=<sp/>1<sp/>&amp;&amp;<sp/>prefix_size<sp/>&lt;=<sp/>8);</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Since<sp/>the<sp/>length<sp/>of<sp/>all<sp/>input<sp/>data<sp/>fits<sp/>in<sp/>a<sp/>byte,<sp/>we<sp/>can<sp/>always<sp/>pad<sp/>the</highlight></codeline>
<codeline lineno="311"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>length<sp/>prefix<sp/>with<sp/>prefix_size<sp/>-<sp/>1<sp/>zero<sp/>bytes.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_write(sha,<sp/>zero,<sp/>prefix_size<sp/>-<sp/>1);</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(data<sp/>!=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_sha256_write(sha,<sp/>&amp;len,<sp/>1);</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_sha256_write(sha,<sp/>data,<sp/>len);</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>len<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_sha256_write(sha,<sp/>&amp;len,<sp/>1);</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="320"><highlight class="normal">}</highlight></codeline>
<codeline lineno="321"><highlight class="normal"></highlight></codeline>
<codeline lineno="322"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Initializes<sp/>SHA256<sp/>with<sp/>fixed<sp/>midstate.<sp/>This<sp/>midstate<sp/>was<sp/>computed<sp/>by<sp/>applying</highlight></codeline>
<codeline lineno="323"><highlight class="comment"><sp/>*<sp/>SHA256<sp/>to<sp/>SHA256(&quot;MuSig/aux&quot;)||SHA256(&quot;MuSig/aux&quot;).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_nonce_function_musig_sha256_tagged_aux(<ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>*sha)<sp/>{</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_initialize(sha);</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[0]<sp/>=<sp/>0xa19e884bul;</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[1]<sp/>=<sp/>0xf463fe7eul;</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[2]<sp/>=<sp/>0x2f18f9a2ul;</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[3]<sp/>=<sp/>0xbeb0f9fful;</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[4]<sp/>=<sp/>0x0f37e8b0ul;</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[5]<sp/>=<sp/>0x06ebd26ful;</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[6]<sp/>=<sp/>0xe3b243d2ul;</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[7]<sp/>=<sp/>0x522fb150ul;</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a386a3a5adc6cdeb2f1083b3c3d08e7d0" kindref="member">bytes</ref><sp/>=<sp/>64;</highlight></codeline>
<codeline lineno="335"><highlight class="normal">}</highlight></codeline>
<codeline lineno="336"><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Initializes<sp/>SHA256<sp/>with<sp/>fixed<sp/>midstate.<sp/>This<sp/>midstate<sp/>was<sp/>computed<sp/>by<sp/>applying</highlight></codeline>
<codeline lineno="338"><highlight class="comment"><sp/>*<sp/>SHA256<sp/>to<sp/>SHA256(&quot;MuSig/nonce&quot;)||SHA256(&quot;MuSig/nonce&quot;).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_nonce_function_musig_sha256_tagged(<ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>*sha)<sp/>{</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_initialize(sha);</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[0]<sp/>=<sp/>0x07101b64ul;</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[1]<sp/>=<sp/>0x18003414ul;</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[2]<sp/>=<sp/>0x0391bc43ul;</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[3]<sp/>=<sp/>0x0e6258eeul;</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[4]<sp/>=<sp/>0x29d26b72ul;</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[5]<sp/>=<sp/>0x8343937eul;</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[6]<sp/>=<sp/>0xb7a0a4fbul;</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[7]<sp/>=<sp/>0xff568a30ul;</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a386a3a5adc6cdeb2f1083b3c3d08e7d0" kindref="member">bytes</ref><sp/>=<sp/>64;</highlight></codeline>
<codeline lineno="350"><highlight class="normal">}</highlight></codeline>
<codeline lineno="351"><highlight class="normal"></highlight></codeline>
<codeline lineno="352"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_nonce_function_musig(<ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*session_secrand,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*msg32,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*seckey32,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*pk33,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*agg_pk32,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*extra_input32)<sp/>{</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>sha;</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>rand[32];</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>msg_present;</highlight></codeline>
<codeline lineno="357"><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(seckey32<sp/>!=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_nonce_function_musig_sha256_tagged_aux(&amp;sha);</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;sha,<sp/>session_secrand,<sp/>32);</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_sha256_finalize(&amp;sha,<sp/>rand);</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>32;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rand[i]<sp/>^=<sp/>seckey32[i];</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(rand,<sp/>session_secrand,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(rand));</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="368"><highlight class="normal"></highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_nonce_function_musig_sha256_tagged(&amp;sha);</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;sha,<sp/>rand,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(rand));</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_nonce_function_musig_helper(&amp;sha,<sp/>1,<sp/>pk33,<sp/>33);</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_nonce_function_musig_helper(&amp;sha,<sp/>1,<sp/>agg_pk32,<sp/>32);</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/>msg_present<sp/>=<sp/>msg32<sp/>!=<sp/>NULL;</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;sha,<sp/>&amp;msg_present,<sp/>1);</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(msg_present)<sp/>{</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_nonce_function_musig_helper(&amp;sha,<sp/>8,<sp/>msg32,<sp/>32);</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_nonce_function_musig_helper(&amp;sha,<sp/>4,<sp/>extra_input32,<sp/>32);</highlight></codeline>
<codeline lineno="379"><highlight class="normal"></highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>buf[32];</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>sha_tmp<sp/>=<sp/>sha;</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;sha_tmp,<sp/>&amp;i,<sp/>1);</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_sha256_finalize(&amp;sha_tmp,<sp/>buf);</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_set_b32(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[i],<sp/>buf,<sp/>NULL);</highlight></codeline>
<codeline lineno="386"><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Attempt<sp/>to<sp/>erase<sp/>secret<sp/>data<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_memclear_explicit(buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(buf));</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_sha256_clear(&amp;sha_tmp);</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_memclear_explicit(rand,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(rand));</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_clear(&amp;sha);</highlight></codeline>
<codeline lineno="393"><highlight class="normal">}</highlight></codeline>
<codeline lineno="394"><highlight class="normal"></highlight></codeline>
<codeline lineno="395"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_musig_nonce_gen_internal(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__musig__secnonce" kindref="compound">secp256k1_musig_secnonce</ref><sp/>*secnonce,<sp/><ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref><sp/>*pubnonce,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*input_nonce,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*seckey,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref><sp/>*pubkey,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*msg32,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref><sp/>*keyagg_cache,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*extra_input32)<sp/>{</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[2];</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>nonce_pts[2];</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>nonce_ptj[2];</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>pk_ser[33];</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>pk_ser_len<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(pk_ser);</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>aggpk_ser[32];</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*aggpk_ser_ptr<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/><ref refid="namespacetests__wycheproof__generate__ecdh_1a58c180b301e382c190377b9dd48c1833" kindref="member">pk</ref>;</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pk_serialize_success;</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="407"><highlight class="normal"></highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(pubnonce<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(pubnonce,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*pubnonce));</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(pubkey<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(secp256k1_ecmult_gen_context_is_built(&amp;ctx-&gt;<ref refid="structsecp256k1__context__struct_1abb65f6e84b17f93f74cd8b4eb2910a47" kindref="member">ecmult_gen_ctx</ref>));</highlight></codeline>
<codeline lineno="412"><highlight class="normal"></highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Check<sp/>that<sp/>the<sp/>seckey<sp/>is<sp/>valid<sp/>to<sp/>be<sp/>able<sp/>to<sp/>sign<sp/>for<sp/>it<sp/>later.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(seckey<sp/>!=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/><ref refid="namespacetests__wycheproof__generate__ecdh_1ad95e1f06b6be929c6b670b2a9a80d5cc" kindref="member">sk</ref>;</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>&amp;=<sp/>secp256k1_scalar_set_b32_seckey(&amp;sk,<sp/>seckey);</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_clear(&amp;sk);</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="419"><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(keyagg_cache<sp/>!=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__keyagg__cache__internal" kindref="compound">secp256k1_keyagg_cache_internal</ref><sp/>cache_i;</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_keyagg_cache_load(ctx,<sp/>&amp;cache_i,<sp/>keyagg_cache))<sp/>{</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>loaded<sp/>point<sp/>cache_i.pk<sp/>can<sp/>not<sp/>be<sp/>the<sp/>point<sp/>at<sp/>infinity.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="field_8h_1ad0cc14c85bd2f671868b048de75c8042" kindref="member">secp256k1_fe_get_b32</ref>(aggpk_ser,<sp/>&amp;cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1ab83e13ae5a279c417f3c293c3ac8dbaa" kindref="member">pk</ref>.<ref refid="structsecp256k1__ge_1af089d748d95dc12c1185adae8e11972d" kindref="member">x</ref>);</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>aggpk_ser_ptr<sp/>=<sp/>aggpk_ser;</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_pubkey_load(ctx,<sp/>&amp;pk,<sp/>pubkey))<sp/>{</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/>pk_serialize_success<sp/>=<sp/>secp256k1_eckey_pubkey_serialize(&amp;pk,<sp/>pk_ser,<sp/>&amp;pk_ser_len,<sp/>1);</highlight></codeline>
<codeline lineno="433"><highlight class="normal"></highlight></codeline>
<codeline lineno="434"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>VERIFY</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>A<sp/>pubkey<sp/>cannot<sp/>be<sp/>the<sp/>point<sp/>at<sp/>infinity<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(pk_serialize_success);</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(pk_ser_len<sp/>==<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(pk_ser));</highlight></codeline>
<codeline lineno="438"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)<sp/>pk_serialize_success;</highlight></codeline>
<codeline lineno="440"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="441"><highlight class="normal"></highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_nonce_function_musig(<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>,<sp/>input_nonce,<sp/>msg32,<sp/>seckey,<sp/>pk_ser,<sp/>aggpk_ser_ptr,<sp/>extra_input32);</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(!secp256k1_scalar_is_zero(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[0]));</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(!secp256k1_scalar_is_zero(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[1]));</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_secnonce_save(secnonce,<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>,<sp/>&amp;pk);</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_secnonce_invalidate(ctx,<sp/>secnonce,<sp/>!<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="447"><highlight class="normal"></highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Compute<sp/>pubnonce<sp/>as<sp/>two<sp/>gejs<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_ecmult_gen(&amp;ctx-&gt;<ref refid="structsecp256k1__context__struct_1abb65f6e84b17f93f74cd8b4eb2910a47" kindref="member">ecmult_gen_ctx</ref>,<sp/>&amp;nonce_ptj[i],<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[i]);</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_clear(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[i]);</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="453"><highlight class="normal"></highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Batch<sp/>convert<sp/>to<sp/>two<sp/>public<sp/>ges<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ge_set_all_gej(nonce_pts,<sp/>nonce_ptj,<sp/>2);</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_clear(&amp;nonce_ptj[i]);</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="459"><highlight class="normal"></highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_declassify(ctx,<sp/>&amp;nonce_pts[i],<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(nonce_pts[i]));</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>None<sp/>of<sp/>the<sp/>nonce_pts<sp/>will<sp/>be<sp/>infinity<sp/>because<sp/>k<sp/>!=<sp/>0<sp/>with<sp/>overwhelming</highlight></codeline>
<codeline lineno="464"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>probability<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_pubnonce_save(pubnonce,<sp/>nonce_pts);</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="467"><highlight class="normal">}</highlight></codeline>
<codeline lineno="468"><highlight class="normal"></highlight></codeline>
<codeline lineno="469" refid="secp256k1__musig_8h_1a7ec24f575d1e46794f3ce3532a03615b" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="session__impl_8h_1a3df8ee129f48649f6973d7b3426d7ac0" kindref="member">secp256k1_musig_nonce_gen</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__musig__secnonce" kindref="compound">secp256k1_musig_secnonce</ref><sp/>*secnonce,<sp/><ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref><sp/>*pubnonce,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*session_secrand32,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*seckey,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref><sp/>*pubkey,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*msg32,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref><sp/>*keyagg_cache,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*extra_input32)<sp/>{</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="471"><highlight class="normal"></highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(secnonce<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(secnonce,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*secnonce));</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(session_secrand32<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="476"><highlight class="normal"></highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Check<sp/>in<sp/>constant<sp/>time<sp/>that<sp/>the<sp/>session_secrand32<sp/>is<sp/>not<sp/>0<sp/>as<sp/>a</highlight></codeline>
<codeline lineno="478"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>defense-in-depth<sp/>measure<sp/>that<sp/>may<sp/>protect<sp/>against<sp/>a<sp/>faulty<sp/>RNG.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>&amp;=<sp/>!secp256k1_is_zero_array(session_secrand32,<sp/>32);</highlight></codeline>
<codeline lineno="480"><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>We<sp/>can<sp/>declassify<sp/>because<sp/>branching<sp/>on<sp/>ret<sp/>is<sp/>only<sp/>relevant<sp/>when<sp/>this</highlight></codeline>
<codeline lineno="482"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>function<sp/>called<sp/>with<sp/>an<sp/>invalid<sp/>session_secrand32<sp/>argument<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_declassify(ctx,<sp/>&amp;<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>));</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_musig_secnonce_invalidate(ctx,<sp/>secnonce,<sp/>1);</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="488"><highlight class="normal"></highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>&amp;=<sp/>secp256k1_musig_nonce_gen_internal(ctx,<sp/>secnonce,<sp/>pubnonce,<sp/>session_secrand32,<sp/>seckey,<sp/>pubkey,<sp/>msg32,<sp/>keyagg_cache,<sp/>extra_input32);</highlight></codeline>
<codeline lineno="490"><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Set<sp/>the<sp/>session_secrand32<sp/>buffer<sp/>to<sp/>zero<sp/>to<sp/>prevent<sp/>the<sp/>caller<sp/>from<sp/>using</highlight></codeline>
<codeline lineno="492"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>nonce_gen<sp/>multiple<sp/>times<sp/>with<sp/>the<sp/>same<sp/>buffer.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_memczero(session_secrand32,<sp/>32,<sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="495"><highlight class="normal">}</highlight></codeline>
<codeline lineno="496"><highlight class="normal"></highlight></codeline>
<codeline lineno="497" refid="secp256k1__musig_8h_1acf856b8cbcfc932add9d68a6a4e941b7" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="session__impl_8h_1a4e9bb7524abb0090eb116ff27b35e3ff" kindref="member">secp256k1_musig_nonce_gen_counter</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__musig__secnonce" kindref="compound">secp256k1_musig_secnonce</ref><sp/>*secnonce,<sp/><ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref><sp/>*pubnonce,<sp/>uint64_t<sp/>nonrepeating_cnt,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__keypair" kindref="compound">secp256k1_keypair</ref><sp/>*keypair,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*msg32,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref><sp/>*keyagg_cache,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*extra_input32)<sp/>{</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>buf[32]<sp/>=<sp/>{<sp/>0<sp/>};</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>seckey[32];</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref><sp/>pubkey;</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="502"><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(secnonce<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(secnonce,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*secnonce));</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(keypair<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="507"><highlight class="normal"></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_write_be64(buf,<sp/>nonrepeating_cnt);</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>keypair_sec<sp/>and<sp/>keypair_pub<sp/>do<sp/>not<sp/>fail<sp/>if<sp/>the<sp/>arguments<sp/>are<sp/>not<sp/>NULL<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="secp256k1__extrakeys_8h_1aff2e05c76e2eeac729a1eec6796778b8" kindref="member">secp256k1_keypair_sec</ref>(ctx,<sp/>seckey,<sp/>keypair);</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/><ref refid="secp256k1__extrakeys_8h_1af9c115df738fabe6b04574d4880495bc" kindref="member">secp256k1_keypair_pub</ref>(ctx,<sp/>&amp;pubkey,<sp/>keypair);</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>);</highlight></codeline>
<codeline lineno="514"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>VERIFY</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)<sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="516"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="517"><highlight class="normal"></highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_musig_nonce_gen_internal(ctx,<sp/>secnonce,<sp/>pubnonce,<sp/>buf,<sp/>seckey,<sp/>&amp;pubkey,<sp/>msg32,<sp/>keyagg_cache,<sp/>extra_input32))<sp/>{</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_memclear_explicit(seckey,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(seckey));</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="523"><highlight class="normal">}</highlight></codeline>
<codeline lineno="524"><highlight class="normal"></highlight></codeline>
<codeline lineno="525"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>secp256k1_musig_sum_pubnonces(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>*summed_pubnonces,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref><sp/>*<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">*<sp/>pubnonces,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_pubnonces)<sp/>{</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j;</highlight></codeline>
<codeline lineno="528"><highlight class="normal"></highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_gej_set_infinity(&amp;summed_pubnonces[0]);</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_gej_set_infinity(&amp;summed_pubnonces[1]);</highlight></codeline>
<codeline lineno="531"><highlight class="normal"></highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>n_pubnonces;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>nonce_pts[2];</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_musig_pubnonce_load(ctx,<sp/>nonce_pts,<sp/>pubnonces[i]))<sp/>{</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>2;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_add_ge_var(&amp;summed_pubnonces[j],<sp/>&amp;summed_pubnonces[j],<sp/>&amp;nonce_pts[j],<sp/>NULL);</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="542"><highlight class="normal">}</highlight></codeline>
<codeline lineno="543"><highlight class="normal"></highlight></codeline>
<codeline lineno="544" refid="secp256k1__musig_8h_1a32c50c1197c2e1c817893b037cd8d721" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="session__impl_8h_1ac6576fa35eb1d7ad9d3e9a6e27946b3f" kindref="member">secp256k1_musig_nonce_agg</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__musig__aggnonce" kindref="compound">secp256k1_musig_aggnonce</ref><sp/><sp/>*aggnonce,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref><sp/>*<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">*<sp/>pubnonces,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_pubnonces)<sp/>{</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>aggnonce_ptsj[2];</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>aggnonce_pts[2];</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(aggnonce<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(pubnonces<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(n_pubnonces<sp/>&gt;<sp/>0);</highlight></codeline>
<codeline lineno="551"><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_musig_sum_pubnonces(ctx,<sp/>aggnonce_ptsj,<sp/>pubnonces,<sp/>n_pubnonces))<sp/>{</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ge_set_all_gej_var(aggnonce_pts,<sp/>aggnonce_ptsj,<sp/>2);</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_aggnonce_save(aggnonce,<sp/>aggnonce_pts);</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="558"><highlight class="normal">}</highlight></codeline>
<codeline lineno="559"><highlight class="normal"></highlight></codeline>
<codeline lineno="560"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Initializes<sp/>SHA256<sp/>with<sp/>fixed<sp/>midstate.<sp/>This<sp/>midstate<sp/>was<sp/>computed<sp/>by<sp/>applying</highlight></codeline>
<codeline lineno="561"><highlight class="comment"><sp/>*<sp/>SHA256<sp/>to<sp/>SHA256(&quot;MuSig/noncecoef&quot;)||SHA256(&quot;MuSig/noncecoef&quot;).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="562"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_musig_compute_noncehash_sha256_tagged(<ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>*sha)<sp/>{</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_initialize(sha);</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[0]<sp/>=<sp/>0x2c7d5a45ul;</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[1]<sp/>=<sp/>0x06bf7e53ul;</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[2]<sp/>=<sp/>0x89be68a6ul;</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[3]<sp/>=<sp/>0x971254c0ul;</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[4]<sp/>=<sp/>0x60ac12d2ul;</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[5]<sp/>=<sp/>0x72846dcdul;</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[6]<sp/>=<sp/>0x6c81212ful;</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a7b3418219ef13e914cd0954aec04b1f9" kindref="member">s</ref>[7]<sp/>=<sp/>0xde7a2500ul;</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/>sha-&gt;<ref refid="structsecp256k1__sha256_1a386a3a5adc6cdeb2f1083b3c3d08e7d0" kindref="member">bytes</ref><sp/>=<sp/>64;</highlight></codeline>
<codeline lineno="573"><highlight class="normal">}</highlight></codeline>
<codeline lineno="574"><highlight class="normal"></highlight></codeline>
<codeline lineno="575"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>tagged_hash(aggnonce[0],<sp/>aggnonce[1],<sp/>agg_pk,<sp/>msg)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="576"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_musig_compute_noncehash(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*noncehash,<sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*aggnonce,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*agg_pk32,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*msg)<sp/>{</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>buf[33];</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__sha256" kindref="compound">secp256k1_sha256</ref><sp/>sha;</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="580"><highlight class="normal"></highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_compute_noncehash_sha256_tagged(&amp;sha);</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_musig_ge_serialize_ext(buf,<sp/>&amp;aggnonce[i]);</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;sha,<sp/>buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(buf));</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;sha,<sp/>agg_pk32,<sp/>32);</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_write(&amp;sha,<sp/>msg,<sp/>32);</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_sha256_finalize(&amp;sha,<sp/>noncehash);</highlight></codeline>
<codeline lineno="589"><highlight class="normal">}</highlight></codeline>
<codeline lineno="590"><highlight class="normal"></highlight></codeline>
<codeline lineno="591"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>out_nonce<sp/>=<sp/>nonce_pts[0]<sp/>+<sp/>b*nonce_pts[1]<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="592"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_effective_nonce(<ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>*out_nonce,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*nonce_pts,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*b)<sp/>{</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>tmp;</highlight></codeline>
<codeline lineno="594"><highlight class="normal"></highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_gej_set_ge(&amp;tmp,<sp/>&amp;nonce_pts[1]);</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ecmult(out_nonce,<sp/>&amp;tmp,<sp/>b,<sp/>NULL);</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_gej_add_ge_var(out_nonce,<sp/>out_nonce,<sp/>&amp;nonce_pts[0],<sp/>NULL);</highlight></codeline>
<codeline lineno="598"><highlight class="normal">}</highlight></codeline>
<codeline lineno="599"><highlight class="normal"></highlight></codeline>
<codeline lineno="600"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_musig_nonce_process_internal(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*fin_nonce_parity,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*fin_nonce,<sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*b,<sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>*aggnonce_pts,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*agg_pk32,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*msg)<sp/>{</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>noncehash[32];</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>fin_nonce_pt;</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>fin_nonce_ptj;</highlight></codeline>
<codeline lineno="604"><highlight class="normal"></highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_compute_noncehash(noncehash,<sp/>aggnonce_pts,<sp/>agg_pk32,<sp/>msg);</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_set_b32(b,<sp/>noncehash,<sp/>NULL);</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>fin_nonce<sp/>=<sp/>aggnonce_pts[0]<sp/>+<sp/>b*aggnonce_pts[1]<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_effective_nonce(&amp;fin_nonce_ptj,<sp/>aggnonce_pts,<sp/>b);</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ge_set_gej(&amp;fin_nonce_pt,<sp/>&amp;fin_nonce_ptj);</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(secp256k1_ge_is_infinity(&amp;fin_nonce_pt))<sp/>{</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fin_nonce_pt<sp/>=<sp/>secp256k1_ge_const_g;</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>fin_nonce_pt<sp/>is<sp/>not<sp/>the<sp/>point<sp/>at<sp/>infinity<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a80e6ef8a08736aad544787a388956f5c" kindref="member">secp256k1_fe_normalize_var</ref>(&amp;fin_nonce_pt.<ref refid="structsecp256k1__ge_1af089d748d95dc12c1185adae8e11972d" kindref="member">x</ref>);</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1ad0cc14c85bd2f671868b048de75c8042" kindref="member">secp256k1_fe_get_b32</ref>(fin_nonce,<sp/>&amp;fin_nonce_pt.<ref refid="structsecp256k1__ge_1af089d748d95dc12c1185adae8e11972d" kindref="member">x</ref>);</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1a80e6ef8a08736aad544787a388956f5c" kindref="member">secp256k1_fe_normalize_var</ref>(&amp;fin_nonce_pt.<ref refid="structsecp256k1__ge_1a8ab8d07fa557181528b86bd1c9bb2b92" kindref="member">y</ref>);</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/>*fin_nonce_parity<sp/>=<sp/><ref refid="field_8h_1a5bcecb31c985b8cd07086ffc254b7902" kindref="member">secp256k1_fe_is_odd</ref>(&amp;fin_nonce_pt.<ref refid="structsecp256k1__ge_1a8ab8d07fa557181528b86bd1c9bb2b92" kindref="member">y</ref>);</highlight></codeline>
<codeline lineno="618"><highlight class="normal">}</highlight></codeline>
<codeline lineno="619"><highlight class="normal"></highlight></codeline>
<codeline lineno="620" refid="secp256k1__musig_8h_1ae2294b047f341afacce48e9f9a509f11" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="session__impl_8h_1ab327f436aa657318ab2362972cee36b1" kindref="member">secp256k1_musig_nonce_process</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__musig__session" kindref="compound">secp256k1_musig_session</ref><sp/>*session,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__aggnonce" kindref="compound">secp256k1_musig_aggnonce</ref><sp/><sp/>*aggnonce,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*msg32,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref><sp/>*keyagg_cache)<sp/>{</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__keyagg__cache__internal" kindref="compound">secp256k1_keyagg_cache_internal</ref><sp/>cache_i;</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>aggnonce_pts[2];</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>fin_nonce[32];</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__musig__session__internal" kindref="compound">secp256k1_musig_session_internal</ref><sp/>session_i;</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>agg_pk32[32];</highlight></codeline>
<codeline lineno="626"><highlight class="normal"></highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(session<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(aggnonce<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(msg32<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(keyagg_cache<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="632"><highlight class="normal"></highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_keyagg_cache_load(ctx,<sp/>&amp;cache_i,<sp/>keyagg_cache))<sp/>{</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="field_8h_1ad0cc14c85bd2f671868b048de75c8042" kindref="member">secp256k1_fe_get_b32</ref>(agg_pk32,<sp/>&amp;cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1ab83e13ae5a279c417f3c293c3ac8dbaa" kindref="member">pk</ref>.<ref refid="structsecp256k1__ge_1af089d748d95dc12c1185adae8e11972d" kindref="member">x</ref>);</highlight></codeline>
<codeline lineno="637"><highlight class="normal"></highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_musig_aggnonce_load(ctx,<sp/>aggnonce_pts,<sp/>aggnonce))<sp/>{</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="641"><highlight class="normal"></highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_nonce_process_internal(&amp;session_i.<ref refid="structsecp256k1__musig__session__internal_1a46e67b0bab0aa3bc9a66e605853b54de" kindref="member">fin_nonce_parity</ref>,<sp/>fin_nonce,<sp/>&amp;session_i.<ref refid="structsecp256k1__musig__session__internal_1a5fd209204d3de44c0084492b9cb8c692" kindref="member">noncecoef</ref>,<sp/>aggnonce_pts,<sp/>agg_pk32,<sp/>msg32);</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_schnorrsig_challenge(&amp;session_i.<ref refid="structsecp256k1__musig__session__internal_1a03e546a8ba89fbbbb1f765257951f951" kindref="member">challenge</ref>,<sp/>fin_nonce,<sp/>msg32,<sp/>32,<sp/>agg_pk32);</highlight></codeline>
<codeline lineno="644"><highlight class="normal"></highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>there<sp/>is<sp/>a<sp/>tweak<sp/>then<sp/>set<sp/>`challenge`<sp/>times<sp/>`tweak`<sp/>to<sp/>the<sp/>`s`-part.*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_set_int(&amp;session_i.<ref refid="structsecp256k1__musig__session__internal_1a4d47fdcda6ed7f3692377a7b2b702dbb" kindref="member">s_part</ref>,<sp/>0);</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_scalar_is_zero(&amp;cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1aed924c8b7cb5c081a66d7ce1059f040e" kindref="member">tweak</ref>))<sp/>{</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>e_tmp;</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_mul(&amp;e_tmp,<sp/>&amp;session_i.<ref refid="structsecp256k1__musig__session__internal_1a03e546a8ba89fbbbb1f765257951f951" kindref="member">challenge</ref>,<sp/>&amp;cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1aed924c8b7cb5c081a66d7ce1059f040e" kindref="member">tweak</ref>);</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="field_8h_1a5bcecb31c985b8cd07086ffc254b7902" kindref="member">secp256k1_fe_is_odd</ref>(&amp;cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1ab83e13ae5a279c417f3c293c3ac8dbaa" kindref="member">pk</ref>.<ref refid="structsecp256k1__ge_1a8ab8d07fa557181528b86bd1c9bb2b92" kindref="member">y</ref>))<sp/>{</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_negate(&amp;e_tmp,<sp/>&amp;e_tmp);</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>session_i.<ref refid="structsecp256k1__musig__session__internal_1a4d47fdcda6ed7f3692377a7b2b702dbb" kindref="member">s_part</ref><sp/>=<sp/>e_tmp;</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(session_i.<ref refid="structsecp256k1__musig__session__internal_1a50ff1f51f8a70b481dd19ad14636ba1a" kindref="member">fin_nonce</ref>,<sp/>fin_nonce,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(session_i.<ref refid="structsecp256k1__musig__session__internal_1a50ff1f51f8a70b481dd19ad14636ba1a" kindref="member">fin_nonce</ref>));</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_session_save(session,<sp/>&amp;session_i);</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="658"><highlight class="normal">}</highlight></codeline>
<codeline lineno="659"><highlight class="normal"></highlight></codeline>
<codeline lineno="660"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>secp256k1_musig_partial_sign_clear(<ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*sk,<sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>*<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>)<sp/>{</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_clear(sk);</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_clear(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[0]);</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_clear(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[1]);</highlight></codeline>
<codeline lineno="664"><highlight class="normal">}</highlight></codeline>
<codeline lineno="665"><highlight class="normal"></highlight></codeline>
<codeline lineno="666" refid="secp256k1__musig_8h_1a37c235ba487df277f97464708c06f98e" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="session__impl_8h_1a1d51739b87304a56fa38b8560e39cd83" kindref="member">secp256k1_musig_partial_sign</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/><ref refid="structsecp256k1__musig__partial__sig" kindref="compound">secp256k1_musig_partial_sig</ref><sp/>*partial_sig,<sp/><ref refid="structsecp256k1__musig__secnonce" kindref="compound">secp256k1_musig_secnonce</ref><sp/>*secnonce,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__keypair" kindref="compound">secp256k1_keypair</ref><sp/>*keypair,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref><sp/>*keyagg_cache,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__session" kindref="compound">secp256k1_musig_session</ref><sp/>*session)<sp/>{</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>sk;</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>pk,<sp/>keypair_pk;</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[2];</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>mu,<sp/>s;</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__keyagg__cache__internal" kindref="compound">secp256k1_keyagg_cache_internal</ref><sp/>cache_i;</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__musig__session__internal" kindref="compound">secp256k1_musig_session_internal</ref><sp/>session_i;</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>;</highlight></codeline>
<codeline lineno="674"><highlight class="normal"></highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="676"><highlight class="normal"></highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(secnonce<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Fails<sp/>if<sp/>the<sp/>magic<sp/>doesn&apos;t<sp/>match<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref><sp/>=<sp/>secp256k1_musig_secnonce_load(ctx,<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>,<sp/>&amp;pk,<sp/>secnonce);</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Set<sp/>nonce<sp/>to<sp/>zero<sp/>to<sp/>avoid<sp/>nonce<sp/>reuse.<sp/>This<sp/>will<sp/>cause<sp/>subsequent<sp/>calls</highlight></codeline>
<codeline lineno="681"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>of<sp/>this<sp/>function<sp/>to<sp/>fail<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_memzero_explicit(secnonce,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*secnonce));</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="bitcoin-cli_8cpp_1a339672ff94e6199019102f50d317c3d7" kindref="member">ret</ref>)<sp/>{</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_musig_partial_sign_clear(&amp;sk,<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>);</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="687"><highlight class="normal"></highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(partial_sig<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(keypair<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(keyagg_cache<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(session<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="692"><highlight class="normal"></highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_keypair_load(ctx,<sp/>&amp;sk,<sp/>&amp;keypair_pk,<sp/>keypair))<sp/>{</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_musig_partial_sign_clear(&amp;sk,<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>);</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(secp256k1_fe_equal(&amp;pk.x,<sp/>&amp;keypair_pk.<ref refid="structsecp256k1__ge_1af089d748d95dc12c1185adae8e11972d" kindref="member">x</ref>)</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;&amp;<sp/>secp256k1_fe_equal(&amp;pk.y,<sp/>&amp;keypair_pk.<ref refid="structsecp256k1__ge_1a8ab8d07fa557181528b86bd1c9bb2b92" kindref="member">y</ref>));</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_keyagg_cache_load(ctx,<sp/>&amp;cache_i,<sp/>keyagg_cache))<sp/>{</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_musig_partial_sign_clear(&amp;sk,<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>);</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="703"><highlight class="normal"></highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Negate<sp/>sk<sp/>if<sp/>secp256k1_fe_is_odd(&amp;cache_i.pk.y))<sp/>XOR<sp/>cache_i.parity_acc.</highlight></codeline>
<codeline lineno="705"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>This<sp/>corresponds<sp/>to<sp/>the<sp/>line<sp/>&quot;Let<sp/>d<sp/>=<sp/>ggaccd&apos;<sp/>mod<sp/>n&quot;<sp/>in<sp/>the</highlight></codeline>
<codeline lineno="706"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>specification.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((<ref refid="field_8h_1a5bcecb31c985b8cd07086ffc254b7902" kindref="member">secp256k1_fe_is_odd</ref>(&amp;cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1ab83e13ae5a279c417f3c293c3ac8dbaa" kindref="member">pk</ref>.<ref refid="structsecp256k1__ge_1a8ab8d07fa557181528b86bd1c9bb2b92" kindref="member">y</ref>)</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!=<sp/>cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1a5bd267ac4dec5fd0394bb1d61b918a22" kindref="member">parity_acc</ref>))<sp/>{</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_negate(&amp;sk,<sp/>&amp;sk);</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="711"><highlight class="normal"></highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Multiply<sp/>KeyAgg<sp/>coefficient<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_keyaggcoef(&amp;mu,<sp/>&amp;cache_i,<sp/>&amp;pk);</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_mul(&amp;sk,<sp/>&amp;sk,<sp/>&amp;mu);</highlight></codeline>
<codeline lineno="715"><highlight class="normal"></highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_musig_session_load(ctx,<sp/>&amp;session_i,<sp/>session))<sp/>{</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_musig_partial_sign_clear(&amp;sk,<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>);</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="720"><highlight class="normal"></highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(session_i.<ref refid="structsecp256k1__musig__session__internal_1a46e67b0bab0aa3bc9a66e605853b54de" kindref="member">fin_nonce_parity</ref>)<sp/>{</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_negate(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[0],<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[0]);</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_negate(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[1],<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[1]);</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="725"><highlight class="normal"></highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Sign<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_mul(&amp;s,<sp/>&amp;session_i.<ref refid="structsecp256k1__musig__session__internal_1a03e546a8ba89fbbbb1f765257951f951" kindref="member">challenge</ref>,<sp/>&amp;sk);</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_mul(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[1],<sp/>&amp;session_i.<ref refid="structsecp256k1__musig__session__internal_1a5fd209204d3de44c0084492b9cb8c692" kindref="member">noncecoef</ref>,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[1]);</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_add(&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[0],<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[0],<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[1]);</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_add(&amp;s,<sp/>&amp;s,<sp/>&amp;<ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>[0]);</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_partial_sig_save(partial_sig,<sp/>&amp;s);</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_partial_sign_clear(&amp;sk,<sp/><ref refid="strencodings_8h_1a7a8fe8e8ebe30d3329bb57478f49ae2ca8ce4b16b22b58894aa86c421e8759df3" kindref="member">k</ref>);</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="734"><highlight class="normal">}</highlight></codeline>
<codeline lineno="735"><highlight class="normal"></highlight></codeline>
<codeline lineno="736" refid="secp256k1__musig_8h_1a94cce9a0b321047ba1f341bc8f3f8ee3" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="session__impl_8h_1a8919645dbc6e72741a6df8ac3202ab1c" kindref="member">secp256k1_musig_partial_sig_verify</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__partial__sig" kindref="compound">secp256k1_musig_partial_sig</ref><sp/>*partial_sig,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__pubnonce" kindref="compound">secp256k1_musig_pubnonce</ref><sp/>*pubnonce,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__pubkey" kindref="compound">secp256k1_pubkey</ref><sp/>*pubkey,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__keyagg__cache" kindref="compound">secp256k1_musig_keyagg_cache</ref><sp/>*keyagg_cache,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__session" kindref="compound">secp256k1_musig_session</ref><sp/>*session)<sp/>{</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__keyagg__cache__internal" kindref="compound">secp256k1_keyagg_cache_internal</ref><sp/>cache_i;</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__musig__session__internal" kindref="compound">secp256k1_musig_session_internal</ref><sp/>session_i;</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>mu,<sp/>e,<sp/>s;</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>pkj;</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>nonce_pts[2];</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>rj;</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__gej" kindref="compound">secp256k1_gej</ref><sp/>tmp;</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__ge" kindref="compound">secp256k1_ge</ref><sp/>pkp;</highlight></codeline>
<codeline lineno="745"><highlight class="normal"></highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(partial_sig<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(pubnonce<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(pubkey<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(keyagg_cache<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(session<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="752"><highlight class="normal"></highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_musig_session_load(ctx,<sp/>&amp;session_i,<sp/>session))<sp/>{</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="756"><highlight class="normal"></highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_musig_pubnonce_load(ctx,<sp/>nonce_pts,<sp/>pubnonce))<sp/>{</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Compute<sp/>&quot;effective&quot;<sp/>nonce<sp/>rj<sp/>=<sp/>nonce_pts[0]<sp/>+<sp/>b*nonce_pts[1]<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>TODO:<sp/>use<sp/>multiexp<sp/>to<sp/>compute<sp/>-s*G<sp/>+<sp/>e*mu*pubkey<sp/>+<sp/>nonce_pts[0]<sp/>+<sp/>b*nonce_pts[1]<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_effective_nonce(&amp;rj,<sp/>nonce_pts,<sp/>&amp;session_i.<ref refid="structsecp256k1__musig__session__internal_1a5fd209204d3de44c0084492b9cb8c692" kindref="member">noncecoef</ref>);</highlight></codeline>
<codeline lineno="763"><highlight class="normal"></highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_pubkey_load(ctx,<sp/>&amp;pkp,<sp/>pubkey))<sp/>{</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_keyagg_cache_load(ctx,<sp/>&amp;cache_i,<sp/>keyagg_cache))<sp/>{</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Multiplying<sp/>the<sp/>challenge<sp/>by<sp/>the<sp/>KeyAgg<sp/>coefficient<sp/>is<sp/>equivalent</highlight></codeline>
<codeline lineno="771"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>to<sp/>multiplying<sp/>the<sp/>signer&apos;s<sp/>public<sp/>key<sp/>by<sp/>the<sp/>coefficient,<sp/>except</highlight></codeline>
<codeline lineno="772"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>much<sp/>easier<sp/>to<sp/>do.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_musig_keyaggcoef(&amp;mu,<sp/>&amp;cache_i,<sp/>&amp;pkp);</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_mul(&amp;e,<sp/>&amp;session_i.<ref refid="structsecp256k1__musig__session__internal_1a03e546a8ba89fbbbb1f765257951f951" kindref="member">challenge</ref>,<sp/>&amp;mu);</highlight></codeline>
<codeline lineno="775"><highlight class="normal"></highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Negate<sp/>e<sp/>if<sp/>secp256k1_fe_is_odd(&amp;cache_i.pk.y))<sp/>XOR<sp/>cache_i.parity_acc.</highlight></codeline>
<codeline lineno="777"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>This<sp/>corresponds<sp/>to<sp/>the<sp/>line<sp/>&quot;Let<sp/>g&apos;<sp/>=<sp/>ggacc<sp/>mod<sp/>n&quot;<sp/>and<sp/>the<sp/>multiplication<sp/>&quot;g&apos;e&quot;</highlight></codeline>
<codeline lineno="778"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>in<sp/>the<sp/>specification.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="field_8h_1a5bcecb31c985b8cd07086ffc254b7902" kindref="member">secp256k1_fe_is_odd</ref>(&amp;cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1ab83e13ae5a279c417f3c293c3ac8dbaa" kindref="member">pk</ref>.<ref refid="structsecp256k1__ge_1a8ab8d07fa557181528b86bd1c9bb2b92" kindref="member">y</ref>)</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!=<sp/>cache_i.<ref refid="structsecp256k1__keyagg__cache__internal_1a5bd267ac4dec5fd0394bb1d61b918a22" kindref="member">parity_acc</ref>)<sp/>{</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_negate(&amp;e,<sp/>&amp;e);</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="783"><highlight class="normal"></highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_musig_partial_sig_load(ctx,<sp/>&amp;s,<sp/>partial_sig))<sp/>{</highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Compute<sp/>-s*G<sp/>+<sp/>e*pkj<sp/>+<sp/>rj<sp/>(e<sp/>already<sp/>includes<sp/>the<sp/>keyagg<sp/>coefficient<sp/>mu)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_negate(&amp;s,<sp/>&amp;s);</highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_gej_set_ge(&amp;pkj,<sp/>&amp;pkp);</highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_ecmult(&amp;tmp,<sp/>&amp;pkj,<sp/>&amp;e,<sp/>&amp;s);</highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(session_i.<ref refid="structsecp256k1__musig__session__internal_1a46e67b0bab0aa3bc9a66e605853b54de" kindref="member">fin_nonce_parity</ref>)<sp/>{</highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_gej_neg(&amp;rj,<sp/>&amp;rj);</highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_gej_add_var(&amp;tmp,<sp/>&amp;tmp,<sp/>&amp;rj,<sp/>NULL);</highlight></codeline>
<codeline lineno="795"><highlight class="normal"></highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>secp256k1_gej_is_infinity(&amp;tmp);</highlight></codeline>
<codeline lineno="797"><highlight class="normal">}</highlight></codeline>
<codeline lineno="798"><highlight class="normal"></highlight></codeline>
<codeline lineno="799" refid="secp256k1__musig_8h_1aa001ebd3ea7185c01e571e27e736cde1" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="session__impl_8h_1a5caae9c879594c721031cc6cdaea16d6" kindref="member">secp256k1_musig_partial_sig_agg</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="secp256k1_8h_1a282ec9e6dfec8c35955c3eb2f7476e5e" kindref="member">secp256k1_context</ref>*<sp/>ctx,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*sig64,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__session" kindref="compound">secp256k1_musig_session</ref><sp/>*session,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsecp256k1__musig__partial__sig" kindref="compound">secp256k1_musig_partial_sig</ref><sp/>*<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal">*<sp/>partial_sigs,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_sigs)<sp/>{</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__musig__session__internal" kindref="compound">secp256k1_musig_session_internal</ref><sp/>session_i;</highlight></codeline>
<codeline lineno="802"><highlight class="normal"></highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_2src_2util_8h_1aca8ac5ae73fd966db106de59160a178b" kindref="member">VERIFY_CHECK</ref>(ctx<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(sig64<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(session<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(partial_sigs<sp/>!=<sp/>NULL);</highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="secp256k1_8c_1a6e1f88c6ce07376501097b42a2b40727" kindref="member">ARG_CHECK</ref>(n_sigs<sp/>&gt;<sp/>0);</highlight></codeline>
<codeline lineno="808"><highlight class="normal"></highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_musig_session_load(ctx,<sp/>&amp;session_i,<sp/>session))<sp/>{</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>n_sigs;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsecp256k1__scalar" kindref="compound">secp256k1_scalar</ref><sp/>term;</highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!secp256k1_musig_partial_sig_load(ctx,<sp/>&amp;term,<sp/>partial_sigs[i]))<sp/>{</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>secp256k1_scalar_add(&amp;session_i.<ref refid="structsecp256k1__musig__session__internal_1a4d47fdcda6ed7f3692377a7b2b702dbb" kindref="member">s_part</ref>,<sp/>&amp;session_i.<ref refid="structsecp256k1__musig__session__internal_1a4d47fdcda6ed7f3692377a7b2b702dbb" kindref="member">s_part</ref>,<sp/>&amp;term);</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/>secp256k1_scalar_get_b32(&amp;sig64[32],<sp/>&amp;session_i.<ref refid="structsecp256k1__musig__session__internal_1a4d47fdcda6ed7f3692377a7b2b702dbb" kindref="member">s_part</ref>);</highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(&amp;sig64[0],<sp/>session_i.<ref refid="structsecp256k1__musig__session__internal_1a50ff1f51f8a70b481dd19ad14636ba1a" kindref="member">fin_nonce</ref>,<sp/>32);</highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="822"><highlight class="normal">}</highlight></codeline>
<codeline lineno="823"><highlight class="normal"></highlight></codeline>
<codeline lineno="824"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight></codeline>
    </programlisting>
    <location file="src/secp256k1/src/modules/musig/session_impl.h"/>
  </compounddef>
</doxygen>
