<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>bitcoind: TxReconciliationTracker Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="bitcoin.ico"/></td>
  <td id="projectalign">
   <div id="projectname">bitcoind<span id="projectnumber">&#160;2.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('class_tx_reconciliation_tracker.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">TxReconciliationTracker Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="txreconciliation_8h_source.html">txreconciliation.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-nested-classes" class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:Impl" id="r_Impl"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tx_reconciliation_tracker_1_1_impl.html">Impl</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pub-methods" class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aed6be0343a8cc41fc91f3b8f7317724c" id="r_aed6be0343a8cc41fc91f3b8f7317724c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aed6be0343a8cc41fc91f3b8f7317724c">TxReconciliationTracker</a> (uint32_t recon_version)</td></tr>
<tr class="memitem:a8b01adf9ae2ffdbb4879f1bd44b11ecd" id="r_a8b01adf9ae2ffdbb4879f1bd44b11ecd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8b01adf9ae2ffdbb4879f1bd44b11ecd">~TxReconciliationTracker</a> ()</td></tr>
<tr class="memitem:a553439bc6667ec9053705f586818847c" id="r_a553439bc6667ec9053705f586818847c"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a553439bc6667ec9053705f586818847c">PreRegisterPeer</a> (<a class="el" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> peer_id)</td></tr>
<tr class="memitem:acb6f9d93f04205571b7f528ca6fd11ee" id="r_acb6f9d93f04205571b7f528ca6fd11ee"><td class="memItemLeft" align="right" valign="top"><a class="el" href="txreconciliation_8h.html#a7a6f29933f8f0193e0b8289468a2337f">ReconciliationRegisterResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acb6f9d93f04205571b7f528ca6fd11ee">RegisterPeer</a> (<a class="el" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> peer_id, bool is_peer_inbound, uint32_t peer_recon_version, uint64_t remote_salt)</td></tr>
<tr class="memitem:adb141a7aed273b229b773c503e5cc075" id="r_adb141a7aed273b229b773c503e5cc075"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adb141a7aed273b229b773c503e5cc075">ForgetPeer</a> (<a class="el" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> peer_id)</td></tr>
<tr class="memitem:aae67cea096486b6432b3ef0f74d01fbb" id="r_aae67cea096486b6432b3ef0f74d01fbb"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aae67cea096486b6432b3ef0f74d01fbb">IsPeerRegistered</a> (<a class="el" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> peer_id) const</td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Transaction reconciliation is a way for nodes to efficiently announce transactions. This object keeps track of all txreconciliation-related communications with the peers. The high-level protocol is:</p><ol type="1">
<li>Txreconciliation protocol handshake.</li>
<li>Once we receive a new transaction, add it to the set instead of announcing immediately.</li>
<li>At regular intervals, a txreconciliation initiator requests a sketch from a peer, where a sketch is a compressed representation of short form IDs of the transactions in their set.</li>
<li>Once the initiator received a sketch from the peer, the initiator computes a local sketch, and combines the two sketches to attempt finding the difference in <em>sets</em>. 4a. If the difference was not larger than estimated, see SUCCESS below. 4b. If the difference was larger than estimated, initial txreconciliation fails. The initiator requests a larger sketch via an extension round (allowed only once).<ul>
<li>If extension succeeds (a larger sketch is sufficient), see SUCCESS below.</li>
<li>If extension fails (a larger sketch is insufficient), see FAILURE below.</li>
</ul>
</li>
</ol>
<p>SUCCESS. The initiator knows full symmetrical difference and can request what the initiator is missing and announce to the peer what the peer is missing.</p>
<p>FAILURE. The initiator notifies the peer about the failure and announces all transactions from the corresponding set. Once the peer received the failure notification, the peer announces all transactions from their set.</p>
<p>This is a modification of the Erlay protocol (<a href="https://arxiv.org/abs/1905.10518">https://arxiv.org/abs/1905.10518</a>) with two changes (sketch extensions instead of bisections, and an extra INV exchange round), both are motivated in BIP-330. </p>
</div><a name="doc-constructors" id="doc-constructors"></a><h2 id="header-doc-constructors" class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="aed6be0343a8cc41fc91f3b8f7317724c" name="aed6be0343a8cc41fc91f3b8f7317724c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed6be0343a8cc41fc91f3b8f7317724c">&#9670;&#160;</a></span>TxReconciliationTracker()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_tx_reconciliation_tracker.html">TxReconciliationTracker</a> </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>recon_version</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel explicit">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a8b01adf9ae2ffdbb4879f1bd44b11ecd" name="a8b01adf9ae2ffdbb4879f1bd44b11ecd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b01adf9ae2ffdbb4879f1bd44b11ecd">&#9670;&#160;</a></span>~TxReconciliationTracker()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">~<a class="el" href="class_tx_reconciliation_tracker.html">TxReconciliationTracker</a> </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel default">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Member Function Documentation</h2>
<a id="adb141a7aed273b229b773c503e5cc075" name="adb141a7aed273b229b773c503e5cc075"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb141a7aed273b229b773c503e5cc075">&#9670;&#160;</a></span>ForgetPeer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ForgetPeer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a></td>          <td class="paramname"><span class="paramname"><em>peer_id</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Attempts to forget txreconciliation-related state of the peer (if we previously stored any). After this, we won't be able to reconcile transactions with the peer. </p>

</div>
</div>
<a id="aae67cea096486b6432b3ef0f74d01fbb" name="aae67cea096486b6432b3ef0f74d01fbb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae67cea096486b6432b3ef0f74d01fbb">&#9670;&#160;</a></span>IsPeerRegistered()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool IsPeerRegistered </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a></td>          <td class="paramname"><span class="paramname"><em>peer_id</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check if a peer is registered to reconcile transactions with us. </p>

</div>
</div>
<a id="a553439bc6667ec9053705f586818847c" name="a553439bc6667ec9053705f586818847c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a553439bc6667ec9053705f586818847c">&#9670;&#160;</a></span>PreRegisterPeer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t PreRegisterPeer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a></td>          <td class="paramname"><span class="paramname"><em>peer_id</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Step 0. Generates initial part of the state (salt) required to reconcile txs with the peer. The salt is used for short ID computation required for txreconciliation. The function returns the salt. A peer can't participate in future txreconciliations without this call. This function must be called only once per peer. </p>

</div>
</div>
<a id="acb6f9d93f04205571b7f528ca6fd11ee" name="acb6f9d93f04205571b7f528ca6fd11ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb6f9d93f04205571b7f528ca6fd11ee">&#9670;&#160;</a></span>RegisterPeer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="txreconciliation_8h.html#a7a6f29933f8f0193e0b8289468a2337f">ReconciliationRegisterResult</a> RegisterPeer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a></td>          <td class="paramname"><span class="paramname"><em>peer_id</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>is_peer_inbound</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>peer_recon_version</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t</td>          <td class="paramname"><span class="paramname"><em>remote_salt</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Step 0. Once the peer agreed to reconcile txs with us, generate the state required to track ongoing reconciliations. Must be called only after pre-registering the peer and only once. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/node/<a class="el" href="txreconciliation_8h_source.html">txreconciliation.h</a></li>
<li>src/node/<a class="el" href="txreconciliation_8cpp.html">txreconciliation.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="class_tx_reconciliation_tracker.html">TxReconciliationTracker</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
