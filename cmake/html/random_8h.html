<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>bitcoind: src/random.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="bitcoin.ico"/></td>
  <td id="projectalign">
   <div id="projectname">bitcoind<span id="projectnumber">&#160;2.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('random_8h.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">random.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="chacha20_8h_source.html">crypto/chacha20.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="crypto_2common_8h_source.html">crypto/common.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="span_8h_source.html">span.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="uint256_8h_source.html">uint256.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="check_8h_source.html">util/check.h</a>&gt;</code><br />
<code>#include &lt;bit&gt;</code><br />
<code>#include &lt;cassert&gt;</code><br />
<code>#include &lt;chrono&gt;</code><br />
<code>#include &lt;concepts&gt;</code><br />
<code>#include &lt;cstdint&gt;</code><br />
<code>#include &lt;limits&gt;</code><br />
<code>#include &lt;type_traits&gt;</code><br />
<code>#include &lt;vector&gt;</code><br />
</div>
<p><a href="random_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-nested-classes" class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:RandomMixin_3C_20T_20_3E" id="r_RandomMixin_3C_20T_20_3E"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_random_mixin.html">RandomMixin&lt; T &gt;</a></td></tr>
<tr class="memitem:FastRandomContext" id="r_FastRandomContext"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fast_random_context.html">FastRandomContext</a></td></tr>
<tr class="memitem:InsecureRandomContext" id="r_InsecureRandomContext"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_insecure_random_context.html">InsecureRandomContext</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-concepts" class="groupheader"><a id="concepts" name="concepts"></a>
Concepts</h2></td></tr>
<tr class="memitem:RandomNumberGenerator" id="r_RandomNumberGenerator"><td class="memItemLeft" align="right" valign="top">concept &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="concept_random_number_generator.html">RandomNumberGenerator</a></td></tr>
<tr class="memitem:StdChronoDuration" id="r_StdChronoDuration"><td class="memItemLeft" align="right" valign="top">concept &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="concept_std_chrono_duration.html">StdChronoDuration</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa4c101f3cf6614b5922770a6f5ca7209" id="r_aa4c101f3cf6614b5922770a6f5ca7209"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa4c101f3cf6614b5922770a6f5ca7209">RandomInit</a> ()</td></tr>
<tr class="memitem:a315ac9735459c7f7ba575faa0810d03e" id="r_a315ac9735459c7f7ba575faa0810d03e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a315ac9735459c7f7ba575faa0810d03e">RandAddPeriodic</a> () noexcept</td></tr>
<tr class="memitem:ac10d1b23919c03e5f708da1748e476a1" id="r_ac10d1b23919c03e5f708da1748e476a1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac10d1b23919c03e5f708da1748e476a1">RandAddEvent</a> (const uint32_t event_info) noexcept</td></tr>
<tr class="memitem:ab12e884f2063117fd7ae32b213b83175" id="r_ab12e884f2063117fd7ae32b213b83175"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab12e884f2063117fd7ae32b213b83175">GetRandBytes</a> (std::span&lt; unsigned char &gt; bytes) noexcept</td></tr>
<tr class="memitem:a573a23ce1afe5405047d74faaafe7cbd" id="r_a573a23ce1afe5405047d74faaafe7cbd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a573a23ce1afe5405047d74faaafe7cbd">GetStrongRandBytes</a> (std::span&lt; unsigned char &gt; bytes) noexcept</td></tr>
<tr class="memitem:ac5b0dc6cd7937fa98493857db6389696" id="r_ac5b0dc6cd7937fa98493857db6389696"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac5b0dc6cd7937fa98493857db6389696">MakeExponentiallyDistributed</a> (uint64_t uniform) noexcept</td></tr>
<tr class="memitem:a88672f91432a247654f2c06298dd58ee" id="r_a88672f91432a247654f2c06298dd58ee"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classuint256.html">uint256</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a88672f91432a247654f2c06298dd58ee">GetRandHash</a> () noexcept</td></tr>
<tr class="memitem:a7fb6c441a23070a7f510fd48b5ca2a18" id="r_a7fb6c441a23070a7f510fd48b5ca2a18"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7fb6c441a23070a7f510fd48b5ca2a18">Random_SanityCheck</a> ()</td></tr>
</table>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="ab12e884f2063117fd7ae32b213b83175" name="ab12e884f2063117fd7ae32b213b83175"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab12e884f2063117fd7ae32b213b83175">&#9670;&#160;</a></span>GetRandBytes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void GetRandBytes </td>
          <td>(</td>
          <td class="paramtype">std::span&lt; unsigned char &gt;</td>          <td class="paramname"><span class="paramname"><em>bytes</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel noexcept">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Generate random data via the internal PRNG.</p>
<p>These functions are designed to be fast (sub microsecond), but do not necessarily meaningfully add entropy to the PRNG state.</p>
<p>In test mode (see SeedRandomForTest in <a class="el" href="test_2util_2random_8h.html">src/test/util/random.h</a>), the normal PRNG state is bypassed, and a deterministic, seeded, PRNG is used instead.</p>
<p>Thread-safe. </p>

</div>
</div>
<a id="a88672f91432a247654f2c06298dd58ee" name="a88672f91432a247654f2c06298dd58ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88672f91432a247654f2c06298dd58ee">&#9670;&#160;</a></span>GetRandHash()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classuint256.html">uint256</a> GetRandHash </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel noexcept">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Generate a random <a class="el" href="classuint256.html">uint256</a>. </p>

</div>
</div>
<a id="a573a23ce1afe5405047d74faaafe7cbd" name="a573a23ce1afe5405047d74faaafe7cbd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a573a23ce1afe5405047d74faaafe7cbd">&#9670;&#160;</a></span>GetStrongRandBytes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void GetStrongRandBytes </td>
          <td>(</td>
          <td class="paramtype">std::span&lt; unsigned char &gt;</td>          <td class="paramname"><span class="paramname"><em>bytes</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel noexcept">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Gather entropy from various sources, feed it into the internal PRNG, and generate random data using it.</p>
<p>This function will cause failure whenever the OS RNG fails.</p>
<p>The normal PRNG is never bypassed here, even in test mode.</p>
<p>Thread-safe. </p>

</div>
</div>
<a id="ac5b0dc6cd7937fa98493857db6389696" name="ac5b0dc6cd7937fa98493857db6389696"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac5b0dc6cd7937fa98493857db6389696">&#9670;&#160;</a></span>MakeExponentiallyDistributed()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double MakeExponentiallyDistributed </td>
          <td>(</td>
          <td class="paramtype">uint64_t</td>          <td class="paramname"><span class="paramname"><em>uniform</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel noexcept">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Given a uniformly random uint64_t, return an exponentially distributed double with mean 1. </p>

</div>
</div>
<a id="ac10d1b23919c03e5f708da1748e476a1" name="ac10d1b23919c03e5f708da1748e476a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac10d1b23919c03e5f708da1748e476a1">&#9670;&#160;</a></span>RandAddEvent()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void RandAddEvent </td>
          <td>(</td>
          <td class="paramtype">const uint32_t</td>          <td class="paramname"><span class="paramname"><em>event_info</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel noexcept">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Gathers entropy from the low bits of the time at which events occur. Should be called with a uint32_t describing the event at the time an event occurs.</p>
<p>Thread-safe. </p>

</div>
</div>
<a id="a315ac9735459c7f7ba575faa0810d03e" name="a315ac9735459c7f7ba575faa0810d03e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a315ac9735459c7f7ba575faa0810d03e">&#9670;&#160;</a></span>RandAddPeriodic()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void RandAddPeriodic </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel noexcept">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Gather entropy from various expensive sources, and feed them to the PRNG state.</p>
<p>Thread-safe. </p>

</div>
</div>
<a id="a7fb6c441a23070a7f510fd48b5ca2a18" name="a7fb6c441a23070a7f510fd48b5ca2a18"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7fb6c441a23070a7f510fd48b5ca2a18">&#9670;&#160;</a></span>Random_SanityCheck()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Random_SanityCheck </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check that OS randomness is available and returning the requested number of bytes. </p>

</div>
</div>
<a id="aa4c101f3cf6614b5922770a6f5ca7209" name="aa4c101f3cf6614b5922770a6f5ca7209"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4c101f3cf6614b5922770a6f5ca7209">&#9670;&#160;</a></span>RandomInit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RandomInit </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Overall design of the RNG and entropy sources.</p>
<p>We maintain a single global 256-bit RNG state for all high-quality randomness. The following (classes of) functions interact with that state by mixing in new entropy, and optionally extracting random output from it:</p>
<ul>
<li>GetRandBytes, GetRandHash, GetRandDur, as well as construction of <a class="el" href="class_fast_random_context.html">FastRandomContext</a> objects, perform 'fast' seeding, consisting of mixing in:<ul>
<li>A stack pointer (indirectly committing to calling thread and call stack)</li>
<li>A high-precision timestamp (rdtsc when available, c++ high_resolution_clock otherwise)</li>
<li>64 bits from the hardware RNG (rdrand) when available. These entropy sources are very fast, and only designed to protect against situations where a VM state restore/copy results in multiple systems with the same randomness. <a class="el" href="class_fast_random_context.html">FastRandomContext</a> on the other hand does not protect against this once created, but is even faster (and acceptable to use inside tight loops).</li>
</ul>
</li>
<li>The <a class="el" href="#a573a23ce1afe5405047d74faaafe7cbd">GetStrongRandBytes()</a> function performs 'slow' seeding, including everything that fast seeding includes, but additionally:<ul>
<li>OS entropy (/dev/urandom, getrandom(), ...). The application will terminate if this entropy source fails.</li>
<li>Another high-precision timestamp (indirectly committing to a benchmark of all the previous sources). These entropy sources are slower, but designed to make sure the RNG state contains fresh data that is unpredictable to attackers.</li>
</ul>
</li>
<li><a class="el" href="#a315ac9735459c7f7ba575faa0810d03e">RandAddPeriodic()</a> seeds everything that fast seeding includes, but additionally:<ul>
<li>A high-precision timestamp</li>
<li>Dynamic environment data (clocks, resource usage, ...)</li>
<li>Strengthen the entropy for 10 ms using repeated SHA512. This is run once every minute.</li>
</ul>
</li>
<li>On first use of the RNG (regardless of what function is called first), all entropy sources used in the 'slow' seeder are included, but also:<ul>
<li>256 bits from the hardware RNG (rdseed or rdrand) when available.</li>
<li>Dynamic environment data (performance monitoring, ...)</li>
<li>Static environment data</li>
<li>Strengthen the entropy for 100 ms using repeated SHA512.</li>
</ul>
</li>
</ul>
<p>When mixing in new entropy, H = SHA512(entropy || old_rng_state) is computed, and (up to) the first 32 bytes of H are produced as output, while the last 32 bytes become the new RNG state.</p>
<p>During tests, the RNG can be put into a special deterministic mode, in which the output of all RNG functions, with the exception of <a class="el" href="#a573a23ce1afe5405047d74faaafe7cbd">GetStrongRandBytes()</a>, is replaced with the output of a deterministic RNG. This deterministic RNG does not gather entropy, and is unaffected by <a class="el" href="#a315ac9735459c7f7ba575faa0810d03e">RandAddPeriodic()</a> or <a class="el" href="#ac10d1b23919c03e5f708da1748e476a1">RandAddEvent()</a>. It produces pseudorandom data that only depends on the seed it was initialized with, possibly until it is reinitialized. Initialize global RNG state and log any CPU features that are used.</p>
<p>Calling this function is optional. RNG state will be initialized when first needed if it is not called. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a href="random_8h.html">random.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
