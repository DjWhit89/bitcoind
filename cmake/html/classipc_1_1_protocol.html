<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>bitcoind: Protocol Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="bitcoin.ico"/></td>
  <td id="projectalign">
   <div id="projectname">bitcoind<span id="projectnumber">&#160;2.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('classipc_1_1_protocol.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Protocol Class Reference<span class="mlabels"><span class="mlabel abstract">abstract</span></span></div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="ipc_2protocol_8h_source.html">protocol.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pub-methods" class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ae8dff142c91e726e5e1ca3abff872adf" id="r_ae8dff142c91e726e5e1ca3abff872adf"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae8dff142c91e726e5e1ca3abff872adf">~Protocol</a> ()=default</td></tr>
<tr class="memitem:a098584fc42adacc9ecfd5dc910fea66f" id="r_a098584fc42adacc9ecfd5dc910fea66f"><td class="memItemLeft" align="right" valign="top">virtual std::unique_ptr&lt; <a class="el" href="classinterfaces_1_1_init.html">interfaces::Init</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a098584fc42adacc9ecfd5dc910fea66f">connect</a> (int fd, const char *exe_name)=0</td></tr>
<tr class="memitem:aefda533b5b61d4d7c1e4aa513ee94aa9" id="r_aefda533b5b61d4d7c1e4aa513ee94aa9"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aefda533b5b61d4d7c1e4aa513ee94aa9">listen</a> (int listen_fd, const char *exe_name, <a class="el" href="classinterfaces_1_1_init.html">interfaces::Init</a> &amp;<a class="el" href="namespaceinit.html">init</a>)=0</td></tr>
<tr class="memitem:a5249513dbbca3afe53c192be98ac7504" id="r_a5249513dbbca3afe53c192be98ac7504"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5249513dbbca3afe53c192be98ac7504">serve</a> (int fd, const char *exe_name, <a class="el" href="classinterfaces_1_1_init.html">interfaces::Init</a> &amp;<a class="el" href="namespaceinit.html">init</a>, const std::function&lt; void()&gt; &amp;ready_fn={})=0</td></tr>
<tr class="memitem:a45306c63b743375d0db4f613d2de7300" id="r_a45306c63b743375d0db4f613d2de7300"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a45306c63b743375d0db4f613d2de7300">disconnectIncoming</a> ()=0</td></tr>
<tr class="memdesc:a45306c63b743375d0db4f613d2de7300"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disconnect any incoming connections that are still connected.  <br /></td></tr>
<tr class="memitem:ab752d262895c2173617749fea06bcba1" id="r_ab752d262895c2173617749fea06bcba1"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab752d262895c2173617749fea06bcba1">addCleanup</a> (std::type_index type, void *iface, std::function&lt; void()&gt; cleanup)=0</td></tr>
<tr class="memitem:a4b2af83137ac1ea8dd7afb875940b3cb" id="r_a4b2af83137ac1ea8dd7afb875940b3cb"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="structipc_1_1_context.html">Context</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4b2af83137ac1ea8dd7afb875940b3cb">context</a> ()=0</td></tr>
<tr class="memdesc:a4b2af83137ac1ea8dd7afb875940b3cb"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="structipc_1_1_context.html">Context</a> accessor.  <br /></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>IPC protocol interface for calling IPC methods over sockets.</p>
<p>There may be different implementations of this interface for different IPC protocols (e.g. Cap'n Proto, gRPC, JSON-RPC, or custom protocols). </p>
</div><a name="doc-constructors" id="doc-constructors"></a><h2 id="header-doc-constructors" class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ae8dff142c91e726e5e1ca3abff872adf" name="ae8dff142c91e726e5e1ca3abff872adf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8dff142c91e726e5e1ca3abff872adf">&#9670;&#160;</a></span>~Protocol()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual ~<a class="el" href="classipc_1_1_protocol.html">Protocol</a> </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel virtual">virtual</span><span class="mlabel default">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Member Function Documentation</h2>
<a id="ab752d262895c2173617749fea06bcba1" name="ab752d262895c2173617749fea06bcba1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab752d262895c2173617749fea06bcba1">&#9670;&#160;</a></span>addCleanup()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void addCleanup </td>
          <td>(</td>
          <td class="paramtype">std::type_index</td>          <td class="paramname"><span class="paramname"><em>type</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>iface</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; void()&gt;</td>          <td class="paramname"><span class="paramname"><em>cleanup</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel pure-virtual">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Add cleanup callback to interface that will run when the interface is deleted. </p>

</div>
</div>
<a id="a098584fc42adacc9ecfd5dc910fea66f" name="a098584fc42adacc9ecfd5dc910fea66f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a098584fc42adacc9ecfd5dc910fea66f">&#9670;&#160;</a></span>connect()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual std::unique_ptr&lt; <a class="el" href="classinterfaces_1_1_init.html">interfaces::Init</a> &gt; connect </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>exe_name</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel pure-virtual">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return <a class="el" href="class_init.html">Init</a> interface that forwards requests over given socket descriptor. Socket communication is handled on a background thread.</p>
<dl class="section note"><dt>Note</dt><dd>It could be potentially useful in the future to add std::function&lt;void()&gt; on_disconnect callback argument here. But there isn't an immediate need, because the protocol implementation can clean up its own state (calling ProxyServer destructors, etc) on disconnect, and any client calls will just throw <a class="el" href="classipc_1_1_exception.html">ipc::Exception</a> errors after a disconnect. </dd></dl>

</div>
</div>
<a id="a4b2af83137ac1ea8dd7afb875940b3cb" name="a4b2af83137ac1ea8dd7afb875940b3cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b2af83137ac1ea8dd7afb875940b3cb">&#9670;&#160;</a></span>context()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="structipc_1_1_context.html">Context</a> &amp; context </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel pure-virtual">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><a class="el" href="structipc_1_1_context.html">Context</a> accessor. </p>

</div>
</div>
<a id="a45306c63b743375d0db4f613d2de7300" name="a45306c63b743375d0db4f613d2de7300"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45306c63b743375d0db4f613d2de7300">&#9670;&#160;</a></span>disconnectIncoming()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void disconnectIncoming </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel pure-virtual">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Disconnect any incoming connections that are still connected. </p>

</div>
</div>
<a id="aefda533b5b61d4d7c1e4aa513ee94aa9" name="aefda533b5b61d4d7c1e4aa513ee94aa9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aefda533b5b61d4d7c1e4aa513ee94aa9">&#9670;&#160;</a></span>listen()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void listen </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>listen_fd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>exe_name</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classinterfaces_1_1_init.html">interfaces::Init</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>init</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel pure-virtual">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Listen for connections on provided socket descriptor, accept them, and handle requests on accepted connections. This method doesn't block, and performs I/O on a background thread. </p>

</div>
</div>
<a id="a5249513dbbca3afe53c192be98ac7504" name="a5249513dbbca3afe53c192be98ac7504"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5249513dbbca3afe53c192be98ac7504">&#9670;&#160;</a></span>serve()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void serve </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>exe_name</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classinterfaces_1_1_init.html">interfaces::Init</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>init</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::function&lt; void()&gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>ready_fn</em></span><span class="paramdefsep"> = </span><span class="paramdefval">{}</span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel pure-virtual">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Handle requests on provided socket descriptor, forwarding them to the provided <a class="el" href="class_init.html">Init</a> interface. Socket communication is handled on the current thread, and this call blocks until the socket is closed.</p>
<dl class="section note"><dt>Note</dt><dd>: If this method is called, it needs be called before <a class="el" href="#a098584fc42adacc9ecfd5dc910fea66f">connect()</a> or <a class="el" href="#aefda533b5b61d4d7c1e4aa513ee94aa9">listen()</a> methods, because for ease of implementation it's inflexible and always runs the event loop in the foreground thread. It can share its event loop with the other methods but can't share an event loop that was created by them. This isn't really a problem because <a class="el" href="#a5249513dbbca3afe53c192be98ac7504">serve()</a> is only called by spawned child processes that call it immediately to communicate back with parent processes.</dd></dl>
<p>The optional <span class="tt">ready_fn</span> callback will be called after the event loop is created but before it is started. This can be useful in tests to trigger client connections from another thread as soon as the event loop is available, but should not be necessary in normal code which starts clients and servers independently. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/ipc/<a class="el" href="ipc_2protocol_8h_source.html">protocol.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="namespaceipc.html">ipc</a></li><li class="navelem"><a href="classipc_1_1_protocol.html">Protocol</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
