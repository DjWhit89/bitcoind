<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>bitcoind: BlockManager Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="bitcoin.ico"/></td>
  <td id="projectalign">
   <div id="projectname">bitcoind<span id="projectnumber">&#160;2.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('class_block_manager.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">BlockManager Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="blockstorage_8h_source.html">blockstorage.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for BlockManager:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_block_manager.png" usemap="#BlockManager_map" alt=""/>
  <map id="BlockManager_map" name="BlockManager_map">
<area href="struct_test_block_manager.html" alt="TestBlockManager" shape="rect" coords="0,56,117,80"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pub-types" class="groupheader"><a id="pub-types" name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a9d388cded97cd9f86c06358bb29abfad" id="r_a9d388cded97cd9f86c06358bb29abfad"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9d388cded97cd9f86c06358bb29abfad">Options</a> = <a class="el" href="structkernel_1_1_block_manager_opts.html">kernel::BlockManagerOpts</a></td></tr>
<tr class="memitem:ae44324a3c3aae8cdb9bdecd43260b98f" id="r_ae44324a3c3aae8cdb9bdecd43260b98f"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae44324a3c3aae8cdb9bdecd43260b98f">ReadRawBlockResult</a> = <a class="el" href="classutil_1_1_expected.html">util::Expected</a>&lt;std::vector&lt;std::byte&gt;, ReadRawError&gt;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pub-methods" class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3b953f400cc4e659ab9651c3dea79da5" id="r_a3b953f400cc4e659ab9651c3dea79da5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="validation_8cpp.html#acee0086a0c833617dd1532caf93206a3">BlockMap</a> m_block_index&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3b953f400cc4e659ab9651c3dea79da5">GUARDED_BY</a> (<a class="el" href="cs__main_8cpp.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memitem:ad06570b26658d12ac3ad08750e3b8f7c" id="r_ad06570b26658d12ac3ad08750e3b8f7c"><td class="memItemLeft" align="right" valign="top">std::unique_ptr&lt; <a class="el" href="classnode_1_1_block_tree_d_b.html">BlockTreeDB</a> &gt; m_block_tree_db&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad06570b26658d12ac3ad08750e3b8f7c">GUARDED_BY</a> (<a class="el" href="cs__main_8cpp.html#ab88a4b9173207cf250ece7820db1f36d">::cs_main</a>)</td></tr>
<tr class="memitem:a5a7ab0002709da74f13f76921377c42c" id="r_a5a7ab0002709da74f13f76921377c42c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5a7ab0002709da74f13f76921377c42c">BlockManager</a> (const <a class="el" href="classutil_1_1_signal_interrupt.html">util::SignalInterrupt</a> &amp;interrupt, <a class="el" href="#a9d388cded97cd9f86c06358bb29abfad">Options</a><a class="el" href="struct_options.html">Options</a> opts)</td></tr>
<tr class="memitem:aa95eeae5f69857893eacc49700873255" id="r_aa95eeae5f69857893eacc49700873255"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_c_block_index.html">CBlockIndex</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa95eeae5f69857893eacc49700873255">InsertBlockIndex</a> (const <a class="el" href="classuint256.html">uint256</a> &amp;hash) <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="el" href="cs__main_8cpp.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memitem:a6ebc263091ba81ceaa3ec37d1000bf9b" id="r_a6ebc263091ba81ceaa3ec37d1000bf9b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6ebc263091ba81ceaa3ec37d1000bf9b">PruneOneBlockFile</a> (const int fileNumber) <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="el" href="cs__main_8cpp.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memdesc:a6ebc263091ba81ceaa3ec37d1000bf9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mark one block file as pruned (modify associated database entries).  <br /></td></tr>
<tr class="memitem:a87eab19fb1a7e025715c13377ebfd356" id="r_a87eab19fb1a7e025715c13377ebfd356"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_c_block_index.html">CBlockIndex</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a87eab19fb1a7e025715c13377ebfd356">LookupBlockIndex</a> (const <a class="el" href="classuint256.html">uint256</a> &amp;hash) <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="el" href="cs__main_8cpp.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memitem:afc9665be19b586880b275f0ccf17c8bb" id="r_afc9665be19b586880b275f0ccf17c8bb"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="class_c_block_index.html">CBlockIndex</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afc9665be19b586880b275f0ccf17c8bb">LookupBlockIndex</a> (const <a class="el" href="classuint256.html">uint256</a> &amp;hash) const <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="el" href="cs__main_8cpp.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memitem:a524e9acdceb9fae201dbe36bd66c80e7" id="r_a524e9acdceb9fae201dbe36bd66c80e7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_c_block_file_info.html">CBlockFileInfo</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a524e9acdceb9fae201dbe36bd66c80e7">GetBlockFileInfo</a> (size_t n)</td></tr>
<tr class="memitem:ac998253c8454e8f69d78c62fba7a5253" id="r_ac998253c8454e8f69d78c62fba7a5253"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac998253c8454e8f69d78c62fba7a5253">UpdateBlockInfo</a> (const <a class="el" href="class_c_block.html">CBlock</a> &amp;block, unsigned int <a class="el" href="mempool__ephemeral__spends_8cpp.html#a2e4c6b811457a16b7033af6741cfb1db">nHeight</a>, const <a class="el" href="struct_flat_file_pos.html">FlatFilePos</a> &amp;pos)</td></tr>
<tr class="memitem:ad03fd92fad95bb7f82ef78cc467cb12b" id="r_ad03fd92fad95bb7f82ef78cc467cb12b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad03fd92fad95bb7f82ef78cc467cb12b">IsPruneMode</a> () const</td></tr>
<tr class="memitem:a95455271ec88dfcc93e411237b36a57c" id="r_a95455271ec88dfcc93e411237b36a57c"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a95455271ec88dfcc93e411237b36a57c">GetPruneTarget</a> () const</td></tr>
<tr class="memitem:acef48b2a0b8aa252efa69928192b4d5a" id="r_acef48b2a0b8aa252efa69928192b4d5a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acef48b2a0b8aa252efa69928192b4d5a">LoadingBlocks</a> () const</td></tr>
<tr class="memitem:a5d513fc954905589bc2a99da7d51e923" id="r_a5d513fc954905589bc2a99da7d51e923"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5d513fc954905589bc2a99da7d51e923">CalculateCurrentUsage</a> ()</td></tr>
<tr class="memitem:a375f39dd7a25d0087c57ee6704eb7953" id="r_a375f39dd7a25d0087c57ee6704eb7953"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfs_1_1path.html">fs::path</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a375f39dd7a25d0087c57ee6704eb7953">GetBlockPosFilename</a> (const <a class="el" href="struct_flat_file_pos.html">FlatFilePos</a> &amp;pos) const</td></tr>
<tr class="memitem:a0592de206bb3aa3070fb685e6c0b8923" id="r_a0592de206bb3aa3070fb685e6c0b8923"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0592de206bb3aa3070fb685e6c0b8923">UnlinkPrunedFiles</a> (const std::set&lt; int &gt; &amp;setFilesToPrune) const</td></tr>
<tr class="memitem:ad59bbdccdaca9da495b6b6e80c481a1a" id="r_ad59bbdccdaca9da495b6b6e80c481a1a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad59bbdccdaca9da495b6b6e80c481a1a">ReadBlock</a> (<a class="el" href="class_c_block.html">CBlock</a> &amp;block, const <a class="el" href="struct_flat_file_pos.html">FlatFilePos</a> &amp;pos, const std::optional&lt; <a class="el" href="classuint256.html">uint256</a> &gt; &amp;expected_hash) const</td></tr>
<tr class="memitem:a5637a4074380a9138c49742f8d0f39b8" id="r_a5637a4074380a9138c49742f8d0f39b8"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5637a4074380a9138c49742f8d0f39b8">ReadBlock</a> (<a class="el" href="class_c_block.html">CBlock</a> &amp;block, const <a class="el" href="class_c_block_index.html">CBlockIndex</a> &amp;index) const</td></tr>
<tr class="memitem:a0bfb8d6c21eed2929e6a388578ceae4d" id="r_a0bfb8d6c21eed2929e6a388578ceae4d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="#ae44324a3c3aae8cdb9bdecd43260b98f">ReadRawBlockResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0bfb8d6c21eed2929e6a388578ceae4d">ReadRawBlock</a> (const <a class="el" href="struct_flat_file_pos.html">FlatFilePos</a> &amp;pos, std::optional&lt; std::pair&lt; size_t, size_t &gt; &gt; block_part=std::nullopt) const</td></tr>
<tr class="memitem:a054cbf50f4e5cb582fd744927f9ace7a" id="r_a054cbf50f4e5cb582fd744927f9ace7a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a054cbf50f4e5cb582fd744927f9ace7a">ReadBlockUndo</a> (<a class="el" href="class_c_block_undo.html">CBlockUndo</a> &amp;blockundo, const <a class="el" href="class_c_block_index.html">CBlockIndex</a> &amp;index) const</td></tr>
<tr class="memitem:aabaa6172d403bb91657add7f42f3b371" id="r_aabaa6172d403bb91657add7f42f3b371"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aabaa6172d403bb91657add7f42f3b371">CleanupBlockRevFiles</a> () const</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pub-attribs" class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:a2163d8ef789c585b196a3ec7f468244b" id="r_a2163d8ef789c585b196a3ec7f468244b"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classutil_1_1_signal_interrupt.html">util::SignalInterrupt</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2163d8ef789c585b196a3ec7f468244b">m_interrupt</a></td></tr>
<tr class="memitem:a394b5b401d4fcd3c693dea7d6314ec7d" id="r_a394b5b401d4fcd3c693dea7d6314ec7d"><td class="memItemLeft" align="right" valign="top">std::atomic&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a394b5b401d4fcd3c693dea7d6314ec7d">m_importing</a> {false}</td></tr>
<tr class="memitem:a5627151c890af8526b512ff75f09eba1" id="r_a5627151c890af8526b512ff75f09eba1"><td class="memItemLeft" align="right" valign="top">std::atomic_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5627151c890af8526b512ff75f09eba1">m_blockfiles_indexed</a> {true}</td></tr>
<tr class="memitem:a4768bb381991af0538ef921446f5ae92" id="r_a4768bb381991af0538ef921446f5ae92"><td class="memItemLeft" align="right" valign="top">std::optional&lt; int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4768bb381991af0538ef921446f5ae92">m_snapshot_height</a></td></tr>
<tr class="memitem:a1a2028bdb52a8d052b7ccc0fae0888be" id="r_a1a2028bdb52a8d052b7ccc0fae0888be"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="class_c_block_index.html">CBlockIndex</a> * &gt; GetAllBlockIndices() <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(std::multimap&lt; <a class="el" href="class_c_block_index.html">CBlockIndex</a> *, <a class="el" href="class_c_block_index.html">CBlockIndex</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1a2028bdb52a8d052b7ccc0fae0888be">m_blocks_unlinked</a></td></tr>
<tr class="memitem:aa23f0a6c8540ce84e6526e2a7fe6aeec" id="r_aa23f0a6c8540ce84e6526e2a7fe6aeec"><td class="memItemLeft" align="right" valign="top">void WriteBlockIndexDB() <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(bool LoadBlockIndexDB(const std::optional&lt; <a class="el" href="classuint256.html">uint256</a> &gt; &amp;snapshot_blockhash) <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(void ScanAndUnlinkAlreadyPrunedFiles() <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="el" href="class_c_block_index.html">CBlockIndex</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa23f0a6c8540ce84e6526e2a7fe6aeec">AddToBlockIndex</a> )(const <a class="el" href="class_c_block_header.html">CBlockHeader</a> &amp;block, <a class="el" href="class_c_block_index.html">CBlockIndex</a> *&amp;best_header) <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="el" href="cs__main_8cpp.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memitem:ae70b06aaf862d5ee0b31de6bab121136" id="r_ae70b06aaf862d5ee0b31de6bab121136"><td class="memItemLeft" align="right" valign="top">bool WriteBlockUndo(const <a class="el" href="class_c_block_undo.html">CBlockUndo</a> &amp;blockundo, <a class="el" href="class_block_validation_state.html">BlockValidationState</a> &amp;state, <a class="el" href="class_c_block_index.html">CBlockIndex</a> &amp;block) <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(FlatFilePo&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae70b06aaf862d5ee0b31de6bab121136">WriteBlock</a> )(const <a class="el" href="class_c_block.html">CBlock</a> &amp;block, int <a class="el" href="mempool__ephemeral__spends_8cpp.html#a2e4c6b811457a16b7033af6741cfb1db">nHeight</a>)</td></tr>
<tr class="memitem:abd422059799bb41da624c4b8c4878381" id="r_abd422059799bb41da624c4b8c4878381"><td class="memItemLeft" align="right" valign="top">bool <a class="el" href="blockchain_8cpp.html#a4a03e2d3179e401bf9a9cfafa5432723">CheckBlockDataAvailability</a>(const <a class="el" href="class_c_block_index.html">CBlockIndex</a> &amp;upper_block, const <a class="el" href="class_c_block_index.html">CBlockIndex</a> &amp;lower_block) <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(const <a class="el" href="class_c_block_index.html">CBlockIndex</a> &amp;GetFirstBlock(const <a class="el" href="class_c_block_index.html">CBlockIndex</a> &amp;upper_block <a class="el" href="attributes_8h.html#a37bc3dacb49779a0d18439d4383e5fd9">LIFETIMEBOUND</a>, uint32_t status_mask, const <a class="el" href="class_c_block_index.html">CBlockIndex</a> *lower_block <a class="el" href="attributes_8h.html#a37bc3dacb49779a0d18439d4383e5fd9">LIFETIMEBOUND</a>=nullptr) const <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(boo&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abd422059799bb41da624c4b8c4878381">m_have_pruned</a> ) = false</td></tr>
<tr class="memdesc:abd422059799bb41da624c4b8c4878381"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the earliest block with specified <span class="tt">status_mask</span> flags set after the latest block <em>not</em> having those flags.  <br /></td></tr>
<tr class="memitem:af94e2a1297df45c04d2802ab5b5813b2" id="r_af94e2a1297df45c04d2802ab5b5813b2"><td class="memItemLeft" align="right" valign="top">bool IsBlockPruned(const <a class="el" href="class_c_block_index.html">CBlockIndex</a> &amp;block) const <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(void UpdatePruneLock(const std::string &amp;<a class="el" href="rest_8cpp.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, const PruneLockInfo &amp;lock_info) <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(AutoFil&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af94e2a1297df45c04d2802ab5b5813b2">OpenBlockFile</a> )(const <a class="el" href="struct_flat_file_pos.html">FlatFilePos</a> &amp;pos, bool fReadOnly) const</td></tr>
<tr class="memdesc:af94e2a1297df45c04d2802ab5b5813b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether the block associated with this index entry is pruned or not.  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pub-static-attribs" class="groupheader"><a id="pub-static-attribs" name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:ad763c65be9451609b0f3d7ecd7bd4e3c" id="r_ad763c65be9451609b0f3d7ecd7bd4e3c"><td class="memItemLeft" align="right" valign="top">static constexpr auto&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad763c65be9451609b0f3d7ecd7bd4e3c">PRUNE_TARGET_MANUAL</a> {std::numeric_limits&lt;uint64_t&gt;::max()}</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pro-attribs" class="groupheader"><a id="pro-attribs" name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:afb9d51fced31a067a652b9b2f419de53" id="r_afb9d51fced31a067a652b9b2f419de53"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="class_c_block_file_info.html">CBlockFileInfo</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afb9d51fced31a067a652b9b2f419de53">m_blockfile_info</a></td></tr>
<tr class="memitem:a19dc9f19ce6715ed2227bdb3eabfa468" id="r_a19dc9f19ce6715ed2227bdb3eabfa468"><td class="memItemLeft" align="right" valign="top">std::set&lt; <a class="el" href="class_c_block_index.html">CBlockIndex</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a19dc9f19ce6715ed2227bdb3eabfa468">m_dirty_blockindex</a></td></tr>
<tr class="memitem:a741acf23cdde1715d7589530c0bf2758" id="r_a741acf23cdde1715d7589530c0bf2758"><td class="memItemLeft" align="right" valign="top">std::set&lt; int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a741acf23cdde1715d7589530c0bf2758">m_dirty_fileinfo</a></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Maintains a tree of blocks (stored in <span class="tt">m_block_index</span>) which is consulted to determine where the most-work tip is.</p>
<p>This data is used mostly in <span class="tt"><a class="el" href="class_chainstate.html">Chainstate</a></span> - information about, e.g., candidate tips is not maintained here. </p>
</div><a name="doc-typedef-members" id="doc-typedef-members"></a><h2 id="header-doc-typedef-members" class="groupheader">Member Typedef Documentation</h2>
<a id="a9d388cded97cd9f86c06358bb29abfad" name="a9d388cded97cd9f86c06358bb29abfad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d388cded97cd9f86c06358bb29abfad">&#9670;&#160;</a></span>Options</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="#a9d388cded97cd9f86c06358bb29abfad">Options</a><a class="el" href="struct_options.html">Options</a> = <a class="el" href="structkernel_1_1_block_manager_opts.html">kernel::BlockManagerOpts</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae44324a3c3aae8cdb9bdecd43260b98f" name="ae44324a3c3aae8cdb9bdecd43260b98f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae44324a3c3aae8cdb9bdecd43260b98f">&#9670;&#160;</a></span>ReadRawBlockResult</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="#ae44324a3c3aae8cdb9bdecd43260b98f">ReadRawBlockResult</a> = <a class="el" href="classutil_1_1_expected.html">util::Expected</a>&lt;std::vector&lt;std::byte&gt;, ReadRawError&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a name="doc-constructors" id="doc-constructors"></a><h2 id="header-doc-constructors" class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a5a7ab0002709da74f13f76921377c42c" name="a5a7ab0002709da74f13f76921377c42c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a7ab0002709da74f13f76921377c42c">&#9670;&#160;</a></span>BlockManager()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_block_manager.html">BlockManager</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classutil_1_1_signal_interrupt.html">util::SignalInterrupt</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>interrupt</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="#a9d388cded97cd9f86c06358bb29abfad">Options</a><a class="el" href="struct_options.html">Options</a></td>          <td class="paramname"><span class="paramname"><em>opts</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel explicit">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Member Function Documentation</h2>
<a id="a5d513fc954905589bc2a99da7d51e923" name="a5d513fc954905589bc2a99da7d51e923"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d513fc954905589bc2a99da7d51e923">&#9670;&#160;</a></span>CalculateCurrentUsage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t CalculateCurrentUsage </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculate the amount of disk space the block &amp; undo files currently use </p>

</div>
</div>
<a id="aabaa6172d403bb91657add7f42f3b371" name="aabaa6172d403bb91657add7f42f3b371"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabaa6172d403bb91657add7f42f3b371">&#9670;&#160;</a></span>CleanupBlockRevFiles()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CleanupBlockRevFiles </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a524e9acdceb9fae201dbe36bd66c80e7" name="a524e9acdceb9fae201dbe36bd66c80e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a524e9acdceb9fae201dbe36bd66c80e7">&#9670;&#160;</a></span>GetBlockFileInfo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_block_file_info.html">CBlockFileInfo</a> * GetBlockFileInfo </td>
          <td>(</td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>n</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get block file info entry for one block file </p>

</div>
</div>
<a id="a375f39dd7a25d0087c57ee6704eb7953" name="a375f39dd7a25d0087c57ee6704eb7953"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a375f39dd7a25d0087c57ee6704eb7953">&#9670;&#160;</a></span>GetBlockPosFilename()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfs_1_1path.html">fs::path</a> GetBlockPosFilename </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_flat_file_pos.html">FlatFilePos</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>pos</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Translation to a filesystem path </p>

</div>
</div>
<a id="a95455271ec88dfcc93e411237b36a57c" name="a95455271ec88dfcc93e411237b36a57c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95455271ec88dfcc93e411237b36a57c">&#9670;&#160;</a></span>GetPruneTarget()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t GetPruneTarget </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel nodiscard">nodiscard</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Attempt to stay below this number of bytes of block files. </p>

</div>
</div>
<a id="ad06570b26658d12ac3ad08750e3b8f7c" name="ad06570b26658d12ac3ad08750e3b8f7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad06570b26658d12ac3ad08750e3b8f7c">&#9670;&#160;</a></span>GUARDED_BY() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt; <a class="el" href="classnode_1_1_block_tree_d_b.html">BlockTreeDB</a> &gt; m_block_tree_db GUARDED_BY </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cs__main_8cpp.html#ab88a4b9173207cf250ece7820db1f36d">::cs_main</a></td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a3b953f400cc4e659ab9651c3dea79da5" name="a3b953f400cc4e659ab9651c3dea79da5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b953f400cc4e659ab9651c3dea79da5">&#9670;&#160;</a></span>GUARDED_BY() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="validation_8cpp.html#acee0086a0c833617dd1532caf93206a3">BlockMap</a> m_block_index GUARDED_BY </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cs__main_8cpp.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a></td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aa95eeae5f69857893eacc49700873255" name="aa95eeae5f69857893eacc49700873255"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa95eeae5f69857893eacc49700873255">&#9670;&#160;</a></span>InsertBlockIndex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_block_index.html">CBlockIndex</a> * InsertBlockIndex </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classuint256.html">uint256</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>hash</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a new block index entry for a given block hash </p>

</div>
</div>
<a id="ad03fd92fad95bb7f82ef78cc467cb12b" name="ad03fd92fad95bb7f82ef78cc467cb12b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad03fd92fad95bb7f82ef78cc467cb12b">&#9670;&#160;</a></span>IsPruneMode()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool IsPruneMode </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel nodiscard">nodiscard</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Whether running in -prune mode. </p>

</div>
</div>
<a id="acef48b2a0b8aa252efa69928192b4d5a" name="acef48b2a0b8aa252efa69928192b4d5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acef48b2a0b8aa252efa69928192b4d5a">&#9670;&#160;</a></span>LoadingBlocks()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool LoadingBlocks </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel nodiscard">nodiscard</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="afc9665be19b586880b275f0ccf17c8bb" name="afc9665be19b586880b275f0ccf17c8bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc9665be19b586880b275f0ccf17c8bb">&#9670;&#160;</a></span>LookupBlockIndex() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="class_c_block_index.html">CBlockIndex</a> * LookupBlockIndex </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classuint256.html">uint256</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>hash</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a87eab19fb1a7e025715c13377ebfd356" name="a87eab19fb1a7e025715c13377ebfd356"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87eab19fb1a7e025715c13377ebfd356">&#9670;&#160;</a></span>LookupBlockIndex() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_block_index.html">CBlockIndex</a> * LookupBlockIndex </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classuint256.html">uint256</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>hash</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a6ebc263091ba81ceaa3ec37d1000bf9b" name="a6ebc263091ba81ceaa3ec37d1000bf9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ebc263091ba81ceaa3ec37d1000bf9b">&#9670;&#160;</a></span>PruneOneBlockFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PruneOneBlockFile </td>
          <td>(</td>
          <td class="paramtype">const int</td>          <td class="paramname"><span class="paramname"><em>fileNumber</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mark one block file as pruned (modify associated database entries). </p>

</div>
</div>
<a id="a5637a4074380a9138c49742f8d0f39b8" name="a5637a4074380a9138c49742f8d0f39b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5637a4074380a9138c49742f8d0f39b8">&#9670;&#160;</a></span>ReadBlock() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ReadBlock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_c_block.html">CBlock</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>block</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_c_block_index.html">CBlockIndex</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>index</em></span>&#160;) const</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad59bbdccdaca9da495b6b6e80c481a1a" name="ad59bbdccdaca9da495b6b6e80c481a1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad59bbdccdaca9da495b6b6e80c481a1a">&#9670;&#160;</a></span>ReadBlock() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ReadBlock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_c_block.html">CBlock</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>block</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_flat_file_pos.html">FlatFilePos</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>pos</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::optional&lt; <a class="el" href="classuint256.html">uint256</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>expected_hash</em></span>&#160;) const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Functions for disk access for blocks </p>

</div>
</div>
<a id="a054cbf50f4e5cb582fd744927f9ace7a" name="a054cbf50f4e5cb582fd744927f9ace7a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a054cbf50f4e5cb582fd744927f9ace7a">&#9670;&#160;</a></span>ReadBlockUndo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ReadBlockUndo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_c_block_undo.html">CBlockUndo</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>blockundo</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_c_block_index.html">CBlockIndex</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>index</em></span>&#160;) const</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a0bfb8d6c21eed2929e6a388578ceae4d" name="a0bfb8d6c21eed2929e6a388578ceae4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0bfb8d6c21eed2929e6a388578ceae4d">&#9670;&#160;</a></span>ReadRawBlock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="#ae44324a3c3aae8cdb9bdecd43260b98f">BlockManager::ReadRawBlockResult</a> ReadRawBlock </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_flat_file_pos.html">FlatFilePos</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>pos</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::optional&lt; std::pair&lt; size_t, size_t &gt; &gt;</td>          <td class="paramname"><span class="paramname"><em>block_part</em></span><span class="paramdefsep"> = </span><span class="paramdefval">std::nullopt</span>&#160;) const</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a0592de206bb3aa3070fb685e6c0b8923" name="a0592de206bb3aa3070fb685e6c0b8923"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0592de206bb3aa3070fb685e6c0b8923">&#9670;&#160;</a></span>UnlinkPrunedFiles()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UnlinkPrunedFiles </td>
          <td>(</td>
          <td class="paramtype">const std::set&lt; int &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>setFilesToPrune</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Actually unlink the specified files </p>

</div>
</div>
<a id="ac998253c8454e8f69d78c62fba7a5253" name="ac998253c8454e8f69d78c62fba7a5253"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac998253c8454e8f69d78c62fba7a5253">&#9670;&#160;</a></span>UpdateBlockInfo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UpdateBlockInfo </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_block.html">CBlock</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>block</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>nHeight</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_flat_file_pos.html">FlatFilePos</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>pos</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Update blockfile info while processing a block during reindex. The block must be available on disk.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">block</td><td>the block being processed </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nHeight</td><td>the height of the block </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pos</td><td>the position of the serialized <a class="el" href="class_c_block.html">CBlock</a> on disk </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a name="doc-variable-members" id="doc-variable-members"></a><h2 id="header-doc-variable-members" class="groupheader">Field Documentation</h2>
<a id="aa23f0a6c8540ce84e6526e2a7fe6aeec" name="aa23f0a6c8540ce84e6526e2a7fe6aeec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa23f0a6c8540ce84e6526e2a7fe6aeec">&#9670;&#160;</a></span>AddToBlockIndex</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_block_index.html">CBlockIndex</a> * AddToBlockIndex</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove any pruned block &amp; undo files that are still on disk. This could happen on some systems if the file was still being read while unlinked, or if we crash before unlinking. </p>

</div>
</div>
<a id="afb9d51fced31a067a652b9b2f419de53" name="afb9d51fced31a067a652b9b2f419de53"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb9d51fced31a067a652b9b2f419de53">&#9670;&#160;</a></span>m_blockfile_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="class_c_block_file_info.html">CBlockFileInfo</a>&gt; m_blockfile_info</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a5627151c890af8526b512ff75f09eba1" name="a5627151c890af8526b512ff75f09eba1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5627151c890af8526b512ff75f09eba1">&#9670;&#160;</a></span>m_blockfiles_indexed</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic_bool m_blockfiles_indexed {true}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Whether all blockfiles have been added to the block tree database. Normally true, but set to false when a reindex is requested and the database is wiped. The value is persisted in the database across restarts and will be false until reindexing completes. </p>

</div>
</div>
<a id="a1a2028bdb52a8d052b7ccc0fae0888be" name="a1a2028bdb52a8d052b7ccc0fae0888be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a2028bdb52a8d052b7ccc0fae0888be">&#9670;&#160;</a></span>m_blocks_unlinked</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="class_c_block_index.html">CBlockIndex</a>*&gt; GetAllBlockIndices () <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>( std::multimap&lt;<a class="el" href="class_c_block_index.html">CBlockIndex</a>*, <a class="el" href="class_c_block_index.html">CBlockIndex</a>*&gt; m_blocks_unlinked</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>All pairs A-&gt;B, where A (or one of its ancestors) misses transactions, but B has transactions. Pruned nodes may have entries where B is missing data. </p>

</div>
</div>
<a id="a19dc9f19ce6715ed2227bdb3eabfa468" name="a19dc9f19ce6715ed2227bdb3eabfa468"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a19dc9f19ce6715ed2227bdb3eabfa468">&#9670;&#160;</a></span>m_dirty_blockindex</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::set&lt;<a class="el" href="class_c_block_index.html">CBlockIndex</a>*&gt; m_dirty_blockindex</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Dirty block index entries. </p>

</div>
</div>
<a id="a741acf23cdde1715d7589530c0bf2758" name="a741acf23cdde1715d7589530c0bf2758"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a741acf23cdde1715d7589530c0bf2758">&#9670;&#160;</a></span>m_dirty_fileinfo</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::set&lt;int&gt; m_dirty_fileinfo</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Dirty block file entries. </p>

</div>
</div>
<a id="abd422059799bb41da624c4b8c4878381" name="abd422059799bb41da624c4b8c4878381"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd422059799bb41da624c4b8c4878381">&#9670;&#160;</a></span>m_have_pruned</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="blockchain_8cpp.html#a4a03e2d3179e401bf9a9cfafa5432723">CheckBlockDataAvailability</a> (const <a class="el" href="class_c_block_index.html">CBlockIndex</a>&amp; upper_block, const <a class="el" href="class_c_block_index.html">CBlockIndex</a>&amp; lower_block) <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>( const <a class="el" href="class_c_block_index.html">CBlockIndex</a>&amp; GetFirstBlock ( const <a class="el" href="class_c_block_index.html">CBlockIndex</a>&amp; upper_block <a class="el" href="attributes_8h.html#a37bc3dacb49779a0d18439d4383e5fd9">LIFETIMEBOUND</a>, uint32_t status_mask, const <a class="el" href="class_c_block_index.html">CBlockIndex</a>* lower_block <a class="el" href="attributes_8h.html#a37bc3dacb49779a0d18439d4383e5fd9">LIFETIMEBOUND</a> = nullptr ) const <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>( boo m_have_pruned)  = false</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the earliest block with specified <span class="tt">status_mask</span> flags set after the latest block <em>not</em> having those flags. </p>
<p>Check if all blocks in the [upper_block, lower_block] range have data available. The caller is responsible for ensuring that lower_block is an ancestor of upper_block (part of the same chain). </p>
<p>This function starts from <span class="tt">upper_block</span>, which must have all <span class="tt">status_mask</span> flags set, and iterates backwards through its ancestors. It continues as long as each block has all <span class="tt">status_mask</span> flags set, until reaching the oldest ancestor or <span class="tt">lower_block</span>.</p>
<dl class="section pre"><dt>Precondition</dt><dd><span class="tt">upper_block</span> must have all <span class="tt">status_mask</span> flags set. </dd>
<dd>
<span class="tt">lower_block</span> must be null or an ancestor of <span class="tt">upper_block</span></dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">upper_block</td><td>The starting block for the search, which must have all <span class="tt">status_mask</span> flags set. </td></tr>
    <tr><td class="paramname">status_mask</td><td>Bitmask specifying required status flags. </td></tr>
    <tr><td class="paramname">lower_block</td><td>The earliest possible block to return. If null, the search can extend to the genesis block.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A reference to the earliest block between <span class="tt">upper_block</span> and <span class="tt">lower_block</span>, inclusive, such that every block between the returned block and <span class="tt">upper_block</span> has <span class="tt">status_mask</span> flags set. True if any block files have ever been pruned. </dd></dl>

</div>
</div>
<a id="a394b5b401d4fcd3c693dea7d6314ec7d" name="a394b5b401d4fcd3c693dea7d6314ec7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a394b5b401d4fcd3c693dea7d6314ec7d">&#9670;&#160;</a></span>m_importing</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;bool&gt; m_importing {false}</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a2163d8ef789c585b196a3ec7f468244b" name="a2163d8ef789c585b196a3ec7f468244b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2163d8ef789c585b196a3ec7f468244b">&#9670;&#160;</a></span>m_interrupt</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classutil_1_1_signal_interrupt.html">util::SignalInterrupt</a>&amp; m_interrupt</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a4768bb381991af0538ef921446f5ae92" name="a4768bb381991af0538ef921446f5ae92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4768bb381991af0538ef921446f5ae92">&#9670;&#160;</a></span>m_snapshot_height</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::optional&lt;int&gt; m_snapshot_height</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The height of the base block of an assumeutxo snapshot, if one is in use.</p>
<p>This controls how blockfiles are segmented by chainstate type to avoid comingling different height regions of the chain when an assumedvalid chainstate is in use. If heights are drastically different in the same blockfile, pruning suffers.</p>
<p>This is set during ActivateSnapshot() or upon LoadBlockIndex() if a snapshot had been previously loaded. After the snapshot is validated, this is unset to restore normal LoadBlockIndex behavior. </p>

</div>
</div>
<a id="af94e2a1297df45c04d2802ab5b5813b2" name="af94e2a1297df45c04d2802ab5b5813b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af94e2a1297df45c04d2802ab5b5813b2">&#9670;&#160;</a></span>OpenBlockFile</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_auto_file.html">AutoFile</a> OpenBlockFile</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check whether the block associated with this index entry is pruned or not. </p>
<p>Create or update a prune lock identified by its name Open a block file (blk?????.dat) </p>

</div>
</div>
<a id="ad763c65be9451609b0f3d7ecd7bd4e3c" name="ad763c65be9451609b0f3d7ecd7bd4e3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad763c65be9451609b0f3d7ecd7bd4e3c">&#9670;&#160;</a></span>PRUNE_TARGET_MANUAL</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">auto PRUNE_TARGET_MANUAL {std::numeric_limits&lt;uint64_t&gt;::max()}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span><span class="mlabel constexpr">constexpr</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ae70b06aaf862d5ee0b31de6bab121136" name="ae70b06aaf862d5ee0b31de6bab121136"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae70b06aaf862d5ee0b31de6bab121136">&#9670;&#160;</a></span>WriteBlock</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_flat_file_pos.html">FlatFilePos</a> WriteBlock</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Store block on disk and update block file statistics.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">block</td><td>the block to be stored </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nHeight</td><td>the height of the block</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>in case of success, the position to which the block was written to in case of an error, an empty <a class="el" href="struct_flat_file_pos.html">FlatFilePos</a> </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/node/<a class="el" href="blockstorage_8h_source.html">blockstorage.h</a></li>
<li>src/node/<a class="el" href="blockstorage_8cpp.html">blockstorage.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="class_block_manager.html">BlockManager</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
