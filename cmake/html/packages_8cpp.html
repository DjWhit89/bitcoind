<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>bitcoind: src/policy/packages.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="bitcoin.ico"/></td>
  <td id="projectalign">
   <div id="projectname">bitcoind<span id="projectnumber">&#160;2.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('packages_8cpp.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">packages.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="packages_8h_source.html">policy/packages.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="policy_8h_source.html">policy/policy.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="primitives_2transaction_8h_source.html">primitives/transaction.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="uint256_8h_source.html">uint256.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="check_8h_source.html">util/check.h</a>&gt;</code><br />
<code>#include &lt;algorithm&gt;</code><br />
<code>#include &lt;cassert&gt;</code><br />
<code>#include &lt;iterator&gt;</code><br />
<code>#include &lt;memory&gt;</code><br />
<code>#include &lt;numeric&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a86cebe668567fe50dd364301eb97820a" id="r_a86cebe668567fe50dd364301eb97820a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a86cebe668567fe50dd364301eb97820a">IsTopoSortedPackage</a> (const <a class="el" href="packages_8h.html#a138b5dbe56c4869308e2bc7a28b51d9c">Package</a> &amp;txns, std::unordered_set&lt; <a class="el" href="transaction__identifier_8h.html#ac4bb3c35b94889843d632be4de4b223c">Txid</a>, <a class="el" href="class_salted_txid_hasher.html">SaltedTxidHasher</a> &gt; &amp;later_txids)</td></tr>
<tr class="memitem:aed5aca63156deba997ae12650f2bf823" id="r_aed5aca63156deba997ae12650f2bf823"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aed5aca63156deba997ae12650f2bf823">IsTopoSortedPackage</a> (const <a class="el" href="packages_8h.html#a138b5dbe56c4869308e2bc7a28b51d9c">Package</a> &amp;txns)</td></tr>
<tr class="memitem:a1dbc884090d3c8075d770bba50b02995" id="r_a1dbc884090d3c8075d770bba50b02995"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1dbc884090d3c8075d770bba50b02995">IsConsistentPackage</a> (const <a class="el" href="packages_8h.html#a138b5dbe56c4869308e2bc7a28b51d9c">Package</a> &amp;txns)</td></tr>
<tr class="memitem:a50f9cda6e16fa7ee7dff89e989948635" id="r_a50f9cda6e16fa7ee7dff89e989948635"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a50f9cda6e16fa7ee7dff89e989948635">IsWellFormedPackage</a> (const <a class="el" href="packages_8h.html#a138b5dbe56c4869308e2bc7a28b51d9c">Package</a> &amp;txns, <a class="el" href="class_package_validation_state.html">PackageValidationState</a> &amp;state, bool require_sorted)</td></tr>
<tr class="memitem:a0959b9a8f47d5ab16f0df8b80b0b488a" id="r_a0959b9a8f47d5ab16f0df8b80b0b488a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0959b9a8f47d5ab16f0df8b80b0b488a">IsChildWithParents</a> (const <a class="el" href="packages_8h.html#a138b5dbe56c4869308e2bc7a28b51d9c">Package</a> &amp;package)</td></tr>
<tr class="memitem:a7896d27359550efe70ad3a558cb6c6a3" id="r_a7896d27359550efe70ad3a558cb6c6a3"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7896d27359550efe70ad3a558cb6c6a3">IsChildWithParentsTree</a> (const <a class="el" href="packages_8h.html#a138b5dbe56c4869308e2bc7a28b51d9c">Package</a> &amp;package)</td></tr>
<tr class="memitem:ab2640b3a916f8801f16731e8d1f0798f" id="r_ab2640b3a916f8801f16731e8d1f0798f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classuint256.html">uint256</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab2640b3a916f8801f16731e8d1f0798f">GetPackageHash</a> (const std::vector&lt; <a class="el" href="primitives_2transaction_8h.html#ae462b4b8f07705a82bf11cf361959b97">CTransactionRef</a> &gt; &amp;transactions)</td></tr>
</table>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="ab2640b3a916f8801f16731e8d1f0798f" name="ab2640b3a916f8801f16731e8d1f0798f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2640b3a916f8801f16731e8d1f0798f">&#9670;&#160;</a></span>GetPackageHash()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classuint256.html">uint256</a> GetPackageHash </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="primitives_2transaction_8h.html#ae462b4b8f07705a82bf11cf361959b97">CTransactionRef</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>transactions</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the hash of the concatenated wtxids of transactions, with wtxids treated as a little-endian numbers and sorted in ascending numeric order. </p>

</div>
</div>
<a id="a0959b9a8f47d5ab16f0df8b80b0b488a" name="a0959b9a8f47d5ab16f0df8b80b0b488a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0959b9a8f47d5ab16f0df8b80b0b488a">&#9670;&#160;</a></span>IsChildWithParents()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool IsChildWithParents </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="packages_8h.html#a138b5dbe56c4869308e2bc7a28b51d9c">Package</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>package</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Context-free check that a package is exactly one child and its parents; not all parents need to be present, but the package must not contain any transactions that are not the child's parents. It is expected to be sorted, which means the last transaction must be the child. </p>

</div>
</div>
<a id="a7896d27359550efe70ad3a558cb6c6a3" name="a7896d27359550efe70ad3a558cb6c6a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7896d27359550efe70ad3a558cb6c6a3">&#9670;&#160;</a></span>IsChildWithParentsTree()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool IsChildWithParentsTree </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="packages_8h.html#a138b5dbe56c4869308e2bc7a28b51d9c">Package</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>package</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Context-free check that a package <a class="el" href="packages_8h.html#a0959b9a8f47d5ab16f0df8b80b0b488a">IsChildWithParents()</a> and none of the parents depend on each other (the package is a "tree"). </p>

</div>
</div>
<a id="a1dbc884090d3c8075d770bba50b02995" name="a1dbc884090d3c8075d770bba50b02995"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1dbc884090d3c8075d770bba50b02995">&#9670;&#160;</a></span>IsConsistentPackage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool IsConsistentPackage </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="packages_8h.html#a138b5dbe56c4869308e2bc7a28b51d9c">Package</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>txns</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Checks that these transactions don't conflict, i.e., spend the same prevout. This includes checking that there are no duplicate transactions. Since these checks require looking at the inputs of a transaction, returns false immediately if any transactions have empty vin.</p>
<p>Does not check consistency of a transaction with oneself; does not check if a transaction spends the same prevout multiple times (see bad-txns-inputs-duplicate in <a class="el" href="tx__check_8cpp.html#ac015dec2b8cac7f01b1f53b78a80d854">CheckTransaction()</a>).</p>
<dl class="section return"><dt>Returns</dt><dd>true if there are no conflicts. False if any two transactions spend the same prevout. </dd></dl>

</div>
</div>
<a id="aed5aca63156deba997ae12650f2bf823" name="aed5aca63156deba997ae12650f2bf823"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed5aca63156deba997ae12650f2bf823">&#9670;&#160;</a></span>IsTopoSortedPackage() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool IsTopoSortedPackage </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="packages_8h.html#a138b5dbe56c4869308e2bc7a28b51d9c">Package</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>txns</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If any direct dependencies exist between transactions (i.e. a child spending the output of a parent), checks that all parents appear somewhere in the list before their respective children. No other ordering is enforced. This function cannot detect indirect dependencies (e.g. a transaction's grandparent if its parent is not present). </p><dl class="section return"><dt>Returns</dt><dd>true if sorted. False if any tx spends the output of a tx that appears later in txns. </dd></dl>

</div>
</div>
<a id="a86cebe668567fe50dd364301eb97820a" name="a86cebe668567fe50dd364301eb97820a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86cebe668567fe50dd364301eb97820a">&#9670;&#160;</a></span>IsTopoSortedPackage() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool IsTopoSortedPackage </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="packages_8h.html#a138b5dbe56c4869308e2bc7a28b51d9c">Package</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>txns</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unordered_set&lt; <a class="el" href="transaction__identifier_8h.html#ac4bb3c35b94889843d632be4de4b223c">Txid</a>, <a class="el" href="class_salted_txid_hasher.html">SaltedTxidHasher</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>later_txids</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>IsTopoSortedPackage where a set of txids has been pre-populated. The set is assumed to be correct and is mutated within this function (even if return value is false). </p>

</div>
</div>
<a id="a50f9cda6e16fa7ee7dff89e989948635" name="a50f9cda6e16fa7ee7dff89e989948635"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50f9cda6e16fa7ee7dff89e989948635">&#9670;&#160;</a></span>IsWellFormedPackage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool IsWellFormedPackage </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="packages_8h.html#a138b5dbe56c4869308e2bc7a28b51d9c">Package</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>txns</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_package_validation_state.html">PackageValidationState</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>state</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>require_sorted</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Context-free package policy checks:</p><ol type="1">
<li>The number of transactions cannot exceed MAX_PACKAGE_COUNT.</li>
<li>The total weight cannot exceed MAX_PACKAGE_WEIGHT.</li>
<li>If any dependencies exist between transactions, parents must appear before children.</li>
<li>Transactions cannot conflict, i.e., spend the same inputs. </li>
</ol>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a href="dir_f9a362818448b8ef6661813ae65d7e79.html">policy</a></li><li class="navelem"><a href="packages_8cpp.html">packages.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
