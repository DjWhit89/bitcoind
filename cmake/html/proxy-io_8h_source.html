<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>bitcoind: src/ipc/libmultiprocess/include/mp/proxy-io.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="bitcoin.ico"/></td>
  <td id="projectalign">
   <div id="projectname">bitcoind<span id="projectnumber">&#160;2.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('proxy-io_8h_source.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">proxy-io.h</div></div>
</div><!--header-->
<div class="contents">
<a href="proxy-io_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">// Copyright (c) The Bitcoin Core developers</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">// Distributed under the MIT software license, see the accompanying</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">// file COPYING or http://www.opensource.org/licenses/mit-license.php.</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span> </div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="preprocessor">#ifndef MP_PROXY_IO_H</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="preprocessor">#define MP_PROXY_IO_H</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span> </div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="preprocessor">#include &lt;<a class="code" href="proxy_8h.html">mp/proxy.h</a>&gt;</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="preprocessor">#include &lt;<a class="code" href="ipc_2libmultiprocess_2include_2mp_2util_8h.html">mp/util.h</a>&gt;</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span> </div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#include &lt;mp/proxy.capnp.h&gt;</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span> </div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &lt;capnp/rpc-twoparty.h&gt;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span> </div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#include &lt;condition_variable&gt;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &lt;functional&gt;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &lt;kj/function.h&gt;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &lt;optional&gt;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &lt;thread&gt;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span> </div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacemp.html">mp</a> {</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="keyword">struct </span><a class="code hl_struct" href="structmp_1_1_thread_context.html">ThreadContext</a>;</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span> </div>
<div class="foldopen" id="foldopen00029" data-start="{" data-end="};">
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno"><a class="line" href="structmp_1_1_invoke_context.html">   29</a></span><span class="keyword">struct </span><a class="code hl_struct" href="structmp_1_1_invoke_context.html">InvokeContext</a></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>{</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno"><a class="line" href="structmp_1_1_invoke_context.html#a14da0714d7378f41cc7d7362c1483abf">   31</a></span>    <a class="code hl_class" href="classmp_1_1_connection.html">Connection</a>&amp; <a class="code hl_variable" href="structmp_1_1_invoke_context.html#a14da0714d7378f41cc7d7362c1483abf">connection</a>;</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>};</div>
</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="foldopen" id="foldopen00034" data-start="{" data-end="};">
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno"><a class="line" href="structmp_1_1_client_invoke_context.html">   34</a></span><span class="keyword">struct </span><a class="code hl_function" href="structmp_1_1_client_invoke_context.html#a75915d4998c2eae263013e31eba8c7c1">ClientInvokeContext</a> : <a class="code hl_struct" href="structmp_1_1_invoke_context.html">InvokeContext</a></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>{</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno"><a class="line" href="structmp_1_1_client_invoke_context.html#a859a2ba37c0eb07ea294f9e35b8fbdf8">   36</a></span>    <a class="code hl_struct" href="structmp_1_1_thread_context.html">ThreadContext</a>&amp; <a class="code hl_variable" href="structmp_1_1_client_invoke_context.html#a859a2ba37c0eb07ea294f9e35b8fbdf8">thread_context</a>;</div>
<div class="foldopen" id="foldopen00037" data-start="{" data-end="}">
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno"><a class="line" href="structmp_1_1_client_invoke_context.html#a75915d4998c2eae263013e31eba8c7c1">   37</a></span>    <a class="code hl_function" href="structmp_1_1_client_invoke_context.html#a75915d4998c2eae263013e31eba8c7c1">ClientInvokeContext</a>(<a class="code hl_class" href="classmp_1_1_connection.html">Connection</a>&amp; conn, <a class="code hl_struct" href="structmp_1_1_thread_context.html">ThreadContext</a>&amp; <a class="code hl_variable" href="structmp_1_1_client_invoke_context.html#a859a2ba37c0eb07ea294f9e35b8fbdf8">thread_context</a>)</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>        : <a class="code hl_struct" href="structmp_1_1_invoke_context.html">InvokeContext</a>{conn}, <a class="code hl_variable" href="structmp_1_1_client_invoke_context.html#a859a2ba37c0eb07ea294f9e35b8fbdf8">thread_context</a>{<a class="code hl_variable" href="structmp_1_1_client_invoke_context.html#a859a2ba37c0eb07ea294f9e35b8fbdf8">thread_context</a>}</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>    {</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>    }</div>
</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>};</div>
</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span> </div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ProxyServer, <span class="keyword">typename</span> CallContext_&gt;</div>
<div class="foldopen" id="foldopen00044" data-start="{" data-end="};">
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno"><a class="line" href="structmp_1_1_server_invoke_context.html">   44</a></span><span class="keyword">struct </span><a class="code hl_function" href="structmp_1_1_server_invoke_context.html#a615c39ca4b0d7940b12f1f03f109d7fa">ServerInvokeContext</a> : <a class="code hl_struct" href="structmp_1_1_invoke_context.html">InvokeContext</a></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>{</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno"><a class="line" href="structmp_1_1_server_invoke_context.html#a6c748e91888f4356116cf06de81060ca">   46</a></span>    <span class="keyword">using </span><a class="code hl_typedef" href="structmp_1_1_server_invoke_context.html#a6c748e91888f4356116cf06de81060ca">CallContext</a> = CallContext_;</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span> </div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno"><a class="line" href="structmp_1_1_server_invoke_context.html#ab3fbc657d40dee5ffd1274f20f960ee8">   48</a></span>    <a class="code hl_struct" href="structmp_1_1_proxy_server.html">ProxyServer</a>&amp; <a class="code hl_variable" href="structmp_1_1_server_invoke_context.html#ab3fbc657d40dee5ffd1274f20f960ee8">proxy_server</a>;</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno"><a class="line" href="structmp_1_1_server_invoke_context.html#a99f472ad7b6e95b8b8c9fff036c2d960">   49</a></span>    <a class="code hl_typedef" href="structmp_1_1_server_invoke_context.html#a6c748e91888f4356116cf06de81060ca">CallContext</a>&amp; <a class="code hl_variable" href="structmp_1_1_server_invoke_context.html#a99f472ad7b6e95b8b8c9fff036c2d960">call_context</a>;</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno"><a class="line" href="structmp_1_1_server_invoke_context.html#ad4029b357b3b2f147819178b603032f0">   50</a></span>    <span class="keywordtype">int</span> <a class="code hl_variable" href="structmp_1_1_server_invoke_context.html#ad4029b357b3b2f147819178b603032f0">req</a>;</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span> </div>
<div class="foldopen" id="foldopen00052" data-start="{" data-end="}">
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno"><a class="line" href="structmp_1_1_server_invoke_context.html#a615c39ca4b0d7940b12f1f03f109d7fa">   52</a></span>    <a class="code hl_function" href="structmp_1_1_server_invoke_context.html#a615c39ca4b0d7940b12f1f03f109d7fa">ServerInvokeContext</a>(<a class="code hl_struct" href="structmp_1_1_proxy_server.html">ProxyServer</a>&amp; <a class="code hl_variable" href="structmp_1_1_server_invoke_context.html#ab3fbc657d40dee5ffd1274f20f960ee8">proxy_server</a>, <a class="code hl_typedef" href="structmp_1_1_server_invoke_context.html#a6c748e91888f4356116cf06de81060ca">CallContext</a>&amp; <a class="code hl_variable" href="structmp_1_1_server_invoke_context.html#a99f472ad7b6e95b8b8c9fff036c2d960">call_context</a>, <span class="keywordtype">int</span> <a class="code hl_variable" href="structmp_1_1_server_invoke_context.html#ad4029b357b3b2f147819178b603032f0">req</a>)</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>        : <a class="code hl_struct" href="structmp_1_1_invoke_context.html">InvokeContext</a>{*<a class="code hl_variable" href="structmp_1_1_server_invoke_context.html#ab3fbc657d40dee5ffd1274f20f960ee8">proxy_server</a>.m_context.<a class="code hl_variable" href="structmp_1_1_invoke_context.html#a14da0714d7378f41cc7d7362c1483abf">connection</a>}, <a class="code hl_variable" href="structmp_1_1_server_invoke_context.html#ab3fbc657d40dee5ffd1274f20f960ee8">proxy_server</a>{<a class="code hl_variable" href="structmp_1_1_server_invoke_context.html#ab3fbc657d40dee5ffd1274f20f960ee8">proxy_server</a>}, <a class="code hl_variable" href="structmp_1_1_server_invoke_context.html#a99f472ad7b6e95b8b8c9fff036c2d960">call_context</a>{<a class="code hl_variable" href="structmp_1_1_server_invoke_context.html#a99f472ad7b6e95b8b8c9fff036c2d960">call_context</a>}, <a class="code hl_variable" href="structmp_1_1_server_invoke_context.html#ad4029b357b3b2f147819178b603032f0">req</a>{<a class="code hl_variable" href="structmp_1_1_server_invoke_context.html#ad4029b357b3b2f147819178b603032f0">req</a>}</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>    {</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>    }</div>
</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>};</div>
</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span> </div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Interface, <span class="keyword">typename</span> Params, <span class="keyword">typename</span> Results&gt;</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno"><a class="line" href="namespacemp.html#a9642495258151af079da6df81b8dbb0c">   59</a></span><span class="keyword">using </span><a class="code hl_typedef" href="namespacemp.html#a9642495258151af079da6df81b8dbb0c">ServerContext</a> = <a class="code hl_struct" href="structmp_1_1_server_invoke_context.html">ServerInvokeContext&lt;ProxyServer&lt;Interface&gt;</a>, ::capnp::CallContext&lt;Params, Results&gt;&gt;;</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span> </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="keyword">template</span> &lt;&gt;</div>
<div class="foldopen" id="foldopen00062" data-start="{" data-end="};">
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno"><a class="line" href="structmp_1_1_proxy_client_3_01_thread_01_4.html">   62</a></span><span class="keyword">struct </span><a class="code hl_function" href="structmp_1_1_proxy_client_3_01_thread_01_4.html#acdc11ed333f47511007a0554f529e05b">ProxyClient</a>&lt;Thread&gt; : <span class="keyword">public</span> <a class="code hl_function" href="structmp_1_1_proxy_client_3_01_thread_01_4.html#a32f6c2ed2bf7fd1668e2d5c3e5256682">ProxyClientBase</a>&lt;Thread, ::capnp::Void&gt;</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>{</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    <span class="keyword">using </span><a class="code hl_function" href="classmp_1_1_proxy_client_base.html#a32f6c2ed2bf7fd1668e2d5c3e5256682">ProxyClientBase::ProxyClientBase</a>;</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    <span class="comment">// https://stackoverflow.com/questions/22357887/comparing-two-mapiterators-why-does-it-need-the-copy-constructor-of-stdpair</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno"><a class="line" href="structmp_1_1_proxy_client_3_01_thread_01_4.html#acdc11ed333f47511007a0554f529e05b">   66</a></span>    <a class="code hl_function" href="structmp_1_1_proxy_client_3_01_thread_01_4.html#acdc11ed333f47511007a0554f529e05b">ProxyClient</a>(<span class="keyword">const</span> <a class="code hl_function" href="structmp_1_1_proxy_client_3_01_thread_01_4.html#acdc11ed333f47511007a0554f529e05b">ProxyClient</a>&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>    <a class="code hl_function" href="structmp_1_1_proxy_client_3_01_thread_01_4.html#acdc11ed333f47511007a0554f529e05b">~ProxyClient</a>();</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno"><a class="line" href="structmp_1_1_proxy_client_3_01_thread_01_4.html#a36bc04dbcc8122bc405076c2bd588f7a">   78</a></span>    std::optional&lt;CleanupIt&gt; <a class="code hl_variable" href="structmp_1_1_proxy_client_3_01_thread_01_4.html#a36bc04dbcc8122bc405076c2bd588f7a">m_disconnect_cb</a>;</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>};</div>
</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span> </div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span><span class="keyword">template</span> &lt;&gt;</div>
<div class="foldopen" id="foldopen00082" data-start="{" data-end="};">
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno"><a class="line" href="structmp_1_1_proxy_server_3_01_thread_01_4.html">   82</a></span><span class="keyword">struct </span><a class="code hl_function" href="structmp_1_1_proxy_server_3_01_thread_01_4.html#ac248112a85eac554493dc906add43261">ProxyServer</a>&lt;Thread&gt; final : <span class="keyword">public</span> Thread::Server</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>{</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    <a class="code hl_function" href="structmp_1_1_proxy_server_3_01_thread_01_4.html#ac248112a85eac554493dc906add43261">ProxyServer</a>(<a class="code hl_struct" href="structmp_1_1_thread_context.html">ThreadContext</a>&amp; thread_context, std::thread&amp;&amp; thread);</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    <a class="code hl_function" href="structmp_1_1_proxy_server_3_01_thread_01_4.html#ac248112a85eac554493dc906add43261">~ProxyServer</a>();</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    kj::Promise&lt;void&gt; <a class="code hl_function" href="structmp_1_1_proxy_server_3_01_thread_01_4.html#ae4c852ae199f36c9c5b3440f69100c58">getName</a>(GetNameContext context) <span class="keyword">override</span>;</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno"><a class="line" href="structmp_1_1_proxy_server_3_01_thread_01_4.html#ad7f1145feb7b33d914e99b547dc57797">   88</a></span>    <a class="code hl_struct" href="structmp_1_1_thread_context.html">ThreadContext</a>&amp; <a class="code hl_variable" href="structmp_1_1_proxy_server_3_01_thread_01_4.html#ad7f1145feb7b33d914e99b547dc57797">m_thread_context</a>;</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno"><a class="line" href="structmp_1_1_proxy_server_3_01_thread_01_4.html#a1aebf5d44c846e8599ede17753265657">   89</a></span>    std::thread <a class="code hl_variable" href="structmp_1_1_proxy_server_3_01_thread_01_4.html#a1aebf5d44c846e8599ede17753265657">m_thread</a>;</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>};</div>
</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span></div>
<div class="foldopen" id="foldopen00093" data-start="{" data-end="};">
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno"><a class="line" href="classmp_1_1_logging_error_handler.html">   93</a></span><span class="keyword">class </span><a class="code hl_function" href="classmp_1_1_logging_error_handler.html#a7edb956d52fd0b9350e88355ace252a2">LoggingErrorHandler</a> : <span class="keyword">public</span> kj::TaskSet::ErrorHandler</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>{</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno"><a class="line" href="classmp_1_1_logging_error_handler.html#a7edb956d52fd0b9350e88355ace252a2">   96</a></span>    <a class="code hl_function" href="classmp_1_1_logging_error_handler.html#a7edb956d52fd0b9350e88355ace252a2">LoggingErrorHandler</a>(<a class="code hl_class" href="classmp_1_1_event_loop.html">EventLoop</a>&amp; loop) : <a class="code hl_variable" href="classmp_1_1_logging_error_handler.html#ab44a0e9ab8c63995c52b47ad4041aaf5">m_loop</a>(loop) {}</div>
<div class="foldopen" id="foldopen00097" data-start="{" data-end="}">
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno"><a class="line" href="structmp_1_1_proxy_client_3_01_thread_01_4.html#a32f6c2ed2bf7fd1668e2d5c3e5256682">   97</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="classmp_1_1_logging_error_handler.html#a20511778fdeab09ac2e62cb4d094a735">taskFailed</a>(kj::Exception&amp;&amp; exception) <span class="keyword">override</span>;</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno"><a class="line" href="classmp_1_1_logging_error_handler.html#ab44a0e9ab8c63995c52b47ad4041aaf5">   98</a></span>    <a class="code hl_class" href="classmp_1_1_event_loop.html">EventLoop</a>&amp; <a class="code hl_variable" href="classmp_1_1_logging_error_handler.html#ab44a0e9ab8c63995c52b47ad4041aaf5">m_loop</a>;</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>};</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span></div>
<div class="foldopen" id="foldopen00102" data-start="{" data-end="};">
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno"><a class="line" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304">  102</a></span><span class="keyword">enum class</span> <a class="code hl_enumeration" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304">Log</a> {</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno"><a class="line" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304add4ec0ac4e58f7c32a01244ae91150b1">  103</a></span>    <a class="code hl_enumvalue" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304add4ec0ac4e58f7c32a01244ae91150b1">Trace</a> = 0,</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno"><a class="line" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304aa603905470e2a5b8c13e96b579ef0dba">  104</a></span>    <a class="code hl_enumvalue" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304aa603905470e2a5b8c13e96b579ef0dba">Debug</a>,</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno"><a class="line" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304a4059b0251f66a18cb56f544728796875">  105</a></span>    <a class="code hl_enumvalue" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304a4059b0251f66a18cb56f544728796875">Info</a>,</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno"><a class="line" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304a0eaadb4fcb48a0a0ed7bc9868be9fbaa">  106</a></span>    <a class="code hl_enumvalue" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304a0eaadb4fcb48a0a0ed7bc9868be9fbaa">Warning</a>,</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno"><a class="line" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304a902b0d55fddef6f8d651fe1035b7d4bd">  107</a></span>    <a class="code hl_enumvalue" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304a902b0d55fddef6f8d651fe1035b7d4bd">Error</a>,</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno"><a class="line" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304a36ec8dc76bf55896199b1276242944af">  108</a></span>    <a class="code hl_enumvalue" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304a36ec8dc76bf55896199b1276242944af">Raise</a>,</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>};</div>
</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span> </div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>kj::StringPtr <a class="code hl_function" href="namespacemp.html#a620d42de001d14996c71608f6f52b5e3">KJ_STRINGIFY</a>(<a class="code hl_enumeration" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304">Log</a> <a class="code hl_variable" href="bitcoin-tx_8cpp.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>);</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span> </div>
<div class="foldopen" id="foldopen00113" data-start="{" data-end="};">
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno"><a class="line" href="structmp_1_1_log_message.html">  113</a></span><span class="keyword">struct </span><a class="code hl_struct" href="structmp_1_1_log_message.html">LogMessage</a> {</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno"><a class="line" href="structmp_1_1_log_message.html#a36bd74109f547f7f8198faf5a12d2879">  116</a></span>    std::string <a class="code hl_variable" href="structmp_1_1_log_message.html#a36bd74109f547f7f8198faf5a12d2879">message</a>;</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno"><a class="line" href="structmp_1_1_log_message.html#a1a753a0948b8f8d97eda0f8e393011ef">  119</a></span>    <a class="code hl_enumeration" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304">Log</a> <a class="code hl_variable" href="structmp_1_1_log_message.html#a1a753a0948b8f8d97eda0f8e393011ef">level</a>;</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>};</div>
</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span> </div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno"><a class="line" href="namespacemp.html#a61ffb74e9f97c3924b3904a35a5f20b2">  122</a></span><span class="keyword">using </span><a class="code hl_typedef" href="namespacemp.html#a61ffb74e9f97c3924b3904a35a5f20b2">LogFn</a> = std::function&lt;void(<a class="code hl_struct" href="structmp_1_1_log_message.html">LogMessage</a>)&gt;;</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span> </div>
<div class="foldopen" id="foldopen00124" data-start="{" data-end="};">
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno"><a class="line" href="structmp_1_1_log_options.html">  124</a></span><span class="keyword">struct </span><a class="code hl_struct" href="structmp_1_1_log_options.html">LogOptions</a> {</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno"><a class="line" href="structmp_1_1_log_options.html#a3a414464b11bba79710d13cfe1ede5aa">  127</a></span>    <a class="code hl_typedef" href="namespacemp.html#a61ffb74e9f97c3924b3904a35a5f20b2">LogFn</a> <a class="code hl_variable" href="structmp_1_1_log_options.html#a3a414464b11bba79710d13cfe1ede5aa">log_fn</a>;</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno"><a class="line" href="structmp_1_1_log_options.html#a1cbcdd8b48543e3316b655dea11bda67">  131</a></span>    <span class="keywordtype">size_t</span> <a class="code hl_variable" href="structmp_1_1_log_options.html#a1cbcdd8b48543e3316b655dea11bda67">max_chars</a>{200};</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno"><a class="line" href="structmp_1_1_log_options.html#a63c98c86c0c933b56529ff7a327fabc7">  135</a></span>    <a class="code hl_enumeration" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304">Log</a> <a class="code hl_variable" href="structmp_1_1_log_options.html#a63c98c86c0c933b56529ff7a327fabc7">log_level</a>{<a class="code hl_enumvalue" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304add4ec0ac4e58f7c32a01244ae91150b1">Log::Trace</a>};</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>};</div>
</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span> </div>
<div class="foldopen" id="foldopen00138" data-start="{" data-end="};">
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno"><a class="line" href="classmp_1_1_logger.html">  138</a></span><span class="keyword">class </span><a class="code hl_function" href="classmp_1_1_logger.html#ad215e4730d59a458a24e72cea5e79e65">Logger</a></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>{</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno"><a class="line" href="classmp_1_1_logger.html#ad215e4730d59a458a24e72cea5e79e65">  141</a></span>    <a class="code hl_function" href="classmp_1_1_logger.html#ad215e4730d59a458a24e72cea5e79e65">Logger</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structmp_1_1_log_options.html">LogOptions</a>&amp; options, <a class="code hl_enumeration" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304">Log</a> log_level) : m_options(options), m_log_level(log_level) {}</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span> </div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno"><a class="line" href="classmp_1_1_logger.html#aeae30a1ace0ff0abecc2750ad1f20e7f">  143</a></span>    <a class="code hl_function" href="classmp_1_1_logger.html#aeae30a1ace0ff0abecc2750ad1f20e7f">Logger</a>(<a class="code hl_function" href="classmp_1_1_logger.html#ad215e4730d59a458a24e72cea5e79e65">Logger</a>&amp;&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno"><a class="line" href="classmp_1_1_logger.html#aa0559f968425197d1bf676ecc6bc9a15">  144</a></span>    <a class="code hl_function" href="classmp_1_1_logger.html#ad215e4730d59a458a24e72cea5e79e65">Logger</a>&amp; <a class="code hl_function" href="classmp_1_1_logger.html#aa0559f968425197d1bf676ecc6bc9a15">operator=</a>(<a class="code hl_function" href="classmp_1_1_logger.html#ad215e4730d59a458a24e72cea5e79e65">Logger</a>&amp;&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno"><a class="line" href="classmp_1_1_logger.html#aa7f3dbfbd2426b4874750f08bd23bd7f">  145</a></span>    <a class="code hl_function" href="classmp_1_1_logger.html#aa7f3dbfbd2426b4874750f08bd23bd7f">Logger</a>(<span class="keyword">const</span> <a class="code hl_function" href="classmp_1_1_logger.html#ad215e4730d59a458a24e72cea5e79e65">Logger</a>&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno"><a class="line" href="classmp_1_1_logger.html#aaf19334937476d1921ee36e3ffa97b05">  146</a></span>    <a class="code hl_function" href="classmp_1_1_logger.html#ad215e4730d59a458a24e72cea5e79e65">Logger</a>&amp; <a class="code hl_function" href="classmp_1_1_logger.html#aaf19334937476d1921ee36e3ffa97b05">operator=</a>(<span class="keyword">const</span> <a class="code hl_function" href="classmp_1_1_logger.html#ad215e4730d59a458a24e72cea5e79e65">Logger</a>&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span> </div>
<div class="foldopen" id="foldopen00148" data-start="{" data-end="}">
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno"><a class="line" href="classmp_1_1_logger.html#ae3331f55a1545677909fd95f8c9128fe">  148</a></span>    <a class="code hl_function" href="classmp_1_1_logger.html#ae3331f55a1545677909fd95f8c9128fe">~Logger</a>() noexcept(false)</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    {</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>        <span class="keywordflow">if</span> (enabled()) m_options.log_fn({std::move(m_buffer).str(), m_log_level});</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    }</div>
</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span> </div>
<div class="foldopen" id="foldopen00153" data-start="{" data-end="}">
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno"><a class="line" href="structmp_1_1_proxy_server_base.html#afe79a96d9eb6ad4ff906a7f6a5b858b4">  153</a></span>    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="foldopen" id="foldopen00154" data-start="{" data-end="}">
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno"><a class="line" href="classmp_1_1_logger.html#a1496956d4b3865115cc0f2227f608659">  154</a></span>    <span class="keyword">friend</span> <a class="code hl_function" href="classmp_1_1_logger.html#ad215e4730d59a458a24e72cea5e79e65">Logger</a>&amp; <a class="code hl_friend" href="classmp_1_1_logger.html#a1496956d4b3865115cc0f2227f608659">operator&lt;&lt;</a>(<a class="code hl_function" href="classmp_1_1_logger.html#ad215e4730d59a458a24e72cea5e79e65">Logger</a>&amp; logger, <a class="code hl_define" href="hash__tests_8cpp.html#ad4971a985148c784a362f962d42aa012">T</a>&amp;&amp; value)</div>
<div class="foldopen" id="foldopen00155" data-start="{" data-end="}">
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno"><a class="line" href="structmp_1_1_proxy_server_base.html#a337a3c890fad394953330b47eb4aafb2">  155</a></span>    {</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>        <span class="keywordflow">if</span> (logger.enabled()) logger.m_buffer &lt;&lt; std::forward&lt;T&gt;(value);</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>        <span class="keywordflow">return</span> logger;</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    }</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span> </div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="foldopen" id="foldopen00161" data-start="{" data-end="}">
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno"><a class="line" href="classmp_1_1_logger.html#addb6e5d2a9bcd73e31598fc028806081">  161</a></span>    <span class="keyword">friend</span> <a class="code hl_function" href="classmp_1_1_logger.html#ad215e4730d59a458a24e72cea5e79e65">Logger</a>&amp; <a class="code hl_friend" href="classmp_1_1_logger.html#addb6e5d2a9bcd73e31598fc028806081">operator&lt;&lt;</a>(<a class="code hl_function" href="classmp_1_1_logger.html#ad215e4730d59a458a24e72cea5e79e65">Logger</a>&amp;&amp; logger, <a class="code hl_define" href="hash__tests_8cpp.html#ad4971a985148c784a362f962d42aa012">T</a>&amp;&amp; value)</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    {</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>        <span class="keywordflow">return</span> logger &lt;&lt; std::forward&lt;T&gt;(value);</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    }</div>
</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span> </div>
<div class="foldopen" id="foldopen00166" data-start="{" data-end="}">
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno"><a class="line" href="classmp_1_1_logger.html#a67b76affb3b5d35fa419ac234144038b">  166</a></span>    <span class="keyword">explicit</span> <span class="keyword">operator</span> bool()<span class="keyword"> const</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span><span class="keyword">    </span>{</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>        <span class="keywordflow">return</span> enabled();</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    }</div>
</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span> </div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span><span class="keyword">private</span>:</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    <span class="keywordtype">bool</span> enabled()<span class="keyword"> const</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span><span class="keyword">    </span>{</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>        <span class="keywordflow">return</span> m_options.<a class="code hl_variable" href="structmp_1_1_log_options.html#a3a414464b11bba79710d13cfe1ede5aa">log_fn</a> &amp;&amp; m_log_level &gt;= m_options.<a class="code hl_variable" href="structmp_1_1_log_options.html#a63c98c86c0c933b56529ff7a327fabc7">log_level</a>;</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    }</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> </div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    <span class="keyword">const</span> LogOptions&amp; m_options;</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>    <a class="code hl_enumeration" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304">Log</a> m_log_level;</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    std::ostringstream m_buffer;</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>};</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span> </div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno"><a class="line" href="proxy-io_8h.html#ab3af3f094132fbaea399d39236f1be83">  182</a></span><span class="preprocessor">#define MP_LOGPLAIN(loop, ...) if (mp::Logger logger{(loop).m_log_opts, __VA_ARGS__}; logger) logger</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span> </div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno"><a class="line" href="proxy-io_8h.html#aa6fc2a55e5127fdfee52af8eda04d5d5">  184</a></span><span class="preprocessor">#define MP_LOG(loop, ...) MP_LOGPLAIN(loop, __VA_ARGS__) &lt;&lt; &quot;{&quot; &lt;&lt; LongThreadName((loop).m_exe_name) &lt;&lt; &quot;} &quot;</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span> </div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>std::string <a class="code hl_function" href="namespacemp.html#aa2d3754fdd40a5ee179789009a316e08">LongThreadName</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* exe_name);</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span></div>
<div class="foldopen" id="foldopen00213" data-start="{" data-end="};">
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html">  213</a></span><span class="keyword">class </span><a class="code hl_function" href="classmp_1_1_event_loop.html#af4e2d623f57fae116fc13c423109871b">EventLoop</a></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>{</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span><span class="keyword">public</span>:</div>
<div class="foldopen" id="foldopen00217" data-start="{" data-end="}">
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#af4e2d623f57fae116fc13c423109871b">  217</a></span>    <a class="code hl_function" href="classmp_1_1_event_loop.html#af4e2d623f57fae116fc13c423109871b">EventLoop</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* exe_name, <a class="code hl_typedef" href="namespacemp.html#a61ffb74e9f97c3924b3904a35a5f20b2">LogFn</a> log_fn, <span class="keywordtype">void</span>* context = <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>        : <a class="code hl_function" href="classmp_1_1_event_loop.html#af4e2d623f57fae116fc13c423109871b">EventLoop</a>(exe_name, <a class="code hl_struct" href="structmp_1_1_log_options.html">LogOptions</a>{<a class="code hl_namespace" href="namespacestd.html">std</a>::move(log_fn)}, context){}</div>
</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    <a class="code hl_function" href="classmp_1_1_event_loop.html#af4e2d623f57fae116fc13c423109871b">EventLoop</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* exe_name, <a class="code hl_struct" href="structmp_1_1_log_options.html">LogOptions</a> log_opts, <span class="keywordtype">void</span>* context = <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span></div>
<div class="foldopen" id="foldopen00224" data-start="{" data-end="}">
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#a97dc677b923c4253bb089b99a4e24e4c">  224</a></span>    <a class="code hl_function" href="classmp_1_1_event_loop.html#a97dc677b923c4253bb089b99a4e24e4c">EventLoop</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* exe_name, std::function&lt;<span class="keywordtype">void</span>(<span class="keywordtype">bool</span>, std::string)&gt; old_callback, <span class="keywordtype">void</span>* context = <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>        : <a class="code hl_function" href="classmp_1_1_event_loop.html#af4e2d623f57fae116fc13c423109871b">EventLoop</a>(exe_name,</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>                <a class="code hl_typedef" href="namespacemp.html#a61ffb74e9f97c3924b3904a35a5f20b2">LogFn</a>{[old_callback = <a class="code hl_namespace" href="namespacestd.html">std</a>::move(old_callback)](<a class="code hl_struct" href="structmp_1_1_log_message.html">LogMessage</a> log_data) {old_callback(log_data.level == <a class="code hl_enumvalue" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304a36ec8dc76bf55896199b1276242944af">Log::Raise</a>, std::move(log_data.message));}},</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>                context){}</div>
</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span> </div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    <a class="code hl_class" href="classmp_1_1_event_loop.html">~EventLoop</a>();</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    <span class="keywordtype">void</span> loop();</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span></div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>    <span class="keywordtype">void</span> post(kj::Function&lt;<span class="keywordtype">void</span>()&gt; fn);</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span></div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Callable&gt;</div>
<div class="foldopen" id="foldopen00244" data-start="{" data-end="}">
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#ad322c973d237a8efe56f3c4ffbb3cb0c">  244</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="classmp_1_1_event_loop.html#ad322c973d237a8efe56f3c4ffbb3cb0c">sync</a>(Callable&amp;&amp; callable)</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    {</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>        <a class="code hl_function" href="classmp_1_1_event_loop.html#a4e6f3fba72d4c182f3e7474a2fd76667">post</a>(std::forward&lt;Callable&gt;(callable));</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>    }</div>
</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span></div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>    <span class="keywordtype">void</span> addAsyncCleanup(std::function&lt;<span class="keywordtype">void</span>()&gt; fn);</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>    <span class="keywordtype">void</span> startAsyncThread() <a class="code hl_define" href="ipc_2libmultiprocess_2include_2mp_2util_8h.html#a6b530c2b9c91ae9a26983477097f38dd">MP_REQUIRES</a>(m_mutex);</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span></div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    <span class="keywordtype">bool</span> done() const <a class="code hl_define" href="ipc_2libmultiprocess_2include_2mp_2util_8h.html#a6b530c2b9c91ae9a26983477097f38dd">MP_REQUIRES</a>(m_mutex);</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#a2a779802443c51d72db5bd158c31c964">  271</a></span>    const <span class="keywordtype">char</span>* <a class="code hl_variable" href="classmp_1_1_event_loop.html#a2a779802443c51d72db5bd158c31c964">m_exe_name</a>;</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#aaee8fe6bf715daa70d55a732218dcfe5">  274</a></span>    <a class="code hl_namespace" href="namespacestd.html">std</a>::thread::<span class="keywordtype">id</span> <a class="code hl_variable" href="classmp_1_1_event_loop.html#aaee8fe6bf715daa70d55a732218dcfe5">m_thread_id</a> = <a class="code hl_namespace" href="namespacestd.html">std</a>::this_thread::get_id();</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#a7ff706a17a3571c9b28db11e81dc7585">  278</a></span>    <a class="code hl_namespace" href="namespacestd.html">std</a>::thread <a class="code hl_variable" href="classmp_1_1_event_loop.html#a7ff706a17a3571c9b28db11e81dc7585">m_async_thread</a>;</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span></div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#a18e06ab543770b1d48dd06243faa75eb">  281</a></span>    kj::Function&lt;<span class="keywordtype">void</span>()&gt;* m_post_fn <a class="code hl_function" href="classmp_1_1_event_loop.html#a18e06ab543770b1d48dd06243faa75eb">MP_GUARDED_BY</a>(<a class="code hl_variable" href="classmp_1_1_event_loop.html#a71aaf23d91d7b7a5611738c4f06e3577">m_mutex</a>) = <span class="keywordtype">nullptr</span>;</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span></div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#aaac2885ebd590ea8287845814c6a5b49">  284</a></span>    <a class="code hl_namespace" href="namespacestd.html">std</a>::optional&lt;<a class="code hl_typedef" href="namespacemp.html#aa04bf09245b60eb219c446d213cc0390">CleanupList</a>&gt; m_async_fns <a class="code hl_function" href="classmp_1_1_event_loop.html#a18e06ab543770b1d48dd06243faa75eb">MP_GUARDED_BY</a>(<a class="code hl_variable" href="classmp_1_1_event_loop.html#a71aaf23d91d7b7a5611738c4f06e3577">m_mutex</a>);</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#a5ca6d7b6e9cca718db8c78de06dde777">  287</a></span>    <span class="keywordtype">int</span> <a class="code hl_variable" href="classmp_1_1_event_loop.html#a5ca6d7b6e9cca718db8c78de06dde777">m_wait_fd</a> = -1;</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#a59f59d4a0735009e1d98f835eeccdb87">  290</a></span>    <span class="keywordtype">int</span> <a class="code hl_variable" href="classmp_1_1_event_loop.html#a59f59d4a0735009e1d98f835eeccdb87">m_post_fd</a> = -1;</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span></div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#a75d54c4047fd429274c790929f4dc23e">  294</a></span>    <span class="keywordtype">int</span> m_num_clients <a class="code hl_function" href="classmp_1_1_event_loop.html#a18e06ab543770b1d48dd06243faa75eb">MP_GUARDED_BY</a>(<a class="code hl_variable" href="classmp_1_1_event_loop.html#a71aaf23d91d7b7a5611738c4f06e3577">m_mutex</a>) = 0;</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span></div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#a71aaf23d91d7b7a5611738c4f06e3577">  298</a></span>    <a class="code hl_typedef" href="sync_8h.html#a326d1d46ce05b5316d8ebe2694a10a6e">Mutex</a> <a class="code hl_variable" href="classmp_1_1_event_loop.html#a71aaf23d91d7b7a5611738c4f06e3577">m_mutex</a>;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#accca0ab294feb9061406ae9c73a3ceb5">  299</a></span>    <a class="code hl_namespace" href="namespacestd.html">std</a>::condition_variable <a class="code hl_variable" href="classmp_1_1_event_loop.html#accca0ab294feb9061406ae9c73a3ceb5">m_cv</a>;</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#ae9ed3a7b20562f71d91760034e7100f1">  302</a></span>    kj::AsyncIoContext <a class="code hl_variable" href="classmp_1_1_event_loop.html#ae9ed3a7b20562f71d91760034e7100f1">m_io_context</a>;</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span></div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#aa3a0b29328e0fc0ec8b26132feb0fcc5">  305</a></span>    <a class="code hl_class" href="classmp_1_1_logging_error_handler.html">LoggingErrorHandler</a> <a class="code hl_variable" href="classmp_1_1_event_loop.html#aa3a0b29328e0fc0ec8b26132feb0fcc5">m_error_handler</a>{*<span class="keyword">this</span>};</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#a4867e4e832e2d05e777ed32a795214ad">  308</a></span>    std::unique_ptr&lt;kj::TaskSet&gt; <a class="code hl_variable" href="classmp_1_1_event_loop.html#a4867e4e832e2d05e777ed32a795214ad">m_task_set</a>;</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#ace117e2546e02ad25eb0044315aa4ac9">  311</a></span>    std::list&lt;Connection&gt; <a class="code hl_variable" href="classmp_1_1_event_loop.html#ace117e2546e02ad25eb0044315aa4ac9">m_incoming_connections</a>;</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span></div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#ab1f44d16de891fa65b054ee4ead90294">  314</a></span>    <a class="code hl_struct" href="structmp_1_1_log_options.html">LogOptions</a> <a class="code hl_variable" href="classmp_1_1_event_loop.html#ab1f44d16de891fa65b054ee4ead90294">m_log_opts</a>;</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span></div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno"><a class="line" href="classmp_1_1_event_loop.html#a92efa486d18e81bd893ff18bc8a22926">  317</a></span>    <span class="keywordtype">void</span>* <a class="code hl_variable" href="classmp_1_1_event_loop.html#a92efa486d18e81bd893ff18bc8a22926">m_context</a>;</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>};</div>
</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span></div>
<div class="foldopen" id="foldopen00326" data-start="{" data-end="};">
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno"><a class="line" href="structmp_1_1_waiter.html">  326</a></span><span class="keyword">struct </span><a class="code hl_function" href="structmp_1_1_waiter.html#aee95e52957a56b142aae7d97e4d81172">Waiter</a></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>{</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno"><a class="line" href="structmp_1_1_waiter.html#aee95e52957a56b142aae7d97e4d81172">  328</a></span>    <a class="code hl_function" href="structmp_1_1_waiter.html#aee95e52957a56b142aae7d97e4d81172">Waiter</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span> </div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Fn&gt;</div>
<div class="foldopen" id="foldopen00331" data-start="{" data-end="}">
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno"><a class="line" href="structmp_1_1_waiter.html#aa406a75cf282d0ac5cb532edd2ba9fa7">  331</a></span>    <span class="keywordtype">bool</span> <a class="code hl_function" href="structmp_1_1_waiter.html#aa406a75cf282d0ac5cb532edd2ba9fa7">post</a>(Fn&amp;&amp; fn)</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>    {</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>        <span class="keyword">const</span> <a class="code hl_class" href="classmp_1_1_lock.html">Lock</a> lock(<a class="code hl_variable" href="structmp_1_1_waiter.html#a71aaf23d91d7b7a5611738c4f06e3577">m_mutex</a>);</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>        <span class="keywordflow">if</span> (m_fn) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>        m_fn = std::forward&lt;Fn&gt;(fn);</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>        <a class="code hl_variable" href="structmp_1_1_waiter.html#accca0ab294feb9061406ae9c73a3ceb5">m_cv</a>.notify_all();</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>    }</div>
</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span> </div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>    <span class="keyword">template</span> &lt;<span class="keyword">class</span> Predicate&gt;</div>
<div class="foldopen" id="foldopen00341" data-start="{" data-end="}">
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno"><a class="line" href="structmp_1_1_waiter.html#a365fb970e0590633a23f4a61df876c2b">  341</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="structmp_1_1_waiter.html#a365fb970e0590633a23f4a61df876c2b">wait</a>(<a class="code hl_class" href="classmp_1_1_lock.html">Lock</a>&amp; lock, Predicate pred)</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>    {</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>        <a class="code hl_variable" href="structmp_1_1_waiter.html#accca0ab294feb9061406ae9c73a3ceb5">m_cv</a>.wait(lock.<a class="code hl_variable" href="classmp_1_1_lock.html#a8d50677be62dfbfcea4da54095b81c86">m_lock</a>, [&amp;]() <a class="code hl_define" href="ipc_2libmultiprocess_2include_2mp_2util_8h.html#a6b530c2b9c91ae9a26983477097f38dd">MP_REQUIRES</a>(<a class="code hl_variable" href="structmp_1_1_waiter.html#a71aaf23d91d7b7a5611738c4f06e3577">m_mutex</a>) {</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>            <span class="comment">// Important for this to be &quot;while (m_fn)&quot;, not &quot;if (m_fn)&quot; to avoid</span></div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>            <span class="comment">// a lost-wakeup bug. A new m_fn and m_cv notification might be sent</span></div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>            <span class="comment">// after the fn() call and before the lock.lock() call in this loop</span></div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>            <span class="comment">// in the case where a capnp response is sent and a brand new</span></div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>            <span class="comment">// request is immediately received.</span></div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>            <span class="keywordflow">while</span> (m_fn) {</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>                <span class="keyword">auto</span> fn = std::move(*m_fn);</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>                m_fn.reset();</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>                <a class="code hl_function" href="namespacemp.html#ab46f5bea2155b7984451745440f03497">Unlock</a>(lock, fn);</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>            }</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>            <span class="keyword">const</span> <span class="keywordtype">bool</span> done = pred();</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>            <span class="keywordflow">return</span> done;</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>        });</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>    }</div>
</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno"><a class="line" href="structmp_1_1_waiter.html#a71aaf23d91d7b7a5611738c4f06e3577">  366</a></span>    <a class="code hl_typedef" href="sync_8h.html#a326d1d46ce05b5316d8ebe2694a10a6e">Mutex</a> <a class="code hl_variable" href="structmp_1_1_waiter.html#a71aaf23d91d7b7a5611738c4f06e3577">m_mutex</a>;</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno"><a class="line" href="structmp_1_1_waiter.html#accca0ab294feb9061406ae9c73a3ceb5">  367</a></span>    std::condition_variable <a class="code hl_variable" href="structmp_1_1_waiter.html#accca0ab294feb9061406ae9c73a3ceb5">m_cv</a>;</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno"><a class="line" href="structmp_1_1_waiter.html#a3923af766063ee5af4ebcb7477371791">  368</a></span>    std::optional&lt;kj::Function&lt;void()&gt;&gt; m_fn <a class="code hl_function" href="structmp_1_1_waiter.html#a3923af766063ee5af4ebcb7477371791">MP_GUARDED_BY</a>(<a class="code hl_variable" href="structmp_1_1_waiter.html#a71aaf23d91d7b7a5611738c4f06e3577">m_mutex</a>);</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>};</div>
</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span></div>
<div class="foldopen" id="foldopen00376" data-start="{" data-end="};">
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno"><a class="line" href="classmp_1_1_connection.html">  376</a></span><span class="keyword">class </span><a class="code hl_function" href="classmp_1_1_connection.html#af29bbec879064beec9441a1078bddec3">Connection</a></div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>{</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span><span class="keyword">public</span>:</div>
<div class="foldopen" id="foldopen00379" data-start="{" data-end="}">
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno"><a class="line" href="classmp_1_1_connection.html#af29bbec879064beec9441a1078bddec3">  379</a></span>    <a class="code hl_function" href="classmp_1_1_connection.html#af29bbec879064beec9441a1078bddec3">Connection</a>(<a class="code hl_class" href="classmp_1_1_event_loop.html">EventLoop</a>&amp; loop, kj::Own&lt;kj::AsyncIoStream&gt;&amp;&amp; stream_)</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>        : <a class="code hl_variable" href="classmp_1_1_connection.html#a37b5b5040fdf06491742db64e929dbeb">m_loop</a>(loop), <a class="code hl_variable" href="classmp_1_1_connection.html#a826fdcefcc3eae8215a8b1d8628892bc">m_stream</a>(kj::mv(stream_)),</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>          <a class="code hl_variable" href="classmp_1_1_connection.html#a54d27701ff67ea0db8ae9e852c274d30">m_network</a>(*<a class="code hl_variable" href="classmp_1_1_connection.html#a826fdcefcc3eae8215a8b1d8628892bc">m_stream</a>, ::capnp::rpc::twoparty::Side::CLIENT, ::capnp::ReaderOptions()),</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>          <a class="code hl_variable" href="classmp_1_1_connection.html#a67cb43da9e4f67dbc9d6a74a3c301a0e">m_rpc_system</a>(::capnp::makeRpcClient(<a class="code hl_variable" href="classmp_1_1_connection.html#a54d27701ff67ea0db8ae9e852c274d30">m_network</a>)) {}</div>
</div>
<div class="foldopen" id="foldopen00383" data-start="{" data-end="}">
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno"><a class="line" href="classmp_1_1_connection.html#a5f5fe74aee9f84ce7c92450be96dc090">  383</a></span>    <a class="code hl_function" href="classmp_1_1_connection.html#a5f5fe74aee9f84ce7c92450be96dc090">Connection</a>(<a class="code hl_class" href="classmp_1_1_event_loop.html">EventLoop</a>&amp; loop,</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>        kj::Own&lt;kj::AsyncIoStream&gt;&amp;&amp; stream_,</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>        <span class="keyword">const</span> std::function&lt;::capnp::Capability::Client(<a class="code hl_function" href="classmp_1_1_connection.html#af29bbec879064beec9441a1078bddec3">Connection</a>&amp;)&gt;&amp; make_client)</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>        : <a class="code hl_variable" href="classmp_1_1_connection.html#a37b5b5040fdf06491742db64e929dbeb">m_loop</a>(loop), <a class="code hl_variable" href="classmp_1_1_connection.html#a826fdcefcc3eae8215a8b1d8628892bc">m_stream</a>(kj::mv(stream_)),</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>          <a class="code hl_variable" href="classmp_1_1_connection.html#a54d27701ff67ea0db8ae9e852c274d30">m_network</a>(*<a class="code hl_variable" href="classmp_1_1_connection.html#a826fdcefcc3eae8215a8b1d8628892bc">m_stream</a>, ::capnp::rpc::twoparty::Side::SERVER, ::capnp::ReaderOptions()),</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>          <a class="code hl_variable" href="classmp_1_1_connection.html#a67cb43da9e4f67dbc9d6a74a3c301a0e">m_rpc_system</a>(::capnp::makeRpcServer(<a class="code hl_variable" href="classmp_1_1_connection.html#a54d27701ff67ea0db8ae9e852c274d30">m_network</a>, make_client(*this))) {}</div>
</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span></div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    <a class="code hl_class" href="classmp_1_1_connection.html">~Connection</a>();</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>    <a class="code hl_typedef" href="namespacemp.html#a5922c1e79ba82f5eb46c5cd0bfc69966">CleanupIt</a> addSyncCleanup(std::function&lt;<span class="keywordtype">void</span>()&gt; fn);</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>    <span class="keywordtype">void</span> removeSyncCleanup(<a class="code hl_typedef" href="namespacemp.html#a5922c1e79ba82f5eb46c5cd0bfc69966">CleanupIt</a> it);</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt;</div>
<div class="foldopen" id="foldopen00405" data-start="{" data-end="}">
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno"><a class="line" href="classmp_1_1_connection.html#ad80dba71352898ebf4e8f88028ddc7e1">  405</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="classmp_1_1_connection.html#ad80dba71352898ebf4e8f88028ddc7e1">onDisconnect</a>(F&amp;&amp; f)</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>    {</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>        <span class="comment">// Add disconnect handler to local TaskSet to ensure it is cancelled and</span></div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>        <span class="comment">// will never run after connection object is destroyed. But when disconnect</span></div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>        <span class="comment">// handler fires, do not call the function f right away, instead add it</span></div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>        <span class="comment">// to the EventLoop TaskSet to avoid &quot;Promise callback destroyed itself&quot;</span></div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>        <span class="comment">// error in cases where f deletes this Connection object.</span></div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>        <a class="code hl_variable" href="classmp_1_1_connection.html#a20da0cbcf16fc5a09b87c061496cb1b1">m_on_disconnect</a>.add(<a class="code hl_variable" href="classmp_1_1_connection.html#a54d27701ff67ea0db8ae9e852c274d30">m_network</a>.onDisconnect().then(</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>            [f = std::forward&lt;F&gt;(f), <span class="keyword">this</span>]() <span class="keyword">mutable</span> { m_loop-&gt;m_task_set-&gt;add(kj::evalLater(kj::mv(f))); }));</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>    }</div>
</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span> </div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno"><a class="line" href="classmp_1_1_connection.html#a37b5b5040fdf06491742db64e929dbeb">  416</a></span>    <a class="code hl_class" href="classmp_1_1_event_loop_ref.html">EventLoopRef</a> <a class="code hl_variable" href="classmp_1_1_connection.html#a37b5b5040fdf06491742db64e929dbeb">m_loop</a>;</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno"><a class="line" href="classmp_1_1_connection.html#a826fdcefcc3eae8215a8b1d8628892bc">  417</a></span>    kj::Own&lt;kj::AsyncIoStream&gt; <a class="code hl_variable" href="classmp_1_1_connection.html#a826fdcefcc3eae8215a8b1d8628892bc">m_stream</a>;</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno"><a class="line" href="classmp_1_1_connection.html#aa3a0b29328e0fc0ec8b26132feb0fcc5">  418</a></span>    <a class="code hl_class" href="classmp_1_1_logging_error_handler.html">LoggingErrorHandler</a> <a class="code hl_variable" href="classmp_1_1_connection.html#aa3a0b29328e0fc0ec8b26132feb0fcc5">m_error_handler</a>{*<a class="code hl_variable" href="classmp_1_1_connection.html#a37b5b5040fdf06491742db64e929dbeb">m_loop</a>};</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno"><a class="line" href="classmp_1_1_connection.html#a20da0cbcf16fc5a09b87c061496cb1b1">  419</a></span>    kj::TaskSet <a class="code hl_variable" href="classmp_1_1_connection.html#a20da0cbcf16fc5a09b87c061496cb1b1">m_on_disconnect</a>{<a class="code hl_variable" href="classmp_1_1_connection.html#aa3a0b29328e0fc0ec8b26132feb0fcc5">m_error_handler</a>};</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno"><a class="line" href="classmp_1_1_connection.html#a54d27701ff67ea0db8ae9e852c274d30">  420</a></span>    ::capnp::TwoPartyVatNetwork <a class="code hl_variable" href="classmp_1_1_connection.html#a54d27701ff67ea0db8ae9e852c274d30">m_network</a>;</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno"><a class="line" href="classmp_1_1_connection.html#a67cb43da9e4f67dbc9d6a74a3c301a0e">  421</a></span>    std::optional&lt;::capnp::RpcSystem&lt;::capnp::rpc::twoparty::VatId&gt;&gt; <a class="code hl_variable" href="classmp_1_1_connection.html#a67cb43da9e4f67dbc9d6a74a3c301a0e">m_rpc_system</a>;</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span> </div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>    <span class="comment">// ThreadMap interface client, used to create a remote server thread when an</span></div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>    <span class="comment">// client IPC call is being made for the first time from a new thread.</span></div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno"><a class="line" href="classmp_1_1_connection.html#aa8499cb4f42a4f1fb12b46a450bfc951">  425</a></span>    ThreadMap::Client <a class="code hl_variable" href="classmp_1_1_connection.html#aa8499cb4f42a4f1fb12b46a450bfc951">m_thread_map</a>{<span class="keyword">nullptr</span>};</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno"><a class="line" href="classmp_1_1_connection.html#a1008c41395d28e937364a9806754856c">  429</a></span>    ::capnp::CapabilityServerSet&lt;Thread&gt; <a class="code hl_variable" href="classmp_1_1_connection.html#a1008c41395d28e937364a9806754856c">m_threads</a>;</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span></div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno"><a class="line" href="classmp_1_1_connection.html#ae364219e4df65bbd818bcfada34e4311">  434</a></span>    <a class="code hl_typedef" href="namespacemp.html#aa04bf09245b60eb219c446d213cc0390">CleanupList</a> <a class="code hl_variable" href="classmp_1_1_connection.html#ae364219e4df65bbd818bcfada34e4311">m_sync_cleanup_fns</a>;</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>};</div>
</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span></div>
<div class="foldopen" id="foldopen00445" data-start="{" data-end="};">
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno"><a class="line" href="structmp_1_1_server_vat_id.html">  445</a></span><span class="keyword">struct </span><a class="code hl_function" href="structmp_1_1_server_vat_id.html#a6425f07d3c33694293c0f54e1a07db7c">ServerVatId</a></div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>{</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno"><a class="line" href="structmp_1_1_server_vat_id.html#ab0220d711d4b7199e9a3b788be2e9a53">  447</a></span>    ::capnp::word <a class="code hl_variable" href="structmp_1_1_server_vat_id.html#ab0220d711d4b7199e9a3b788be2e9a53">scratch</a>[4]{};</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno"><a class="line" href="structmp_1_1_server_vat_id.html#ad0507d9e323da980bb26f55b1799048a">  448</a></span>    ::capnp::MallocMessageBuilder <a class="code hl_variable" href="structmp_1_1_server_vat_id.html#ad0507d9e323da980bb26f55b1799048a">message</a>{<a class="code hl_variable" href="structmp_1_1_server_vat_id.html#ab0220d711d4b7199e9a3b788be2e9a53">scratch</a>};</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno"><a class="line" href="structmp_1_1_server_vat_id.html#a9a1257c1478aef292273d2eee91a0b07">  449</a></span>    ::capnp::rpc::twoparty::VatId::Builder <a class="code hl_variable" href="structmp_1_1_server_vat_id.html#a9a1257c1478aef292273d2eee91a0b07">vat_id</a>{<a class="code hl_variable" href="structmp_1_1_server_vat_id.html#ad0507d9e323da980bb26f55b1799048a">message</a>.getRoot&lt;::capnp::rpc::twoparty::VatId&gt;()};</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno"><a class="line" href="structmp_1_1_server_vat_id.html#a6425f07d3c33694293c0f54e1a07db7c">  450</a></span>    <a class="code hl_function" href="structmp_1_1_server_vat_id.html#a6425f07d3c33694293c0f54e1a07db7c">ServerVatId</a>() { <a class="code hl_variable" href="structmp_1_1_server_vat_id.html#a9a1257c1478aef292273d2eee91a0b07">vat_id</a>.setSide(::capnp::rpc::twoparty::Side::SERVER); }</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>};</div>
</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span> </div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Interface, <span class="keyword">typename</span> Impl&gt;</div>
<div class="foldopen" id="foldopen00454" data-start="{" data-end="}">
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno"><a class="line" href="classmp_1_1_proxy_client_base.html#a32f6c2ed2bf7fd1668e2d5c3e5256682">  454</a></span><a class="code hl_function" href="classmp_1_1_proxy_client_base.html#a32f6c2ed2bf7fd1668e2d5c3e5256682">ProxyClientBase&lt;Interface, Impl&gt;::ProxyClientBase</a>(<span class="keyword">typename</span> Interface::Client client,</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>    <a class="code hl_class" href="classmp_1_1_connection.html">Connection</a>* connection,</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>    <span class="keywordtype">bool</span> destroy_connection)</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>    : <a class="code hl_variable" href="classmp_1_1_proxy_client_base.html#a6869135fcb798da5312514f9663bb2b0">m_client</a>(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(client)), <a class="code hl_variable" href="classmp_1_1_proxy_client_base.html#af910ca1c8fc9a191f85d16b71819c033">m_context</a>(connection)</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span> </div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>{</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>    <span class="comment">// Handler for the connection getting destroyed before this client object.</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>    <span class="keyword">auto</span> disconnect_cb = <a class="code hl_variable" href="classmp_1_1_proxy_client_base.html#af910ca1c8fc9a191f85d16b71819c033">m_context</a>.connection-&gt;addSyncCleanup([<span class="keyword">this</span>]() {</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>        <span class="comment">// Release client capability by move-assigning to temporary.</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>        {</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>            <span class="keyword">typename</span> Interface::Client(std::move(<a class="code hl_variable" href="classmp_1_1_proxy_client_base.html#a6869135fcb798da5312514f9663bb2b0">m_client</a>));</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>        }</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>        <a class="code hl_class" href="classmp_1_1_lock.html">Lock</a> lock{<a class="code hl_variable" href="classmp_1_1_proxy_client_base.html#af910ca1c8fc9a191f85d16b71819c033">m_context</a>.loop-&gt;m_mutex};</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>        <a class="code hl_variable" href="classmp_1_1_proxy_client_base.html#af910ca1c8fc9a191f85d16b71819c033">m_context</a>.connection = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>    });</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span> </div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>    <span class="comment">// Two shutdown sequences are supported:</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>    <span class="comment">//</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>    <span class="comment">// - A normal sequence where client proxy objects are deleted by external</span></div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>    <span class="comment">//   code that no longer needs them</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>    <span class="comment">//</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>    <span class="comment">// - A garbage collection sequence where the connection or event loop shuts</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>    <span class="comment">//   down while external code is still holding client references.</span></div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>    <span class="comment">//</span></div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>    <span class="comment">// The first case is handled here when m_context.connection is not null. The</span></div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>    <span class="comment">// second case is handled by the disconnect_cb function, which sets</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>    <span class="comment">// m_context.connection to null so nothing happens here.</span></div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    <a class="code hl_variable" href="classmp_1_1_proxy_client_base.html#af910ca1c8fc9a191f85d16b71819c033">m_context</a>.cleanup_fns.emplace_front([<span class="keyword">this</span>, destroy_connection, disconnect_cb]{</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>    {</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>        <span class="comment">// If the capnp interface defines a destroy method, call it to destroy</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>        <span class="comment">// the remote object, waiting for it to be deleted server side. If the</span></div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>        <span class="comment">// capnp interface does not define a destroy method, this will just call</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>        <span class="comment">// an empty stub defined in the ProxyClientBase class and do nothing.</span></div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>        Sub::destroy(*<span class="keyword">this</span>);</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span> </div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>        <span class="comment">// FIXME: Could just invoke removed addCleanup fn here instead of duplicating code</span></div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>        <a class="code hl_variable" href="classmp_1_1_proxy_client_base.html#af910ca1c8fc9a191f85d16b71819c033">m_context</a>.loop-&gt;sync([&amp;]() {</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>            <span class="comment">// Remove disconnect callback on cleanup so it doesn&#39;t run and try</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>            <span class="comment">// to access this object after it&#39;s destroyed. This call needs to</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>            <span class="comment">// run inside loop-&gt;sync() on the event loop thread because</span></div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>            <span class="comment">// otherwise, if there were an ill-timed disconnect, the</span></div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>            <span class="comment">// onDisconnect handler could fire and delete the Connection object</span></div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>            <span class="comment">// before the removeSyncCleanup call.</span></div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classmp_1_1_proxy_client_base.html#af910ca1c8fc9a191f85d16b71819c033">m_context</a>.connection) <a class="code hl_variable" href="classmp_1_1_proxy_client_base.html#af910ca1c8fc9a191f85d16b71819c033">m_context</a>.connection-&gt;removeSyncCleanup(disconnect_cb);</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span> </div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>            <span class="comment">// Release client capability by move-assigning to temporary.</span></div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>            {</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>                <span class="keyword">typename</span> Interface::Client(std::move(<a class="code hl_variable" href="classmp_1_1_proxy_client_base.html#a6869135fcb798da5312514f9663bb2b0">m_client</a>));</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>            }</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>            <span class="keywordflow">if</span> (destroy_connection) {</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>                <span class="keyword">delete</span> <a class="code hl_variable" href="classmp_1_1_proxy_client_base.html#af910ca1c8fc9a191f85d16b71819c033">m_context</a>.connection;</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>                <a class="code hl_variable" href="classmp_1_1_proxy_client_base.html#af910ca1c8fc9a191f85d16b71819c033">m_context</a>.connection = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>            }</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>        });</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>    }</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>    });</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>    Sub::construct(*<span class="keyword">this</span>);</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>}</div>
</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span> </div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Interface, <span class="keyword">typename</span> Impl&gt;</div>
<div class="foldopen" id="foldopen00514" data-start="{" data-end="}">
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno"><a class="line" href="classmp_1_1_proxy_client_base.html#a0f6d5e2adea8c123189c2f263d0153ee">  514</a></span><a class="code hl_function" href="classmp_1_1_proxy_client_base.html#a0f6d5e2adea8c123189c2f263d0153ee">ProxyClientBase&lt;Interface, Impl&gt;::~ProxyClientBase</a>() noexcept</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>{</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>    <a class="code hl_function" href="namespacemp.html#a6fbc82e48f1bf8f39a4635c31bece459">CleanupRun</a>(<a class="code hl_variable" href="classmp_1_1_proxy_client_base.html#af910ca1c8fc9a191f85d16b71819c033">m_context</a>.cleanup_fns);</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>}</div>
</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span> </div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Interface, <span class="keyword">typename</span> Impl&gt;</div>
<div class="foldopen" id="foldopen00520" data-start="{" data-end="}">
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno"><a class="line" href="structmp_1_1_proxy_server_base.html#afe79a96d9eb6ad4ff906a7f6a5b858b4">  520</a></span><a class="code hl_function" href="structmp_1_1_proxy_server_base.html#afe79a96d9eb6ad4ff906a7f6a5b858b4">ProxyServerBase&lt;Interface, Impl&gt;::ProxyServerBase</a>(std::shared_ptr&lt;Impl&gt; impl, <a class="code hl_class" href="classmp_1_1_connection.html">Connection</a>&amp; connection)</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>    : <a class="code hl_variable" href="structmp_1_1_proxy_server_base.html#a47b0d7e7413d0c7eb592ccf544a24f13">m_impl</a>(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(impl)), <a class="code hl_variable" href="structmp_1_1_proxy_server_base.html#af910ca1c8fc9a191f85d16b71819c033">m_context</a>(&amp;connection)</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>{</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>    <a class="code hl_function" href="validation_8cpp.html#afb7ea74ba028421697aa7f364741ee6c">assert</a>(<a class="code hl_variable" href="structmp_1_1_proxy_server_base.html#a47b0d7e7413d0c7eb592ccf544a24f13">m_impl</a>);</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>}</div>
</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Interface, <span class="keyword">typename</span> Impl&gt;</div>
<div class="foldopen" id="foldopen00539" data-start="{" data-end="}">
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno"><a class="line" href="structmp_1_1_proxy_server_base.html#a90a9c3ed54e1726a854d4fbf1eb1d379">  539</a></span><a class="code hl_function" href="structmp_1_1_proxy_server_base.html#a90a9c3ed54e1726a854d4fbf1eb1d379">ProxyServerBase&lt;Interface, Impl&gt;::~ProxyServerBase</a>()</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>{</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="structmp_1_1_proxy_server_base.html#a47b0d7e7413d0c7eb592ccf544a24f13">m_impl</a>) {</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>        <span class="comment">// If impl is non-null at this point, it means no client is waiting for</span></div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>        <span class="comment">// the m_impl server object to be destroyed synchronously. This can</span></div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>        <span class="comment">// happen either if the interface did not define a &quot;destroy&quot; method (see</span></div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>        <span class="comment">// invokeDestroy method below), or if a destroy method was defined, but</span></div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>        <span class="comment">// the connection was broken before it could be called.</span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>        <span class="comment">// In either case, be conservative and run the cleanup on an</span></div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>        <span class="comment">// asynchronous thread, to avoid destructors or cleanup functions</span></div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>        <span class="comment">// blocking or deadlocking the current EventLoop thread, since they</span></div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>        <span class="comment">// could be making IPC calls.</span></div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>        <span class="comment">// Technically this is a little too conservative since if the interface</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>        <span class="comment">// defines a &quot;destroy&quot; method, but the destroy method does not accept a</span></div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>        <span class="comment">// Context parameter specifying a worker thread, the cleanup method</span></div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>        <span class="comment">// would run on the EventLoop thread normally (when connection is</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>        <span class="comment">// unbroken), but will not run on the EventLoop thread now (when</span></div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>        <span class="comment">// connection is broken). Probably some refactoring of the destructor</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>        <span class="comment">// and invokeDestroy function is possible to make this cleaner and more</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>        <span class="comment">// consistent.</span></div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>        <a class="code hl_variable" href="structmp_1_1_proxy_server_base.html#af910ca1c8fc9a191f85d16b71819c033">m_context</a>.loop-&gt;addAsyncCleanup([impl=std::move(<a class="code hl_variable" href="structmp_1_1_proxy_server_base.html#a47b0d7e7413d0c7eb592ccf544a24f13">m_impl</a>), fns=std::move(<a class="code hl_variable" href="structmp_1_1_proxy_server_base.html#af910ca1c8fc9a191f85d16b71819c033">m_context</a>.cleanup_fns)]() <span class="keyword">mutable</span> {</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>            impl.reset();</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>            CleanupRun(fns);</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>        });</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>    }</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>    <a class="code hl_function" href="validation_8cpp.html#afb7ea74ba028421697aa7f364741ee6c">assert</a>(<a class="code hl_variable" href="structmp_1_1_proxy_server_base.html#af910ca1c8fc9a191f85d16b71819c033">m_context</a>.cleanup_fns.empty());</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>}</div>
</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span></div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Interface, <span class="keyword">typename</span> Impl&gt;</div>
<div class="foldopen" id="foldopen00587" data-start="{" data-end="}">
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno"><a class="line" href="structmp_1_1_proxy_server_base.html#a337a3c890fad394953330b47eb4aafb2">  587</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="structmp_1_1_proxy_server_base.html#a337a3c890fad394953330b47eb4aafb2">ProxyServerBase&lt;Interface, Impl&gt;::invokeDestroy</a>()</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>{</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>    <a class="code hl_variable" href="structmp_1_1_proxy_server_base.html#a47b0d7e7413d0c7eb592ccf544a24f13">m_impl</a>.reset();</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>    <a class="code hl_function" href="namespacemp.html#a6fbc82e48f1bf8f39a4635c31bece459">CleanupRun</a>(<a class="code hl_variable" href="structmp_1_1_proxy_server_base.html#af910ca1c8fc9a191f85d16b71819c033">m_context</a>.cleanup_fns);</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>}</div>
</div>
</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span></div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno"><a class="line" href="namespacemp.html#a5176f804f9aaad2c96c46ac53c5bd28b">  599</a></span><span class="keyword">using </span><a class="code hl_typedef" href="namespacemp.html#a5176f804f9aaad2c96c46ac53c5bd28b">ConnThreads</a> = std::map&lt;Connection*, std::optional&lt;ProxyClient&lt;Thread&gt;&gt;&gt;;</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno"><a class="line" href="namespacemp.html#a4c23514105673e30f7c1f46afc594ece">  600</a></span><span class="keyword">using </span><a class="code hl_typedef" href="namespacemp.html#a4c23514105673e30f7c1f46afc594ece">ConnThread</a> = ConnThreads::iterator;</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span> </div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span><span class="comment">// Retrieve ProxyClient&lt;Thread&gt; object associated with this connection from a</span></div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span><span class="comment">// map, or create a new one and insert it into the map. Return map iterator and</span></div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span><span class="comment">// inserted bool.</span></div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>std::tuple&lt;ConnThread, bool&gt; <a class="code hl_function" href="namespacemp.html#a48933e17f4fac720326ae1737bf53764">SetThread</a>(<a class="code hl_struct" href="structmp_1_1_guarded_ref.html">GuardedRef&lt;ConnThreads&gt;</a> threads, <a class="code hl_class" href="classmp_1_1_connection.html">Connection</a>* connection, <span class="keyword">const</span> std::function&lt;Thread::Client()&gt;&amp; make_thread);</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span></div>
<div class="foldopen" id="foldopen00620" data-start="{" data-end="};">
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno"><a class="line" href="structmp_1_1_thread_context.html">  620</a></span><span class="keyword">struct </span><a class="code hl_struct" href="structmp_1_1_thread_context.html">ThreadContext</a></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>{</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno"><a class="line" href="structmp_1_1_thread_context.html#af22159ec9e33831372abc5e43e4944f9">  623</a></span>    std::string <a class="code hl_variable" href="structmp_1_1_thread_context.html#af22159ec9e33831372abc5e43e4944f9">thread_name</a>;</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span></div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno"><a class="line" href="structmp_1_1_thread_context.html#ab283ccca525d24f19bd1860fa2836783">  640</a></span>    std::unique_ptr&lt;Waiter&gt; <a class="code hl_variable" href="structmp_1_1_thread_context.html#ab283ccca525d24f19bd1860fa2836783">waiter</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span></div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno"><a class="line" href="structmp_1_1_thread_context.html#a9c938bed0c537f793043396cf41dfeab">  659</a></span>    <a class="code hl_typedef" href="namespacemp.html#a5176f804f9aaad2c96c46ac53c5bd28b">ConnThreads</a> callback_threads <a class="code hl_function" href="structmp_1_1_thread_context.html#a9c938bed0c537f793043396cf41dfeab">MP_GUARDED_BY</a>(<a class="code hl_variable" href="structmp_1_1_thread_context.html#ab283ccca525d24f19bd1860fa2836783">waiter</a>-&gt;m_mutex);</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span></div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno"><a class="line" href="structmp_1_1_thread_context.html#ad7d4449836b9c614cb977a93f75c4290">  670</a></span>    <a class="code hl_typedef" href="namespacemp.html#a5176f804f9aaad2c96c46ac53c5bd28b">ConnThreads</a> request_threads <a class="code hl_function" href="structmp_1_1_thread_context.html#ad7d4449836b9c614cb977a93f75c4290">MP_GUARDED_BY</a>(<a class="code hl_variable" href="structmp_1_1_thread_context.html#ab283ccca525d24f19bd1860fa2836783">waiter</a>-&gt;m_mutex);</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span></div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno"><a class="line" href="structmp_1_1_thread_context.html#a370e26772b89031ea6428652997e3c91">  675</a></span>    <span class="keywordtype">bool</span> <a class="code hl_variable" href="structmp_1_1_thread_context.html#a370e26772b89031ea6428652997e3c91">loop_thread</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>};</div>
</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span></div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> InitInterface&gt;</div>
<div class="foldopen" id="foldopen00682" data-start="{" data-end="}">
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno"><a class="line" href="namespacemp.html#a05705160ee9ed1819a6f59fdb8bd9fb1">  682</a></span>std::unique_ptr&lt;ProxyClient&lt;InitInterface&gt;&gt; <a class="code hl_function" href="namespacemp.html#a05705160ee9ed1819a6f59fdb8bd9fb1">ConnectStream</a>(<a class="code hl_class" href="classmp_1_1_event_loop.html">EventLoop</a>&amp; loop, <span class="keywordtype">int</span> fd)</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>{</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>    <span class="keyword">typename</span> InitInterface::Client init_client(<span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>    std::unique_ptr&lt;Connection&gt; connection;</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>    loop.<a class="code hl_function" href="classmp_1_1_event_loop.html#ad322c973d237a8efe56f3c4ffbb3cb0c">sync</a>([&amp;] {</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>        <span class="keyword">auto</span> stream =</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>            loop.<a class="code hl_variable" href="classmp_1_1_event_loop.html#ae9ed3a7b20562f71d91760034e7100f1">m_io_context</a>.lowLevelProvider-&gt;wrapSocketFd(fd, kj::LowLevelAsyncIoProvider::TAKE_OWNERSHIP);</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>        connection = std::make_unique&lt;Connection&gt;(loop, kj::mv(stream));</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>        init_client = connection-&gt;m_rpc_system-&gt;bootstrap(<a class="code hl_struct" href="structmp_1_1_server_vat_id.html">ServerVatId</a>().vat_id).castAs&lt;InitInterface&gt;();</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>        <a class="code hl_class" href="classmp_1_1_connection.html">Connection</a>* connection_ptr = connection.get();</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>        connection-&gt;<a class="code hl_function" href="classmp_1_1_connection.html#ad80dba71352898ebf4e8f88028ddc7e1">onDisconnect</a>([&amp;loop, connection_ptr] {</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>            <a class="code hl_define" href="proxy-io_8h.html#aa6fc2a55e5127fdfee52af8eda04d5d5">MP_LOG</a>(loop, <a class="code hl_enumvalue" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304a0eaadb4fcb48a0a0ed7bc9868be9fbaa">Log::Warning</a>) &lt;&lt; <span class="stringliteral">&quot;IPC client: unexpected network disconnect.&quot;</span>;</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>            <span class="keyword">delete</span> connection_ptr;</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>        });</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>    });</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>    <span class="keywordflow">return</span> std::make_unique&lt;ProxyClient&lt;InitInterface&gt;&gt;(</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>        kj::mv(init_client), connection.release(), <span class="comment">/* destroy_connection= */</span> <span class="keyword">true</span>);</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>}</div>
</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span></div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> InitInterface, <span class="keyword">typename</span> InitImpl&gt;</div>
<div class="foldopen" id="foldopen00706" data-start="{" data-end="}">
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno"><a class="line" href="namespacemp.html#ae822a91aab465661b35be2e1d348cf11">  706</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespacemp.html#ae822a91aab465661b35be2e1d348cf11">_Serve</a>(<a class="code hl_class" href="classmp_1_1_event_loop.html">EventLoop</a>&amp; loop, kj::Own&lt;kj::AsyncIoStream&gt;&amp;&amp; stream, <a class="code hl_class" href="class_init_impl.html">InitImpl</a>&amp; <a class="code hl_namespace" href="namespaceinit.html">init</a>)</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>{</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>    loop.<a class="code hl_variable" href="classmp_1_1_event_loop.html#ace117e2546e02ad25eb0044315aa4ac9">m_incoming_connections</a>.emplace_front(loop, kj::mv(stream), [&amp;](<a class="code hl_class" href="classmp_1_1_connection.html">Connection</a>&amp; connection) {</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>        <span class="comment">// Disable deleter so proxy server object doesn&#39;t attempt to delete the</span></div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>        <span class="comment">// init implementation when the proxy client is destroyed or</span></div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>        <span class="comment">// disconnected.</span></div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>        <span class="keywordflow">return</span> kj::heap&lt;ProxyServer&lt;InitInterface&gt;&gt;(std::shared_ptr&lt;InitImpl&gt;(&amp;<a class="code hl_namespace" href="namespaceinit.html">init</a>, [](<a class="code hl_class" href="class_init_impl.html">InitImpl</a>*){}), connection);</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>    });</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>    <span class="keyword">auto</span> it = loop.<a class="code hl_variable" href="classmp_1_1_event_loop.html#ace117e2546e02ad25eb0044315aa4ac9">m_incoming_connections</a>.begin();</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>    it-&gt;onDisconnect([&amp;loop, it] {</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>        <a class="code hl_define" href="proxy-io_8h.html#aa6fc2a55e5127fdfee52af8eda04d5d5">MP_LOG</a>(loop, <a class="code hl_enumvalue" href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304a4059b0251f66a18cb56f544728796875">Log::Info</a>) &lt;&lt; <span class="stringliteral">&quot;IPC server: socket disconnected.&quot;</span>;</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>        loop.<a class="code hl_variable" href="classmp_1_1_event_loop.html#ace117e2546e02ad25eb0044315aa4ac9">m_incoming_connections</a>.erase(it);</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>    });</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>}</div>
</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span></div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> InitInterface, <span class="keyword">typename</span> InitImpl&gt;</div>
<div class="foldopen" id="foldopen00725" data-start="{" data-end="}">
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno"><a class="line" href="namespacemp.html#a9589786aff435d101ca76ab5233f5970">  725</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespacemp.html#a9589786aff435d101ca76ab5233f5970">_Listen</a>(<a class="code hl_class" href="classmp_1_1_event_loop.html">EventLoop</a>&amp; loop, kj::Own&lt;kj::ConnectionReceiver&gt;&amp;&amp; listener, <a class="code hl_class" href="class_init_impl.html">InitImpl</a>&amp; <a class="code hl_namespace" href="namespaceinit.html">init</a>)</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>{</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>    <span class="keyword">auto</span>* ptr = listener.get();</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>    loop.<a class="code hl_variable" href="classmp_1_1_event_loop.html#a4867e4e832e2d05e777ed32a795214ad">m_task_set</a>-&gt;add(ptr-&gt;accept().then(</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>        [&amp;loop, &amp;<a class="code hl_namespace" href="namespaceinit.html">init</a>, listener = kj::mv(listener)](kj::Own&lt;kj::AsyncIoStream&gt;&amp;&amp; stream) <span class="keyword">mutable</span> {</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>            _Serve&lt;InitInterface&gt;(loop, kj::mv(stream), init);</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>            _Listen&lt;InitInterface&gt;(loop, kj::mv(listener), init);</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>        }));</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>}</div>
</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span></div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> InitInterface, <span class="keyword">typename</span> InitImpl&gt;</div>
<div class="foldopen" id="foldopen00738" data-start="{" data-end="}">
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno"><a class="line" href="namespacemp.html#a4bf39784f1a721e61fb9da94711ba444">  738</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespacemp.html#a4bf39784f1a721e61fb9da94711ba444">ServeStream</a>(<a class="code hl_class" href="classmp_1_1_event_loop.html">EventLoop</a>&amp; loop, <span class="keywordtype">int</span> fd, <a class="code hl_class" href="class_init_impl.html">InitImpl</a>&amp; <a class="code hl_namespace" href="namespaceinit.html">init</a>)</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>{</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>    <a class="code hl_function" href="namespacemp.html#ae822a91aab465661b35be2e1d348cf11">_Serve&lt;InitInterface&gt;</a>(</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>        loop, loop.<a class="code hl_variable" href="classmp_1_1_event_loop.html#ae9ed3a7b20562f71d91760034e7100f1">m_io_context</a>.lowLevelProvider-&gt;wrapSocketFd(fd, kj::LowLevelAsyncIoProvider::TAKE_OWNERSHIP), <a class="code hl_namespace" href="namespaceinit.html">init</a>);</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>}</div>
</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span></div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> InitInterface, <span class="keyword">typename</span> InitImpl&gt;</div>
<div class="foldopen" id="foldopen00747" data-start="{" data-end="}">
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno"><a class="line" href="namespacemp.html#ac32d169bba43387dec219a91d4539435">  747</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespacemp.html#ac32d169bba43387dec219a91d4539435">ListenConnections</a>(<a class="code hl_class" href="classmp_1_1_event_loop.html">EventLoop</a>&amp; loop, <span class="keywordtype">int</span> fd, <a class="code hl_class" href="class_init_impl.html">InitImpl</a>&amp; <a class="code hl_namespace" href="namespaceinit.html">init</a>)</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>{</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>    loop.<a class="code hl_function" href="classmp_1_1_event_loop.html#ad322c973d237a8efe56f3c4ffbb3cb0c">sync</a>([&amp;]() {</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>        <a class="code hl_function" href="namespacemp.html#a9589786aff435d101ca76ab5233f5970">_Listen&lt;InitInterface&gt;</a>(loop,</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>            loop.<a class="code hl_variable" href="classmp_1_1_event_loop.html#ae9ed3a7b20562f71d91760034e7100f1">m_io_context</a>.lowLevelProvider-&gt;wrapListenSocketFd(fd, kj::LowLevelAsyncIoProvider::TAKE_OWNERSHIP),</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>            <a class="code hl_namespace" href="namespaceinit.html">init</a>);</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>    });</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>}</div>
</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span> </div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span><span class="keyword">extern</span> <span class="keyword">thread_local</span> ThreadContext <a class="code hl_variable" href="namespacemp.html#a6779c2c807b5c6d842e8743aa4a1a0b2">g_thread_context</a>; <span class="comment">// NOLINT(bitcoin-nontrivial-threadlocal)</span></div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span><span class="comment">// Silence nonstandard bitcoin tidy error &quot;Variable with non-trivial destructor</span></div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span><span class="comment">// cannot be thread_local&quot; which should not be a problem on modern platforms, and</span></div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span><span class="comment">// could lead to a small memory leak at worst on older ones.</span></div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span> </div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>} <span class="comment">// namespace mp</span></div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span> </div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span><span class="preprocessor">#endif </span><span class="comment">// MP_PROXY_IO_H</span></div>
</div>
</div>
</div>
</div>
</div>
<div class="ttc" id="abitcoin-tx_8cpp_html_ac8bf36fe0577cba66bccda3a6f7e80a4"><div class="ttname"><a href="bitcoin-tx_8cpp.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a></div><div class="ttdeci">int flags</div><div class="ttdef"><b>Definition</b> bitcoin-tx.cpp:529</div></div>
<div class="ttc" id="aclass_init_impl_html"><div class="ttname"><a href="class_init_impl.html">InitImpl</a></div><div class="ttdef"><b>Definition</b> calculator.cpp:33</div></div>
<div class="ttc" id="aclassmp_1_1_connection_html"><div class="ttname"><a href="classmp_1_1_connection.html">mp::Connection</a></div><div class="ttdef"><b>Definition</b> proxy-io.h:377</div></div>
<div class="ttc" id="aclassmp_1_1_connection_html_a1008c41395d28e937364a9806754856c"><div class="ttname"><a href="classmp_1_1_connection.html#a1008c41395d28e937364a9806754856c">mp::Connection::m_threads</a></div><div class="ttdeci">::capnp::CapabilityServerSet&lt; Thread &gt; m_threads</div><div class="ttdef"><b>Definition</b> proxy-io.h:429</div></div>
<div class="ttc" id="aclassmp_1_1_connection_html_a20da0cbcf16fc5a09b87c061496cb1b1"><div class="ttname"><a href="classmp_1_1_connection.html#a20da0cbcf16fc5a09b87c061496cb1b1">mp::Connection::m_on_disconnect</a></div><div class="ttdeci">kj::TaskSet m_on_disconnect</div><div class="ttdef"><b>Definition</b> proxy-io.h:419</div></div>
<div class="ttc" id="aclassmp_1_1_connection_html_a37b5b5040fdf06491742db64e929dbeb"><div class="ttname"><a href="classmp_1_1_connection.html#a37b5b5040fdf06491742db64e929dbeb">mp::Connection::m_loop</a></div><div class="ttdeci">EventLoopRef m_loop</div><div class="ttdef"><b>Definition</b> proxy-io.h:416</div></div>
<div class="ttc" id="aclassmp_1_1_connection_html_a54d27701ff67ea0db8ae9e852c274d30"><div class="ttname"><a href="classmp_1_1_connection.html#a54d27701ff67ea0db8ae9e852c274d30">mp::Connection::m_network</a></div><div class="ttdeci">::capnp::TwoPartyVatNetwork m_network</div><div class="ttdef"><b>Definition</b> proxy-io.h:420</div></div>
<div class="ttc" id="aclassmp_1_1_connection_html_a5f5fe74aee9f84ce7c92450be96dc090"><div class="ttname"><a href="classmp_1_1_connection.html#a5f5fe74aee9f84ce7c92450be96dc090">mp::Connection::Connection</a></div><div class="ttdeci">Connection(EventLoop &amp;loop, kj::Own&lt; kj::AsyncIoStream &gt; &amp;&amp;stream_, const std::function&lt;::capnp::Capability::Client(Connection &amp;)&gt; &amp;make_client)</div><div class="ttdef"><b>Definition</b> proxy-io.h:383</div></div>
<div class="ttc" id="aclassmp_1_1_connection_html_a67cb43da9e4f67dbc9d6a74a3c301a0e"><div class="ttname"><a href="classmp_1_1_connection.html#a67cb43da9e4f67dbc9d6a74a3c301a0e">mp::Connection::m_rpc_system</a></div><div class="ttdeci">std::optional&lt;::capnp::RpcSystem&lt;::capnp::rpc::twoparty::VatId &gt; &gt; m_rpc_system</div><div class="ttdef"><b>Definition</b> proxy-io.h:421</div></div>
<div class="ttc" id="aclassmp_1_1_connection_html_a826fdcefcc3eae8215a8b1d8628892bc"><div class="ttname"><a href="classmp_1_1_connection.html#a826fdcefcc3eae8215a8b1d8628892bc">mp::Connection::m_stream</a></div><div class="ttdeci">kj::Own&lt; kj::AsyncIoStream &gt; m_stream</div><div class="ttdef"><b>Definition</b> proxy-io.h:417</div></div>
<div class="ttc" id="aclassmp_1_1_connection_html_aa3a0b29328e0fc0ec8b26132feb0fcc5"><div class="ttname"><a href="classmp_1_1_connection.html#aa3a0b29328e0fc0ec8b26132feb0fcc5">mp::Connection::m_error_handler</a></div><div class="ttdeci">LoggingErrorHandler m_error_handler</div><div class="ttdef"><b>Definition</b> proxy-io.h:418</div></div>
<div class="ttc" id="aclassmp_1_1_connection_html_aa8499cb4f42a4f1fb12b46a450bfc951"><div class="ttname"><a href="classmp_1_1_connection.html#aa8499cb4f42a4f1fb12b46a450bfc951">mp::Connection::m_thread_map</a></div><div class="ttdeci">ThreadMap::Client m_thread_map</div><div class="ttdef"><b>Definition</b> proxy-io.h:425</div></div>
<div class="ttc" id="aclassmp_1_1_connection_html_ad80dba71352898ebf4e8f88028ddc7e1"><div class="ttname"><a href="classmp_1_1_connection.html#ad80dba71352898ebf4e8f88028ddc7e1">mp::Connection::onDisconnect</a></div><div class="ttdeci">void onDisconnect(F &amp;&amp;f)</div><div class="ttdoc">Add disconnect handler.</div><div class="ttdef"><b>Definition</b> proxy-io.h:405</div></div>
<div class="ttc" id="aclassmp_1_1_connection_html_ae364219e4df65bbd818bcfada34e4311"><div class="ttname"><a href="classmp_1_1_connection.html#ae364219e4df65bbd818bcfada34e4311">mp::Connection::m_sync_cleanup_fns</a></div><div class="ttdeci">CleanupList m_sync_cleanup_fns</div><div class="ttdef"><b>Definition</b> proxy-io.h:434</div></div>
<div class="ttc" id="aclassmp_1_1_connection_html_af29bbec879064beec9441a1078bddec3"><div class="ttname"><a href="classmp_1_1_connection.html#af29bbec879064beec9441a1078bddec3">mp::Connection::Connection</a></div><div class="ttdeci">Connection(EventLoop &amp;loop, kj::Own&lt; kj::AsyncIoStream &gt; &amp;&amp;stream_)</div><div class="ttdef"><b>Definition</b> proxy-io.h:379</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html"><div class="ttname"><a href="classmp_1_1_event_loop.html">mp::EventLoop</a></div><div class="ttdef"><b>Definition</b> proxy-io.h:214</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_a18e06ab543770b1d48dd06243faa75eb"><div class="ttname"><a href="classmp_1_1_event_loop.html#a18e06ab543770b1d48dd06243faa75eb">mp::EventLoop::MP_GUARDED_BY</a></div><div class="ttdeci">kj::Function&lt; void()&gt; *m_post_fn MP_GUARDED_BY(m_mutex)</div><div class="ttdoc">Callback function to run on event loop thread during post() or sync() call.</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_a2a779802443c51d72db5bd158c31c964"><div class="ttname"><a href="classmp_1_1_event_loop.html#a2a779802443c51d72db5bd158c31c964">mp::EventLoop::m_exe_name</a></div><div class="ttdeci">const char * m_exe_name</div><div class="ttdef"><b>Definition</b> proxy-io.h:271</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_a4867e4e832e2d05e777ed32a795214ad"><div class="ttname"><a href="classmp_1_1_event_loop.html#a4867e4e832e2d05e777ed32a795214ad">mp::EventLoop::m_task_set</a></div><div class="ttdeci">std::unique_ptr&lt; kj::TaskSet &gt; m_task_set</div><div class="ttdoc">Capnp list of pending promises.</div><div class="ttdef"><b>Definition</b> proxy-io.h:308</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_a4e6f3fba72d4c182f3e7474a2fd76667"><div class="ttname"><a href="classmp_1_1_event_loop.html#a4e6f3fba72d4c182f3e7474a2fd76667">mp::EventLoop::post</a></div><div class="ttdeci">void post(kj::Function&lt; void()&gt; fn)</div><div class="ttdef"><b>Definition</b> proxy.cpp:267</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_a59f59d4a0735009e1d98f835eeccdb87"><div class="ttname"><a href="classmp_1_1_event_loop.html#a59f59d4a0735009e1d98f835eeccdb87">mp::EventLoop::m_post_fd</a></div><div class="ttdeci">int m_post_fd</div><div class="ttdoc">Pipe write handle used to wake up the event loop thread.</div><div class="ttdef"><b>Definition</b> proxy-io.h:290</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_a5ca6d7b6e9cca718db8c78de06dde777"><div class="ttname"><a href="classmp_1_1_event_loop.html#a5ca6d7b6e9cca718db8c78de06dde777">mp::EventLoop::m_wait_fd</a></div><div class="ttdeci">int m_wait_fd</div><div class="ttdoc">Pipe read handle used to wake up the event loop thread.</div><div class="ttdef"><b>Definition</b> proxy-io.h:287</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_a71aaf23d91d7b7a5611738c4f06e3577"><div class="ttname"><a href="classmp_1_1_event_loop.html#a71aaf23d91d7b7a5611738c4f06e3577">mp::EventLoop::m_mutex</a></div><div class="ttdeci">Mutex m_mutex</div><div class="ttdef"><b>Definition</b> proxy-io.h:298</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_a7ff706a17a3571c9b28db11e81dc7585"><div class="ttname"><a href="classmp_1_1_event_loop.html#a7ff706a17a3571c9b28db11e81dc7585">mp::EventLoop::m_async_thread</a></div><div class="ttdeci">std::thread m_async_thread</div><div class="ttdef"><b>Definition</b> proxy-io.h:278</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_a92efa486d18e81bd893ff18bc8a22926"><div class="ttname"><a href="classmp_1_1_event_loop.html#a92efa486d18e81bd893ff18bc8a22926">mp::EventLoop::m_context</a></div><div class="ttdeci">void * m_context</div><div class="ttdoc">External context pointer.</div><div class="ttdef"><b>Definition</b> proxy-io.h:317</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_a97dc677b923c4253bb089b99a4e24e4c"><div class="ttname"><a href="classmp_1_1_event_loop.html#a97dc677b923c4253bb089b99a4e24e4c">mp::EventLoop::EventLoop</a></div><div class="ttdeci">EventLoop(const char *exe_name, std::function&lt; void(bool, std::string)&gt; old_callback, void *context=nullptr)</div><div class="ttdoc">Backwards-compatible constructor for previous (deprecated) logging callback signature.</div><div class="ttdef"><b>Definition</b> proxy-io.h:224</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_aa3a0b29328e0fc0ec8b26132feb0fcc5"><div class="ttname"><a href="classmp_1_1_event_loop.html#aa3a0b29328e0fc0ec8b26132feb0fcc5">mp::EventLoop::m_error_handler</a></div><div class="ttdeci">LoggingErrorHandler m_error_handler</div><div class="ttdoc">Capnp error handler. Needs to outlive m_task_set.</div><div class="ttdef"><b>Definition</b> proxy-io.h:305</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_aaee8fe6bf715daa70d55a732218dcfe5"><div class="ttname"><a href="classmp_1_1_event_loop.html#aaee8fe6bf715daa70d55a732218dcfe5">mp::EventLoop::m_thread_id</a></div><div class="ttdeci">std::thread::id m_thread_id</div><div class="ttdoc">ID of the event loop thread.</div><div class="ttdef"><b>Definition</b> proxy-io.h:274</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_ab1f44d16de891fa65b054ee4ead90294"><div class="ttname"><a href="classmp_1_1_event_loop.html#ab1f44d16de891fa65b054ee4ead90294">mp::EventLoop::m_log_opts</a></div><div class="ttdeci">LogOptions m_log_opts</div><div class="ttdoc">Logging options.</div><div class="ttdef"><b>Definition</b> proxy-io.h:314</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_accca0ab294feb9061406ae9c73a3ceb5"><div class="ttname"><a href="classmp_1_1_event_loop.html#accca0ab294feb9061406ae9c73a3ceb5">mp::EventLoop::m_cv</a></div><div class="ttdeci">std::condition_variable m_cv</div><div class="ttdef"><b>Definition</b> proxy-io.h:299</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_ace117e2546e02ad25eb0044315aa4ac9"><div class="ttname"><a href="classmp_1_1_event_loop.html#ace117e2546e02ad25eb0044315aa4ac9">mp::EventLoop::m_incoming_connections</a></div><div class="ttdeci">std::list&lt; Connection &gt; m_incoming_connections</div><div class="ttdoc">List of connections.</div><div class="ttdef"><b>Definition</b> proxy-io.h:311</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_ad322c973d237a8efe56f3c4ffbb3cb0c"><div class="ttname"><a href="classmp_1_1_event_loop.html#ad322c973d237a8efe56f3c4ffbb3cb0c">mp::EventLoop::sync</a></div><div class="ttdeci">void sync(Callable &amp;&amp;callable)</div><div class="ttdef"><b>Definition</b> proxy-io.h:244</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_ae9ed3a7b20562f71d91760034e7100f1"><div class="ttname"><a href="classmp_1_1_event_loop.html#ae9ed3a7b20562f71d91760034e7100f1">mp::EventLoop::m_io_context</a></div><div class="ttdeci">kj::AsyncIoContext m_io_context</div><div class="ttdoc">Capnp IO context.</div><div class="ttdef"><b>Definition</b> proxy-io.h:302</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_html_af4e2d623f57fae116fc13c423109871b"><div class="ttname"><a href="classmp_1_1_event_loop.html#af4e2d623f57fae116fc13c423109871b">mp::EventLoop::EventLoop</a></div><div class="ttdeci">EventLoop(const char *exe_name, LogFn log_fn, void *context=nullptr)</div><div class="ttdoc">Construct event loop object with default logging options.</div><div class="ttdef"><b>Definition</b> proxy-io.h:217</div></div>
<div class="ttc" id="aclassmp_1_1_event_loop_ref_html"><div class="ttname"><a href="classmp_1_1_event_loop_ref.html">mp::EventLoopRef</a></div><div class="ttdef"><b>Definition</b> proxy.h:51</div></div>
<div class="ttc" id="aclassmp_1_1_lock_html"><div class="ttname"><a href="classmp_1_1_lock.html">mp::Lock</a></div><div class="ttdef"><b>Definition</b> util.h:170</div></div>
<div class="ttc" id="aclassmp_1_1_lock_html_a8d50677be62dfbfcea4da54095b81c86"><div class="ttname"><a href="classmp_1_1_lock.html#a8d50677be62dfbfcea4da54095b81c86">mp::Lock::m_lock</a></div><div class="ttdeci">std::unique_lock&lt; std::mutex &gt; m_lock</div><div class="ttdef"><b>Definition</b> util.h:182</div></div>
<div class="ttc" id="aclassmp_1_1_logger_html_a1496956d4b3865115cc0f2227f608659"><div class="ttname"><a href="classmp_1_1_logger.html#a1496956d4b3865115cc0f2227f608659">mp::Logger::operator&lt;&lt;</a></div><div class="ttdeci">friend Logger &amp; operator&lt;&lt;(Logger &amp;logger, T &amp;&amp;value)</div><div class="ttdef"><b>Definition</b> proxy-io.h:154</div></div>
<div class="ttc" id="aclassmp_1_1_logger_html_aa0559f968425197d1bf676ecc6bc9a15"><div class="ttname"><a href="classmp_1_1_logger.html#aa0559f968425197d1bf676ecc6bc9a15">mp::Logger::operator=</a></div><div class="ttdeci">Logger &amp; operator=(Logger &amp;&amp;)=delete</div></div>
<div class="ttc" id="aclassmp_1_1_logger_html_aa7f3dbfbd2426b4874750f08bd23bd7f"><div class="ttname"><a href="classmp_1_1_logger.html#aa7f3dbfbd2426b4874750f08bd23bd7f">mp::Logger::Logger</a></div><div class="ttdeci">Logger(const Logger &amp;)=delete</div></div>
<div class="ttc" id="aclassmp_1_1_logger_html_aaf19334937476d1921ee36e3ffa97b05"><div class="ttname"><a href="classmp_1_1_logger.html#aaf19334937476d1921ee36e3ffa97b05">mp::Logger::operator=</a></div><div class="ttdeci">Logger &amp; operator=(const Logger &amp;)=delete</div></div>
<div class="ttc" id="aclassmp_1_1_logger_html_ad215e4730d59a458a24e72cea5e79e65"><div class="ttname"><a href="classmp_1_1_logger.html#ad215e4730d59a458a24e72cea5e79e65">mp::Logger::Logger</a></div><div class="ttdeci">Logger(const LogOptions &amp;options, Log log_level)</div><div class="ttdef"><b>Definition</b> proxy-io.h:141</div></div>
<div class="ttc" id="aclassmp_1_1_logger_html_addb6e5d2a9bcd73e31598fc028806081"><div class="ttname"><a href="classmp_1_1_logger.html#addb6e5d2a9bcd73e31598fc028806081">mp::Logger::operator&lt;&lt;</a></div><div class="ttdeci">friend Logger &amp; operator&lt;&lt;(Logger &amp;&amp;logger, T &amp;&amp;value)</div><div class="ttdef"><b>Definition</b> proxy-io.h:161</div></div>
<div class="ttc" id="aclassmp_1_1_logger_html_ae3331f55a1545677909fd95f8c9128fe"><div class="ttname"><a href="classmp_1_1_logger.html#ae3331f55a1545677909fd95f8c9128fe">mp::Logger::~Logger</a></div><div class="ttdeci">~Logger() noexcept(false)</div><div class="ttdef"><b>Definition</b> proxy-io.h:148</div></div>
<div class="ttc" id="aclassmp_1_1_logger_html_aeae30a1ace0ff0abecc2750ad1f20e7f"><div class="ttname"><a href="classmp_1_1_logger.html#aeae30a1ace0ff0abecc2750ad1f20e7f">mp::Logger::Logger</a></div><div class="ttdeci">Logger(Logger &amp;&amp;)=delete</div></div>
<div class="ttc" id="aclassmp_1_1_logging_error_handler_html"><div class="ttname"><a href="classmp_1_1_logging_error_handler.html">mp::LoggingErrorHandler</a></div><div class="ttdoc">Handler for kj::TaskSet failed task events.</div><div class="ttdef"><b>Definition</b> proxy-io.h:94</div></div>
<div class="ttc" id="aclassmp_1_1_logging_error_handler_html_a20511778fdeab09ac2e62cb4d094a735"><div class="ttname"><a href="classmp_1_1_logging_error_handler.html#a20511778fdeab09ac2e62cb4d094a735">mp::LoggingErrorHandler::taskFailed</a></div><div class="ttdeci">void taskFailed(kj::Exception &amp;&amp;exception) override</div><div class="ttdef"><b>Definition</b> proxy.cpp:43</div></div>
<div class="ttc" id="aclassmp_1_1_logging_error_handler_html_a7edb956d52fd0b9350e88355ace252a2"><div class="ttname"><a href="classmp_1_1_logging_error_handler.html#a7edb956d52fd0b9350e88355ace252a2">mp::LoggingErrorHandler::LoggingErrorHandler</a></div><div class="ttdeci">LoggingErrorHandler(EventLoop &amp;loop)</div><div class="ttdef"><b>Definition</b> proxy-io.h:96</div></div>
<div class="ttc" id="aclassmp_1_1_logging_error_handler_html_ab44a0e9ab8c63995c52b47ad4041aaf5"><div class="ttname"><a href="classmp_1_1_logging_error_handler.html#ab44a0e9ab8c63995c52b47ad4041aaf5">mp::LoggingErrorHandler::m_loop</a></div><div class="ttdeci">EventLoop &amp; m_loop</div><div class="ttdef"><b>Definition</b> proxy-io.h:98</div></div>
<div class="ttc" id="aclassmp_1_1_proxy_client_base_html_a0f6d5e2adea8c123189c2f263d0153ee"><div class="ttname"><a href="classmp_1_1_proxy_client_base.html#a0f6d5e2adea8c123189c2f263d0153ee">mp::ProxyClientBase::~ProxyClientBase</a></div><div class="ttdeci">~ProxyClientBase() noexcept</div><div class="ttdef"><b>Definition</b> proxy-io.h:514</div></div>
<div class="ttc" id="aclassmp_1_1_proxy_client_base_html_a32f6c2ed2bf7fd1668e2d5c3e5256682"><div class="ttname"><a href="classmp_1_1_proxy_client_base.html#a32f6c2ed2bf7fd1668e2d5c3e5256682">mp::ProxyClientBase::ProxyClientBase</a></div><div class="ttdeci">ProxyClientBase(typename Interface::Client client, Connection *connection, bool destroy_connection)</div><div class="ttdef"><b>Definition</b> proxy-io.h:454</div></div>
<div class="ttc" id="aclassmp_1_1_proxy_client_base_html_a6869135fcb798da5312514f9663bb2b0"><div class="ttname"><a href="classmp_1_1_proxy_client_base.html#a6869135fcb798da5312514f9663bb2b0">mp::ProxyClientBase::m_client</a></div><div class="ttdeci">Interface::Client m_client</div><div class="ttdef"><b>Definition</b> proxy.h:132</div></div>
<div class="ttc" id="aclassmp_1_1_proxy_client_base_html_af910ca1c8fc9a191f85d16b71819c033"><div class="ttname"><a href="classmp_1_1_proxy_client_base.html#af910ca1c8fc9a191f85d16b71819c033">mp::ProxyClientBase::m_context</a></div><div class="ttdeci">ProxyContext m_context</div><div class="ttdef"><b>Definition</b> proxy.h:133</div></div>
<div class="ttc" id="ahash__tests_8cpp_html_ad4971a985148c784a362f962d42aa012"><div class="ttname"><a href="hash__tests_8cpp.html#ad4971a985148c784a362f962d42aa012">T</a></div><div class="ttdeci">#define T(expected, seed, data)</div></div>
<div class="ttc" id="aipc_2libmultiprocess_2include_2mp_2util_8h_html"><div class="ttname"><a href="ipc_2libmultiprocess_2include_2mp_2util_8h.html">util.h</a></div></div>
<div class="ttc" id="aipc_2libmultiprocess_2include_2mp_2util_8h_html_a6b530c2b9c91ae9a26983477097f38dd"><div class="ttname"><a href="ipc_2libmultiprocess_2include_2mp_2util_8h.html#a6b530c2b9c91ae9a26983477097f38dd">MP_REQUIRES</a></div><div class="ttdeci">#define MP_REQUIRES(x)</div><div class="ttdef"><b>Definition</b> util.h:155</div></div>
<div class="ttc" id="anamespaceinit_html"><div class="ttname"><a href="namespaceinit.html">init</a></div><div class="ttdef"><b>Definition</b> bitcoin-gui.cpp:17</div></div>
<div class="ttc" id="anamespacemp_html"><div class="ttname"><a href="namespacemp.html">mp</a></div><div class="ttdoc">Functions to serialize / deserialize common bitcoin types.</div><div class="ttdef"><b>Definition</b> common-types.h:57</div></div>
<div class="ttc" id="anamespacemp_html_a05705160ee9ed1819a6f59fdb8bd9fb1"><div class="ttname"><a href="namespacemp.html#a05705160ee9ed1819a6f59fdb8bd9fb1">mp::ConnectStream</a></div><div class="ttdeci">std::unique_ptr&lt; ProxyClient&lt; InitInterface &gt; &gt; ConnectStream(EventLoop &amp;loop, int fd)</div><div class="ttdef"><b>Definition</b> proxy-io.h:682</div></div>
<div class="ttc" id="anamespacemp_html_a48933e17f4fac720326ae1737bf53764"><div class="ttname"><a href="namespacemp.html#a48933e17f4fac720326ae1737bf53764">mp::SetThread</a></div><div class="ttdeci">std::tuple&lt; ConnThread, bool &gt; SetThread(GuardedRef&lt; ConnThreads &gt; threads, Connection *connection, const std::function&lt; Thread::Client()&gt; &amp;make_thread)</div><div class="ttdef"><b>Definition</b> proxy.cpp:317</div></div>
<div class="ttc" id="anamespacemp_html_a4bf39784f1a721e61fb9da94711ba444"><div class="ttname"><a href="namespacemp.html#a4bf39784f1a721e61fb9da94711ba444">mp::ServeStream</a></div><div class="ttdeci">void ServeStream(EventLoop &amp;loop, int fd, InitImpl &amp;init)</div><div class="ttdef"><b>Definition</b> proxy-io.h:738</div></div>
<div class="ttc" id="anamespacemp_html_a4c23514105673e30f7c1f46afc594ece"><div class="ttname"><a href="namespacemp.html#a4c23514105673e30f7c1f46afc594ece">mp::ConnThread</a></div><div class="ttdeci">ConnThreads::iterator ConnThread</div><div class="ttdef"><b>Definition</b> proxy-io.h:600</div></div>
<div class="ttc" id="anamespacemp_html_a5176f804f9aaad2c96c46ac53c5bd28b"><div class="ttname"><a href="namespacemp.html#a5176f804f9aaad2c96c46ac53c5bd28b">mp::ConnThreads</a></div><div class="ttdeci">std::map&lt; Connection *, std::optional&lt; ProxyClient&lt; Thread &gt; &gt; &gt; ConnThreads</div><div class="ttdef"><b>Definition</b> proxy-io.h:599</div></div>
<div class="ttc" id="anamespacemp_html_a5922c1e79ba82f5eb46c5cd0bfc69966"><div class="ttname"><a href="namespacemp.html#a5922c1e79ba82f5eb46c5cd0bfc69966">mp::CleanupIt</a></div><div class="ttdeci">typename CleanupList::iterator CleanupIt</div><div class="ttdef"><b>Definition</b> proxy.h:37</div></div>
<div class="ttc" id="anamespacemp_html_a61ffb74e9f97c3924b3904a35a5f20b2"><div class="ttname"><a href="namespacemp.html#a61ffb74e9f97c3924b3904a35a5f20b2">mp::LogFn</a></div><div class="ttdeci">std::function&lt; void(LogMessage)&gt; LogFn</div><div class="ttdef"><b>Definition</b> proxy-io.h:122</div></div>
<div class="ttc" id="anamespacemp_html_a620d42de001d14996c71608f6f52b5e3"><div class="ttname"><a href="namespacemp.html#a620d42de001d14996c71608f6f52b5e3">mp::KJ_STRINGIFY</a></div><div class="ttdeci">kj::StringPtr KJ_STRINGIFY(Log flags)</div><div class="ttdef"><b>Definition</b> proxy.cpp:434</div></div>
<div class="ttc" id="anamespacemp_html_a6779c2c807b5c6d842e8743aa4a1a0b2"><div class="ttname"><a href="namespacemp.html#a6779c2c807b5c6d842e8743aa4a1a0b2">mp::g_thread_context</a></div><div class="ttdeci">ThreadContext g_thread_context</div><div class="ttdef"><b>Definition</b> proxy.cpp:41</div></div>
<div class="ttc" id="anamespacemp_html_a6fbc82e48f1bf8f39a4635c31bece459"><div class="ttname"><a href="namespacemp.html#a6fbc82e48f1bf8f39a4635c31bece459">mp::CleanupRun</a></div><div class="ttdeci">void CleanupRun(CleanupList &amp;fns)</div><div class="ttdef"><b>Definition</b> proxy.h:39</div></div>
<div class="ttc" id="anamespacemp_html_a9589786aff435d101ca76ab5233f5970"><div class="ttname"><a href="namespacemp.html#a9589786aff435d101ca76ab5233f5970">mp::_Listen</a></div><div class="ttdeci">void _Listen(EventLoop &amp;loop, kj::Own&lt; kj::ConnectionReceiver &gt; &amp;&amp;listener, InitImpl &amp;init)</div><div class="ttdef"><b>Definition</b> proxy-io.h:725</div></div>
<div class="ttc" id="anamespacemp_html_a9642495258151af079da6df81b8dbb0c"><div class="ttname"><a href="namespacemp.html#a9642495258151af079da6df81b8dbb0c">mp::ServerContext</a></div><div class="ttdeci">ServerInvokeContext&lt; ProxyServer&lt; Interface &gt;, ::capnp::CallContext&lt; Params, Results &gt; &gt; ServerContext</div><div class="ttdef"><b>Definition</b> proxy-io.h:59</div></div>
<div class="ttc" id="anamespacemp_html_aa04bf09245b60eb219c446d213cc0390"><div class="ttname"><a href="namespacemp.html#aa04bf09245b60eb219c446d213cc0390">mp::CleanupList</a></div><div class="ttdeci">std::list&lt; std::function&lt; void()&gt; &gt; CleanupList</div><div class="ttdef"><b>Definition</b> proxy.h:36</div></div>
<div class="ttc" id="anamespacemp_html_aa2d3754fdd40a5ee179789009a316e08"><div class="ttname"><a href="namespacemp.html#aa2d3754fdd40a5ee179789009a316e08">mp::LongThreadName</a></div><div class="ttdeci">std::string LongThreadName(const char *exe_name)</div><div class="ttdef"><b>Definition</b> proxy.cpp:429</div></div>
<div class="ttc" id="anamespacemp_html_ab46f5bea2155b7984451745440f03497"><div class="ttname"><a href="namespacemp.html#ab46f5bea2155b7984451745440f03497">mp::Unlock</a></div><div class="ttdeci">void Unlock(Lock &amp;lock, Callback &amp;&amp;callback)</div><div class="ttdef"><b>Definition</b> util.h:206</div></div>
<div class="ttc" id="anamespacemp_html_ac32d169bba43387dec219a91d4539435"><div class="ttname"><a href="namespacemp.html#ac32d169bba43387dec219a91d4539435">mp::ListenConnections</a></div><div class="ttdeci">void ListenConnections(EventLoop &amp;loop, int fd, InitImpl &amp;init)</div><div class="ttdef"><b>Definition</b> proxy-io.h:747</div></div>
<div class="ttc" id="anamespacemp_html_ae822a91aab465661b35be2e1d348cf11"><div class="ttname"><a href="namespacemp.html#ae822a91aab465661b35be2e1d348cf11">mp::_Serve</a></div><div class="ttdeci">void _Serve(EventLoop &amp;loop, kj::Own&lt; kj::AsyncIoStream &gt; &amp;&amp;stream, InitImpl &amp;init)</div><div class="ttdef"><b>Definition</b> proxy-io.h:706</div></div>
<div class="ttc" id="anamespacemp_html_af31ef15863cb3c9383790dc16c3f2304"><div class="ttname"><a href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304">mp::Log</a></div><div class="ttdeci">Log</div><div class="ttdoc">Log flags. Update stringify function if changed!</div><div class="ttdef"><b>Definition</b> proxy-io.h:102</div></div>
<div class="ttc" id="anamespacemp_html_af31ef15863cb3c9383790dc16c3f2304a0eaadb4fcb48a0a0ed7bc9868be9fbaa"><div class="ttname"><a href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304a0eaadb4fcb48a0a0ed7bc9868be9fbaa">mp::Log::Warning</a></div><div class="ttdeci">@ Warning</div><div class="ttdef"><b>Definition</b> proxy-io.h:106</div></div>
<div class="ttc" id="anamespacemp_html_af31ef15863cb3c9383790dc16c3f2304a36ec8dc76bf55896199b1276242944af"><div class="ttname"><a href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304a36ec8dc76bf55896199b1276242944af">mp::Log::Raise</a></div><div class="ttdeci">@ Raise</div><div class="ttdef"><b>Definition</b> proxy-io.h:108</div></div>
<div class="ttc" id="anamespacemp_html_af31ef15863cb3c9383790dc16c3f2304a4059b0251f66a18cb56f544728796875"><div class="ttname"><a href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304a4059b0251f66a18cb56f544728796875">mp::Log::Info</a></div><div class="ttdeci">@ Info</div><div class="ttdef"><b>Definition</b> proxy-io.h:105</div></div>
<div class="ttc" id="anamespacemp_html_af31ef15863cb3c9383790dc16c3f2304a902b0d55fddef6f8d651fe1035b7d4bd"><div class="ttname"><a href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304a902b0d55fddef6f8d651fe1035b7d4bd">mp::Log::Error</a></div><div class="ttdeci">@ Error</div><div class="ttdef"><b>Definition</b> proxy-io.h:107</div></div>
<div class="ttc" id="anamespacemp_html_af31ef15863cb3c9383790dc16c3f2304aa603905470e2a5b8c13e96b579ef0dba"><div class="ttname"><a href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304aa603905470e2a5b8c13e96b579ef0dba">mp::Log::Debug</a></div><div class="ttdeci">@ Debug</div><div class="ttdef"><b>Definition</b> proxy-io.h:104</div></div>
<div class="ttc" id="anamespacemp_html_af31ef15863cb3c9383790dc16c3f2304add4ec0ac4e58f7c32a01244ae91150b1"><div class="ttname"><a href="namespacemp.html#af31ef15863cb3c9383790dc16c3f2304add4ec0ac4e58f7c32a01244ae91150b1">mp::Log::Trace</a></div><div class="ttdeci">@ Trace</div><div class="ttdef"><b>Definition</b> proxy-io.h:103</div></div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdef"><b>Definition</b> setup_common.h:265</div></div>
<div class="ttc" id="aproxy-io_8h_html_aa6fc2a55e5127fdfee52af8eda04d5d5"><div class="ttname"><a href="proxy-io_8h.html#aa6fc2a55e5127fdfee52af8eda04d5d5">MP_LOG</a></div><div class="ttdeci">#define MP_LOG(loop,...)</div><div class="ttdef"><b>Definition</b> proxy-io.h:184</div></div>
<div class="ttc" id="aproxy_8h_html"><div class="ttname"><a href="proxy_8h.html">proxy.h</a></div></div>
<div class="ttc" id="astructmp_1_1_client_invoke_context_html_a75915d4998c2eae263013e31eba8c7c1"><div class="ttname"><a href="structmp_1_1_client_invoke_context.html#a75915d4998c2eae263013e31eba8c7c1">mp::ClientInvokeContext::ClientInvokeContext</a></div><div class="ttdeci">ClientInvokeContext(Connection &amp;conn, ThreadContext &amp;thread_context)</div><div class="ttdef"><b>Definition</b> proxy-io.h:37</div></div>
<div class="ttc" id="astructmp_1_1_client_invoke_context_html_a859a2ba37c0eb07ea294f9e35b8fbdf8"><div class="ttname"><a href="structmp_1_1_client_invoke_context.html#a859a2ba37c0eb07ea294f9e35b8fbdf8">mp::ClientInvokeContext::thread_context</a></div><div class="ttdeci">ThreadContext &amp; thread_context</div><div class="ttdef"><b>Definition</b> proxy-io.h:36</div></div>
<div class="ttc" id="astructmp_1_1_guarded_ref_html"><div class="ttname"><a href="structmp_1_1_guarded_ref.html">mp::GuardedRef</a></div><div class="ttdef"><b>Definition</b> util.h:187</div></div>
<div class="ttc" id="astructmp_1_1_invoke_context_html"><div class="ttname"><a href="structmp_1_1_invoke_context.html">mp::InvokeContext</a></div><div class="ttdef"><b>Definition</b> proxy-io.h:30</div></div>
<div class="ttc" id="astructmp_1_1_invoke_context_html_a14da0714d7378f41cc7d7362c1483abf"><div class="ttname"><a href="structmp_1_1_invoke_context.html#a14da0714d7378f41cc7d7362c1483abf">mp::InvokeContext::connection</a></div><div class="ttdeci">Connection &amp; connection</div><div class="ttdef"><b>Definition</b> proxy-io.h:31</div></div>
<div class="ttc" id="astructmp_1_1_log_message_html"><div class="ttname"><a href="structmp_1_1_log_message.html">mp::LogMessage</a></div><div class="ttdef"><b>Definition</b> proxy-io.h:113</div></div>
<div class="ttc" id="astructmp_1_1_log_message_html_a1a753a0948b8f8d97eda0f8e393011ef"><div class="ttname"><a href="structmp_1_1_log_message.html#a1a753a0948b8f8d97eda0f8e393011ef">mp::LogMessage::level</a></div><div class="ttdeci">Log level</div><div class="ttdoc">The severity level of this message.</div><div class="ttdef"><b>Definition</b> proxy-io.h:119</div></div>
<div class="ttc" id="astructmp_1_1_log_message_html_a36bd74109f547f7f8198faf5a12d2879"><div class="ttname"><a href="structmp_1_1_log_message.html#a36bd74109f547f7f8198faf5a12d2879">mp::LogMessage::message</a></div><div class="ttdeci">std::string message</div><div class="ttdoc">Message to be logged.</div><div class="ttdef"><b>Definition</b> proxy-io.h:116</div></div>
<div class="ttc" id="astructmp_1_1_log_options_html"><div class="ttname"><a href="structmp_1_1_log_options.html">mp::LogOptions</a></div><div class="ttdef"><b>Definition</b> proxy-io.h:124</div></div>
<div class="ttc" id="astructmp_1_1_log_options_html_a1cbcdd8b48543e3316b655dea11bda67"><div class="ttname"><a href="structmp_1_1_log_options.html#a1cbcdd8b48543e3316b655dea11bda67">mp::LogOptions::max_chars</a></div><div class="ttdeci">size_t max_chars</div><div class="ttdef"><b>Definition</b> proxy-io.h:131</div></div>
<div class="ttc" id="astructmp_1_1_log_options_html_a3a414464b11bba79710d13cfe1ede5aa"><div class="ttname"><a href="structmp_1_1_log_options.html#a3a414464b11bba79710d13cfe1ede5aa">mp::LogOptions::log_fn</a></div><div class="ttdeci">LogFn log_fn</div><div class="ttdoc">External logging callback.</div><div class="ttdef"><b>Definition</b> proxy-io.h:127</div></div>
<div class="ttc" id="astructmp_1_1_log_options_html_a63c98c86c0c933b56529ff7a327fabc7"><div class="ttname"><a href="structmp_1_1_log_options.html#a63c98c86c0c933b56529ff7a327fabc7">mp::LogOptions::log_level</a></div><div class="ttdeci">Log log_level</div><div class="ttdef"><b>Definition</b> proxy-io.h:135</div></div>
<div class="ttc" id="astructmp_1_1_proxy_client_3_01_thread_01_4_html_a32f6c2ed2bf7fd1668e2d5c3e5256682"><div class="ttname"><a href="structmp_1_1_proxy_client_3_01_thread_01_4.html#a32f6c2ed2bf7fd1668e2d5c3e5256682">mp::ProxyClient&lt; Thread &gt;::ProxyClientBase</a></div><div class="ttdeci">ProxyClientBase(typename Interface::Client client, Connection *connection, bool destroy_connection)</div><div class="ttdef"><b>Definition</b> proxy-io.h:454</div></div>
<div class="ttc" id="astructmp_1_1_proxy_client_3_01_thread_01_4_html_a36bc04dbcc8122bc405076c2bd588f7a"><div class="ttname"><a href="structmp_1_1_proxy_client_3_01_thread_01_4.html#a36bc04dbcc8122bc405076c2bd588f7a">mp::ProxyClient&lt; Thread &gt;::m_disconnect_cb</a></div><div class="ttdeci">std::optional&lt; CleanupIt &gt; m_disconnect_cb</div><div class="ttdef"><b>Definition</b> proxy-io.h:78</div></div>
<div class="ttc" id="astructmp_1_1_proxy_client_3_01_thread_01_4_html_acdc11ed333f47511007a0554f529e05b"><div class="ttname"><a href="structmp_1_1_proxy_client_3_01_thread_01_4.html#acdc11ed333f47511007a0554f529e05b">mp::ProxyClient&lt; Thread &gt;::ProxyClient</a></div><div class="ttdeci">ProxyClient(const ProxyClient &amp;)=delete</div></div>
<div class="ttc" id="astructmp_1_1_proxy_server_3_01_thread_01_4_html_a1aebf5d44c846e8599ede17753265657"><div class="ttname"><a href="structmp_1_1_proxy_server_3_01_thread_01_4.html#a1aebf5d44c846e8599ede17753265657">mp::ProxyServer&lt; Thread &gt;::m_thread</a></div><div class="ttdeci">std::thread m_thread</div><div class="ttdef"><b>Definition</b> proxy-io.h:89</div></div>
<div class="ttc" id="astructmp_1_1_proxy_server_3_01_thread_01_4_html_ac248112a85eac554493dc906add43261"><div class="ttname"><a href="structmp_1_1_proxy_server_3_01_thread_01_4.html#ac248112a85eac554493dc906add43261">mp::ProxyServer&lt; Thread &gt;::ProxyServer</a></div><div class="ttdeci">ProxyServer(ThreadContext &amp;thread_context, std::thread &amp;&amp;thread)</div><div class="ttdef"><b>Definition</b> proxy.cpp:365</div></div>
<div class="ttc" id="astructmp_1_1_proxy_server_3_01_thread_01_4_html_ad7f1145feb7b33d914e99b547dc57797"><div class="ttname"><a href="structmp_1_1_proxy_server_3_01_thread_01_4.html#ad7f1145feb7b33d914e99b547dc57797">mp::ProxyServer&lt; Thread &gt;::m_thread_context</a></div><div class="ttdeci">ThreadContext &amp; m_thread_context</div><div class="ttdef"><b>Definition</b> proxy-io.h:88</div></div>
<div class="ttc" id="astructmp_1_1_proxy_server_3_01_thread_01_4_html_ae4c852ae199f36c9c5b3440f69100c58"><div class="ttname"><a href="structmp_1_1_proxy_server_3_01_thread_01_4.html#ae4c852ae199f36c9c5b3440f69100c58">mp::ProxyServer&lt; Thread &gt;::getName</a></div><div class="ttdeci">kj::Promise&lt; void &gt; getName(GetNameContext context) override</div><div class="ttdef"><b>Definition</b> proxy.cpp:400</div></div>
<div class="ttc" id="astructmp_1_1_proxy_server_base_html_a337a3c890fad394953330b47eb4aafb2"><div class="ttname"><a href="structmp_1_1_proxy_server_base.html#a337a3c890fad394953330b47eb4aafb2">mp::ProxyServerBase::invokeDestroy</a></div><div class="ttdeci">void invokeDestroy()</div><div class="ttdef"><b>Definition</b> proxy-io.h:587</div></div>
<div class="ttc" id="astructmp_1_1_proxy_server_base_html_a47b0d7e7413d0c7eb592ccf544a24f13"><div class="ttname"><a href="structmp_1_1_proxy_server_base.html#a47b0d7e7413d0c7eb592ccf544a24f13">mp::ProxyServerBase::m_impl</a></div><div class="ttdeci">std::shared_ptr&lt; Impl &gt; m_impl</div><div class="ttdef"><b>Definition</b> proxy.h:170</div></div>
<div class="ttc" id="astructmp_1_1_proxy_server_base_html_a90a9c3ed54e1726a854d4fbf1eb1d379"><div class="ttname"><a href="structmp_1_1_proxy_server_base.html#a90a9c3ed54e1726a854d4fbf1eb1d379">mp::ProxyServerBase::~ProxyServerBase</a></div><div class="ttdeci">virtual ~ProxyServerBase()</div><div class="ttdef"><b>Definition</b> proxy-io.h:539</div></div>
<div class="ttc" id="astructmp_1_1_proxy_server_base_html_af910ca1c8fc9a191f85d16b71819c033"><div class="ttname"><a href="structmp_1_1_proxy_server_base.html#af910ca1c8fc9a191f85d16b71819c033">mp::ProxyServerBase::m_context</a></div><div class="ttdeci">ProxyContext m_context</div><div class="ttdef"><b>Definition</b> proxy.h:171</div></div>
<div class="ttc" id="astructmp_1_1_proxy_server_base_html_afe79a96d9eb6ad4ff906a7f6a5b858b4"><div class="ttname"><a href="structmp_1_1_proxy_server_base.html#afe79a96d9eb6ad4ff906a7f6a5b858b4">mp::ProxyServerBase::ProxyServerBase</a></div><div class="ttdeci">ProxyServerBase(std::shared_ptr&lt; Impl &gt; impl, Connection &amp;connection)</div><div class="ttdef"><b>Definition</b> proxy-io.h:520</div></div>
<div class="ttc" id="astructmp_1_1_proxy_server_html"><div class="ttname"><a href="structmp_1_1_proxy_server.html">mp::ProxyServer</a></div><div class="ttdef"><b>Definition</b> proxy.h:28</div></div>
<div class="ttc" id="astructmp_1_1_server_invoke_context_html"><div class="ttname"><a href="structmp_1_1_server_invoke_context.html">mp::ServerInvokeContext</a></div><div class="ttdef"><b>Definition</b> proxy-io.h:45</div></div>
<div class="ttc" id="astructmp_1_1_server_invoke_context_html_a615c39ca4b0d7940b12f1f03f109d7fa"><div class="ttname"><a href="structmp_1_1_server_invoke_context.html#a615c39ca4b0d7940b12f1f03f109d7fa">mp::ServerInvokeContext::ServerInvokeContext</a></div><div class="ttdeci">ServerInvokeContext(ProxyServer &amp;proxy_server, CallContext &amp;call_context, int req)</div><div class="ttdef"><b>Definition</b> proxy-io.h:52</div></div>
<div class="ttc" id="astructmp_1_1_server_invoke_context_html_a6c748e91888f4356116cf06de81060ca"><div class="ttname"><a href="structmp_1_1_server_invoke_context.html#a6c748e91888f4356116cf06de81060ca">mp::ServerInvokeContext::CallContext</a></div><div class="ttdeci">CallContext_ CallContext</div><div class="ttdef"><b>Definition</b> proxy-io.h:46</div></div>
<div class="ttc" id="astructmp_1_1_server_invoke_context_html_a99f472ad7b6e95b8b8c9fff036c2d960"><div class="ttname"><a href="structmp_1_1_server_invoke_context.html#a99f472ad7b6e95b8b8c9fff036c2d960">mp::ServerInvokeContext&lt; ProxyServer&lt; Interface &gt;, ::capnp::CallContext&lt; Params, Results &gt; &gt;::call_context</a></div><div class="ttdeci">CallContext &amp; call_context</div><div class="ttdef"><b>Definition</b> proxy-io.h:49</div></div>
<div class="ttc" id="astructmp_1_1_server_invoke_context_html_ab3fbc657d40dee5ffd1274f20f960ee8"><div class="ttname"><a href="structmp_1_1_server_invoke_context.html#ab3fbc657d40dee5ffd1274f20f960ee8">mp::ServerInvokeContext&lt; ProxyServer&lt; Interface &gt;, ::capnp::CallContext&lt; Params, Results &gt; &gt;::proxy_server</a></div><div class="ttdeci">ProxyServer &amp; proxy_server</div><div class="ttdef"><b>Definition</b> proxy-io.h:48</div></div>
<div class="ttc" id="astructmp_1_1_server_invoke_context_html_ad4029b357b3b2f147819178b603032f0"><div class="ttname"><a href="structmp_1_1_server_invoke_context.html#ad4029b357b3b2f147819178b603032f0">mp::ServerInvokeContext&lt; ProxyServer&lt; Interface &gt;, ::capnp::CallContext&lt; Params, Results &gt; &gt;::req</a></div><div class="ttdeci">int req</div><div class="ttdef"><b>Definition</b> proxy-io.h:50</div></div>
<div class="ttc" id="astructmp_1_1_server_vat_id_html"><div class="ttname"><a href="structmp_1_1_server_vat_id.html">mp::ServerVatId</a></div><div class="ttdef"><b>Definition</b> proxy-io.h:446</div></div>
<div class="ttc" id="astructmp_1_1_server_vat_id_html_a6425f07d3c33694293c0f54e1a07db7c"><div class="ttname"><a href="structmp_1_1_server_vat_id.html#a6425f07d3c33694293c0f54e1a07db7c">mp::ServerVatId::ServerVatId</a></div><div class="ttdeci">ServerVatId()</div><div class="ttdef"><b>Definition</b> proxy-io.h:450</div></div>
<div class="ttc" id="astructmp_1_1_server_vat_id_html_a9a1257c1478aef292273d2eee91a0b07"><div class="ttname"><a href="structmp_1_1_server_vat_id.html#a9a1257c1478aef292273d2eee91a0b07">mp::ServerVatId::vat_id</a></div><div class="ttdeci">::capnp::rpc::twoparty::VatId::Builder vat_id</div><div class="ttdef"><b>Definition</b> proxy-io.h:449</div></div>
<div class="ttc" id="astructmp_1_1_server_vat_id_html_ab0220d711d4b7199e9a3b788be2e9a53"><div class="ttname"><a href="structmp_1_1_server_vat_id.html#ab0220d711d4b7199e9a3b788be2e9a53">mp::ServerVatId::scratch</a></div><div class="ttdeci">::capnp::word scratch[4]</div><div class="ttdef"><b>Definition</b> proxy-io.h:447</div></div>
<div class="ttc" id="astructmp_1_1_server_vat_id_html_ad0507d9e323da980bb26f55b1799048a"><div class="ttname"><a href="structmp_1_1_server_vat_id.html#ad0507d9e323da980bb26f55b1799048a">mp::ServerVatId::message</a></div><div class="ttdeci">::capnp::MallocMessageBuilder message</div><div class="ttdef"><b>Definition</b> proxy-io.h:448</div></div>
<div class="ttc" id="astructmp_1_1_thread_context_html"><div class="ttname"><a href="structmp_1_1_thread_context.html">mp::ThreadContext</a></div><div class="ttdef"><b>Definition</b> proxy-io.h:621</div></div>
<div class="ttc" id="astructmp_1_1_thread_context_html_a370e26772b89031ea6428652997e3c91"><div class="ttname"><a href="structmp_1_1_thread_context.html#a370e26772b89031ea6428652997e3c91">mp::ThreadContext::loop_thread</a></div><div class="ttdeci">bool loop_thread</div><div class="ttdef"><b>Definition</b> proxy-io.h:675</div></div>
<div class="ttc" id="astructmp_1_1_thread_context_html_a9c938bed0c537f793043396cf41dfeab"><div class="ttname"><a href="structmp_1_1_thread_context.html#a9c938bed0c537f793043396cf41dfeab">mp::ThreadContext::MP_GUARDED_BY</a></div><div class="ttdeci">ConnThreads callback_threads MP_GUARDED_BY(waiter-&gt;m_mutex)</div></div>
<div class="ttc" id="astructmp_1_1_thread_context_html_ab283ccca525d24f19bd1860fa2836783"><div class="ttname"><a href="structmp_1_1_thread_context.html#ab283ccca525d24f19bd1860fa2836783">mp::ThreadContext::waiter</a></div><div class="ttdeci">std::unique_ptr&lt; Waiter &gt; waiter</div><div class="ttdef"><b>Definition</b> proxy-io.h:640</div></div>
<div class="ttc" id="astructmp_1_1_thread_context_html_ad7d4449836b9c614cb977a93f75c4290"><div class="ttname"><a href="structmp_1_1_thread_context.html#ad7d4449836b9c614cb977a93f75c4290">mp::ThreadContext::MP_GUARDED_BY</a></div><div class="ttdeci">ConnThreads request_threads MP_GUARDED_BY(waiter-&gt;m_mutex)</div></div>
<div class="ttc" id="astructmp_1_1_thread_context_html_af22159ec9e33831372abc5e43e4944f9"><div class="ttname"><a href="structmp_1_1_thread_context.html#af22159ec9e33831372abc5e43e4944f9">mp::ThreadContext::thread_name</a></div><div class="ttdeci">std::string thread_name</div><div class="ttdoc">Identifying string for debug.</div><div class="ttdef"><b>Definition</b> proxy-io.h:623</div></div>
<div class="ttc" id="astructmp_1_1_waiter_html_a365fb970e0590633a23f4a61df876c2b"><div class="ttname"><a href="structmp_1_1_waiter.html#a365fb970e0590633a23f4a61df876c2b">mp::Waiter::wait</a></div><div class="ttdeci">void wait(Lock &amp;lock, Predicate pred)</div><div class="ttdef"><b>Definition</b> proxy-io.h:341</div></div>
<div class="ttc" id="astructmp_1_1_waiter_html_a3923af766063ee5af4ebcb7477371791"><div class="ttname"><a href="structmp_1_1_waiter.html#a3923af766063ee5af4ebcb7477371791">mp::Waiter::MP_GUARDED_BY</a></div><div class="ttdeci">std::optional&lt; kj::Function&lt; void()&gt; &gt; m_fn MP_GUARDED_BY(m_mutex)</div></div>
<div class="ttc" id="astructmp_1_1_waiter_html_a71aaf23d91d7b7a5611738c4f06e3577"><div class="ttname"><a href="structmp_1_1_waiter.html#a71aaf23d91d7b7a5611738c4f06e3577">mp::Waiter::m_mutex</a></div><div class="ttdeci">Mutex m_mutex</div><div class="ttdef"><b>Definition</b> proxy-io.h:366</div></div>
<div class="ttc" id="astructmp_1_1_waiter_html_aa406a75cf282d0ac5cb532edd2ba9fa7"><div class="ttname"><a href="structmp_1_1_waiter.html#aa406a75cf282d0ac5cb532edd2ba9fa7">mp::Waiter::post</a></div><div class="ttdeci">bool post(Fn &amp;&amp;fn)</div><div class="ttdef"><b>Definition</b> proxy-io.h:331</div></div>
<div class="ttc" id="astructmp_1_1_waiter_html_accca0ab294feb9061406ae9c73a3ceb5"><div class="ttname"><a href="structmp_1_1_waiter.html#accca0ab294feb9061406ae9c73a3ceb5">mp::Waiter::m_cv</a></div><div class="ttdeci">std::condition_variable m_cv</div><div class="ttdef"><b>Definition</b> proxy-io.h:367</div></div>
<div class="ttc" id="astructmp_1_1_waiter_html_aee95e52957a56b142aae7d97e4d81172"><div class="ttname"><a href="structmp_1_1_waiter.html#aee95e52957a56b142aae7d97e4d81172">mp::Waiter::Waiter</a></div><div class="ttdeci">Waiter()=default</div></div>
<div class="ttc" id="async_8h_html_a326d1d46ce05b5316d8ebe2694a10a6e"><div class="ttname"><a href="sync_8h.html#a326d1d46ce05b5316d8ebe2694a10a6e">Mutex</a></div><div class="ttdeci">AnnotatedMixin&lt; std::mutex &gt; Mutex</div><div class="ttdef"><b>Definition</b> sync.h:124</div></div>
<div class="ttc" id="avalidation_8cpp_html_afb7ea74ba028421697aa7f364741ee6c"><div class="ttname"><a href="validation_8cpp.html#afb7ea74ba028421697aa7f364741ee6c">assert</a></div><div class="ttdeci">assert(!tx.IsCoinBase())</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a href="dir_b94456e2763cc4ff61641ee1fd517631.html">ipc</a></li><li class="navelem"><a href="dir_d0e349844a60905bf54adbe229fa1798.html">libmultiprocess</a></li><li class="navelem"><a href="dir_3acb2047730094af14505d4b23bfba3d.html">include</a></li><li class="navelem"><a href="dir_e1d736fa18cf8aac2c93c7b853cfc900.html">mp</a></li><li class="navelem"><a href="proxy-io_8h.html">proxy-io.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
