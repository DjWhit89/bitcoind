<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>bitcoind: src/test/util/txmempool.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="bitcoin.ico"/></td>
  <td id="projectalign">
   <div id="projectname">bitcoind<span id="projectnumber">&#160;2.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('test_2util_2txmempool_8cpp.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">txmempool.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="test_2util_2txmempool_8h_source.html">test/util/txmempool.h</a>&gt;</code><br />
<code>#include &lt;chainparams.h&gt;</code><br />
<code>#include &lt;<a class="el" href="node_2context_8h_source.html">node/context.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="mempool__args_8h_source.html">node/mempool_args.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="policy_2rbf_8h_source.html">policy/rbf.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="truc__policy_8h_source.html">policy/truc_policy.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="transaction__utils_8h_source.html">test/util/transaction_utils.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="check_8h_source.html">util/check.h</a>&gt;</code><br />
<code>#include &lt;util/time.h&gt;</code><br />
<code>#include &lt;<a class="el" href="translation_8h_source.html">util/translation.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="test_2util_2validation_8h_source.html">validation.h</a>&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a72ec6430ddda7dc377edf13944e25df4" id="r_a72ec6430ddda7dc377edf13944e25df4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_c_tx_mem_pool.html#a181c4ec7f3c173e8ab60665e6cc5f400">CTxMemPool::Options</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a72ec6430ddda7dc377edf13944e25df4">MemPoolOptionsForTest</a> (const <a class="el" href="struct_node_context.html">NodeContext</a> &amp;<a class="el" href="namespacenode.html">node</a>)</td></tr>
<tr class="memitem:aa9b0781f7a2b0c0e0c4eb906dd951d43" id="r_aa9b0781f7a2b0c0e0c4eb906dd951d43"><td class="memItemLeft" align="right" valign="top">std::optional&lt; std::string &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa9b0781f7a2b0c0e0c4eb906dd951d43">CheckPackageMempoolAcceptResult</a> (const <a class="el" href="packages_8h.html#a138b5dbe56c4869308e2bc7a28b51d9c">Package</a> &amp;txns, const <a class="el" href="struct_package_mempool_accept_result.html">PackageMempoolAcceptResult</a> &amp;result, bool expect_valid, const <a class="el" href="class_c_tx_mem_pool.html">CTxMemPool</a> *mempool)</td></tr>
<tr class="memitem:ab388327157d3652cc6706dd8182dce69" id="r_ab388327157d3652cc6706dd8182dce69"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab388327157d3652cc6706dd8182dce69">CheckMempoolEphemeralInvariants</a> (const <a class="el" href="class_c_tx_mem_pool.html">CTxMemPool</a> &amp;tx_pool)</td></tr>
<tr class="memitem:a510d61afe1c2654572e80df2239f816f" id="r_a510d61afe1c2654572e80df2239f816f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a510d61afe1c2654572e80df2239f816f">CheckMempoolTRUCInvariants</a> (const <a class="el" href="class_c_tx_mem_pool.html">CTxMemPool</a> &amp;tx_pool)</td></tr>
<tr class="memitem:ab3a262a83fb943d95fd8670b26f8ccbc" id="r_ab3a262a83fb943d95fd8670b26f8ccbc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab3a262a83fb943d95fd8670b26f8ccbc">TryAddToMempool</a> (<a class="el" href="class_c_tx_mem_pool.html">CTxMemPool</a> &amp;tx_pool, const <a class="el" href="class_c_tx_mem_pool_entry.html">CTxMemPoolEntry</a> &amp;entry)</td></tr>
<tr class="memitem:ae86b44318ee26ef570fc822bb2972197" id="r_ae86b44318ee26ef570fc822bb2972197"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae86b44318ee26ef570fc822bb2972197">MockMempoolMinFee</a> (const <a class="el" href="class_c_fee_rate.html">CFeeRate</a> &amp;target_feerate, <a class="el" href="class_c_tx_mem_pool.html">CTxMemPool</a> &amp;mempool)</td></tr>
</table>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="ab388327157d3652cc6706dd8182dce69" name="ab388327157d3652cc6706dd8182dce69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab388327157d3652cc6706dd8182dce69">&#9670;&#160;</a></span>CheckMempoolEphemeralInvariants()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CheckMempoolEphemeralInvariants </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_tx_mem_pool.html">CTxMemPool</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>tx_pool</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check that we never get into a state where an ephemeral dust transaction would be mined without the spend of the dust also being mined. This assumes standardness checks are being enforced. </p>

</div>
</div>
<a id="a510d61afe1c2654572e80df2239f816f" name="a510d61afe1c2654572e80df2239f816f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a510d61afe1c2654572e80df2239f816f">&#9670;&#160;</a></span>CheckMempoolTRUCInvariants()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CheckMempoolTRUCInvariants </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_tx_mem_pool.html">CTxMemPool</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>tx_pool</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>For every transaction in tx_pool, check TRUC invariants:</p><ul>
<li>a TRUC tx's ancestor count must be within TRUC_ANCESTOR_LIMIT</li>
<li>a TRUC tx's descendant count must be within TRUC_DESCENDANT_LIMIT</li>
<li>if a TRUC tx has ancestors, its sigop-adjusted vsize must be within TRUC_CHILD_MAX_VSIZE</li>
<li>any non-TRUC tx must only have non-TRUC parents</li>
<li>any TRUC tx must only have TRUC parents </li>
</ul>

</div>
</div>
<a id="aa9b0781f7a2b0c0e0c4eb906dd951d43" name="aa9b0781f7a2b0c0e0c4eb906dd951d43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9b0781f7a2b0c0e0c4eb906dd951d43">&#9670;&#160;</a></span>CheckPackageMempoolAcceptResult()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::optional&lt; std::string &gt; CheckPackageMempoolAcceptResult </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="packages_8h.html#a138b5dbe56c4869308e2bc7a28b51d9c">Package</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>txns</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_package_mempool_accept_result.html">PackageMempoolAcceptResult</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>result</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>expect_valid</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_c_tx_mem_pool.html">CTxMemPool</a> *</td>          <td class="paramname"><span class="paramname"><em>mempool</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check expected properties for every <a class="el" href="struct_package_mempool_accept_result.html">PackageMempoolAcceptResult</a>, regardless of value. Returns a string if an error occurs with error populated, nullopt otherwise. If mempool is provided, checks that the expected transactions are in mempool (this should be set to nullptr for a test_accept). </p>

</div>
</div>
<a id="a72ec6430ddda7dc377edf13944e25df4" name="a72ec6430ddda7dc377edf13944e25df4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72ec6430ddda7dc377edf13944e25df4">&#9670;&#160;</a></span>MemPoolOptionsForTest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_tx_mem_pool.html#a181c4ec7f3c173e8ab60665e6cc5f400">CTxMemPool::Options</a> MemPoolOptionsForTest </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_node_context.html">NodeContext</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>node</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae86b44318ee26ef570fc822bb2972197" name="ae86b44318ee26ef570fc822bb2972197"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae86b44318ee26ef570fc822bb2972197">&#9670;&#160;</a></span>MockMempoolMinFee()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MockMempoolMinFee </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_fee_rate.html">CFeeRate</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>target_feerate</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_c_tx_mem_pool.html">CTxMemPool</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>mempool</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Mock the mempool minimum feerate by adding a transaction and calling TrimToSize(0), simulating the mempool "reaching capacity" and evicting by descendant feerate. Note that this clears the mempool, and the new minimum feerate will depend on the maximum feerate of transactions removed, so this must be called while the mempool is empty.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">target_feerate</td><td>The new mempool minimum feerate after this function returns. Must be above max(incremental feerate, min relay feerate), or 1sat/vB with default settings. </td></tr>
    <tr><td class="paramname">mempool</td><td>The mempool to mock the minimum feerate for. Must be empty when called. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab3a262a83fb943d95fd8670b26f8ccbc" name="ab3a262a83fb943d95fd8670b26f8ccbc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3a262a83fb943d95fd8670b26f8ccbc">&#9670;&#160;</a></span>TryAddToMempool()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TryAddToMempool </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_c_tx_mem_pool.html">CTxMemPool</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>tx_pool</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_c_tx_mem_pool_entry.html">CTxMemPoolEntry</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>entry</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>One-line wrapper for creating a mempool changeset with a single transaction and applying it if the policy limits are respected. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a href="dir_120ed4da3e3217b1e7fc0b4f48568e79.html">test</a></li><li class="navelem"><a href="dir_117812821d51f9c480ee192f0868208a.html">util</a></li><li class="navelem"><a href="test_2util_2txmempool_8cpp.html">txmempool.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
