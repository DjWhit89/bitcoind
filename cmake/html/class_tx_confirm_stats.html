<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>bitcoind: TxConfirmStats Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="bitcoin.ico"/></td>
  <td id="projectalign">
   <div id="projectname">bitcoind<span id="projectnumber">&#160;2.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('class_tx_confirm_stats.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">TxConfirmStats Class Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pub-methods" class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ac7b4481c4965b9c4c17c8cf0990331c4" id="r_ac7b4481c4965b9c4c17c8cf0990331c4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac7b4481c4965b9c4c17c8cf0990331c4">TxConfirmStats</a> (const std::vector&lt; double &gt; &amp;defaultBuckets, const std::map&lt; double, unsigned int &gt; &amp;defaultBucketMap, unsigned int maxPeriods, double decay, unsigned int scale)</td></tr>
<tr class="memitem:aa4969591ef8e28d6dbfebfe354b22739" id="r_aa4969591ef8e28d6dbfebfe354b22739"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa4969591ef8e28d6dbfebfe354b22739">ClearCurrent</a> (unsigned int nBlockHeight)</td></tr>
<tr class="memitem:ac3150d4b839c8e61aff5c75e512b2fbe" id="r_ac3150d4b839c8e61aff5c75e512b2fbe"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac3150d4b839c8e61aff5c75e512b2fbe">Record</a> (int blocksToConfirm, double val)</td></tr>
<tr class="memitem:a216f28be9a9cb676ad34f883130e723a" id="r_a216f28be9a9cb676ad34f883130e723a"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a216f28be9a9cb676ad34f883130e723a">NewTx</a> (unsigned int nBlockHeight, double val)</td></tr>
<tr class="memitem:a9071ab202d08ede3278412045288f14a" id="r_a9071ab202d08ede3278412045288f14a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9071ab202d08ede3278412045288f14a">removeTx</a> (unsigned int entryHeight, unsigned int nBestSeenHeight, unsigned int bucketIndex, bool inBlock)</td></tr>
<tr class="memitem:a544feb81331431764ca22fed70c0c594" id="r_a544feb81331431764ca22fed70c0c594"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a544feb81331431764ca22fed70c0c594">UpdateMovingAverages</a> ()</td></tr>
<tr class="memitem:a3f3b2a3c3e9038522985c4e70d2cee5c" id="r_a3f3b2a3c3e9038522985c4e70d2cee5c"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3f3b2a3c3e9038522985c4e70d2cee5c">EstimateMedianVal</a> (int confTarget, double sufficientTxVal, double minSuccess, unsigned int nBlockHeight, <a class="el" href="struct_estimation_result.html">EstimationResult</a> *result=nullptr) const</td></tr>
<tr class="memitem:a1780f7ece2fba74410d5f132f2c07e1b" id="r_a1780f7ece2fba74410d5f132f2c07e1b"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1780f7ece2fba74410d5f132f2c07e1b">GetMaxConfirms</a> () const</td></tr>
<tr class="memitem:a2b650cb03a6aa607e58d9236b617106e" id="r_a2b650cb03a6aa607e58d9236b617106e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2b650cb03a6aa607e58d9236b617106e">Write</a> (<a class="el" href="class_auto_file.html">AutoFile</a> &amp;fileout) const</td></tr>
<tr class="memitem:af5ea5b73531ffb775c4f9fe157feeaaf" id="r_af5ea5b73531ffb775c4f9fe157feeaaf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af5ea5b73531ffb775c4f9fe157feeaaf">Read</a> (<a class="el" href="class_auto_file.html">AutoFile</a> &amp;filein, size_t numBuckets)</td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>We will instantiate an instance of this class to track transactions that were included in a block. We will lump transactions into a bucket according to their approximate feerate and then track how long it took for those txs to be included in a block</p>
<p>The tracking of unconfirmed (mempool) transactions is completely independent of the historical tracking of transactions that have been confirmed in a block. </p>
</div><a name="doc-constructors" id="doc-constructors"></a><h2 id="header-doc-constructors" class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ac7b4481c4965b9c4c17c8cf0990331c4" name="ac7b4481c4965b9c4c17c8cf0990331c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac7b4481c4965b9c4c17c8cf0990331c4">&#9670;&#160;</a></span>TxConfirmStats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_tx_confirm_stats.html">TxConfirmStats</a> </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; double &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>defaultBuckets</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; double, unsigned int &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>defaultBucketMap</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>maxPeriods</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>decay</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>scale</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create new <a class="el" href="class_tx_confirm_stats.html">TxConfirmStats</a>. This is called by BlockPolicyEstimator's constructor with default values. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">defaultBuckets</td><td>contains the upper limits for the bucket boundaries </td></tr>
    <tr><td class="paramname">maxPeriods</td><td>max number of periods to track </td></tr>
    <tr><td class="paramname">decay</td><td>how much to decay the historical moving average per block </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Member Function Documentation</h2>
<a id="aa4969591ef8e28d6dbfebfe354b22739" name="aa4969591ef8e28d6dbfebfe354b22739"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4969591ef8e28d6dbfebfe354b22739">&#9670;&#160;</a></span>ClearCurrent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ClearCurrent </td>
          <td>(</td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>nBlockHeight</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Roll the circular buffer for unconfirmed txs </p>

</div>
</div>
<a id="a3f3b2a3c3e9038522985c4e70d2cee5c" name="a3f3b2a3c3e9038522985c4e70d2cee5c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f3b2a3c3e9038522985c4e70d2cee5c">&#9670;&#160;</a></span>EstimateMedianVal()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double EstimateMedianVal </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>confTarget</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>sufficientTxVal</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>minSuccess</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>nBlockHeight</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_estimation_result.html">EstimationResult</a> *</td>          <td class="paramname"><span class="paramname"><em>result</em></span><span class="paramdefsep"> = </span><span class="paramdefval">nullptr</span>&#160;) const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculate a feerate estimate. Find the lowest value bucket (or range of buckets to make sure we have enough data points) whose transactions still have sufficient likelihood of being confirmed within the target number of confirmations </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">confTarget</td><td>target number of confirmations </td></tr>
    <tr><td class="paramname">sufficientTxVal</td><td>required average number of transactions per block in a bucket range </td></tr>
    <tr><td class="paramname">minSuccess</td><td>the success probability we require </td></tr>
    <tr><td class="paramname">nBlockHeight</td><td>the current block height </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a1780f7ece2fba74410d5f132f2c07e1b" name="a1780f7ece2fba74410d5f132f2c07e1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1780f7ece2fba74410d5f132f2c07e1b">&#9670;&#160;</a></span>GetMaxConfirms()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int GetMaxConfirms </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the max number of confirms we're tracking </p>

</div>
</div>
<a id="a216f28be9a9cb676ad34f883130e723a" name="a216f28be9a9cb676ad34f883130e723a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a216f28be9a9cb676ad34f883130e723a">&#9670;&#160;</a></span>NewTx()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int NewTx </td>
          <td>(</td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>nBlockHeight</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>val</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Record a new transaction entering the mempool </p>

</div>
</div>
<a id="af5ea5b73531ffb775c4f9fe157feeaaf" name="af5ea5b73531ffb775c4f9fe157feeaaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5ea5b73531ffb775c4f9fe157feeaaf">&#9670;&#160;</a></span>Read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_auto_file.html">AutoFile</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>filein</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>numBuckets</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read saved state of estimation data from a file and replace all internal data structures and variables with this state. </p>

</div>
</div>
<a id="ac3150d4b839c8e61aff5c75e512b2fbe" name="ac3150d4b839c8e61aff5c75e512b2fbe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3150d4b839c8e61aff5c75e512b2fbe">&#9670;&#160;</a></span>Record()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Record </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>blocksToConfirm</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>val</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Record a new transaction data point in the current block stats </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">blocksToConfirm</td><td>the number of blocks it took this transaction to confirm </td></tr>
    <tr><td class="paramname">val</td><td>the feerate of the transaction </td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Warning</dt><dd>blocksToConfirm is 1-based and has to be &gt;= 1 </dd></dl>

</div>
</div>
<a id="a9071ab202d08ede3278412045288f14a" name="a9071ab202d08ede3278412045288f14a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9071ab202d08ede3278412045288f14a">&#9670;&#160;</a></span>removeTx()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void removeTx </td>
          <td>(</td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>entryHeight</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>nBestSeenHeight</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>bucketIndex</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>inBlock</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove a transaction from mempool tracking stats </p>

</div>
</div>
<a id="a544feb81331431764ca22fed70c0c594" name="a544feb81331431764ca22fed70c0c594"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a544feb81331431764ca22fed70c0c594">&#9670;&#160;</a></span>UpdateMovingAverages()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UpdateMovingAverages </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Update our estimates by decaying our historical moving average and updating with the data gathered from the current block </p>

</div>
</div>
<a id="a2b650cb03a6aa607e58d9236b617106e" name="a2b650cb03a6aa607e58d9236b617106e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b650cb03a6aa607e58d9236b617106e">&#9670;&#160;</a></span>Write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_auto_file.html">AutoFile</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>fileout</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write state of estimation data to a file </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/policy/fees/<a class="el" href="block__policy__estimator_8cpp.html">block_policy_estimator.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="class_tx_confirm_stats.html">TxConfirmStats</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
