<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>bitcoind: src/policy/ephemeral_policy.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="bitcoin.ico"/></td>
  <td id="projectalign">
   <div id="projectname">bitcoind<span id="projectnumber">&#160;2.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('ephemeral__policy_8h.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">ephemeral_policy.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="amount_8h_source.html">consensus/amount.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="packages_8h_source.html">policy/packages.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="primitives_2transaction_8h_source.html">primitives/transaction.h</a>&gt;</code><br />
<code>#include &lt;optional&gt;</code><br />
</div>
<p><a href="ephemeral__policy_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:adde5d12df12eda5917d9a8ce710320d2" id="r_adde5d12df12eda5917d9a8ce710320d2"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adde5d12df12eda5917d9a8ce710320d2">PreCheckEphemeralTx</a> (const <a class="el" href="class_c_transaction.html">CTransaction</a> &amp;tx, <a class="el" href="class_c_fee_rate.html">CFeeRate</a> dust_relay_rate, <a class="el" href="amount_8h.html#a4eaf3a5239714d8c45b851527f7cb564">CAmount</a> base_fee, <a class="el" href="amount_8h.html#a4eaf3a5239714d8c45b851527f7cb564">CAmount</a> mod_fee, <a class="el" href="class_tx_validation_state.html">TxValidationState</a> &amp;state)</td></tr>
<tr class="memitem:a36520c63ad736ab372a46a44d24cd004" id="r_a36520c63ad736ab372a46a44d24cd004"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a36520c63ad736ab372a46a44d24cd004">CheckEphemeralSpends</a> (const <a class="el" href="packages_8h.html#a138b5dbe56c4869308e2bc7a28b51d9c">Package</a> &amp;package, <a class="el" href="class_c_fee_rate.html">CFeeRate</a> dust_relay_rate, const <a class="el" href="class_c_tx_mem_pool.html">CTxMemPool</a> &amp;tx_pool, <a class="el" href="class_tx_validation_state.html">TxValidationState</a> &amp;out_child_state, <a class="el" href="transaction__identifier_8h.html#a23364c1312d4dffbbf549b4440333fd9">Wtxid</a> &amp;out_child_wtxid)</td></tr>
</table>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="a36520c63ad736ab372a46a44d24cd004" name="a36520c63ad736ab372a46a44d24cd004"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36520c63ad736ab372a46a44d24cd004">&#9670;&#160;</a></span>CheckEphemeralSpends()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CheckEphemeralSpends </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="packages_8h.html#a138b5dbe56c4869308e2bc7a28b51d9c">Package</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>package</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_c_fee_rate.html">CFeeRate</a></td>          <td class="paramname"><span class="paramname"><em>dust_relay_rate</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_c_tx_mem_pool.html">CTxMemPool</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>tx_pool</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_tx_validation_state.html">TxValidationState</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>out_child_state</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="transaction__identifier_8h.html#a23364c1312d4dffbbf549b4440333fd9">Wtxid</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>out_child_wtxid</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Must be called for each transaction(package) if any dust is in the package. Checks that each transaction's parents have their dust spent by the child, where parents are either in the mempool or in the package itself. Sets out_child_state and out_child_wtxid on failure. </p><dl class="section return"><dt>Returns</dt><dd>true if all dust is properly spent. </dd></dl>

</div>
</div>
<a id="adde5d12df12eda5917d9a8ce710320d2" name="adde5d12df12eda5917d9a8ce710320d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adde5d12df12eda5917d9a8ce710320d2">&#9670;&#160;</a></span>PreCheckEphemeralTx()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool PreCheckEphemeralTx </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_transaction.html">CTransaction</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>tx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_c_fee_rate.html">CFeeRate</a></td>          <td class="paramname"><span class="paramname"><em>dust_relay_rate</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="amount_8h.html#a4eaf3a5239714d8c45b851527f7cb564">CAmount</a></td>          <td class="paramname"><span class="paramname"><em>base_fee</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="amount_8h.html#a4eaf3a5239714d8c45b851527f7cb564">CAmount</a></td>          <td class="paramname"><span class="paramname"><em>mod_fee</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_tx_validation_state.html">TxValidationState</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>state</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>These utility functions ensure that ephemeral dust is safely created and spent without unduly risking them entering the utxo set.</p>
<p>This is ensured by requiring:</p><ul>
<li>PreCheckEphemeralTx checks are respected</li>
<li>The parent has no child (and 0-fee as implied above to disincentivize mining)</li>
<li>OR the parent transaction has exactly one child, and the dust is spent by that child</li>
</ul>
<p>Imagine three transactions: TxA, 0-fee with two outputs, one non-dust, one dust TxB, spends TxA's non-dust TxC, spends TxA's dust</p>
<p>All the dust is spent if TxA+TxB+TxC is accepted, but the mining template may just pick up TxA+TxB rather than the three "legal configurations": 1) None 2) TxA+TxB+TxC 3) TxA+TxC By requiring the child transaction to sweep any dust from the parent txn, we ensure that there is a single child only, and this child, or the child's descendants, are the only way to bring fees. Must be called for each transaction once transaction fees are known. Does context-less checks about a single transaction. </p><dl class="section return"><dt>Returns</dt><dd>false if the fee is non-zero and dust exists, populating state. True otherwise. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a href="dir_f9a362818448b8ef6661813ae65d7e79.html">policy</a></li><li class="navelem"><a href="ephemeral__policy_8h.html">ephemeral_policy.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
