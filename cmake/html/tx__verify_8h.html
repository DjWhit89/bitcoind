<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>bitcoind: src/consensus/tx_verify.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="bitcoin.ico"/></td>
  <td id="projectalign">
   <div id="projectname">bitcoind<span id="projectnumber">&#160;2.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('tx__verify_8h.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">tx_verify.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="amount_8h_source.html">consensus/amount.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="verify__flags_8h_source.html">script/verify_flags.h</a>&gt;</code><br />
<code>#include &lt;cstdint&gt;</code><br />
<code>#include &lt;vector&gt;</code><br />
</div>
<p><a href="tx__verify_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-namespaces" class="groupheader"><a id="namespaces" name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:Consensus" id="r_Consensus"><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_consensus.html">Consensus</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3dc747e8073036ed753fd2f53d5d1015" id="r_a3dc747e8073036ed753fd2f53d5d1015"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_consensus.html#a3dc747e8073036ed753fd2f53d5d1015">CheckTxInputs</a> (const <a class="el" href="class_c_transaction.html">CTransaction</a> &amp;tx, <a class="el" href="class_tx_validation_state.html">TxValidationState</a> &amp;state, const <a class="el" href="class_c_coins_view_cache.html">CCoinsViewCache</a> &amp;inputs, int nSpendHeight, <a class="el" href="amount_8h.html#a4eaf3a5239714d8c45b851527f7cb564">CAmount</a> &amp;txfee)</td></tr>
<tr class="memitem:ad2eaf4f8542c12ea9ee1183609cc6d1a" id="r_ad2eaf4f8542c12ea9ee1183609cc6d1a"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad2eaf4f8542c12ea9ee1183609cc6d1a">GetLegacySigOpCount</a> (const <a class="el" href="class_c_transaction.html">CTransaction</a> &amp;tx)</td></tr>
<tr class="memitem:a312fadbeec896d49437733e986f3df04" id="r_a312fadbeec896d49437733e986f3df04"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a312fadbeec896d49437733e986f3df04">GetP2SHSigOpCount</a> (const <a class="el" href="class_c_transaction.html">CTransaction</a> &amp;tx, const <a class="el" href="class_c_coins_view_cache.html">CCoinsViewCache</a> &amp;mapInputs)</td></tr>
<tr class="memitem:ac1e236f29c0fd2b8ecee5a2846122151" id="r_ac1e236f29c0fd2b8ecee5a2846122151"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac1e236f29c0fd2b8ecee5a2846122151">GetTransactionSigOpCost</a> (const <a class="el" href="class_c_transaction.html">CTransaction</a> &amp;tx, const <a class="el" href="class_c_coins_view_cache.html">CCoinsViewCache</a> &amp;inputs, <a class="el" href="classscript__verify__flags.html">script_verify_flags</a> <a class="el" href="bitcoin-tx_8cpp.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>)</td></tr>
<tr class="memitem:adc332cd7ac94e639bb4239618341be19" id="r_adc332cd7ac94e639bb4239618341be19"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adc332cd7ac94e639bb4239618341be19">IsFinalTx</a> (const <a class="el" href="class_c_transaction.html">CTransaction</a> &amp;tx, int nBlockHeight, int64_t nBlockTime)</td></tr>
<tr class="memitem:abc528b150bf26a1644aef9713336dda2" id="r_abc528b150bf26a1644aef9713336dda2"><td class="memItemLeft" align="right" valign="top">std::pair&lt; int, int64_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abc528b150bf26a1644aef9713336dda2">CalculateSequenceLocks</a> (const <a class="el" href="class_c_transaction.html">CTransaction</a> &amp;tx, int <a class="el" href="bitcoin-tx_8cpp.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>, std::vector&lt; int &gt; &amp;prevHeights, const <a class="el" href="class_c_block_index.html">CBlockIndex</a> &amp;block)</td></tr>
<tr class="memitem:ab6bb0246e751e82b8d6e3c97ed88b839" id="r_ab6bb0246e751e82b8d6e3c97ed88b839"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab6bb0246e751e82b8d6e3c97ed88b839">EvaluateSequenceLocks</a> (const <a class="el" href="class_c_block_index.html">CBlockIndex</a> &amp;block, std::pair&lt; int, int64_t &gt; lockPair)</td></tr>
<tr class="memitem:ad5b7bf644ada0a55c6aac8cfa89ed14a" id="r_ad5b7bf644ada0a55c6aac8cfa89ed14a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad5b7bf644ada0a55c6aac8cfa89ed14a">SequenceLocks</a> (const <a class="el" href="class_c_transaction.html">CTransaction</a> &amp;tx, int <a class="el" href="bitcoin-tx_8cpp.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>, std::vector&lt; int &gt; &amp;prevHeights, const <a class="el" href="class_c_block_index.html">CBlockIndex</a> &amp;block)</td></tr>
</table>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="abc528b150bf26a1644aef9713336dda2" name="abc528b150bf26a1644aef9713336dda2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc528b150bf26a1644aef9713336dda2">&#9670;&#160;</a></span>CalculateSequenceLocks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; int, int64_t &gt; CalculateSequenceLocks </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_transaction.html">CTransaction</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>tx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>flags</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>prevHeights</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_c_block_index.html">CBlockIndex</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>block</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculates the block height and previous block's median time past at which the transaction will be considered final in the context of BIP 68. For each input that is not sequence locked, the corresponding entries in prevHeights are set to 0 as they do not affect the calculation. </p>

</div>
</div>
<a id="ab6bb0246e751e82b8d6e3c97ed88b839" name="ab6bb0246e751e82b8d6e3c97ed88b839"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6bb0246e751e82b8d6e3c97ed88b839">&#9670;&#160;</a></span>EvaluateSequenceLocks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool EvaluateSequenceLocks </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_block_index.html">CBlockIndex</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>block</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::pair&lt; int, int64_t &gt;</td>          <td class="paramname"><span class="paramname"><em>lockPair</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad2eaf4f8542c12ea9ee1183609cc6d1a" name="ad2eaf4f8542c12ea9ee1183609cc6d1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2eaf4f8542c12ea9ee1183609cc6d1a">&#9670;&#160;</a></span>GetLegacySigOpCount()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int GetLegacySigOpCount </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_transaction.html">CTransaction</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>tx</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Auxiliary functions for transaction validation (ideally should not be exposed) Count ECDSA signature operations the old-fashioned (pre-0.6) way </p><dl class="section return"><dt>Returns</dt><dd>number of sigops this transaction's outputs will produce when spent </dd></dl>
<dl class="section see"><dt>See also</dt><dd>CTransaction::FetchInputs </dd></dl>

</div>
</div>
<a id="a312fadbeec896d49437733e986f3df04" name="a312fadbeec896d49437733e986f3df04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a312fadbeec896d49437733e986f3df04">&#9670;&#160;</a></span>GetP2SHSigOpCount()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int GetP2SHSigOpCount </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_transaction.html">CTransaction</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>tx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_c_coins_view_cache.html">CCoinsViewCache</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>mapInputs</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Count ECDSA signature operations in pay-to-script-hash inputs.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mapInputs</td><td>Map of previous transactions that have outputs we're spending </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>maximum number of sigops required to validate this transaction's inputs </dd></dl>
<dl class="section see"><dt>See also</dt><dd>CTransaction::FetchInputs </dd></dl>

</div>
</div>
<a id="ac1e236f29c0fd2b8ecee5a2846122151" name="ac1e236f29c0fd2b8ecee5a2846122151"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1e236f29c0fd2b8ecee5a2846122151">&#9670;&#160;</a></span>GetTransactionSigOpCost()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t GetTransactionSigOpCost </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_transaction.html">CTransaction</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>tx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_c_coins_view_cache.html">CCoinsViewCache</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>inputs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classscript__verify__flags.html">script_verify_flags</a></td>          <td class="paramname"><span class="paramname"><em>flags</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute total signature operation cost of a transaction. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">tx</td><td>Transaction for which we are computing the cost </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">inputs</td><td>Map of previous transactions that have outputs we're spending </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>Script verification flags </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Total signature operation cost of tx </dd></dl>

</div>
</div>
<a id="adc332cd7ac94e639bb4239618341be19" name="adc332cd7ac94e639bb4239618341be19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc332cd7ac94e639bb4239618341be19">&#9670;&#160;</a></span>IsFinalTx()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool IsFinalTx </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_transaction.html">CTransaction</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>tx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>nBlockHeight</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t</td>          <td class="paramname"><span class="paramname"><em>nBlockTime</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check if transaction is final and can be included in a block with the specified height and time. <a class="el" href="namespace_consensus.html">Consensus</a> critical. </p>

</div>
</div>
<a id="ad5b7bf644ada0a55c6aac8cfa89ed14a" name="ad5b7bf644ada0a55c6aac8cfa89ed14a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5b7bf644ada0a55c6aac8cfa89ed14a">&#9670;&#160;</a></span>SequenceLocks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SequenceLocks </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_transaction.html">CTransaction</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>tx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>flags</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>prevHeights</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_c_block_index.html">CBlockIndex</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>block</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check if transaction is final per BIP 68 sequence numbers and can be included in a block. <a class="el" href="namespace_consensus.html">Consensus</a> critical. Takes as input a list of heights at which tx's inputs (in order) confirmed. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a href="dir_dee301ab18d354d094fb7852349ef839.html">consensus</a></li><li class="navelem"><a href="tx__verify_8h.html">tx_verify.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
