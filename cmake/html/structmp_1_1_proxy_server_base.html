<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>bitcoind: ProxyServerBase&lt; Interface_, Impl_ &gt; Struct Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="bitcoin.ico"/></td>
  <td id="projectalign">
   <div id="projectname">bitcoind<span id="projectnumber">&#160;2.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('structmp_1_1_proxy_server_base.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">ProxyServerBase&lt; Interface_, Impl_ &gt; Struct Template Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="proxy_8h_source.html">proxy.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for ProxyServerBase&lt; Interface_, Impl_ &gt;:</div>
<div class="dyncontent">
 <div class="center">
  <img src="structmp_1_1_proxy_server_base.png" alt=""/>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pub-types" class="groupheader"><a id="pub-types" name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:ac56f24b044e98752160b4a0a14514e76" id="r_ac56f24b044e98752160b4a0a14514e76"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac56f24b044e98752160b4a0a14514e76">Interface</a> = Interface_</td></tr>
<tr class="memitem:aa5c2e2f388eaba65ab01f79b1ae9ea32" id="r_aa5c2e2f388eaba65ab01f79b1ae9ea32"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa5c2e2f388eaba65ab01f79b1ae9ea32">Impl</a> = Impl_</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pub-methods" class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:afe79a96d9eb6ad4ff906a7f6a5b858b4" id="r_afe79a96d9eb6ad4ff906a7f6a5b858b4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afe79a96d9eb6ad4ff906a7f6a5b858b4">ProxyServerBase</a> (std::shared_ptr&lt; <a class="el" href="#aa5c2e2f388eaba65ab01f79b1ae9ea32">Impl</a> &gt; impl, <a class="el" href="classmp_1_1_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memitem:a90a9c3ed54e1726a854d4fbf1eb1d379" id="r_a90a9c3ed54e1726a854d4fbf1eb1d379"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a90a9c3ed54e1726a854d4fbf1eb1d379">~ProxyServerBase</a> ()</td></tr>
<tr class="memitem:a337a3c890fad394953330b47eb4aafb2" id="r_a337a3c890fad394953330b47eb4aafb2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a337a3c890fad394953330b47eb4aafb2">invokeDestroy</a> ()</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pub-attribs" class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:a47b0d7e7413d0c7eb592ccf544a24f13" id="r_a47b0d7e7413d0c7eb592ccf544a24f13"><td class="memItemLeft" align="right" valign="top">std::shared_ptr&lt; <a class="el" href="#aa5c2e2f388eaba65ab01f79b1ae9ea32">Impl</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a47b0d7e7413d0c7eb592ccf544a24f13">m_impl</a></td></tr>
<tr class="memitem:af910ca1c8fc9a191f85d16b71819c033" id="r_af910ca1c8fc9a191f85d16b71819c033"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structmp_1_1_proxy_context.html">ProxyContext</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af910ca1c8fc9a191f85d16b71819c033">m_context</a></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><div class="compoundTemplParams">template&lt;typename Interface_, typename Impl_&gt;<br />
struct mp::ProxyServerBase&lt; Interface_, Impl_ &gt;</div><p><a class="el" href="class_base.html" title="(Un)serialize a number as raw byte or 2 hexadecimal chars.">Base</a> class for generated <a class="el" href="structmp_1_1_proxy_server.html">ProxyServer</a> classes that implement capnp server methods and forward calls to a wrapped c++ implementation class. </p>
</div><a name="doc-typedef-members" id="doc-typedef-members"></a><h2 id="header-doc-typedef-members" class="groupheader">Member Typedef Documentation</h2>
<a id="aa5c2e2f388eaba65ab01f79b1ae9ea32" name="aa5c2e2f388eaba65ab01f79b1ae9ea32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa5c2e2f388eaba65ab01f79b1ae9ea32">&#9670;&#160;</a></span>Impl</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Interface_, typename Impl_&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="#aa5c2e2f388eaba65ab01f79b1ae9ea32">Impl</a> = Impl_</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac56f24b044e98752160b4a0a14514e76" name="ac56f24b044e98752160b4a0a14514e76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac56f24b044e98752160b4a0a14514e76">&#9670;&#160;</a></span>Interface</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Interface_, typename Impl_&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="#ac56f24b044e98752160b4a0a14514e76">Interface</a> = Interface_</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a name="doc-constructors" id="doc-constructors"></a><h2 id="header-doc-constructors" class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="afe79a96d9eb6ad4ff906a7f6a5b858b4" name="afe79a96d9eb6ad4ff906a7f6a5b858b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe79a96d9eb6ad4ff906a7f6a5b858b4">&#9670;&#160;</a></span>ProxyServerBase()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename <a class="el" href="#ac56f24b044e98752160b4a0a14514e76">Interface</a>, typename <a class="el" href="#aa5c2e2f388eaba65ab01f79b1ae9ea32">Impl</a>&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">ProxyServerBase </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; <a class="el" href="#aa5c2e2f388eaba65ab01f79b1ae9ea32">Impl</a> &gt;</td>          <td class="paramname"><span class="paramname"><em>impl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmp_1_1_connection.html">Connection</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>connection</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a90a9c3ed54e1726a854d4fbf1eb1d379" name="a90a9c3ed54e1726a854d4fbf1eb1d379"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90a9c3ed54e1726a854d4fbf1eb1d379">&#9670;&#160;</a></span>~ProxyServerBase()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename <a class="el" href="#ac56f24b044e98752160b4a0a14514e76">Interface</a>, typename <a class="el" href="#aa5c2e2f388eaba65ab01f79b1ae9ea32">Impl</a>&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">~<a class="el" href="#afe79a96d9eb6ad4ff906a7f6a5b858b4">ProxyServerBase</a> </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel virtual">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p><a class="el" href="structmp_1_1_proxy_server.html">ProxyServer</a> destructor, called from the <a class="el" href="classmp_1_1_event_loop.html">EventLoop</a> thread by Cap'n Proto garbage collection code after there are no more references to this object. This will typically happen when the corresponding <a class="el" href="structmp_1_1_proxy_client.html">ProxyClient</a> object on the other side of the connection is destroyed. It can also happen earlier if the connection is broken or destroyed. In the latter case this destructor will typically be called inside m_rpc_system.reset() call in the ~Connection destructor while the <a class="el" href="classmp_1_1_connection.html">Connection</a> object still exists. However, because <a class="el" href="structmp_1_1_proxy_server.html">ProxyServer</a> objects are refcounted, and the <a class="el" href="classmp_1_1_connection.html">Connection</a> object could be destroyed while asynchronous IPC calls are still in-flight, it's possible for this destructor to be called after the <a class="el" href="classmp_1_1_connection.html">Connection</a> object no longer exists, so it is NOT valid to dereference the m_context.connection pointer from this function. </p>

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Member Function Documentation</h2>
<a id="a337a3c890fad394953330b47eb4aafb2" name="a337a3c890fad394953330b47eb4aafb2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a337a3c890fad394953330b47eb4aafb2">&#9670;&#160;</a></span>invokeDestroy()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename <a class="el" href="#ac56f24b044e98752160b4a0a14514e76">Interface</a>, typename <a class="el" href="#aa5c2e2f388eaba65ab01f79b1ae9ea32">Impl</a>&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void invokeDestroy </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If the capnp interface defined a special "destroy" method, as described the <a class="el" href="classmp_1_1_proxy_client_base.html">ProxyClientBase</a> class, this method will be called and synchronously destroy m_impl before returning to the client.</p>
<p>If the capnp interface does not define a "destroy" method, this will never be called and the ~ProxyServerBase destructor will be responsible for deleting m_impl asynchronously, whenever the <a class="el" href="structmp_1_1_proxy_server.html">ProxyServer</a> object gets garbage collected by Cap'n Proto.</p>
<p>This method is called in the same way other proxy server methods are called, via the serverInvoke function. Basically serverInvoke just calls this as a substitute for a non-existent m_impl-&gt;destroy() method. If the destroy method has any parameters or return values they will be handled in the normal way by PassField/ReadField/BuildField functions. Particularly if a Context.thread parameter was passed, this method will run on the worker thread specified by the client. Otherwise it will run on the <a class="el" href="classmp_1_1_event_loop.html">EventLoop</a> thread, like other server methods without an assigned thread. </p>

</div>
</div>
<a name="doc-variable-members" id="doc-variable-members"></a><h2 id="header-doc-variable-members" class="groupheader">Field Documentation</h2>
<a id="af910ca1c8fc9a191f85d16b71819c033" name="af910ca1c8fc9a191f85d16b71819c033"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af910ca1c8fc9a191f85d16b71819c033">&#9670;&#160;</a></span>m_context</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Interface_, typename Impl_&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structmp_1_1_proxy_context.html">ProxyContext</a> m_context</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a47b0d7e7413d0c7eb592ccf544a24f13" name="a47b0d7e7413d0c7eb592ccf544a24f13"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a47b0d7e7413d0c7eb592ccf544a24f13">&#9670;&#160;</a></span>m_impl</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Interface_, typename Impl_&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt;<a class="el" href="#aa5c2e2f388eaba65ab01f79b1ae9ea32">Impl</a>&gt; m_impl</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Implementation pointer that may or may not be owned and deleted when this capnp server goes out of scope. It is owned for servers created to wrap unique_ptr&lt;Impl&gt; method arguments, but unowned for servers created to wrap <a class="el" href="#aa5c2e2f388eaba65ab01f79b1ae9ea32">Impl</a>&amp; method arguments.</p>
<p>In the case of <a class="el" href="#aa5c2e2f388eaba65ab01f79b1ae9ea32">Impl</a>&amp; arguments, custom code is required on other side of the connection to delete the capnp client &amp; server objects since native code on that side of the connection will just be taking a plain reference rather than a pointer, so won't be able to do its own cleanup. Right now this is implemented with addCloseHook callbacks to delete clients at appropriate times depending on semantics of the particular method being wrapped. </p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following files:<ul>
<li>src/ipc/libmultiprocess/include/mp/<a class="el" href="proxy_8h_source.html">proxy.h</a></li>
<li>src/ipc/libmultiprocess/include/mp/<a class="el" href="proxy-io_8h_source.html">proxy-io.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="namespacemp.html">mp</a></li><li class="navelem"><a href="structmp_1_1_proxy_server_base.html">ProxyServerBase</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
