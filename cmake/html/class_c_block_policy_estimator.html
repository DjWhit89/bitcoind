<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>bitcoind: CBlockPolicyEstimator Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="bitcoin.ico"/></td>
  <td id="projectalign">
   <div id="projectname">bitcoind<span id="projectnumber">&#160;2.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('class_c_block_policy_estimator.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">CBlockPolicyEstimator Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="block__policy__estimator_8h_source.html">block_policy_estimator.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for CBlockPolicyEstimator:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_c_block_policy_estimator.png" usemap="#CBlockPolicyEstimator_map" alt=""/>
  <map id="CBlockPolicyEstimator_map" name="CBlockPolicyEstimator_map">
<area href="class_c_validation_interface.html" alt="CValidationInterface" shape="rect" coords="0,0,138,24"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pub-methods" class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a815227f17255990ccf29ea25464c043c" id="r_a815227f17255990ccf29ea25464c043c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a815227f17255990ccf29ea25464c043c">CBlockPolicyEstimator</a> (const <a class="el" href="classfs_1_1path.html">fs::path</a> &amp;estimation_filepath, const bool read_stale_estimates)</td></tr>
<tr class="memitem:a47ebc7133c7fddd3bc81483c1741d690" id="r_a47ebc7133c7fddd3bc81483c1741d690"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a47ebc7133c7fddd3bc81483c1741d690">~CBlockPolicyEstimator</a> ()</td></tr>
<tr class="memitem:a65f0b56680542778f34609dca718e8c6" id="r_a65f0b56680542778f34609dca718e8c6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a65f0b56680542778f34609dca718e8c6">processBlock</a> (const std::vector&lt; <a class="el" href="struct_removed_mempool_transaction_info.html">RemovedMempoolTransactionInfo</a> &gt; &amp;txs_removed_for_block, unsigned int nBlockHeight) <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(!m_cs_fee_estimator)</td></tr>
<tr class="memitem:a77dd2df6a56ac08a4da69d9a14c565f1" id="r_a77dd2df6a56ac08a4da69d9a14c565f1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a77dd2df6a56ac08a4da69d9a14c565f1">processTransaction</a> (const <a class="el" href="struct_new_mempool_transaction_info.html">NewMempoolTransactionInfo</a> &amp;tx) <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(!m_cs_fee_estimator)</td></tr>
<tr class="memitem:ae527d524ab2393114960a1dd71bc9fac" id="r_ae527d524ab2393114960a1dd71bc9fac"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae527d524ab2393114960a1dd71bc9fac">removeTx</a> (<a class="el" href="transaction__identifier_8h.html#ac4bb3c35b94889843d632be4de4b223c">Txid</a> hash) <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(!m_cs_fee_estimator)</td></tr>
<tr class="memitem:ad080776568edc383fecca04b03922daa" id="r_ad080776568edc383fecca04b03922daa"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_c_fee_rate.html">CFeeRate</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad080776568edc383fecca04b03922daa">estimateFee</a> (int confTarget) const <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(!m_cs_fee_estimator)</td></tr>
<tr class="memitem:a91a7a3600d2d4ed050dddc8af78344d4" id="r_a91a7a3600d2d4ed050dddc8af78344d4"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="class_c_fee_rate.html">CFeeRate</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a91a7a3600d2d4ed050dddc8af78344d4">estimateSmartFee</a> (int confTarget, <a class="el" href="struct_fee_calculation.html">FeeCalculation</a> *feeCalc, bool conservative) const <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(!m_cs_fee_estimator)</td></tr>
<tr class="memitem:aebb09054edb6c8141fd011472b7913d7" id="r_aebb09054edb6c8141fd011472b7913d7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_c_fee_rate.html">CFeeRate</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aebb09054edb6c8141fd011472b7913d7">estimateRawFee</a> (int confTarget, double successThreshold, <a class="el" href="block__policy__estimator_8h.html#a8e4bdf4356d17e4e14401a8c92da04f2">FeeEstimateHorizon</a> horizon, <a class="el" href="struct_estimation_result.html">EstimationResult</a> *result=nullptr) const <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(!m_cs_fee_estimator)</td></tr>
<tr class="memitem:a38b652a99060c3e2ec89ce60f1c3b71a" id="r_a38b652a99060c3e2ec89ce60f1c3b71a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a38b652a99060c3e2ec89ce60f1c3b71a">Write</a> (<a class="el" href="class_auto_file.html">AutoFile</a> &amp;fileout) const <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(!m_cs_fee_estimator)</td></tr>
<tr class="memitem:ad3295f8549a3322f053137055a15ecf9" id="r_ad3295f8549a3322f053137055a15ecf9"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad3295f8549a3322f053137055a15ecf9">Read</a> (<a class="el" href="class_auto_file.html">AutoFile</a> &amp;filein) <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(!m_cs_fee_estimator)</td></tr>
<tr class="memitem:a0814f91b291e30546df18c6831b3ae8b" id="r_a0814f91b291e30546df18c6831b3ae8b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0814f91b291e30546df18c6831b3ae8b">FlushUnconfirmed</a> () <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(!m_cs_fee_estimator)</td></tr>
<tr class="memitem:a3efe98e3f82015824278af45fb8d07e5" id="r_a3efe98e3f82015824278af45fb8d07e5"><td class="memItemLeft" align="right" valign="top">virtual unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3efe98e3f82015824278af45fb8d07e5">HighestTargetTracked</a> (<a class="el" href="block__policy__estimator_8h.html#a8e4bdf4356d17e4e14401a8c92da04f2">FeeEstimateHorizon</a> horizon) const <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(!m_cs_fee_estimator)</td></tr>
<tr class="memitem:aeccd7769dcdae47867184fd809016799" id="r_aeccd7769dcdae47867184fd809016799"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aeccd7769dcdae47867184fd809016799">Flush</a> () <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(!m_cs_fee_estimator)</td></tr>
<tr class="memitem:a39973876d07137743f37456b71c5711b" id="r_a39973876d07137743f37456b71c5711b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a39973876d07137743f37456b71c5711b">FlushFeeEstimates</a> () <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(!m_cs_fee_estimator)</td></tr>
<tr class="memitem:a7767edfa6aa286e24a456adf484e6860" id="r_a7767edfa6aa286e24a456adf484e6860"><td class="memItemLeft" align="right" valign="top">std::chrono::hours&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7767edfa6aa286e24a456adf484e6860">GetFeeEstimatorFileAge</a> ()</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pro-methods" class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a82ce5bcdb57e2684d50b589d18e82624" id="r_a82ce5bcdb57e2684d50b589d18e82624"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a82ce5bcdb57e2684d50b589d18e82624">TransactionAddedToMempool</a> (const <a class="el" href="struct_new_mempool_transaction_info.html">NewMempoolTransactionInfo</a> &amp;tx, uint64_t) override <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(!m_cs_fee_estimator)</td></tr>
<tr class="memitem:a0aa4813d9d5f3e8f4c71be5f205b8f20" id="r_a0aa4813d9d5f3e8f4c71be5f205b8f20"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0aa4813d9d5f3e8f4c71be5f205b8f20">TransactionRemovedFromMempool</a> (const <a class="el" href="primitives_2transaction_8h.html#ae462b4b8f07705a82bf11cf361959b97">CTransactionRef</a> &amp;tx, <a class="el" href="mempool__removal__reason_8h.html#a2bc6653552b5871101b6cbefdbaf251f">MemPoolRemovalReason</a>, uint64_t) override <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(!m_cs_fee_estimator)</td></tr>
<tr class="memitem:a011805724fc262857fa82f49186c7455" id="r_a011805724fc262857fa82f49186c7455"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a011805724fc262857fa82f49186c7455">MempoolTransactionsRemovedForBlock</a> (const std::vector&lt; <a class="el" href="struct_removed_mempool_transaction_info.html">RemovedMempoolTransactionInfo</a> &gt; &amp;txs_removed_for_block, unsigned int nBlockHeight) override <a class="el" href="thread__annotations_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(!m_cs_fee_estimator)</td></tr>
<tr class="inherit_header pro_methods_class_c_validation_interface"><td colspan="2" onclick="javascript:dynsection.toggleInherit('pro_methods_class_c_validation_interface')"><span class="dynarrow"><span class="arrowhead closed"></span></span>Protected Member Functions inherited from <a class="el" href="class_c_validation_interface.html">CValidationInterface</a></td></tr>
<tr class="memitem:aad9483faad7ccdb00e7494de501776a0 inherit pro_methods_class_c_validation_interface" id="r_aad9483faad7ccdb00e7494de501776a0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_validation_interface.html#aad9483faad7ccdb00e7494de501776a0">~CValidationInterface</a> ()=default</td></tr>
<tr class="memitem:a380dda786ad029c1816421c45424c78c inherit pro_methods_class_c_validation_interface" id="r_a380dda786ad029c1816421c45424c78c"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_validation_interface.html#a380dda786ad029c1816421c45424c78c">UpdatedBlockTip</a> (const <a class="el" href="class_c_block_index.html">CBlockIndex</a> *pindexNew, const <a class="el" href="class_c_block_index.html">CBlockIndex</a> *pindexFork, bool fInitialDownload)</td></tr>
<tr class="memitem:a4ffef6c150debdc76821b1488b7db20e inherit pro_methods_class_c_validation_interface" id="r_a4ffef6c150debdc76821b1488b7db20e"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_validation_interface.html#a4ffef6c150debdc76821b1488b7db20e">ActiveTipChange</a> (const <a class="el" href="class_c_block_index.html">CBlockIndex</a> &amp;new_tip, bool is_ibd)</td></tr>
<tr class="memitem:a41401b83726759ddd692bbfe627e09d1 inherit pro_methods_class_c_validation_interface" id="r_a41401b83726759ddd692bbfe627e09d1"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_validation_interface.html#a41401b83726759ddd692bbfe627e09d1">BlockConnected</a> (const <a class="el" href="structkernel_1_1_chainstate_role.html">kernel::ChainstateRole</a> &amp;role, const std::shared_ptr&lt; const <a class="el" href="class_c_block.html">CBlock</a> &gt; &amp;block, const <a class="el" href="class_c_block_index.html">CBlockIndex</a> *pindex)</td></tr>
<tr class="memitem:ace0c3c3b924da1ba43d5d924fceb45ea inherit pro_methods_class_c_validation_interface" id="r_ace0c3c3b924da1ba43d5d924fceb45ea"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_validation_interface.html#ace0c3c3b924da1ba43d5d924fceb45ea">BlockDisconnected</a> (const std::shared_ptr&lt; const <a class="el" href="class_c_block.html">CBlock</a> &gt; &amp;block, const <a class="el" href="class_c_block_index.html">CBlockIndex</a> *pindex)</td></tr>
<tr class="memitem:a462316941d99f23c26c9217297762d52 inherit pro_methods_class_c_validation_interface" id="r_a462316941d99f23c26c9217297762d52"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_validation_interface.html#a462316941d99f23c26c9217297762d52">ChainStateFlushed</a> (const <a class="el" href="structkernel_1_1_chainstate_role.html">kernel::ChainstateRole</a> &amp;role, const <a class="el" href="struct_c_block_locator.html">CBlockLocator</a> &amp;locator)</td></tr>
<tr class="memitem:a49e9c60d03d94ecaa73c610d74e0b824 inherit pro_methods_class_c_validation_interface" id="r_a49e9c60d03d94ecaa73c610d74e0b824"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_validation_interface.html#a49e9c60d03d94ecaa73c610d74e0b824">BlockChecked</a> (const std::shared_ptr&lt; const <a class="el" href="class_c_block.html">CBlock</a> &gt; &amp;, const <a class="el" href="class_block_validation_state.html">BlockValidationState</a> &amp;)</td></tr>
<tr class="memitem:a51d31af38790c2a66bbf3b9c90c9808b inherit pro_methods_class_c_validation_interface" id="r_a51d31af38790c2a66bbf3b9c90c9808b"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_validation_interface.html#a51d31af38790c2a66bbf3b9c90c9808b">NewPoWValidBlock</a> (const <a class="el" href="class_c_block_index.html">CBlockIndex</a> *pindex, const std::shared_ptr&lt; const <a class="el" href="class_c_block.html">CBlock</a> &gt; &amp;block)</td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The BlockPolicyEstimator is used for estimating the feerate needed for a transaction to be included in a block within a certain number of blocks.</p>
<p>At a high level the algorithm works by grouping transactions into buckets based on having similar feerates and then tracking how long it takes transactions in the various buckets to be mined. It operates under the assumption that in general transactions of higher feerate will be included in blocks before transactions of lower feerate. So for example if you wanted to know what feerate you should put on a transaction to be included in a block within the next 5 blocks, you would start by looking at the bucket with the highest feerate transactions and verifying that a sufficiently high percentage of them were confirmed within 5 blocks and then you would look at the next highest feerate bucket, and so on, stopping at the last bucket to pass the test. The average feerate of transactions in this bucket will give you an indication of the lowest feerate you can put on a transaction and still have a sufficiently high chance of being confirmed within your desired 5 blocks.</p>
<p>Here is a brief description of the implementation: When a transaction enters the mempool, we track the height of the block chain at entry. All further calculations are conducted only on this set of "seen" transactions. Whenever a block comes in, we count the number of transactions in each bucket and the total amount of feerate paid in each bucket. Then we calculate how many blocks Y it took each transaction to be mined. We convert from a number of blocks to a number of periods Y' each encompassing "scale" blocks. This is tracked in 3 different data sets each up to a maximum number of periods. Within each data set we have an array of counters in each feerate bucket and we increment all the counters from Y' up to max periods representing that a tx was successfully confirmed in less than or equal to that many periods. We want to save a history of this information, so at any time we have a counter of the total number of transactions that happened in a given feerate bucket and the total number that were confirmed in each of the periods or less for any bucket. We save this history by keeping an exponentially decaying moving average of each one of these stats. This is done for a different decay in each of the 3 data sets to keep relevant data from different time horizons. Furthermore we also keep track of the number unmined (in mempool or left mempool without being included in a block) transactions in each bucket and for how many blocks they have been outstanding and use both of these numbers to increase the number of transactions we've seen in that feerate bucket when calculating an estimate for any number of confirmations below the number of blocks they've been outstanding.</p>
<p>We want to be able to estimate feerates that are needed on tx's to be included in a certain number of blocks. Every time a block is added to the best chain, this class records stats on the transactions included in that block </p>
</div><a name="doc-constructors" id="doc-constructors"></a><h2 id="header-doc-constructors" class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a815227f17255990ccf29ea25464c043c" name="a815227f17255990ccf29ea25464c043c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a815227f17255990ccf29ea25464c043c">&#9670;&#160;</a></span>CBlockPolicyEstimator()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_block_policy_estimator.html">CBlockPolicyEstimator</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classfs_1_1path.html">fs::path</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>estimation_filepath</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool</td>          <td class="paramname"><span class="paramname"><em>read_stale_estimates</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create new BlockPolicyEstimator and initialize stats tracking classes with default values </p>

</div>
</div>
<a id="a47ebc7133c7fddd3bc81483c1741d690" name="a47ebc7133c7fddd3bc81483c1741d690"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a47ebc7133c7fddd3bc81483c1741d690">&#9670;&#160;</a></span>~CBlockPolicyEstimator()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">~<a class="el" href="class_c_block_policy_estimator.html">CBlockPolicyEstimator</a> </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel virtual">virtual</span><span class="mlabel default">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Member Function Documentation</h2>
<a id="ad080776568edc383fecca04b03922daa" name="ad080776568edc383fecca04b03922daa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad080776568edc383fecca04b03922daa">&#9670;&#160;</a></span>estimateFee()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_fee_rate.html">CFeeRate</a> estimateFee </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>confTarget</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>DEPRECATED. Return a feerate estimate </p>

</div>
</div>
<a id="aebb09054edb6c8141fd011472b7913d7" name="aebb09054edb6c8141fd011472b7913d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aebb09054edb6c8141fd011472b7913d7">&#9670;&#160;</a></span>estimateRawFee()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_fee_rate.html">CFeeRate</a> estimateRawFee </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>confTarget</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>successThreshold</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="block__policy__estimator_8h.html#a8e4bdf4356d17e4e14401a8c92da04f2">FeeEstimateHorizon</a></td>          <td class="paramname"><span class="paramname"><em>horizon</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_estimation_result.html">EstimationResult</a> *</td>          <td class="paramname"><span class="paramname"><em>result</em></span><span class="paramdefsep"> = </span><span class="paramdefval">nullptr</span>&#160;) const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a specific fee estimate calculation with a given success threshold and time horizon, and optionally return detailed data about calculation </p>

</div>
</div>
<a id="a91a7a3600d2d4ed050dddc8af78344d4" name="a91a7a3600d2d4ed050dddc8af78344d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91a7a3600d2d4ed050dddc8af78344d4">&#9670;&#160;</a></span>estimateSmartFee()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_fee_rate.html">CFeeRate</a> estimateSmartFee </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>confTarget</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_fee_calculation.html">FeeCalculation</a> *</td>          <td class="paramname"><span class="paramname"><em>feeCalc</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>conservative</em></span>&#160;) const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel virtual">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Estimate feerate needed to get be included in a block within confTarget blocks. If no answer can be given at confTarget, return an estimate at the closest target where one can be given. 'conservative' estimates are valid over longer time horizons also.</p>
<p>estimateSmartFee returns the max of the feerates calculated with a 60% threshold required at target / 2, an 85% threshold required at target and a 95% threshold required at 2 * target. Each calculation is performed at the shortest time horizon which tracks the required target. Conservative estimates, however, required the 95% threshold at 2 * target be met for any longer time horizons also. </p>
<p>true is passed to estimateCombined fee for target/2 and target so that we check the max confirms for shorter time horizons as well. This is necessary to preserve monotonically increasing estimates. For non-conservative estimates we do the same thing for 2*target, but for conservative estimates we want to skip these shorter horizons checks for 2*target because we are taking the max over all time horizons so we already have monotonically increasing estimates and the purpose of conservative estimates is not to let short term fluctuations lower our estimates by too much.</p>
<p>Note: In certain rare edge cases, monotonically increasing estimates may not be guaranteed. Specifically, given two targets N and M, where M &gt; N, if a sub-estimate for target N fails to return a valid fee rate, while target M has valid fee rate for that sub-estimate, target M may result in a higher fee rate estimate than target N.</p>
<p>See: <a href="https://github.com/bitcoin/bitcoin/issues/11800#issuecomment-349697807">https://github.com/bitcoin/bitcoin/issues/11800#issuecomment-349697807</a></p>

</div>
</div>
<a id="aeccd7769dcdae47867184fd809016799" name="aeccd7769dcdae47867184fd809016799"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeccd7769dcdae47867184fd809016799">&#9670;&#160;</a></span>Flush()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Flush </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Drop still unconfirmed transactions and record current estimations, if the fee estimation file is present. </p>

</div>
</div>
<a id="a39973876d07137743f37456b71c5711b" name="a39973876d07137743f37456b71c5711b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39973876d07137743f37456b71c5711b">&#9670;&#160;</a></span>FlushFeeEstimates()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FlushFeeEstimates </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Record current fee estimations. </p>

</div>
</div>
<a id="a0814f91b291e30546df18c6831b3ae8b" name="a0814f91b291e30546df18c6831b3ae8b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0814f91b291e30546df18c6831b3ae8b">&#9670;&#160;</a></span>FlushUnconfirmed()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FlushUnconfirmed </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Empty mempool transactions on shutdown to record failure to confirm for txs still in mempool </p>

</div>
</div>
<a id="a7767edfa6aa286e24a456adf484e6860" name="a7767edfa6aa286e24a456adf484e6860"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7767edfa6aa286e24a456adf484e6860">&#9670;&#160;</a></span>GetFeeEstimatorFileAge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::chrono::hours GetFeeEstimatorFileAge </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculates the age of the file, since last modified </p>

</div>
</div>
<a id="a3efe98e3f82015824278af45fb8d07e5" name="a3efe98e3f82015824278af45fb8d07e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3efe98e3f82015824278af45fb8d07e5">&#9670;&#160;</a></span>HighestTargetTracked()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int HighestTargetTracked </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="block__policy__estimator_8h.html#a8e4bdf4356d17e4e14401a8c92da04f2">FeeEstimateHorizon</a></td>          <td class="paramname"><span class="paramname"><em>horizon</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel virtual">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Calculation of highest target that estimates are tracked for </p>

</div>
</div>
<a id="a011805724fc262857fa82f49186c7455" name="a011805724fc262857fa82f49186c7455"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a011805724fc262857fa82f49186c7455">&#9670;&#160;</a></span>MempoolTransactionsRemovedForBlock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void MempoolTransactionsRemovedForBlock </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="struct_removed_mempool_transaction_info.html">RemovedMempoolTransactionInfo</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>txs_removed_for_block</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>nBlockHeight</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel override">override</span><span class="mlabel protected">protected</span><span class="mlabel virtual">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reimplemented from <a class="el" href="class_c_validation_interface.html#a5a935698165aa2894a458e663be2f0db">CValidationInterface</a>.</p>

</div>
</div>
<a id="a65f0b56680542778f34609dca718e8c6" name="a65f0b56680542778f34609dca718e8c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a65f0b56680542778f34609dca718e8c6">&#9670;&#160;</a></span>processBlock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void processBlock </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="struct_removed_mempool_transaction_info.html">RemovedMempoolTransactionInfo</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>txs_removed_for_block</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>nBlockHeight</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Process all the transactions that have been included in a block </p>

</div>
</div>
<a id="a77dd2df6a56ac08a4da69d9a14c565f1" name="a77dd2df6a56ac08a4da69d9a14c565f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77dd2df6a56ac08a4da69d9a14c565f1">&#9670;&#160;</a></span>processTransaction()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void processTransaction </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_new_mempool_transaction_info.html">NewMempoolTransactionInfo</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>tx</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Process a transaction accepted to the mempool </p>

</div>
</div>
<a id="ad3295f8549a3322f053137055a15ecf9" name="ad3295f8549a3322f053137055a15ecf9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3295f8549a3322f053137055a15ecf9">&#9670;&#160;</a></span>Read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_auto_file.html">AutoFile</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>filein</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read estimation data from a file </p>

</div>
</div>
<a id="ae527d524ab2393114960a1dd71bc9fac" name="ae527d524ab2393114960a1dd71bc9fac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae527d524ab2393114960a1dd71bc9fac">&#9670;&#160;</a></span>removeTx()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool removeTx </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="transaction__identifier_8h.html#ac4bb3c35b94889843d632be4de4b223c">Txid</a></td>          <td class="paramname"><span class="paramname"><em>hash</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove a transaction from the mempool tracking stats for non BLOCK removal reasons </p>

</div>
</div>
<a id="a82ce5bcdb57e2684d50b589d18e82624" name="a82ce5bcdb57e2684d50b589d18e82624"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82ce5bcdb57e2684d50b589d18e82624">&#9670;&#160;</a></span>TransactionAddedToMempool()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void TransactionAddedToMempool </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_new_mempool_transaction_info.html">NewMempoolTransactionInfo</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>tx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t</td>          <td class="paramname"><span class="paramname"><em></em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel override">override</span><span class="mlabel protected">protected</span><span class="mlabel virtual">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Overridden from <a class="el" href="class_c_validation_interface.html">CValidationInterface</a>. </p>

<p>Reimplemented from <a class="el" href="class_c_validation_interface.html#a7a2ce3dce287e7b5ec214b4bcfe05a99">CValidationInterface</a>.</p>

</div>
</div>
<a id="a0aa4813d9d5f3e8f4c71be5f205b8f20" name="a0aa4813d9d5f3e8f4c71be5f205b8f20"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0aa4813d9d5f3e8f4c71be5f205b8f20">&#9670;&#160;</a></span>TransactionRemovedFromMempool()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void TransactionRemovedFromMempool </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="primitives_2transaction_8h.html#ae462b4b8f07705a82bf11cf361959b97">CTransactionRef</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>tx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="mempool__removal__reason_8h.html#a2bc6653552b5871101b6cbefdbaf251f">MemPoolRemovalReason</a></td>          <td class="paramname"><span class="paramname"><em>reason</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t</td>          <td class="paramname"><span class="paramname"><em>mempool_sequence</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel override">override</span><span class="mlabel protected">protected</span><span class="mlabel virtual">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Notifies listeners of a transaction leaving mempool.</p>
<p>This notification fires for transactions that are removed from the mempool for the following reasons:</p>
<ul>
<li>EXPIRY (expired from mempool after -mempoolexpiry hours)</li>
<li>SIZELIMIT (removed in size limiting if the mempool exceeds -maxmempool megabytes)</li>
<li>REORG (removed during a reorg)</li>
<li>CONFLICT (removed because it conflicts with in-block transaction)</li>
<li>REPLACED (removed due to RBF replacement)</li>
</ul>
<p>This does not fire for transactions that are removed from the mempool because they have been included in a block. Any client that is interested in transactions removed from the mempool for inclusion in a block can learn about those transactions from the MempoolTransactionsRemovedForBlock notification.</p>
<p>Transactions that are removed from the mempool because they conflict with a transaction in the new block will have TransactionRemovedFromMempool events fired <em>before</em> the BlockConnected event is fired. If multiple blocks are connected in one step, then the ordering could be:</p>
<ul>
<li>TransactionRemovedFromMempool(tx1 from block A)</li>
<li>TransactionRemovedFromMempool(tx2 from block A)</li>
<li>TransactionRemovedFromMempool(tx1 from block B)</li>
<li>TransactionRemovedFromMempool(tx2 from block B)</li>
<li>BlockConnected(A)</li>
<li>BlockConnected(B)</li>
</ul>
<p>Called on a background thread. </p>

<p>Reimplemented from <a class="el" href="class_c_validation_interface.html#a34351b1a3571af34d86d50d96c1c7b01">CValidationInterface</a>.</p>

</div>
</div>
<a id="a38b652a99060c3e2ec89ce60f1c3b71a" name="a38b652a99060c3e2ec89ce60f1c3b71a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38b652a99060c3e2ec89ce60f1c3b71a">&#9670;&#160;</a></span>Write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_auto_file.html">AutoFile</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>fileout</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write estimation data to a file </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/policy/fees/<a class="el" href="block__policy__estimator_8h_source.html">block_policy_estimator.h</a></li>
<li>src/policy/fees/<a class="el" href="block__policy__estimator_8cpp.html">block_policy_estimator.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="class_c_block_policy_estimator.html">CBlockPolicyEstimator</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
