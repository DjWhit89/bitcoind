<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>bitcoind: Contributing to libsecp256k1</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="bitcoin.ico"/></td>
  <td id="projectalign">
   <div id="projectname">bitcoind<span id="projectnumber">&#160;2.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_src_2secp256k1_2_c_o_n_t_r_i_b_u_t_i_n_g.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Contributing to libsecp256k1 </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md171"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md172"></a>
Scope</h1>
<p>libsecp256k1 is a library for elliptic curve cryptography on the curve secp256k1, not a general-purpose cryptography library. The library primarily serves the needs of the Bitcoin Core project but provides additional functionality for the benefit of the wider Bitcoin ecosystem.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md173"></a>
Adding new functionality or modules</h1>
<p>The libsecp256k1 project welcomes contributions in the form of new functionality or modules, provided they are within the project's scope.</p>
<p>It is the responsibility of the contributors to convince the maintainers that the proposed functionality is within the project's scope, high-quality and maintainable. Contributors are recommended to provide the following in addition to the new code:</p>
<ul>
<li><b>Specification:</b> A specification can help significantly in reviewing the new code as it provides documentation and context. It may justify various design decisions, give a motivation and outline security goals. If the specification contains pseudocode, a reference implementation or test vectors, these can be used to compare with the proposed libsecp256k1 code.</li>
<li><b>Security Arguments:</b> In addition to a defining the security goals, it should be argued that the new functionality meets these goals. Depending on the nature of the new functionality, a wide range of security arguments are acceptable, ranging from being "obviously secure" to rigorous proofs of security.</li>
<li><b>Relevance Arguments:</b> The relevance of the new functionality for the Bitcoin ecosystem should be argued by outlining clear use cases.</li>
</ul>
<p>These are not the only factors taken into account when considering to add new functionality. The proposed new libsecp256k1 code must be of high quality, including API documentation and tests, as well as featuring a misuse-resistant API design.</p>
<p>We recommend reaching out to other contributors (see Communication Channels) and get feedback before implementing new functionality.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md174"></a>
Communication channels</h1>
<p>Most communication about libsecp256k1 occurs on the GitHub repository: in issues, pull request or on the discussion board.</p>
<p>Additionally, there is an IRC channel dedicated to libsecp256k1, with biweekly meetings (see channel topic). The channel is <span class="tt">#secp256k1</span> on Libera Chat. The easiest way to participate on IRC is with the web client, <a href="https://web.libera.chat/#secp256k1">web.libera.chat</a>. Chat history logs can be found at <a href="https://gnusha.org/secp256k1/">https://gnusha.org/secp256k1/</a>.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md175"></a>
Contributor workflow &amp; peer review</h1>
<p>The Contributor Workflow &amp; Peer Review in libsecp256k1 are similar to Bitcoin Core's workflow and review processes described in its <a href="https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md">CONTRIBUTING.md</a>.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md176"></a>
Coding conventions</h2>
<p>In addition, libsecp256k1 tries to maintain the following coding conventions:</p>
<ul>
<li>No runtime heap allocation (e.g., no <span class="tt">malloc</span>) unless explicitly requested by the caller (via <span class="tt"><a class="el" href="secp256k1_8h.html#a3aaa9fcc3ab67bc8f841779a049069c5">secp256k1_context_create</a></span> or <span class="tt">secp256k1_scratch_space_create</span>, for example). Moreover, it should be possible to use the library without any heap allocations.</li>
<li>The tests should cover all lines and branches of the library (see Test coverage).</li>
<li>Operations involving secret data should be tested for being constant time with respect to the secrets (see <a href="src/ctime_tests.c">src/ctime_tests.c</a>).</li>
<li>Local variables containing secret data should be cleared explicitly to try to delete secrets from memory.</li>
<li>Use <span class="tt">secp256k1_memcmp_var</span> instead of <span class="tt">memcmp</span> (see <a href="https://github.com/bitcoin-core/secp256k1/issues/823">#823</a>).</li>
<li>As a rule of thumb, the default values for configuration options should target standard desktop machines and align with Bitcoin Core's defaults, and the tests should mostly exercise the default configuration (see <a href="https://github.com/bitcoin-core/secp256k1/issues/1549#issuecomment-2200559257">#1549</a>).</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md177"></a>
Style conventions</h3>
<ul>
<li>Commits should be atomic and diffs should be easy to read. For this reason, do not mix any formatting fixes or code moves with actual code changes. Make sure each individual commit is hygienic: that it builds successfully on its own without warnings, errors, regressions, or test failures.</li>
<li>New code should adhere to the style of existing, in particular surrounding, code. Other than that, we do not enforce strict rules for code formatting.</li>
<li>The code conforms to C89. Most notably, that means that only <span class="tt">/* ... */</span> comments are allowed (no <span class="tt">//</span> line comments). Moreover, any declarations in a <span class="tt">{ ... }</span> block (e.g., a function) must appear at the beginning of the block before any statements. When you would like to declare a variable in the middle of a block, you can open a new block: <div class="fragment"><div class="line"><span class="keywordtype">void</span> secp256k_foo(<span class="keywordtype">void</span>) {</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x;              <span class="comment">/* declaration */</span></div>
<div class="line">    <span class="keywordtype">int</span> y = 2*x;                 <span class="comment">/* declaration */</span></div>
<div class="line">    x = 17;                      <span class="comment">/* statement */</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> a, b;                <span class="comment">/* declaration */</span></div>
<div class="line">        a = x + y;               <span class="comment">/* statement */</span></div>
<div class="line">        secp256k_bar(x, &amp;b);     <span class="comment">/* statement */</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Use <span class="tt">unsigned int</span> instead of just <span class="tt">unsigned</span>.</li>
<li>Use <span class="tt">void *ptr</span> instead of <span class="tt">void* ptr</span>.</li>
<li>Arguments of the publicly-facing API must have a specific order defined in <a href="include/secp256k1.h">include/secp256k1.h</a>.</li>
<li>User-facing comment lines in headers should be limited to 80 chars if possible.</li>
<li>All identifiers in file scope should start with <span class="tt">secp256k1_</span>.</li>
<li>Avoid trailing whitespace.</li>
<li>Use the constants <span class="tt"><a class="el" href="bitcoin-wallet_8cpp.html#a1a8bb385160d2854b0c2ebb85db2d212">EXIT_SUCCESS</a></span>/<span class="tt">EXIT_FAILURE</span> (defined in <span class="tt">stdlib.h</span>) to indicate program execution status for examples and other binaries.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md178"></a>
Tests</h2>
<h3 class="doxsection"><a class="anchor" id="autotoc_md179"></a>
Coverage</h3>
<p>This library aims to have full coverage of reachable lines and branches.</p>
<p>To create a test coverage report, configure with <span class="tt">--enable-coverage</span> (use of GCC is necessary): </p><pre class="fragment">$ ./configure --enable-coverage
</pre><p>Run the tests: </p><pre class="fragment">$ make check
</pre><p>To create a report, <span class="tt">gcovr</span> is recommended, as it includes branch coverage reporting: </p><pre class="fragment">$ gcovr --gcov-ignore-parse-errors=all --merge-mode-functions=separate --exclude 'src/bench*' --exclude 'src/modules/.*/bench_impl.h' --print-summary
</pre><p>To create a HTML report with coloured and annotated source code: </p><pre class="fragment">$ mkdir -p coverage
$ gcovr --gcov-ignore-parse-errors=all --merge-mode-functions=separate --exclude 'src/bench*' --exclude 'src/modules/.*/bench_impl.h' --html --html-details -o coverage/coverage.html
</pre><p>On <span class="tt">gcovr</span> &gt;=8.3, <span class="tt">--gcov-ignore-parse-errors=all</span> can be replaced with <span class="tt">--gcov-suspicious-hits-threshold=140737488355330</span>.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md180"></a>
Exhaustive tests</h3>
<p>There are tests of several functions in which a small group replaces secp256k1. These tests are <em>exhaustive</em> since they provide all elements and scalars of the small group as input arguments (see <a href="src/tests_exhaustive.c">src/tests_exhaustive.c</a>).</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md181"></a>
Benchmarks</h2>
<p>See <span class="tt">src/bench*.c</span> for examples of benchmarks. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
